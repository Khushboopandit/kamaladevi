function DataObject(){this.tableToRowList={},this.tableArray=new Array(0),this.getRowsForTable=getRowsForTable,this.addRowsForTable=addRowsForTable,this.containsTable=containsTable,this.addNewTable=addNewTable,this.setColumn=setColumn,this.deleteFirstRow=deleteFirstRow,this.deleteAllRowsInTable=deleteAllRowsInTable,this.getTables=getTables,this.getRows=getRows,this.getFirstRow=getFirstRow,this.displayDO=displayDO,this.constructXML=constructXML}function getRowsForTable(e){return this.tableToRowList[e]}function addRowsForTable(e,t){this.containsTable(e)||this.addNewTable(e);var i=this.tableToRowList[e];return i[i.length]=createRow(t),!0}function createRow(e){for(var t={},i=0;i<e.length;i++)t[e[i][0]]=e[i][1];return t}function containsTable(e){for(var t=this.tableArray.length,i=0;t>i;i++)if(this.tableArray[i]==e)return!0;return!1}function addNewTable(e){this.tableArray.push(e),this.tableToRowList[e]=new Array(0)}function setColumn(e,t,i){if(!this.containsTable(e))return!1;var a=this.tableToRowList[e];for(var s in a)for(var n in a[s])n==t&&(a[s][n]=i);return!0}function deleteFirstRow(e,t,i){if(!this.containsTable(e))return!1;var a=this.tableToRowList[e],s=null;for(var n in a)for(var r in a[n])r==t&&a[n][r]==i&&(s=n);return a.splice(s,1),this.tableToRowList[e]=a,!0}function deleteAllRowsInTable(e,t,i){if(!this.containsTable(e))return!1;var a=this.tableToRowList[e],s=new Array(0);for(var n in a)for(var r in a[n])r==t&&a[n][r]==i&&s.push(n);var o=new Array(0),l=!1;for(var n in a){l=!1;for(var r in s)n==s[r]&&(l=!0);l||o.push(a[n])}return a=o,this.tableToRowList[e]=a,!0}function getTables(){return this.tableArray}function getFirstRow(e,t,i){var a=(this.getTables(),this.getRowsForTable(e));for(var s in a)for(var n in a[s])if(a[s][n]==i)return a[s];return null}function getRows(e,t,i){var a=new Array(0),s=this.getRowsForTable(e);for(var n in s)for(var r in s[n])r==t&&s[n][r]==i&&a.push(s[n]);return a}function displayDO(){var e=this.getTables(),t="";for(var i in e){var a=this.getRowsForTable(e[i]);t=t+"<br>Table  :"+e[i];for(var s in a){for(var n in a[s])t=t+"<br>Row number"+s+":    <i>Property name </i>   "+n+"   <i>Value</i>   "+a[s][n]+"      ";t+="<br>"}}return t}function constructXML(){var e=this.getTables(),t="<Data>";for(var i in e){var a=this.getRowsForTable(e[i]);for(var s in a){t=t+"<"+e[i];for(var n in a[s])"string"==typeof a[s][n]&&-1==a[s][n].indexOf("null")&&0!=a[s][n].length?t=t+" "+n+'="'+a[s][n]+'" ':"string"!=typeof a[s][n]&&0!=a[s][n].length&&(t=t+" "+n+'="'+a[s][n]+'" ');t+="/>"}}return t+="</Data>"}function demo(){var e=new DataObject;e.addRowsForTable("table1",new Array(new Array("prop1","value1"),new Array("prop2","value2"))),e.addRowsForTable("table1",new Array(new Array("prop1","value3"),new Array("prop2","value4"))),e.addRowsForTable("table2",new Array(new Array("prop1","value1"),new Array("prop2","value2")));e.getRowsForTable("table1");document.write("<B>Initial values</B><br>"),document.write(e.displayDO()),e.setColumn("table1","prop1","newValue"),document.write("<br><br><B>After Updation:</B><br>"),document.write(e.displayDO()),document.write("<br><br><B>Get Tables:</B><br>");var t=e.getTables();for(var i in t)document.write("<br>Table "+i+" :  "+t[i]);e.deleteAllRowsInTable("table1","prop1","newValue"),document.write("<br><br><B>After Deletion:</B><br>"),document.write(e.displayDO())}function WmsContacts(){}function WmsMPAccounts(){}function WmsGroups(){}function WMSSessionConfig(){}_defineReadOnlyProperty=function(e,t,i){Object.defineProperty(e,t,{value:i,writable:!1})},_defineReadOnlyProperties=function(e,t){for(var i in t)Object.defineProperty(e,i,{value:t[i],writable:!1})},$.getImgStaticUrl=function(){return $zcg._IMGSTATICURL},$.fn.hasOnlyChildrenlike=function(e,t){return $(this[0].firstChild).attr(e)===t},function(){function e(){return i(s)}function t(){return i(n)}function i(e){var t=["Webkit","Moz","O","ms"];if(void 0!==document.body.style.animationName)return e.noprefix;for(var i=0,a=t.length;a>i;i++)if(void 0!==document.body.style[t[i]+"AnimationName"])return e[t[i]]}function a(e,t,i,a){function s(e,t){"function"==typeof a?a(e,t):t.remove()}function n(e){s(e,$(this))}t?"undefined"!=typeof i.selector?e.on(t,i.selector,n):e.off(t).on(t,n):s()}var s={noprefix:"animationend",Moz:"animationend",Webkit:"webkitAnimationEnd",O:"oAnimationEnd",ms:"MSAnimationEnd"},n={noprefix:"transitionend",Moz:"transitionend",Webkit:"webkitTransitionEnd",O:"oTransitionEnd",ms:"MSTransitionEnd"};$.fn.handleAnimationEnd=function(t,i){var s=$.extend({},i);if(this.length){var n=e();a(this,n,s,t)}},$.fn.handleTransitionEnd=function(e,i){var s=$.extend({},i);if(this.length){var n=t();a(this,n,s,e)}}}(),$.fn.cssAnimation=function(e){Array.isArray(e)&&(e=e.join(" ")),this.addClass(e),this.handleAnimationEnd(function(t,i){i.removeClass(e)})},$.fn.cssTransition=function(e){Array.isArray(e)&&(e=e.join(" ")),this.addClass(e),this.handleTransitionEnd(function(t,i){i.removeClass(e)})},$.fn.setAsDraggable=function(e){var t=this;if($WC.$CUtil.isEmpty(e)&&(e=t),0!==e.length){e.addClass("drag");var i={},a=$(window),s=0,n=0,r=0,o=0,l=function(e){e.preventDefault();var a=Math.max(0,e.clientX-i.left),l=Math.max(0,e.clientY-i.top);a=Math.min(a,s-r),l=Math.min(l,n-o),t.css({left:a,top:l})},c=function(e){e.preventDefault(),$(document).off("mousemove",l)};e.off("mousedown").on("mousedown",function(e){r=t.width(),o=t.height(),s=a.width(),n=a.height();var d=t.offset();i.left=e.clientX-d.left,i.top=e.clientY-d.top,$(document).on("mousemove",l),$(document).one("mouseup",c)})}},$.fn.isScrolledToView=function(e,t,i){(null==t||"undefined"==typeof t)&&(t=1),(null==i||"undefined"==typeof i)&&(i=1);var a=$(e?e:window),s={top:a.offset().top,left:a.offset().left};s.right=s.left+a.width(),s.bottom=s.top+a.height();var n=this.outerHeight(),r=this.outerWidth();if(!r||!n)return!1;var o=this.offset();o.right=o.left+r,o.bottom=o.top+n;var l=!(s.right<o.left||s.left>o.right||s.bottom<o.top||s.top>o.bottom);if(!l)return!1;var c={top:Math.min(1,(o.bottom-s.top)/n),bottom:Math.min(1,(s.bottom-o.top)/n),left:Math.min(1,(o.right-s.left)/r),right:Math.min(1,(s.right-o.left)/r)};return c.left*c.right>=t&&c.top*c.bottom>=i},String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),Date.prototype.addDays||(Date.prototype.addDays=function(e){this.setDate(this.getDate()+e)}),Object.defineProperty(Array.prototype,"insert",{enumerable:!1,writable:!0,value:function(e,t){this.splice(e,0,t)}}),Object.defineProperty(Array.prototype,"removeElement",{enumerable:!1,writable:!0,value:function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)}}),"undefined"!=typeof HTMLElement.prototype.scrollIntoView&&"undefined"==typeof HTMLElement.prototype.scrollIntoViewIfNeeded?HTMLElement.prototype.scrollIntoViewIfNeeded=function(e){this.scrollIntoView({block:e?"start":"nearest"})}:"undefined"==typeof HTMLElement.prototype.scrollIntoView&&"undefined"!=typeof HTMLElement.prototype.scrollIntoViewIfNeeded&&(HTMLElement.prototype.scrollIntoView=function(e){var t="object"==typeof e&&"start"===e.block;this.scrollIntoViewIfNeeded(t)});var $zcg={};!function(){var e=window.zcg;for(var t in e)$zcg[t]=e[t];delete window.zcg}(),jQuery(function(e){function t(t,i){try{var a=e.parseJSON(i);return a.componentOptions?a.componentOptions:a={content:i}}catch(s){return eleOptions={content:i}}}function i(t,i){var a="["+i+"]";try{t=t.is(a)?t:e(t.parents(a).get(0))}catch(s){}return t}function a(a){this._windowEle=e(window),this._windowWidth=this._windowEle.width(),D.maxWidth=D.maxWidth||this._windowWidth-30;var n=this;this._windowEle.on("resize."+this.widgetName,function(){n._windowWidth=n._windowEle.width()}),this._documentEle=e(document),this._documentEle.on("keydown."+this.widgetName,function(e){27==e.keyCode&&d(e)}),e(a).on("buttondisabled",function(t,i){var a=e(i.element),s=a.attr("title");i.disabled?(a.removeAttr("title"),a.data("ztooltip",s)):a.attr("title",a.data("ztooltip"))}),e(a).on("mouseover."+this.widgetName+" mouseup."+this.widgetName+" mousemove."+this.widgetName,function(a){var o=i(e(a.target),"title"),l=o.attr("title");if(!l)return void(o.length&&o.is(f)&&d());if(o.length&&"document"!==o[0].nodeName.toLowerCase()){if(E&&clearTimeout(E),o.attr("disabled")||o.hasClass("ui-state-disabled")||o.hasClass("ui-ztooltip-ignore"))return s(o),d(),!1;W=o,s(o),y=e.extend({},L,t(o,l));var c=o.attr("callout");void 0!==c&&""!==N[c]&&(y.callout=c),e(T).length&&e(T).find(".ui-ztooltip-close").remove(),I=800,r(a,o),$=o,S=l,o.on("click.ztooltip",function(){d()}),o.off("mouseleave.ztooltip").on("mouseleave.ztooltip",function(e){y.timeout&&clearTimeout(O),E&&clearTimeout(E),E=setTimeout(function(){y.autohide&&(o.unbind("mousemove"),d(e))},200),s(o,!0)}),n._documentEle.off("mousedown.ztooltip").on("mousedown.ztooltip",function(e){y.autohide&&(o.unbind("mousemove"),d(e)),s(o,!0)}),y.mousetrack&&o.off("mousemove.ztooltip").on("mousemove.ztooltip",function(e){h(e,o)})}})}function s(t,i){var a=i?t.data("parents"):t.parents("[title]");i?t.data("parents",void 0):(a.push(t),t.data("parents",a)),a&&e.each(a,function(t,a){a=e(a);var s="",n=a.attr("title");i?(s=n!=a.data("title")&&void 0!==n?n:a.data("title"),a.attr("title",s)):(a.data("title",n),a.removeAttr("title"))})}function n(t){var i=T?!0:!1,a="ui-corner-all",s=y.ajaxContent?"ui-ztooltip-ajaxcontent ":y.autohide?"ui-ztooltip-content ":"ui-ztooltip-contentwithclose ";if(i)I=0;else{T=e("<div>").attr("class","ui-ztooltip ui-widget"),M=void 0;var n=e("<div>").attr("class","ui-ztooltip-overlaydiv ui-corner-all");R=e("<div>").attr("class","ui-ztooltip-header ui-corner-top"),A=e("<div>").attr({"class":s+a,id:"ui-ztooltip-content"}).css({"max-width":D.maxWidth}),U=e("<span>").attr("class","ui-ztooltip-img "+y.iconclass).appendTo(n),R.appendTo(n),A.appendTo(n),n.appendTo(T),e("body").append(T)}if(y.containerClass?T.addClass(y.containerClass):T.attr("class","ui-ztooltip ui-widget"),R.css("display",""),U.css("display",""),y.iconclass&&U.css({display:"inline-block"}),y.title&&(R.text(y.title),a="ui-corner-bottom",R.css({display:"inline-block"})),!y.autohide){var r=e("<span>").attr("class","ui-ztooltip-close ui-icon ui-components-icon").on("click",function(t){e($).off("mousemove"),d(t),e($).attr("title",S)});r.appendTo(T),e($).attr("noAutoHide",!0)}if(A.attr("class",s+" "+a),!y.ajaxContent){C=y.content;var o="html"==y.contentType;if(o&&y.isContentElementId){var c=e("<div>").append(e("#"+y.content).clone().show());C=c.html()}if(D&&e.ui&&e.ui.shortcutkeys&&D.showShortcutKey){t=t.is("label.ui-button")?t.prev("input"):t;var u=e(document).shortcutkeys("getShortcutKey",t);u&&(C=C+" ("+u+")")}}b&&b.remove(),b=T.clone(),e("body").append(b);var o="html"==y.contentType;return b.removeAttr("style").hide(),b.find("#ui-ztooltip-content").removeAttr("style"),b.find("#ui-ztooltip-content")[o?"html":"text"](C),y.callout&&!y.ajaxContent?(M||(M=e("<div>").attr("class","ui-ztooltip-callout").appendTo(T)),v=l(y.callout,M,T)):M=void 0,T}function r(a,s,r){if(r){var l=i(s,"title");if(!l.length)return;var m=l.attr("title");if(!m)return;y=e.extend({},L,t(s,m)),displayTimeDelay=0}var p="html"==y.contentType;if((y.mouseEnter===!0||y.mousetrack===!0)&&(y.callout="northwest"),tooltipEle=n(s),displayTimeDelay=I,r&&(displayTimeDelay=0),tooltipEle){var h=void 0;a.originalEvent?h=y.callout&&!y.ajaxContent?c(a):{left:a.pageX+10,top:a.pageY+10}:(h=s.offset(),h.left+=s.width(),h.top+=s.height()),h=o(h,s,b),clearTimeout(w),clearTimeout(_),w=setTimeout(function(){if(s.is(":visible")||s.is("option")){if(y.ajaxContent){var t=e("<div>").attr("class","ui-ztooltip-content-loading");e(T).find(".ui-ztooltip-ajaxcontent").append(t),_=setTimeout(function(){e.ajax({type:"GET",url:y.ajaxContent,data:"",success:function(t){e(T).find(".ui-ztooltip-ajaxcontent").html(t)},error:function(){e(T).find(".ui-ztooltip-ajaxcontent").empty()}})})}y.timeout&&y.autohide&&(O=setTimeout(function(){d(a)},parseInt(y.timeout))),tooltipEle.show(1,function(){A[p?"html":"text"](C),M.css(v),h=u(a,tooltipEle,h,s),h&&tooltipEle.css(h),y.calloutHideMode&&T.find(".ui-ztooltip-callout").hide(),f=s})}},displayTimeDelay)}}function o(e,t,i,a){var s=y.callout?y.callout:a,n=t.offset(),r=n.left,o=n.top;return t.is("option")&&(r=t.parent("select").offset().left,o=t.parent("select").offset().top+t.offset.top),s&&(-1!=s.indexOf("north")?(y.mouseEnter||y.mousetrack||(e.left="northwest"===s?r:"northeast"===s?r-(i.width()-t.outerWidth()):r-8-(i.width()/2-8)+t.outerWidth()/2),e.top=o+t.outerHeight()+9):-1!=s.indexOf("south")?(e.left="southwest"===s?r:"southeast"===s?r-(i.width()-t.outerWidth()):r-8-(i.width()/2-8)+t.outerWidth()/2,e.top=o-i.outerHeight()-9):"west"===s?(e.left=parseInt(r+t.outerWidth()+9),e.top=o-i.height()/2+t.outerHeight()/2):"east"===s&&(e.left=parseInt(r-i.width()-9),e.top=o-i.height()/2+t.outerHeight()/2)),e}function l(e,t){if(!T)return!1;var i={};t.removeAttr("class").attr("class","ui-ztooltip-callout ui-ztooltip-callout-"+N[e]);var a=t.outerWidth(),s=t.outerHeight(),n=b.width(),r=b.height();switch(e){case"north":i={left:n/2-a/2+"px",top:"-"+(s-1)+"px"};break;case"west":i={left:"-"+(a-1)+"px",top:r/2-s/2+"px"};break;case"east":i={left:n-1+"px",top:r/2-s/2+"px"};break;case"south":i={left:n/2-a/2+"px",top:r-1+"px"};break;case"northeast":i={left:n-2*a+"px",top:"-"+(s-1)+"px"};break;case"northwest":i={left:a+"px",top:"-"+(s-1)+"px"};break;case"southwest":i={left:a+"px",top:r-1+"px"};break;case"southeast":i={left:n-2*a+"px",top:r-1+"px"};break;default:t.addClass("ui-ztooltip-callout-top"),i={left:a+"px",top:"-"+(s-1)+"px"}}return i}function c(e){T.css({left:"auto",top:"auto"}).hide(),e.tooltipWidth=T.outerWidth(),e.tooltipHeight=T.height();if(e._OFFSET=10,!T)return!1;var t=T.find(".ui-ztooltip-callout");e.calloutWidth=t.outerWidth(),e.calloutHeight=t.outerHeight();var i=x[y.callout];return i||(i=x.defaultFn),i(e)}function d(){T&&("html"===y.contentType&&y.isContentElementId&&e(T).find("#"+y.content).appendTo("body").hide(),e(T).remove(),T=void 0)}function u(e,t,i,a){if(t&&i){var s,n=i.top-this._documentEle.scrollTop(),r=i.left-this._documentEle.scrollLeft(),o=r+t.width(),l=n+t.height(),c=void 0,d=5;if(o>=this._windowWidth?(i.left=this._windowWidth-(t.outerWidth(!0)+d),i.left+t.width()-a.offset().left<=15&&(y.callout="east"),c=y.callout):0>r&&(i.left=i.left+d-r,a.offset().left+a.width()-this._documentEle.scrollLeft()<=20&&(y.callout="west"),c=y.callout),l>=this._windowEle.height()?(i.top=a.offset().top-t.outerHeight()-9,c="south",s=n):0>n&&(i.top=a.offset().top+a.outerHeight()+9,c="north",s=n),c){var u=t.find(".ui-ztooltip-callout");m(e,c,u,t,i,r,s)}}return i}function m(e,t,i,a,s,n,r){var o=y.callout?y.callout:t;switch(t){case"north":o="south"==o?"north":"southeast"==o?"northeast":"southwest"==o?"northwest":o;break;case"south":o="north"==o?"south":"northeast"==o?"southeast":"northwest"==o?"southwest":o;break;case"west":o="east"==o?"west":o;break;case"east":o="west"==o?"east":o}return p(e,o,i,a,t,s,n,r)}function p(t,i,a,s,n,r,c,d){if(a){y.callout=i;var u=a.position();d&&(u=l(i,a),u||(u=a.position())),"east"===i||"west"===i?(u=l(i,a),r=o(r,e(t.target),s,n)):"northwest"===i||"northeast"===i||"southwest"===i||"southeast"===i?u=l(i,a):0>c?(u.left=s.width()/2-a.outerWidth()/2+c-5,u.left<=10&&(u.left=10)):(u.left=s.width()/2-a.outerWidth()/2+(c-r.left),s.width()-u.left<=20&&(u.left=s.width()-20)),u&&a.css(u)}return r}function h(t,i){var a=e(T),s=(a.width(),a.height(),y.callout&&!y.ajaxContent?c(t):{left:t.pageX+5,top:t.pageY+5});s=u(t,T,s,i),a.width()+parseInt(s.left)>this._windowWidth&&a.width(this._windowWidth-(parseInt(s.left)+50)),a.css(s)}function g(t,i,s){var n=e(this);D=e.extend({},L,"object"==typeof t&&t);var o=n.data("z-ztooltip");o?"show"===t?r(i,s,!0):"remove"===t&&d():(a(n),n.data("z-ztooltip",!0))}var f,v,C,y={},b=void 0,E=void 0,I=800,T=void 0,$=void 0,S=void 0,R=void 0,A=void 0,M=void 0,U=void 0,w=void 0,_=void 0,O=void 0,D={},N={northwest:"top",north:"top",northeast:"top",west:"left",east:"right",southwest:"bottom",south:"bottom",southeast:"bottom"},L={callout:"north",autohide:!0,mousetrack:!1,mouseEnter:!1,showShortcutKey:!0,contentType:"text",positionAlterable:!0,calloutHideMode:!1},W=void 0,x={north:function(e){return{left:e.pageX-e.tooltipWidth/2,top:e.pageY+(e.calloutHeight+e._OFFSET)}},west:function(e){return{left:e.pageX+(e.calloutWidth+e._OFFSET),top:e.pageY-e.tooltipHeight/2}},east:function(e){return{left:e.pageX-(e.calloutWidth+e._OFFSET)-e.tooltipWidth,top:e.pageY-e.tooltipHeight/2}},south:function(e){return{left:e.pageX-e.tooltipWidth/2,top:e.pageY-(e.calloutHeight+e._OFFSET)-e.tooltipHeight}},northeast:function(e){return{left:e.pageX-(e.tooltipWidth-(e.calloutWidth+e.calloutWidth/2)),top:e.pageY+e.calloutHeight+e._OFFSET}},northwest:function(e){return{left:e.pageX-(e.calloutWidth+e.calloutWidth/2),top:e.pageY+e.calloutHeight+e._OFFSET}},southwest:function(e){return{left:e.pageX-(e.calloutWidth+e.calloutWidth/2),top:e.pageY-(e.calloutHeight+e._OFFSET)-e.tooltipHeight}},southeast:function(e){return{left:e.pageX-(e.tooltipWidth-(e.calloutWidth+e.calloutWidth/2)),top:e.pageY-(e.calloutHeight+e._OFFSET)-e.tooltipHeight}},defaultFn:function(e){return x.north(e,e.calloutHeight,e.calloutWidth)}};e.fn.ztooltip=g});var $WC=$WC||{};$WC.template={},$WC.template.setResource=function(e){this.resource=e},$WC.template.replace=function(e,t,i){function a(e){return e.replace(/&#39;|&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}function s(e){e=a(""+e);var t={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};return e.replace(/[&><"']/g,function(e){return t[e]})}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){var t=e;if(n(t)){var i=t[1];return i=n(i)?i:[i],i=i.map(function(e){return s(e)}),t[1]=i,$WC.template.resource.getRealValue.apply($WC.template.resource,t)}return $WC.template.resource.getRealValue(t)}var o={};for(var l in t){var c=/^\$/.test(l);if(c){var d=r(t[l]);l=l.substring(1),o[l]=d}else o[l]="InSecureHTML"===i?t[l]:s(t[l])}var u=Object.keys(o).join("|"),m=new RegExp("{{("+u+")}}","g");return e.replace(m,function(e){return e=e.substring(2).slice(0,-2),o[e]})};var $WC=$WC||{};$WC.Cookie={set:function(e,t,i,a){var s="";a=a||"",i&&(s=new Date,s.setTime(s.getTime()+i),s=s.toUTCString()),document.cookie=e+"="+t+";expires="+s+";domain="+a+";path=/"},get:function(e){var t=document.cookie.indexOf(e);if(-1===t)return"";var i,a=document.cookie.length;return-1!==document.cookie.indexOf(";",t)&&(a=document.cookie.indexOf(";",t)),i=document.cookie.substring(t,a),i.split("=")[1]},remove:function(e,t){t=t||"",document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+t+";path=/"}};var $WC=$WC||{};$WC.DesktopNotification={},$WC.DesktopNotification.Notifications={},$WC.DesktopNotification.close=function(e){void 0!==$WC.DesktopNotification.Notifications[e]&&($WC.DesktopNotification.Notifications[e].notifyobj.close(),clearTimeout($WC.DesktopNotification.Notifications[e].timer),delete $WC.DesktopNotification.Notifications[e])},$WC.DesktopNotification.requestPermission=function(){"undefined"!=typeof Notification&&"default"===Notification.permission&&Notification.requestPermission()},$WC.DesktopNotification.show=function(){return function(e){if("undefined"!=typeof Notification&&"granted"===Notification.permission){if(e.checkownership&&e.checkownership.isOwner()===!1)return;e.tag=e.id,$WC.DesktopNotification.close(e.id),void 0===$WC.DesktopNotification.Notifications[e.id]&&($WC.DesktopNotification.Notifications[e.id]={});var t=new Notification(e.title,e);return $WC.DesktopNotification.Notifications[e.id].notifyobj=t,e.duration&&($WC.DesktopNotification.Notifications[e.id].timer=setTimeout(function(){$WC.DesktopNotification.close(e.id)},e.duration)),t.onclick=function(i){window.focus(),"function"==typeof e.onclick&&e.onclick.call(t,i),$WC.DesktopNotification.close(e.id)},t}}}();var $WC=$WC||{};$WC.NotificationOwner=function(e,t,i){function a(e){if(clearTimeout(l),l=setTimeout(a,4e3),i||e||n()||r()){var t=$WC.Cookie.get(m);if(t&&-1!==t.indexOf("_f")&&i!==!0)return;var s=p;i&&(s+="_f"),$WC.Cookie.set(m,s,1e4,h)}}function s(){var e=$WC.Cookie.get(m);return""===e?u:e===p||e===p+"_f"?c:d}function n(){return s()===c?!0:!1}function r(){return s()===u?!0:!1}function o(){clearTimeout(l),$WC.Cookie.remove(m,h)}var l,c=1,d=2,u=3,m="com_"+e+"_owner",p=""+(new Date).getTime(),h=t&&document.location.hostname.split(".").splice(1).join(".");return i=i||!1,a(),window.addEventListener("focus",a),{isOwner:n,clearOwnerSync:o}};var $WC=$WC||{};$WC.CustomMsg={msgobj:{},storeMsgObj:function(e){(e["brief.msg"]||e["btnindexvsdetails.msg"])&&($WC.CustomMsg.msgobj[e.chid]=$WC.CustomMsg.msgobj[e.chid]||{},$WC.CustomMsg.msgobj[e.chid][e.time]=e)},removeMsgObj:function(e){delete $WC.CustomMsg.msgobj[e]},getMsgObj:function(e,t,i){var a=e.closest("[chid]")||e;return $WC.CustomMsg.msgobj[t||a.getAttribute("chid")||e.closest("[data-chid]").getAttribute("data-chid")][i||a.getAttribute("time")||e.closest("[data-msgtime]").getAttribute("data-msgtime")]},getMsgObjFromParams:function(e,t){return $WC.CustomMsg.msgobj[e][t]},getTheme:function(e){var t=e["brief.msg"];return t?t.themeid:""}},$WC.CustomMsgUI={button:{text:{theme1:1,theme2:3,theme3:1,theme4:2,theme5:1,theme6:0,theme7:3,theme8:1,theme9:10,theme10:2}},getCustomMessageContent:function(e){var t=e["brief.msg"];return t?($WC.CustomMsg.storeMsgObj(e),['<div class="zcmsg_bx zcmsg_bx'+$WC.CustomMsg.getTheme(e)+'" chid="'+e.chid+'"  time="'+e.time+'" data-sendername="'+$WC.$CUtil.safeHTML(e.dname)+'" customcardmsg>',this.getThemeTemplateObj(e).getlayout(this.getThemeParamObj(e),e),"</div>"].join("")):""},getThemeParamObj:function(e){var t=e["brief.msg"];return{img:this.getThemeImageURL(e),desc:$WC.CMsgUtil.getDisplayContent(e),desctitle:e.msg?e.msg.trim():"",title:t.title?$WC.CMsgUtil.getMarkedDownContent(t.title):"",titletooltip:t.title?t.title:"",icon:t.icon,button:$WC.CustomMsgUI.getButtonHTML(e),chid:e.chid,time:e.time}},getThemeImageURL:function(e){var t=$WC.CustomMsg.getTheme(e),i=e["brief.msg"];return["1","2","4","7"].indexOf(t)>-1?i.thumbnail||i.img:i.img||i.thumbnail},getCustomMsgOverlayHTML:function(e){var t='<div class="zc_cstm_ovrly">';return $WC.CMsgUtil.isCustomMessage(e)&&(t+=$WC.CustomMsgTemplate.getOverlayCustomMsgHTML(e)),$WC.CMsgUtil.isCustomFormattedMsg(e)&&(t+=$WC.CMsgUtil.getFormattedMsgContent(e)),t+"</div>"},getThemeTemplateObj:function(e){return $WC.CustomMsgTemplate["theme_"+$WC.CustomMsg.getTheme(e)]},getButtonHTML:function(e,t,i){var a=e["brief.msg"],s=t?!0:!1;if(t=t||a.buttons,!t||!t.length)return"";{var n="",r=t.length;$WC.CustomMsg.getTheme(e)}btncount=s?5:$WC.CustomMsgUI.button.text["theme"+$WC.CustomMsg.getTheme(e)];for(var o=0;r>o;o++){var l=t[o],c=i?"primaryindex = PRIMARY_INDEX":"";if(o>=btncount){n+=this.constructBtnDropDown(t,e,c,btncount);break}n+=$WC.CustomMsgTemplate.getbutton(l,e,o)}return'<div class="zcntnbx"  '+c+">"+n+"</div>"},constructBtnDropDown:function(e,t,i,a){for(var s=e.length,n='<div class="zcmorebtn" custom_btn_click><em custom_btn_click></em><ul>',r=a;s>r;r++)n+="<li "+i+">"+$WC.CustomMsgTemplate.getbutton(e[r],t,r)+"</li>";return n+"</ul></div>"},handleMoreMessage:function(e){var t=e.target.getAttribute("custom_message"),i=document.getElementById("cardmainmessage");$WC.$CUtil.addClass(e.target,"zc_dN"),"show_more"===t?(i.style.height=parseInt(i.getAttribute("scrollHeight"))+30+"px",$WC.$CUtil.removeClass(document.querySelectorAll('[custom_message="show_less"]')[0],"zc_dN")):(i.style.height=parseInt(i.getAttribute("clientHeight"))+"px",$WC.$CUtil.removeClass(document.querySelectorAll('[custom_message="show_more"]')[0],"zc_dN"))},handleCustomBoxClick:function(e,t){if(!e.querySelectorAll("[nativewidget]").length){var i=$WC.CustomMsg.getMsgObj(e);return"custom_image_preview"===t.target.getAttribute("purpose")?void this.showOriginalImage(i["brief.msg"]):void("a"!==t.target.tagName.toLowerCase()&&$WC.$Win.create({id:"custommsg","class":"cmsgdlg",header:$WC.CMsgUtil.getBriefMsgTitle(i),html:$WC.CustomMsgUI.getCustomMsgOverlayHTML(i),additionalattrs:' chid="'+i.chid+'" time="'+i.time+'"'}))}},handleOverlayImage:function(e){var t=$WC.CustomMsg.getMsgObj(e),i=t?t["brief.msg"]:{img:e.getAttribute("src")};this.showOriginalImage(i)},showOriginalImage:function(e){$WC.$Win.create({id:"custommsgimgprev","class":"cmsgdlg cmsgprev",html:$WC.CustomMsgTemplate.getImagePreviewHTML(e)})}},$WC.CustomMsgTemplate={theme_0:{getlayout:function(e,t){var i="";return $WC.CMsgUtil.isCustomFormattedMsg(t)&&(i=$WC.CMsgUtil.getFormattedMsgContent(t)),['<div class="zcthm0ctr">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+e.title+"</div>":"",e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">','<div class="zcdesc">'+e.desc+"</div>","</div>",e.button,"</div>","<div>"+i+"</div>"].join("")}},theme_1:{getlayout:function(e){return[e.desc?'<div class="zcdesc"><div>'+e.desc+"</div></div>":"",'<div class="btncnt">',e.img?'<div class="zcimg"><img src="'+e.img+'" purpose="custom_image_preview" ></div>':"",e.title?'<div class="zctitle">'+(e.icon?'<img src="'+e.icon+'">':"")+'<div title="'+e.titletooltip+'">'+e.title+"</div></div>":"",e.button,"</div>"].join("")}},theme_2:{getlayout:function(e){return[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>",e.button,"</div>"].join("")}},theme_3:{getlayout:function(e){return['<div class="btncnt">',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>",e.button,"</div>"].join("")}},theme_4:{getlayout:function(e){return['<div class="btncnt">',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>","</div>",e.button].join("")}},theme_5:{getlayout:function(e){return[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.button,'<div class="btncnt">',"<div>",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>","</div>","</div>"].join("")}},theme_6:{getlayout:function(e){var t=e.title||"",i=e.img?"":"zcnobg";return['<div class="btncnt '+i+'" >',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",t?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+t+"</div>":"","</div>",'<div class="zcbtmbx">','<div class="zcdesc"><div class="ellips">'+e.desc+"</div></div>",e.button,"</div>"].join("")}},theme_7:{getlayout:function(e){return[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>","</div>",e.button].join("")}},theme_8:{getlayout:function(e){var t=e.desc;return t=t.replace(/(?:\r\n|\r|\n)/g,"<br />"),[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"","<div>",'<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+t+"</div></div>","</div>",e.button,"</div>"].join("")}},theme_9:{getlayout:function(e){var t=document.createElement("div");t.innerHTML=e.button;var i,a=t.querySelectorAll("[btnindex]");return a.length&&(i=a[a.length-1],t.querySelectorAll("[btnindex]:last-child")[0].remove()),['<div class="btncnt">',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div >'+e.desc+"</div>","</div>","</div>",t.innerHTML,'<div class="zcntrslut">'+(a.length?i.outerHTML:"")+"</div>"].join("")}},theme_10:{getlayout:function(e,t){var i="";return $WC.CMsgUtil.isCustomFormattedMsg(t)&&(i=$WC.CMsgUtil.getFormattedMsgContent(t)),[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>","</div>","<div>"+i+"</div>","<div>",e.button,"</div>"].join("")}},formatButton:function(e){return e.label?e:(e.text&&(e.label=e.text,delete e.text),e.click&&(e.action={},e.click["action.type"]&&(e.action.type=e.click["action.type"]),e.click["action.data"]&&(e.action.data=e.click["action.data"]),e.click["action.confirm"]&&(e.action.confirm=e.click["action.confirm"]),delete e.click),e)},getbutton:function(e,t,i){var a=t["btnindexvsdetails.msg"]?t["btnindexvsdetails.msg"][e]:e;if(a=this.formatButton(a),!a.action||!a.label)return"";var s=$WC.$CUtil.processXSS(a.label),n=a.hint?$WC.$CUtil.processXSS(a.hint):s,r="+"===a.type?"zcok":"-"===a.type?"zccancel":"";return['<a class="zcbtn '+r+'" title="'+n+'" chid="'+t.chid+'" time="'+t.time+'" custombuttonclick_onmsg index="'+i+'" btnindex="'+a.index+'" >','<input type="button" value="'+s+'">',"</a>"].join("")},getImagePreviewHTML:function(e){var t=e.img||e.thumbnail;return['<div class="cmsgimg">','<img src="'+t+'" />',"</div>"].join("")},getOverlayCustomMsgHTML:function(e){var t=e["brief.msg"],i=t.thumbnail||t.img,a=t.buttons,s=a&&a.length?"zccustmsg":"";return['<div class="msgbox zccard-bx '+s+'">','<div class="zccard">',i?'<img src="'+i+'" purpose="custom_image_preview" chid="'+e.chid+'" time="'+e.time+'"/>':"",'<div id="cardmainmessage" class="zccarddesc">'+$WC.CMsgUtil.getDisplayContent(e)+"</div>","</div>",$WC.CustomMsgUI.getButtonHTML(e,a),"</div>"].join("")},getBotSuggestionsContent:function(e){for(var t='<div botsuggestions class="zcbotsugg">',i=0;i<e.length;i++){var a=e[i],s=$WC.$CUtil.processXSS(a.text);t+='<div suggestionsclick_onmsg text="'+s+'" title="'+s+'">'+(a.icon?'<img src="'+a.icon+'">':"")+'<span class="font14 txtcent bold">'+s+"</span></div>"}return t+"</div>"}},void 0===Object.keys&&(Object.keys=function(e){var t=[];for(var i in e)t.push(i);return t}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var a=[],s=arguments.length>=2?arguments[1]:void 0,n=0;i>n;n++)if(n in t){var r=t[n];e.call(s,r,n,t)&&a.push(r)}return a}),Array.prototype.map||(Array.prototype.map=function(e,t){var i,a,s;if(null===this||void 0===this)throw new TypeError(" this is null or not defined");var n=Object(this),r=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(i=t),a=new Array(r),s=0;r>s;){var o,l;s in n&&(o=n[s],l=e.call(i,o,s,n),a[s]=l),s++}return a}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,a;if(null===this||void 0===this)throw new TypeError(" this is null or not defined");var s=Object(this),n=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(i=t),a=0;n>a;){var r;a in s&&(r=s[a],e.call(i,r,a,s)),a++}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("'this' is null or not defined");var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var a=arguments[1],s=0;i>s;){var n=t[s];if(e.call(a,n,s,t))return n;s++}return void 0}}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),i=t.length;--i>=0&&t.item(i)!==this;);return i>-1}),Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t.matches;){if(t.matches(e))return t;t=t.parentNode}return null}),Array.prototype.some||(Array.prototype.some=function(e){if(null==this)throw new TypeError("Array.prototype.some called on null");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),i=t.length>>>0,a=arguments.length>=2?arguments[1]:void 0,s=0;i>s;s++)if(s in t&&e.call(a,t[s],s,t))return!0;return!1});var $WC=$WC||{};$WC.CMsgUtil={UserMention:1,GroupMention:2,ChannelMention:3,BotMention:4,isCustomMessage:function(e){return e?!$WC.$CUtil.isEmptyObject(e["brief.msg"]):!1},isCustomFormattedMsg:function(e){return e?"undefined"!=typeof e["long.msg"]&&e["long.msg"].length>0:!1},getDisplayContent:function(e,t){var i=e.msg;return i?(i=i.trim(),i=this.getMarkedDownContent(i,t),$WC.Matcher.check("atmentiontemplate",i)&&(i=this.getDisplayableMention(e,i,'<span elemtype="{MENTIONELEMTYPE}" hover="true" uid="$1" class="hvrinfo" mentionedid="$1" {MENTIONATTRIBUTES}>$2</span>')),i):""},getDisplayableMention:function(e,t,i){var a="undefined"!=typeof e.ctype?parseInt(e.ctype):1,s=' mention_on="'+a+'"';return $WC.Matcher.replaceWithFlag("atmentiontemplate",t,"g",function(e,t,a,n){var r=n.split(":"),o=r[0].slice(1),l=r[1],c=parseInt(r[2]),d="";r=r.slice(3),r.pop();var u=$WC.$CUtil.decodeHTMLEntities(r.join(":"));if(u=$WC.$CUtil.processXSS(u),c===$WC.CMsgUtil.UserMention){var m="addchatmember"==o?"+":"deletechatmember"==o?"-":"@";u=m+u,d="user"}else c===$WC.CMsgUtil.GroupMention?(u="@"+u,d="group"):c===$WC.CMsgUtil.ChannelMention?d="channel":c===$WC.CMsgUtil.BotMention&&(u="@"+u,d="user");var p=s+' mentiontype="'+c+'"',h=i.replace(/{MENTIONATTRIBUTES}/g,p).replace(/{MENTIONELEMTYPE}/g,d).replace(/\$1/g,l).replace(/\$2/g,$WC.Matcher.replace("escapeReplacementString",u));return h})},getMarkedDownContent:function(e,t){if(e=e.trim(),e=Smiley.replace(e),e=this.trim(e),"function"==typeof $WC.$CUtil.getConfig("getSilentUserMention")&&(e=$WC.$CUtil.getConfig("getSilentUserMention")(e)),!t){for(var i=e.split(" "),a=[],s=0;s<i.length;s++){var n=i[s];n=this.convertLinks(n),n===i[s]&&(n=this.convertMailIds(n)),n=this.getSafeATagTarget(n),n=this.addAttributesToViewableImg(n),a.push(n)}e=a.join(" ")}return e},trim:function(e){return e=e.replace(/<p>/gi,"").replace(/<\/p>/gi,"").replace(/\n/gi,"<br>")},convertMailIds:function(e){return e=" "+e,e=$WC.Matcher.replaceWithFlag("mail",e,"gi"),e=e.trim()},convertHomographToText:function(e){var t=e;0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&(t="http://"+e);var i=document.createElement("a");i.href=t;var a=i.href.toLowerCase();return a===t.toLowerCase()||a===e.toLowerCase()+"/"||a===t.toLowerCase()+"/"?e:i.href},convertLinks:function(e){return e=" "+e,e=$WC.Matcher.replaceWithFlag("linkRegExp",e,"gi",function(t,i){return t!==e&&$WC.Matcher.check("invalidlink",$WC.$CUtil.decodeHTMLEntities(e))?t:"<a href='"+i+"' target='_blank'>"+i+"</a>"}),e=$WC.Matcher.replaceWithFlag("WWWlinkRegExp",e,"gi",function(t,i,a){return t!==e&&$WC.Matcher.check("invalidlink",$WC.$CUtil.decodeHTMLEntities(e))?t:i+"<a href='http://"+a+"' target='_blank'>"+a+"</a>"}),e=$WC.Matcher.replaceWithFlag("twoletterendinglink",e,"gi","$1<a href='http://$2' target='_blank'>$2</a>"),e=$WC.Matcher.replaceWithFlag("threeletterendinglink",e,"gi","$1<a href='http://$2' target='_blank'>$2</a>"),e=e.trim()},getSafeATagTarget:function(e){return $WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("a","href"),null,e,function(e,t,i,a,s,n,r,o){return 0===s.indexOf("mailto:")?e:t+s+r+' dataurl="'+$WC.$CUtil.processXSS(s)+'" '+o})},addAttributesToViewableImg:function(e){return $WC.Matcher.replacer($WC.Matcher.getRegexToAddAttrToHtmlTag("img"),null,e,'$1 documentclick="viewattachment" previewelem $3')},getFormattedMsgContent:function(e){function t(e){for(var t=e.data,i="",a=0;a<t.length;a++)i+="<li>"+$WC.CMsgUtil.getMarkedDownContent(""+t[a])+"</li>";return i}for(var i="",a=e["long.msg"],s=0;s<a.length;s++){var n=a[s],r=n.buttons,o=r&&r.length?"zccustmsg":"";if(i+='<div class="msgbox '+o+'" >',i+=n.title?'<div class="msgtitle ellips"><span class="subtitle">'+this.getMarkedDownContent(""+n.title)+"</span></div>":"","text"===n.type)i+=['<div class="cntmsgtxt">',"<div>"+this.getMarkedDownContent(n.data)+"</div>","</div>"].join("");else if("list"===n.type){var l="";n.styles&&(l=n.styles.type);var c=l?l:"non_type";i+=['<div class="msgcntbdy dIB">','<ul class="lst mrgL8 '+c+'">'+t(n)+"</ul>","</div>"].join("")}else if("table"===n.type){var d=[];n.styles&&n.styles.width&&(d=n.styles.width);var u=d.length?"tblefxed":"";i+='<div class="msgcntbdy dIB">',i+='<div class="msgtble"><div class="msgtblecnt '+u+'">';var m=n.data.rows,p=n.data.headers,d=[];n.styles&&n.styles.width&&(d=n.styles.width),i+='<div class="tblerow">';for(var h=0;h<p.length;h++){var g=d[h]?"style=width:"+d[h]+"%":"";i+='<div class="tblecel" '+g+">"+this.getMarkedDownContent(""+p[h])+"</div>"}if(i+="</div>",m)for(var f=0;f<m.length;f++){var v=m[f];i+='<div class="tblerow">';for(var C=0;C<v.length;C++)i+='<div class="tblecel">'+(v[C]?this.getMarkedDownContent(""+v[C]):"-")+"</div>";i+="</div>"}i+="</div></div></div>"}else if("images"===n.type){for(var y=$WC.$CUtil.getAspectRatioFit(n.data[0].width,n.data[0].height,300,200,!1),b="",E=0;E<n.data.length;E++){var I=n.data[E];b+='<img previewelem purpose=custom_image_preview style="height:'+y.height+'px; width: auto;" src="'+I.url+'" />'}i+='<div class="zcimgsldr" style="height:'+y.height+'px;">'+b+"</div>"}else if("image"===n.type){if($WC.$CUtil.isEmptyObject(n.data))continue;var T=n.data;i+='<div><img previewelem purpose=custom_image_preview style = "max-width:100%; width:'+(T.width?T.width+"px;":"100%;")+" height="+(T.height?T.height+"px;":"224px;")+'" src="'+n.url+'" /></div>'}else if("label"===n.type){i+='<div class="msgcntbdy dIB"><div class="msgtble"><div class="thmeslabcnt">';var $=n.styles,d="100%",S="";$&&(S=$.short?"short":"");for(var R=0;R<n.data.length;R++){var A=n.data[R];for(var M in A)i+='<div class="zclblpair '+S+'"><div class="zcmslble">'+this.getMarkedDownContent(M)+'</div><div class="zcmsnme">'+this.getMarkedDownContent(A[M])+"</div></div>"}i+="</div></div></div>"}i+=r?$WC.CustomMsgUI.getButtonHTML(e,r,!0):"",i+="</div>",i=i.replace(/PRIMARY_INDEX/g,s)}return i},handleButtons:function(e,t,i,a,s,n){var r=$WC.CustomMsg.getMsgObj(e,a,s);if(r){var o;if(r["btnindexvsdetails.msg"]){var l=e.getAttribute("btnindex");o=r["btnindexvsdetails.msg"][l]}else{var c=e.parentElement.getAttribute("primaryindex"),l=e.getAttribute("index"),d=c?r["long.msg"][c]:r["brief.msg"];o=d.buttons[l]}var u=o.action,m=u.data;if("undefined"!=typeof m){var p,h=u.type,g=u.confirm,a=r.chid,f=r.sender,s=r.time;if("undefined"!=typeof g&&(p=$WC.$CUtil.extend(!0,{},g),p.type="confirm"),"undefined"!==h)if("invoke.function"===h){if("undefined"!==m.name){var v=m.name;$WC.$Win.destroy("custommsg"),"undefined"!=typeof p?(p.btncallback=function(){"function"==typeof i&&i(v,a,s,e.getAttribute("btnindex"))},$WC.Widgets.construct(p)):"function"==typeof i&&i(v,a,s,e.getAttribute("btnindex"))}}else if("open.url"===h){if("undefined"!==m.web){var C=m.web;"undefined"!=typeof p?(p.btncallback=function(){window.open(C,"_blank")},$WC.Widgets.construct(p)):window.open(C,"_blank")}}else if("system.api"===h){var y=m.api;"undefined"!=typeof y&&(this.isClientTriggerSystemApi(y.split("/")[0])&&"function"==typeof $WC.$CUtil.getConfig("SystemApiHandler")?($WC.$Win.destroy("custommsg"),$WC.$CUtil.getConfig("SystemApiHandler")(y,{chid:a,sender:f})):this.triggerSystemAction(y,l,a,s,n,{buttonText:t.target.getAttribute("value")||t.target.text}))}}}},triggerSystemAction:function(e,t,i,a,s,n){var r="api="+e+"&chid="+i,o={index:t,chid:i,msgtime:a,isTempResponse:s};n&&(o.additionalparams=n),$WC.$CUtil.getConfig("ExecuteButtonResponseHandler")("handleStatusChange","loading"),$WC.Ajax.postRequestToChat("executesystemaction.do",r,function(e){$WC.CMsgUtil.handleActionResponse(e,this.opts.callbackargs)},function(e){$WC.CMsgUtil.handleActionResponse(e,this.opts.callbackargs)},o,!0)},handleActionResponse:function(e,t){if($WC.$CUtil.getConfig("ExecuteButtonResponseHandler")("handleStatusChange","complete"),e){{var i=t.chid;t.msgtime,t.index}if("banner"===e.type)"function"==typeof $WC.$CUtil.getConfig("ExecuteButtonResponseHandler")&&$WC.$CUtil.getConfig("ExecuteButtonResponseHandler")("handleSystemResponse",e,{chid:i});else if("function"==typeof $WC.$CUtil.getConfig("ExecuteButtonResponseHandler")){var a={chid:i,title:t.additionalparams?t.additionalparams.buttonText:""};$WC.$CUtil.getConfig("ExecuteButtonResponseHandler")("renderResponse",e,a)}}},isClientTriggerSystemApi:function(e){var t=["startchat","audiocall","videocall","videobroadcast","joinchannel","invite","userrecentchats","locationpermission"];return t.indexOf(e)>=0},getBriefMsgTitle:function(e){var t=e["brief.msg"];return"undefined"!=typeof t.title?(t.icon?'<img class="zcprvwicn" src="'+t.icon+'"/>':"")+this.getMarkedDownContent(t.title):""},getMsgObjVersion:function(e){return"undefined"!=typeof e.version?e.version:"v0"},getImageUrlFromId:function(e){return $WC.$CUtil.getConfig("CHATCONT")?"/"+$WC.$CUtil.getConfig("CHATCONT")+"/v1/images/"+e:"/v1/images/"+e},convertMsgObj:function(e){var t=$WC.CMsgUtil.getMsgObjVersion(e);switch(t){case"v0":var i=$WC.$CUtil.cloneObject(e),a=$WC.$CUtil.cloneObject(e),s=e.mtype?e.mtype:"12";switch(s){case"12":if("undefined"!=typeof i.meta){var n=i.meta.usermessagedetails;if("undefined"!=typeof n){var r={};"undefined"!=typeof n.custom_sender_name&&(r.name=n.custom_sender_name,"undefined"!=typeof n.hiddensender&&(r.hiddensender=n.hiddensender)),"undefined"!=typeof n.custom_sender_imageurl?r.img=n.custom_sender_imageurl:"undefined"!=typeof n.custom_sender_imageid&&(r.img=this.getImageUrlFromId(n.custom_sender_imageid)),"undefined"!=typeof n.custom_sender_id&&(r.id=n.custom_sender_id),"undefined"!=typeof i.meta.ms&&(r.ms=i.meta.ms),a["custom.sender"]=r;var o={};"undefined"!=typeof n.msg_title&&(o.title=n.msg_title),e.meta.usermessagedetails.custom_message&&"undefined"!=typeof i.msg&&(o.desc=i.msg),"undefined"!=typeof n.thumbnail_url?o.thumbnail=n.thumbnail_url:"undefined"!=typeof n.thumbnail_id?o.thumbnail=this.getImageUrlFromId(n.thumbnail_id):"undefined"!=typeof n.thumbnail_zuid&&(o.thumbnail=WmsContacts.getUserPhoto(n.thumbnail_zuid)),"undefined"!=typeof n.thumbnail_preview_url?o.img=n.thumbnail_preview_url:"undefined"!=typeof n.thumbnail_preview_id&&(o.img=this.getImageUrlFromId(n.thumbnail_preview_id)),"undefined"!=typeof n.icon_url&&(o.icon=n.icon_url),"undefined"!=typeof n.themeid&&(o.themeid=n.themeid),"undefined"!=typeof n.buttons&&(o.buttons=n.buttons),a["brief.msg"]=o}"undefined"!=typeof i.meta.formattedmsg&&(a["long.msg"]=$WC.$CUtil.cloneArray(i.meta.formattedmsg)),"undefined"!=typeof i.meta.config&&(a.config=$WC.$CUtil.cloneObject(i.meta.config)),"undefined"!=typeof i.meta.linkdetails&&(a.info={type:"unfurling",linkdetails:$WC.$CUtil.cloneObject(i.meta.linkdetails),quotedlink:i.meta.quotedlink}),"undefined"!=typeof i.meta.mentions&&(a.mentions=$WC.$CUtil.cloneObject(i.meta.mentions)),"undefined"!=typeof i.meta.btnindexvsdetails&&(a["btnindexvsdetails.msg"]=$WC.$CUtil.cloneObject(i.meta.btnindexvsdetails)),"undefined"!=typeof i.meta.opr_replydetails&&(a.isreply=!0,a.replied={info:$WC.$CUtil.cloneObject(i.meta.opr_replydetails)}),"undefined"!=typeof i.meta.message_source&&(a.message_source=i.meta.message_source),"undefined"!=typeof i.meta.native_widget&&(a.native_widget=i.meta.native_widget),delete a.meta}"undefined"!=typeof i.temp_info&&"undefined"!=typeof i.temp_info.suggestions&&(a.botSuggestions=$WC.$CUtil.cloneArray(i.temp_info.suggestions));break;case"16":a.info=$WC.$CUtil.cloneObject(i.msg,!0),delete a.msg,a.info.type="operations",$WC.$CUtil.isEmpty(a.info.opruser)||$WC.$CUtil.isEmptyObject(a.info.opruser)||(a.sender=a.info.opruser.zuid);break;case"20":"undefined"!=typeof i.meta&&"undefined"!=typeof i.meta.opr_replydetails&&(a.isreply=!0,a.replied={info:$WC.$CUtil.cloneObject(i.meta.opr_replydetails)},delete a.meta),a.info=$WC.$CUtil.cloneObject(i.msg,!0),delete a.msg,a.info.type="attachments",a.info.mod=i.mod,i.wmsfilesharingtype&&(a.info.wmsfilesharingtype=i.wmsfilesharingtype)}e=a,e.version="v1","undefined"!=typeof e.msgid&&(e.ack=e.msgid),e.id=e.time,delete e.msgid}return e}};var $WC=$WC||{},op=/opera|opera 5|opera\/5/i.test(navigator.userAgent),ie=!op&&/msie/i.test(navigator.userAgent);$WC.$CUtil={processXSS:function(e,t){return e?(t||(e=this.decodeHTMLEntities(e)),e.replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")):e},decodeHTMLEntities:function(e){return e.replace(/&#x2F;/g,"/").replace(/&#39;|&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},isEmpty:function(e){return void 0===e||null===e||""===e?!0:!1},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0&&JSON.stringify(e)===JSON.stringify({})},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},getObjectLength:function(e){if("object"==typeof e){if(Object&&Object.keys)return Object.keys(e).length;var t=0;for(var i in e)t++;return t}},getEventTarget:function(e){return ie?window.event.srcElement:e.target},getNextRotationalNode:function(e,t){return 39===t||40===t?e.nextSibling||e.parentNode.firstChild:37===t||38===t?e.previousSibling||e.parentNode.lastChild:void 0},center:function(e){if(e){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=e.offsetHeight,a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=e.offsetWidth,n=e.style,r=i>t?0:(t-i)/2,o=s>a?0:(a-s)/2;n.top=r+"px",n.left=o+"px"}},extend:function(){function e(e){return"function"==typeof e&&e.constructor===Function}function t(e){return e instanceof Array}function i(e){return"object"==typeof e&&e.constructor==Object}var a,s,n,r,o,l,c=arguments[0]||{},d=1,u=arguments.length,m=!1;for("boolean"==typeof c&&(m=c,c=arguments[d]||{},d++),"object"==typeof c||e(c)||(c={}),d===u&&(c=this,d--);u>d;d++)if(null!=(o=arguments[d]))for(r in o)a=c[r],n=o[r],c!==n&&(m&&n&&(i(n)||(s=t(n)))?(s?(s=!1,l=a&&t(a)?a:[]):l=a&&i(a)?a:{},c[r]=$WC.$CUtil.extend(m,l,n)):void 0!==n&&null!==n&&(c[r]=n));return c},removeAllClass:function(e,t){if(e){var i=e.querySelectorAll("."+t),a=i.length;if(a)for(var s=0;a>s;s++)$WC.$CUtil.removeClass(i[s],t)}},cloneObject:function(e,t){return t?$WC.$CUtil.extend(!0,{},e):$WC.$CUtil.extend({},e)},cloneArray:function(e){return e.slice(0)},getConfig:function(e){return this.globalconf?this.globalconf[e]:null},setConfig:function(e){if("object"==typeof e){this.globalconf||(this.globalconf={});for(var t in e)this.globalconf[t]=e[t];e.Resource&&($WC.Resource=e.Resource)}},getCSRF:function(){return $WC.$CUtil.getConfig("CHATCFPARAMNAME")+"="+$WC.Cookie.get($WC.$CUtil.getConfig("CHATCFCOOKIENAME"))},nocachefix:function(e){if(e)return"&nocache="+(new Date).getTime();var t="";return void 0!=$WC.$CUtil.getConfig("WMSCFPARAMNAME")&&(t="&"+$WC.$CUtil.getConfig("WMSCFPARAMNAME")+"="+$WC.Cookie.get($WC.$CUtil.getConfig("_WMSCFCOOKIENAME"))),t+="&nocache="+(new Date).getTime()},debounce:function(e,t,i,a){var s,n=0;return function(){var r=arguments,o=t||this;a===!0?(Date.now()-n>i&&e.apply(o,r),n=Date.now()):(clearTimeout(s),s=setTimeout(function(){e.apply(o,r)},i))}},addEvent:function(e,t,i,a,s){a="boolean"==typeof a?a:!0;var n=function(e){i.call(this,e,s)};return e.addEventListener?e.addEventListener(t,n,a):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n,n},getInnerText:function(e){if(e){var t=document.getElementsByTagName("body")[0];return t.textContent?e.textContent:e.innerText}},setInnerTextById:function(e,t){return $WC.$CUtil.setInnerText(document.getElementById(e),t)},setInnerText:function(e,t){if(e){var i=document.getElementsByTagName("body")[0];i.textContent?e.textContent=t:e.innerText=t}},sortBy:function(e,t,i){var a=i?function(t){return i(t[e])}:function(t){return t[e]};return t=t?-1:1,function(e,i){return e=a(e),i=a(i),t*((e>i)-(i>e))}},isEmptyString:function(e){return e&&e.trim().length>0?!1:!0},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},convertToArray:function(e){return Array.prototype.slice.call(e,0)},removeElement:function(e){return e?e.parentNode.removeChild(e):void 0},splitWmsFormattedString:function(e,t,i){var a=0;t-=1;for(var s=0;s<e.length;s++)if(":"==e.charAt(s)&&(a++,a==t)){var n=s;break}var r=e.substring(0,n),o=r.split(":"),l=e.substring(n+1);return o.push(i?JSON.parse(l):l),o},addClass:function(e,t){if(e.classList)e.classList.add(t);else{var i=e.className.split(" ");-1===i.indexOf(t)&&(e.className+=" "+t)}},unescapeHTML:function(e){return e?e.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&#x2F;/g,"/").replace(/&#x27;/g,"'"):void 0},removeClass:function(e,t){if(e.classList)e.classList.remove(t);else{var i=new RegExp("(?:^|\\s)"+t+"(?!\\S)");e.className=e.className.replace(i,"")}},safeHTML:function(e){var t={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};return(""+e).replace(/[&><"']/g,function(e){return t[e]})},getContactName:function(e,t,i){var a=t;return(null==e||void 0==e)&&(a=t),$WC.$CUtil.isZuid(e)||(a=t),t||$WC.$CUtil.getConfig("zuid")!=e||(a=$WC.$CUtil.getConfig("Resource").getRealValue("chat.you")),void 0!=WmsContacts.contactslist[e]?a=WmsContacts.contactslist[e].DNAME||WmsContacts.contactslist[e].EMAILID:WmsOrgContacts.contactslist[e]&&(a=WmsOrgContacts.contactslist[e].DNAME),i?$WC.$CUtil.safeHTML(a):a},formatMentions:function(e){var t=function(t,i){e=$WC.Matcher.replace(t,e,function(e,t,a){var s=a.split(":")[1],n=a.split(":")[3],r=$WC.$CUtil.getConfig("zuid")==s?$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML($WC.$CUtil.getConfig("dname"))):$WC.$CUtil.getContactName(s,n,!0);return i+r})};return t("atmention_for_transcript","@"),t("addmember_for_transcript","+"),t("deletemember_for_transcript","-"),e},getConditionalNextNode:function(e,t,i){function a(t,i){if(e[i]){if(e[i].getAttribute(t))return e[i];for(var a=e[i];a;){if(a.getAttribute(t))return a;a=a[i]}}var s=e.parentNode.querySelectorAll("["+t+"]");if(s&&s.length>1){if("nextSibling"===i)return s[0];if("previousSibling"===i)return s[s.length-1]}return e}return 39===t||40===t?a(i,"nextSibling"):37===t||38===t?a(i,"previousSibling"):void 0},removeEvent:function(e,t,i){e.detachEvent?e.detachEvent("on"+t,i):e.removeEventListener?e.removeEventListener(t,i,!0):e["on"+t]=null},loadImageWithDebounce:function(e){return $WC.$CUtil.debounce(function(){$WC.$CUtil.loadOriginalImage(e)},null,100)},loadOriginalImage:function(e,t,i){function a(){if(this.existingnode&&this.existingnode.parentNode&&(!t||this.existingnode.getAttribute("data-imgid")===this.getAttribute("data-zcprofileid"))){t?this.existingnode.parentNode.insertBefore(this,this.existingnode.parentNode.firstChild):this.existingnode.parentNode.appendChild(this);var e=this;setTimeout(function(){e.style.opacity="1",e.existingnode.removeAttribute("data-originalsrc"),t&&$WC.$CUtil.removeElement(e.existingnode)},20)}$WC.$CUtil.logLazyLoadedImages(this.getAttribute("data-zcprofileid"))}var s=e.querySelectorAll("div[data-originalsrc]");for(var n in s)if(s.hasOwnProperty(n)&&(i||$WC.$CUtil.isScrolledIntoView(s[n],e,!0))){var r=s[n],o=new Image;o.setAttribute("data-zcprofileid",r.getAttribute("data-imgid")),o.className="wms_userphoto_trans",o.existingnode=r,o.onload=a,o.src=r.getAttribute("data-originalsrc")}},loadedImages:{},logLazyLoadedImages:function(e){$WC.$CUtil.loadedImages[e]=!0},isImageLazyLoaded:function(e){return $WC.$CUtil.loadedImages[e]},bringElemToView:function(e,t,i){i?$WC.$CUtil.isViewableInScroll(e,!0)===!1&&(t===WmsConstants.KEYCODES.LEFT?e.parentNode.scrollLeft=e.offsetLeft:t===WmsConstants.KEYCODES.RIGHT&&(e.parentNode.scrollLeft=e.offsetLeft+e.offsetWidth-e.parentNode.offsetWidth)):$WC.$CUtil.isViewableInScroll(e)===!1&&(38===t||37===t||39===t?e.parentNode.scrollTop=e.offsetTop:40===t&&(e.parentNode.scrollTop=e.offsetTop+e.offsetHeight-e.parentNode.offsetHeight))},isViewableInScroll:function(e,t){if(t){var i=e.parentNode.scrollLeft,a=e.parentNode.scrollLeft+e.parentNode.offsetWidth,s=e.offsetLeft+e.offsetWidth;if(e.offsetLeft>=i&&a>s)return!0}else{var n=e.parentNode.scrollTop,r=e.parentNode.scrollTop+e.parentNode.offsetHeight,o=e.offsetTop+e.offsetHeight;if(e.offsetTop>=n&&r>o)return!0}return!1},isScrolledIntoView:function(e,t,i){var a=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom,n=e.getBoundingClientRect().top,r=e.getBoundingClientRect().bottom;return 0===a&&0===s||0===n&&0===r?!1:i?r>=a&&s>=n:n>=a&&s>=r},isZuid:function(e){return!isNaN(e)},preventHandlingTabUpDownEnter:function(e){(e.keyCode===WmsConstants.KEYCODES.DOWN||e.keyCode===WmsConstants.KEYCODES.UP||e.keyCode===WmsConstants.KEYCODES.ENTER||e.keyCode===WmsConstants.KEYCODES.TAB)&&e.preventDefault()},hasClass:function(e,t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)},hasFocus:function(e){return e?e===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(e.type||e.href||~e.tabIndex):void 0},getAttribute:function(e,t){return e&&"function"==typeof e.getAttribute?e.getAttribute(t):void 0},setAttribute:function(e,t,i){return e&&"function"==typeof e.getAttribute?e.setAttribute(t,i):void 0},getDirectText:function(e){for(var t=e.firstChild,i=[];t;)3==t.nodeType&&i.push(t.data),t=t.nextSibling;return i.join("")},getDirectTextFromHtmlString:function(e){var t=document.createElement("div");t.innerHTML=e;for(var i=t.firstChild,a=[];i;)a.push(3==i.nodeType?i.data:i.textContent),i=i.nextSibling;return a.join("")},createOverlay:function(e){if(null==document.getElementById("wms-overlay")){var t=document.createElement("div");t.id="wms-overlay",t.className="wms-overlay",t.onclick=e,t.style.zIndex=$WC.$CUtil.getConfig("zindex");var i=document.getElementById("wmstoolbar");i?document.body.insertBefore(t,i.nextSibling):document.body.appendChild(t)}},removeOverlay:function(){var e=document.getElementById("wms-overlay");e&&e.parentNode.removeChild(e)},removeElementFromArray:function(e,t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},getAspectRatioFit:function(e,t,i,a,s){var n=[i/e,a/t];return n=Math.min(n[0],n[1]),!s&&n>1?{width:e,height:t}:{width:e*n,height:t*n,ratio:n}},getBrowserName:function(){var e=navigator.userAgent.toLowerCase();return $WC.Matcher.check("firefox_useragent_lowercase",e)?"firefox":$WC.Matcher.check("opera_useragent_lowercase",e)?"opera":$WC.Matcher.check("chrome_useragent_lowercase",e)?"chrome":$WC.Matcher.check("safari_useragent_lowercase",e)?"safari":$WC.Matcher.check("ie_useragent_lowercase",e)?"ie":void 0},isChrome:function(){return"chrome"===this.getBrowserName()},isFirefox:function(){return"firefox"===this.getBrowserName()},isSafari:function(){return"safari"===this.getBrowserName()},isIEVersion11:function(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("trident/")>0){var t=e.indexOf("rv:"),i=e.substring(t+3,e.indexOf(".",t));return"11"==i}},checkAndUpdateLocationPermissionStatus:function(){"undefined"!=typeof navigator&&void 0!==navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then(function(e){$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE=e.state,e.onchange=function(){$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE=e.state}})},chatTypes:{CHANNEL:1,DEFAULT_BOT:"B1",CUSTOM_BOT:"B2"},getChatType:function(e){var t=e.split("_",3);if(3==t.length){var i=t[2],a=i.split("-",2);if(2==a.length)return"C4"==a[1]?$WC.$CUtil.chatTypes.CHANNEL:a[1];if(1==a.length)return $WC.$CUtil.chatTypes.CHANNEL}},isChannelChid:function(e){return $WC.$CUtil.getChatType(e)===$WC.$CUtil.chatTypes.CHANNEL},isBotChid:function(e){var t=$WC.$CUtil.getChatType(e);return t===$WC.$CUtil.chatTypes.DEFAULT_BOT||t===$WC.$CUtil.chatTypes.CUSTOM_BOT},isCustomBot:function(e){var t=$WC.$CUtil.getChatType(e);return t===$WC.$CUtil.chatTypes.CUSTOM_BOT}},$WC.$CUtil.pubsub={},function(e){var t={},i=-1;e.subscribe=function(e,a){t[e]||(t[e]=[]);var s=(++i).toString();return t[e].push({token:s,func:a}),s},e.publish=function(){var e=arguments,i=e[0];return t[i]?(setTimeout(function(){for(var a=t[i],s=a?a.length:0;s--;)a[s].func.apply(null,e)},0),!0):!1},e.unsubscribe=function(e){for(var i in t)if(t[i])for(var a=0,s=t[i].length;s>a;a++)if(t[i][a].token===e)return t[i].splice(a,1),e;return!1}}($WC.$CUtil.pubsub);var $WC=$WC||{};$WC.VirtualList=function(e){function t(){if(Date.now()-u>100)for(var e=this.container.querySelectorAll('[data-rm="1"]'),t=0,i=e.length;i>t;t++)this.container.removeChild(e[t])}var i=e&&e.w+"px"||"100%",a=e&&e.h+"px"||"100%",s=this.itemHeight=e.itemHeight;this.excessHeightObj={},this.items=e.items,this.generatorFn=e.generatorFn,this.hoverFunction=e.hoverFunction,this.totalRows=e.totalRows||e.items&&e.items.length;var n=$WC.VirtualList.createScroller(s*this.totalRows);this.container=e.container?e.container:$WC.VirtualList.createContainer(i,a),this.container.appendChild(n);var r=Math.ceil(e.h/s);if(this.cachedItemsLen=4*r,0!=this.container.scrollTop){var o=parseInt(this.container.scrollTop/s)-r;o=0>o?Math.ceil(this.container.scrollTop/s):o,this.container.scrollTop=o*s,this._renderChunk(this.container,o)}else this._renderChunk(this.container,0);var l,c=this,d=r*s,u=0;this.onScroll=function(e){var i=e.target.scrollTop,a=c.container.querySelector("[data-id]");if(!l||a.getAttribute("data-select")&&0!=a.getAttribute("data-rc")||Math.abs(i-l)>d){var n=c.container.querySelector("[data-select]"),o=parseInt(i/s)-r;c._renderChunk(c.container,0>o?0:o),n=n?c.container.querySelector('[data-rc="'+n.getAttribute("data-rc")+'"]:not([data-rm])'):"",n&&c.hoverFunction(n),l=i}u=Date.now(),e.preventDefault&&e.preventDefault(),null==c.rmNodeInterval&&(c.rmNodeInterval=setInterval(t.bind(c),300)),$WC.$CUtil.debounce(function(){clearInterval(c.rmNodeInterval),c.rmNodeInterval=null},c,1e3)},this.clearRmNodeInterval=$WC.$CUtil.debounce(function(){clearInterval(this.rmNodeInterval),this.rmNodeInterval=null},this,1e3),this.remove_event_listeners=function(){this.container.removeEventListener("scroll",this.onScroll),this.container.removeEventListener("scroll",this.clearRmNodeInterval)},this.container.addEventListener("scroll",this.onScroll),this.container.addEventListener("scroll",this.clearRmNodeInterval)},$WC.VirtualList.prototype.createRow=function(e){var t;if(this.generatorFn)t=this.generatorFn(e);else if(this.items)if("string"==typeof this.items[e]){var i=document.createTextNode(this.items[e]);t=document.createElement("div"),t.style.height=this.itemHeight+"px",t.appendChild(i)}else t=this.items[e];$WC.$CUtil.isArray(t)&&(this.excessHeightObj[e]=t[1],t=t[0]);var a=0;for(var s in this.excessHeightObj)e>s&&(a+=this.excessHeightObj[s]);return t.style.position="absolute",t.style.top=e*this.itemHeight+a+"px",$WC.$CUtil.setAttribute(t,"data-rc",e),t},$WC.VirtualList.prototype._renderChunk=function(e,t){var i=t+this.cachedItemsLen;i>this.totalRows&&(i=this.totalRows);for(var a=document.createDocumentFragment(),s=t;i>s;s++)a.appendChild(this.createRow(s));for(var n=1,r=e.childNodes.length;r>n;n++)e.childNodes[n].style.display="none",e.childNodes[n].setAttribute("data-rm","1");e.appendChild(a)},$WC.VirtualList.createContainer=function(e,t){var i=document.createElement("div");return i.style.width=e,i.style.height=t,i.style.overflow="auto",i.style.position="relative",i.style.padding=0,i.style.border="1px solid black",i},$WC.VirtualList.createScroller=function(e){var t=document.createElement("div");return t.style.opacity=0,t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="1px",t.style.height=e+"px",t};var Modules,MActions;Modules={Messaging:"messaging",Channels:"channels",OrgChannels:"org_channels",TeamChannels:"team_channels",PrivateChannels:"private_channels",ExternalChannels:"external_channels",PrivateConv:"private_conversation",DirectMessage:"direct_message",Integrations:"integrations",Commands:"commands",Bots:"bots",Functions:"functions",MessageActions:"message_actions",Schedulers:"schedulers",PlatformStorages:"platform_storage",Applications:"applications",ChannelWebhooks:"channel_webhooks",Media:"media",PrimeTime:"primetime",AudioCall:"audio_call",VideoCall:"video_call",ScreenSharing:"screen_sharing",AudioConference:"audio_conference",VideoConference:"video_conference",Events:"events",Reminders:"reminders",Taz:"taz",Apps:"apps",SlackMigration:"slack_migration",HipchatMigration:"hipchat_migration",StarredMessages:"starred_message",PTScreenShare:"pt_screen_share",PTSimulcast:"pt_simulcast",PTStreaming:"pt_streaming",MessageOptions:"message_options",MessageContextParser:"message_context_parser",HamBurger:"hamburger",ShowTime:"show_time",FileViewer:"file_viewer",DarkMode:"dark_mode"},MActions={Create:"create",Edit:"edit",Delete:"delete",Install:"install",ViewParticipants:"participants"};var SecurityManager;SecurityManager=function(){var e={},t={},i=function(t,i){var a=!0;if(e[t]){var s=e[t];a=s.status?"enabled"===s.status:a,a=!$WC.$CUtil.isEmpty(i)&&s.actions&&s.actions[i]?a&&"enabled"==s.actions[i]:a}return a},a=function(e,t){return i(e,t)},s=function(e){return"function"==typeof t[e]},n=function(e,i){t[e]=i},r=function(t){for(var i in t){var a={};a.status=t[i].status,t[i].actions&&(a.actions=t[i].actions),e[i]=a}},o=function(t){for(var i in t){e[i].status=t[i].status,t[i].actions&&(e[i].actions=t[i].actions)}l(t)},l=function(e){for(var i in e)s(i)&&t[i]()},c=function(e){return!$WC.$CUtil.isEmpty(e)&&!$WC.$CUtil.isEmpty(e.code)&&(e.code.startsWith($EC.CS_DISABLED_BY_ADMIN)||e.code.startsWith($EC.CS_ACTION_DISABLED_BY_ADMIN))},d=function(e){Clickoutside.clear("actionforbidden"),$WC.$Win.isExist("actionforbidden")&&$WC.$Win.destroy("actionforbidden"),$WC.$Dlg.create({id:"actionforbidden",version:2,"class":"zcdalogbx zcbg_mask alert_dialog hidecloseicon",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-unsbsrbeimg clr-red f40"></div>',header:Resource.getRealValue("module.access.restricted")}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[$WC.$CUtil.isEmpty(e)||$WC.$CUtil.isEmpty(e.message)?Resource.getRealValue("module.disabled.common"):e.message]}),buttons:[{text:Resource.getRealValue("common.reload"),colour:$WC.$Dlg.RED_BUTTON,action:function(){location.reload()}}]}),Clickoutside.bind({destid:"actionforbidden"})};return{init:r,hasPermission:i,verify:a,register:n,update:o,isSecurityError:c,handleError:d}}(),SecurityManager.init($zcg._FEATURECONFIG),_initGlobals=function(){$zcg._USERFULLNAME&&($zcg._USERFULLNAME=$WC.$CUtil.decodeHTMLEntities($zcg._USERFULLNAME)),$zcg._INITIALISATIONCHECKLIST=[],$zcg._CONNECTED=!1,$zcg._OPERA=-1!=navigator.userAgent.indexOf("Opera"),$zcg._IE9=!$zcg._OPERA&&/msie 9/i.test(navigator.userAgent),$zcg._SAFARI=-1!=navigator.userAgent.indexOf("Safari"),$zcg._USERIDLETIME=9e5,$zcg.NO_OPERATIONCHAT=$zcg.SYSTEM_CHAT=9,$zcg.TAZ_BOTTYPE=2,$zcg.CUSTOM_BOTTYPE=3,$zcg.ENTITYCHAT=10,$zcg.OFFLINE=0,$zcg.CHAT=1,$zcg.ORGCHANNEL=8,$zcg.PEX_MOBILE=3,$zcg._SERVERSYNCTIMEDIFF=0,$zcg.ONLINE=1,$zcg.CON_INVISIBLE=2,$zcg.CON_BUSY=3,$zcg.CON_IDLE=4,$zcg.CON_REQACC=-3,$zcg.CON_UNAPRD=-1,$zcg.CON_REJECT=-2,$zcg.CON_DELETE=-4,$zcg.CON_REMOVE=-5,$zcg.CON_REMIND_ME_LATER=-6,$zcg.CON_TO_BE_INVITED=-7,$zcg.NO_CHAT=-10,$zcg.NFY_USER_TYPING=104,$zcg.NFY_USER_IDLE=105,$zcg.NFY_USER_ENTERED=110,$zcg.NFY_ENDLIVESUPPORT=113,$zcg.GUEST_BLOCK=0,$zcg.GUEST_ALLOW=1,$zcg.CT_NFY_LIVESUPPORT=4,$zcg.CT_NFY_ZOHOGROUP=5,$zcg.CT_NFY_MULTIPROTOCOL=6,$zcg.INVALIDNAMECHARS='< > "" @ #',$zcg.JSON_EXCEPTION_HEADER="X-XHR-exception",$zcg.CSRF_HEADER="X-ZCSRF-TOKEN",$zcg.GEO_LOCATION_HEADER="X-Geo-Location",$zcg.TRIAL_EXECUTION_HEADER="X-Trial-Execute",$zcg.SID_HEADER="X-SID",$zcg.CONSENTS_VERSION_HEADER="X-Consents-Version",$zcg.BACKSPACE_KEYCODE=8,$zcg.TAB_KEYCODE=9,$zcg.ENTER_KEYCODE=13,$zcg.SHIFT_KEYCODE=16,$zcg.CTRL_KEYCODE=17,$zcg.ALT_KEYCODE=18,$zcg.ESCAPE_KEYCODE=27,$zcg.SPACE_KEYCODE=32,$zcg.LEFT_KEYCODE=37,$zcg.UP_KEYCODE=38,$zcg.RIGHT_KEYCODE=39,$zcg.DOWN_KEYCODE=40,$zcg.DELETE_KEYCODE=46,$zcg.COMMA_KEYCODE=188,$zcg._HTTP="http://",$zcg._HTTPS="https://",$zcg._YOUTUBELINK=$zcg._HTTPS+"www.youtube.com",$zcg._YOUTUBEEMBEDLINK=$zcg._HTTPS+"youtu.be",$zcg._MOUSECLICKEVENT="mouseclick",$zcg._ESCEVENT="escape",$zcg._SERVERURL=window.location.protocol+"//"+window.location.host,$zcg.WMS_DISCONNECT_TIME=-1,$zcg.LOCATION_INFO={},$zcg.UDS_CLIQ_SERVICE="CLIQ",$zcg._RECONNECTION_DEBUG_TIMER="",$zcg._UNAUTHORIZED_HTTP_STATUS_CODE=401,$zcg._RELOGINURL=$zcg._ACCOUNTSURL+"/signin?servicename="+$zcg._SERVICENAME+"&serviceurl="+($WC.$CUtil.isEmpty($zcg._CUSTOMDOMAINURL)?"/index.do":window.location.protocol+"//"+$zcg._CUSTOMDOMAINURL)+"&LOGIN_ID="+encodeURIComponent($zcg._EMAILID),$zcg._UNREADFAVICONURL="",$zcg.DELETE_MTYPE=63,$zcg.EDIT_MTYPE=64,$zcg.DELETED_STATUS=1,$zcg.EDIT_INFO=65,$zcg.TEXT_MTYPE=12,$zcg.ATTACHMENT_MTYPE=20,$Util.isMacOs()&&($zcg.COMMAND_LEFT_KEYCODE=$Util.Browser.isFirefox()?224:91,$zcg.COMMAND_RIGHT_KEYCODE=$Util.Browser.isFirefox()?224:93),$zcg.dragtimer="",$zcg._QUOTECOOKIE="QUOTECOOKIE",$zcg.LOADINGPAGETIME=1e4,$zcg.ORIGINALIMG_LOAD_TIMEOUT=250,$zcg.hasOwnProperty("settings")&&(Settings.init(JSON.parse($zcg.settings)),delete $zcg.settings,$zcg.hasOwnProperty("wmssettings")&&(Settings.updateInObj(JSON.parse($zcg.wmssettings)),delete $zcg.wmssettings)),$zcg.CANCELEVENT=!1,$zcg.videoelement,delete window.zcg,_zcDebugger={},$WC.template.setResource(Resource)},_clearTicket=function(){$ZCAjx.ajax({url:"/cleariamcache.do"})},_isAdmin=function(){return"true"===$zcg._ISADMIN},_getAppAccountId=function(){return $zcg._APPACCOUNTID},_isAppAccountMember=function(){return"null"!==$zcg._APPACCOUNTID},_isAppAccountAdmin=function(){return"true"===$zcg._ISAPPACCOUNTADMIN},_isOrgUser=function(){return"true"===$zcg._ISORGUSER},_nullifyHashChange=function(){window.location.hash=""},_initialize=function(){_WMSCONT="_wms",WmsLite.setNoDomainChange(),WmsLite.setConfig($zcg._WMSCONFIG),UI.init(),_handleLoadingPage(),$zcg._WINFOCUS=!0},_handleLoadingPage=function(){$zcg._LOADINGTIMER=setTimeout(function(){UI.handleLoadingPage(),"undefined"!=typeof DesktopApp&&DesktopApp.onload()},$zcg.LOADINGPAGETIME)},_doChangesIfInitialised=function(e){if(-1===$zcg._INITIALISATIONCHECKLIST.indexOf(e)){$zcg._INITIALISATIONCHECKLIST.push(e);var t=4;_isOrgUser()||t--,$zcg._INITIALISATIONCHECKLIST.length===t&&(clearTimeout($zcg._LOADINGTIMER),delete $zcg._LOADINGTIMER,UI.handleLoadingPage(),"undefined"!=typeof DesktopApp&&DesktopApp.onload())}},_checkAndLogout=function(){_isDesktopApp()&&$ZCAjx.ajax({url:"/checkloginstatus.do",success:function(e){"false"==e.loginstatus&&_logout()}})},_logout=function(e){$ZCVideoBroadcast.handleLogout(),e||(_clearTicket(),DesktopApp.clearSessionUser());try{var t=newurl=window.location.href;t.indexOf("#")>-1&&(newurl=window.location.href.substring(0,window.location.href.indexOf("#"))),"undefined"!=typeof DesktopApp?DesktopApp.logout($zcg._LOGOUTLINK):e?window.location.href=$zcg._RELOGINURL:setTimeout(function(){return window.location.href=newurl,!0},3e3)}catch(i){"undefined"!=typeof DesktopApp?DesktopApp.logout($zcg._LOGOUTLINK):e?window.location.href=$zcg._RELOGINURL:setTimeout(function(){return window.location.href=$zcg.locationurl,!0},3e3)}},InitRequestManager=function(){var e={},t=null,i=null,a=6e5,s=1e4,n=15e3,r=null,o=null,l=function(e){return o||(o={_highPriorityRequests:{"/getchannels.do":function(){ChannelsUI.List.load()},"/v1/commands":function(){Commands.sync()},"v1/calenders":function(){SecurityManager.hasPermission(Modules.Events)&&Events.getCalendars()},"Bots.initSyncTime":function(){Bots.initSyncTime()}},_lowPriorityRequests:{"/getmyunreadmentions.do":function(){Mentions.getUnread()},"/getlatestcomponents.do":function(){HomeUI.getAndpopulateLatestComponents()},"/getallnoti.do":function(){SecurityManager.hasPermission(Modules.Taz)||(Feeds.getNotificationCount(!0),Feeds.getUnreadFeeds())}},_onLoadLowPriorityRequests:{"/v1/orggroups":function(){Groups.loadMyOrgGroups()},"/v1/messageactions":function(){MessageActions.get()},"v2/integrations/people/channelrules":function(){ChannelsAdvRules.getAdvancedRules()}}}),o[e]},c=function(e){return l("_highPriorityRequests").hasOwnProperty(e)||l("_lowPriorityRequests").hasOwnProperty(e)||l("_onLoadLowPriorityRequests").hasOwnProperty(e)},d=function(e){$zcg._CONNECTED||(e||(ChatsList.removeallunreadchats(),HomeUI.reinit(),ChatUI.handleReconnection()),clearTimeout(t),t=setTimeout(function(){u(l("_highPriorityRequests")),t=null},$Util.getRandomNumber(1,s)),clearTimeout(i),i=setTimeout(function(){u(l("_lowPriorityRequests"))},$Util.getRandomNumber(s,n)),$zcg._CONNECTED=!0,IntegrationUI.componentsInitialised=!1)},u=function(e,t){if(!t){var i=Object.keys(e);i.forEach(function(t){"function"==typeof e[t]&&e[t]()})}},m=function(){$WC.$CUtil.isEmpty(t)||(clearTimeout(t),u(l("_highPriorityRequests")))},p=function(){clearTimeout(r),r=setTimeout(function(){u(l("_onLoadLowPriorityRequests"))},3e3)},h=function(){_print("serverup"," immediate reconnection ==>"+$zcg._CONNECTED+"===>"+new Date),$zcg._CONNECTED=!0,clearTimeout(t),clearTimeout(i),t=setTimeout(function(){u(l("_highPriorityRequests"),!0)},$Util.getRandomNumber(1,s)),i=setTimeout(function(){u(l("_lowPriorityRequests"),!0)},$Util.getRandomNumber(s,n))},g=function(){d(void 0,!0)},f=function(e){"undefined"!=typeof Commands._crcHandler&&Commands._crcHandler.markAsNotInSync(),$zcg.locationurl=window.location.href,UI.handleHashValue(),e?h():g(),UIDataPersist.restoreUI()},v=function(e,t){if("undefined"!=typeof e&&"undefined"!=typeof t){var i=Object.keys(e),a=Object.keys(t),s=!1,n=!0,r=i.every(function(e){return n=n&&-1!=a.indexOf(e)});return r&&(s=!0,i.forEach(function(i){if("nocache"!==i){var a="object"!=typeof e[i]?e[i]===t[i]:v(e[i],t[i]);s=s&&a}})),s}return"undefined"==typeof e&&"undefined"==typeof t?!0:!1},C=function(t){if(c(t.url)){if("/v1/commands"!==t.url&&"/v1/messageactions"!==t.url&&"undefined"!=typeof e[t.url]){var i=e[t.url],s=$Util.getSyncedCurrentTime(),n=s-i.time,r=v(t.data,i.data);return r&&n>a?(e[t.url]={data:t.data,time:$Util.getSyncedCurrentTime()},!1):r}return e[t.url]={data:t.data,time:$Util.getSyncedCurrentTime()},!1}return!1};return{handleReconnection:g,onInitialAndReregister:f,onLoad:d,checkAndMakeHighPriorityReqs:m,checkAndMakeOnLoadLowPriorityReqs:p,wasSentRecently:C}}(),_syncWithServerTime=function(e){"undefined"!=typeof e&&(e=parseInt(e),$zcg._SERVERSYNCTIMEDIFF=(new Date).getTime()-e)},_sendDebugMail=function(e,t,i){var a={expmsg:e,title:$WC.$CUtil.isEmpty(t)?"Exception Trace":t},s=$ZCAjx.formData(a,"files",i,!0);$ZCAjx.ajax({url:"/senddebugmail.do",type:"POST",data:s,processData:!1,contentType:!1})},_sendDebugMailforReconnectionFailure=function(e){var t=JSON.stringify(_zcDebugger.ajaxcalls,null,2),i="debugfile_"+$zcg._ZUID+".txt",a=[[new File([t],i),i]],s=e?0:6e4;clearTimeout($zcg._RECONNECTION_DEBUG_TIMER),$zcg._RECONNECTION_DEBUG_TIMER=setTimeout(function(){_sendDebugMail("Recent ajax request sent to Server before reconnection error","Reconnection failure",a)},s)},_isMobileAppEnabled=function(){return"true"===$zcg._MOBILEAPPENABLED},_isDesktopApp=function(){return"undefined"!=typeof DesktopApp},_isEventManagementEnabled=function(){return"true"===$zcg._ISEVENTMANAGEMENTENABLED},_checkAndUpdateLocationPermissionStatus=function(e){"undefined"!=typeof navigator&&"undefined"!=typeof navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then(function(t){$zcg.LOCATION_INFO.PERMISSIONSTATE=t.state,e&&(t.onchange=function(){$zcg.LOCATION_INFO.PERMISSIONSTATE=t.state})})},$(document).ready(function(){$DB.init(),_initGlobals(),_initialize(),$WC.$CUtil.isEmpty($zcg._CUSTOMDOMAINURL)||(WmsLite.useSameDomain(),WmsLite.useLongPolling()),WmsLite.registerZuid($zcg._PRD,$zcg._UNAME,$zcg.zuid,$zcg.silent),UI.initializeInTopbar(),$zcg._IE9||$(document).on("dragstart dragenter dragover dragleave drop",function(e){0===$(e.target).parents("#delugeEditorArea").length&&0===$(e.target).parents("#StoragesFieldsCreateUI").length&&e.preventDefault()}),UI.Theme.updateTheme(),$(document).ztooltip()}),$(window).load(function(){try{Smiley.isAnimatedSmileyEnabled()&&$("#officechat").addClass("sm_preloader"),$Util.isMacOs()&&$("body").addClass("mac-os"),$Util.isRetina()&&$("body").addClass("is-retina"),UI.onresize(),InitRequestManager.onLoad(!0),InitRequestManager.checkAndMakeHighPriorityReqs(),UI.loadDependancyFiles(),ChatNotify.checkAndEnableDNPermissionUI(),InitRequestManager.checkAndMakeOnLoadLowPriorityReqs()}catch(e){_sendDebugMail(""+e+e.stack)}$(window).resize(function(){UI.onresize()}),$(document).on("mouseenter","[documenthover]",function(){var e=$(this),t=this.getAttribute("documenthover"),i={calloptions:function(){e.parents("#chatwindows").hasClass("zcbroadsheet")?e.attr("title",MMChat.getCustomTitle(e.attr("data-hover"),"east")):e.attr("title",MMChat.getCustomTitle(e.attr("data-hover"),"south"))},closeptions:function(){e.attr("title",MMChat.getCustomTitle(e.attr("data-hover"),"south"))},muteoptions:function(){e.attr("title",MMChat.getCustomTitle(e.attr("data-hover"),"south"))},customToolTip:function(){for(var t=e.attr("data-hover").split("."),i=window,a=0;a<t.length;a++)i=i[t[a]];var s="";i&&"function"==typeof i&&(s=i(e)),e.attr("title",s)}};t&&"function"==typeof i[t]&&i[t]()}),$(document).on("click","a",function(e){var t=this;if(!$WC.$CUtil.isEmpty(t.href)){var i=t.href.split(window.location.host)[1];!$WC.$CUtil.isEmpty(i)&&UI.handleNiceUrl(i.split("/"),!0)&&e.preventDefault()}}),document.addEventListener("error",function(e){var t=e.target,i=t.getAttribute("errorpurpose"),a={replymsgimg:function(e){var t=e.parentElement,i=e.getAttribute("extn");e.remove(),t.innerHTML+='<span class="zcftype posa font10 bold ellips">'+i+'</span><span class="msi-atchfle dIB"></span>'}};i&&"function"==typeof a[i]&&a[i](t)},!0),$(document).on("click","[documentclick]",function(e){var t=this,i=this.getAttribute("documentclick"),a={media:function(){e.stopPropagation(),MediaPlayer.handleClick(e,$(t))},viewattachment:function(){e.stopPropagation(),Chat.pauseAllMedia(),t=null!==t.getAttribute("previewelem")?t:$(t).find("[previewelem]"),ImgViewer.show(t)},attdownload:function(){e.stopPropagation(),UI.handleAttachmentOperations(e,t)},attforward:function(){e.stopPropagation(),UI.handleAttachmentOperations(e,t)},annotateimage:function(){e.stopPropagation(),UI.handleAttachmentOperations(e,t)},playlink:function(){e.stopPropagation(),UI.handleLinkAudioVideoPlay(t)},loadmoremsg:function(){Transcript.handleClickOnLoadMore(t)},viewprofileimage:function(){ImgViewer.show(t,!0)},attforward:function(){e.stopPropagation(),UI.handleAttachmentOperations(e,t)},mentionrow:function(){e.stopPropagation(),MentionsUI.viewormarkmention(t)},customstatus:function(){e.stopPropagation(),StatusUI.showCustomOptions()},logout:function(){UI.logout()},copyclipboard:function(){$Util.copyToClipboard($(t))},mark_offline_read:function(){HomeUI.markAsRead($(t))},clearevents:function(){e.stopPropagation(),Events.markEventAsSeen($(t).attr("eventid"))},sendattachment:function(){var e=$(t).parents('[purpose="chatview"]')[0].id;Composer.sendComposerTextAsAttachment(e)},messageoperations:function(){e.stopPropagation();var i=$(e.target).attr("purpose"),a=$(e.target).parents('[purpose="chatview"]')[0].id;$WC.$CUtil.isEmpty(i)||"function"!=typeof MessageOperations.handle[i]||(Clickoutside.handleClickOnChild(e),MessageOperations.handle[i](a,$(t),e),$(t).parent().removeClass("editmsgtour"))},resendoptions:function(){e.stopPropagation();var i=$(e.target).parents('[purpose="chatview"]')[0].id,a=$(e.target).attr("purpose");$WC.$CUtil.isEmpty(a)||"function"!=typeof MessageOperations.unsent[a]||(Clickoutside.handleClickOnChild(e),MessageOperations.unsent[a](i,t,e))},"user-profile-actions":function(){e.stopPropagation(),GSUI.handeUserProfileEvents($(t))},mark_allseen:function(){e.stopPropagation(),Clickoutside.handleClickOnChild(e),HomeUI.markandRemoveComponentAllSeen(t)},expandcomponentsview:function(){e.stopPropagation(),Clickoutside.handleClickOnChild(e),HomeUI.expandComponentView(t)},component_markseen:function(){e.stopPropagation(),Clickoutside.handleClickOnChild(e);var i="homeui_"+$(t).attr("id"),a=$(t).attr("type");HomeUI.markseenAndRemoveComponentDiv(i,a)},view_component:function(){e.stopPropagation(),Clickoutside.handleClickOnChild(e);var i=$(t).attr("elementcat"),a=$(t).attr("compid");HomeUI.markseenAndRemoveComponentDiv(a,i),"bots"===i?(IntegrationUI.init(Integration.Modules.Bots),$Util.scrollToView($("#"+a),$("#botslist"),200),BotsUI.handle.preview(a,t,e)):"commands"===i?(IntegrationUI.init(Integration.Modules.Commands),$Util.scrollToView($("#"+a),$("#commandslist"),200),CommandsUI.handle.preview(t,e,a)):"messageactions"===i&&(IntegrationUI.init(Integration.Modules.MessageActions),$Util.scrollToView($("#"+a),$("#messageactionslist"),200),MessageActionsUI.handle.preview(t,e,a))},subscribe_latestbot:function(){e.stopPropagation(),Clickoutside.handleClickOnChild(e);var i=$(t).attr("id");Bots.subscribe(i),HomeUI.markseenAndRemoveComponentDiv("homeui_"+i,"bots")},greet_msg:function(){var e,i=$(t).attr("chid"),a=ChatUI.exist[i],s=Participants.get(i);if(s.pcount>2||a.isChannel())e=Resource.getRealValue("common.hello.all")+" :smile:";else{var n=$WC.$CUtil.decodeHTMLEntities(Users.getName(s.getRecipientFor121Chat())),r=n.split(" ");n=r[0].length>1?r[0]:n,e=Resource.getRealValue("common.hello")+" "+n+" :smile:"}$("#chatinformation"+i).fadeOut(function(){$(this).remove()}),Chat.sendMessage(i,e)},checklist:function(){Settings.update({ob_checklist_later:0}),Tour.fadeOutAndRemove($("#onboardtour")),CheckList.populateOnbardingCheckListUI(),MainUI.getMefront("home",!0),$("#ztb-settings").trigger("click").find("#ztb-checklistcount").remove()},show_dn_permission:function(){ChatNotify.showBrowserPermissionPopUp()},close_dn_permission:function(){var e=(new Date).getTime()+2592e6;Settings.update({dnpopup_viewedtime:e}),$("#desktopnoti_popup").fadeOut(300,function(){$("#desktopnoti_popup").remove()})},reactions:function(){t=$(t);var i=t.attr("purpose");$WC.$CUtil.isEmpty(i)||"function"!=typeof Reactions.handle[i]||(Clickoutside.handleClickOnChild(e),Reactions.handle[i](t,e),e.stopPropagation())},cloud_tour:function(){t=$(t);var i=t.attr("chid"),a=t.next();a.addClass("vsble");var s=$WC.template.replace(Template.messageOperationTour,{name:Resource.getRealValue("common.attach.method.cloud")});a.find("[purpose=cloudatchmnt"+i+"]").addClass("touractive").html(s),CloudPickerUI.showTour(i),t.remove(),e.stopPropagation()}};i&&"function"==typeof a[i]&&a[i]()}),$(document).on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",function(){MediaPlayer.handleFullscreen($(this))}),$(document).on("click touchstart",function(e){$zcg.CANCELEVENT?$zcg.CANCELEVENT=!1:(Clickoutside.handleClick(e),MySelf.active())}),$(document).on("click",'[purpose="staroptions"]',function(e){e.stopImmediatePropagation(),StarMessagesUI.showStarOptions($(this),e)}),$(document).on("click",'[purpose="star"]',function(e){e.stopPropagation(),Clickoutside.handleClickOnChild(e),StarMessagesUI.starMessage($(this))}),$(document).on("click",'[purpose="unstar"]',function(e){e.stopPropagation(),Clickoutside.handleClickOnChild(e),StarMessagesUI.unstarMessage($(this))}),$(document).on("click",'[purpose="msghistory"]',function(){var e=$(this).attr("msguid"),t=$(this).parents("[uid]").attr("chid");MessageOperations.edit.showMsgHistoryUI(t,e)}),$(document).on("click","[custombuttonclick_onmsg],[zc-quickbutton]",function(e){e.stopPropagation();var t=$(this).parents("[chid]"),i=t.attr("chid"),a=t.attr("time")||t.attr("msgtime"),s=$("#"+i).find('[time="'+a+'"]'),n=!1;s.length>0&&(n=s[0].hasAttribute("integresponseelem")),$WC.CMsgUtil.handleButtons(this,e,function(t,i,a,s){Functions.execute(t,i,a,s,e)},i,a,n),GSUI.isNewSearchEnabled()&&GSUI.isNewSearchUIShown()&&GSUI.clearAndHideResults()}),$(document).on("click","[purpose='viewreplied']",function(e){$Util.viewRepliedMsg(e)}),$(document).on("click","[suggestionsclick_onmsg]",function(e){e.stopPropagation(),BotSuggestions.handleClick(this,e)}),$(document).on("click","div.zcmsg_bx:not(.zcmsg_bx0)",function(e){e.stopPropagation(),$WC.CustomMsgUI.handleCustomBoxClick(this,e)}),$(document).on("click",'img[purpose="custom_image_preview"]',function(e){e.stopPropagation();var t=e.target.src;if(!$WC.$CUtil.isEmpty(t)){var i={img:t};$WC.CustomMsgUI.showOriginalImage(i)}}),$(document).on("click","[custom_message]",function(e){e.stopPropagation(),$WC.CustomMsgUI.handleMoreMessage(e)}),$(document).on("mousedown",function(){HoverDetails.hide()}),$("#maskbg").on("click",function(e){$WC.$Win.handleOutsideClose(e)}),$(document).on("mousemove",function(){MySelf.active(),MMChat.handleMouseMove()}),$(document).on("change","input[type=checkbox]",function(e){$Util.CustomCheckbox.setStatus($(this),e.target.checked)}),$(document).on("change","input[type='radio']",function(e){$Dom.radio.listen(e)}),$(document).on("keydown",function(e){MySelf.active(),MMChat.isRunning&&MMChat.handleKeyDown(e)||KeyHandler.preventDefault(e)}),$(document).on("keyup",function(e){return $zcg.CANCELEVENT?($zcg.CANCELEVENT=!1,void MainUI.setCurrentWinFocus()):(KeyHandler.execute(e),void $(document).ztooltip("remove"))}),$(document).on("click","[hover='true']",function(e){e.stopPropagation(),HoverDetails.show(this)}),$(document).on("click","[code]",function(e){var t=$(this),a=t.closest("[callback]").attr("callback");if(a){var s=window;for(a=a.split("."),i=0;i<a.length;i++)s=s[a[i]];s(t,e)}}),_checkAndUpdateLocationPermissionStatus(!0)}),$(document).on("click","[infobutton]",function(e){e.stopPropagation();var t=$(this);InfoButtonActionsImpl.handler[t.attr("purpose")](t),WebMessanger.hideOnesearch()}),$(window).focus(function(){$zcg._WINFOCUS=!0,"undefined"!=typeof ChatNotify&&ChatNotify.clear(),"undefined"!=typeof ScreenShare&&$Util.Browser.isChrome()&&!ScreenShare.Extension.isInstalled()&&ScreenShare.Extension.isStoreOpened()&&ScreenShare.Extension.checkInstalledStatus()}),$(window).blur(function(){$zcg._WINFOCUS=!1}),$(window).on("hashchange",function(){UI.handleHashValue()}),$(window).on("unload",function(){MMChat.handleUnload(),Conference.handleUnload(),$ZCVideoBroadcast.handleUnload()}),$(window).on("message",function(e){var t=e.originalEvent.data;"ZOHOCLIQ-EXTENSION"===t.source&&"undefined"!=typeof ScreenShare.Extension&&ScreenShare.Extension.handleMessageEvent(e)}),function(e){function t(e){this.elem=e,u++}var i=8,a=46,s=13,n=27,r=37,o=38,l=39,c=40,d=9,u=0;t.prototype={init:function(t){this.config=e.extend(!0,{minChars:0,maxItems:10,type:"dropdown",matchingOrder:["startsWith","contains"],highlight:!0,placeholder:Resource.getRealValue("smiley.search"),sorting:!1,ignoreheader:!1,option_groups:!1,clickcallback:function(){},dropdownCallbacks:{show:function(){},hide:function(){}},noMatches:!0,noMatchesText:Resource.getRealValue("common.search.result.none")},t),t.matchingOrder&&(this.config.matchingOrder=t.matchingOrder),this._curvalue="",this.map=e.extend({title:"title",key:"key",desc:"desc"},t.map),this.createAutocomplete()},createAutocomplete:function(){this._elem=e(this.elem).addClass("drpdwn-wrp");var t=this._elem.html();if(this.config.ignoreheader||0!==this._elem.find("[data-auto-input]").length||(t+=b.header.call(this)),0===this._elem.find("[data-auto-result]").length&&(t+=b.dropdown.call(this)),this._elem.html(t),this._resultelem=this._elem.find("[data-auto-result]"),this._inputelem=this._elem.find("[data-auto-input]"),this._elem[0].id="autosrc"+u,this._resultelem[0].id="autodest"+u,this.checkAndAddOptionsSearch(),this.setEventListener(),this.config.selected)for(var i=this.config.selected,a=0;a<i.length;a++){var s=i[a];this.addSelectedAutocompleteNodes(s.key,s.title)}},setEventListener:function(){var t=this;e(t._elem[0]).on("click","[data-index]",function(e){t.handleListClick(this,e),C(e)}),e(t._elem[0]).on("click","[purpose]",function(i){var a=e(i.target),s=a.attr("purpose");"deleteSelectedNode"===s&&(C(i),e(i.target).parents("[key]").remove(),t.populateList(i))}),e(t._elem[0]).on("click",function(e){t._resultelem.is(":visible")||(C(e),t.handleDropDownClick(e),t._inputelem.hasClass("hide-caret")&&(t._inputelem.removeClass("hide-caret").focus(),t._elem.find("[data-selections]").find(".sel").removeClass("sel")))}),e(t._inputelem[0]).on("keydown",function(e){e.stopImmediatePropagation(),t.handleKeyDown(e)}),e(t._inputelem[0]).on("keyup",function(e){t.handleKeyUp(e)}),e(t._inputelem[0]).on("input",function(e){t.handleInputChange(e)}),e(t._inputelem[0]).on("focus",function(e){C(e),t._inputelem.hasClass("hide-caret")&&(t._inputelem.removeClass("hide-caret"),t._elem.find("[data-selections]").find(".sel").removeClass("sel")),t._resultelem.is(":visible")||t.populateList(e)})},requestMadeBefore:function(){return this.config.fetchMore&&this.config.fetchMore.previousSearches&&-1!==this.config.fetchMore.previousSearches.indexOf(this._curvalue)},moreMatchesInServer:function(){return this.config.fetchMore&&!this.requestMadeBefore()},getMatchingOrder:function(){this._curvalue;return this.config.fetchMore&&!this.requestMadeBefore()?["startsWith"]:this.config.matchingOrder},getMatchedOptionGroupsHTML:function(e,t){for(var i=[],a=this.getMatchingOrder(),s=0;s<a.length;s++)for(var n=a[s],r=0;r<e.length;r++){var o,l=e[r].label;if(e[r].options){if(s>0)continue;for(var c=e[r].options,d=0;d<a.length;d++)for(var u=a[d],m=0;m<c.length;m++)if(p.call(this,c[m],t,u)){var h="";if(o!==l){if("undefined"!=typeof o&&this.moreMatchesInServer()&&i.length<this.config.fetchMore.minResultsCount)break;h+=b.getHeaderLabel.call(this,l),o=l}h+=b.getList.call(this,c[m],i.length,"option-group-item"),i.push(h)}}else p.call(this,e[r],t,n)&&i.push(b.getList.call(this,e[r],i.length))}return i},getMatchedOptionsWithoutOptionGroups:function(e,t){for(var i=[],a=this.getMatchingOrder(),s=0;s<a.length;s++)for(var n=a[s],r=0;r<e.length;r++)p.call(this,e[r],t,n)&&i.push(b.getList.call(this,e[r],i.length));return i},getMatchedOptionsHTML:function(e){var t=[],i=y.call(this);return t=this.config.option_groups?this.getMatchedOptionGroupsHTML(e,i):this.getMatchedOptionsWithoutOptionGroups(e,i)},handleFetchMore:function(e,t){var i=e.length,a=e.join("");if(this.config.fetchMore){if(i<this.config.fetchMore.minResultsCount){{var s=t&&t.from_callback;t&&t.refresh}if(0==i){var n=s?this.config.noMatchesText:this.config.fetchMore.loadingText;a=$WC.template.replace(b.noresult,{$text:n})}s||(clearTimeout(this.config.fetchMore.timer),this.config.fetchMore.timer=setTimeout(function(){this.config.fetchMore.lastSearch!==this._curvalue&&"function"==typeof this.config.fetchMore.triggerRequest&&this.moreMatchesInServer()&&(this.config.fetchMore.lastSearch=this._curvalue,this.config.fetchMore.triggerRequest(this),"undefined"==typeof this.config.fetchMore.previousSearches&&(this.config.fetchMore.previousSearches=[]),this.config.fetchMore.previousSearches.push(this._curvalue))}.bind(this),500))}}else 0===i&&this.config.noMatches&&(a=$WC.template.replace(b.noresult,{$text:this.config.noMatchesText}));return a},populateList:function(e,t){var i=m.call(this);if(i){var a=this.handleFetchMore(this.getMatchedOptionsHTML(i),t);this._resultelem.html(a),Clickoutside.clear(this._resultelem[0].id),Clickoutside.bind({event:e,srcid:this._elem[0].id,destid:this._resultelem[0].id,customShow:g.bind(this),customHide:f.bind(this),doNotClose:function(e,t,i){return i&&i.target.hasAttribute("data-auto-input")}}),g.call(this),this.checkAndAddOptionsSearch(),this.highlightFrstResult(),this.focusInput(),"undefined"!=typeof ZCScroll&&ZCScroll.customScroll(this._resultelem[0],!0)}},isOptionsSearchEnabled:function(){return this.config.searchinoptions?this.config.option_groups||this.config.data.length>=this.config.maxItems:void 0},checkAndAddOptionsSearch:function(){if(this._elem.find("[data-auto-input]").length){var e=this._elem.find("#search-input");this.isOptionsSearchEnabled.call(this)?e.removeClass("drsrchhdn"):e.addClass("drsrchhdn")}else{if(this.isAutocomplete()){if(this._inputelem=this._elem.find("[data-auto-input]"),0===this._inputelem.length){var t=$WC.template.replace('<span data-selections></span><input data-auto-input tab-index placeholder="{{placeholder}}"/>',{placeholder:this.config.placeholder});this._elem.html(t),this._inputelem=this._elem.find("[data-auto-input]")}}else{var t='<div id="search-input" class="ellips drsrchholder {{hide_search_class}}"><div class="srchin"><span class="msi-srchicon"></span><input class="bornone" tab-index="0" data-auto-input placeholder="{{placeholder}}" type="text" value="{{value}}"></div></div>';t=$WC.template.replace(t,{hide_search_class:this.isOptionsSearchEnabled.call(this)?"":"drsrchhdn",placeholder:this.config.placeholder,value:this._curvalue}),this._resultelem.before(t),this._inputelem=this._elem.find("[data-auto-input]")}this._inputelem[0].focus()}},highlightFrstResult:function(){this._resultelem.find("[data-index]").eq(0).addClass("sel")},focusInput:function(){this._inputelem[0]&&(this._inputelem[0].hasAttribute("contenteditable")?$WC.DivEditor.focus(this._inputelem[0]):this._inputelem[0].focus())},handleDropDownClick:function(e){this.populateList(e)},handleListClick:function(t,i){var a,s=e(t);if("undefined"!=typeof s.attr("data-list")){a={};var n=s.attr("data-list");n&&(a[this.map.key]=n,a[this.map.title]=s.text())}else{var r=s.attr("data-index");a=this.config.data[r]}this.config.selected=a[this.map.key],this.updateHeader(a,s),this.config.clickcallback.call(this,a,s),this.isAutocomplete()?(v.call(this),this.populateList(i)):f.call(this)},updateHeader:function(e){var t=this.map.title,i=this.map.key;this.isAutocomplete()?this.addSelectedAutocompleteNodes(e[i],e[t]):this._elem.find("[dropdown-label]").html(e[t]),this._elem.attr("data-val",e[t]),this._elem.attr("data-key",e[i])},addSelectedAutocompleteNodes:function(e,t){var i=this._inputelem.parent().find("[data-selections]"),a=DropdownUtil.getSelectionHTML(t,e);i.append(a),this._elem.attr("data-key",e),this._elem.attr("data-val",t),this._elem.find("[dropdown-label]").html(t)},handleInputChange:function(e){var t=h(e);if(t!==s){var i=e.target.value;i!==this._curvalue&&(this._curvalue=i,this.populateList(e))}},handleKeyDown:function(e){var t=h(e);t===d?f.call(this):t===i||t===a?this.handleBackspace(e):t===r||t===l?this.handleLeftRightNavigation(e):t===o||t===c?DropdownUtil.handleListNavigation(e,this._resultelem,"[data-index]"):t!==n&&t!==s&&(!this.isOptionsSearchEnabled()||this._inputelem.hasClass("hide-caret"))&&e.preventDefault()},handleKeyUp:function(e){var t=h(e);t===n?this.handleEsc(e):(C(e),t===s&&this.handleEnter(e))},handleEsc:function(e){this._resultelem.is(":visible")?(f.call(this,!0),e.stopImmediatePropagation()):this._inputelem.val().length?(v.call(this),e.stopImmediatePropagation()):this.isAutocomplete()&&y.call(this).length>0&&(this._inputelem.parent().find("[data-selections]").empty(),this.focusInput(),e.stopImmediatePropagation())},handleEnter:function(e){if(this._resultelem.is(":visible")){var t=this._resultelem.find(".sel");if(t.length)return void this.handleListClick(this._resultelem.find(".sel"),e);var i={};i[this.map.title]=this._inputelem.attr("value"),i[this.map.key]=this._inputelem.attr("value"),this.config.clickcallback(i),f.call(this)}},handleBackspace:function(t){if(this.isAutocomplete()){var i=DropdownUtil.removeSelection(t,this._elem.find("[data-selections]"),e(this._inputelem));"undefined"==typeof i&&this.populateList(t)}},handleLeftRightNavigation:function(t){if(this.isAutocomplete()){var i=DropdownUtil.handleSelectionNavigation(t,this._elem.find("[data-selections]"),e(this._inputelem));"undefined"!=typeof i?f.call(this,!0):this.populateList(t)}},isAutocomplete:function(){return"autocomplete"===this.config.type},setData:function(e){return this.config.data=e,!0}};var m=function(){var e=this.config.data;if(this.config.option_groups)return e;if("object"==typeof e){var t=[];for(var i in e){var a=e[i],s={};"object"==typeof a?(s[this.map.title]=a[this.map.title],s[this.map.key]=a[this.map.key]):(s[this.map.title]=a,s[this.map.key]=i),t.push(s)}}return this.config.data=t,t},p=function(e,t,i){var a=e[this.map.key];if(t.length>0&&-1!==t.indexOf(a))return!1;if("startsWith"===i&&0===this._curvalue.length)return!0;var s=e[this.map.title].toLowerCase(),n=s.indexOf(this._curvalue.toLowerCase());return"startsWith"===i?0===n:n>0},h=function(e){return e.which||e.keyCode},g=function(){this._resultelem.parent().show(),this._resultelem.find(".sel_status").removeClass("sel_status"),this._resultelem.find('[data-list="'+this.config.selected+'"]').addClass("sel_status"),e(window).height()<this._resultelem.offset().top+this._resultelem.height()+this._elem.height()?this._elem.addClass("zcdrptop"):this._elem.removeClass("zcdrptop"),this.config.dropdownCallbacks&&"function"==typeof this.config.dropdownCallbacks.show&&this.config.dropdownCallbacks.show(this._resultelem)},f=function(e){e||v.call(this),this._resultelem.parent().hide(),Clickoutside.clear(this._resultelem[0].id),this.config.dropdownCallbacks&&"function"==typeof this.config.dropdownCallbacks.hide&&this.config.dropdownCallbacks.hide(this._resultelem)},v=function(){this._inputelem&&(this._inputelem.val(""),this._curvalue="")},C=function(e){e.stopPropagation(),e.preventDefault()},y=function(){var e=[];if(this.isAutocomplete())for(var t=this._inputelem.parent().find("[data-selections]").children(),i=0;i<t.length;i++){var a=t[i];a.hasAttribute("key")&&e.push(a.getAttribute("key"))}return e},b={header:function(){var e=this.config.data[this.config.selected]||this.config.drpdwnplaceholder||"Choose a list",t=this.isAutocomplete()?"autofill":"";return['<div class="drpdwn-input '+t+'" data-header>','<em class="msi-srchicon"></em>','<em class="msi-darrw"></em>','<div class="drpdwn-label ellips" dropdown-label>'+e+"</div>","</div>"].join("")},dropdown:function(){var e=this.config.hastooltip?"tultip-arw":"";return['<div id="drpdwn-option" class="drpdwn-option '+e+'" style="display:none;">','<div class="option-list" data-auto-result>',"</div>","</div>"].join("")},noresult:['<div class="option-list no-result">','<div class="norslt-txt">{{text}}</div>',"</div>"].join(""),getList:function(e,t,i){function a(e){if(e=$WC.$CUtil.processXSS(e),s&&n.length>0){var t=new RegExp($WC.Matcher.replace("escaperegexp",n),"i");return e.replace(t,"<b>$&</b>")}return e}var s=this.config.highlight,n=this._curvalue,r=['<div class="option-item {{custom_class}}" data-list="{{key}}" data-index="{{index}}">',e.imgurl?'<div class="option-img"><span class="list-usrimg"><img src="{{imgurl}}"><span class="sub-icon"></span></span></div>':"",'<div class="option-desc">',e[this.map.title]?'<div class="opt-title ellips">{{title}}</div>':"",e[this.map.desc]?'<div class="opt-sub-title">{{desc}}</div>':"","</div>","</div>"].join("");return r=$WC.template.replace(r,{title:a(e[this.map.title]?e[this.map.title]:"")},"InSecureHTML"),$WC.template.replace(r,{key:e[this.map.key],desc:e[this.map.desc]?e[this.map.desc]:"",imgurl:e.imgurl?e.imgurl:"",index:t,custom_class:i?i:""})},getHeaderLabel:function(e){return $WC.template.replace('<div class="option-hdr zcinhds">{{label}}</div>',{label:e})}};e.fn.dropdown=function(e){var i=[];return this.each(function(){var a=new t(this);a.init(e),i.push(a)}),i}}($);var DropdownUtil=function(){var e={BACKSPACE:8,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},t=function(e){e.stopImmediatePropagation(),e.preventDefault()},i=function(e){return e.which||e.keyCode},a=function(a,s,n){if(s.is(":visible")){var r=i(a);if(r===e.UP||r===e.DOWN){t(a);var o=s.find(n),l=0,c=s.find(n+".sel");if(c.length>0){var d=o.index(c);l=r===e.UP?d-1:d+1,l=(l%o.length+o.length)%o.length,c.removeClass("sel")}var u;return"undefined"!=typeof o[l]&&(u=$(o[l]),u.addClass("sel"),u[0].scrollIntoViewIfNeeded(!1)),u}}},s=function(a,s,n){var r=i(a);if(r===e.RIGHT||r===e.LEFT&&0===n[0].selectionStart){var o,l=s.find(".sel");if(l.length>0?o=r===e.LEFT?null===l[0].previousSibling?l:l.prev():l.next():r===e.LEFT&&(o=s.children().last()),l.removeClass("sel"),"undefined"!=typeof o&&o.length>0)return t(a),o.addClass("sel"),n.addClass("hide-caret"),o;n.removeClass("hide-caret"),l.length>0&&r===e.RIGHT&&t(a)}},n=function(e,i,a){var s=i.find(".sel");if(s.length>0){t(e);var n=s.next();if(0===n.length&&(n=s.prev()),s.remove(),n.length>0)return n.addClass("sel"),a.addClass("hide-caret"),n;a.removeClass("hide-caret").focus()}else 0===a.val().length&&i.children().last().remove()},r=function(a,s,n,r){t(a);var o=i(a);if(o===e.UP||o===e.DOWN||o===e.LEFT||o===e.RIGHT){var l,c=s.find(n),d=c.length,u=s.find(".sel"),m=c.index(u);if(-1===m)l=0;else if(o===e.LEFT||o===e.RIGHT)l=o===e.LEFT?m-1:m+1,l=(l%d+d)%d;else if(o===e.UP||o===e.DOWN){if(l=o===e.UP?m-r:m+r,0>l){var p=Math.ceil(d/r);l=p*r+l,l>=d&&(l-=r)}l>=d&&(l%=r)}u.removeClass("sel");var h=c[l];return"undefined"!=typeof h?(h.scrollIntoViewIfNeeded(!1),h=$(h),h.addClass("sel"),h):void 0}},o=function(e,t,i){var a='<span key="{{id}}" nodetype="multi-select" class="selected-node ellips"><div class="node-img">{{image}}<span purpose="deleteSelectedNode" class="msi-close cur delete-node"></span></div><span class="ellips" title="{{label}}">{{label}}</span></span>',s="";return i&&(s=$WC.template.replace('<img src="{{image_url}}"/>',{image_url:i})),a=$WC.template.replace(a,{image:s},"InSecureHTML"),a=$WC.template.replace(a,{id:t,label:e})};return{getSelectionHTML:o,handleListNavigation:a,handleSelectionNavigation:s,removeSelection:n,handleGridNavigation:r}}(),$Util={};$Util={IMAGETYPE_INVALID:1,IMAGESIZE_INVALID:2,FILESIZE_INVALID:3,CUMULATIVEFILESIZE_INVALID:4,maxSizeinMB:50,lastthrottlerequest:-1,wmsnotifyowner:new $WC.NotificationOwner("chat",!0,!0),CustomCheckbox:{setStatus:function(e,t,i,a){"string"==typeof e&&(e=$("#"+e)),e=e.siblings("[checkbox='custom']"),e.removeClass(),e.addClass(i?t?i.sel:i.rem:this.getCheckboxClass(t,a))},toggleAbility:function(e,t,i){"string"==typeof e&&(e=$("#"+e));var a=e.siblings("[checkbox='custom']");a.removeClass(),a.addClass(this.getCheckboxClass(t,i))},construct:function(e,t){for(var i=t.length,a=0;i>a;a++){var s=Template.CustomCheckbox.replace(/{CUSTOMCHECKCLASS}/g,t[a].class?t[a].class:this.getCheckboxClass(t[a].checked,t[a].disabled)).replace(/{DEFAULTCHECKBOX}/g,t[a].html).replace(/{DISABLED}/g,t[a].disabled?"disabled":"");t[a].key=new RegExp(t[a].key,"g"),e=e.replace(t[a].key,s)}return e},isChecked:function(e){return"string"==typeof e&&(e=$("#"+e)),e=e.siblings("[checkbox='custom']"),"msi-chkbxsel"==e.attr("class")||"msi-dsble"==e.attr("class")},getCheckboxClass:function(e,t){var i="";return i=e?t?"msi-dsble":"msi-chkbxsel":t?"msi-dsblesel":"msi-chkbxdsel"}},getCssTransformProperty:function(){for(var e=["transform","-webkit-transform","-moz-transform","-ms-transform","-o-transform"],t=0;t<e.length;t++)if(void 0!==document.body.style[e[t]])return e[t]},getTooltipTextForList:function(e){var t=e.length,i="";if(!t)return i;if(i=e[0],--t){var a=e.splice(t);i=e.join(", ")+" "+Resource.getRealValue("common.and")+" "+a}return i},getNamespace:function(e,t){if(t[e]){var i=t[e];if("object"==typeof i)return i;if(-1!==i.indexOf(".")){var a=window;i=i.split(".");for(var s=0,n=i.length;n>s;s++)a=a[i[s]];return a}return window[i]}},animateBufferLoader:function(e,t){if("object"==typeof e){var i=this.getCssTransformProperty()+":rotate({{degree}}deg) translate(0px, -150%);animation-delay: {{delay_time}}s";t=t?parseInt(t):12;for(var a=360/t,s=1/t,n=0,r=0,o="",l=0;t>l;l++)o+='<div style="'+$WC.template.replace(i,{degree:n,delay_time:r})+'"></div>',r+=s,n+=a;var c='<div class="zc-buffer-loader">'+o+"</div>";e.append(c)}},loadfavicon:function(e){var t=document.querySelector("link[rel='SHORTCUT ICON']"),i=UI.Logo.getFavIconURL(!1,$zcg._IMGSTATICURL+"/favicon.ico");if(e){if(UI.Logo.isCustomized("favicon")){if($WC.$CUtil.isEmpty($zcg._UNREADFAVICONURL)){var a=32,s=document.createElement("canvas");s.width=a,s.height=a;var n=s.getContext("2d"),r=document.createElement("img");r.src=t.href,r.onload=function(){n.drawImage(r,0,0,a,a),n.msImageSmoothingEnabled=!1,n.mozImageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1,n.beginPath(),n.arc(24,7,7,0,2*Math.PI),n.lineWidth=3,n.fillStyle="#FF0000",n.fill(),n.strokeStyle="#FFF",n.stroke(),$zcg._UNREADFAVICONURL=s.toDataURL("image/png"),t.href!==$zcg._UNREADFAVICONURL&&(t.href=$zcg._UNREADFAVICONURL)}}else t.href!==$zcg._UNREADFAVICONURL&&(t.href=$zcg._UNREADFAVICONURL);return}i=UI.Logo.getFavIconURL(!0,$zcg._IMGSTATICURL+"/favicon-unread.ico")}t.href!==i&&(t.href=i)},loadMultipleFiles:function(e,t,i){var a=t.length,s={type:e,callback:function(){--a,0>=a&&"function"==typeof i&&i()}};t.forEach(function(e){s.url=e,$Util.loadDynamicFiles(s)})},loadDynamicFiles:function(e){if($('script[src="'+e.url+'"]').length||$('link[href="'+e.url+'"]').length)"function"==typeof e.callback&&e.callback();else{var t=document.createElement(e.type);"script"===e.type?(t.type="text/javascript",t.src=e.url):(t.type="text/css",t.href=e.url,t.rel="stylesheet"),t.onload=function(){"function"==typeof e.callback&&e.callback()},document.head.appendChild(t)}},Browser:{CHROME:"chrome",FIREFOX:"firefox",OPERA:"opera",SAFARI:"safari",IE:"ie",EDGE:"edge",name:null,getBrowserName:function(){if(this.name)return this.name;var e=((navigator&&navigator.vendor||"").toLowerCase(),(navigator&&navigator.userAgent||"").toLowerCase());return this.name=$WC.Matcher.check("firefox_useragent_lowercase",e)?this.FIREFOX:$WC.Matcher.check("opera_useragent_lowercase",e)?this.OPERA:$WC.Matcher.check("edge_useragent_lowercase",e)?this.EDGE:$WC.Matcher.check("chrome_useragent_lowercase",e)?this.CHROME:$WC.Matcher.check("ie_useragent_lowercase",e)?this.IE:$WC.Matcher.check("safari_useragent_lowercase",e)?this.SAFARI:"unknown",this.name},isFirefox:function(){return this.getBrowserName()==this.FIREFOX},isChrome:function(){return this.getBrowserName()==this.CHROME},isOpera:function(){return this.getBrowserName()==this.OPERA},isSafari:function(){return this.getBrowserName()==this.SAFARI},isEdge:function(){return this.getBrowserName()==this.EDGE},getBrowserImgUrl:function(){var e=$Util.getImgStaticUrl();if(_isDesktopApp())e+="/cliq.png";else switch(this.getBrowserName()){case this.CHROME:e+="/chrome.png";break;case this.FIREFOX:e+="/firefox.png";break;case this.OPERA:e+="/opera.png";break;case this.SAFARI:e+="/safari.png";break;case this.IE:e+="/ie.png";break;case this.EDGE:e+="/ieedge.png"}return e}},isMacOs:function(){return-1!=navigator.appVersion.indexOf("Mac")},getImgStaticUrl:function(){return $.getImgStaticUrl()},getDefaultStaticImageUrl:function(e){return $zcg._IMGDEFAULTSTATICURL+"/"+e},imgPrview:function(e,t,i){i=i||"";var a=new FileReader;a.onload=function(t){e.html('<img width="50px" height="50px;" src="'+t.target.result+'" '+i+"/>")},a.readAsDataURL(t)},getOuterCntHeight:function(){var e=$(window).height()-UI.topbar.height();return e},getTextfromcontentEditable:function(e,t){var i="DIV"===e.nodeName;if("textContent"in document.body){if(!t||!i)return e.textContent;for(var a=$WC.DivEditor.getNodes(e),s=0,n=a.length,r="";n>s;s++){var o=a[s];if(o.nodeType===Node.TEXT_NODE)r+=o.nodeValue;else{{o.getAttribute("nodetype"),o.getAttribute("elemtype")}r+="BR"===o.tagName?"\n":$(o).text()}}return r=$WC.DivEditor.removeBufferCharacters(r),r=$.trim(r)}return e.innerText},size:function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i},annotateImage:function(e){ZAnnotator.init({imageURL:e.url,onSuccess:function(t){if("function"==typeof e.success){var i=t.imageSource;e.success($Util.dataToFile(i,e.type,e.name))}},finishButton:{text:Resource.getRealValue("common.savechanges")},onCancel:function(){"function"==typeof e.cancel&&e.cancel()},onLoad:function(){"function"==typeof e.load&&e.load(),$(".zimageeditor__cancel").text(Resource.getRealValue("annotator.discard"))},onError:function(){"function"==typeof e.cancel&&e.cancel()}})},dataToFile:function(e,t,i){for(var a=atob(e.split(",")[1]),s=new Uint8Array(a.length),n=0;n<a.length;n++)s[n]=a.charCodeAt(n);var r=new Blob([s],{type:t}),o=new File([r],i,{type:t,lastModified:(new Date).getTime()});return o},getObject:function(e,t){if("do"==e){for(var i=new DataObject,a=0;a<t.length;a++)for(var s=t[a],n=s.tname,r=s.cols,o=s.rows,l=0;l<o.length;l++){for(var c=o[l],d=[],u=0;u<c.length;u++)d[u]=[r[u],c[u]];i.addRowsForTable(n,d)}return i}return t},getSyncedCurrentTime:function(){return(new Date).getTime()-$zcg._SERVERSYNCTIMEDIFF},getCurrentTime:function(){return(new Date).getTime()},removeDuplicateEntries:function(e,t){var i=[];return t&&(e=e.sort()),$.each(e,function(e,t){-1==$.inArray(t,i)&&i.push(t)}),i},sort:function(e,t,i){return e.sort(i?function(e,i){return e[t]!==i[t]?e[t]<i[t]?1:-1:0}:function(e,i){return e[t]!==i[t]?e[t]>i[t]?1:-1:0})},sortString:function(e,t,i){return e.sort(i?function(e,i){return e[t].toLowerCase()<i[t].toLowerCase()?1:e[t].toLowerCase()>i[t].toLowerCase()?-1:0}:function(e,i){return e[t].toLowerCase()>i[t].toLowerCase()?1:e[t].toLowerCase()<i[t].toLowerCase()?-1:0})},sortByPriority:function(e,t,i,a){for(var s=[],n=[],r=[],o=0;o<e.length;o++){var l=e[o][t],c=$Util.searchWithSpecialChars(l,i);-1!==c&&(0==c?s.push(e[o]):" "===l.charAt(c-1)?n.push(e[o]):r.push(e[o]))}return a&&(s=$Util.sortString(s,0),n=$Util.sortString(n,0),r=$Util.sortString(r,0)),s.concat(n,r)},trimNotificationCount:function(e,t){var i=999;return"undefined"==typeof t&&(t=i),e>t&&(e=e.toString(),e=e[0]+".."+e[e.length-1]),e},getFileSize:function(e){return e=Math.round(e/1024),1024>e?e+" KB":Math.round(e/1024)+" MB"},isFilesizeExceeded:function(e,t){if(e){for(var i=0,a=0,s=e.length;s>a;a++)i+=e[a].size;if(t||(t=52428800),i>t)return!0}return!1},convertToMinHr:function(e){var t,i,a,s=Math.floor(e/60),n="";return 1>e?n:(1>s?n=e+" "+Resource.getRealValue(e>1?"common.secs":"common.sec"):s>=60?(t=Math.floor(s/60),i=s%60,n=t+" "+Resource.getRealValue(t>1?"common.hrs":"common.hr"),i>=1&&(n+=" "+i+" "+Resource.getRealValue(i>1?"common.mins":"common.min"))):(a=e%60,n=s+" "+Resource.getRealValue(s>1?"common.mins":"common.min"),a>=1&&(a+=" "+a+" "+Resource.getRealValue(a>1?"common.secs":"common.sec"))),n)},getAspectRatioFit:function(e,t,i,a,s){var n=[i/e,a/t];return n=Math.min(n[0],n[1]),!s&&n>1?{width:e,height:t}:{width:e*n,height:t*n,ratio:n}},isValidKey:function(e){var t=e>47&&58>e||32===e||e>64&&91>e||e>95&&112>e||e>185&&193>e||e>218&&223>e;return t},isArrowKey:function(e){return e===$zcg.UP_KEYCODE||e===$zcg.DOWN_KEYCODE||e===$zcg.LEFT_KEYCODE||e===$zcg.RIGHT_KEYCODE},isModifierKey:function(e,t){return e===$zcg.CTRL_KEYCODE||e===$zcg.SHIFT_KEYCODE||e===$zcg.ALT_KEYCODE||"undefined"!=typeof t&&(t.ctrlKey||t.shiftKey||t.altKey)},preventDefaultAndPropagation:function(e){e.preventDefault(),e.stopPropagation()},center:function(e){var t="string"==typeof e?$("#"+e):e,i=$(window),a=i.height(),s=t.outerHeight(),n=i.width(),r=t.outerWidth(),o=s>a?0:(a-s)/2,l=r>n?0:(n-r)/2;t.css({top:o+"px",left:l+"px"})},highlightError:function(e,t){e=e.find("."+t),e.length&&e.cssAnimation("zcfdk_tmbzoom")},getSpeedForSliding:function(e){var t=e.children().length;return t>=10?"slow":t>=5?400:"fast"},getObjectKeysLength:function(e){return Object.keys(e).length},getFirstNelemfromObj:function(e,t){for(var i={},a=0;t>a;a++){var s=Object.keys(e)[a];i[s]=e[s]}return i},getObjBasedonCriteria:function(e){var t=[],i=t.length;return e.startswithsearch||e.containssearch?(e.startswithsearch&&(t=t.concat(e.startswithobj)),e.containssearch&&(t=t.concat(e.containsobj))):(t=t.concat(e.startswithobj),i=t.length,i<e.limit&&(t=t.concat(e.containsobj),i=t.length),i>e.limit&&(t=t.slice(0,e.limit))),t},cloneObject:function(e,t){return t?$.extend(!0,{},e):$.extend({},e)},cloneArray:function(e){return e.slice(0)},updateArrayWithLimit:function(e,t,i){e.unshift(t),e=e.slice(0,i)},formatsecondstotime:function(e){var t=Math.floor(e/60),i=Math.floor(e-60*t);return 10>t&&(t="0"+t),10>i&&(i="0"+i),t+":"+i},nocachefix:function(e,t){if("json"===e){var i={};return(void 0===t||"true"===t)&&(i[$zcg._CFPARAMNAME]=Cookie.get($zcg._CFCOOKIENAME)),i.nocache=(new Date).getTime(),i}return"string"===e?void 0===t||"true"===t?"&"+$zcg._CFPARAMNAME+"="+Cookie.get($zcg._CFCOOKIENAME)+"&nocache="+(new Date).getTime():"&nocache="+(new Date).getTime():void 0},stringSplice:function(e,t,i,a){return"undefined"==typeof i&&(i=e.length),"undefined"==typeof a&&(a=""),e.slice(0,t)+a+e.slice(t+i)},scrollToView:function(e,t,i){"string"==typeof t&&(t=$("#"+t)),"string"==typeof e&&(e=t.find("#"+e));var a=this.getParentChildOffset(e,t),s=Math.ceil(t[0].scrollTop);a.elementtop<a.containertop?s-=a.containertop-a.elementtop:a.elementbottom>a.containerbottom&&(s+=a.elementbottom-a.containerbottom),ZCScroll.scrollTop(t,s,i)},scrollToViewportTop:function(e,t,i,a){"string"==typeof t&&(t=$("#"+t)),"string"==typeof e&&(e=t.find("#"+e));var s=this.firstmsgoffset-1||0;a&&(s=-e.outerHeight()),delete this.firstmsgoffset;var n=this.getParentChildOffset(e,t),r=Math.ceil(t[0].scrollTop);n.elementtop<n.containertop?r-=n.containertop-n.elementtop+s:n.elementtop>n.containertop&&(r+=n.elementtop-n.containertop-s),ZCScroll.scrollTop(t,r,i)},filteronlyAllowedChat:function(e){var t=SecurityManager.hasPermission(Modules.DirectMessage),i=SecurityManager.hasPermission(Modules.DirectMessage);if(!t||!i){var a=e.ac,s={};for(var n in a){var r=n,o=a[n],l={};l[r]=o,parseInt(o.ctype)===$zcg.CHAT&&t?$.extend(s,l):parseInt(o.ctype)===$zcg.ORGCHANNEL&&i?$.extend(s,l):parseInt(o.ctype)===$zcg.SYSTEM_CHAT&&$.extend(s,l)}e.ac=s}return e},getDivFromTime:function(e,t,i){var a=e?parseInt(e)+1:parseInt(t)-1;return i.find("[msgtime="+a+"]")},getParentChildOffset:function(e,t){var i={};return i.containertop=t.offset().top,i.containerbottom=i.containertop+t[0].clientHeight,i.elementtop=e.offset().top,i.elementbottom=i.elementtop+e.outerHeight(),i},getPositionInSortedArray:function(e,t,i){for(var a=e.length,s=0,n=0,r=a-1;r>s;){n=parseInt((s+r)/2);var o=i(e,n);if(t===o){s=n;break}o>t?r=n-1:s=n+1}return t>i(e,s)&&(s+=1),s},createSafeElement:function(e,t){var i=$("<div></div>");i.html(e);for(var a in t){var s=t[a],n=s[1],r=i.find("#"+a);s[2]&&r.text(n);for(var o=0,l=s[0].length;l>o;o++)r[0].setAttribute(s[0][o],n)}return i.children()},emptyClickedinNode:function(e,t){for(var i,a=e.childNodes,s=document.createRange(),n=t.clientX,r=t.clientY,o=0;i=a[o],o<a.length;o++){s.selectNodeContents(i);var l=s.getBoundingClientRect();if(n>=l.left&&n<=l.right&&r>=l.top&&r<=l.bottom)return!1}return!0},handleEditor:function(e,t,i){var a=!1,s=!1;if(("focus"===e.type||"focusin"===e.type)&&$(t).addClass(i.focusclass).removeClass("ellips"),("blur"===e.type||"focusout"===e.type)&&(a=!0),"keydown"===e.type){if(e.shiftKey)return;13===e.which&&e.preventDefault()}if("keyup"===e.type){if(e.shiftKey)return;(13===e.which||27===e.which)&&(e.stopPropagation(),a=!0,s=!0)}if(a){t=$(t);var n="DIV"===t[0].nodeName,r=t.attr("data-val"),o=$WC.$CUtil.isEmpty(i)||$WC.$CUtil.isEmpty(i.newline)?!1:i.newline;text=$.trim(n?this.getTextfromcontentEditable(t[0],o):t[0].value),27!==e.which&&("blur"!==e.type&&"focusout"!==e.type||i.handleblur)?0===text.length&&(text="undefined"!=typeof i.emptymsg?i.emptymsg:r):text=r,t.removeClass(i.focusclass).addClass("ellips");var l=!0;text!==r&&(i.newline||(text=text.replace(/\n/g,"")),"function"==typeof i.action&&(l=i.action.call(t,t,text,r))),l&&(t.attr("data-val",text),void 0!==t.attr("title")&&t.attr("title",text),n?o?t.html(this.trim($WC.$CUtil.processXSS(text))):t.text(text):t.val(text)),s&&t.blur()}},differedArray:function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return[];var i=[];return e.forEach(function(e){-1===t.indexOf(e)&&i.push(e)}),i},trim:function(e){return e.replace(/<p>/gi,"").replace(/<\/p>/gi,"").replace(/\n/gi,"<br>")},escapeId:function(e){return e.replace(/([ #;?%&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")},updateNotificationCount:function(e,t){t=parseInt(t),1>t?e.html(0).hide():e.html(t).show()},resetImageInput:function(e){e.val("")},getCustomTooltip:function(e,t,i,a){i="undefined"!=typeof i?i:!0,a=a||"south",i&&(e=$WC.$CUtil.processXSS(e).replace(/\&quot;/g,"\\&quot;")),t=t?t:"text";var s='{"componentOptions":{"content":"'+$.trim(e)+'","callout":"'+a+'","contentType":"'+t+'"}}';return i&&(s="'"+s+"'"),s},updateStickyTitle:function(e){var t=e.querySelector("[zc_sticky_title]");if(null!=t){var i=e.querySelectorAll("[zc_running_title]");t.style.display="";for(var a=t.getBoundingClientRect().top,s=null,n=0;n<i.length;n++){var r=i[n],o=r.getBoundingClientRect().top;if(null==s&&(s=r.innerHTML,$(r).hide()),r.clientHeight>0){if(!(o<a+t.clientHeight/2))break;s=r.innerHTML}}$WC.$CUtil.isEmptyString(s)?$(t).hide():($(t).show(),t.innerHTML=s)}},initializeStickyTitle:function(e){var t=e.find("[zc_sticky_title]"),i="1"==t.attr("zc_stick_init");i||e.find("[zc_sticky_title_list]").on("scroll",function(){this.scrollTop>5?t.addClass("zcstkshdw"):t.removeClass("zcstkshdw"),$Util.updateStickyTitle(e[0])}),t.attr("zc_stick_init","1"),this.updateStickyTitle(e[0])},isValidImage:function(e,t,i){return t?$WC.Matcher.check("imagemimetype",t[0].type)?this.isFilesizeExceeded(t,1024*i*1024)?(this.showInvalidFileAlert(e,this.IMAGESIZE_INVALID,i),!1):!0:(this.showInvalidFileAlert(e,this.IMAGETYPE_INVALID),!1):!1},showInvalidFileAlert:function(e,t,i){{var a=(Template.DialogBoxImage.replace(/{DETAILEDIMAGE}/g,'<div class="msi-fsizextimg"></div>'),"undefined"!=typeof i?i:this.maxSizeinMB);$WC.$Dlg.create({id:"fileuploadalert",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-atchfile clr-red"></div>',header:Resource.getRealValue("dialog.fileupload.header")}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({infoheader:Resource.getRealValue("dialog.fileupload.infoheader"),info:[Resource.getRealValue("dialog.fileupload.info1",[a]),Resource.getRealValue("dialog.fileupload.info2"),Resource.getRealValue("dialog.fileupload.info3")]}),buttons:[{text:Resource.getRealValue("dialog.fileupload.again"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){$(e).trigger("click")}}]})}},positionTargetElement:function(e,t,i){var a,s,n,r,i=i||{},o=i.positionparent?t.parent():t,l=45,c=5;return n=$(document).width()-(e.offset().left+e.outerWidth()),r=$(document).outerHeight()-t.outerHeight()-c,"undefined"!=typeof i.maxtop&&(r=r>i.maxtop?i.maxtop:r),a=e.offset().top+e.outerHeight()/2-t.outerHeight()/2,a=Math.min(r,a),a=Math.max(l,a),s=n>t.outerWidth()?e.offset().left+e.outerWidth():e.offset().left-t.outerWidth(),s="undefined"!=typeof i.leftoffset?s-i.leftoffset:s,o.css({top:a,left:s}),{top:a,left:s}},positionTargetElementUpDown:function(e,t,i){var a,i=i||{},s=t.outerHeight(),n=i.height?i.height:s,r=t.outerWidth(),o=e.offset().left,l=e.offset().top,c=e.outerHeight(),d=e.outerWidth(),u=$(document).outerHeight(),m=u/2>l,p=i.maxwidth?Math.min(i.maxwidth,d):d;p=i.minwidth?Math.max(i.minwidth,p):p;var h=o+(d-p)-(i.center?r/2-d/2:0);return a=m?l+c-(i.top_offset?i.top_offset:0):l-s-(i.bottom_offset?i.bottom_offset:0),{top:a,left:h,position:"fixed",width:p,height:n}},isSameorHoverElement:function(e,t,i){var a,s=function(e){for(;e&&"HTML"!==e.nodeName&&!e.hasAttribute("elemtype")&&e.getAttribute("id")!==i&&"BODY"!==e.nodeName;)e=e.parentNode;return e};return null!==t&&(a=s(t),e===a||a&&a.id===i)?!0:!1},isHoverElement:function(e,t,i){var a,s=function(e){for(;e&&"HTML"!==e.nodeName&&e.getAttribute("id")!==i&&"BODY"!==e.nodeName;)e=e.parentNode;return e};return null!==t&&(a=s(t),a&&a.id===i)?!0:!1},isMentionElement:function(e){return $(e).attr("mentionedid")?!0:!1},isClickableHoverElem:function(e){return $(e).attr("hover")?!0:!1},notify:function(e){_isDesktopApp()?DesktopApp.Notification.show({chid:e.chid,type:e.type,icon:e.icon,title:e.title,sticky:1==Settings.getFromObj("dcstickynotif"),body:$.trim(e.body),clickcallback:e.clickcallback,replyable:e.replyable,replycallback:e.replycallback}):$WC.DesktopNotification.show({title:e.title,body:$.trim(e.body),icon:e.icon,id:e.type,checkownership:e.isattached?!1:$Util.wmsnotifyowner,duration:"5000",onclick:e.clickcallback})},getKeyByValue:function(e,t){for(var i in e)if(e.hasOwnProperty(i)&&e[i]===t)return i},getTitleString:function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e},getCaretPosition:function(e){var t=document.createElement("span");t.setAttribute("id","tempelem"),t.innerHTML=".",$WC.DivEditor.insertObject(e,$("#"+e),t);var i=$(t).offset();return t.remove(),i},getAllIndexes:function(e,t){for(var i=[],a=-1;(a=e.indexOf(t,a+1))>=0;)i.push(a);return i},getDomain:function(e){if($WC.Matcher.check("linkRegExp",e)){var t=$WC.Matcher.replace("linkRegExp",e,function(e,t,i,a,s,n){return n.split("/")[0]});return t}return e},checkAndRemoveUndefinedKeys:function(e){var t={};for(var i in e)null!==e[i]&&"undefined"!=typeof e[i]&&(t[i]=e[i]);return t},getScrollpositiontoView:function(e,t,i){var a=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom,n=e.getBoundingClientRect().top,r=e.getBoundingClientRect().bottom;if(0===a&&0===s||0===n&&0===r)return"invalid";if(i){if(a>r)return"top";if(n>s)return"bottom"}else{if(a>n)return"top";if(r>s)return"bottom"}return"inside"},debounce:function(e,t,i){var a;return function(){clearTimeout(a);var s=arguments;a=setTimeout(function(t,i){e.apply(t,i)},i,t,s)}},getDropdownHTML:function(e,t,i,a,s,n){function r(e){if(e=""+e,!$WC.$CUtil.isEmpty(n)&&e.length<n)for(var t=0;t<n-e.length;t++)e="0"+e;return e}$WC.$CUtil.isEmpty(a)&&(a="");for(var o="",l=0;(i-e)/t>=l;l++){var c=r(e+l*t);o+='<li id="'+a+c+'" val="'+c+'"'+s+">"+c+"</li>"}return o},getDropdownHTMLFromArray:function(e,t,i){$WC.$CUtil.isEmpty(t)&&(t="");for(var a="",s=0;s<e.length;s++){var n=e[s];a+='<li id="'+t+n+'" val="'+n+'" '+i+">"+n+"</li>"}return a},getTimeDropdownHTML:function(e,t,i){var a=new Date($Util.getSyncedCurrentTime());a.setHours(0,0,0,0),a=a.getTime();for(var s="",n=0;1440/e>n;n++){var r=$Date.time(a);s+='<li id="'+t+$WC.Matcher.replace("containerid",r)+'" val="'+r+'" '+i+'">'+r+"</li>",a+=60*e*1e3}return s},copyToClipboard:function(e){$Dom.selectText(e.parent().find("[clipboardarea]")[0]);try{var t=document.execCommand("copy");t&&(e.html(Resource.getRealValue("common.copied")),setTimeout(function(){e.html(Resource.getRealValue("common.copy"))},2e3))}catch(i){}},copyTextToClipboard:function(e,t){var i;if(window.clipboardData&&window.clipboardData.setData)i=clipboardData.setData("Text",e);else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var a=document.createElement("textarea");a.textContent=e,document.body.appendChild(a),a.select();try{i=document.execCommand("copy")}catch(s){i=!1}document.body.removeChild(a)}i&&"function"==typeof t&&t()},getOS:function(){var e=window.navigator.userAgent,t=window.navigator.platform,i=["Macintosh","MacIntel","MacPPC","Mac68K"],a=["Win32","Win64","Windows","WinCE"],s=["iPhone","iPad","iPod"],n=null;return-1!==i.indexOf(t)?n="Mac":-1!==s.indexOf(t)?n="iOS":-1!==a.indexOf(t)?n="Windows":/Android/.test(e)?n="Android":!n&&/Linux/.test(t)&&(n="Linux"),n.toLowerCase()},isRetina:function(){var e="(-webkit-min-device-pixel-ratio: 1.5),	            (min--moz-device-pixel-ratio: 1.5),	            (-o-min-device-pixel-ratio: 3/2),	            (min-resolution: 1.5dppx)";return window.devicePixelRatio>1?!0:window.matchMedia&&window.matchMedia(e).matches?!0:!1},isCtrlorCmdKey:function(e){return $Util.isMacOs()?e.metaKey:e.ctrlKey},handleTransViewScroll:function(e){var t=e.find('[purpose="transcriptholder"]');t.on("scroll",function(i){t.hasClass("ps-active-y")&&t.find(".ps-scrollbar-y-rail").is(":visible")&&($Util.animateBtnTransView(e),i.stopImmediatePropagation())})},animateBtnTransView:function(e){clearTimeout($Util.ontranscroll),e.find(".zcflt_btn").addClass("btn-anim"),$Util.ontranscroll=setTimeout(function(){e.find(".zcflt_btn").removeClass("btn-anim")},200)},fetchAndScrollToMsg:function(e,t,i){var a=e.split("|"),s=a[0],n=a[1],r=a[2],o=n+"_"+r,l=$Util.getMessageElement(t,r);if(MessageOperations.delete.isExist(s,r))UI.updateBanner(Resource.getRealValue("info.reply.deleted"),2e3,!0);else if(l.length>0)o=l.attr("uid"),$Util.scrollToMsgInCurrentTranscriptView(o,t,s);else{var c={chid:s,mentionmsgid:e,callback:i,lineslimit:Chat.LINESLIMIT};$Util.updateStatusMsg(t,"loading"),t.unbind("scroll"),ChatHistory.getTranscript(c)}},viewRepliedMsg:function(e){"a"===e.target.tagName.toLowerCase()&&e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),i=t.attr("msgtime");if("undefined"!=typeof i){var a=t.parents('[purpose="transcriptholder"]');$Util.fetchAndScrollToMsg(MsgUtil.getMsgMentionuid(t),a,function(e,t,i,s,n,r){$Util.handleTranscript(e,t,i,s,n,r,a)})}},handleTranscript:function(e,t,i,a,s,n,r,o){ChatUI.handleScrollToLoadMore({dom:r.parent(),chid:i,fetchmethod:ChatHistory.getTranscript,totime:s,fromtime:a,mentionmsgid:n,data:{chid:i,callback:function(e,t,i,a,s,n){r.find("#loadingoldmsgs").remove(),$Util.handleTranscript(e,t,i,a,s,n,r,o)},lineslimit:Chat.LINESLIMIT}});var l={chid:i,dom:r,origin:o},c=MsgUtil.formatTranscript(t,l);ChatUI.updateFirstMsgOffsetValue(s,a,r),MsgUtil.updateTranscript(r,c,a,s),ZCScroll.resetScroll(r);var d=MsgUtil.getMsgUidWithoutChid(n);d?$Util.scrollToMsgInCurrentTranscriptView(d,r,i):ChatUI.scrollToMsgView(s,a,r),0===r.scrollTop()&&ChatUI.loadVisibleImages(r[0])},scrollToMsgInCurrentTranscriptView:function(e,t,i){var a=e.indexOf("_")>-1?e.split("_")[1]:e,s=$Util.getMessageElement(t,a);if(MessageOperations.delete.isExist(i,a))return void UI.updateBanner(Resource.getRealValue("info.reply.deleted"),2e3,!0);if(0===s.length)return void UI.updateBanner(Resource.getRealValue("common.history.aftertime"),2e3,!0);var n=Math.ceil(t[0].scrollTop),r=$Util.getParentChildOffset(s,t),o=!0,l=t.innerHeight()/2-s.innerHeight()/2;$Util.removeHighlighterClass(s),r.elementtop<r.containertop?n-=r.containertop-r.elementtop+l:r.elementbottom>r.containerbottom?n+=r.elementbottom-r.containerbottom+l:o=!1,t.stop(!0,!0),o?t.animate({scrollTop:n},function(){$Util.addHighlighterClass(s)}):(ZCScroll.scrollTop(t,n),$Util.addHighlighterClass(s))},addHighlighterClass:function(e){e.cssAnimation("zcmsg_blink")},removeHighlighterClass:function(e){e.removeClass("zcmsg_blink")},getMessageElement:function(e,t){var i=e.find("[mtype][msgtime='"+t+"'] ");return 0===i.length&&(i=e.find('[mtype][msg_timings*="'+t+'"]')),i},getRandomQuotes:function(){var e=["loading.quote0","loading.quote1","loading.quote2","loading.quote3","loading.quote4","loading.quote5"],t=Math.floor(Math.random()*e.length);return Resource.getRealValue(e[t])},updateStatusMsg:function(e,t){var i='<div class="hstrset" id="loadmore"><div class="emcht-inftxtmn">';i+="loading"===t?'<span class="zcldng"></span><div id= "fetchinghistories" class="emcht-inftxt">'+$Util.getRandomQuotes()+"</div>":""!==$("#historysearch").val()?'<div class="emcht-inftxt zchstry">'+Resource.getRealValue("history.search.none")+"</div>":'<div class="emcht-inftxt zchstry">'+Resource.getRealValue("history.none")+"</div>",i+="</div></div>",e.html(i)},getRandomNumber:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},searchWithSpecialChars:function(e,t){var e=e.toLowerCase(),i=e.indexOf(t);if(-1===i){var t=$WC.Matcher.replace("removespecialchars",t," ");t=t.replace(/  +/g," "),i=$WC.Matcher.replace("removespecialchars",e," ").indexOf(t),i=-1===i&&new RegExp(t.split(" ").join(".*"),"gi").test(e)?1:i}return i},getDateWithoutTime:function(e){var t=e?new Date(parseInt(e)):new Date;return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()},isValidNumber:function(e,t,i){return("undefined"==typeof t||e>=t)&&("undefined"==typeof i||i>=e)&&/^[0-9]+$/.test(e)},escapeReplacementString:function(e){return $WC.Matcher.replace("escapeReplacementString",e)},xssAndEscapeReplacementString:function(e){return this.escapeReplacementString($WC.$CUtil.processXSS(e))},preloadImages:function(e,t,i){if(t=t||0,e&&e.length>t){var a=new Image;a.onload=function(){$Util.preloadImages(e,t+1,i)},a.src=i.replace("{FILENAME}",e[t])}},addClassToViewableArea:function(e,t,i){var a=i.scrollTop(),s=a+i.height(),n="in-view";$.each(t,function(){var e=$(this),t=e.outerHeight(),i=e.offset().top,r=i+t;r>=a&&s>=i?e.addClass(n):e.removeClass(n)})},eleminViewinWindow:function(e,t){var i=e.offsetTop,a=i+e.offsetHeight,s=t.scrollTop(),n=s+t.height();return a>s&&n>i},throttle:function(e,t,i){(new Date).getTime()-$Util.lastthrottlerequest>i&&($Util.lastthrottlerequest=(new Date).getTime(),e.apply(t,[]))},showChatAddMemberAlert:function(e,t,i,a){var s=t.length>1,n=s?'<div class="mheader_icn msi-adduser clr-green"></div>':'<div class="mheader_icn"><img src="'+Users.getImgUrlById(t[0])+'" width="38" height="38"/></div>',e=$WC.$CUtil.processXSS(e),r=[{text:Resource.getRealValue("info.chat.addhere"),colour:$WC.$Dlg.GREEN_BUTTON,action:i},{text:Resource.getRealValue("info.chat.newchat"),colour:$WC.$Dlg.GREY_BUTTON,action:a}];$ZCVideoBroadcast.isVideoBroadcastPage&&r.pop(),$WC.$Dlg.confirm({id:"addmemberalert",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:n,ispositive:!0,header:Resource.getRealValue("info.chat.addmember.header",[e])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("info.chat.addmember.info1"),Resource.getRealValue("info.chat.addmember.info2")]}),buttons:r})},showChatDeleteMemberAlert:function(e,t,i,a){if(ChatUI.isExist(e)){var s=ChatUI.exist[e],n=i.length>1,r=n?'<div class="mheader_icn msi-removeuser clr-red"></div>':'<div class="mheader_icn"><img src="'+Users.getImgUrlById(i[0])+'" width="38" height="38"/></div>',t=$WC.$CUtil.processXSS(t),o="deleteparticipant"+e,l={text:Resource.getRealValue("info.participant.remove.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Chat.deleteMember(e,i),"function"==typeof a&&a()}};if(s.isChannel())var c=s.isChannel()?Channels.getObject(Channels.getChannelId(e)).cn:"",d=s.isOrgChannel()||s.isOrgGroupChannel()?[Resource.getRealValue("info.participant.allowedchannel.remove.info1"),Resource.getRealValue("info.participant.allowedchannel.remove.info2")]:[Resource.getRealValue("info.participant.notallowedchannel.remove.info1"),Resource.getRealValue("info.participant.notallowedchannel.remove.info2"),Resource.getRealValue("info.participant.notallowedchannel.remove.info3")],u=Resource.getRealValue("info.channel.participant.remove",[t,$WC.$CUtil.processXSS(c)]);else var d=[Resource.getRealValue("info.participant.remove.info1"),Resource.getRealValue("info.participant.remove.info2"),Resource.getRealValue("info.participant.remove.info3")],u=Resource.getRealValue("info.chat.participant.remove",[t]);$WC.$Dlg.create({id:o,version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:r,header:u}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:d}),buttons:[l]})}},showChatDeleteAlert:function(e){$WC.$Dlg.confirm({id:"deletehistory",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("info.history.delete.info1"),Resource.getRealValue("info.history.delete.info2")]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-history clr-red"></div>',header:Resource.getRealValue("info.history.delete")}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:e}]})},showUserRemovedAlert:function(e){$WC.$Dlg.confirm({id:"attachsessionerror",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("chat.attach.error")]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-green"></div>'}),buttons:[{text:Resource.getRealValue("chat.goto.history"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){ChatHistory.load(),ChatsList.delete(e)}},{text:Resource.getRealValue("chat.goto.history.no"),action:function(){ChatsList.delete(e)}}]})},Button:{addLoadIcon:function(e){e.html("").addClass("reqprocess_anim")},removeLoadAndAddTickMark:function(e){"undefined"!=typeof e&&e.removeClass("reqprocess_anim").addClass("msi-ticktwo")},removeLoadAndAddHtml:function(e,t){"undefined"!=typeof e&&e.removeClass("reqprocess_anim").html(t)},removeTickAndAddHtml:function(e,t){"undefined"!=typeof e&&e.removeClass("msi-ticktwo").html(t)},addLoadIconForAjax:function(e){e.find("[loading]").length||(e.attr("button-html-content",e.html()),e.css("pointer-events","none"),e.width(e.width()),e.html('<span loading class="reqprocess_anim"></span>'))},showCompletionAndResetContent:function(e,t){$(e.children()[0]).fadeOut(100,function(){var i=t?"zcbtnerr msi-close":"msi-ticktwo";$(this).replaceWith('<span loading class="'+i+'"></span>').fadeIn(),setTimeout(function(){$(e.children()[0]).fadeOut(100,function(){var t=e.attr("button-html-content");$(this).replaceWith(t).fadeIn(100),$(e).removeAttr("style")})},2e3)})}},isJSONString:function(e){try{JSON.parse(e)}catch(t){return!1}return!0},isValidJSON:function(e,t){var i=!1;if("string"==typeof e&&(e.startsWith("[")&&e.endsWith("]")||e.startsWith("{")&&e.endsWith("}")))try{var a=JSON.parse(e);t?Array.isArray(a)?i=a.length>0:"object"==typeof a&&(i=!$WC.$CUtil.isEmptyObject(a)):i=!0}catch(s){i=!1}return i},toFixedDecimalPoints:function(e,t,i){var a=""+e,s=a.split(".");if(1==s.length)return parseFloat(e).toFixed(t);var n=Math.max(t,Math.min(s[1].length,i));return parseFloat(e).toFixed(n)},isPendingInviteeChatPresent:function(e){var t=ChatsList.getAll();for(var i in t){var a=t[i];if(a.addinfo.PEND_INV&&a.addinfo.PEND_INV===e)return a.chid}return-1},isAllowedUser:function(e,t,i){if(Contacts.isBotId(t))return!0;var a=new $CliqChatId(e),s=a.isChannel()?Channels.isAllowedUser(e,t):Chat.isAllowedUser(e,t);return void 0===s&&Chat.getParticipantDetails(e,t,function(e){var t=e.users,n=t[0].isjoined;if(a.isChannel()){var r=ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,a);s=t[0].role>=Channels.ROLES.SUPER_ADMIN&&t[0].role<=Channels.ROLES.ALLOWED_USER&&!n&&r}else s=!n;"function"==typeof i&&i(s)}),"function"==typeof i?i(s):s},showInfoInCwinHeader:function(){var e;return function(t,i,a,s){if(ChatUI.isExist(t)){var n=$("#"+t).find("#cwin_info"),r='<div class="cwin-hdr-pos cwin-hdr-info {{classess}}">{{text}}</div>';n.html($WC.template.replace(r,{classess:a,text:i})),clearTimeout(e),e=setTimeout(function(){n.html("")},s?s:3e3)}}}(),removeMsginMsgArea:function(e){if(0!==e.length){var t=e.prev(),i=e.next(),a=!1;if("sender"===t.attr("purpose")&&(i.length>0?MsgUtil.isMsg(i.attr("mtype"))||(a=!0):a=!0),a){var s=t.prev();if("date"!==s.attr("purpose")||0!==i.length&&"date"!==i.attr("purpose")){var n=s.attr("uid");if(n){var r=n.split("_")[0];r===i.attr("sender")&&MsgUtil.isMsg(s.attr("mtype"))&&i.remove()}}else s.remove();t.remove()}e.remove()}},positionContainer:function(e,t,i){i.css({position:"fixed"});var a=i.height(),s=i.width(),n=e.offset().left,r=e.offset().top,o=window.innerHeight-r,l=window.innerWidth-n;i.css(n>s?{left:n-s+"px"}:l>s?{left:n+e.width()+"px"}:l>n?{left:"0"}:{right:"0"}),i.css(r>a?{top:r-(a-e.height())+"px"}:o>a?{top:r+"px"}:o>r?{top:"0"}:{bottom:"0"})},positionContainerInside:function(e,t,i){e.css({position:"relative"});var a=e.offset().left-t.offset().left,s=e.offset().top-t.offset().top,n=e.width(),r=e.height(),o=t.height()-s,l=t.width()-n-a,c=i.width(),d=i.height(),u=i.attr("cwidth");u=u?parseInt(u):0;var m,p,h,g,f=!1;m=p=h=g="auto",l>c?(l-=c,u>a+n&&u>l?(h=-(a-5)+"px",f=!0,a=0,l+=c):(f=!!e.next().length,h=f?"0":"125%")):a>c?(a-=c,u>a&&u>l?(g=-(l-5)+"px",f=!0,l=0,a+=c):(f=!!e.prev().length,g=f?"0":"125%")):(g=-(l-5)+"px",f=!0,l=0,a+=c),u>0&&(l>u?e.removeClass("left"):e.addClass("left")),s>d||d>s+o?p=f?"125%":"0":o>d?m=f?"125%":"0":f?p="125%":o>=d/2&&s>=d/2?(p=m="0",i.css({margin:"auto"})):p=-(o-r)+"px",i.css({bottom:p}),i.css({top:m}),i.css({right:g}),i.css({left:h})},jsonToAttrib:function(e,t){var i="";for(var a in e)e[a]=t?$WC.$CUtil.processXSS(""+e[a]):e[a],i+=a+'="'+e[a]+'" ';return i},getTranscriptOptionHtml:function(e,t){var i="undefined"!=typeof t.joined?t.joined:!1,a=new $CliqChatId(e),s="",n='<div class="zcflt_btn btn-anim"><div purpose="transcriptoptions" operation="continue" chid="'+e+'" operationfor="'+(a.isChannel()?$zcg.ORGCHANNEL:$zcg.CHAT)+'" class="zchovrcht">'+Resource.getRealValue("common.continue")+"</div></div>",r='<div class="zcflt_btn btn-anim"><div purpose="transcriptoptions" operation="join" chid="'+e+'" operationfor="'+(a.isChannel()?$zcg.ORGCHANNEL:$zcg.CHAT)+'" class="zchovrcht">'+Resource.getRealValue("common.join")+"</div></div>";if(a.isChannel()){var o=ChannelsPermission.hasPermission(MActions.ViewParticipants),l=Channels.getByChid(e);$.isEmptyObject(l)||(i=Channels.isJoined(l),o=ChannelsPermission.hasPermission(MActions.ViewParticipants,Channels.getLevel(l))&&!Channels.isArchived(l)),o&&(s=i?n:r)}else i&&SecurityManager.hasPermission(Modules.DirectMessage)&&(s=n);return s}};var $Scroll=function(){var e={scrolldown:{constantForNextPage:1,childfinder:"lastChild",constantForNextPageInContainer:1,childAddOpr:"append"},scrollup:{constantForNextPage:-2,childfinder:"firstChild",constantForNextPageInContainer:-1,childAddOpr:"prepend"}},t=function(e,t,a){e.off().on("scroll",function(){if(ZCScroll.isScrollNearBottom(this))i(e,t,a,"scrolldown");else if(ZCScroll.isScrollUp(this)){var s=parseInt(e.attr("pgno")||1);s>2&&i(e,t,a,"scrollup")}clearTimeout(this.scrolltimer),this.scrolltimer=setTimeout(function(){ChatUI.loadVisibleImages(e[0])},$zcg.ORIGINALIMG_LOAD_TIMEOUT)})},i=function(t,i,a,n){var r=e[n],o=parseInt(t.attr("pgno")||1),l=i.domfinder,c=l?t.find("["+l.key+'="'+l.value+'"]'):t,d=o+r.constantForNextPage;t.attr("pgno",d),i.successCallback=function(e){if(e.searchedlist.length){o+=r.constantForNextPageInContainer,t.attr("pgno",o);var a=c[0][r.childfinder];c[r.childAddOpr](e.content);var n=$(c).children();n.length>2*i.limit&&o>2&&s(n,r.childAddOpr,i.limit),i.peopledata&&Users.updateUserDetails(e.searchedlist,c),$Util.scrollToView($(a),t)}else t.attr("pgno",o)};var u=a(i);i.successCallback(u)},a=function(e,t){var i=parseInt($("#"+t.listid).attr("pgno")||1),a=t.limit,s=0,n=e;return n>=a&&(s=a*(i-1),n=a*i),n=n>e?e:n,{minlimit:s,maxlimit:n}},s=function(e,t,i){if("append"===t)e.slice(0,i).remove();else if("prepend"===t){var a=e.length;e.slice(a-i,a).remove()}};return{handleScroll:t,getElementRange:a}}();_favorites=function(){var e=$DB.get("contacts"),t=[];for(var i in e)t.push([e[i].uc,Contacts.getDisplayName(i)]);t.sort(function(e,t){return e[0]!==t[0]?e[0]>t[0]?1:-1:0});for(var a=t.length,s="",i=a-1;i>=0;i--)s+=t[i][1]+"----->"+t[i][0]+"\n";return s},_print=function(e,t){var i="ajaxcalls"==e?1e3:50;if("undefined"==typeof _zcDebugger[e]&&(_zcDebugger[e]=[]),_zcDebugger[e].length>i&&_zcDebugger[e].splice(0,1),"ajaxcalls"==e&&Array.isArray(t)){var a=t[1];a&&a.msg&&(delete a.msg,t[1]=a)}_zcDebugger[e].push(t)},_Printed=function(e){return _zcDebugger[e]},Plan=function(){var e=$zcg._PLANDETAILS,t=e.limits,i=["free"],a={4505:t.command,4203:t.messageAction,4704:t.function,4303:t.scheduler,platform_storage_creation_limit_exceeded:t.database,4002:t.bot,7031:t.extension};return{isBroadcastAllowed:function(){return e.isBroadcastAllowed},isFreePlan:function(){return-1!==$.inArray(e.plan,i)},getPaymentUpgradeURL:function(){return e.paymentsURL+"/html/store/index.html#subscription?serviceId="+e.serviceId+"&amp;customId="+$zcg._APPACCOUNTID},populateLimitExcededWindow:function(t){var i={4505:Resource.getRealValue("integration.commands"),4203:Resource.getRealValue("integration.messageaction.title"),4704:Resource.getRealValue("functions.title"),4303:Resource.getRealValue("schedulers.title"),4002:Resource.getRealValue("bots.title"),7031:Resource.getRealValue("app.apps"),platform_storage_creation_limit_exceeded:Resource.getRealValue("platformdatabases.title")},s=[Resource.getRealValue("plan.component.creation.limit.exceeded.info",[i[t],a[t]])];if("true"===$zcg._ISAPPACCOUNTADMIN){var n=[{colour:1,text:Resource.getRealValue("plan.component.creation.limit.exceeded.button.info"),action:function(){window.open(Plan.getPaymentUpgradeURL())}}];s.push(Resource.getRealValue("plan.component.creation.limit.exceeded.info1",[i[t]])+' <a target="_blank" class="zcconntxt clr-link" href="'+e.pricingPlanURL+'">'+Resource.getRealValue("plan.component.creation.limit.exceeded.info.link")+"</a>")}else{var n=!1;s.push(Resource.getRealValue("plan.component.creation.limit.exceeded.info2",[i[t]])+' <a target="_blank" class="zcconntxt clr-link" href="'+e.pricingPlanURL+'">'+Resource.getRealValue("plan.component.creation.limit.exceeded.info.link")+"</a>")}$WC.$Dlg.confirm({id:"cmdcrtlmtexce",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:s,infoheader:Resource.getRealValue("plan.component.creation.limit.exceeded.info.header")}),headerhtml:$WC.$Dlg.frameHeaderHTML({ispositive:!0,imagehtml:'<div class="mheader_icn"><img src="'+$Util.getDefaultStaticImageUrl("upgrade_plan.svg")+'"/></div>',header:Resource.getRealValue("plan.component.creation.limit.exceeded.header")}),buttons:n})}}}();var $Dom={};$Dom={radio:{construct:function(e,t){if(!$("input[name='"+e+"']").length){for(var i='<div {ID} class="zcfdksbmn dIB posl"><span radio="custom" class="zchradio {CHECKEDCLSS}"><div class="zchrdclor bdr50"></div></span><input {RADIOID} class="zcfdkrdbtn" name="{NAME}" {CHECKED} value="{VALUE}" type="radio"><label {FORRADIO}>{LABEL}</label></div>',a="",s=0,n=t.length;n>s;s++){var r=t[s],o="";o+=void 0!==r.id?i.replace(/{RADIOID}/g,'id="'+r.id+'_radio"').replace(/{FORRADIO}/g,'for="'+r.id+'_radio"').replace(/{ID}/g,'id="'+r.id+'"'):i.replace(/{RADIOID}/g,"").replace(/{FORRADIO}/g,"").replace(/{ID}/g,""),o=r.checked?o.replace(/{CHECKEDCLSS}/g,"zchradiosel").replace(/{CHECKED}/g,'checked="true"'):o.replace(/{CHECKEDCLSS}/g,"").replace(/{CHECKED}/g,""),o=o.replace(/{VALUE}/g,r.value).replace(/{LABEL}/g,r.label).replace(/{NAME}/g,e),a+=o}return a}},listen:function(e){var t=$(e.target),i=e.target.checked;custom=t.siblings("[radio='custom']"),$("input[name='"+t.attr("name")+"']").siblings("[radio='custom']").removeClass("zchradiosel"),i&&custom.addClass("zchradiosel")}},dropdown:{construct:function(e,t,i){t.val=$WC.$CUtil.processXSS(t.val),t.data=$WC.$CUtil.processXSS(t.data);var a='<div id="'+e+'" purpose="dropdown" class="selectmlmn"><div id="'+e+'_ddhead" purpose="ddhead" class="selectmail"><input type="hidden" val="'+t.val+'" value="'+t.data+'"/><div class="mailids ellips" title="'+t.data+'" purpose="ddheadvalue" val="'+t.val+'">'+t.data+'</div><span class="darrow"></span></div>'+this.values(e,i)+"</div>",s=$("<div></div>");s.html(a);var n=s[0].firstChild;return this.bind(n),n},values:function(e,t){for(var i='<ul id="'+e+'_ddlist" purpose="ddlist" class="dropdwncnt" style="display: none;">',a=0,s=t.length;s>a;a++){var n=t[a];i+='<li purpose="ddvalue"><span class="ellips" title="'+$WC.$CUtil.processXSS(n.data)+'" val="'+n.val+'">'+$WC.$CUtil.processXSS(n.data)+"</span></li>"}return i+="</ul>"},reset:function(e){if(void 0!==e){var t=$("#"+e),i=t.find("[purpose='ddheadvalue']"),a=i.siblings("input");i.attr({val:a.attr("val"),title:a.attr("value")}).html(a.attr("value"))}},bind:function(e){e=$(e),e.find("[purpose='ddhead']").on("click",function(e){var t=$(this),i=t.siblings("[purpose='ddlist']");Clickoutside.bind({srcid:t.attr("id"),destid:i.attr("id"),event:e})}),e.find("[purpose='ddlist']").on("click","[purpose='ddvalue']",function(e){var t=$(this),i=$(this.firstChild),a=i.html(),s=t.parents("[purpose='ddlist']").siblings("[purpose='ddhead']").find("[purpose='ddheadvalue']");s.attr({val:i.attr("val"),title:$WC.$CUtil.processXSS(a)}).html($WC.$CUtil.processXSS(a)),Clickoutside.handleClickOnChild(e)})}},placeCursorAtEnd:function(e){if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange(),i=window.getSelection();t.selectNodeContents(e),t.collapse(!1),i.removeAllRanges(),i.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(e),a.collapse(!1),a.select()}},limitInput:function(e){var e=$(e),t=e.siblings("[category='charcount']"),i="TEXTAREA"===e[0].nodeName||"INPUT"===e[0].nodeName?e.val():e.text(),a=t.attr("limit"),s=a-i.length;t.html(s),10>s?t.addClass("zcchcoutdec"):t.removeClass("zcchcoutdec"),0>s&&("TEXTAREA"===e[0].nodeName||"INPUT"===e[0].nodeName?e.val(i.substring(0,a)):e.text(i.substring(0,a)),this.placeCursorAtEnd(e[0]),t.html(0))},selectText:function(e){var t,i,a=window,s=a.document;a.getSelection&&s.createRange?(t=a.getSelection(),i=s.createRange(),i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i)):s.body.createTextRange&&(i=s.body.createTextRange(),i.moveToElementText(e),i.select())},openFullScreen:function(e){e&&(e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen())}};var Resource={},LinkResource={};Resource={getRealValue:function(e,t){var i=ResourceMessageObject[e];if("undefined"!=typeof i){if(-1!=i.indexOf("$BRANDNAME")&&(i=i.replace(/\$BRANDNAME/g,$zcg._BRANDNAME)),-1!=i.indexOf("$DEPLOYMENTNAME")&&(i=i.replace(/\$DEPLOYMENTNAME/g,$zcg._DEPLOYMENTNAME)),-1!=i.indexOf("$PRODUCTNAME")&&(i=i.replace(/\$PRODUCTNAME/g,$zcg._PRODUCTNAME)),-1!=i.indexOf("$ORGNAME")){var a=$WC.$CUtil.isEmpty($zcg._ORGNAME)?Resource.getRealValue("common.your.org"):$zcg._ORGNAME;i=i.replace(/\$ORGNAME/g,a)}return"undefined"!=typeof t&&(i=Resource.replaceParams(i,t)),i}return e},replaceParams:function(e,t){t instanceof Array||(t=t.split(","));for(var i=0;i<t.length;i++)e=e.replace(new RegExp("\\$"+(i+1),"g"),$WC.Matcher.replace("escapeReplacementString",t[i].toString()));return e}},LinkResource={getRealValue:function(e){var t=ResourceLinkObject[e];return"undefined"!=typeof t?t:e}},"undefined"!=typeof $WC&&"undefined"!=typeof $WC.$CUtil&&$WC.$CUtil.setConfig({Resource:Resource});var SessionTimers=function(){var e={},t={SECOND:1e3,MINUTE:6e4,HOUR:36e5},i={separator:":",interval:t.SECOND},a=function(e,t){this.id=e,this.timer=null,this.hourElem=null,this.minuteElem=null,this.secondElem=null,this.config=$.extend({},i,t),this.config.startTime=this.config.startTime||(new Date).getTime();var a=$("#"+e);if(a.length){var s=this.isHourTimer()?"hours":this.isMinuteTimer()?"minutes":"seconds";if(!a.children("["+s+"]").length){var n=$WC.template.replace("{{hours}}{{minutes}}{{seconds}}",{hours:'<span hours class="{{hour_display_class}}">{{hours_initial_value}}</span>',minutes:this.isHourTimer()?"":'<span separator class="{{hour_display_class}}">{{separator}}</span><span minutes>{{minutes_initial_value}}</span>',seconds:this.isSecondTimer()?"<span separator>{{separator}}</span><span seconds>{{seconds_initial_value}}</span>":""},"InSecureHTML"),r=this.getCurrentDuration();n=$WC.template.replace(n,{hour_display_class:this.isSecondTimer()?"dN":"",separator:this.config.separator,hours_initial_value:r.hours,minutes_initial_value:r.minutes,seconds_initial_value:r.seconds}),a.append(n)}this.hourElem=a.find("[hours]"),this.minuteElem=a.find("[minutes]"),this.secondElem=a.find("[seconds]"),this.updateDurationVisibility(r)}};return a.prototype={start:function(){if(this.hourElem||this.MinuteElem||this.secondElem){clearInterval(this.timer);var e=function(){var e=this.getCurrentDuration();this.hourElem.text(e.hours),this.minuteElem.text(e.minutes),this.secondElem.text(e.seconds),this.updateDurationVisibility(e)}.bind(this);this.timer=setInterval(e,this.config.interval)}},stop:function(){clearInterval(this.timer),this.timer=null},getCurrentDuration:function(){var e={hours:"00",minutes:"00",seconds:"00"},t=($Util.getSyncedCurrentTime()-this.config.startTime)/1e3;return t>0&&(e.hours=$Date.append0(Math.floor(t/3600)),t%=3600,e.minutes=$Date.append0(Math.floor(t/60)),e.seconds=$Date.append0(Math.floor(t%60))),e},isHourTimer:function(){return this.config.interval==SessionTimers.intervals.HOUR},isMinuteTimer:function(){return this.config.interval==SessionTimers.intervals.MINUTE},isSecondTimer:function(){return this.config.interval==SessionTimers.intervals.SECOND},updateDurationVisibility:function(e){this.isSecondTimer()&&this.hourElem.add(this.hourElem.next()).toggleClass("dN",e.hours<=0)}},{intervals:t,setTimer:function(t,i){if(!e[t]){var s=new a(t,i);e[t]=s,s.start()}},clearTimer:function(t){var i=e[t];i&&(i.stop(),delete e[t])}}}(),$WC=$WC||{};$WC.Matcher={regexes:{gmail:/^[A-Za-z0-9](\.?[A-Za-z0-9]){5,}@gmail\.com$/,facebook:/^[A-Za-z0-9\.]+$/,yahoo:/^[A-Za-z0-9]((\.|_)?[A-Za-z0-9]){5,}@(yahoo|ymail|rocketmail)\.com$/,msn:/^[A-Za-z0-9-_](\.?[A-Za-z0-9-_]){5,}@(outlook|hotmail|live)\.com$/,edge_useragent_lowercase:/edge\/(\d+)/,chrome_useragent_lowercase:/(?:chrome|crios)\/(\d+)/,firefox_useragent_lowercase:/(?:firefox|fxios)\/(\d+)/,opera_useragent_lowercase:/(?:^opera.+?version|opr)\/(\d+)/,ie_useragent_lowercase:/(?:msie |trident.+?; rv:)(\d+)/,safari_useragent_lowercase:/version\/(\d+).+?safari/,qq:/^[0-9]+$/,icq:/^[0-9]+$/,emailid:/^[A-Za-z0-9]([A-Za-z0-9-._%+']*)@[A-Za-z0-9-.]+\.[a-zA-Z]{2,30}$/,empty:/^\s*$/,hexcolourcode:/^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,customdate:/^(0?[1-9]|1[012])\/(0?[1-9]|[12][0-9]|3[01])\/([0-9]{1,4})$/,time:/^(0?[1-9]|1[012])(:[0-5]\d)[APap][mM]$|^([01]?[0-9]|2[0-3]):[0-5]\d$/,escaperegexp:/[-[\]{}()*+?.,\\^$|#\s]/g,escapeReplacementString:/\$/g,removespaces:/ /g,removehtmltag:/<([a-z0-9]+)(?:.*?)(?:>(?:([\s\S]*?)<\/\1>)?)/g,containerid:/[^a-zA-Z0-9]/g,mail:/([a-z0-9]([a-z0-9_\-.+]*)@([a-z0-9_\-.]*)(\.[a-z]{2,30}(\.[a-z]{2}){0,2}))/,link:/(?:(href|src)=["']?)?((https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@]*?)(?=[\s"'<]|$)/gi,markdown_image:/(^|\s)!\[(.+?)\]\(((?:https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@ ]*?)\)(?=$|\s)/gi,markdown_link:/(^|\s)\[(.+?)\]\(((?:https?:\/\/(?:www\.)?|www\.)[a-z0-9][^ ]*?)\)(?=$|\s|\.)/gi,markdown_quote:/(?:^|\n)!(.+?)(?:\n|$)/gm,markdown_heading:/(?:^|\n)(\#{1,6}) (.*?\S *)(?:\n|$)/gm,markdown_line:/(^|[\n])(\*{3,}|\-{3,})(?=$|[\n])(.*)/g,markdown_codeblock:/(^|\s)`{3}((?:(?:.*?$)\n)?(?:[\s\S]*?))`{3}(?=$|\s)/g,markdown_code:/(^|\s)\`(.*?\S *)?\`(?=$|\s)/g,markdown_bold:/(^|\s|[{\[])\*(.*?\S *)?\*(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_italic:/(^|\s|[{\[])\_(.*?\S *)?\_(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_strike:/(^|\s|[{\[])\~(.*?\S *)?\~(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_underscore:/(^|\s|[{[])__(.*?\S *)?__(?=$|\s|[.,?:;\-}\]](?:$|\s))/g,atmention:/{mention:(.+?):([0-9]):(.+?):mention}/g,zcatmention:/{mention:(.*?):mention}/g,atmention_for_transcript:/<div prop="mention"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,addmember:/{addchatmember:(.+?):([0-9]):(.+?):addchatmember}/g,addmember_for_transcript:/<div prop="addchatmember"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,deletemember:/{deletechatmember:(.+?):([0-9]):(.+?):deletechatmember}/g,deletemember_for_transcript:/<div prop="deletechatmember"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,text_doublequoted:/(^|\s|[{\[])\"(.*?\S *)?\"(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,text_singlequoted:/(^|\s|[{\[])\'(.*?\S *)?\'(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,addchatmember:/{addchatmember:(.*?):addchatmember}/g,deletechatmember:/{deletechatmember:(.*?):deletechatmember}/g,atmentiontemplate:/<div prop="(mention|addchatmember|deletechatmember)"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/,imagemimetype:/^image\/.+$/,audiomimetype:/^audio\/.+$/,videomimetype:/^video\/.+$/,ipaddress:/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/,invalidfilenamechars:/[`~!\$%\^&\|\\\"<>\?\/]/g,chrome_useragent:/Chrome[\/\s]/g,domainurl:/((?:https?:\/\/)(?:www\.)?((?:[^\/]+)))(?:.*)/g,textpattern:/^[0-9a-zA-Z_\-#\&\,\.';\$@\?\,\:\+\%\^\*\(\)\`\|\\\=\/\!\[\]~\{\}\u0080-\u9fff\s]+$/,linkRegExp:/(((http(s){0,1}:\/\/))([^ <\n\"]*))/,invalidlink:/((href|src)=["']((http(s){0,1}:\/\/)|(www\.))([^ <\n]*))/,WWWlinkRegExp:/([^(href|src|\/\/)"'=])?((www\.)([^ <\n\"]*))/,zcWWWlinkRegExp:/((www\.)[a-z0-9][^@]*?)(?=&quot;|&#x27;|&lt;|[\s"')<]|$)/,threeletterendinglink:/(^|\ )(([\w\d-]+\.)+(com|org|net|int|edu|gov|mil|biz|info))(?=( |$))/,twoletterendinglink:/(^|\ )(([\w\d\-]+\.)+((?!js|cp|do)[a-z]){2})(?=( |$))/,escaperegexpinid:/([:\.\[\],\!\"\#\$@%\&\'\(\)\*\+\/\;\?\^\`\{\}\|\~])/g,commandpattern:/^([a-zA-Z])*$/,functionname:/^([a-zA-Z])*$/,removespecialchars:/(\s+)?[-~!@%&[\]{}<>()*+?.,_\/\\^$|:;'`"#\s](\s+)?/g,imagesize:/^(stamp|thumb|medium|original)$/,horizontal_rule_tag:/<hr>/,markdown_blockquote_html:/<blockquote>(.*?)<\/blockquote>/,markdown_codeblock_html:/<pre>(.*?)<\/pre>/,channelpermalink:/^\/channel\/((ext:)?[a-zA-Z])*$/,usersilentmention:/(^|\s)\[(.+?)\]\(zohoid:([0-9]+?)\)(?=$|\s)/g,phonenumber:/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/,pincode:/^([A-Z0-9\-\. ])+$/,zcatmention_v2:/{[@#](.*?)}/g},regexReplaceStr:{escapeReplacementString:"$$$",escaperegexp:"\\$&",escaperegexpinid:"\\$1",removespaces:"",trimBRtag:"",containerid:"",mail:"<a href='mailto:$1'>$1</a>"},check:function(e,t,i){return i&&t&&(t=t.trim()),this.regexes[e].lastIndex=0,this.regexes[e].test(t)},checkWithFlag:function(e,t,i,a){a&&t&&(t=t.trim()),this.regexes[e].lastIndex=0;var s=new RegExp(this.regexes[e].source,i);return s.test(t)},match:function(e,t,i){var i="undefined"!=typeof i?i:"g",a=new RegExp(this.regexes[e].source,i);return t.match(a)},replacer:function(e,t,i,a){return"undefined"==typeof a&&(a=this.regexReplaceStr[t]),i.replace(e,a)},replace:function(e,t,i){return this.replacer(this.regexes[e],e,t,i)},replaceWithFlag:function(e,t,i,a){var s=new RegExp(this.regexes[e].source,i);return this.replacer(s,e,t,a)},getRegexToGetAttrValueInHtmlTag:function(e,t){return new RegExp("(<("+e+")[^>]*?\\s"+t+"=(\"|'|\\\\\"|\\\\'))(\\S+)((\\3)([^>]*?(?:>(?:[^<]*?<\\/\\2>)?)))")},getRegexToAddAttrToHtmlTag:function(e){return new RegExp("(<("+e+"))([^>]*?(\\s\\S+=\\S+)?>(?:(?:[^<]*?)<\\/\\2>)?)")}};var $DB={};$DB={storage:{status:function(){return{Default:["Available","1"],User:[],System:["Available","Busy","Invisible"]}}()},basestoragekeys:["contacts","orggroups","suggestions","chats","pinnedchats","bot","groups","users","status","commands","messageactions","functions","bots","schedulers","platformdatabases","mybots","events","seenevents","applications","recentsearch","recentsmiley","calendars","mediadevicepref","orginvitees","reminders","department","tour","participants"],allowedsessionstorage:["status","groups","commands","messageactions","uielements","bots","recentsearch","recentsmiley","mediadevicepref","tour"],sessionstoragesupport:!1,init:function(){for(var e in $DB.basestoragekeys)this.isEmpty($DB.basestoragekeys[e])&&(this.storage[$DB.basestoragekeys[e]]={});if(this.sessionstoragesupport=this.isStorageSupported("session"),this.sessionstoragesupport){this.initSessionStorage();for(var e in $DB.allowedsessionstorage)this.storage[$DB.allowedsessionstorage[e]]=JSON.parse(sessionStorage.getItem($DB.allowedsessionstorage[e]))||this.storage[$DB.allowedsessionstorage[e]]}},isStorageSupported:function(e){var t="test",i={session:window.sessionStorage,local:window.localStorage},a=i[e];try{return a.setItem(t,"1"),a.removeItem(t),!0}catch(s){return!1}},initSessionStorage:function(){var e=$zcg._ZUID,t=sessionStorage.getItem("ownerid");t&&t!==e&&this.clearSessionStorage(),sessionStorage.setItem("ownerid",e)},isAllowedSessionStorage:function(e){return $.inArray(e,$DB.allowedsessionstorage)>-1&&$DB.sessionstoragesupport},get:function(e){var t=this.storage[e];return t&&t.timestamp&&this.checkAndClearFromSessionStorage(e),this.storage[e]},checkAndClearFromSessionStorage:function(e){var t=this.storage[e];(new Date).getTime()>t.timestamp&&this.clear(e)},update:function(e,t,i){i&&(t.timestamp=i),this.isAllowedSessionStorage(e)?(sessionStorage.setItem(e,JSON.stringify(t)),this.storage[e]=JSON.parse(sessionStorage.getItem(e))):this.storage[e]="undefined"==typeof t?{}:t},clear:function(e){this.isAllowedSessionStorage(e)&&sessionStorage.removeItem(e),this.storage[e]={}},clearSessionStorage:function(){for(var e in $DB.allowedsessionstorage)sessionStorage.removeItem($DB.allowedsessionstorage[e])},isEmpty:function(e){return $.isEmptyObject(this.storage[e])}};var Smiley={};Smiley={alldefaultcodes:{},defaultcodes:{},htmlcodes:{},extracodes_shortcut:{},extracodes:{},flagcodes:{},smileyobj:{},RECENT_SMILEY:"1",SMILEY_ANIM:"2",SMILEY:"3",EMOJIS:"4",GIPFY:"5",category:{1:Resource.getRealValue("smiley.recent"),2:Resource.getRealValue("smiley.animated"),3:Resource.getRealValue("smiley.cliq"),4:Resource.getRealValue("smiley.emoji"),5:Resource.getRealValue("smiley.gipfy")},searchhtml:'<div class="zcsimleys" elemtype="smiley"><div class="smlglst" purpose="search" code="{SMILEYCODE}"><em class="{CLASSNAME}"></em><span code="{SMILEYCODE}">{RESOURCEDSMILEYNAME}</span></div></div>',smileyhtml:'<div class="smlynone"><div class="{SMILEYNAME}" code="{SMILEYCODE}" unicode="{UNICODE}" title="{TITLE}">{UNICODE}</div></div>',gipfy_container_html:'<div id="imgsuggcont" class="zcimgprvcont" id="compautocomplete{CHID}"><div id="imgsuggpreview" purpose="search" class="zcimgsuggpreview cur"><img data-purpose="preview" src="{PREVIEWGIPFY}" owidth="{WIDTH}" oheight="{HEIGHT}" osrc="{ORIGINAL_SRC}"/></div><div class="zcimgsug" data-purpose="gifbox">{GIPFYHTML}</div></div>',gipfy_html:'<div imgurl="{IMGURL}" class="cur {CLASSNAME}"><img data-purpose="gipfy_img" src="{IMGURL}" owidth="{WIDTH}" oheight="{HEIGHT}" osrc="{ORIGINAL_SRC}"/></div>',noresults_html:'<span class="absmiddle" data-purpose="nodata"><em>&#x1f625;</em><br>'+Resource.getRealValue("smiley.noresult",["<b>{SEARCH_TERM}</b>"])+"</span>",smileycategoryhtml:'<div id="{ID}" class="zc-smiley posrel"><div class="wccontent-node clearfix">{CONTENT}</div><div class="grayish">{TITLE}</div></div>',empty_criteria_result:'<div class="no_category_reslt" id="no_category_reslt"><div class="dsp_tble"><div class="dsp_tble_cell">'+Resource.getRealValue("smiley.category.noresult",["<b>{CATEGORY}</b>"])+'</div></div><div class="zcinhds">'+Resource.getRealValue("smiley.suggestion")+"</div></div>",init:function(){this.alldefaultcodes[":)"]="smile",this.alldefaultcodes[":)"]="smile",this.alldefaultcodes[":D"]="happy",this.alldefaultcodes["B-)"]="cool",this.alldefaultcodes[":xs"]="love",this.alldefaultcodes[":-?"]="thinking",this.alldefaultcodes["*-:)"]="idea",this.alldefaultcodes[";)"]="wink",this.alldefaultcodes[":-P"]="razz",this.alldefaultcodes["-_-"]="relaxed",this.alldefaultcodes["(a)"]="peace",this.alldefaultcodes[":("]="sad",this.alldefaultcodes["D:"]="anxious",this.alldefaultcodes[":-s"]="worry",this.alldefaultcodes["-.-"]="stressed-out",this.alldefaultcodes["X-("]="angry",this.alldefaultcodes["(=_=)"]="tired",this.alldefaultcodes["|-)"]="sleepy",this.alldefaultcodes["?D"]="doubt",this.alldefaultcodes[":o"]="surprise",this.alldefaultcodes["(6.6)"]="faint",this.alldefaultcodes["(({..}))"]="headache",this.alldefaultcodes["+o("]="sick",this.alldefaultcodes[":/"]="smirk",this.alldefaultcodes[":-#"]="keep-quiet",this.alldefaultcodes[":-{}"]="feeling-cold",this.alldefaultcodes["(y)"]="thumbsup",this.alldefaultcodes["(n)"]="thumbsdown",this.alldefaultcodes["C(_)"]="coffee-cup",this.extracodes_shortcut={":-)":"smile",":^)":"smile",":]":"smile",":-(":"sad",":(":"sad",":[":"sad",":d":"happy",":-d":"happy",":))":"happy",":-))":"happy","b-)":"cool",":-@":"angry",":@":"angry",":-p":"razz",":p":"razz","d:":"anxious",";-)":"wink",":-/":"smirk",":-o":"surprise",":o":"surprise",":s":"worry",":-s":"worry","i-)":"sleepy","x-(":"angry","?d":"doubt",":-x":"keep-quiet","o-)":"peace","o:)":"peace","o:-)":"peace",":+1:":"thumbsup",":x-":"thumbsup",":-1:":"thumbsdown","c(_)":"coffee-cup"},this.extracodes={expressions:{":smile:":[],":happy:":[],":joy:":[],":grinning:":[],":cool:":[],":love:":[],":curious:":[],":awe:":[],":thinking:":[],":search:":[],":idea:":[],":wink:":[],":razz:":[],":relaxed:":[],":peace:":[],":blush:":[],":yummy:":[],":yuck:":[],":sad:":[],":upset:":[],":anxious:":[],":worry:":[],":stressed-out:":[],":angry:":[],":tensed:":[],":tired:":[],":bored:":[],":sleepy:":[],":jealous:":[],":evil:":[],":facepalm:":[],":doubt:":[],":surprise:":[],":faint:":[],":headache:":[],":sick:":[],":injured:":[],":neutral:":[],":smirk:":[],":keep-quiet:":[],":feeling-warm:":[],":feeling-cold:":[],":thumbsup:":[],":thumbsdown:":[],":namaste:":[],":super:":[],":victory:":[],":yoyo:":[],":raising-hand:":[],":clap:":[],":bye-bye:":[],":fist:":[],":biceps:":[]},celebrate:{":birthday:":[],":champagne:":[],":christmas-tree:":[],":eid-mubarak:":[],":fireworks:":[],":gift-box:":[],":kaaba:":[],":new-year:":[],":party:":[],":santa-hat:":[]},general:{":coffee-cup:":[],":food:":[],":chicken:":[],":fire:":[],":fire-extinguisher:":[],":first-aid-box:":[],":medicine:":[],":poop:":[],":peanuts:":[],":refugee-olympic-team:":[],":target:":[],":task:":[],":report:":[],":bug:":[],":milestone:":[],":calendar:":[],":security:":[],":processor:":[],":laptop:":[],":server:":[]},"sports & games":{":break-boy:":[],":break-girl:":[],":singing:":[],":man-dancing:":[],":man-cycling:":[],":man-running:":[],":man-swimming:":[],":woman-dancing:":[],":woman-cycling:":[],":woman-running:":[],":woman-swimming:":[],":yoga:":[],":badminton:":[],":baseball:":[],":basketball:":[],":chess:":[],":cricket:":[],":flag:":[],":foosball:":[],":football:":[],":golf:":[],":hockey:":[],":snooker:":[],":table-tennis:":[],":tennis:":[],":volleyball:":[],":gold-medal:":[],":silver-medal:":[],":bronze-medal:":[],":archer:":[],":boxer:":[],":badminton-player:":[],":basketball-player:":[],":batsman:":[],":batter:":[],":bowler:":[],":canoeing:":[],":chess-player:":[],":discus-throw:":[],":diver:":[],":equestrian:":[],":fencer:":[],":football-player:":[],":female-tennis-player:":[],":female-tabletennis-player:":[],":female-volleyball-player:":[],":golfer:":[],":gymnast:":[],":hockey-player:":[],":hammer-throw:":[],":hurdler:":[],":javelin-throw:":[],":judo:":[],":long-jump:":[],":pole-vault:":[],":athlete:":[],":rhythmic-gymnastics:":[],":shooter:":[],":shotput-throw:":[],":high-jump:":[],":karate:":[],":male-tabletennis-player:":[],":male-volleyball-player:":[],":male-tennis-player:":[],":pitcher:":[],":snooker-player:":[],":weightlifting:":[],":wrestling:":[]},travel:{":bicycle:":[],":sports-bike:":[],":cruiser-bike:":[],":motor-scooter:":[],":car:":[],":taxi:":[],":bus:":[],":train:":[],":police-car:":[],":ambulance:":[],":fire-engine:":[],":aeroplane:":[],":passenger-ship:":[],":parking:":[],":cafeteria:":[],":garden:":[],":playground:":[],":home:":[],":office:":[],":library:":[],":auditorium:":[],":store:":[],":mail-room:":[],":pharmacy:":[],":gym:":[],":americas:":[],":europe-africa:":[],":asia-pacific:":[]}},this.emoji={people:{":smile:":["#x1f604"],":smiley:":["#x1f603"],":grinning:":["#x1f600"],":blush:":["#x1f60a"],":wink:":["#x1f609"],":heart-eyes:":["#x1f60d"],":kissing-heart:":["#x1f618"],":kissing-closed-eyes:":["#x1f61a"],":kissing:":["#x1f617"],":kissing-smiling-eyes:":["#x1f619"],":stuck-out-tongue-winking-eye:":["#x1f61c"],":stuck-out-tongue-closed-eyes:":["#x1f61d"],":stuck-out-tongue:":["#x1f61b"],":flushed:":["#x1f633"],":grin:":["#x1f601"],":pensive:":["#x1f614"],":relieved:":["#x1f60c"],":unamused:":["#x1f612"],":disappointed:":["#x1f61e"],":persevere:":["#x1f623"],":cry:":["#x1f622"],":joy:":["#x1f602"],":sob:":["#x1f62d"],":sleepy:":["#x1f62a"],":disappointed-relieved:":["#x1f625"],":cold-sweat:":["#x1f630"],":sweat-smile:":["#x1f605"],":sweat:":["#x1f613"],":weary:":["#x1f629"],":tired-face:":["#x1f62b"],":fearful:":["#x1f628"],":scream:":["#x1f631"],":angry:":["#x1f620"],":rage:":["#x1f621"],":triumph:":["#x1f624"],":confounded:":["#x1f616"],":laughing:":["#x1f606"],":yum:":["#x1f60b"],":mask:":["#x1f637"],":sunglasses:":["#x1f60e"],":sleeping:":["#x1f634"],":dizzy-face:":["#x1f635"],":astonished:":["#x1f632"],":worried:":["#x1f61f"],":frowning:":["#x1f626"],":anguished:":["#x1f627"],":imp:":["#x1f47f"],":open-mouth:":["#x1f62e"],":grimacing:":["#x1f62c"],":neutral-face:":["#x1f610"],":confused:":["#x1f615"],":hushed:":["#x1f62f"],":smirk:":["#x1f60f"],":expressionless:":["#x1f611"],":man-with-gua-pi-mao:":["#x1f472"],":man-with-turban:":["#x1f473"],":cop:":["#x1f46e"],":construction-worker:":["#x1f477"],":guardsman:":["#x1f482"],":baby:":["#x1f476"],":boy:":["#x1f466"],":girl:":["#x1f467"],":man:":["#x1f468"],":woman:":["#x1f469"],":older-man:":["#x1f474"],":older-woman:":["#x1f475"],":person-with-blond-hair:":["#x1f471"],":angel:":["#x1f47c"],":princess:":["#x1f478"],":smiley-cat:":["#x1f63a"],":smile-cat:":["#x1f638"],":heart-eyes-cat:":["#x1f63b"],":kissing-cat:":["#x1f63d"],":smirk-cat:":["#x1f63c"],":scream-cat:":["#x1f640"],":crying-cat-face:":["#x1f63f"],":joy-cat:":["#x1f639"],":pouting-cat:":["#x1f63e"],":japanese-ogre:":["#x1f479"],":japanese-goblin:":["#x1f47a"],":see-no-evil:":["#x1f648"],":hear-no-evil:":["#x1f649"],":speak-no-evil:":["#x1f64a"],":skull:":["#x1f480"],":alien:":["#x1f47d"],":hankey:":["#x1f4a9"],":fire:":["#x1f525"],":sparkles:":["#x2728"],":star2:":["#x1f31f"],":dizzy:":["#x1f4ab"],":boom:":["#x1f4a5"],":anger:":["#x1f4a2"],":sweat-drops:":["#x1f4a6"],":droplet:":["#x1f4a7"],":zzz:":["#x1f4a4"],":dash:":["#x1f4a8"],":ear:":["#x1f442"],":eyes:":["#x1f440"],":nose:":["#x1f443"],":tongue:":["#x1f445"],":lips:":["#x1f444"],":thumbs-up:":["#x1f44d"],":thumbs-down:":["#x1f44e"],":ok-hand:":["#x1f44c"],":facepunch:":["#x1f44a"],":fist:":["#x270A"],":wave:":["#x1f44b"],":hand:":["#x270B"],":open-hands:":["#x1f450"],":point-up-2:":["#x1f446"],":point-down:":["#x1f447"],":point-right:":["#x1f449"],":point-left:":["#x1f448"],":raised-hands:":["#x1f64c"],":pray:":["#x1f64f"],":clap:":["#x1f44f"],":muscle:":["#x1f4aa"],":walking:":["#x1f6b6"],":runner:":["#x1f3c3"],":dancer:":["#x1f483"],":couple:":["#x1f46b"],":family:":["#x1f46a"],":couplekiss:":["#x1f48f"],":couple-with-heart:":["#x1f491"],":dancers:":["#x1f46f"],":ok-woman:":["#x1f646"],":no-good:":["#x1f645"],":information-desk-person:":["#x1f481"],":raising-hand:":["#x1f64b"],":massage:":["#x1f486"],":haircut:":["#x1f487"],":nail-care:":["#x1f485"],":bride-with-veil:":["#x1f470"],":person-with-pouting-face:":["#x1f64e"],":person-frowning:":["#x1f64d"],":bow:":["#x1f647"],":tophat:":["#x1f3a9"],":crown:":["#x1f451"],":womans-hat:":["#x1f452"],":athletic-shoe:":["#x1f45f"],":mans-shoe:":["#x1f45e"],":sandal:":["#x1f461"],":high-heel:":["#x1f460"],":boot:":["#x1f462"],":shirt:":["#x1f455"],":necktie:":["#x1f454"],":womans-clothes:":["#x1f45a"],":dress:":["#x1f457"],":running-shirt-with-sash:":["#x1f3bd"],":jeans:":["#x1f456"],":kimono:":["#x1f458"],":bikini:":["#x1f459"],":briefcase:":["#x1f4bc"],":handbag:":["#x1f45c"],":pouch:":["#x1f45d"],":purse:":["#x1f45b"],":eyeglasses:":["#x1f453"],":ribbon:":["#x1f380"],":closed-umbrella:":["#x1f302"],":lipstick:":["#x1f484"],":yellow-heart:":["#x1f49b"],":blue-heart:":["#x1f499"],":purple-heart:":["#x1f49c"],":green-heart:":["#x1f49a"],":broken-heart:":["#x1f494"],":heartpulse:":["#x1f497"],":heartbeat:":["#x1f493"],":two-hearts:":["#x1f495"],":sparkling-heart:":["#x1f496"],":revolving-hearts:":["#x1f49e"],":cupid:":["#x1f498"],":love-letter:":["#x1f48c"],":kiss:":["#x1f48b"],":ring:":["#x1f48d"],":gem:":["#x1f48e"],":bust-in-silhouette:":["#x1f464"],":speech-balloon:":["#x1f4ac"],":footprints:":["#x1f463"]},nature:{":dog:":["#x1f436"],":wolf:":["#x1f43a"],":cat:":["#x1f431"],":mouse:":["#x1f42d"],":hamster:":["#x1f439"],":rabbit:":["#x1f430"],":frog:":["#x1f438"],":tiger:":["#x1f42f"],":koala:":["#x1f428"],":bear:":["#x1f43b"],":pig:":["#x1f437"],":pig-nose:":["#x1f43d"],":cow:":["#x1f42e"],":boar:":["#x1f417"],":monkey-face:":["#x1f435"],":monkey:":["#x1f412"],":horse:":["#x1f434"],":sheep:":["#x1f411"],":elephant:":["#x1f418"],":panda-face:":["#x1f43c"],":penguin:":["#x1f427"],":bird:":["#x1f426"],":baby-chick:":["#x1f424"],":hatched-chick:":["#x1f425"],":hatching-chick:":["#x1f423"],":chicken:":["#x1f414"],":snake:":["#x1f40d"],":turtle:":["#x1f422"],":bug:":["#x1f41b"],":bee:":["#x1f41d"],":ant:":["#x1f41c"],":beetle:":["#x1f41e"],":snail:":["#x1f40c"],":octopus:":["#x1f419"],":shell:":["#x1f41a"],":tropical-fish:":["#x1f420"],":fish:":["#x1f41f"],":dolphin:":["#x1f42c"],":whale:":["#x1f433"],":racehorse:":["#x1f40e"],":dragon-face:":["#x1f432"],":blowfish:":["#x1f421"],":camel:":["#x1f42b"],":poodle:":["#x1f429"],":feet:":["#x1f43e"],":bouquet:":["#x1f490"],":cherry-blossom:":["#x1f338"],":tulip:":["#x1f337"],":four-leaf-clover:":["#x1f340"],":rose:":["#x1f339"],":sunflower:":["#x1f33b"],":hibiscus:":["#x1f33a"],":maple-leaf:":["#x1f341"],":leaves:":["#x1f343"],":fallen-leaf:":["#x1f342"],":herb:":["#x1f33f"],":ear-of-rice:":["#x1f33e"],":mushroom:":["#x1f344"],":cactus:":["#x1f335"],":palm-tree:":["#x1f334"],":chestnut:":["#x1f330"],":seedling:":["#x1f331"],":blossom:":["#x1f33c"],":new-moon:":["#x1f311"],":first-quarter-moon:":["#x1f313"],":moon:":["#x1f314"],":full-moon:":["#x1f315"],":first-quarter-moon-with-face:":["#x1f31b"],":crescent-moon:":["#x1f319"],":earth-asia:":["#x1f30f"],":volcano:":["#x1f30b"],":milky-way:":["#x1f30c"],":stars:":["#x1f320"],":partly-sunny:":["#x26C5"],":snowman:":["#x26C4"],":cyclone:":["#x1f300"],":foggy:":["#x1f301"],":rainbow:":["#x1f308"],":ocean:":["#x1f30a"]},objects:{":bamboo:":["#x1f38d"],":gift-heart:":["#x1f49d"],":dolls:":["#x1f38e"],":school-satchel:":["#x1f392"],":mortar-board:":["#x1f393"],":flags:":["#x1f38f"],":fireworks:":["#x1f386"],":sparkler:":["#x1f387"],":wind-chime:":["#x1f390"],":rice-scene:":["#x1f391"],":jack-o-lantern:":["#x1f383"],":ghost:":["#x1f47b"],":santa:":["#x1f385"],":christmas-tree:":["#x1f384"],":gift:":["#x1f381"],":tanabata-tree:":["#x1f38b"],":tada:":["#x1f389"],":confetti-ball:":["#x1f38a"],":balloon:":["#x1f388"],":crossed-flags:":["#x1f38c"],":crystal-ball:":["#x1f52e"],":movie-camera:":["#x1f3a5"],":camera:":["#x1f4f7"],":video-camera:":["#x1f4f9"],":vhs:":["#x1f4fc"],":cd:":["#x1f4bf"],":dvd:":["#x1f4c0"],":minidisc:":["#x1f4bd"],":floppy-disk:":["#x1f4be"],":computer:":["#x1f4bb"],":iphone:":["#x1f4f1"],":telephone-receiver:":["#x1f4de"],":pager:":["#x1f4df"],":fax:":["#x1f4e0"],":satellite:":["#x1f4e1"],":tv:":["#x1f4fa"],":radio:":["#x1f4fb"],":loud-sound:":["#x1f50a"],":bell:":["#x1f514"],":loudspeaker:":["#x1f4e2"],":mega:":["#x1f4e3"],":hourglass-flowing-sand:":["#x23F3"],":hourglass:":["#x231B"],":alarm-clock:":["#x23F0"],":watch:":["#x231A"],":unlock:":["#x1f513"],":lock:":["#x1f512"],":lock-with-ink-pen:":["#x1f50f"],":closed-lock-with-key:":["#x1f510"],":key:":["#x1f511"],":mag-right:":["#x1f50e"],":bulb:":["#x1f4a1"],":flashlight:":["#x1f526"],":electric-plug:":["#x1f50c"],":battery:":["#x1f50b"],":mag:":["#x1f50d"],":bath:":["#x1f6c0"],":toilet:":["#x1f6bd"],":wrench:":["#x1f527"],":nut-and-bolt:":["#x1f529"],":hammer:":["#x1f528"],":door:":["#x1f6aa"],":smoking:":["#x1f6ac"],":bomb:":["#x1f4a3"],":gun:":["#x1f52b"],":hocho:":["#x1f52a"],":pill:":["#x1f48a"],":syringe:":["#x1f489"],":moneybag:":["#x1f4b0"],":yen:":["#x1f4b4"],":dollar:":["#x1f4b5"],":credit-card:":["#x1f4b3"],":money-with-wings:":["#x1f4b8"],":calling:":["#x1f4f2"],":e-mail:":["#x1f4e7"],":inbox-tray:":["#x1f4e5"],":outbox-tray:":["#x1f4e4"],":envelope-with-arrow:":["#x1f4e9"],":incoming-envelope:":["#x1f4e8"],":mailbox:":["#x1f4eb"],":mailbox-closed:":["#x1f4ea"],":postbox:":["#x1f4ee"],":package:":["#x1f4e6"],":memo:":["#x1f4dd"],":page-facing-up:":["#x1f4c4"],":page-with-curl:":["#x1f4c3"],":bookmark-tabs:":["#x1f4d1"],":bar-chart:":["#x1f4ca"],":chart-with-upwards-trend:":["#x1f4c8"],":chart-with-downwards-trend:":["#x1f4c9"],":scroll:":["#x1f4dc"],":clipboard:":["#x1f4cb"],":date:":["#x1f4c5"],":calendar:":["#x1f4c6"],":card-index:":["#x1f4c7"],":file-folder:":["#x1f4c1"],":open-file-folder:":["#x1f4c2"],":pushpin:":["#x1f4cc"],":paperclip:":["#x1f4ce"],":straight-ruler:":["#x1f4cf"],":triangular-ruler:":["#x1f4d0"],":closed-book:":["#x1f4d5"],":green-book:":["#x1f4d7"],":blue-book:":["#x1f4d8"],":orange-book:":["#x1f4d9"],":notebook:":["#x1f4d3"],":notebook-with-decorative-cover:":["#x1f4d4"],":ledger:":["#x1f4d2"],":books:":["#x1f4da"],":book:":["#x1f4d6"],":bookmark:":["#x1f516"],":name-badge:":["#x1f4db"],":newspaper:":["#x1f4f0"],":art:":["#x1f3a8"],":clapper:":["#x1f3ac"],":microphone:":["#x1f3a4"],":headphones:":["#x1f3a7"],":musical-score:":["#x1f3bc"],":musical-note:":["#x1f3b5"],":notes:":["#x1f3b6"],":musical-keyboard:":["#x1f3b9"],":violin:":["#x1f3bb"],":trumpet:":["#x1f3ba"],":saxophone:":["#x1f3b7"],":guitar:":["#x1f3b8"],":space-invader:":["#x1f47e"],":video-game:":["#x1f3ae"],":black-joker:":["#x1f0cf"],":flower-playing-cards:":["#x1f3b4"],":mahjong:":["#x1f004"],":game-die:":["#x1f3b2"],":dart:":["#x1f3af"],":football:":["#x1f3c8"],":basketball:":["#x1f3c0"],":soccer:":["#x26BD"],":baseball:":["#x26BE"],":tennis:":["#x1f3be"],":8ball:":["#x1f3b1"],":bowling:":["#x1f3b3"],":golf:":["#x26F3"],":checkered-flag:":["#x1f3c1"],":trophy:":["#x1f3c6"],":ski:":["#x1f3bf"],":snowboarder:":["#x1f3c2"],":swimmer:":["#x1f3ca"],":surfer:":["#x1f3c4"],":fishing-pole-and-fish:":["#x1f3a3"],":tea:":["#x1f375"],":sake:":["#x1f376"],":beer:":["#x1f37a"],":beers:":["#x1f37b"],":cocktail:":["#x1f378"],":tropical-drink:":["#x1f379"],":wine-glass:":["#x1f377"],":fork-and-knife:":["#x1f374"],":pizza:":["#x1f355"],":hamburger:":["#x1f354"],":fries:":["#x1f35f"],":poultry-leg:":["#x1f357"],":meat-on-bone:":["#x1f356"],":spaghetti:":["#x1f35d"],":curry:":["#x1f35b"],":fried-shrimp:":["#x1f364"],":bento:":["#x1f371"],":sushi:":["#x1f363"],":fish-cake:":["#x1f365"],":rice-ball:":["#x1f359"],":rice-cracker:":["#x1f358"],":rice:":["#x1f35a"],":ramen:":["#x1f35c"],":stew:":["#x1f372"],":oden:":["#x1f362"],":dango:":["#x1f361"],":egg:":["#x1f373"],":bread:":["#x1f35e"],":doughnut:":["#x1f369"],":custard:":["#x1f36e"],":icecream:":["#x1f366"],":ice-cream:":["#x1f368"],":shaved-ice:":["#x1f367"],":birthday:":["#x1f382"],":cake:":["#x1f370"],":cookie:":["#x1f36a"],":chocolate-bar:":["#x1f36b"],":candy:":["#x1f36c"],":lollipop:":["#x1f36d"],":honey-pot:":["#x1f36f"],":apple:":["#x1f34e"],":green-apple:":["#x1f34f"],":tangerine:":["#x1f34a"],":cherries:":["#x1f352"],":grapes:":["#x1f347"],":watermelon:":["#x1f349"],":strawberry:":["#x1f353"],":peach:":["#x1f351"],":melon:":["#x1f348"],":banana:":["#x1f34c"],":pineapple:":["#x1f34d"],":sweet-potato:":["#x1f360"],":eggplant:":["#x1f346"],":tomato:":["#x1f345"],":corn:":["#x1f33d"]},places:{":house:":["#x1f3e0"],":house-with-garden:":["#x1f3e1"],":school:":["#x1f3eb"],":office:":["#x1f3e2"],":post-office:":["#x1f3e3"],":hospital:":["#x1f3e5"],":bank:":["#x1f3e6"],":convenience-store:":["#x1f3ea"],":love-hotel:":["#x1f3e9"],":hotel:":["#x1f3e8"],":wedding:":["#x1f492"],":church:":["#x26EA"],":department-store:":["#x1f3ec"],":city-sunrise:":["#x1f307"],":city-sunset:":["#x1f306"],":japanese-castle:":["#x1f3ef"],":european-castle:":["#x1f3f0"],":tent:":["#x26FA"],":factory:":["#x1f3ed"],":tokyo-tower:":["#x1f5fc"],":japan:":["#x1f5fe"],":mount-fuji:":["#x1f5fb"],":sunrise-over-mountains:":["#x1f304"],":sunrise:":["#x1f305"],":night-with-stars:":["#x1f303"],":statue-of-liberty:":["#x1f5fd"],":bridge-at-night:":["#x1f309"],":carousel-horse:":["#x1f3a0"],":ferris-wheel:":["#x1f3a1"],":fountain:":["#x26F2"],":roller-coaster:":["#x1f3a2"],":ship:":["#x1f6a2"],":boat:":["#x26F5"],":speedboat:":["#x1f6a4"],":rocket:":["#x1f680"],":seat:":["#x1f4ba"],":station:":["#x1f689"],":bullettrain-side:":["#x1f684"],":bullettrain-front:":["#x1f685"],":metro:":["#x1f687"],":railway-car:":["#x1f683"],":bus:":["#x1f68c"],":blue-car:":["#x1f699"],":car:":["#x1f697"],":taxi:":["#x1f695"],":truck:":["#x1f69a"],":rotating-light:":["#x1f6a8"],":police-car:":["#x1f693"],":fire-engine:":["#x1f692"],":ambulance:":["#x1f691"],":bike:":["#x1f6b2"],":barber:":["#x1f488"],":busstop:":["#x1f68f"],":ticket:":["#x1f3ab"],":traffic-light:":["#x1f6a5"],":construction:":["#x1f6a7"],":beginner:":["#x1f530"],":fuelpump:":["#x26FD"],":izakaya-lantern:":["#x1f3ee"],":slot-machine:":["#x1f3b0"],":moyai:":["#x1f5ff"],":circus-tent:":["#x1f3aa"],":performing-arts:":["#x1f3ad"],":round-pushpin:":["#x1f4cd"],":triangular-flag-on-post:":["#x1f6a9"]}},this.linux=["black-joker","mahjong","hourglass","watch","cat","mouse","cow","monkey-face","fist","hand","sparkles","smiley-cat","smile-cat","heart-eyes-cat","kissing-cat","smirk-cat","scream-cat","crying-cat-face","joy-cat","pouting-cat","smile","smiley","grinning","blush","wink","heart-eyes","kissing-heart","kissing-closed-eyes","kissing","kissing-smiling-eyes","stuck-out-tongue-winking-eye","stuck-out-tongue-closed-eyes","stuck-out-tongue","flushed","grin","pensive","relieved","unamused","disappointed","persevere","cry","joy","sob","sleepy","disappointed-relieved","cold-sweat","sweat-smile","sweat","weary","tired-face","fearful","scream","angry","rage","confounded","laughing","yum","mask","sunglasses","sleeping","dizzy-face","astonished","worried","frowning","anguished","open-mouth","neutral-face","confused","hushed","smirk","expressionless"],this.windows=["grinning","kissing","kissing-smiling-eyes","stuck-out-tongue","sleeping","worried","frowning","anguished","open-mouth","grimacing","confused","hushed","expressionless"],this.flagcodes={":afghanistan:":[],":aland-islands:":[],":albania:":[],":algeria:":[],":american-samoa:":[],":andorra:":[],":angola:":[],":anguilla:":[],":antarctica:":[],":antigua-and-barbuda:":[],":argentina:":[],":armenia:":[],":aruba:":[],":australia:":[],":austria:":[],":azerbaijan:":[],":bahamas:":[],":bahrain:":[],":bangladesh:":[],":barbados:":[],":belarus:":[],":belgium:":[],":belize:":[],":benin:":[],":bermuda:":[],":bhutan:":[],":bolivia:":[],":bonaire:":[],":bosnia-and-herzegovina:":[],":botswana:":[],":brazil:":[],":british-antarctic:":[],":british-indian-ocean-territory:":[],":british-virgin:":[],":brunei-darussalam:":[],":bulgaria:":[],":burkina-faso:":[],":burundi:":[],":cambodia:":[],":cameroon:":[],":canada:":[],":cape-verde:":[],":cascadia:":[],":cayman-islands:":[],":central-african-republic:":[],":chad:":[],":chile:":[],":china:":[],":christmas-island:":[],":cocos:":[],":colombia:":[],":comoros:":[],":congo-kinshasa:":[],":congo:":[],":cook-islands:":[],":costa-rica:":[],":croatian:":[],":cuba:":[],":curacao:":[],":cyprus:":[],":czech-republic:":[],":denmark:":[],":djibouti:":[],":dominican-republic:":[],":east-timor:":[],":ecuador:":[],":egypt:":[],":el-salvador:":[],":england:":[],":equatorial-guinea:":[],":eritrea:":[],":estonia:":[],":ethiopia:":[],":european-union:":[],":yugoslavia:":[],":falkland-islands:":[],":faroe-islands:":[],":fiji:":[],":finland:":[],":france:":[],":french-polynesia:":[],":french-southern:":[],":gabon:":[],":gambia:":[],":georgia:":[],":germany:":[],":ghana:":[],":gibraltar:":[],":greece:":[],":greenland:":[],":grenada:":[],":guadeloupe:":[],":guam:":[],":guatemala:":[],":guernsey:":[],":guinea-bissau:":[],":guinea:":[],":guyana:":[],":haiti:":[],":honduras:":[],":hong-kong:":[],":hungary:":[],":iceland:":[],":india:":[],":indonesia:":[],":iran:":[],":iraq:":[],":ireland:":[],":isle-of-man:":[],":israel:":[],":italy:":[],":ivory-coast:":[],":jamaica:":[],":japan:":[],":jersey:":[],":jordan:":[],":kazakhstan:":[],":kenya:":[],":kiribati:":[],":kosovo:":[],":kuwait:":[],":kyrgyzstan:":[],":laos:":[],":latvia:":[],":lebanon:":[],":lesotho:":[],":liberia:":[],":libya:":[],":liechtenstein:":[],":lithuania:":[],":luxembourg:":[],":macau:":[],":macedonia:":[],":madagascar:":[],":malawi:":[],":malaysia:":[],":maldives:":[],":mali:":[],":malta:":[],":marshall-islands:":[],":martinique:":[],":mauritania:":[],":mauritius:":[],":mayotte:":[],":mexico:":[],":micronesia:":[],":moldova:":[],":monaco:":[],":mongolia:":[],":montenegro:":[],":montserrat:":[],":morocco:":[],":mozambique:":[],":myanmar:":[],":namibia:":[],":nauru:":[],":nepal:":[],":netherlands-antilles:":[],":netherlands:":[],":new-caledonia:":[],":new-zealand:":[],":nicaragua:":[],":niger:":[],":nigeria:":[],":niue:":[],":norfolk-island:":[],":north-korea:":[],":northern-ireland:":[],":northern-mariana:":[],":norway:":[],":oman:":[],":pakistan:":[],":palau:":[],":palestinian-territory:":[],":panama:":[],":papua-new-guinea:":[],":paraguay:":[],":peru:":[],":philippines:":[],":pitcairn:":[],":poland:":[],":portugal:":[],":puerto-rico:":[],":qatar:":[],":reunion:":[],":romania:":[],":russia:":[],":rwanda:":[],":saint-barthelemy:":[],":saint-helena:":[],":saint-kitts-and-nevis:":[],":saint-lucia:":[],":saint-pierre-and-miquelon:":[],":saint-vincent-and-the-grenadines:":[],":samoa:":[],":san-marino:":[],":sao-tome-and-principe:":[],":saudi-arabia:":[],":scotland:":[],":senegal:":[],":serbia:":[],":seychelles:":[],":sierra-leone:":[],":singapore:":[],":sint-eustatius:":[],":sint-maarten:":[],":slovakia:":[],":slovenia:":[],":solomon-islands:":[],":somalia:":[],":south-africa:":[],":south-georgia:":[],":south-korea:":[],":south-sudan:":[],":spain:":[],":sri-lanka:":[],":sudan:":[],":suriname:":[],":svalbard:":[],":swaziland:":[],":sweden:":[],":switzerland:":[],":syria:":[],":tahiti:":[],":taiwan:":[],":tajikistan:":[],":tanzania:":[],":thailand:":[],":timor-leste:":[],":togo:":[],":tokelau:":[],":tonga:":[],":trinidad-and-tobago:":[],":tunisia:":[],":turkey:":[],":turkmenistan:":[],":turks-and-caicos:":[],":tuvalu:":[],":uganda:":[],":ukraine:":[],":united-arab-emirates:":[],":united-kingdom:":[],":united-states-minor-outlying-islands:":[],":united-states:":[],":uruguay:":[],":uzbekistan:":[],":vanuatu:":[],":vatican-city:":[],":venezuela:":[],":vietnam:":[],":wales:":[],":wallis-and-futuna:":[],":yemen:":[],":zambia:":[],":zimbabwe:":[]},this.supportedsmiley=["angry","anxious","awe","blush","bored","cool","curious","doubt","evil","facepalm","faint","feeling-warm","feeling-cold","grinning","happy","headache","idea","injured","jealous","joy","keep-quiet","love","neutral","peace","razz","relaxed","sad","search","sick","sleepy","smile","smirk","stressed-out","surprise","tensed","thinking","tired","upset","wink","worry","yuck","yummy","biceps","bye-bye","clap","fist","namaste","raising-hand","super","thumbsdown","thumbsup","victory","yoyo","birthday","christmas-tree","coffee-cup","eid-mubarak","fireworks","food","gift-box","kaaba","new-year","party","santa-hat","fire","medicine","poop","flag","badminton","baseball","basketball","chess","cricket","foosball","football","hockey","snooker","canoeing","table-tennis","boxer","high-jump","discus-throw","diver","athlete","equestrian","fencer","archer","hurdler","javelin-throw","judo","long-jump","pole-vault","rhythmic-gymnastics","shotput-throw","aeroplane","ambulance","archer","badminton-player","basketball-player","batsman","batter","bicycle","break-boy","break-girl","bus","car","chess-player","cruiser-bike","female-tennis-player","female-volleyball-player","female-tabletennis-player","fire-engine","football-player","golfer","gymnast","hockey-player","karate","male-tabletennis-player","male-volleyball-player","male-tennis-player","man-dancing","man-swimming","man-cycling","man-running","singing","motor-scooter","passenger-ship","pitcher","police-car","snooker-player","sports-bike","taxi","train","tennis","volleyball","weightlifting","woman-dancing","woman-swimming","woman-cycling","woman-running","wrestling","yoga","peanuts","shooter","hammer-throw","chicken","golf","target"],this.extracodes_all=this.getUncategorizedObject(Smiley.extracodes),this.animated_smiley=this.getUncategorizedObject(Smiley.extracodes,!0),this.smileyobj=$.extend({},this.alldefaultcodes,this.extracodes_shortcut,this.extracodes_all,this.flagcodes,this.animated_smiley),this.shortcutsobj=$.extend({},this.alldefaultcodes,this.extracodes_shortcut),this.initRegex(),this.os=$Util.getOS();for(var e in ResourceMessageObject)ResourceMessageObject[e]=Smiley.replace(ResourceMessageObject[e])},getUncategorizedObject:function(e,t){var i={};for(var a in e){var s=e[a];for(var n in s){var r="";t?Smiley.unSupportedAnimatedEmoji(n,t)||(r=n.slice(0,-1)+"!:"):r=n,r&&(i[r]=s[n])}}return i},getEmojiByCode:function(){if(this.emojicodemap)return this.emojicodemap;this.emojicodemap={};var e=this.emoji;for(var t in e){var i=e[t];for(var a in i)this.emojicodemap[i[a][0]]=a}return this.emojicodemap},initRegex:function(){var e="";for(var t in Smiley.smileyobj)t=$WC.Matcher.replace("escaperegexp",t),""!==e?e+="|"+t:e=t;this.regexp=new RegExp("([ >\n]|^)("+e+")(?=[ <\n]|$)")},isCliqmoji:function(e){var t=$WC.$CUtil.isArray(e);return t&&$WC.$CUtil.isEmpty(e[0])?!0:!1},isGipfyEnabled:function(e){return!("true"==e.attr("ignore_giphy"))},isAnimatedSmileyEnabled:function(){return"true"===$zcg._ISANIMSMILEYENABLED},showSmileyUI:function(e,t,i,a,s){var n=$("#"+t);Clickoutside.bind({srcid:e,destid:t,event:i,customShow:function(){Smiley.handleCustomShow(n,i,s)},customHide:function(e){$WC.$CUtil.removeClass(n[0],"smile-anim"),Settings.update({smileypreference:n.attr("data-target")}),n.empty().removeClass().addClass("smileydivmn"),"function"==typeof e.closeCallBack&&e.closeCallBack(e)},callback:function(e){$("#"+e).removeClass("sel")},closeCallBack:a}),Smiley.bindEvents(n)},handleCustomShow:function(e,t,i){""===e.html()?(Smiley.openednew=!0,Smiley.populateSmileyDOM(e,t),Settings.getFromObj("smileypreference")!==Smiley.EMOJIS&&setTimeout(function(){e.find('[data-purpose="emoji"]').html(Smiley.getSmileyByCategoryHTML(Smiley.emoji,e))},500)):(e.find("#smiley-srch-field").val(""),Smiley.handleTabNavigation(e,e.find('[data-purpose="smiley-tab"]').children().first(),t));var a=(MainUI.getVisibleChats().length,"");e.parent().width()<360?a+=" smilywidth":a="",e.addClass("smile-anim"+a),i||Smiley.focus(e)},getPopulateTypes:function(e){var t=this.isAnimatedSmileyEnabled(),i=this.isGipfyEnabled(e),a=e.attr("populateTypes");return a="undefined"!=typeof a?a.split(","):[this.RECENT_SMILEY,this.SMILEY_ANIM,this.SMILEY,this.EMOJIS,this.GIPFY],i||a.removeElement(this.GIPFY),t||a.removeElement(this.SMILEY_ANIM),a},populateSmileyDOM:function(e,t){var i=this.getPopulateTypes(e),a=['<div class="zcsmsrch">','<div class="msi-sp0 dIB"></div><input id="smiley-srch-field" type="text" placeholder="'+Resource.getRealValue("smiley.search")+'"/>',"</div>",'<div id="smileyscroll" class="posrel smileyscroll">','<div class="smilycnt zcboxhdsdow">','<div data-tabindex="1">',i.includes(this.RECENT_SMILEY)?'<div class="smileydiv" data-id="1" data-purpose="recent"></div>':"",i.includes(this.SMILEY_ANIM)?'<div class="smileydiv sm_anim" data-id="2" data-purpose="animated"></div>':"",i.includes(this.SMILEY)?'<div class="smileydiv" data-id="3" data-purpose="cliq"></div>':"",i.includes(this.EMOJIS)?'<div class="smileydiv sm-emoji" data-id="4" data-purpose="emoji"></div>':"",i.includes(this.GIPFY)?'<div class="smileydiv" data-id="5" data-purpose="gipfy" page="1"></div>':"","</div>","</div>","</div>",'<div class="zcsmiltabs">','<div class="zcsmilac" data-purpose="smiley-tab">',i.includes(this.RECENT_SMILEY)?'<span class="msi-frquse zcsmsel cur" data-index="1" title="'+this.category[1]+'" ></span>':"",i.includes(this.SMILEY_ANIM)?'<span class="cur" data-index="2" title="'+this.category[2]+'"><span class="msi-animsim"></span><span class="msi-animsim1"></span><span class="msi-animsim2"></span></span>':"",i.includes(this.SMILEY)?'<span class="msi-cussim cur" data-index="3" title="'+this.category[3]+'"></span>':"",i.includes(this.EMOJIS)?'<span class="msi-defsim cur" data-index="4" title="'+this.category[4]+'"></span>':"",i.includes(this.GIPFY)?'<span class="msi-giphy cur" data-index="5" title="'+this.category[5]+'"></span>':"","</div>",'<div id="sm_addinfo" class="sm_addinfo">',"</div>","</div>"].join("");e.html(a);var s=e.find('[data-purpose="smiley-tab"]'),n=Settings.getFromObj("smileypreference")+"",r=i[Math.floor(Math.random()*i.length)]+"";Smiley.handleTabNavigation(e,s.find('[data-index="'+(i.includes(n)?n:r)+'"]'),t),this.isGipfyEnabled(e)&&this.handleGiphyEvents(e),ZCScroll.customScroll(e.find(".smileydiv"))},getCategoryHTML:function(e,t){return t=t.replace(/\s+/g,"-"),t=Resource.getRealValue("smiley."+t),this.smileycategoryhtml.replace(/{ID}/g,e).replace(/{TITLE}/g,t)},getRecentSmileyHTML:function(e){var t=this.getSearchValue(e),i="",a=this.isGipfyEnabled(e)?["cliq","emoji","gipfy"]:["cliq","emoji"];this.recent_smiley={},this.isAnimatedSmileyEnabled()&&a.splice(2,0,"animated"),Smiley.othercategorydata=!1;for(var s=0;s<a.length;s++){var n=a[s];if(""!=t&&"gipfy"!==n)var r=this.getSmileyObj(n),o=this.getHTML(r,e);else var o=this.getHTMLByType(n,e);if(o){var l=$(o);Smiley.othercategorydata=l.length&&"loading"===l.attr("purpose")&&!Smiley.othercategorydata?!1:!0,i+=this.getCategoryHTML(a[s],a[s]).replace(/{CONTENT}/g,o)}}return i},getUncategorizedEmoji:function(){return this.emoji_all||(this.emoji_all=this.getUncategorizedObject(this.emoji)),this.emoji_all},getResultFromOtherCategory:function(e){var t=e.attr("data-target"),i="",a=this.isGipfyEnabled(e),s=a?["cliq","emoji","gipfy"]:["cliq","emoji"];this.isAnimatedSmileyEnabled()&&s.unshift("animated"),s.splice(parseInt(t)-2,1);for(var n=0;n<s.length;n++){var r=s[n],o=this.getSmileyObj(r),l=this.getHTML(o,e);l&&(Smiley.othercategorydata=!0),(l||"gipfy"===s[n])&&(i+=this.getCategoryHTML(r,r).replace(/{CONTENT}/g,l))}var c=this.getOtherCategoryHTML(e,t);return Smiley.othercategorydata||(c=""),a||Smiley.othercategorydata?c+i:""},getSmileyObj:function(e){return"emoji"===e?this.getUncategorizedEmoji():"animated"===e?this.animated_smiley:this.extracodes_all},getOtherCategoryHTML:function(e,t){return this.empty_criteria_result.replace(/{CATEGORY}/g,this.category[t])},getHTMLByType:function(e,t){var i={cliq:[":smile:",":happy:",":joy:",":love:",":thinking:",":surprise:",":thumbsup:",":thumbsdown:",":namaste:",":tensed:",":biceps:",":doubt:",":super:",":clap:",":fireworks:",":food:",":gift-box:"],emoji:[":grinning:/#x1f600",":blush:/#x1f60a",":wink:/#x1f609",":stuck-out-tongue-winking-eye:/#x1f61c",":flushed:/#x1f633",":sob:/#x1f62d",":sweat-smile:/#x1f605",":scream:/#x1f631",":sunglasses:/#x1f60e",":facepunch:/#x1f44a",":raised-hands:/#x1f64c",":wave:/#x1f44b",":trophy:/#x1f3c6",":fried-shrimp:/#x1f364",":lollipop:/#x1f36d",":house-with-garden:/#x1f3e1",":point-up-2:/#x1f446",":dancer:/#x1f483",":bouquet:/#x1f490",":round-pushpin:/#x1f4cd",":ice-cream:/#x1f368",":honey-pot:/#x1f36f"],gipfy:$zcg._TRENDINGGIFS,animated:[":smile!:",":happy!:",":joy!:",":love!:",":thinking!:",":surprise!:",":thumbsup!:",":thumbsdown!:",":namaste!:",":tensed!:",":biceps!:",":doubt!:",":super!:",":clap!:",":fireworks!:",":food!:",":gift-box!:"]},a=$DB.get("recentsmiley")[e];a=a?a.concat(i[e]):i[e],a=Smiley.getUniqueItems(a),a=a.slice(0,20);var s=this.getSearchValue(t);if("gipfy"===e)return s.length?'<span class="zcldng" purpose="loading"></span>':Smiley.getGipfyHTML(a,!0,t);for(var n=a.length,r={},o=0;n>o;o++){var l=a[o].split("/");l.length&&(""===s||l[0].indexOf(s)>-1)&&(r[l[0]]=[l[1]])}return this.recent_smiley=$.extend({},this.recent_smiley,r),this.getHTML(r,t)},preloadAnimated:function(){Smiley.isAnimatedSmileyEnabled()&&this.openednew===!0&&($Util.preloadImages(Smiley.supportedsmiley,0,$zcg._IMGDEFAULTSTATICURL+"/sm-animation/48/{FILENAME}.png"),this.openednew=null)},getUniqueItems:function(e){function t(e,t){var i=[],a={};for(var s in e)a[e[s][t]]=e[s];for(var s in a)i.push(a[s]);return i}return e&&e.length?"object"!=typeof e[0]?$.unique(e):t(e,"thumb"):[]},getSmileyByCategoryHTML:function(e,t,i){var a="";for(var s in e){var n=this.getHTML(e[s],t,i);n&&(a+=this.getCategoryHTML(s,s).replace(/{CONTENT}/g,n))}return a},getHTML:function(e,t,i){var a="",s=this.getSearchValue(t),n=this.isAnimatedEmojiTab(t);for(var r in e)if(!i||!Smiley.unSupportedAnimatedEmoji(r.slice(0,-1)+"!:")){var o=r.split(":")[1];if(""===s||o.indexOf(s)>-1){var l=e[r][0]||"";if(l&&!this.isEmojiSupported(o))continue;var c=l?"&"+l:"";o=Smiley.getRealSmileyName(r).split(":")[1];var d=ResourceMessageObject.hasOwnProperty("emoji."+o)?"emoji."+o:"smiley."+o;l=l?"/"+l:"",r=i?r.slice(0,-1)+"!:":r;var u=l?"":Smiley.getSmileyData(r,n).classname;a+=Smiley.smileyhtml.replace(/{SMILEYCODE}/g,r+l).replace(/{UNICODE}/g,c).replace(/{SMILEYNAME}/g,u).replace(/{TITLE}/g,Resource.getRealValue(d))}}return a},unSupportedAnimatedEmoji:function(e,t){return t||Smiley.isAnimatedEmoji(e)?(e=Smiley.getRealSmileyName(e),e=e.split(":")[1],-1===this.supportedsmiley.indexOf(e)):!1},isEmojiSupported:function(e){var t=this.os.toLowerCase(),i=this[t];return i?"linux"===t?i.indexOf(e)>-1:"windows"===this.os?-1===i.indexOf(e):!0:!0},updateRecentSmiley:function(e,t){var i=$DB.get("recentsmiley"),a=[],s=i[t];$WC.$CUtil.isArray(s)||(s=[]),-1===s.indexOf(a)&&(s.unshift(e),i[t]=s,$DB.update("recentsmiley",i))},bindEvents:function(e){e.find('div[data-purpose="smiley-tab"]').off().on("click","span",function(t){Smiley.handleTabNavigation(e,$(this),t)}),e.find("#smiley-srch-field").off("keyup").on("keyup",function(t){var i=t.which;if(i===$zcg.TAB_KEYCODE)return void t.stopImmediatePropagation();if(i===$zcg.ESCAPE_KEYCODE){var a=$(this);if($.trim(a.val()).length>0)return a.val(""),void t.stopPropagation()}Smiley.handleSearch(e,t)}),e.find("#smiley-srch-field").on("keydown",function(t){Smiley.handlekeyDown(e,t)})},handlekeyDown:function(e,t){var i=t.which;if(i===$zcg.TAB_KEYCODE||t.shiftKey&&i===$zcg.TAB_KEYCODE){var a=e.find('[data-purpose="smiley-tab"]'),s=t.shiftKey?a.find(".zcsmsel").prev():a.find(".zcsmsel").next();s.length||(s=a.children(t.shiftKey?":last":":first")),Smiley.handleTabNavigation(e,s,t),t.preventDefault(),t.stopImmediatePropagation()}},handleSearch:function(e,t){var i=(t.which,this.getSearchValue(e));if(this.currsearchtext!==i){delete Smiley.othercategorydata,this.currsearchtext=i;var a=e.attr("data-target"),s="",n=this.getPopulateTypes(e),r=a==Smiley.RECENT_SMILEY;r?(s=this.getRecentSmileyHTML(e),r=""===i?!1:!0):a==Smiley.SMILEY?s=this.getSmileyByCategoryHTML(this.extracodes,e):a==Smiley.EMOJIS?s=this.getSmileyByCategoryHTML(this.emoji,e):a==Smiley.SMILEY_ANIM&&(s=this.getSmileyByCategoryHTML(this.extracodes,e,!0)),""===s&&a!=Smiley.GIPFY&&n.includes(this.GIPFY)&&(s=this.getResultFromOtherCategory(e),r=!0),""===s&&(s=this.noresults_html.replace(/{SEARCH_TERM}/g,$WC.$CUtil.processXSS(i)));var o=e.find('[data-id="'+a+'"]');if(s&&o.html(s),a==Smiley.GIPFY||r){var l=r?o.find("#gipfy .wccontent-node"):e.find('[data-id="'+a+'"]');return void this.handleGipfy(e,l,i,r)}}},handleTabNavigation:function(e,t,i){var a=t.attr("data-index");e.attr("data-target",a).find(".zcsmsel").removeClass("zcsmsel"),t.addClass("zcsmsel"),e.find("[data-tabindex]").attr("data-tabindex",t.index()+1),e.find("#sm_addinfo").html(""),a===Smiley.GIPFY&&e.find("#sm_addinfo").html('<img src="'+$Util.getImgStaticUrl()+'/gify_logo.png" />'),delete this.currsearchtext,this.handleSearch(e,i),this.focus(e),this.preloadAnimated(),ZCScroll.resetScroll(e.find('.smileydiv[data-id="'+a+'"]')),this.handleGiphyEvents(e)},focus:function(e){e.find("#smiley-srch-field").focus()},getSearchValue:function(e){var t=$.trim(e.find("#smiley-srch-field").val());return t.toLowerCase()},handleGipfy:function(e,t,i,a){clearTimeout(this.timer);var s="";if(this.gipfycache&&this.gipfycache[i]&&(s=this.gipfycache[i]),""===i||s.data&&s.data.length){var n=s.data;if(t.attr("page",s.page),""===i){var r=["https://media4.giphy.com/media/l0ExpJSuUyC3OTkSk/giphy.gif","https://media1.giphy.com/media/26ufkNFQ5mFJHeTu0/giphy.gif","https://media2.giphy.com/media/l0HlLtJKvD2VA5f3i/giphy.gif","https://media2.giphy.com/media/l3q2MxV8GBWU3lrkQ/giphy.gif","https://media1.giphy.com/media/l46CmhqC6BIKOaiOc/giphy.gif","https://media0.giphy.com/media/hRS2MZzDx933i/giphy.gif","https://media3.giphy.com/media/l0MYC0LajbaPoEADu/200.gif","https://media2.giphy.com/media/l3q2NboZyZSrDTM7S/giphy.gif","https://media3.giphy.com/media/LSNqpYqGRqwrS/giphy.gif"];n=$zcg._TRENDINGGIFS||r}return t.html(Smiley.getGipfyHTML(n,a,e)),void this.handleGiphyEvents(e)}this.showLoading(t),t.attr("page",""),this.timer=setTimeout(function(){Smiley.handleGipfyRequest(e,t,a,1)},300)},showLoading:function(e){e.find("#zcldng").length||e.html('<span class="gify-head-mask"></span><span id="zcldng" class="zcldng"></span>')},handleGipfyRequest:function(e,t,i,a){function s(e){return e[0].hasAttribute("data-purpose")?e:e.parents("div.smileydiv[data-purpose]")}var n=Smiley.getSearchValue(e),r={search:n};a&&(r.p_no=a),$ZCAjx.ajax({url:"/v2/gifs",data:r,success:function(r){var o=Smiley.getSearchValue(e);if(n===o){r=r.gifs;var l=Smiley.othercategorydata||r.length?t:s(t);Smiley.updateGifyCache(n,r,a),t.attr("data-search",n);var c=Smiley.getGipfyHTML(r,i,e);if(a&&parseInt(a)>1){if(l.attr("page",a).find(".hst-loadng").remove(),l.find('[data-purpose="gifbox"]').append(c),r.length<25)return void l.off("scroll")}else l.html(c),ZCScroll.scrollTop(l,0);Smiley.handleGiphyEvents(e)}},error:function(){return Smiley.othercategorydata?void t.html(""):void s(t).html(Smiley.getGipfyHTML([],!1,e))}})},handleShortCut:function(e,t){if("smiley"===e.attr("data-trigger")){var i=e.parent();Smiley.showSmileyUI(i.find('[data-trigger="source"]').attr("id"),i.find('[data-trigger="destination"]').attr("id"),t)}},updateGifyCache:function(e,t,i){this.gipfycache||(this.gipfycache={}),this.gipfycache[e]||(this.gipfycache[e]={});var a=this.gipfycache[e].data||[];i=i||1,this.gipfycache[e]={data:a.concat(t),page:i}},getGipfyHTML:function(e,t,i){var a="",s=e.length;if(!s)return Smiley.othercategorydata?"":this.noresults_html.replace(/{SEARCH_TERM}/g,$WC.$CUtil.processXSS(Smiley.getSearchValue(i)));t&&(e=1===MainUI.getVisibleChats().length?e.slice(0,12):e.slice(0,10));for(var n=0;s>n;n++){var r=e[n];if(r){var o=t?"gipy_horizntl":"";a+=this.gipfy_html.replace(/{CLASSNAME}/g,o).replace(/{ORIGINAL_SRC}/g,r.orig).replace(/{WIDTH}/g,r.w).replace(/{HEIGHT}/g,r.h).replace(/{IMGURL}/g,r.thumb)}}return t||(a=Smiley.gipfy_container_html.replace(/{ORIGINAL_SRC}/g,e[0].orig).replace(/{WIDTH}/g,e[0].w).replace(/{HEIGHT}/g,e[0].h).replace(/{PREVIEWGIPFY}/g,e[0].thumb).replace(/{GIPFYHTML}/g,a)),a},replace:function(e,t,i,a){function s(e,s,n,r,o){var l=function(e,t,i,a,s){return e?'<em title="'+i+'" class="zcslymsg-'+a+'" code="'+t+'" nodetype=":"></em>':'<span class="zcslymsg-'+a+'" title="'+i+'"  code="'+t+'" ><img onload="this.remove();" class="zcslymsg-'+a+'" src="'+s+'"/></span>'},c=Smiley.isAnimatedEmoji(n);smileycode=Smiley.getRealSmileyName(n).toLowerCase();var d=c?i:!0,u="",m=smileycode in Smiley.shortcutsobj?Smiley.shortcutsobj[smileycode]:smileycode.split(":")[1],p=smileycode in Smiley.flagcodes?"fl-"+m:m,h=a?"":Resource.getRealValue(smileycode in Smiley.flagcodes?"flag."+m:"smiley."+m);if(c){var o=arguments[arguments.length-1],g=!!o.replace(n,"").length;u=g||t?$zcg._IMGDEFAULTSTATICURL+"/sm-animation/48/"+p+".png":$zcg._IMGDEFAULTSTATICURL+"/sm-animation/72/"+p+".png",p=g||t?"anim-24-"+p:"anim-72-"+p}return s+l(d,n,h,p,u)}e=e.replace(/((?:\uD83C\uDFF3)\uFE0F?\u200D?(?:\uD83C\uDF08)|(?:\uD83D\uDC41)\uFE0F?\u200D?(?:\uD83D\uDDE8)\uFE0F?|(?:(?:\uD83C\uDFF4)(?:\uDB40[\uDC60-\uDCFF]){1,6})|(?:\uD83C[\uDDE0-\uDDFF]){2}|(?:(?:\uD83D[\uDC68\uDC69]))\uFE0F?(?:\uD83C[\uDFFA-\uDFFF])?\u200D?(?:[\u2695\u2696\u2708]|\uD83C[\uDF3E-\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83D[\uDC68\uDC69]|\uD83E[\uDDD0-\uDDDF])(?:\uD83C[\uDFFA-\uDFFF])?\u200D?[\u2640\u2642\u2695\u2696\u2708]?\uFE0F?|(?:(?:\u2764|\uD83D[\uDC66-\uDC69\uDC8B])[\u200D\uFE0F]{0,2}){1,3}(?:\u2764|\uD83D[\uDC66-\uDC69\uDC8B])|(?:(?:\u2764|\uD83D[\uDC66-\uDC69\uDC8B])\uFE0F?){2,4}|(?:\uD83D[\uDC68\uDC69\uDC6E\uDC71-\uDC87\uDD75\uDE45-\uDE4E]|\uD83E[\uDD26\uDD37]|\uD83C[\uDFC3-\uDFCC]|\uD83E[\uDD38-\uDD3E]|\uD83D[\uDEA3-\uDEB6]|\u26f9|\uD83D\uDC6F)\uFE0F?(?:\uD83C[\uDFFB-\uDFFF])?\u200D?[\u2640\u2642]?\uFE0F?|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85-\uDFCC]|\uD83D[\uDC42-\uDCAA\uDD74-\uDD96\uDE45-\uDE4F\uDEA3-\uDECC]|\uD83E[\uDD18-\uDD3E])\uFE0F?(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u2194-\u2199\u21a9-\u21aa]\uFE0F?|[\u3030\u303d]\uFE0F?|(?:\ud83c[\udd70-\udd71]|\ud83c\udd8e|\ud83c[\udd91-\udd9a])\uFE0F?|\u24c2\uFE0F?|[\u3297\u3299]\uFE0F?|(?:\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51])\uFE0F?|[\u203c\u2049]\uFE0F?|[\u25aa-\u25ab\u25b6\u25c0\u25fb-\u25fe]\uFE0F?|[\u00a9\u00ae]\uFE0F?|[\u2122\u2139]\uFE0F?|\ud83c\udc04\uFE0F?|[\u2b05-\u2b07\u2b1b-\u2b1c\u2b50\u2b55]\uFE0F?|[\u231a-\u231b\u2328\u23cf\u23e9-\u23f3\u23f8-\u23fa]\uFE0F?|\ud83c\udccf|[\u2934\u2935]\uFE0F?)|[\u2700-\u27bf]\uFE0F?|[\ud800-\udbff][\udc00-\udfff]\uFE0F?|[\u2600-\u26FF]\uFE0F?|([\u0030-\u0039]|\u002A|\u0023)\uFE0F?\u20E3)/g,function(e){var t="";if(e){t=Smiley.convertEmojiToHex(e);var i=Smiley.getEmojiByCode();if(i["#x"+t]){var s=i["#x"+t].split(":")[1];t=Resource.getRealValue(ResourceMessageObject.hasOwnProperty("emoji."+s)?"emoji."+s:"smiley."+s)}else t="";return t=a?"":'title="'+t+'"','<span class="emoji" elemtype="emoji" '+t+">"+e+"</span>"}return""});var n=new RegExp(Smiley.regexp.source,"gi");return e=e.replace(n,s)},convertAnimatedTo24:function(e){return $WC.$CUtil.isEmpty(e)?e:e.replace(/zcslymsg-anim-72/g,"zcslymsg-anim-24")},convertEmojiToHex:function(e){var t=65536|e.charCodeAt(0)-55296<<10|e.charCodeAt(1)-56320;return t.toString(16)},isAnimatedEmoji:function(e){return e.endsWith("!:")},isAnimatedEmojiTab:function(e){return"2"===e.attr("data-target")},handleGiphyEvents:function(e){var t=e.attr("data-target"),i=e.find('[data-id="'+t+'"]'),a=i.find('[data-purpose="preview"]'),s=i.find('[data-purpose="gipfy_img"]');s.off("mouseover").on("mouseover",function(){a.attr("src",$(this).attr("src"))}).add(a).off("click").on("click",function(e){Smiley.shareGif(this),e.metaKey||e.ctrlKey||Clickoutside.handleClickOnChild(e),e.stopPropagation()}),Smiley.othercategorydata||!s.length||i.find("#no_category_reslt").length||(t==this.EMOJIS||t==this.SMILEY)&&i.prepend(Smiley.getOtherCategoryHTML(e,t)),e.find('[data-purpose="gipfy"]').off("scroll").on("scroll",function(){var t=$(this);if(ZCScroll.isScrollNearBottom(t[0],1)){var i=t.find('[data-purpose="gifbox"]'),a=Smiley.getSearchValue(e);if(!a.length||i.find(".hst-loadng").length)return void t.off("scroll");i.append('<div class="hst-loadng"></div>');var s=parseInt(t.attr("page"))||1;Smiley.handleGipfyRequest(e,t,!0,s+1)}})},shareGif:function(e){var t=$(e),i=t.parents('div[purpose="chatview"]').attr("id"),a=(e.getAttribute("src"),e.naturalWidth),s=e.naturalHeight;if(0!=a&&0!=s){var n=t.attr("oheight"),r=t.attr("owidth"),o=t.attr("osrc"),l=t.attr("src"),c={url:o,width:r,height:n,sid:WmsImpl.getSid()};$ZCAjx.ajax({url:"/v1/chats/"+i+"/sharegif",type:"POST",contentType:"application/json",data:c}),Smiley.updateRecentSmiley({orig:o,w:r,h:n,thumb:l},"gipfy")}},getSmileyData:function(e,t){var i=e.toLowerCase(),a=Smiley.isAnimatedEmoji(e);a&&(e=Smiley.getRealSmileyName(e));var s="",n=e.split(":")[1],r=Resource.getRealValue("smiley."+n);return e in Smiley.flagcodes?(s="zcslymsg-fl-"+n,r=Resource.getRealValue("flag."+n)):e in Smiley.shortcutsobj?(smileyclass=n=Smiley.shortcutsobj[e],s="zcslymsg-"+n,r=Resource.getRealValue("smiley."+n)):(smileyclass=n,a&&(smileyclass=t?"anim-72-"+n:"anim-24-"+n),s="zcslymsg-"+smileyclass),{classname:s,title:r,code:i}},getRealSmileyName:function(e){var t=Smiley.isAnimatedEmoji(e);return t?e.slice(0,-2)+":":e},getSearchResults:function(e){var t={};t=e.srch_obj?e.srch_obj:":*"===e.val?$.extend({},this.extracodes_all,Smiley.animated_smiley):$.extend({},this.alldefaultcodes,this.extracodes_shortcut,this.extracodes_all,Smiley.animated_smiley);var i="undefined"!=typeof e.html?e.html:this.searchhtml,a="";if(":*"===e.val){for(var s in t)if(!Smiley.unSupportedAnimatedEmoji(s)){var n=Smiley.getSmileyData(s);a+=i.replace(/{SMILEYCODE}/g,n.code).replace(/{CLASSNAME}/g,n.classname).replace(/{RESOURCEDSMILEYNAME}/g,n.title)}}else{var r=-1;for(var s in t)if(!Smiley.unSupportedAnimatedEmoji(s)){var n=Smiley.getSmileyData(s);r=s.toLowerCase().indexOf(e.val.toLowerCase());var o=a.indexOf('<span code="'+n.code+'">'+n.title+"</span>");0===r&&-1===o&&(a+=i.replace(/{SMILEYCODE}/g,n.code).replace(/{CLASSNAME}/g,n.classname).replace(/{RESOURCEDSMILEYNAME}/g,n.title))}if(e.val.startsWith(":fl-")===!0){var l=e.val.replace(/fl-/g,"");for(var c in Smiley.flagcodes)if(0===c.toLowerCase().indexOf(l.toLowerCase())){var d=Smiley.getSmileyData(c);a+=i.replace(/{SMILEYCODE}/g,d.code).replace(/{CLASSNAME}/g,d.classname).replace(/{RESOURCEDSMILEYNAME}/g,d.title)}}}return a},getSmileyTitle:function(e){var t,i=Smiley.getSmileyData(e).title;if(i.includes("undefined")){var a=Smiley.convertEmojiToHex(e),s=Smiley.getEmojiByCode();if(s["#x"+a]){var n=s["#x"+a].split(":")[1];t=ResourceMessageObject.hasOwnProperty("emoji."+n)?Resource.getRealValue("emoji."+n):ResourceMessageObject.hasOwnProperty("smiley."+n)?Resource.getRealValue("smiley."+n):t}}else t=i;return t}},Smiley.init();var Template={};Template={UI:'<div id="maskbg" class="zcmask"></div><div id="zcwindows" class="zcoverlay"></div><div class="zclivesupport" id="livesupport"></div><div id="imgmaskbg" class="imgmaskbg"></div><div id="imgviewer" style="display:none" class="litebxhdr" zoomout="false"><div id="imgloading" class="zcldng"></div><div class="litebximgvvr"><div id="imgnavigation" class="zcimgvarwmn"><span id="imgnext" class="floatr msi-rightarr"></span><span id="imgprev" class="floatl msi-leftarr"></span></div><div id="imgholder" class="imgholder" tabindex="-1"><div id="imgpreviewlist"></div><div id="imgdetails" class="zcimginfo"><div id="imgviewer-fname" class="zcimgtit"></div><div id="imgviewer-fdetails" class="zcimgsbtit"></div></div></div></div><div id="imgviewerdetails" class="litebxhdrsb"><div class="floatr imgvwrht"><div id="imgviewer-openoriginal" documentclick="attdownload" class="msi-popout" title="'+Resource.getRealValue("common.open.original")+'"></div><div id="imgviewer-fforward" documentclick="attforward" class="msi-fileshare" title="'+Resource.getRealValue("common.forward")+'"></div><div id="imgviewer-fdownload" documentclick="attdownload" class="msi-downld" title="'+Resource.getRealValue("common.download")+'"></div><div id="imgviewer-annotate" documentclick="annotateimage" class="font16 mrgR15 msi-edit" title="'+Resource.getRealValue("common.edit")+'"></div></div><div class="floatl imgvwlft"><div class="floatl rds4"><img id="imgviewer-fsender" src="" height="38" width="38" class="floatl rds4"></div><div class="litebxltr"><div class="imginftit ellips"><div id="imgviewer-fsendername"></div></div><div id="imgviewer-fcomment" class="ellips imgvwdt mrgT15"></div></div></div></div><div id="profileinfo" class="zcflinfo"><div id="userinfo" class="zcflcnt dIB"></div><div id="imgvieweruseroption" class="dIB zcflvicn"><span id="imgdownload" class="msi-downld" documentclick="userimgdownload" title="'+Resource.getRealValue("common.download")+'"></span><span id="startchat" class="msi-chat" documentclick="startchat" title="'+Resource.getRealValue("common.startchat")+'"></span></div></div><span id="closeimgviewer" title="'+Resource.getRealValue("common.to.close")+'" class="msi-close cclose"></span></div><div id="videobroadcast" class="dN posa zclsmbdcnt"></div><div id="videochat" class="posa zcvidmain zcvcdrgcnt" videochatdragcontainer component="floatingcontainer" style="display: none;" ></div><div id="vcincommingcall" class="zcvidincm" style="display: none;" ></div><div id="hover" class="contactshover"></div><div id="officechat"><div id="topbar"><div class="ztb-topband '+($WC.$CUtil.isEmpty($zcg._CUSTOMDOMAINURL)&&SecurityManager.hasPermission(Modules.HamBurger)?"":"zc-hide-hambrgr")+'" id="ztb-topband"></div>'+("fuji"!==$zcg._BRAND?'<div ztooltip="'+Resource.getRealValue("settings.zoho.apps")+'" title="'+Resource.getRealValue("settings.zoho.apps")+'" class="ztooltip ztb-font-family ztb-deployment-zoho '+("true"===$zcg._ISZOHOONELAUNCHERENABLED?"ztb-zohoone":"")+'" id="ztb-switch-menu"><div class="ztb-switch-to-square"><span></span><span class="two"></span><span></span><span></span><span class="five"></span><span></span><span></span><span class="eight"></span><span></span></div></div>':"")+'</div><div style="display:none;" id="ajaxstatus" class="ajaxstatus"></div><div style="display:none;" id="servicebanner" class="zcupdanc"><span class="msi-announce"></span><span id="servicebannermsg" class="zcancetxt padd10"></span><span id="hideservicebanner" class="msi-upaw"></span></div><div id="loadingline" class="zcloadlin posa"></div><div style="display:none;" id="networkstatus" class="ajaxstatus networkstatus ellips"><span id="statusmsg" class="statusmsg ellips">'+Resource.getRealValue("common.network.error")+'</span><span id="trynow" class="trynow zchidcnt cp bold grclr">'+Resource.getRealValue("common.network.trynow")+'</span></div><div id="outercontainer" class="zccontent"><article role="main"><section id="leftpannel" class="zcleftsidebar zcwithimg"><div id="list" class="contactslist" ><div id="unreadnotifier" purpose="notifyunread" class="zcunrdcr zcunrdcrbtm hidden"><div class="msi-arwdwn"></div><div id="counter" class="msgnotify"></div></div><div id="tabhome" elemtype="triggerhome" class="zcuserstatus zchomests chatsel"> <div class="zcbdytitle">'+Resource.getRealValue("smiley.home")+'</div><div class="msi-zchomeico"></div></div><div id="contactinvitations" category="contactinvitations" class="zclftconcnt"></div><div id="pinnedchats" category="pinnedchats"></div><div id="chats" category="chats" class="recentchts"></div><div id="channelslhs"></div><div id="mutedchats" category="mutedchats" class="zcmutedchts"></div><div id="generalcontacts" category="generalcontacts"></div><div id="botcontacts" category="botcontacts"></div></div></section><section id="midcontainer" class="chatsection"><div id="chatsection" class="zcchatwindow zconechat"><div id="home" class="zcdashbrdui"><div class="zcdashbdmain zcboxhdsdow"><div id="zcdashbdmain" class="posrel"><div class="zcdashnotify" id="zcdashnotify"><div id="zcbotsnotify" style="display:none;" data-notify><div class="zchdl zcbthdr posl mrgB10">'+Resource.getRealValue("home.bots.heading")+'</div></div><div id="zccommandsnotify" style="display:none;" data-notify><div class="zchdl zcbthdr posl mrgB10">'+Resource.getRealValue("home.commands.heading")+'</div></div><div id="zcmessageactionsnotify" style="display:none;" data-notify><div class="zchdl zcbthdr posl mrgB10">'+Resource.getRealValue("home.messageaction.heading")+'</div></div><div id="zcoffmsgnotify" style="display:none;" data-notify><div class="zchdl posl mrgB10">'+Resource.getRealValue("home.offline.heading")+'</div></div><div id="zcmentionnotify" style="display:none;" data-notify><div class="zchdl posl mrgB10">'+Resource.getRealValue("home.mention.heading")+'</div></div><div id="zceventsnotify" style="display:none;" data-notify><div class="zchdl posl mrgB10">'+Resource.getRealValue("home.events.heading")+'</div></div></div></div></div></div><div id="chatwindows" class="chtwndws" style="display:none"><div id="chatwindowsviewport" class="chtwndws"></div><div id="chatwindowshideport" style="display:none"></div></div><div id="profileview" profileid="" profile="" class="wdhinht" style="display:none"></div><div id="transcriptview" opener="" class="prftranscpt" style="display:none"><div id="transcriptviewheader" class="transtit"> <span holder="transcriptviewtitle" class="prftitle floatl ellips"></span><div id="transcritpviewoperation"></div><span operation="transcriptviewclose" class="msi-close cclose" title="'+Resource.getRealValue("common.to.close")+'"></span></div><div id="transcriptviewholder" purpose="transcriptholder" class="currchatpanel "></div></div></section><section id="feedcontainer" style="display:none"><div class="zcfdwrap"><div class="zcfdhead"><div class="zcfdhdtit floatl">'+Resource.getRealValue("feed.feed")+'</div><div class="floatr"><span id="feedclearbtn" purpose="clear" class="zcfdlnk floatr" style="display:none">'+Resource.getRealValue("common.clear")+'</span><div class="tooltip"></div></div></div><div id="feedlist" class="zcfdcontent clboth"><div id="feedempty" class="nomail-info">'+Resource.getRealValue("feed.fetching")+'</div></div></div></section><div id="eventcontainer" class="ztb-dropdown zcalndrwrap"><div class="bor5"><div class="zcboxhdsdow posl"><div id="topbarevlistcnt" class="zcalndrcontent clboth bor5"><div id="topbarevlist" class="evntlst mrgB10 bold"><div id="tobarevnoevent" class="evntnone">'+Resource.getRealValue("event.top.none")+'</div></div></div></div><div eventbuttons purpose="open" class="dbtn zcalndrlnk bor3 textcent">'+Resource.getRealValue("event.add")+'</div></div></div></article><div id="eventreminder" class="dN zcrmnoticnt"></div><div id="rhssection" class="zc-profilemenu  zc-rhssection"></div></div></div>',DNPermissionUI:'<div id="desktopnoti_popup" class="desktopnoti"><div class="msi-chtclose" documentclick="close_dn_permission"></div><div class="header dIB">'+Resource.getRealValue("checklist.dn.header")+'</div><div class="dn_lhs txtalgncentr"><img src="'+$zcg._IMGDEFAULTSTATICURL+'/dn-default.svg"/></div><div class="dn_rhs"><p>'+Resource.getRealValue("checklist.dn.details")+'</p><div class="dn_confirm"><div id="dn_enable" class="dbtn" documentclick="show_dn_permission">'+Resource.getRealValue("checklist.dn.btn")+"</div></div></div></div>",ModalWindow:'<div id="{WININDEX}" type="popup" class="modalwindow {WINCLASS} "><div id="winhead" class="mheader {DRAGGABLE}">{WINHEADER}<span id="winclose" title="'+Resource.getRealValue("common.to.close")+'" class="msi-close cclose"></span></div>{WINHTML}</div>',DialogBox:'<div class="mcontent"><div class="dialogmn">{IMAGE}<div class="zcdlg_rht"><div class="zcdlgmsg">{MESSAGE}</div></div></div><div class="txtcent">{BUTTON}</div></div>',DialogBoxImage:"{DETAILEDIMAGE}",UploadingFilesDiv:'<div  class="clrboth" filename="{FILENAME}"><span class="zcfileprgspan ds_in_blk mrgT15"><div><span class="ellips ds_in_blk wid90" title="{FILE_DISPLAY_NAME}">{FILE_DISPLAY_NAME}</span></div><div class="zcprgbrsb mrgT6"><div id="progressbar" class="zcprgsbg {INDETERMINATE}"></div></div></span><span purpose="close" filename="{FILENAME}" title="'+Resource.getRealValue("common.cancel")+'" class="msi-close zcfileupldclose mrgT20" {DISPLAY}></span></div>',ChatWindow:'<div id={{CHID}} class="currentchat floatl" purpose="chatview" style="display:none"><div id="header" class="currchathdr"><div class="hdrwrap flexC"><div id="userimage" class="usrimgsts fshrink"></div><div class="hdr ellips flexG"><div class="zcmtit"><div class="hdrsub"><div id="title{{CHID}}" chid="{{CHID}}" contenteditable="true" class="zctle floatl bold ellips"></div><span id="cwinchnicon{{CHID}}" class="flexC">{{CHN_TYPE_ICON}} {{CHN_LCK}} </span></div><div id="usrsmsg{{CHID}}" class="hdrstatus ellips"></div></div></div><div class="cht_optns fshrink flexC"><div id="chataddoptions" class="cht_opticn"></div><div id="cclose" title="'+Resource.getRealValue("common.to.close")+'" class="zcf-close chw-opt-icon font10" data-hover="common.to.close" documenthover="closeptions"></div><div id="chatsetngdiv{{CHID}}" class="cht_setings"></div></div></div><div id="infocont" class="infocont" style="display:none; clear:both"> </div><div id={{CHID}}_filepbar class="zcfileuploadcnt dN"><div class="zcprgbrsb"><div id="fileupldprgbr{{CHID}}" class="zcprgsbg"></div></div><div class="zfileprgrmn"><span id="filecountbar" class="ellips wid90">'+Resource.getRealValue("chat.files.sharing")+'</span><span><span id="zcfileexpandicon" class="zcfileupld-opts msi-expand" title="'+Resource.getRealValue("common.expand")+'"></span><span id="uploadcancel" title="'+Resource.getRealValue("common.cancel")+'" class="msi-close zcfileupld-opts"></span></span></div><div id="expandfilescontainer" class="zfileprgrcnt dN"></div></div></div><div id="datehint" class="datehint datehintpos"></div><div id="cwin_info"></div><div id="chatbody" purpose="chatbody" class="currchatpanel"><div id="filedropcontainer" class="zcfiledrgmn"><span>'+Resource.getRealValue("chat.files.drop")+'</span></div><div class="dsp_tble height100"><div id="msgarea" opener="chatbody" purpose="transcriptholder"></div></div></div><div id="videochatspace" class="zcvidspc dN">{{VIDEO_CHAT_HTML}}</div><div id="compcontainer" class="chatarea posl"><div class="chatareamn"><div class="cstatusmsg"><div id="triggeractions{{CHID}}" purpose="moreaction" class="zcactn" data-purpose="zcpinchat"><span class="zcactxt">'+Resource.getRealValue("common.actions")+'</span><div class="darrow"></div></div><div id="chatactionsholder{{CHID}}" style="display:none"></div><span id="cstatusmsg" class="cstsmsg">&nbsp;</span><div id="promptbanner" style="display:none" class="zcprmtbanr"></div></div><div id="chatwindropdown" class="chateditrmn"><div id="compfiledropcontainer" class="zcfiledrgmn"><span>'+Resource.getRealValue("chat.files.drop.cmdshare")+'</span></div><div class="zceditrsndfile" id="triggeratt{{CHID}}" data-purpose="zcsharefile"></div><div class="zchatxtareamn" data-purpose="zcmention"><div class="txtformat"><a id="triggersmileys{{CHID}}" data-trigger="source"  data-purpose="zcsmileys" purpose="moreaction" class="msi-zcsmly"></a></div><div id="smileys{{CHID}}" class="smileydivmn" data-target="1" data-trigger="destination"></div><div id="composer{{CHID}}" contenteditable="true" data-type="composer" rule="msg" class="textarea" data-trigger="smiley" data-purpose="zcslash" ></div></div><div id="compautocomplete{{CHID}}" style="display:none"></div><div id="urlinfopreview{{CHID}}" omittedlinks="" class="zcurlprv"><div id="closepreview" class="msi-close cclose prvlngcls"></div><div id="preview"></div></div><div id="msgoptionspreview{{CHID}}" class="zcurlprv"><div id="closepreview" class="msi-close cclose prvlngcls"></div><div class="zcreplypreview clrboth"><div id="preview" class="dIB zcmsgrlypr msgtxt me"></div></div></div></div><div id="messageoperationcontrol{{CHID}}" class="msgoptioncontrol" style="display:none"></div></div><div id="helptip" class="zcedtrinfo posl dflxcent">{{HELPTIPHTML}}</div></div></div>',MarkDownDescription:'<div class="flexC composrhelp"><div class="flexG textC font14 ellips">{HELPTEXT}</div><div class="zcqustnmn posl fshrink"><div class="markdwnHlp curD" customtooltip>M <span class="zcf-darrow font11"></span></div><div id="chathelptip{CHID}" class="zcqust_tltipmn zchlptiphid"><div><div>'+Resource.getRealValue("chat.helptip.markdown")+"</div><div>"+Resource.getRealValue("chat.helptip.result")+"</div></div><div><div>*"+Resource.getRealValue("chat.helptip.bold")+'*</div><div class="bold">'+Resource.getRealValue("chat.helptip.bold")+"</div></div><div><div>_"+Resource.getRealValue("chat.helptip.italics")+'_</div><div class="ital">'+Resource.getRealValue("chat.helptip.italics")+"</div></div><div><div>~"+Resource.getRealValue("chat.helptip.strike")+"~</div><div><strike>"+Resource.getRealValue("chat.helptip.strike")+"</strike></div></div><div><div>__"+Resource.getRealValue("chat.helptip.underline")+"__</div><div><u>"+Resource.getRealValue("chat.helptip.underline")+"</u></div></div><div><div>`"+Resource.getRealValue("chat.helptip.quote")+'`</div><div style="color:#c80038;">"'+Resource.getRealValue("chat.helptip.quote")+'"</div></div><div><div>!'+Resource.getRealValue("chat.helptip.blockquote")+"</div><div><blockquote>"+Resource.getRealValue("chat.helptip.blockquote")+"</blockquote></div></div><div><div># "+Resource.getRealValue("chat.helptip.largeheading")+'</div><div class="font20 bold">'+Resource.getRealValue("chat.helptip.largeheading")+"</div></div><div><div>### "+Resource.getRealValue("chat.helptip.smallheading")+'</div><div class="font16 bold">'+Resource.getRealValue("chat.helptip.smallheading")+"</div></div><div><div>"+Resource.getRealValue("chat.helptip.link1")+" ["+Resource.getRealValue("chat.helptip.link2")+"]("+Resource.getRealValue("chat.helptip.link3")+")</div><div>"+Resource.getRealValue("chat.helptip.link1")+" <u>"+Resource.getRealValue("chat.helptip.link2")+'</u></div></div><div><div style="line-height: 16px;">```function dow(y) {<br>return (y) % 7;<br>}```</div><div><div class="zcbrdr padd5">function dow(y) {<br>return (y) % 7;<br>}</div></div></div><div><div>&nbsp;&nbsp;'+Resource.getRealValue("chat.helptip.break.code")+'</div><div><hr></div></div><div class="msi-tltipwrw"></div></div></div></div>',SendFile:'<div id="sendfile">'+Resource.getRealValue("common.message.length.info")+' <a id="sendattachment{CHID}" class="msi-qustn zcunderlin" documentclick="sendattachment">'+Resource.getRealValue("common.message.attach.info")+"</a></div>",FilePickerDesktop:'<form id="upload{CHID}" type="html5" enctype="multipart/form-data"><input type="file" multiple name="file1" class="sendfile" id="file{CHID}"></form>',FilePickerActionsHtml:'<div id="filepickeractionsholder{CHID}" class="filepckr-actn"><div class="chtpopup font14 fileatchmnt"><div purpose="cloudatchmnt{CHID}"  class="msi-file-cloud ellips">'+Resource.getRealValue("common.attach.method.cloud")+'</div><div id="subfile{CHID}" class="msi-file-dsktp ellips">'+Resource.getRealValue("common.attach.method.desktop")+"</div></div></div>",FilePickerWindow:'<div id="filepickerwinbody" class="mcontent zfileupldcnt zppwd1"><div id="filepickercontainer"><div id="filepickerloader" class="zcldng"></div><iframe src="{URL}" class="cld-frame" id="cloudpickeriframe" style="display:none;"></iframe></div></div>',UploadFileIframe:'<div class="{UPLOADCLASS}"><form action="/upload.do" id="upload{CHID}" type="iframe" target="{CHID}sentfile" enctype="multipart/form-data" method="post"><input type="hidden" name="chid" value="{CHID}"><input type="hidden" name="type" value="{CTYPE}"><input type="hidden" name="ncf"><input type="hidden" name="mod" value="att"><input type="hidden" name="sid" value=""><input type="hidden" name="zchat_csrparam" value=""><input type="file" name="file1" multiple="true" class="sendfile" id="file{CHID}"><iframe id="{CHID}sentfile" name="{CHID}sentfile" style="display:none;"></iframe></form></div>',UploadFile:'<div class="{UPLOADCLASS}" title="'+Resource.getRealValue($WC.Matcher.check("chrome_useragent",navigator.userAgent)?"common.paste.fileshare":"common.file.share")+'">{FILEPICKERDESKTOP}</div>',FilePreviewIframe:'<div id="imgpreview{{CURRIMGPOS}}"><iframe class="previewbdr" width="{{WIDTH}}px" height="{{HEIGHT}}px" src="{{SRC}}" type="{{CONTENTTYPE}}"><div class="nopreviewfiletxt">{{nopreview}}</div></iframe></div>',NoPreviewAvail:'<div id="imgpreview{{CURRIMGPOS}}" nopreview="true" class="videoholder"><div class="nopreviewfiletxt">{{nopreview}}</div></div>',InviteContactWindow:'<div id="invitecontact" class="mcontent zcinhds zcrchmcnt"><div  class="zccrhd font16 bold mrgL20">{{header}}</div><div  class="lin22 mrgL20 clr6 font14 mrgT10">{{invite_desc}}<div class="mrgT10"><em class="msi-tip mrgR5"></em><span class="bold mrgR5">{{tip_tool}}:</span>{{invite_tip}}</div></div><div id="invitecontact-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="{{quickchtnode}}"></div><div class="mrgL20 cntsugg bold font15 posl">{{contact_sugg}}</div><div id="invitecontact-results" class="mrgT15 zcrchtlt"><div id="invitecontact-list" class="posl zcht100"></div></div><div class="crchndcnt"><div id="usernodecnt" class="zcrchicnt"><div id="invitecontact-select-field" contenteditable="false" ></div></div><div id="sendinvitenext" purpose="invite_next" class="windwbtn dIB cur mrgL15">{{next_btn}}</div></div></div>',HoverUI:{User:'<div id="hoptions" class="posa zccthov"><div class="zcctimc"><div id="imgcontainer" class="zcctimg">{USERIMAGE}<span id="loadingdiv" class="zcldng"></span><span id="time" class="zchvrtm" title="{USERFULLTIME}">{USERTIME}</span></div><div class="zcconactdet zclftcht"><div class="posl"><div id="viewprofile" class="zcctnm"><div class="bold font14 flexC"><span id="status" class="{STATUSCLASS} fshrink"></span><span class="{HOVERCLASS} zcusrehov ellips" {VIEWPROFILE}>{DNAMEVAL}</span><span id="checkin_status" uid="{UID}" class="font14 checkin_status zcpredot fshrink {CHECKIN_ST}">{CHECKIN_ST}</span></div><div class="ellips mrgT5"><a class="clr0" href="mailto:{MAILIDVAL}">{MAILIDVAL}</a></div></div>{MUTEDDETAILS}</div><div id="addinfo" class="txtcent zcconactdet posl">{ADDINFO}</div>{LASTMSGHTML}<div id="hoptions" class="zchoviccnt textcent">{STARTCHAT}{CALLOPTION}{INFO}</div></div></div>',LocalUser:'<div id="hoptions" class="posa zccthov"><div class="zcctimc"><div id="imgcontainer" class="zcctimg">{USERIMAGE}<span id="loadingdiv" class="zcldng"></span><span id="time" class="zchvrtm" title="{USERFULLTIME}">{USERTIME}</span></div><div class="zcconactdet zclftcht"><div class="posl"><div id="viewprofile" class="zcctnm"><div class="bold font14 flexC"><span id="status" class="{STATUSCLASS} fshrink"></span><span class="zcusrehov ellips">{DNAMEVAL}</span></div><div class="ellips mrgT5"><a class="clr0" href="mailto:{MAILIDVAL}">{MAILIDVAL}</a></div></div></div><div id="addinfo" class="txtcent zcconactdet posl">{ADDINFO}</div></div></div>',InvitedUser:'<div id="hoptions" class="posa zccthov"><div class="zcctimc"><div id="imgcontainer" class="zcctimg">{USERIMAGE}<span id="loadingdiv" class="zcldng"></span></div><div class="zcconactdet zclftcht zcconactmindet"><div class="posl"><div id="viewprofile" class="zcctnm"><div class="bold font14 flexC"><span class="zcusrehov ellips">{DNAMEVAL}</span><span id="checkin_status" uid="{UID}" class="font14 checkin_status zcpredot fshrink {CHECKIN_ST}">{CHECKIN_ST}</span></div><div class="ellips mrgT5"><a class="clr0" href="mailto:{MAILIDVAL}">{MAILIDVAL}</a></div></div>{MUTEDDETAILS}</div><div id="addinfo" class="txtcent zcconactdet posl">{ADDINFO}</div></div></div>',NonOrgNonMutualUser:'<div id="hoptions" class="posa zccthov"><div class="zcctimc"><div id="imgcontainer" class="zcctimg">{USERIMAGE}<span id="loadingdiv" class="zcldng"></span></div><div class="zcconactdet zclftcht zcconactmindet"><div class="posl"><div id="viewprofile" class="zcctnm"><div class="bold font14 flexC"><span class="zcusrehov ellips">'+Resource.getRealValue("common.name")+'</span></div><div class="ellips mrgT5">{DNAMEVAL}</div></div>{MUTEDDETAILS}</div><div id="addinfo" class="txtcent zcconactdet posl">{ADDINFO}{NOTUSER}</div></div></div>',Bot:'<div id="hoptions" class="posa zccthov zcbthov"><div class="zcctimc"><div id="imgcontainer" class="zcctimg">{BOTIMAGE}<span id="loadingdiv" class="zcldng"></span></div><div class="posl zcconactdet zclftcht"><div class="txtcent mrgT10"><div class="bold font14 ellips">{DNAME}</div><div title="{BOTSTATUS}" class="ellips"><span id="status" class="msi-boticon mrgLR5"></span>{BOTSTATUS}</div></div><div class="txtcent mrgTB15"><div id="addinfo" class="zcconctd">{BOTENDPOINT}</div></div>{STARTCHAT}</div></div></div>',CHAT_HOVERDETAIL:'<div id="hoptions" class="posa zccthov zcchthov"><div class="zcctimc"><div id="imgcontainer" class="zcctimg">{USERIMAGE}</div></div><div class="zcconactdet zclftcht"><div>{CHATTITLE}{MUTEDDETAILS}<div class="padd3 zchthovmsg">{MSGSENDUSERIMG}<div>{TITLE}<div id="addinfo">{SENDER}<div class="ellips mrgT10 clr6">{LASTMSG}</div>{LASTMSGTIME}</div></div></div>{TYPINGHTML}</div><div id="hoptions" class="zchoviccnt textcent"><div operation="continuechat" chid="{CHID}" typr=""chat" title="'+Resource.getRealValue("chat.continue")+'" class="zcchticn cur zcchinf"><div class="msi-chat"></div></div>{CALLOPTION}</div></div></div>',CHANNEL_HOVERDETAIL:'<div id="hoptions" class="posa zccthov zchlfhov zchnlhv"><div class="zcctimc"><div id="imgcontainer" class="zcctimg">{USERIMAGE}</div></div><div class="zcconactdet zclftcht"><div class="zcinhds bold font14 ellips mrgT10">{TITLE}</div>{MUTEDDETAILS}{LASTMSGINFO}{TYPINGHTML}{CHANNELOPTION}</div>{CHANNELAPPROVEOPTION}',Command:'<div id="hoptions" class="posa zccthov" cid="{{CID}}"><div class="zcctimc"><div id="imgcontainer" class="zcctimg"><canvas width="{{CONTAINER_MAXWIDTH}}" height="{{CONTAINER_MAXHEIGHT}}" documentclick="viewprofileimage" id="commandhoverblurimg" uid="{{CID}}" imgsrc="{{IMGURL}}" class="zcblrimg cur"/><div class="zchvimgcnt"><img documentclick="viewprofileimage" id="contacthoverimg" uid="{{CID}}" imgsrc="{{IMGURL}}" class="zcorgimg"/></div><span id="loadingdiv" class="zcldng"></span></div><div class="zcconactdet zclftcht textcent zcself"><div class="posl"><div id="viewprofile" class="zcctnm"><div class="font14 bold mrgT5" operation="commandinfo"><span class="zcusrehov zctxthgh cur">{{COMMANDNAME}}</span></div><div class="mrgT5"><span class="clr0">{{HINT}}</span></div></div></div>{{APPLICATION}}<div id="devinfo" uid={{UID}} class="zcconactdet mrgT20"><div class="bold font14"><span class="zcusrehov">{{DEV_INSTALLER}}</span></div><div class="mrgT5" {{OPERATION}} title="{{CHATTITLE}}" ><span class="clr0 {{USERCLASS}}">{{DEVELOPER}}</span></div></div></div></div></div>',Application:'<div id="hoptions" class="posa zccthov" store_appid="{{id}}"><div class="zcctimc"><div id="imgcontainer" class="zcctimg"><canvas width="{{container_maxwidth}}" height="{{container_maxheight}}" documentclick="viewprofileimage" uid="{{id}}" imgsrc="{{image_src}}" class="zcblrimg cur"/><div class="zchvimgcnt"><img documentclick="viewprofileimage" id="contacthoverimg" uid="{{id}}" imgsrc="{{image_src}}" class="zcorgimg"/></div><span id="loadingdiv" class="zcldng"></span></div><div class="zcconactdet zclftcht textcent zcself"><div class="posl"><div id="viewprofile" class="zcctnm"><div class="font14 bold mrgT5" operation="app_preview"><span class="zcusrehov zctxthgh cur">{{name}}</span></div><div class="mrgT5"><span class="clr0">{{desc}}</span></div></div></div><div id="devinfo" uid={{developer_id}} class="zcconactdet mrgT20"><div class="bold font14"><span class="zcusrehov">{{installed_or_created_by}}</span></div><div class="mrgT5" {{operation}} title="{{chat_title}}" ><span class="clr0 {{user_class}}">{{developer_name}}</span></div></div></div></div></div>'},UserView:'<div id="{USERID}" profile="contact" class="zcgroupviewmn"><div domtype="viewheader" class="gpvhdrwrap"><div class="grpviewrhtin"><div class="grpvwdbrow"><div class="prfhdr-lft"><div class="usrphtomn cur"><img documentclick="viewprofileimage" id="profilephoto" uid="{USERID}" src="{IMGURL}" imgsrc="{IMGURL}" height="55" width="55" class="floatl rds4"><span class="{STATUSCLASS} hdrsts posa"></span></div></div>{MOREDETAILS}</div></div><span id="pclose{USERID}" operation="close" userid="{USERID}" title="'+Resource.getRealValue("common.to.close")+'" class="msi-close cclose"></span></div><div domtype="bodyheader" class="prftitmn posl"></div><div domtype="body" class="prflstmn"><div id="userrecentchats" class="prflstmn"></div></div></div>',ChatHistory:'<div class="mcontent hstdlg"><div class="hstmain zch100"><div id="historyrows" class="hst-lftcntr zch100 posl"></div><div id="transcriptcontainer" opener="chathistory" class="hst-rht zcmulticht" style="display:none;"><div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("history.chat.select")+"</div></div></div></div></div>",MentionHistory:'<div class="mcontent hstdlg zch100"><div class="hstmain zch100"><div id="mentionrows" class="hst-lftcntr zch100 posl"></div></div></div>',StarMessages:'<div class="mcontent hstdlg strmsgsview zch100"><div class="hstmain zch100"><div id="starmessages" class="hst-lftcntr strmsgsview mrgT10 zch100 posl"><div id="starsempty" selected class="nostarredmsgs"></div><div type="0" id="container0" class="strsview default"></div><div type="1" id="container1" class="strsview type1"></div><div type="2" id="container2" class="strsview type2"></div><div type="3" id="container3" class="strsview type3"></div><div type="4" id="container4" class="strsview type4"></div><div type="5" id="container5" class="strsview type5"></div></div></div></div>',StarMessagesHeaders:'<div id="starcatview" class="staroptnsbox src_tip"><span category="0" selected class="default">'+Resource.getRealValue("common.starmessages.category0")+'</span><span category="1" class="msi-starsel type1">'+Resource.getRealValue("common.starmessages.category1")+'</span><span category="2" class="msi-starsel type2">'+Resource.getRealValue("common.starmessages.category2")+'</span><span category="3" class="msi-starsel type3">'+Resource.getRealValue("common.starmessages.category3")+'</span><span category="4" class="msi-starsel type4">'+Resource.getRealValue("common.starmessages.category4")+'</span><span category="5" class="msi-starsel type5">'+Resource.getRealValue("common.starmessages.category5")+"</span></div>",TransriptOverlay:'<div id="transcriptcontainer" class="hst-rht zcmulticht" style="display:none;"><span id="transcriptclose" operation="transcriptclose" purpose="transcriptoptions" title="'+Resource.getRealValue("common.to.close")+'" class="msi-close cclose"></span><div class="zchstdel posl" id="transcriptheader"></div><div class="hstcht posl"><div id="currenttranscript" purpose="transcriptholder" class="currchatpanel hstrht-data"  data-chid="{CHID}"></div></div></div>',EmbedChatWindow:'<div id="emwinbody" class="mcontent embdmn"><div id="emleft" class="embd-lft"><div id="emerrmsg" class="gp-errmsg" style="display:none"></div><div class="embdtpfm"><div class="usrmn"><label>'+Resource.getRealValue("common.name")+'</label><input id="emname" type="text" class="emtxtbx" placeholder="'+Resource.getRealValue("common.enter.value")+'"></div><div class="usrmn"><label>'+Resource.getRealValue("common.chat.title")+'</label><input id="emtitle" type="text"  class="emtxtbx" placeholder="'+Resource.getRealValue("common.enter.value")+'"></div></div><div class="embdmid"><div id="emtemplate" class="empnt"><span class="emdmdtxt">'+Resource.getRealValue("embed.choose.theme")+'</span><span colour="rosybrown" class="emclrbx"><em class="tms-1"></em></span><span colour="darksalmon" class="emclrbx"><em class="tms-2"></em></span><span colour="burlywood" class="emclrbx"><em class="tms-3"></em></span><span colour="gray" class="emclrbx"><em class="tms-4"></em></span><span colour="darkseagreen" class="emclrbx"><em class="tms-5"></em></span><span colour="skyblue1" class="emclrbx"><em class="tms-6"></em></span><span colour="skyblue2" class="emclrbx"><em class="tms-7"></em></span></div><div class="emctindtit">'+Resource.getRealValue("embed.customize.colours")+'</div><div id="emcustomcolour" class="emctindtxt"><div class="empnt"><span class="emdmdtxt">'+Resource.getRealValue("embed.title.text")+'</span><input id="emtitletextcode" class="emdmd-txtbx" type="text" /><span class="emclrbx"><em id="emtitletextcolour" purpose="colour" class="emclrbx1"></em></span></div><div class="empnt"><span class="emdmdtxt">'+Resource.getRealValue("embed.title.bg")+'</span><input id="emtitlebgcode" class="emdmd-txtbx" type="text" /><span class="emclrbx"><em id="emtitlebgcolour" purpose="colour" class="emclrbx1"></em></span></div><div class="empnt"><span class="emdmdtxt">'+Resource.getRealValue("embed.body.bg")+'</span><input id="embodybgcode" class="emdmd-txtbx" type="text" /><span class="emclrbx"><em id="embodybgcolour" purpose="colour" class="emclrbx1"></em></span></div><div class="empnt"><span class="emdmdtxt">'+Resource.getRealValue("embed.body.border")+'</span><input id="embodylayoutcode" class="emdmd-txtbx" type="text" /><span  class="emclrbx"><em id="embodylayoutcolour" purpose="colour" class="emclrbx1"></em></span></div></div><div class="embdcdmn"><span>'+Resource.getRealValue("embed.copy.paste.code")+'</span><div class="embdcdsb"><span><input id="emgenerate" purpose="generate" type="button" value="'+Resource.getRealValue("embed.generate")+'" /></span><textarea id="emurl" purpose="url" readonly="true"></textarea></div></div>{COLOURPALETTEHTML}</div></div><div class="embd-rht"><div id="emchatlayout" class="embdouterdiv" style="vertical-align: top;"><div id="emchattitle" class="eh ellips"></div><div id="emchatmidlayout" class="ma" style="border-bottom-width: 1px; border-bottom-style: solid;"></div><div class="ia"><span class="b">B</span><span class="i">I</span><span class="u">U</span></div><div id="emchatbotlayout" class="ta" style="border-top-width: 1px; border-top-style: solid; border-bottom-width: 1px; border-bottom-style: solid;"><textarea class="embdchatarea"></textarea></div><div class="pbyd"><div class="zembtm"><span class="poweredby">'+Resource.getRealValue("common.poweredby")+' &nbsp;</span><span class="zcht"></span></div></div></div></div>',ColourPalette:'<div id="emcolourpalette" class="zcht-wgcnt zcht-clrplt" style="display:none"><ul class="zcht-clrcnt"><li style="background-color:#FFFFFF"></li><li style="background-color:#000000"></li><li style="background-color:#F1FAFB"></li><li style="background-color:#2F0F1C"></li><li style="background-color:#A0CB46"></li><li style="background-color:#4FBFC9"></li><li style="background-color:#F7990F"></li><li style="background-color:#ED4F39"></li><li style="background-color:#BD3B70"></li><li style="background-color:#FFCC52"></li></ul><div class="zcht-clrcntmid"><ul class="zcht-clrcntr"><li style="background-color:#F2F2F2"></li><li style="background-color:#D9D9D9"></li><li style="background-color:#BFBFBF"></li><li style="background-color:#A6A6A6"></li><li style="background-color:#808080"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#808080"></li><li style="background-color:#595959"></li><li style="background-color:#404040"></li><li  style="background-color:#262626"></li><li style="background-color:#0D0D0D"></li></ul><ul class="zcht-clrcntr"> <li style="background-color:#DEF3F6"></li><li style="background-color:#B8E5EB"></li><li style="background-color:#91D8E0"></li><li style="background-color:#6BCAD5"></li><li style="background-color:#37B2BF"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#F4DDE6"></li><li style="background-color:#E4AAC2"></li><li style="background-color:#C95584"></li><li style="background-color:#842A4F"></li><li style="background-color:#511A30"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#ECF5DA"></li><li style="background-color:#D9EAB5"></li><li style="background-color:#C6E090"></li><li style="background-color:#7BA02D"></li><li style="background-color:#526B1E"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#DCF2F4"></li><li style="background-color:#B9E5E9"></li><li style="background-color:#95D9DF"></li><li style="background-color:#3198A1"></li><li style="background-color:#21656B"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#FDEBCF"></li><li style="background-color:#FCD69F"></li><li style="background-color:#FAC26F"></li><li style="background-color:#BE7406"></li><li style="background-color:#7F4D04"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#FBDCD7"></li><li style="background-color:#F8B9B0"></li><li style="background-color:#F49588"></li><li style="background-color:#CA2912"></li><li style="background-color:#871B0C"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#F3D7E2"></li><li style="background-color:#E6AFC6"></li><li style="background-color:#DA87A9"></li><li style="background-color:#8E2C54"></li><li style="background-color:#5F1D38"></li></ul><ul class="zcht-clrcntr"><li style="background-color:#FFF5DC"></li><li style="background-color:#FFEBBA"></li><li style="background-color:#FFDE97"></li><li style="background-color:#FDB200"></li><li style="background-color:#A97700"></li></ul></div><div class="zcht-sbhd ">Standard Colors</div><ul class="zcht-clrcnt"><li style="background-color:#C00000"></li><li style="background-color:#FF0000"></li><li style="background-color:#FFC000"></li><li style="background-color:#FFFF00"></li><li style="background-color:#92D050"></li><li style="background-color:#00B050"></li><li style="background-color:#00B0F0"></li><li style="background-color:#0070C0"></li><li style="background-color:#002060"></li><li style="background-color:#7030A0"></li></ul></div>',PersonalizeSetting:'<div class="mcontent"><div class="zcsetng_lft bold font16"><ul><div class="zcprhd">'+Resource.getRealValue("setting.personalize")+'</div><div class="zcitllst"><li><div option="general" purpose="category" class="paddT25 sel"><span class="zciticcnt"><span class="msi-settings"></span></span><span class="mrgL5">'+Resource.getRealValue("setting.general")+'</span></div></li><li><div option="notification" purpose="category"><span class="zciticcnt"><span class="msi-notifi"></span></span><span class="mrgL5">'+Resource.getRealValue("setting.notifications")+'</span></div></li><li><div id="ps_themes" option="themes" purpose="category"><span class="zciticcnt"><span class="msi-theme"></span></span><span class="mrgL5">'+Resource.getRealValue("settings.theme")+'</span></div></li></ul></div><div id="settingsright" class="zcsetng_rht floatl zcpscnt"><div id="personalizecontent" class="w100 zch100 posl">{PERSONALIZECONTENT}</div></div></div>',PersonalizeNotificationSettings:'<div class="w100 zch100"><div class="zcsettng_noti bold font16 posl"><ul><div class="zcitllst mrgT40"><li><div option="desktop" purpose="subcategory" class="sel"><span class="mrgL5">'+Resource.getRealValue("settings.noti.desktop")+'</span></div></li><li><div option="sound" purpose="subcategory"><span class="mrgL5">'+Resource.getRealValue("settings.noti.sound")+'</span></div></li><li><div option="email" purpose="subcategory"><span class="mrgL5">'+Resource.getRealValue("settings.noti.email")+"</span></div></li></div></ul></div>{INNERHTML}</div>",Personalize:{DesktopNotification:'<div class="zcnoti_view"><div class="mrgB10 zcplinbt posl paddB15"><div class="zcnotifymn bold font16 zcpnhd posl">'+Resource.getRealValue("settings.noti.desc")+'</div><div class="zcnotifymn">{VALLMESSAGE}<label for="vmessage" class="padlt8">'+Resource.getRealValue("setting.allmsg")+'</label></div><div class="zcnotifymn">{VMYMESSAGE}<label for="vmymessage" class="padlt8">'+Resource.getRealValue("settings.onetoone")+'</label></div><div class="zcnotifymn">{VMENTION}<label for="vmention" class="padlt8">'+Resource.getRealValue("common.mention")+'</label></div><div class="zcnotifymn">{VEVENT}<label for="vcalendar" class="padlt8">'+Resource.getRealValue("setting.eventrem")+'</label></div><div class="zcnotifymn">{VUSTATUS}<label for="vustatus" class="padlt8">'+Resource.getRealValue("setting.statuschange")+'</label></div></div><div class="zcplinbt posl"><div class="zcnotifymn bold font16 zcpnhd posl">'+Resource.getRealValue("settings.preview.show")+'</div><div class="zcnotifymn dIB">{MSGNOTIFY}<label for="previewscope" class="padlt8">'+Resource.getRealValue("settings.msg.contentshow")+'</label></div><div id="notificationpreview" class="zcnotifymn pnlznotif dIB">{NOTIFICATION}</div>'+(_isDesktopApp()&&DesktopApp.isStickyNotificationSupported()?'<div class="zcnotifymn">{STICKYNOTIF}<label for="dcstickynotif" class="padlt8">'+Resource.getRealValue("settings.msg.sticky")+"</label></div>":"")+"</div></div>",EmailNotification:'<div class="zcnoti_view"><div class="mrgB10 zcplinbt posl paddB15"><div class="zcnotifymn bold font16 zcpnhd posl">'+Resource.getRealValue("settings.email.title")+'</div><div class="zcnotifymn">'+Resource.getRealValue("settings.email.desc")+'</div><div class="zcnotifymn sdctrl">{UNREADCHATNOTIFY}<label for="unreadchatnotify" class="padlt8">'+Resource.getRealValue("settings.unreadmsg")+'</label></div><div class="zcnotifymn sdctrl">{UNREADMENTIONNOTIFY}<label for="unreadmentionnotify" class="padlt8">'+Resource.getRealValue("settings.unreadmention")+'</label></div><div class="zcnotifymn sdctrl">{CHATINVITENOTIFY}<label for="chatinvitenotify" class="padlt8">'+Resource.getRealValue("settings.chatinvites")+"</label></div></div>",SoundNotification:'<div class="zcnoti_view"><div class="mrgB10 zcplinbt posl paddB15"><div class="zcnotifymn bold font16 zcpnhd posl">'+Resource.getRealValue("settings.sound.title")+'</div><div class="zcnotifymn">'+Resource.getRealValue("settings.sound.desc")+'</div><div class="zcnotifymn sdctrl">{MSGSOUNDNOTIFY}<label for="allmsgnotify" class="w25 dIB padlt8">'+Resource.getRealValue("setting.allmsg")+'</label><div id="allmessagesound" class="zcsndsetng"><div id="allmessagesoundddhead" purpose="ddhead"><div id="allmessagesoundselected" val="{ALLMSGTONEVAL}" class="cur">{ALLMSGTONE}</div><ul id="allmessagesoundlist" class="zcasndsetng dropdwncnt" style="display:none">{ALLMSGTONESLIST}</ul></div></div></div><div class="zcnotifymn sdctrl">{MYMSGSOUNDNOTIFY}<label for="mymsgnotify" class="w25 dIB padlt8">'+Resource.getRealValue("settings.onetoone")+'</label><div id="mymessagesound" class="zcsndsetng"><div id="mymessagesoundddhead" purpose="ddhead"><div id="mymessagesoundselected" val="{MYMSGTONEVAL}" class="cur">{MYMSGTONE}</div><ul id="mymessagesoundlist" class="zcmsndsetng dropdwncnt" style="display:none">{MYMSGTONESLIST}</ul></div></div></div><div class="zcnotifymn sdctrl">{MENTIONSOUNDNOTIFY}<label for="mentionnotify" class="w25 dIB padlt8">'+Resource.getRealValue("common.mention")+'</label><div id="mentionsound" class="zcsndsetng"><div id="mentionsoundddhead" purpose="ddhead"><div id="mentionsoundselected" val="{MENTIONTONEVAL}" class="cur">{MENTIONTONE}</div><ul id="mentionsoundlist" class="zcesndsetng dropdwncnt" style="display:none">{MENTIONTONESLIST}</ul></div></div></div><div class="zcnotifymn sdctrl">{EVENTSOUNDNOTIFY}<label for="eventnotify" class="w25 dIB padlt8">'+Resource.getRealValue("setting.eventrem")+'</label><div id="eventsound" class="zcsndsetng"><div id="eventsoundddhead" purpose="ddhead"><div id="eventsoundselected" val="{EVENTTONEVAL}" class="cur">{EVENTTONE}</div><ul id="eventsoundlist" class="zcesndsetng dropdwncnt" style="display:none">{EVENTTONESLIST}</ul></div></div></div><div class="zcnotifymn sdctrl">{AVSOUNDNOTIFY}<label for="av_call_sound_notify" class="w25 dIB padlt8">'+Resource.getRealValue("settings.audiovideo.sound")+'</label></div><div class="zcnotifymn sdctrl">{SSSOUNDNOTIFY}<label for="screen_call_sound_notify" class="w25 dIB padlt8">'+Resource.getRealValue("common.screenshare")+"</label></div></div>"},PersonalizeThemes:'<div class="paddT50"><div class="zcnotifymn bold font16 zcpnhd posl mrgT40">{{theme_desc}}</div><div class="zcthclr zcplinbt posl"><div class="zcnotifymn themeview dIB"><span>{{theme_one}}</span><div class="zcthmcnt"><div purpose="theme" val="1" class="cp"><span></span><em val="1" class="msi-hissel sel"></em></div></div></div><div class="zcnotifymn themeview dIB"><span>{{theme_two}}</span><div class="zcthmcnt"><div purpose="theme" val="2" class="cp"><span></span><em val="2" class="msi-hissel"></em></div></div></div><div class="zcnotifymn themeview dIB"><span>{{theme_three}}</span><div class="zcthmcnt"><div purpose="theme" val="3" class="cp"><span></span><em val="3" class="msi-hissel"></em></div></div></div><div class="zcnotifymn themeview dIB mrgT20"><span>{{theme_four}}</span><div class="zcthmcnt"><div purpose="theme" val="4" class="cp"><span></span><em val="4" class="msi-hissel"></em></div></div></div><div class="zcnotifymn themeview dIB mrgT20"><span>{{theme_five}}</span><div class="zcthmcnt"><div purpose="theme" val="5" class="cp"><span></span><em val="5" class="msi-hissel"></em></div></div></div>{{dark_mode}}</div></div>',PersonalizeGeneralSetting:'<div class="mrgT40"><div class="mrgB10 posl paddB15"><div class="zcnotifymn zcpnhd bold posl">'+Resource.getRealValue("settings.arrange.tabs")+'</div><div class="zcnotifymn sdctrl">'+Resource.getRealValue("setting.lhs.desc")+'</div><div class="reorder zcpnhd"><div class="ztb-topband" id="ztb-topband"><div ztooltip="'+Resource.getRealValue("settings.zoho.apps")+'" class="ztooltip ztb-font-family ztb-deployment-zoho" id="ztb-switch-menu"><div class="ztb-switch-to-square"><span></span><span class="two"></span><span></span><span></span><span class="five"></span><span></span><span></span><span class="eight"></span><span></span></div></div><a id="ztb-logo"><img src="{LOGOURL}" id="ztb-logo-rebrand"><label class="{MUTESTATUS} glsound"></a></div><section id="LHS-dragable" class="zcleftsidebar zcwithimg"><div class="contactslist"><div class="zcuserstatus zchomests"><div class="zcbdytitle">'+Resource.getRealValue("smiley.home")+'</div><div class="msi-zchomeico"></div></div><div class="posrel clearfix paddB15" id="LHS-list"><div dragitem="pinnedchats" class="zclftitmn msi-drag" dragindex="0"><div class="zcbdytitle">'+Resource.getRealValue("common.pinnedchats")+'</div></div><div dragitem="chats" class="zclftitmn msi-drag" dragindex="1"><div class="zcbdytitle">'+Resource.getRealValue("common.chats")+'</div></div><div dragitem="channelslhs" class="zclftitmn msi-drag" dragindex="2"><div class="zcbdytitle">'+Resource.getRealValue("menuname.channelsandgroups")+'</div></div><div dragitem="mutedchats" class="zclftitmn msi-drag" dragindex="3"><div class="zcbdytitle">'+Resource.getRealValue("common.mutedchats")+'</div></div><div dragitem="generalcontacts" class="zclftitmn msi-drag" dragindex="4"><div class="zcbdytitle">'+Resource.getRealValue("Contacts")+'</div></div><div dragitem="botcontacts" class="zclftitmn msi-drag" dragindex="5" style="display:none;"><div class="zcbdytitle">'+Resource.getRealValue("bots.title")+'</div></div></div></div></section></div></div><div class="mrgB10 posl paddB15"><div class="zcnotifymn zcpnhd bold posl">'+Resource.getRealValue("settings.selectview")+'</div><div class="zcnotifymn sdctrl">'+Resource.getRealValue("settings.view.chatview.desc")+'</div><div class="zcnotifymn paneview mrgT15 dIB mrgR35"><div category="general" purpose="view" val="0" class="paneimg single msi-hissel mrgT20 cur"></div><span class="mrgT15">'+Resource.getRealValue("settings.view.single")+'</span></div><div class="zcnotifymn paneview mrgT15 dIB"><div category="general" purpose="view" val="1" class="paneimg multi msi-hissel mrgT20 cur"></div><span class="mrgT15">'+Resource.getRealValue("settings.view.broad")+'</span></div></div><div class="zcnotifymn sdctrl shrtcuttip msi-tip"><b>'+Resource.getRealValue("settings.tip")+":&nbsp;</b>"+Resource.getRealValue("settings.view.desc")+'&nbsp;<span class="bold">'+Resource.getRealValue("settings.view.toogle.shortcut")+'</span></div></div><div class="mrgB10 posl paddB15"><div class="zcnotifymn zcpnhd bold posl">'+Resource.getRealValue("settings.otherapps")+'</div><div class="zcnotifymn sdctrl">{CTURNOFF}<label for="cturnoff" class="padlt8">'+Resource.getRealValue("common.chat.turnoff")+'</label></div><div class="zcnotifydesc sdctrl">'+Resource.getRealValue("common.chat.turnoffdetail")+"</div>"+(_isDesktopApp()?"":'<div id="cturnofftip" class="cturnofftip dIB msi-tip dN"><b>'+Resource.getRealValue("settings.tip")+":</b> {TURNOFFTIP}</div>")+"</div></div>",EmbedchatSetting:'<div class="mcontent emchtmcnt"><div class="zcsetng_lft"><ul><li><div option="sb" purpose="catagory"><em class="zcsetng_arw"></em>'+Resource.getRealValue("embed.shoutbox")+'</div></li><li><div option="ec" purpose="catagory"><em class="zcsetng_arw"></em>'+Resource.getRealValue("embed.livechat")+'</div></li>{LIVESUPPORT}</ul></div><div class="zcsetng_rht"><div id="embedcontent" class="embd-cnt"><div class="zcldng"></div></div></div></div>',AddEvent:'<div id="evadd" class="mcontent adevnt"><div class="zcevntlft floatl"><div class="zcevhd bold font16 clr0 mrgB10">'+Resource.getRealValue("event.title")+'<div id="eventcreateshortcut" eventbuttons purpose="showCreateWin" class="msi-add cur zchsicn font13 floatr" title="'+Resource.getRealValue("event.add")+'"></div></div><div class="posl zcht100"><div id="evlistcontainer" class="zcevlst posl"><div id="evlist" class="pL25"><span class="zcldng"></span></div></div></div></div><div id="eventrightcontainer" class="zcevntrht font15 floatl"><span title="'+Resource.getRealValue("common.to.close")+'" eventbuttons purpose="close" class="msi-close cclose"></span><div id="createevcontainer" class="zcevcrtcnt zczom"></div><div id="eventview" class="dN zch100 posl eventview"></div></div></div>',CreateEvent:'<div id="eventype" class="zcevhd bold font16 clr0">'+Resource.getRealValue("event.add")+'</div><div class="zcrevtcnt floatl posl"><div class="crevtcnt posl"><div class="dIB clr0 mrgT5">'+Resource.getRealValue("common.name")+'</div><input id="evtitle" timeval="true" class="zcaddevnt zcgrpmemin font15" type="text" eventinput placeholder="'+Resource.getRealValue("event.enter.title")+'"/><div id="evtitlecount" category="charcount" limit="255" class="zcchlcount dN posa"></div></div><div class="crevtcnt posl"><div class="dIB clr0 mrgT5">'+Resource.getRealValue("common.location")+'</div><input id="evelocation" class="zcaddevnt zcgrpmemin font15" type="text" eventinput placeholder="'+Resource.getRealValue("event.location.pl")+'"/><div id="evelocationcount" category="charcount" limit="255" class="zcchlcount dN posa"></div></div><div class="crevtcnt posl"><div id="calendarscnt" class="clboth zcadd-invitbtm clr0"><div id="calendartitle" class="floatl mrgT15 ellips">'+Resource.getRealValue("emoji.calendar")+'</div>{{CALENDARCONTENTS}}</div></div><div class="crevtcnt"><div class="dIB clr0 mrgT5">'+Resource.getRealValue("event.date.header")+'</div><div class="dIB floatr zcdatecont"><div class="posrel clr0">{{STARTCALENDARCONTENTS}}<div class="zcevnto dIB">'+Resource.getRealValue("common.to.small")+'</div>{{ENDCALENDARCONTENTS}}</div></div></div><div class="crevtcnt"><div class="dIB clr0 mrgT5">'+Resource.getRealValue("event.attendees")+'</div><div id="Events-usersuggest" eventinput class="zcgrpmemin bdrn"><div id="Events-usersuggest-search-field"  tabindex="4" contenteditable="true" class="zcevusg posl" placeholder="'+Resource.getRealValue("event.attendees.placeholder")+'"></div><div id="Events-usersuggest-results" style="display:none" class="adgrp"><div id="Events-usersuggest-results-list" class="drpdwn srchglt"></div></div></div></div><div id="evpartautocomplete" class="adgrp" style="display: none;"><div id="evpartautocompletelist" class="drpdwn"></div></div><div class="crevtcnt posl">{{EVENTMANGEMENTCNT}}</div><div class="floatr zcebtns evbtncnt"><button id="evsubmit" purpose="create" eventbuttons class="dbtn adbtn mrgR20">'+Resource.getRealValue("common.create")+'</button><button id="evcancel" purpose="close" eventbuttons class="buttn_neg btn evbtn">'+Resource.getRealValue("common.cancel")+"</button></div></div></div>",EventPreview:'<div class="posa zcevshc"><div id="eventshowcontainer" eid="{{EID}}" starttime="{{STARTTIMEINMS}}" class="zcelstcnt posa"><div id="evpreviewleft" class="dIB zcevlin"><div class="zcevlft">{{EVENTDATE}}<div class="{{CLASSNAME}} mrgT15"><span>{{STARTTIME}}</span><span class="mrgLR5">{{TIMESPACE}}</span><span>{{ENDTIME}}</span></div><input eid="{{EID}}" purpose="reschedule" eventbuttons class="dbtn adbtn mrgT25 textcent" type="button" value="'+Resource.getRealValue("event.reschedule")+'"/></div></div><div id="evpreviewright" ><div id="previewscrollcontainer"><div id="title" class="font18 zcplinbt">{{TITLE}}</div><div class="zcplinbt"><div class="font18 posl">'+Resource.getRealValue("event.organizedby")+'</div><div uid="{{ORGANIZERZUID}}" elemtype="user" hover="true" class="mrgT5 clr6 cur zulin">{{ORGANIZERNAME}}</div></div><div class="zcplinbt"><div class="font18 posl zcalevnt">'+Resource.getRealValue("event.createdin")+'</div><div hover="false" class="mrgT5 clr6 cur zulin">{{CALENDARNAME}}</div></div>{{LOCATION}}<div id="evpreviewrighttime" class="zcplinbt"><div class="font18 posl">'+Resource.getRealValue("common.time")+'</div><div class="clr6 zcevprdt mrgT5 dIB">{{EVENTDATE}}&nbsp;{{STARTTIME}}&nbsp;{{TIMESPACE}}&nbsp;{{ENDTIME}}</div></div>{{ATTENDEESTITLE}}</div></div></div></div>',ReminderHtml:'<div id="{{EUID}}" ckey="{{CKEY}}" eventbuttons purpose="actionsOnReminderBox" class="zcrmnoti cur"><div class="zcclr clr0"><div class="zcrmntxt zvta dIB"><div class="ellips font16 bold dIB zcevhd" title="{{TITLE}}">{{TITLE}}</div><div class="ellips font15 mrgT15 clr0"><div class="msi-calndr dIB"></div>{{TIME}}</div>{{LOCATION}}</div></div><span id="reminderclose" class="msi-close cur"></span></div>',resendMessageHtml:'<div id="resend{MSGTIME}"  purpose="resendoptions" documentclick="resendoptions" class="mgrsdcnt posl floatr msi-resend cur {CSSCLASS}"><div id="resendlist{MSGTIME}" class="chtpopup font14"><div purpose="resend" title="'+Resource.getRealValue("message.option.retry")+'">'+Resource.getRealValue("message.option.retry")+'</div><div class="bdrB0" purpose="remove" title="'+Resource.getRealValue("common.remove")+'">'+Resource.getRealValue("common.remove")+"</div></div></div>",forwardMessagesHtml:'<div id="forwardmessages-usersuggest" class="mcontent zcinhds zcrchmcnt zcfwdwin" chid="{CHID}"><div  class="zcwinhd font15 mrgL20">'+Resource.getRealValue("message.forward.to")+'</div><div id="titleheader" class="fwdtitleheader font15 bold mrgT25 mrgL20">'+Resource.getRealValue("common.chat.title")+'</div><input id="chattitle" type="text" class="fwdtitle zccrhd font15 mrgL20" name="" placeholder="'+Resource.getRealValue("quickchat.input.placeholder")+'"><div id="selectheader" class="font15 mrgT20 mrgL20">'+Resource.getRealValue("message.forward.select")+'</div><div id="forwardmessages-usersuggest-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="'+Resource.getRealValue("message.forward.node.placeholder")+'"></div><div id="forwardmessages-usersuggest-results" class="mrgL20 zcrchtlt"><div id="forwardmessages-usersuggest-list" class="posl zcht100"></div></div><div class="crchndcnt"><div id="usernodecnt" class="zcrchicnt"><div id="forwardmessages-usersuggest-select-field" contenteditable="false" class=""></div></div><div id="sendbtn" class="windwbtn dIB cur mrgL15">'+Resource.getRealValue("common.send")+"</div></div></div>",forkChatHtml:'<div id="createforkchat-usersuggest" class="mcontent zcinhds zcrchmcnt zcforkwin" chid="{CHID}" msguid="{MSGUID}"><div  class="zcwinhd font15 mrgL20">'+Resource.getRealValue("message.fork.header")+'</div><div  class="font15 bold mrgT20 mrgL20">'+Resource.getRealValue("common.chat.title")+'</div><input id="chattitle" type="text" class="zccrhd font15 mrgT5 mrgL20" name="" placeholder="'+Resource.getRealValue("quickchat.input.placeholder")+'"><div class="selectall mrgL20 mrgT15"><div class="zchkbxmn floatl"><div class="msi-chkbxdsel" checkbox="custom"></div><input id="includeall" type="checkbox" class="zcunrdchkbx" /></div><label class="padlt8">'+Resource.getRealValue("message.fork.select.default")+'</label></div><div id="createforkchat-usersuggest-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="'+Resource.getRealValue("quickchat.node.placeholder")+'"></div><div id="createforkchat-usersuggest-results" class="zcrchtlt mrgL20"><div id="createforkchat-usersuggest-list" class="posl zcht100"></div></div><div class="crchndcnt"><div id="usernodecnt" class="zcrchicnt"><div id="createforkchat-usersuggest-select-field" contenteditable="false" class=""></div></div><div id="createforkchatbtn" class="windwbtn dIB cur mrgL15">'+Resource.getRealValue("common.create")+"</div></div></div>",messageOptionsHtml:'<div id="optnslist{CHID}_{MSGTIME}" chid="{CHID}" purpose="message_actions" msgtime="{MSGTIME}" class="chtpopup font14 {OPTCUSTOM} {OPTAPPMENUS}">{OPTIONS}{OTHEROPTION}{APPOPTIONS}</div>',messageOperationHtml:'<div id="{{id}}" class="{{class}} ellips" title="{{name}}" purpose="{{purpose}}">{{content}}</div>',messageOperationTour:'<div class="touranim"></div><span class="msgoptn-spn ellips" purpose="{{purpose}}">{{name}}</span>',commonMessageAction:'<div class="common-msg-action" id="common-msg-action">{{msgitems}}</div>',commonMessageItem:'<div id="{{id}}" purpose="{{purpose}}" class="{{class}} ellips common-msg-item" title="{{name}}"><span purpose="{{purpose}}" class="ellips">{{name}}</span></div>',forwardchathistorysearchhtml:'<div id="GS{CHID}" elemtype="chathistory" purpose="search" chid="{CHID}" class="zcrtchtcl cur zctext">{CHATIMAGE}<div class="floatl adchtrht mrgL10"><div class="ellips font14">{TITLENAME}</div><div class="ellips clr6 font13">{LASTMSGHTML}</div></div></div>',forwardchannelshtml:'<div id="channel{ID}" uid="{CHANNELID}" chid="{CHID}" elemtype="channel" purpose="search" class="zcrtchtcl cur zctext"><span class="usrimgsts zcssimg floatl">{IMG}</span><div class="floatl adchtrht mrgL10"><div class="ellips font14">{DNAMEVAL}</div><div class="ellips clr6 font13">{CDESCRIPTION}</div></div></div>',participantsHtml:'<div id="{ID}-usersuggest" class="mcontent zcrchmcnt"><div id="{ID}title" class="zcprts zccrhd font15 bold mrgL20"></div><div id="{ID}-usersuggest-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="'+Resource.getRealValue("quickchat.node.placeholder")+'"></div><div id="{ID}header" class="bold font15 mrgT5 mrgB15 mrgL20">'+Resource.getRealValue("common.participants")+'</div>{INVITEMEMBER}<div id="{ID}-usersuggest-results" class="zcrchtlt zcboxhdsdow mrgL20"><div id="{ID}-usersuggest-list" class="zcht100 posl"></div></div>{SELECTEDFEILD}</div>',participantscontactHtml:'<div uid="{USERID}" elemtype="contact" purpose="search" data-val="{DNAMEVAL}"class="zcrtchtcl zctext"><div class="floatl adchtlft posl cur"><img elemtype="user" uid="{USERID}" hover="true" src="{DEFAULTURL}" originalsrc="{IMGURL}"><div id="userstatus" class="{STATUSCLASS}"></div></div><div class="floatl adchtrht mrgL10"><div elemtype="user" hover="true" uid="{USERID}" class="ellips font14 dIB zvta cur">{DNAMEVAL}</div><div class="ellips clr6 font13"><a class="curD" href="javascript:void(0)">{EMAILID}</a></div></div>{ADDCONTACTORROLEHTML}{DELETEMEMBER}</div>',quickChatcontactHtml:'<div uid="{USERID}" elemtype="contact" purpose="search" data-val="{DNAMEVAL}"class="zcrtchtcl cur zctext"><div class="msi-hisseld floatl adchtlft posl"><img src="{IMGURL}"><div class="{STATUSCLASS}"></div></div><div class="floatl adchtrht mrgL10"><div class="ellips font14">{DNAMEVAL}</div><div class="ellips clr6 font13"><a class="cur" href="javascript:void(0)">{EMAILID}</a></div></div></div>',viewContactsListHtml:'<div id="{{win_id}}" class="mcontent zcinhds zcrchmcnt"><div  class="zccrhd font16 bold mrgL20">{{header}}</div><div><div id="{{win_id}}-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="{{searchplaceholder}}"></div>{{sort_dropdown}}</div><div id="{{win_id}}-results" class="zcrchtlt"><div id="{{win_id}}-list" zc_sticky_title_list class="w100 h100 posl list-result"></div></div></div>',viewChannelsListPopUp:'<div id="{{win_id}}" class="mcontent zcinhds zcrchmcnt"><div  class="zccrhd font16 bold mrgL20">{{header}}</div><div id="{{win_id}}-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="{{searchplaceholder}}"></div><div id="channel_categories" class="channel-filter posl"><div class="stickytitle cur" showfilter_options zc_sticky_title zc_stick_init></div><div id="category_filter" class="filter-optns posa" category_filter ></div></div><div id="{{win_id}}-results" class="zcrchtlt"><div id="{{win_id}}-list" zc_sticky_title_list class="posl h100 list-result"></div></div></div>',InstantChat:'<div class="mcontent instndcht"><div class="zciccnt posl" purpose="focus"><div id="inserrmsg" class="gp-errmsg ellips"></div><span>'+Resource.getRealValue("common.enter.emailid")+'</span><input type="text" id="insemailid" placeholder="'+Resource.getRealValue("group.add.members.ph")+'"purpose="textval" class="mtext"></div><div class="zciccnt posl" purpose="focus"><span>'+Resource.getRealValue("common.add.message")+'</span><textarea id="insmsg" class="tatext" purpose="textval"></textarea></div><div class="txtcent mtp10"><input id="inssend" type="button" class="dbtn adbtn floatr" value="'+Resource.getRealValue("common.send.request")+'"></div></div>',CustomCheckbox:'<div class="zchkbxmn floatl"><div id="selectallcheckbox" class="{CUSTOMCHECKCLASS}" checkbox="custom"></div>{DEFAULTCHECKBOX}</div>',FileUploadWindow:'<div id="fileuploadwinbody" class="mcontent zfileupldcnt {FILESCOUNTCLASS}"><div id="errormsg" class="gp-errmsg ellips"></div><div id="filescontainer" class="zimgprvmn"><div class="zcfuimgcnt" id="filespreviewlist">{FILESLIST}</div></div><div class="txtcent floatr"><input type="button" purpose="upload" class="dbtn adbtn" tabindex="0" value="'+Resource.getRealValue("common.share")+'" clearcomposer={CLEAR_COMPOSER} "><input type="button" purpose="cancel" class="buttn_neg evbtn mrgL20 floatr" tabindex="0" value="'+Resource.getRealValue("common.cancel")+'"></div></div>',FileForwardWindow:'<div id="fileforwardwinbody" class="mcontent zfileupldcnt zppwd1 zccff"><div id="errormsg" class="gp-errmsg ellips pL25"></div><div class="dIB clr6 zvta font15 mrgT6">'+Resource.getRealValue("common.to")+'&#58;</div><div id="fileforward-usersuggest" class="zcffnm dIB posl"><div id="fileforward-usersuggest-search-field" contenteditable="true" class="zcfileshare" placeholder="'+Resource.getRealValue("common.forward.to")+'"></div><div id="fileforward-usersuggest-results" class="zcautodrpdwn dN"></div></div><div id="fileforwardsuggestions" class="zcsgcnt"><div id="usrsugg" class="zcflnosugg clr6"><span class="mrgR10">'+Resource.getRealValue("contact.sugg")+'</span><div id="fileforwardusesugg" class="zcflsgimg dIB"></div></div></div><div id="filecontainer" class="zimgprvmn posl">{FILESLIST}</div><div class="txtcents mrgT10 paddT10 floatr"><input type="button" purpose="forward" tabindex="0" class="dbtn adbtn" value="'+Resource.getRealValue("common.forward")+'"><input type="button" purpose="cancel" tabindex="0" class="buttn_neg evbtn mrgL20 floatr" value="'+Resource.getRealValue("common.cancel")+'"></div></div>',FilePreviewInFileUploadWindow:'<div type="file" fileindex="{FILEINDEX}" class="zcupldimgmn posl"><div class="zupldimgtitmn dN"><div type="name" class="zupldimgtit ellips" contenteditable="true"></div></div><div type="preview" class="zupldimg"></div><div class="posl zcffcmtcnt" fileindex="{FILEINDEX}"><div id="filecommentlimit{CHID}{FILEINDEX}" data-trigger="smiley" placeholder="{COMMENTPLACEHOLDER}" contenteditable="true" type="comment" listen="keyup" maxlength="1000" class="zupldimgtara font14 mrgT25" clearcomposer={CLEAR_COMPOSER}></div><div id="filecommentcount{CHID}{FILEINDEX}" category="charcount" limit="1000" class="zcchlcount dN"></div><a id="triggersmileys{CHID}{FILEINDEX}" purpose="smileys" data-trigger="source" class="msi-zcsmly"></a><div id="smileys{CHID}{FILEINDEX}" data-trigger="destination" class="smileydivmn" data-target="1" ignore_giphy="true"></div></div><div purpose="close" class="msi-close cclose" title='+Resource.getRealValue("common.remove")+"></div>{ANNOTATE}</div>",AudioPlayer:'<div class="zcaudpmn flexC"><div class="msi-audioicn fshrink"></div><div id="audioplayer" documentclick="media" fileid="{FILEID}" source="{FILEURL}" class="zcadply darkmedia flexG posrel">{MEDIACONTROLS}</div></div>',VideoPlayer:'<div class="zcvidplyr posl"><div id="videoplayer" documentclick="media" fileid="{FILEID}" source="{FILEURL}" class="zcvideomn"><div id="playarea" class="zcemb-vido"><div id="screenplay" action="play" purpose="toggleclass" operation="play" class="play-icon zcf-play alignM"></div><video id="video" action="play" {VIDEOTHUMBPOSTER} style="width:100%; height:inherit;"></video></div><div  id="VideoControl" class="zcmediacntrl {VIDEODN}">{MEDIACONTROLS}</div></div></div>',AttViewInCwin:'<div class="zchtmsgcnt" documentclick="viewattachment" chid="{CHID}" fsender="{FSENDER}" senttime="{STIME}" fsize="{FILESIZE}" fname="{FILENAME}" fsendername="{SENDERNAME}" url="{FURL}" hasthumbnail="{HASTHUMB}" isv1="{ISV1}" content="{CONTENTTYPE}" {FCOMMENT}><div class="zcfileatchcon {ZCIMGVW}" draggable="true">{FILEPREVIEW}<div class="zcfileinf flexC {INFODN}">{MEDIAINFO}<div class="filedtlActn fshrink"><span documentclick="attdownload" title="'+Resource.getRealValue("common.download")+'" class="zcf-download fileactn-item"></span><span documentclick="attforward" title="'+Resource.getRealValue("common.forward")+'" class="zcf-forward fileactn-item"></span></div></div></div></div>{FILECOMMENT}',MediaInfoHtml:'<div class="filetypcon zcf-file zcrgtbrdr fshrink" title="{FILENAME}"><span class="fltypnm ellips">{FILETYPE}</span></div><div class="filedtl flexG ellips"><div class="filename ellips">{FILENAME}</div><div class="filesize diB clr6 posrel">{FILESIZE}{PREVIEWLINK}</div></div>',AVPlayer:'<div id="{PLAYERID}" documentclick="media" fileid="{FILEID}" source="{FILEURL}" class="zcvideomn zcfilevw" draggable="true">{CONTENTDIV}<div id="VideoControl" class="zcmediacntrl {VIDEODN}">{MEDIACONTROLS}</div><div documentclick="attforward" title="'+Resource.getRealValue("common.forward")+'" id="fileforwardicon" class="frwrd-icon zcf-forward cur"></div></div>',Mp3Player:'<div class="filedtl darkmedia flexG ellips"><div class="font13 fontb ellips"><span class="zcf-music mrgR5 font14"></span>{FILENAME}</div><div id="audioplayer" documentclick="media" fileid="{FILEID}" source="{FILEURL}">{MEDIACONTROLS}</div></div>',MediaControl:'<div class="zcvdopmn"><div id="seek" action="seek" class="zcaudsldrmn"><div id="scroll" class="zcad-cirle"></div><div id="played" action="seek" class="zcaudsldsb"></div></div><div class="flexC"><div class="flexG flexC font16"><div action="play" purpose="toggleclass" operation="play" class="zcf-play mR10 cur"></div><div action="speaker" operation="mute" class="zcf-sound spkr-icon cur mR10 {MUTEDN}"></div><div class="zcvdcunt font13 mR10"><span id="currenttime" class="zcvdo-time-current">00:00</span><span class="zcvdo-time-separator">/</span><span id="duration" class="zcvdo-time-duration">00:00</span></div></div>{VIDEOCONTRLRHS}</div></div>',LinkVideoOrImageHTML:'<div purpose="urlunfurl" class="zcvideodetail zcunfdtl" url="{LINKURL}" ><div thumbnailurl="{THUMBNAILURL}" class="zcmsgvideo posl" {ADDITIONALATTRDATA}>{VIDEOPLAYBUTTON}{LINKTHUMBNAIL}</div><div class="zccontenttext p10"><div class="ellips line12">{FAVICON}<a href="{LINKWEBSITEURL}" dataurl="{REDIRECTLINKWEBSITEURL}" class="ellips clr6 font12" target="_blank">{LINKWEBSITENAME}</a></div><div class="ellips lineN mT5"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="ellips bold font13 videolink">{LINKTITLE}</a></div></div><div class="zccontenttext p10 pT0 {DN}"><div class="detail">{LINKDESCRIPTION}</div></div></div>',LinkCompVideoOrImageHTML:'<div purpose="urlunfurl" class="zcvideodetail"><div class="flexC"><div thumbnailurl="{THUMBNAILURL}" class="zcmsgvideo posl fshrink mR10" {ADDITIONALATTRDATA}>{VIDEOPLAYBUTTON}{LINKTHUMBNAIL}</div><div class="flexG line26 ellips"><div class="zcwebsite ellips bold"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="font14 ellips">{LINKURL}</a></div><div class="ellips bold"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="zcvidcnt font14 ellips">{LINKTITLE}</a></div><div class="ellips bold clr8"><a href="{LINKWEBSITEURL}" dataurl="{REDIRECTLINKWEBSITEURL}" class="zcwebsite" target="_blank">{LINKWEBSITENAME}</a></div></div></div></div>',LinkAudioHTML:'<div purpose="urlunfurl" class="zcaudiodetail zcunfdtl mrgB15"><div class="zcaudioimg" {ADDITIONALATTRDATA}>{LINKTHUMBNAIL}</div><div class="zccontenttext"><div class="zcwebsite ellips bold"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="font14">{LINKURL}</a></div><div class="ellips bold"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="zcvidcnt ellips">{LINKTITLE}</a></div><div class="ellips clr8 bold"><a href="{AUTHORURL}" dataurl="{REDIRECTAUTHORURL}" class="zcwebsite ellips" target="_blank">{AUTHORNAME}</a> | <a href="{LINKWEBSITEURL}" dataurl="{REDIRECTLINKWEBSITEURL}" class="zcwebsite" target="_blank">{LINKWEBSITENAME}</a></div></div></div>',LinkPreviewHTML:'<div purpose="urlunfurl" class="zcsitedetail zcunfdtl p10 lineN" url="{LINKURL}"><div class="zcsitetitle ellips"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="font15 fontb">{LINKTITLE}</a></div><div class="flexC mT5">{LINKTHUMBNAIL}<div class="detail clr6">{LINKDESCRIPTION}</div></div><div class="zccontenttext mT5"><div class="ellips flexC">{FAVICON}<a href="{LINKWEBSITEURL}" dataurl="{LINKWEBSITEURL}" class="font14 clr8 ellips" target="_blank">{LINKWEBSITENAME}</a></div></div></div>',LinkCompPreviewHTML:'<div class="zcsitedetail"><div class="flexC">{LINKTHUMBNAIL}<div class="flexG line26 ellips"><div class="ellips bold font18"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="ellips clr0">{LINKTITLE}</a></div><div class="ellips font15"><a href="{LINKURL}" dataurl="{REDIRECTLINKURL}" target="_blank" class="ellips zcslink">{LINKURL}</a></div><div class="ellips bold"><a href="{LINKWEBSITEURL}" dataurl="{REDIRECTLINKWEBSITEURL}" class="zcwebsite font14" target="_blank">{LINKWEBSITENAME}</a></div></div></div><div class="mT10"><div class="detail font14">{LINKDESCRIPTION}</div></div></div>',LiveSupportHTML:'<div id="{CHID}" purpose="support" guid="{GUID}" a="{ATTR_A}" g="{ATTR_G}" suptitle="{SUPPORTTITLE}" guname="{GUESTNAME}" status="active" class="zcsupport"><div class="msi-lvsptrep"></div><span id="close" class="msi-close cclose"></span><div class="zcnotify_tit ellips">{GUESTNAME}-{SUPPORTTITLE}</div><div class="zcnotify_msg">{TIME}</div><div class="zcnotify_btm"><input id="accept" class="zcnotfbtn csel mrgR10" type="button" value="'+Resource.getRealValue("common.accept")+'"/><input id="skip" class="zcnotfbtn" type="button" value="'+Resource.getRealValue("common.skip")+'"/></div></div>',EditChannel:'<div class="mcontent adgrpcnt zchlcrtpop" ><div id="channeldetailscont" channelid="{{CHANNELID}}" class="zchcinct"><div class="zchcnt edit dflxcent mrgT20"><div class="zchintt dIB font14 bold">'+Resource.getRealValue("channel.name.title")+'</div><div class="zchproimg dIB posl mrgL15 mrgR15"><div id="channeldefimg" class="zchrtimg ">{CHANNELIMAGE}</div><div width="60px" height="60px" type="imgpreview" class="zchimg"></div><input type="file" id="channelphoto" name="cphoto" class="sendfile" accept="image/*"><span class="zchangeimg msi-camera font10 dN posa"></span></div><div class="zcrtchnltit dIB mrgL10 posl"><input type="text" listen="keyup" id="channelnameval" tabindex="0" class="mtext mrgT10 font14" maxlength="50" placeholder="'+Resource.getRealValue("channel.name.ph")+'"/><div id="channelnamecount" category="charcount" limit="50" class="zcchlcount dN posa">50</div><div class="clr6 dIB font14">'+Resource.getRealValue("channel.name.tip")+'</div><div id="channelnameerrormsg" category="errormsg" class="posa errch ia clrboth"></div></div></div><div id="channelscopes-group" style="display:none;" class="mrgT70"></div><div id="channels-visibility" style="display:none;" class="mrgT70"></div><div class="chnldesc zchcnt mrgT70"><div class="zchintt dIB font14 bold">'+Resource.getRealValue("channel.desc")+'</div><textarea id="channeldescval" tabindex="0"  listen="keyup" class="tatext {DESCEXPANDECLASSS} zcaddcnt font14" maxlength="300" placeholder="'+Resource.getRealValue("channel.purpose")+'"></textarea><div id="channeldescerrormsg" category="errormsg" class="posl errch floatl zchdeser"></div><div id="channeldesccount" category="charcount" limit="300" class="zcchlcount dN">300</div></div></div><div class="txtcent dflx footr"><button class="buttn_pos adbtn zchlstcrt mrgR30 mrgat" id="saveeditchannel" tabindex="0">'+Resource.getRealValue("common.savechanges")+"</div></div></div>",CreateChannel:'<div class="mcontent adgrpcnt zchlcrtpop" ><div id="createchanneltip" class="zccrethint clr6 font15">{CREATECHANNELHINT}</div><div id="channeldetailscont" class="zchcinct"><div class="zchcnt dflxcent mrgT40"><div class="zchintt dIB font14 bold">'+Resource.getRealValue("channel.name.title")+'</div><div class="zchproimg dIB posl mrgL35 mrgR15"><div id="channeldefimg" class="zchrtimg ">{CHANNELIMAGE}</div><div id="chnimgdata" width="60px" height="60px" type="imgpreview" class="zchimg"></div><input type="file" id="channelphoto" name="cphoto" class="sendfile" accept="image/*"><span class="zchangeimg msi-camera font10 dN posa"></span></div><div class="zcrtchnltit dIB mrgL10 posl"><input type="text" listen="keyup" id="channelnameval" tabindex="0" class="mtext mrgT10 font14" maxlength="50" placeholder="'+Resource.getRealValue("channel.name.ph")+'"/><div id="channelnamecount" category="charcount" limit="50" class="zcchlcount dN posa">50</div><div class="clr6 dIB font14">'+Resource.getRealValue("channel.name.tip")+'</div><div id="channelnameerrormsg" category="errormsg" class="posa errch ia clrboth"></div></div></div><div id="channelscopediv" class="zchlselect zchcnt posl"><div id="channelscopetitle" class="zchlcrtpopmn zchintt dIB font14 bold">'+Resource.getRealValue("channel.levels")+'</div><div id="channelscoperadio" class="zcradiobtns dIB floatr">{CHANNELSCOPERADIOBUTTONS}<div id="channelscope-info" class="font14 mrgT10 clr6">'+Resource.getRealValue("channel.sel.level")+'</div></div></div><div id="channelscopes-group" style="display:none;"></div><div id="channels-visibility" style="display:none;"></div><div id="channelscopes-private" class="usrslctn" style="display:none;"></div><div class="chnldesc zchcnt"><div class="zchintt dIB font14 bold">'+Resource.getRealValue("channel.desc")+'</div><textarea id="channeldescval" tabindex="0"  listen="keyup" class="tatext {DESCEXPANDECLASSS} zcaddcnt font14" maxlength="300" placeholder="'+Resource.getRealValue("channel.purpose")+'"></textarea><div id="channeldescerrormsg" category="errormsg" class="posl errch floatl zchdeser"></div><div id="channeldesccount" category="charcount" limit="300" class="zcchlcount dN">300</div></div></div><div class="txtcent dflx footr fjustifySB"><div class="bold chlrules dN flxG" purpose="addadvancerules">'+Resource.getRealValue("channel.rules.header")+'<span class="msi-uparw mrgL5 vertmid"></span></div><button class="buttn_pos adbtn zchlstcrt mrgR30 mrgat" id="createchannel" tabindex="0">'+Resource.getRealValue("channel.create.header","")+"</div></div></div>",ListChannel:'<div id="chnlist" scope="{SCOPE}" shId="{ID}" shName="{SHNAME}" class="mcontent adgrpcnt zchlsrclst"><div id="chnlistheader" class="dflxcent"><div class="zccrethint clr6">'+Resource.getRealValue("channel.list.info")+'</div>{CREATE_CHANNEL_BTN}</div><div id="channellistsearchholder" class="zchlsrcmn dN"><span class="msi-srchicon"></span><input class="zchnsrctxtbx" id="channelslistsearch" placeholder="'+Resource.getRealValue("channel.search.ph")+'" type="text"></div><div class="chnrows"><div id="channelrowslist" class="zchnsrcmgmn"></div></div>{CHANNELFOOTER}</div>',PreviewCreatedChannel:'<div id="{CHANNELID}" class="mcontent adgrpcnt chlbody"><div class="zchproimg posl"><div class="chanprevhdr"><div class="chlinfohdr  dflxcent mrgB20"><div id="channelimg_preview" class="zchpreviewimg floatr">{CHANNELIMG}</div><div class="floatl mrgL20 zchped"><div id="channelsdesc" class="font14 clr8 lin20">{CREATORHTML}{TEAMNAME}&nbsp;<span>{CREATEDTIME}</span>{EDITHTML}</div><div class="zchedd"><div class="mrgT5 font14 zchcrt disble" id="channeldesc" placeholder="'+Resource.getRealValue("channel.desc.placeholder")+'">{DESC}</div></div></div></div><div id="viewoption" class="mrgB10 posl cb zcchprhdr"><div id="recentconv" class="dIB crtit sel" channelid="{CHANNELID}"  chid={CHATID}  purpose="recentconv">'+Resource.getRealValue("common.recentconv")+'</div><div id="permission" class="dIB crtit mrgL20" channelid="{CHANNELID}"  chid={CHATID}  purpose="permission">'+Resource.getRealValue("common.permission")+'</div><div id="connectors" class="dIB crtit mrgL20" channelid="{CHANNELID}"  chid={CHATID}  purpose="connectors">'+Resource.getRealValue("app.connectors")+'</div></div></div><div id="recentconversation"  class="chnmsgbody cb mrgB10 posl"><div id="channelmessagebody" chid="" purpose="chatbody" class="currchatpanel zchrec zcprbdy"></div><div id="channelpermission" class="dN posl zcchprcnt"></div><div id="channelconnectors" class="dN zcchprcnt zchconctor posl"></div></div><div class="txtcent dflx footr fjustifySB"><div id="activeparticipants" class="zcftrlft mrgat flx1"><div id="channelapholder" class="zcac dflxcent mrgL15 floatl"></div></div><div id="channelactionholder" class="mrgL10 mrgR15 fshrink flexC flx-rowR">{ACTIONS}</div></div></div>',PreviewPendingChannel:'<div class="chlpendingbody"><div class="paddLR10 textcent"><div id="channelimg_preview" class="zchpreviewimg">{CHANNELIMG}</div><div class="font16 mrgT15 bold" id="pendingchlname">{CHANNELNAME}{EDITHTML}</div><div class="mrgT5 font14" id="channeldesc" placeholder="'+Resource.getRealValue("channel.desc.placeholder")+'">{DESC}</div><div class="clr6 font14 mrgT25 zclin24"><div class="font13">'+Resource.getRealValue("group.created.by")+'</div><div uid="{CREATORUID}" elemtype="user" hover="true" class="zcretname bold hvrinfo">{CREATORNAME}</div>{TEAMNAME}&nbsp;&nbsp;<div class="mrgT10 crtime">{CREATEDTIME}</div></div><div class="txtcent mrgT30">{ACTIONS}</div></div></div>',ChannelAdvanceRules:'<div id="chnadvrules" class="chl-adpopup"><div class="chlrulescont dflx flx-dirC"><div class="rulshdr"><div class="bold chlrules dIB" purpose="Close">'+Resource.getRealValue("channel.rules.header")+'<span class="msi-arwdwn mrgL5"></span></div><div class="zcchprhdr"><div class="sel dIB posl" data-header="permission" purpose="AdvRulesheaderChange" id="advpermission">'+Resource.getRealValue("common.permission")+'</div><div class="mrgL30 dIB posl" data-header="preference" purpose="AdvRulesheaderChange" id="advcriteria">'+Resource.getRealValue("channel.preferenceheader")+'</div></div></div><div id="advrulescontainer" class="chledtperm"><div id="advrules"></div><div id="editperms" class="dN mrgT10"></div></div><div class="txtcent dflx footr"><button id="saveadvrules" class="buttn_pos floatr mrgR30 mrgat" purpose="Close" disabled>'+Resource.getRealValue("common.save")+"</button></div></div></div>",ParticipantsPreference:'<div class="ruls-cont"><div id="reportngtme" class="mrgT10 font14 reportngtme posl" disabled><input type="checkbox" data-purpose="reporting_to_me" class="mrgR10 font16" checked disabled><i class="msi-ticktwo cuschkbx cur" purpose="CheckBox"></i><label>'+Resource.getRealValue("channel.reporting.info")+'</label></div><div id="chlprefrnce" class="mrgT20"><span class="font15 fontb">'+Resource.getRealValue("channel.preferenceheader.1")+'</span><div id="matchcriteria" class="dN mrgT25 font14 mrgB10">{{radiobutton}}</div><div id="addchlcri" class="dflxcent chl-adcri" nocriteria="true"><div class="cur dIF paddT15 paddB10" purpose="AddCriteria"><em class="msi-plus"></em><span class="font13 mrgL10">'+Resource.getRealValue("channel.addcriteria")+"</span></div></div></div></div>",keyboardshortcuts:'<div class="mcontent kbscnt"><div class="zckbcnt"><div class="gblnavi floatl paddT10"><div class="zckbf ctit">'+Resource.getRealValue("keyshrotcut.globalnavigation")+'</div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.exit")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">esc</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.outoffocus")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">shift</span><span class="zckbf zckbpls">+</span><span class="zcksb">esc</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.globalsearch")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CMD_OR_CTRL}</span><span class="zckbf zckbpls">+</span><span class="zcksb">shift</span><span class="zckbf zckbpls">+</span><span class="zcksb">f</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.spotlight")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CTRLKEY}</span><span class="zckbf zckbpls">+</span><span class="zcksb">space</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.onesearch")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CMD_OR_CTRL}</span><span class="zckbf zckbpls">+</span><span class="zcksb">/</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.addevent")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CMD_OR_CTRL}</span><span class="zckbf zckbpls">+</span><span class="zcksb">shift</span><span class="zckbf zckbpls">+</span><span class="zcksb">e</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.addcontact")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CTRLKEY}</span><span class="zckbf zckbpls">+</span><span class="zcksb">shift</span><span class="zckbf zckbpls">+</span><span class="zcksb">a</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.history")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CMD_OR_CTRL}</span><span class="zckbf zckbpls">+</span><span class="zcksb">shift</span><span class="zckbf zckbpls">+</span><span class="zcksb">h</span></div></div></div><div class="zckschwin paddT10"><div class="zckbf ctit">'+Resource.getRealValue("keyshrotcut.chatwindow")+'</div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.plus")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">+</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.slash")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">/</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("smiley.cliq")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">:</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("smiley.emoji")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CMD_OR_CTRL}</span><span class="zckbf zckbpls">+</span><span class="zcksb">e</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.at")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb mrgR10">@</span><span class="zcksb">cc:</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.hori_line")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">enter</span><span class="zckbf zckbpls">- ></span><span class="zcksb">enter</span></div></div></div><div class="paddT10"><div class="zckbf ctit">'+Resource.getRealValue("common.settings")+'</div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.broadsheetview")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">alt</span><span class="zckbpls">+</span><span class="zcksb">enter</span></div></div><div class="zckbshov"><div class="dIB zckbsbs zckbf zcksbb">'+Resource.getRealValue("keyshrotcut.globalmute")+'</div><div class="zcksbt"></div><div class="zckbf zcksbb dIB zcksdes"><span class="zcksb">{CMD_OR_CTRL}</span><span class="zckbf zckbpls">+</span><span class="zcksb">shift</span><span class="zckbf zckbpls">+</span><span class="zcksb">m</span></div></div></div></div>',Integrationwin:'<span id="integtogglelhs" integbuttons purpose="toggleLHS" class="msi-minemiz font12 dIB posa cur"></span><div class="zcintcnt"><div id="integrationLHS" transitionelem class="zcitlft font15 bold"><div class="zcpnhd zcprhd"><span class="zchidcnt">'+Resource.getRealValue("integration.title")+'</span></div><div class="zcitllst"><div integlhsmenu entity="Commands" style="display:none;"><span class="zciticcnt"><span class="msi-slash mrgR10 font12"></span></span><span class="zchidcnt">'+Resource.getRealValue("integration.commands")+'</span></div><div integlhsmenu entity="MessageActions" style="display:none;"><span class="zciticcnt"><span class="msi-action mrgR10 font16"></span></span><span class="zchidcnt">'+Resource.getRealValue("integration.messageaction.title")+'</span></div><div integlhsmenu entity="Functions" style="display:none;"><span class="zciticcnt"><span class="msi-fx mrgR10 font15"></span></span><span class="zchidcnt">'+Resource.getRealValue("functions.title")+'</span></div><div integlhsmenu entity="Schedulers" style="display:none;"><span class="zciticcnt"><span class="msi-schedlr mrgR10 font15"></span></span><span class="zchidcnt">'+Resource.getRealValue("schedulers.title")+'</span></div><div integlhsmenu entity="PlatformStorages" style="display:none;"><span class="zciticcnt"><span class="msi-platfrmdb mrgR10 font15"></span></span><span class="zchidcnt">'+Resource.getRealValue("platformdatabases.title")+'</span></div><div integlhsmenu entity="Bots" style="display:none;"><span class="zciticcnt"><span class="msi-boticon mrgR10 font15 zctext"></span></span><span class="zchidcnt">'+Resource.getRealValue("bots.title")+'</span></div><div integlhsmenu entity="Applications" style="display:none;"><span class="zciticcnt"><span class="msi-zohoaps mrgR10 font15 zctext"></span></span><span class="zchidcnt">'+Resource.getRealValue("app.apps")+'</span></div></div><a target="_blank" href="/deluge/connections?sharedBy='+$zcg._APPACCOUNTID+'&serviceName=ZohoCliq" class="zcconn ellips"><div><span class="msi-advance"></span><span class="zcconntxt">'+Resource.getRealValue("integration.connections")+'</span></div></a></div><div id="IntegrationsRHS" transitionelem class="zcitrht"></div>',CommandInitialPage:'<div id="commandsearchcontainer" class="zccmdinp zcvsbhid"><span class="msi-sp0"></span><input id="commandsearch" class="zcmdinp" purpose="search" commandsinput type="text" placeholder="'+Resource.getRealValue("integration.search")+'"/></div><div class="mrgT15"><div class="zcincmt {{class_name}} font15 dIB">'+Resource.getRealValue("integration.commands.info")+'</div><div commandbuttons purpose="add" class="textcent zcinab dbtn adbtn floatr mrgT10 {{hide_create_class}}">'+Resource.getRealValue("integration.add.commands")+'</div></div><div class="zccnthibx posl"><div zc_sticky_title class="zcinhds font15 bold cmdfxdhdr dN"></div><div id="commandslist" integrationlistview="Commands" zc_sticky_title_list class="zcincmcnt posl"></div></div><div id ="Integrationspreviewcontainer" style="left: 100%" class="zcprvcmt" ><div id = "Integrationspreview" style="left: 100%" class="zcprvcmt font15 dN"></div></div>',IntegrationAddCommand:'<div class="mrgT75"><span integlhsmenu entity="Commands" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font16 bold posl dIB zvta">'+Resource.getRealValue("integration.add.commands")+'</div></div><div class="zccnthibxad posl"><div id="addcommandui" class="zcadcmcnt clrboth"><div class="zcincmli"><div id="commandname-info" class="zcincmt dIB">'+Resource.getRealValue("commands.create.info")+'</div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.name")+'</div><div id="commandname-info" class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.commands.info.two")+'</div><input id="commandname" maxlength="20" commandinputs type="text" class="zcadcmtin" placeholder="{EX-NAME}"/><div class="clra font14">'+Resource.getRealValue("integration.inptinfo.one")+'</div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.commandhint")+'</div><div id="commandhint-info" class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.commandhint.info")+'</div><input id="commandhint" maxlength="100" commandinputs type="text" placeholder="{EX-HINT}" class="zcadcmtin"/></div><div id="addcommandscope" class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.access")+'</div><div class="zcincmt  dIB">'+Resource.getRealValue("integration.access.info")+'</div><div id="commandscoperadio" class="zcradiobtns dIB mrgT15">{COMMANDSCOPERADIOBUTTONS}</div><div id="commandscope-info" class="mrgT10 clr6 zchlinfo mrgT5">'+Resource.getRealValue("integration.scope.info3")+'</div><div id="commandscopes-group" style="display:none;"></div></div><div id="codevisibility" class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("commands.code.visibility")+'</div><div class="zcincmt dIB">'+Resource.getRealValue("commands.visibility.info")+'</div><div class="dIB mrgT15">{COMMANDSVISIBILITY}<div class="floatl mrgL10">'+Resource.getRealValue("commands.visibility.hint")+'</div></div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("commands.suggestion.clicktosend")+'</div><div class="zcincmt dIB mrgT5 cmdselectionlim ">'+Resource.getRealValue("commands.selectionlimit.info",'<input type="text" id="selectionlimit" commandinputs class="padd5" placeholder="1"/>')+'</div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.image")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.image.info")+'</div><div class="zcgpimgcnt posrel"><div width="50px" height="50px" type="imgpreview" class="zchimg"></div><div class="msi-cmdicn clr6 mrgT15"></div><div id="commanddefimg" class="zcrtgrpimg"></div><input id="commandphoto" type="file" class="sendfile" accept="image/*"/><div class="zchangeimg zcbotimg font10 dN posa">'+Resource.getRealValue("common.change")+'</div></div><div class="clra font14">'+Resource.getRealValue("integration.commands.info.three")+'</div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.desc")+'</div><div id="commanddesc-info" class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.desc.info")+'</div><textarea id="commanddesc" maxlength="300" type="text" placeholder="{EX-DESC}" class="zcadcmtin padd10"></textarea></div><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.options")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("commands.options.info")+'</div><div id="commandoptionscont" commandinputs class="zccminbx mrgT25 mrgB10"><div class="mrgT15 mrgB15 bold"><div class="dIB w135">'+Resource.getRealValue("commands.key.value")+'</div><div class="dIB">'+Resource.getRealValue("common.desc")+'</div></div><div commandoptions class="mrgB15 mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY1}"/><div class="dIB bold textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5" placeholder="{VALUE1}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY2}"/><div class="dIB bold textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5" placeholder="{VALUE2}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY3}"/><div class="dIB bold textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5" placeholder="{VALUE3}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY4}"/><div class="dIB bold textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5" placeholder="{VALUE4}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY5}"/><div class="dIB bold textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5" placeholder="{VALUE5}"/></div></div></div></div><div commandbuttons purpose="create" class="dbtn adbtn floatr mrgT25 mrgR10 zcdedbtn">'+Resource.getRealValue("integration.save.editcode")+"</div>",IntegrationEditCommand:'<div id="editcommandui" commandid="{COMMANDID}" class="zccmdinh mrgT75"><span integlhsmenu entity="Commands" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font15 bold posl dIB zvta">'+Resource.getRealValue("integration.edit.commands")+'</div><div class="zccnthibxad posl"><div id="editcommandcontainer" class="zcadcmcnt clrboth"><div class="zcincmli"><div class="font15 bold posl mrgB5">'+Resource.getRealValue("integration.commands")+'</div><div id="commandname-info" class="zcincmt font14 dIB mrgT5">'+Resource.getRealValue("integration.commands.info.two")+'</div><input id="commandname" maxlength="20" commandinputs type="text" class="zcadcmtin" value="{NAME}" placeholder="{EX-NAME}"/><div class="clra">'+Resource.getRealValue("integration.inptinfo.one")+'</div></div><div class="zcincmli"><div class="font15 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.commandhint")+'</div><div id="commandhint-info" class="zcincmt font14 dIB mrgT5">'+Resource.getRealValue("integration.commandhint.info")+'</div><input id="commandhint" maxlength="100" commandinputs type="text" value="{HINT}" placeholder="{EX-HINT}" class="zcadcmtin"/></div><div id="addcommandscope" class="zcincmli"><div class="font15 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.access")+'</div><div class="zcincmt dIB">'+Resource.getRealValue("integration.access.info")+'</div><div id="commandscoperadio" class="zcradiobtns dIB mrgT15">{COMMANDSCOPERADIOBUTTONS}</div><div id="commandscope-info" class="mrgT10 clr6 zchlinfo mrgT5">{SCOPEHINT}</div><div id="commandscopes-group" style="display:none;"></div></div><div id="codevisibility" class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("commands.code.visibility")+'</div><div class="zcincmt dIB">'+Resource.getRealValue("commands.visibility.info")+'</div><div class="dIB mrgT15">{COMMANDSVISIBILITY}<div class="floatl mrgL10">'+Resource.getRealValue("commands.visibility.hint")+'</div></div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("commands.suggestion.clicktosend")+'</div><div class="zcincmt dIB mrgT5 cmdselectionlim ">'+Resource.getRealValue("commands.selectionlimit.info",'<input type="text" id="selectionlimit" commandinputs class="padd5" placeholder="1"/>')+'</div></div><div class="zcincmli"><div class="font15 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.image")+'</div><div class="zcincmt  font14 dIB mrgT5">'+Resource.getRealValue("integration.image.info")+'</div><div class="zcgpimgcnt posrel"><div width="50px" height="50px" type="imgpreview" class="zchimg"></div><div class="msi-cmdicn clr6 mrgT15"></div><div id="commanddefimg" class="zcrtgrpimg"></div><input id="commandphoto" type="file" class="sendfile" accept="image/*"/><div class="zchangeimg zcbotimg font10 dN posa">'+Resource.getRealValue("common.change")+'</div></div><div class="clra">'+Resource.getRealValue("integration.commands.info.three")+'</div></div><div class="zcincmli"><div class="font15 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.desc")+'</div><div id="commanddesc-info" class="zcincmt  font14 dIB mrgT5">'+Resource.getRealValue("integration.desc.info")+'</div><textarea id="commanddesc" maxlength="300" type="text" placeholder="{EX-DESC}" class="zcadcmtin padd10">{DESC}</textarea></div><div class="font15 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.options")+'</div><div class="zcincmt font14 dIB mrgT5">'+Resource.getRealValue("commands.options.info")+'</div><div id="commandoptionscont" commandinputs class="zccminbx mrgT25 mrgB10"><div class="mrgT15 mrgB15 bold font14"><div class="dIB w135">'+Resource.getRealValue("commands.key.value")+'</div><div class="dIB">'+Resource.getRealValue("common.desc")+'</div></div><div commandoptions class="mrgB15 mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY1}"/><div class="dIB bold font14 textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5 font14" placeholder="{VALUE1}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY2}"/><div class="dIB bold font14 textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5 font14" placeholder="{VALUE2}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY3}"/><div class="dIB bold font14 textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5 font14" placeholder="{VALUE3}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY4}"/><div class="dIB bold font14 textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5 font14" placeholder="{VALUE4}"/></div><div commandoptions class="mrgT25"><input id="key" type="text" class="mtext padd5" maxlength="5" placeholder="{KEY5}"/><div class="dIB bold font14 textcent zcmdarw">-></div><input id="value" type="text" maxlength="100" class="mtext mrgR20 zcmtxt padd5 font14" placeholder="{VALUE5}"/></div></div></div></div><div commandbuttons purpose="saveEdit" class="dbtn adbtn floatr mrgT25 mrgR10">'+Resource.getRealValue("common.save")+"</div></div>",DelugeEditorUI:'<div id="delugeeditorcontainer" moduleName="{TYPE}" componentId="{COMPONENT_ID}" handlerType="{HANDLER_TYPE}" class="zch100 zcshowloading"><div {PARENT_PARAMS} editor transitionelem class="zcedtcde mrgT25 posl"><div><span {BACK_BUTTON_PARAMS} class="msi-zcheadicn mrgR10"></span><div id="editcodeheader" class="zcinhds dIB font15 bold posl">{NAME}<span id="otherhandlers"></span></div></div><div type="{TYPE}" class="zcincmdcd"><div id="editcodeloading" class="zcdlgldng dN"><div></div><div class="zcldng"></div></div><div id="minimizebtn" integrationcwinbuttons purpose="minimizeEditCode" class="msi-cmdarw posa font12 clr8 cur"></div><div class="zcsave zcdebug font13 posa"><span drebuttons purpose="toggleLogs">'+Resource.getRealValue("drelogs.show")+'</span></div><div class="zcsave font13 posa"><span drebuttons purpose="update">'+Resource.getRealValue("common.save")+'</span><span drebuttons purpose="saveAndExecute" class="hide">'+Resource.getRealValue("common.save.execute")+'</span></div><div id="delugeEditorArea" style="height:100%"></div></div></div><div id="integoutputcont" style="display:none" class="posa zcincmot zcinttip"><div id="integoutput" class="zccmdopt font14"></div><span drebuttons purpose="closeoutput" title="Close [Esc]" class="msi-close cclose"></span></div><div id="drelogs" class="zcdrelogs"><div id="sizechanger" sizechanger class="zcdrelogsresizer"><div></div><div></div><span>'+Resource.getRealValue("drelogs.resize")+'</span></div><div class="bold paddB10">'+Resource.getRealValue("drelogs.title")+'<span purpose="refreshLogs" drebuttons title="'+Resource.getRealValue("drelogs.refresh")+'" class="msi-refresh mrgL10 cur"></span><span purpose="hideLogs" drebuttons title="'+Resource.getRealValue("drelogs.hide")+'" class="msi-close mrgL10 cur"></span></div><div id="drelogstablecontainer" class="zcdrelogscntr" minview="true"></div></div></div>',CommandsPreview:'<div class="mrgT25"><div class="dIB zvta bold font15 zcinhds">{NAME}</div></div><span id="integpreviewclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><div class="zclin24 zcicprv mrgT25"><div id="commandpreviewcont" class="zccmedc mrgT25"><div class="zcincmli zcprimgc"><div class="zchlistimg mrgR10 floatl">{PHOTO}</div><div class="dIB mrgL10 zcprcmd"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips mrgR10">{NAME}</div><span class="clrboth zchactime">{HINT}</span></div></div><div class="zchnsrcrht">{DESC}</div></div></div>{OPTIONS}<div class="bold mrgT25">'+Resource.getRealValue("integration.access")+'</div><div class="zcincmli">{SCOPEHINT}</div>{CODEHTML}</div></div>{EDITBUTTONS}',FunctionsInitialPage:'<div id="functionslistcontainer" class="zcfxcnt"><div id="functionssearchcontainer" class="zccmdinp zcvsbhid"><span class="msi-sp0"></span><input class="zcmdinp" id="functionssearch" functionsinput type="text" placeholder="'+Resource.getRealValue("functions.search")+'"></div><div id="functionlistheader" class="mrgT15"><div class="zcincmt {{class_name}} font15 dIB">'+Resource.getRealValue("functions.listheaderinfo")+'</div><div functionbuttons purpose="getaddui" class="textcent zcinab dbtn adbtn floatr mrgT10 {{hide_create_class}}">'+Resource.getRealValue("functions.create")+'</div></div><div class="zccnthibx posl"><div zc_sticky_title class="zcinhds font15 bold cmdfxdhdr dN" style="display:none" >'+Resource.getRealValue("functions.all")+'</div><div id="functionslist" integrationlistview="Functions" zc_sticky_title_list class="zcincmcnt zcfxlst"></div></div></div><div id="Integrationspreviewcontainer" style="left: 100%" class="zcprvcmt"><div id = "Integrationspreview" style="left: 100%" class="zcfxprv zcprvcmt font15 dN"></div></div>',FunctionsCreateUI:'<div class="mrgT75"><span integlhsmenu entity="Functions" class="msi-zcheadicn mrgR10"></span><div id="functioncreateheadertip" class="zcinhds font16 bold posl dIB zvta">'+Resource.getRealValue("functions.create")+'</div></div><div class="posl zcrtfxcnt"><div id="functioncreateui" class="zcadcmcnt clrboth"><div class="zcincmli"><div class="zcincmt dIB">'+Resource.getRealValue("functions.create.info")+'</div></div><div class="zcincmli"><div id="functionnamepoint" class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.name")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("functions.create.name.info")+'</div><input id="functionname" listen="keyup" maxlength="30" functioninputs type="text" class="zcadcmtin" placeholder="'+Resource.getRealValue("functions.create.ph")+'"/><div class="clra font14">'+Resource.getRealValue("function.create.name.note")+'</div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.desc")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("functions.desc.info")+'</div><textarea id="functiondesc" functioninputs listen="keyup" maxlength="300" type="text" placeholder="'+Resource.getRealValue("function.desc.ph")+'" class="zcadcmtin padd10"></textarea></div><div class="zcincmli {custom_class}"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("functions.type")+'</div><div class="zcincmt dIB">'+Resource.getRealValue("functions.type.brief")+'</div><div id="function-type-radio" class="zcradiobtns dIB mrgT15">{BUTTON_TYPE}</div></div></div></div><div functionbuttons id="functioncreateui_action" purpose="create" class="dbtn adbtn floatr mrgT25 mrgR10 zcdedbtn">'+Resource.getRealValue("integration.save.editcode")+"</div>",FunctionPreview:'<span id="integpreviewclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><div class="mrgT25"><div class="dIB zvta bold font15 zcinhds">{{NAME}}</div></div><div class="zclin24 zcicprv mrgT25"><div id="functionpreviewcont" class="zccmedc mrgT25"><div class="zcincmli zcprimgc"><div class="zchlistimg mrgR10 floatl"><div class="{{CLASS_NAME}}"></div></div><div class="dIB mrgL10 zcprcmd"><div class="zchnsrcrht">{{DESC}}</div></div></div><div id="function_details" class="posrel">{{DETAILS_HTML}}</div></div></div>{{EDITBUTTONS}}',SchedulersInitialPage:'<div id="schedulerslistcontainer" class="zcfxcnt"><div id="schedulerssearchcontainer" class="zccmdinp "><span class="msi-sp0"></span><input class="zcmdinp" id="schedulerssearch" schedulersinput type="text" placeholder="'+Resource.getRealValue("schedulers.search")+'"></div><div id="schedulerlistheader" class="mrgT15"><div class="zcincmt {{class_name}} font15 dIB">'+Resource.getRealValue("schedulers.listheaderinfo")+'</div><div schedulerbuttons purpose="getaddui" class="textcent zcinab dbtn adbtn floatr mrgT10 {{hide_create_class}}">'+Resource.getRealValue("schedulers.create")+'</div></div><div class="zccnthibx posl"><div zc_sticky_title class="zcinhds font15 bold cmdfxdhdr dN" style="display:none" >'+Resource.getRealValue("schedulers.all")+'</div><div id="schedulerslist" integrationlistview="Schedulers" zc_sticky_title_list class="zcincmcnt zcfxlst"></div></div></div><div id="Integrationspreviewcontainer" style="left: 100%" class="zcprvcmt"><div id = "Integrationspreview" style="left: 100%" class="zcfxprv zcprvcmt font15 dN"></div></div>',SchedulersCreateUI:'<div class="mrgT75"><span integlhsmenu entity="Schedulers" class="msi-zcheadicn mrgR10"></span><div id="schedulercreateheadertip" class="zcinhds font16 bold posl dIB zvta">'+Resource.getRealValue("schedulers.create")+'</div></div><div class="posl zcrtfxcnt"><div id="schedulercreateui" class="zcadcmcnt clrboth"><div class="zcincmli"><div class="zcincmt dIB">'+Resource.getRealValue("schedulers.create.info")+'</div></div><div class="zcincmli"><div id="schedulernamepoint" class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.name")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("schedulers.create.name.info")+'</div><input id="schedulername" listen="keyup" maxlength="30" schedulerinputs type="text" class="zcadcmtin" placeholder="'+Resource.getRealValue("schedulers.create.ph")+'"/><div class="clra font14">'+Resource.getRealValue("scheduler.name.tip")+'</div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.desc")+'</div><div class="zcincmt  dIB mrgT5">'+Resource.getRealValue("schedulers.desc.info")+'</div><textarea id="schedulerdesc" listen="keyup" maxlength="300" type="text" placeholder="'+Resource.getRealValue("scheduler.desc.ph")+'" class="zcadcmtin padd10"></textarea></div><div id="schedulercodevisibility" style="display:none" class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("commands.code.visibility")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("scheduler.codevisiblity.info")+'</div><div class="dIB mrgT15">{FUNCTIONVISIBILITY}<div class="floatl mrgL10">'+Resource.getRealValue("commands.visibility.hint")+'</div></div></div><div><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("scheduler.period")+'</div><div class="zcincmt dIB mrgT5 mrgB10">'+Resource.getRealValue("scheduler.period.info")+'</div>{Radio_Buttons}<div id="RPInfoDesc" class="clra font14 mrgT25">'+Resource.getRealValue("scheduler.period.rpinfoDAILY")+'</div><div id="RPWeeklyConfig" class="schparent mrgT25" style="display:none"><p>'+Resource.getRealValue("scheduler.period.repeatat")+'</p><div id="RPCalInfoWEEKLY" class="zcincmt dIB mrgB20">'+Resource.getRealValue("scheduler.period.weeks.selweeks")+'</div>{{WEEKRESOURCES}}</div><div id="RPMonthlyConfig" class="schparent mrgT25" style="display:none"><p>'+Resource.getRealValue("scheduler.period.repeatat")+'</p> {Month_Radio_Buttons}<div id="RPMonthlyDaysCalendar"><div id="RPCalInfoMONTHLY" class="zcincmt dIB mrgT20">'+Resource.getRealValue("scheduler.period.month.seldays")+'</div><div class="schparent schmonthly mrgT25">{{MONTHRESOURCES}}</div></div><div id="RPMonthlyWeeksCalendar" class="mrgT10 zcschdltm zcschdlpmon" style="display:none"><div id="RPMonthlyCalWeeksInfo" class="zcincmt dIB mrgT10">'+Resource.getRealValue("scheduler.period.monthweeks.selweeks")+'</div><div id="RPMonthlyCalWeeks" class="schparent mrgT25">{{RPWEEKSMONTHHTML}}</div><div id="RPMonthlyCalDaysInfo" class="zcincmt dIB mrgT25">'+Resource.getRealValue("scheduler.period.monthweeks.seldays")+'</div><div id="RPMonthlyCalDays" class="schparent mrgT25">{{RPWEEKMONTHDAYSHTML}}</div></div></div><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("scheduler.period.startat")+'</div><div class="posl floatl mrgL10 zcschdltm"><span><input id="schedulehours" schedulersselectinput hours class="zcevtms" maxlength="2" timeval="true" type="input"/><span class="msi-arwdwn cur" schedulersselectinput></span><ul id="RPhourdropdown" style="display: none;" datedropdown class="zcevhur dropdwncnt zcddbtr">{{HOURSDROPDOWN}}</ul></span><span><input id="schedulemin"  class="zcevtms" minutes schedulersselectinput maxlength="2" timeval="true" type="input"/><span class="msi-arwdwn cur" schedulersselectinput></span><ul id="RPminutesdropdown" style="display: none;" datedropdown class="zcevhur dropdwncnt zcddbtr">{{MINUTESDROPDOWN}}</ul></span> <span><input id="RPperiodampm" class="zcevtms cur" period schedulersselectinput timeval="true" type="input" readonly tabindex="-1"/><ul id="RPperioddropdown" style="display: none;" datedropdown class="zcevhpd dropdwncnt zcddbtr"><li purpose="selectTime" timeddlist schedulerbuttons val="'+Resource.getRealValue("scheduler.period.AM")+'">'+Resource.getRealValue("scheduler.period.AM")+'</li><li purpose="selectTime" timeddlist schedulerbuttons val="'+Resource.getRealValue("scheduler.period.PM")+'">'+Resource.getRealValue("scheduler.period.PM")+'</li></ul><span class="msi-arwdwn cur" schedulersselectinput></span></span><div class="clra font14 mrgT15">'+Resource.getRealValue("scheduler.period.startatinfo")+'</div></div></div></div></div><div schedulerbuttons id="schedulercreateui_action" purpose="create" class="dbtn adbtn floatr mrgT25 mrgR10 zcdedbtn">'+Resource.getRealValue("integration.save.editcode")+"</div>",SchedulerPreview:'<span title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><div class="mrgT25"><div class="dIB zvta bold font15 zcinhds">{{NAME}}</div></div><div class="zclin24 zcicprv mrgT25"><div id="schedulerpreviewcont" class="zccmedc mrgT25"><div class="zcincmli zcprimgc"><div class="zchlistimg mrgR10 floatl"><div class="msi-schedlr"></div></div><div class="dIB mrgL10 zcprcmd"><div class="zchnsrcrht dIB">{{DESC}}</div></div></div><div class="bold mrgT25">'+Resource.getRealValue("scheduler.period")+'</div><div>{{SCHEDULERPROPS}}</div>{{MONTHRESOURCES}}<div class="bold mrgT25">'+Resource.getRealValue("scheduler.lastexecuted")+'</div><div id="schprvlstrun">{{LASTRUN}}</div><div class="bold mrgT25">'+Resource.getRealValue("scheduler.nextexecution")+'</div><div id="schprvnxtrun">{{NEXTRUN}}</div><div id="schedulerpreviewcode" style="display:none" class="zcprvwcont mrgT25 posrel"></div></div></div>{{EDITBUTTONS}}',PlatformDatabasesInitialPage:'<div id="platformdatabaseslistcontainer" class="zcfxcnt"><div id="platformdatabasessearchcontainer" class="zccmdinp "><span class="msi-sp0"></span><input class="zcmdinp" id="platformdatabasessearch" platformdatabasesinput type="text" placeholder="'+Resource.getRealValue("platformdatabases.search")+'"></div><div id="platformdatabaselistheader" class="mrgT15"><div class="zcincmt {{class_name}} font15 dIB">'+Resource.getRealValue("platformdatabases.listheaderinfo")+'</div><div platformdatabasebuttons purpose="getaddui" class="textcent zcinab dbtn adbtn floatr mrgT10 {{hide_create_class}}">'+Resource.getRealValue("platformdatabases.create")+'</div></div><div class="zccnthibx posl"><div zc_sticky_title class="zcinhds font15 bold cmdfxdhdr dN" style="display:none" >'+Resource.getRealValue("platformdatabases.all")+'</div><div id="platformdatabaseslist" integrationlistview="PlatformStorages" zc_sticky_title_list class="zcincmcnt zcfxlst"></div></div></div><div id="Integrationspreviewcontainer" style="left: 100%" class="zcprvcmt"><div id = "Integrationspreview" style="left: 100%" class="zcfxprv zcprvcmt font15 dN"></div></div>',PlatformDatabasesCreateUI:'<div class="mrgT75"><span integlhsmenu entity="PlatformStorages" class="msi-zcheadicn mrgR10"></span><div id="platformdatabasecreateheadertip" class="zcinhds font16 bold posl dIB zvta">'+Resource.getRealValue("platformdatabases.create")+'</div></div><div class="posl zcrtfxcnt"><div id="platformdatabasecreateui" class="zcadcmcnt clrboth"><div class="zcincmli"><div class="zcincmt dIB">'+Resource.getRealValue("platformdatabases.create.info")+'</div></div><div class="zcincmli"><div id="platformdatabasenamepoint" class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("platformdatabases.name")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("platformdatabases.create.name.info")+'</div><input id="platformdatabasename" listen="keyup" maxlength="30" platformdatabaseinputs type="text" class="zcadcmtin" placeholder="'+Resource.getRealValue("platformdatabases.create.ph")+'"/><div class="clra font14">'+Resource.getRealValue("platform.storage.name.tip")+'</div></div><div class="zcincmli"><div id="platformdatabasedispnamepoint" class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("platformdatabases.display.name")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("platformdatabases.create.dispname.info")+'</div><input id="platformdatabasedispname" listen="keyup" maxlength="30" type="text" class="zcadcmtin" placeholder="'+Resource.getRealValue("platformdatabases.create.ph")+'"/></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("common.desc")+'</div><div class="zcincmt  dIB mrgT5">'+Resource.getRealValue("platformdatabases.desc.info")+'</div><textarea id="platformdatabasedesc" listen="keyup" maxlength="250" type="text" placeholder="'+Resource.getRealValue("platformdatabases.desc.ph")+'" class="zcadcmtin padd10"></textarea></div></div></div><div platformdatabasebuttons id="platformdatabasecreateui_action" purpose="create" class="dbtn adbtn floatr mrgT25 mrgR10 zcdedbtn">'+Resource.getRealValue("platformdatabases.save.editfields")+"</div>",PlatformDatabasePreview:'<span title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><div class="mrgT25"><div class="dIB zvta bold font15 zcinhds">{{NAME}}</div></div><div class="zclin24 zcicprv mrgT25"><div id="platformdatabasepreviewcont" class="zccmedc mrgT25"><div class="zcincmli zcprimgc"><div class="zchlistimg mrgR10 floatl"><div class="msi-platfrmdb"></div></div><div class="dIB mrgL10 zcprcmd"><div class="zchnsrcrht dIB">{{DESC}}</div></div></div><div id="storagescriptarea" class="{{SCRPTCLS}}"><div class="mrgT15">'+Resource.getRealValue("storage.script.add")+'</div><div id="storageaddpreviewcode" style="display:none" class="zcprvwcont mrgT10 posrel"></div><div class="mrgT15">'+Resource.getRealValue("storage.script.list")+'</div><div id="storagelistpreviewcode" style="display:none" class="zcprvwcont mrgT10 posrel"></div><div class="mrgT15">'+Resource.getRealValue("storage.script.get")+'</div><div id="storagegetpreviewcode" style="display:none" class="zcprvwcont mrgT10 posrel"></div><div class="mrgT15">'+Resource.getRealValue("storage.script.update")+'</div><div id="storageupdatepreviewcode" style="display:none" class="zcprvwcont mrgT10 posrel"></div><div class="mrgT15">'+Resource.getRealValue("storage.script.delete")+'</div><div id="storagedeletepreviewcode" style="display:none" class="zcprvwcont mrgT10 posrel"></div></div></div></div>{{EDITBUTTONS}}',PlatformDatabaseFieldsUI:'<div id="StoragesFieldsCreateUI" class="storagefld" transitionelem="" style="display: block;"><div class="mrgT30"><span integlhsmenu="" entity="PlatformStorages" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font16 bold posl dIB zvta">{{NAME}}</div></div><div class="cliq-strge"><div class="drg-flds"><h3 class="fntbld font18">'+Resource.getRealValue("storages.fields.basic.fields")+'</h3><div class="strge-fld" id="StoragesFieldsUIDragItems"><div class="strge-items" draggable="true" storagesdoubletab="addfield" type="limited-text"><div>'+Resource.getRealValue("storages.fields.char.sc")+"</div><p>"+Resource.getRealValue("storages.fields.limited-text")+'</p><span id="strtxtlimitspn" class="stlmtfld"></span></div><div class="strge-items" draggable="true" storagesdoubletab="addfield" type="number"><div>'+Resource.getRealValue("storages.fields.number.sc")+"</div><p>"+Resource.getRealValue("storages.fields.number")+'</p><span id="strnumlimitspn" class="stlmtfld"></span></div><div class="strge-items" draggable="true" storagesdoubletab="addfield" type="boolean"><div class="strge-togle"></div><p>'+Resource.getRealValue("storages.fields.boolean")+'</p><span id="strboollimitspn" class="stlmtfld"></span></div></div><div class="dN"><img src="{{DRGURLTEXT}}"><img src="{{DRGURLNUM}}"><img src="{{DRGURLBOOL}}"></div></div><div id="storagesfieldseditlistview" class="drop-fld"><div id="strfieldropcontainer" class="zcfiledrgmn"><span>'+Resource.getRealValue("storages.fields.drop")+'</span></div><div class="emty-chart" id="emtydrgfld"><div class="emty-dragfld"><div class="str-img"><img src="{{DRGIMGURL}}"></div><div class="dumy-div"><div></div></div><p class="font20">'+Resource.getRealValue("storages.fields.drop.here")+'</p></div></div></div><div platformdatabasebuttons id="storagesecreateui_fields" class="dbtn adbtn">'+Resource.getRealValue("storages.fields.savefields")+"</div></div></div>",BotsInitialPage:'<div id="botsearchcontainer" class="zccmdinp zcvsbhid"><span class="msi-sp0"></span><input id="botsearch" botsearch class="zcmdinp" type="text" placeholder="'+Resource.getRealValue("bots.search")+'"></div><div class="mrgT15"><div class="zcincmt {{class_name}} font15 dIB"><div>'+Resource.getRealValue("bots.brief.info")+'</div></div><div botbuttons purpose="createUI" class="zcbotbtn textcent dbtn adbtn floatr mrgT10 {{hide_create_class}}">'+Resource.getRealValue("bots.create")+'</div></div><div class="zccnthibx zcbtlisthldr posl"><div zc_sticky_title class="zcinhds font16 bold cmdfxdhdr dN"></div><div id="botslist" integrationlistview="Bots" zc_sticky_title_list class="zcincmcnt posl"></div></div><div id="Integrationspreviewcontainer" style="left: 100%" class="zcprvcmt"><div id="Integrationspreview" style="left: 100%" class="zcprvcmt font15 dN"></div></div>',EditBots:'<div class="mrgT75"><span integlhsmenu entity="Bots" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font16 bold posl dIB zvta">{HEADER}</div></div><div botid="{BOTID}" class="zcbotcrt zcboxhdsdow posl"><div id="editbotui" class="posl zcincmt font15 zcht100 mrgT25"><div class="zcincmli"><div id="botname-header" class="font16 bold">'+Resource.getRealValue("common.name")+'</div><div class="mrgT5">'+Resource.getRealValue("bots.name.info")+'</div><input id="botname" class="zcadcmtin" type="text" value="{NAME}" maxlength="20" botinputs placeholder="'+Resource.getRealValue("bots.name.ph")+'"/><div class="clra font13">'+Resource.getRealValue("bots.name.tip")+'</div></div><div class="zcincmli"><div id="botdesc-header" class="bold font16 mrgT25">'+Resource.getRealValue("common.desc")+'</div><div class="mrgT5">'+Resource.getRealValue("bots.desc.info")+'</div><textarea id="botdesc" maxlength="300" type="text" botinputs placeholder="" class="zcadcmtin padd10">{DESC}</textarea></div><div id="botscope" class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.access")+'</div><div class="zcincmt  dIB">'+Resource.getRealValue("bots.access.info")+'</div><div id="botscoperadio" class="zcradiobtns dIB mrgT15">{BOTSCOPERADIOBUTTONS}</div><div id="botscope-info" class="mrgT10 clr6 zchlinfo mrgT5">'+Resource.getRealValue("integration.scope.info3")+'</div><div id="botscopes-group" style="display:none;"></div></div><div class="zcincmli"><div class="bold font16 mrgT25">'+Resource.getRealValue("integration.image")+'</div><div class="mrgT5">'+Resource.getRealValue("bots.image.info")+'</div><div class="zcgpimgcnt posrel"><div width="50px" height="50px" type="imgpreview" class="zchimg">{PHOTO}</div><div id="botdefimg" class="zcrtgrpimg"><img src="{DEFAULTIMG}"></div><input id="botphoto" type="file" class="sendfile" accept="image/*"/><div class="zchangeimg zcbotimg font10 dN posa">'+Resource.getRealValue("common.change")+'</div></div><div class="clra font13">'+Resource.getRealValue("bots.image.size")+'</div></div><div class="zcincmli mrgT25"><div class="bold font16 mrgT25">'+Resource.getRealValue("common.status")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("bots.status.info")+'</div><div id="botstatuscont" class="zcincmt font15 zcbotin zcbtmnuin"><input type="text" maxlength="50" botstatus placeholder="'+Resource.getRealValue("bot.status.ex1")+'"><input type="text" maxlength="50" botstatus placeholder="'+Resource.getRealValue("bot.status.ex2")+'"><input type="text" maxlength="50" botstatus placeholder="'+Resource.getRealValue("bot.status.ex3")+'"><input type="text" maxlength="50" botstatus placeholder="'+Resource.getRealValue("bot.status.ex4")+'"><input type="text" maxlength="50" botstatus placeholder="'+Resource.getRealValue("bot.status.ex5")+'"></div></div></div></div><div botbuttons botid="{BOTID}" purpose="createOrEdit" class="textcent dbtn adbtn floatr mrgT25">'+Resource.getRealValue("bots.save")+"</div>",BotPreview:'<div class="mrgT25"><div class="dIB zvta bold font15 zcinhds">{NAME}</div></div><span id="integpreviewclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><div class="zclin24 zcicprv mrgT25"><div id="botpreviewcont" class="zccmedc mrgT25"><div class="zcincmli zcprimgc"><div class="zchlistimg mrgR10 floatl">{PHOTO}</div><div class="dIB mrgL10 zcprcmd"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips mrgR10">{NAME}</div></div></div><div class="zchnsrcrht">{DESC}</div></div></div>{APIENDPOINT}<div class="zcincmli"><div class="bold mrgT25">'+Resource.getRealValue("integration.access")+"</div><div>{SCOPEHINT}</div></div>{MENU}{MSGHANDLERS}{STATUS}</div></div>{EDITBUTTONS}",BotHandlers:'<div class="mrgT75"><span integlhsmenu entity="Bots" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font16 bold posl dIB zvta">'+Resource.getRealValue("bots.handlers.edit")+' - {NAME}</div></div><div class="zcbotcntr zcboxhdsdow posl"><div id="allbothandlers" botid="{BOTID}" class="posl zcincmt zcht100 mrgT25"><div class="zcincmli"><div class="zcincmt dIB">'+Resource.getRealValue("bots.handlers.info")+'</div></div><div id="addbothandlers" class="zcincmt font15"><div class="zcincmli mrgT25"><div class="bold font16">'+Resource.getRealValue("integration.handler.welcome")+"</div><div>"+Resource.getRealValue("bots.welcome.handler.info")+'{TYPE5}</div></div><div class="zcincmli mrgT25"><div class="font16 bold">'+Resource.getRealValue("integration.handler.text")+"</div><div>"+Resource.getRealValue("bots.msg.handler.info")+'{TYPE0}</div></div><div class="zcincmli mrgT25"><div class="font16 bold">'+Resource.getRealValue("integration.handler.mention")+"</div><div>"+Resource.getRealValue("bots.mention.handler.info")+'{TYPE8}</div></div><div class="zcincmli mrgT25"><div class="font16 bold">'+Resource.getRealValue("integration.handler.context")+"</div><div>"+Resource.getRealValue("bots.context.handler.info")+'{TYPE10}</div></div><div class="zcincmli mrgT25"><div class="font16 bold">'+Resource.getRealValue("integration.handler.incomingwebhook")+"</div><div>"+Resource.getRealValue("bots.webhook.handler.info")+'{TYPE9}</div></div></div><div id="addbotmenucont" class="zcincmli zcincmt font15 zcbotcnt mrgT25"><div class="bold font16">'+Resource.getRealValue("bots.menu.ques")+'</div><div class="mrgT10">'+Resource.getRealValue("bots.menu.info")+'</div><div id="addbotmenu" class="zcbotactinp">{ACTIONS}</div></div></div></div>',IntegrationsEmptyState:'<div><div {{parent_attribute}} class="zcappsempty"><div>{{content}}</div>{{create_btn}}</div></div>',AppsInitialPage:'<div id="appsearchcontainer" class="zccmdinp"><span class="msi-sp0"></span><input id="appsearch" class="zcmdinp" appsinput type="text" placeholder="'+Resource.getRealValue("app.search")+'"/></div><div class="mrgT15"><div class="zcincmt {{class_name}} font15 dIB">'+Resource.getRealValue("integration.apps.info")+"</div>"+($zcg._APP_CREATE_ENABLED?'<div appbuttons purpose="createUI" class="textcent zcinab dbtn adbtn floatr mrgT10 ellips {{hide_create_class}}">'+Resource.getRealValue("integration.add.applications")+"</div>":"")+'</div><div class="zccnthibx posl zcappslstcntr"><div zc_sticky_title class="zcinhds font16 bold cmdfxdhdr dN"></div><div id="myappslist" integrationlistview="Applications" zc_sticky_title_list class="zcincmcnt posl zcapps"></div></div><div id="Integrationspreviewcontainer" style="left: 100%" class="zcprvcmt"><div id="Integrationspreview" style="left: 100%" class="zcprvcmt font15 dN"></div></div>',EditApps:'<div class="mrgT75"><span integlhsmenu entity="Applications" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font16 bold posl dIB zvta">{HEADER}</div></div><div appid="{APPID}" class="zcbotcrt zcboxhdsdow posl"><div id="editappui" class="posl zcincmt font15 zcht100 mrgT25"><div class="zcincmli"><div id="appname-header" class="font16 bold">'+Resource.getRealValue("common.name")+'</div><div class="mrgT5">'+Resource.getRealValue("apps.name.info")+'</div><input id="appname" appinput class="zcadcmtin" type="text" value="{NAME}" maxlength="20" placeholder="'+Resource.getRealValue("app.name.ph")+'"/><div class="clra font13">'+Resource.getRealValue("apps.name.tip")+'</div></div><div class="zcincmli"><div id="appdesc-header" class="bold font16 mrgT25">'+Resource.getRealValue("common.desc")+'</div><div class="mrgT5">'+Resource.getRealValue("apps.desc.info")+'</div><textarea id="appdesc" appinput maxlength="300" type="text" class="zcadcmtin padd10">{DESC}</textarea></div><div class="zcincmli"><div class="bold font16 mrgT25">'+Resource.getRealValue("integration.image")+'</div><div class="mrgT5">'+Resource.getRealValue("apps.image.info")+'</div><div class="zcgpimgcnt posrel"><div width="50px" height="50px" type="imgpreview" class="zchimg">{PHOTO}</div><div id="appdefimg" class="zcrtgrpimg"><img src="{APPIMG}"></div><input id="appphoto" type="file" class="sendfile" accept="image/*"/><div class="zchangeimg zcbotimg font10 dN posa">'+Resource.getRealValue("common.change")+'</div></div><div class="clra font13">'+Resource.getRealValue("bots.image.size")+'</div></div>{BOTS}{COMMANDS}{MESSAGEACTIONS}{FUNCTIONS}{SCHEDULERS}{PLATFORMDATABASES}<div class="zcincmli mrgT25 hinherit"><div class="bold font16 mrgT25">'+Resource.getRealValue("menuname.channelsandgroups")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("apps.channels.select")+'</div><div id="appchannels" class="zcincmt font15 zcbotin mrgT15">{CHANNELS}</div></div></div></div><div appbuttons appid="{APPID}" purpose="createOrEdit" class="textcent dbtn adbtn floatr mrgT25">{BUTTONTEXT}</div>',SandboxAppsPreviewLoading:'<div class="zcappsprev zch100"><span id="integpreviewclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><header class="zappsline mrgT25"><div class="floatl mrgR15"><img src="{{image_url}}" class="appsico mrgL5"/></div><div class="floatl"><p class="font18"><strong>{{name}}</strong></p><p class="mrgT10 font16">{{description}}</p></div></header><div class="appsprevcnt"><span class="zcldng"></span></div></div>',InstallAppsPreviewLoading:'<div class="zcappsprev zch100"><span id="integpreviewclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><header class="zappsline mrgT25"><div class="floatl mrgR15"><img src="{{image_url}}" class="appsico"/></div><div class="floatl"><p><strong>{{name}}</strong> ( {{version}} {{installed_version}} )<a title="{{view_store}}" target="_blank" href="/installapp.do?id={{store_appid}}"><em class="msi-ex-popout cur mrgL10"></em></a></p><p class="mrgT10">{{installed_by}} <span elemtype="user" hover="true" uid="{{installer_zuid}}" class="zctxthgh cur">{{installer_name}}</span><span class="appscope">{{installed_to}} {{scope}}</span></p>{{version_update_button_html}}</div></header><div class="appsprevcnt"><span class="zcldng"></span></div></div>',InstalledAppsPreview:'<div class="zcappsprev zinstaldapps zch100"><span id="integpreviewclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><header class="zappsline mrgT25"><div class="floatl mrgR15"><img src="{{image_url}}" class="appsico"/></div><div class="floatl"><p><strong>{{name}}</strong> ( {{version}} {{installed_version}} )<a title="{{view_store}}" target="_blank" href="/installapp.do?id={{store_appid}}"><em class="msi-ex-popout cur mrgL10"></em></a></p><p class="mrgT10">{{installed_by}} <span elemtype="user" hover="true" uid="{{installer_zuid}}" class="zctxthgh cur">{{installer_name}}</span><span class="appscope">{{installed_to}} {{scope}}</span></p>{{version_update_button_html}}</div></header><div class="appsprevcnt"><div class="zappsline"><div class="font16 posl"><strong>{{about}}</strong><span appbuttons purpose="hideComponentsPreview" class="clr8 apssidelnk">{{show_less}}</span></div><p class="font16 mrgT10 zclin24">{{description}}</p><div id="installedcomponents" class="font15">{{commands}}{{messageactions}}{{bots}}{{schedulers}}{{platformdatabases}}{{channels}}</div></div><div class="zappsline appstble"><span>{{developer}}</span><span>{{developer_name}}{{dev_details}}</span></div>{{payments_details}}{{appactions_html}}<span drebuttons type="application" purpose="showGrantedConsents" class="zcclr zc-consents">'+Resource.getRealValue("platformconsents.viewgranted")+"</span></div></div>",AppHandlers:'<div class="zappsline mrgB25 zclin22"><div class="bold font16 paddB10">'+Resource.getRealValue("integration.handler.installvalidator")+'</div><div class="zcaphaninfo">'+Resource.getRealValue("app.handler.validator.info")+'{{type_3002}}</div></div><div class="zappsline mrgB25 zclin22"><div class="bold font16 paddB10">'+Resource.getRealValue("integration.handler.install")+'</div><div class="zcaphaninfo">'+Resource.getRealValue("app.handler.installation.info")+'{{type_3000}}</div></div><div class="zappsline mrgB25 zclin22"><div class="bold font16 paddB10">'+Resource.getRealValue("integration.handler.incomingwebhook")+'</div><div class="zcaphaninfo">'+Resource.getRealValue("app.handler.incoming.info")+'{{type_3001}}</div></div><div class="zappsline mrgB25 zclin22"><div class="bold font16 paddB10">'+Resource.getRealValue("integration.handler.uninstall")+'</div><div class="zcaphaninfo">'+Resource.getRealValue("app.handler.uninstall.info")+"{{type_3003}}</div></div>",SandboxAppsPreview:'<div class="zcappsprev"><span id="integpreviewclose" title="{{close}}" integbuttons purpose="hidePreview" class="msi-close cclose"></span><header class="zappsline mrgT25"><div class="floatl mrgR15"><img src="{{image_url}}" class="appsico mrgL5"/></div><div class="floatl"><p><strong>{{name}}</strong></p><p class="mrgT10">{{description}}</p></div></header><div class="appsubheaders mrgT30 posl"><span appsubheaders purpose="getOverview" class="curpage">'+Resource.getRealValue("app.overview")+'</span><span appsubheaders purpose="getConnector">'+Resource.getRealValue("app.connectors")+'</span><span appsubheaders purpose="getHandlers">'+Resource.getRealValue("bots.handlers.ques")+'</span><span appsubheaders purpose="getPublisherDetails">'+Resource.getRealValue("app.publisherdetails")+'</span></div><div id="appcontainer" class="mrgT20 mrgB20 mcontent">{{overview}}</div></div>',AppOverView:'<div class="appsprevcnt"><div class="zappsline"><div class="font16 posl paddB10"><strong>{{about}}</strong></div><div id="installedcomponents" class="font15 installedcomponents">{{commands}}{{messageactions}}{{bots}}{{functions}}{{schedulers}}{{platformdatabases}}{{channels}}</div></div></div>{{installation_link}}<div class="appstble posl mrgT20"><span class="bold">{{app_actions}}</span><a appbuttons purpose="delete" class="msi-delete mrgR10 cur">{{delete}}</a></div><span drebuttons type="application" purpose="showGrantedConsents" class="mrgT25 zcclr zc-consents">'+Resource.getRealValue("platformconsents.viewgranted")+"</span>",AppConnector:'<div class="zappsline zclin22"><div class="bold font16">{{app_key}}</div><div class="mrgT10 clr6">{{app_key_info}}</div><div id="appkeys" class="zcappdevprvwdtls">{{app_keys}}</div></div><div class="mrgT15"><div class="bold">{{webhook_endpoints}}</div><div class="mrgT10 clr6">{{webhook_endpoints_info}}</div><div class="mrgT25 zcendpnt zcapcon"><span class="bold">{{sandbox}}</span><span documentclick="copyclipboard" class="zcprvwcpylnk">{{copy}}</span><div clipboardarea class="clr6 mrgT10 wrdbrkall">{{sandboxendpoint}}</div></div><div class="mrgT25 zcendpnt zcapcon"><span class="bold">{{marketplace}}</span><span documentclick="copyclipboard" class="zcprvwcpylnk">{{copy}}</span><div clipboardarea class="clr6 mrgT10 wrdbrkall">{{storeendpoint}}</div></div></div>',AppPublisherDetails:'<div class="mrgB25"><div class="dflxcent mrgT10 mrgL10"><div>'+Resource.getRealValue("app.publishedby")+'</div><input type="text" class="mtext" data-val="dev_name" placeholder="'+Resource.getRealValue("app.samplename")+'"></div><div class="dflxcent mrgT15 mrgL10"><div>'+Resource.getRealValue("app.terms")+'</div><input type="text" class="mtext" data-val="terms" placeholder="https://zylker.com/terms"></div><div class="dflxcent mrgT15 mrgL10"><div>'+Resource.getRealValue("app.privacypolicy")+'</div><input type="text" class="mtext" data-val="privacy_policy" placeholder="https://terellocard.zylker.com/privacy"></div></div><div><div class="dflxcent mrgT25 mrgL10"><div>'+Resource.getRealValue("app.contactas")+'</div><input type="text" class="mtext" data-val="dev_email" placeholder="'+Resource.getRealValue("app.sampleemail")+'"></div><div class="dflxcent mrgT15 mrgL10"><div>'+Resource.getRealValue("app.supportcenter")+'</div><input type="text" class="mtext" data-val="support_center" placeholder="https://zylker.com/terms"></div></div><input id="savechngsbtn" purpose="savePublisherDetails" appbuttons type="button" class="buttn_pos" value="'+Resource.getRealValue("common.savechanges")+'" title="'+Resource.getRealValue("common.savechanges")+'">',MessageActionInitialPage:'<div id="messageactionsearchcontainer" class="zccmdinp zcvsbhid"><span class="msi-sp0"></span><input id="messageactionsearch" messageactionsinput class="zcmdinp" type="text" placeholder="'+Resource.getRealValue("integration.messageaction.search")+'"/></div><div class="mrgT15"><div class="zcincmt {{class_name}} font15 dIB">'+Resource.getRealValue("integration.actions.info")+'</div><div messageactionbuttons purpose="add" class="textcent dbtn zcinab adbtn floatr mrgT10 ellips {{hide_create_class}}">'+Resource.getRealValue("integration.actions.create")+'</div></div><div class="zccnthibx posl"><div zc_sticky_title class="zcinhds font15 bold cmdfxdhdr"></div><div id="messageactionslist" zc_sticky_title_list integrationlistview="MessageActions" class="zcincmcnt posl"></div></div><div id="Integrationspreviewcontainer" style="left: 100%" class="zcprvcmt"><div id = "Integrationspreview" style="left: 100%" class="zcprvcmt  font15 dN"></div></div>',MessageActionCreateUI:'<div class="mrgT75"><span integlhsmenu entity="MessageActions" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font16 bold posl dIB zvta">'+Resource.getRealValue("integration.actions.create")+'</div></div><div class="zccnthibxad posl"><div id="addmessageactionui" class="zcadcmcnt clrboth"><div class="zcincmt dIB">'+Resource.getRealValue("integration.actions.info")+'</div><div class="zcincmli"><div id="messageactionname-info" class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.actionname")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.actionname.desc")+'</div><input type="text" id="messageactionname" maxlength="20" messageactioninputs class="zcadcmtin" placeholder="'+Resource.getRealValue("integration.actionname.text")+'"/><div class="clra font14">'+Resource.getRealValue("messageaction.name.tip")+'</div></div><div class="zcincmli"><div id="messageactionhint-info" class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.commandhint")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.actionhint.desc")+'</div><input type="text" id="messageactionhint" placeholder="'+Resource.getRealValue("integration.actionhint.example")+'" class="zcadcmtin"/></div><div id="addcommandscope" class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.access")+'</div><div class="zcincmt  dIB">'+Resource.getRealValue("integration.actionsaccess.info")+'</div><div id="messageactionscoperadio" class="zcradiobtns dIB mrgT15">{MESSAGEACTIONSCOPERADIOBUTTONS}</div><div id="messageactionscope-info" class="mrgT10 clr6 zchlinfo mrgT5">'+Resource.getRealValue("integration.scope.info3")+'</div><div id="messageactionscopes-group" style="display:none;"></div></div><div class="zcincmli" id="messageactionkinds"><div id="messageactionmsgprops-info" class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.actions.kind.title")+'</div>{MESSAGETYPESCHECKBOXES}</div></div></div><div messageactionbuttons="" purpose="create" class="dbtn adbtn floatr mrgT25 mrgR10 zcdedbtn">'+Resource.getRealValue("integration.save.editcode")+"</div>",MessageActionEditUI:'<div id="editmessageactionui" messageactionid="{ACTIONID}" class="zccmdinh mrgT75"><div class="mrgT75"><span integlhsmenu entity="MessageActions" class="msi-zcheadicn mrgR10"></span><div class="zcinhds font16 bold posl dIB zvta">'+Resource.getRealValue("integration.actions.edit")+'</div></div><div class="zccnthibxad posl"><div id="addmessageactionui" class="zcadcmcnt clrboth"><div class="zcincmt dIB">'+Resource.getRealValue("integration.actions.info")+'</div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.actionname")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.actionname.desc")+'</div><input type="text" maxlength="20" messageactioninputs id="messageactionname" class="zcadcmtin" placeholder="'+Resource.getRealValue("integration.actionname.text")+'" value="{NAME}"/><div class="clra font14">'+Resource.getRealValue("messageaction.name.tip")+'</div></div><div class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.commandhint")+'</div><div class="zcincmt dIB mrgT5">'+Resource.getRealValue("integration.actionhint.desc")+'</div><input type="text" id="messageactionhint" placeholder="'+Resource.getRealValue("integration.actionhint.example")+'" value="{HINT}" class="zcadcmtin"/></div><div id="addcommandscope" class="zcincmli"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.access")+'</div><div class="zcincmt  dIB">'+Resource.getRealValue("integration.actionsaccess.info")+'</div><div id="messageactionscoperadio" class="zcradiobtns dIB mrgT15">{MESSAGEACTIONSCOPERADIOBUTTONS}</div><div id="messageactionscope-info" class="mrgT10 clr6 zchlinfo mrgT5">{SCOPEHINT}</div><div id="messageactionscopes-group" style="display:none;"></div></div><div class="zcincmli" id="messageactionkinds"><div class="font16 bold posl mrgT25 mrgB5">'+Resource.getRealValue("integration.actions.kind.title")+'</div>{MESSAGETYPESCHECKBOXES}</div></div></div><div messageactionbuttons purpose="saveEdit" class="dbtn adbtn floatr mrgT25 mrgR10 zcdedbtn">'+Resource.getRealValue("common.save")+"</div>",MessageActionsPreview:'<div class="mrgT25"><div class="dIB zvta bold font15 zcinhds">{NAME}</div></div><span id="integpreviewclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="hidePreview" class="msi-close cclose"></span><div class="zclin24 zcicprv mrgT25"><div id="commandpreviewcont" class="zccmedc mrgT25"><div class="zcincmli zcprimgc"><div class="zchlistimg mrgR10 floatl">{PHOTO}</div><div class="dIB mrgL10 zcprcmd"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips mrgR10">{NAME}</div><span class="clrboth zchactime"></span></div></div><div class="zchnsrcrht">{HINT}</div></div></div><div class="bold mrgT25">'+Resource.getRealValue("integration.access")+'</div><div>{SCOPEHINT}</div>{CODEHTML}<div class="bold mrgT25">'+Resource.getRealValue("integration.messageactions.msgprops")+"</div><div>{MSGPROPSHTML}</div></div></div>{EDITBUTTONS}</div>",MobileAppDownloadHtml:'<div class="mcontent"><div class="zctraplnk dIB"></div> <div class="textcent"><div id="iosapp" operation="ios" class="zciapc dIB textcent posl cur"><div class="mrgT15"><span class="msi-ios"></span><span>'+Resource.getRealValue("common.ios")+'</span></div><img src="{STATICURL}/ios-ss.png"/></div><div id="androidapp" operation="android" class="zcaapc dIB textcent posl cur"><div class="mrgT15"><span class="msi-android"></span><span>'+Resource.getRealValue("common.android")+'</span></div><img src="{STATICURL}/android-ss.png"/></div><input class="dbtn adbtn textcent mrgT30" operation="gotit" type="button" value="'+Resource.getRealValue("tour.gotit")+'"></div></div>',AllAppDownloadHtml:'<div class="mcontent"><div class="zctraplnk dIB">'+Resource.getRealValue("common.mobile")+'</div> <div class="zcappsimgs textcent"><a target="_blank" href="'+$zcg._PLAYSTOREURL+'"><img class="mobileappsimg" src="{STATICURL}/appsimage/google.png"/></a><a target="_blank" href="'+$zcg._APPSTOREURL+'"><img class="mobileappsimg" src="{STATICURL}/appsimage/apple.png"/></a><div class="zctraplnk dIB">'+Resource.getRealValue("common.desktop")+'</div> <a target="_blank" href="'+$zcg._MACAPPURL+'"><img src="{STATICURL}/appsimage/mac-ap.svg"/></a><a target="_blank" href="'+$zcg._WINDOWSAPPURL+'"><img src="{STATICURL}/appsimage/win.svg"/></a><a target="_blank" href="'+$zcg._LINUXAPPURL+'"><img src="{STATICURL}/appsimage/ubu.svg"/></a></div></div>',NewSearchHTML:'<div class="zctop-cht"><div id="GSContainer" class="smsrchwin zcmultsrch zctop-cht"><div  class="spotlight"><div id="GSinputcontainer" class="zcgsincnt"><span class="msi-srchicon"></span><div id="GS-mockdiv" class="zcssauto" style="display:inline-block"></div><input id="GS-search-field"  class="ellips mrgL20 zcsstinfo" autocomplete="off" placeholder="'+Resource.getRealValue("smiley.search")+" ("+("mac"===$Util.getOS()?"cmd":"ctrl")+' + shift + f)"></input><div class="msi-close cur" id="GScloseinput" title="'+Resource.getRealValue("globalsearch.clearfield")+'"></div></div><div id="GS-results" class="hdrglobsrc" data_content=""></div></div></div><div id="createchatcontainer" quickaction purpose="showQuickActions" class="msi-add zctop-crtcht "></div></div>',SmartSearchHTML:'<div class="zctop-cht"><div id="topsmartsearchcontainer" class="spotlight"><span class="msi-srchicon"></span><div contenteditable="false" class="smsrcinput">'+Resource.getRealValue("globalsearch.old")+'</div></div><div id="createchatcontainer" class="msi-add zctop-crtcht cur" title="'+Resource.getRealValue("quickchat")+'"><div class="msi-chat"></div></div></div>',SmartSearchListHTML:'<div class="smsrch_bx"><div class="smsrch_hdr zcinhds zcmorechtxt posrel">{LISTHEADER}</div><div class="smsrch_cnt">{LIST}</div></div>',TopBarButtonHTML:'<div type="button" class="ztb-button-type tpbricon" id="ztb-{ID}" data-purpose="zc{ID}" title="{TITLE}"><span class="{CLASS} ztb-icons"></span></div>',TopBarDropDownMenuHTML:'<div id="{ID}" class="ztb-dropdown"><div class="ztb-content"><ul class="ztb-ul">{OPTIONS}</ul></div></div>',TopBarCusStatusHTML:'<div id="ztb-customstatus" class="ztb-cussttaus"><div class="stsback ds_in_blk cur" purpose="status-back"><span id="statusnav" title="'+Resource.getRealValue("common.back")+'" class="msi-zcheadicn mrgR10"></span><div class="zchdl posl fntbld">'+Resource.getRealValue("status.custom")+'</div></div><textarea id="stmsgeditor" class="ststxtara ellips" placeholder="'+Resource.getRealValue("status.custom.placeholder")+'" ></textarea><ul>{CUSTOM_STATUS}</ul><div class="mrgT15 mrgB15 clearfix"><input type="button" purpose="cancel" class="buttn_neg evbtn mrgL20 mrgR20" value="'+Resource.getRealValue("common.cancel")+'"><input type="button" purpose="save" class="dbtn adbtn floatr" value="'+Resource.getRealValue("common.save")+'"></div></div>',HomeNotificationHTML:'<div id="off_{CHID}" class="off_msgbx {CLASS_NAME}"  data-unread="{CHID}" chattype="{CHAT_TYPE}" profile="off_chat"><div class="hdrwrap"><div id="userimage{CHID}" class="usrimgsts floatl">{IMGHTML}</div><div class="hdr floatl"><div class="zcmtit"><div class="hdrsub"><div id="title{CHID}" chid="{CHID}" data-val={TITLE} title={TITLE} class="zctle floatl bold ellips" spellcheck="false">{TITLE}</div></div></div></div></div><div id="msgarea" class="off_msg currchatpanel" chid="{CHID}"  >{CONTENT}</div></div>',MentionDescHTML:'<div class="zcunrdmn"><div class="prf-unrd"></div><div class="usrimgsts floatl zc-1"><img elemtype="user" hover="true" uid="{SENDERUID}"class=" floatl rds4" title="{SENDERNAME}" src="{IMGSRC}"/></div><div class="zcunrd-rht"><div class="zcunrdlt-txt floatl ellips"><span class="floatl ellips bold zcunrdtit">{SENDERNAME}</span><span class="ds_in_blk mnstr">{I18nTEXT}</span></div><div class="atmnsbmsg">{MESSAGE}</div></div></div>',VideoChatFloatingHTML:'{{pulse_cnt}}<div id="videochatvisiblearea" class="zcvidarea">{{chat_holder}}<div id="videocontainer" class="zcvidocnt"><div id="audiopulsecont" class=" dN zcvcaudpuls"><div id="vcaudiopulse" class="zcvcaudpulsrz"><div></div><div></div><div></div></div></div><div id="vc-loader" class="zc-vc-loader"></div><div id="remotevideocontainer" purpose="switchVideo" videochatdragcontainer component="videocontainer" class="zc-vc-primary-vid-cnt"><div class="zc-vc-info-cnt zc-vc-rm-vid"><video id="remotevideo" autoplay="autoplay"></video></div><div class="zc-vc-usr"><span class="msi-swap" swap=true></span><img remoteuserimg/></div></div><div id="localvideocontainer" videochatbutton purpose="switchVideo" videochatdragcontainer component="videocontainer" class="zc-vc-secondary-vid-cnt"><div class="zc-vc-info-cnt zc-vc-lcl-vid"><video id="localvideo" class="zc-vc-vid-trns" localvideo autoplay="autoplay" muted></video></div><div class="zc-vc-usr zc-usr-name"><span class="msi-swap" swap=true></span><span class="ellips zc-vc-txt">'+Resource.getRealValue("common.you")+'</span><img localuserimg/></div></div><div id="sharedscreencontainer" videochatbutton purpose="switchVideo" videochatdragcontainer component="videocontainer" class="zc-vc-tertiary-vid-cnt"><div class="zc-vc-info-cnt"><video id="sharedscreen" autoplay="autoplay"></video></div><div class="zc-vc-usr"><span class="msi-swap" swap=true></span><span class="msi-scrnshr-start"></span><img remoteuserimg/></div></div><div id="msgcontainer" class="zcvcmsgcnt"><div class="ellips zcclrnm bold font15 posa"></div><div id="vccustommessage" class="zcvcmsgcust" dN></div><div class="zcvcmsgscrnclng dN">'+Resource.getRealValue("videochat.screenshare.calling")+'</div><div class="zcvcmsgscrncntd dN">'+Resource.getRealValue("videochat.screenshare.connected")+'</div><div class="zcvcmsgrcnt dN">'+Resource.getRealValue("videochat.trying.reconnect")+'</div><div class="zcvcmsgdvcwt dN">'+Resource.getRealValue("videochat.waiting.permission")+'</div><div class="zcvcmsgclng dN">'+Resource.getRealValue("videochat.message.calling")+'</div><div class="zcvcmsgcntng dN">'+Resource.getRealValue("common.connecting")+'</div><div class="zcvcmsgwitn dN">'+Resource.getRealValue("videochat.message.waiting")+'</div><div class="zcvcmsgcntd dN">'+Resource.getRealValue("videochat.message.connected")+'</div></div><div id="videochattimer" class="dN zcvctmr">00 : 00</div></div>{{more_options}}{{device_settings}}<div id="vcfullscreen" class="msi-max zcmxtp dN" videochatbutton purpose="toggleFullscreen" title="'+Resource.getRealValue("videochat.fullscreen")+'"></div><div id="videochatctrlbtnscontain" class="zcvidbtncnt"><div class="{{class_name}} zcvideoac"><div class="msi-vend mrgL10" videochatbutton purpose="endCall" title="'+Resource.getRealValue("videochat.endcall")+'" ></div>{{chat_option}}<div class="msi-vamute msi-mic mrgL10 dN" videochatbutton purpose="toggleMic"></div><div class="msi-video mrgL10 dN" videochatbutton purpose="toggleCam"></div>{{device_settings}}{{more_options}}</div></div></div>',VideoChatPulseCnt:'<div class="zcpulscnt" pulsediv><div class="pulseOne"></div><div class="pulseTwo"></div></div>',VideoChatIncomming:'{{pulse_cnt}}<div class="zcvcinvidarea"><div id="videocontainer" class="zcvcinvidocnt" ><img class="remoteusrimg" remoteuserimg/><div id="msgcontainer" class="zcvcinmsgcnt"><div callername class="ellips zcclrnm bold font15 posa"></div><div class="zcvcmsgcust" vccallmsg></div></div></div><div class="zcvidinbtncnt"><div class="zcincmclcnt zcvidineoac"><div class="msi-call" vcacceptcall action="acceptcall"></div><div id="replycall" class="msi-mail msi-chtcmt mrgL10" action="replycall"></div><div class="msi-vend mrgL10" vcreject action="rejectcall"></div></div></div></div><div id="vcreplycontainer" class="dN zcvidbktxt"><div class="zcclbkhd posl"><img class="remoteusrimg" remoteuserimg><div class="dIB vtm zccllbl ellips"><div callername class="ellips bold"></div><div class="clr6 font13 mrgT5" vccallmsg></div></div><div class="zcvcrplbtngrp dIB vtm"><div class="msi-call" vcacceptcall action="acceptcall"></div><div class="msi-vend dIB mrgL10" vcreject action="rejectcall"></div></div></div><div class="zcvsdmsg mrgT15 zcevhd">'+Resource.getRealValue("videochat.incomming.sendmsg")+'</div><div class="zcvidrmsg posl"><input id="vcreplycusmsg" class="mrgT10" vcreplytxtbx type="text" name="" placeholder="'+Resource.getRealValue("videochat.incomming.custmsg")+'"><span class="msi-send cur" action="sendreplymsg" ></span></div><div class="vcrplmvid dN"><div class="mrgT15 cur" action="sendpresetmsg">'+Resource.getRealValue("videochat.incommingreply.video.msg1")+'</div></div><div ><div class="mrgT15 cur" action="sendpresetmsg">'+Resource.getRealValue("videochat.incommingreply.msg1")+'</div><div class="mrgT15 cur" action="sendpresetmsg">'+Resource.getRealValue("videochat.incommingreply.msg2")+'</div><div class="mrgT15 mrgB5 cur" action="sendpresetmsg">'+Resource.getRealValue("videochat.incommingreply.msg3")+'</div></div><div id="customvcrejectmsg" ></div></div>',videoChatDevicePreference:'<div class="mcontent"><div class="mediaui_lhs txtalgncentr"><ul><li class="msi-mic zcmedsel" mdevice-switch="mic" >'+Resource.getRealValue("videochat.settings.audioinput")+'</li><li class="msi-ldspeaker" mdevice-switch="speaker">'+Resource.getRealValue("videochat.settings.soundoutput")+'</li></ul></div><div class="mediaui_rhs" mdevice-cnt="mic"><p>'+Resource.getRealValue("videochat.settings.micpreference")+'</p><div class="drpdwnoptns"><select id="mdevicelist_mic" class="slt_view msi-expand" disabled ><option>'+Resource.getRealValue("videochat.settings.nodevice")+'</option></select></div></div><div class="mediaui_rhs" mdevice-cnt="speaker" style="display:none;"><p>'+Resource.getRealValue("videochat.settings.speakerpreference")+'</p><div class="drpdwnoptns"><select id="mdevicelist_speaker" class="slt_view msi-expand" disabled ><option>'+Resource.getRealValue("videochat.settings.nodevice")+'</option></select></div></div><div class="footer dIB"><div id="mdevice_pref_save" class="windwbtn dIB cur">'+Resource.getRealValue("common.save")+"</div></div></div>",ChannelConnectorsHtml:'<div id="connectorscontainer" class="currchatpanel zchrec"><div class="apiendpt zcchprhdrT2 dIB font14 mrgT20"><div id="channelapiendpointtitle" class="dIB crtit sel">{{restapi_endpoint}} <span title='+$Util.getCustomTooltip('<span style = "width: 200px; display: block ">'+Resource.getRealValue("channel.restapi.title")+"</span>","html")+' class="msi-zinfo mrgL10 clr8 zvtam cur"></span></div><div class="mrgT10 mrgB10"><span>{{base_url}}/api/v2/channelsbyname/</span><span><b>{{unique_name}}</b></span><span>/message<span></div></div><div class="mrgT20 apiendpt zcchprhdrT2 dIB font14 "><div id="channeldelugetask" class="dIB crtit sel">{{deluge_task}}<span title='+$Util.getCustomTooltip('<span style = "width: 200px; display: block ">'+Resource.getRealValue("channel.deluge.title")+"</span>","html")+'class="msi-zinfo mrgL10 clr8 zvtam cur"></span></div><div class="mrgT10 mrgB10"><span>zoho.cliq.postToChannel("<b>{{unique_name}}</b>", "{{deluge_samplemessage}}");</span><div class="font13"><span><b>{{note}} </b></span><span class="clr8">{{user_task_note}}</span></div></div><div class="mrgT30 mrgB10"><span>zoho.cliq.postToChannelAsAdmin("<b>{{unique_name}}</b>", "{{deluge_samplemessage}}");</span><div class="font13"><span><b>{{note}} </b></span><span class="clr8">{{admin_task_note}}</span></div></div></div><div id="channelwebhooks" class="font14 zcchprhdrT2 mrgB10"></div></div>',ChannelWebhooksHtml:'<div class="dIB crtit sel">{{webhook}}</div><div class="mrgT10">{{webhook_info}}</div>{{config_html}}<div class="cmdediticn clr8">{{add_html}}</div>',ChannelPermissionOptionHtml:'<div class="zcchprem dsp_tble"><div class="bold permopt"><div>Action</div><div>'+Resource.getRealValue("channel.role.1")+"</div><div>"+Resource.getRealValue("channel.role.3")+"</div><div>"+Resource.getRealValue("channel.role.4")+'</div></div></div><div id="permissioncontainer" class="zcperbdy posl"><div class="zcchprem dsp_tble zcplinbt posl">{PERMISSIONHTML}</div></div>',DisableComposer:'<div class="zcancchl font14 textcent lin18 clr8"><div>{DISABLEMSG}</div></div>',MsgActionsSearch:'<div class="zchsrch"><div class="zchsrchbox"><div class="msi-srchicon"></div><div contenteditable="true" autofocus  placeholder="Search" class="srchfield floatr" id="msg-actions-search-field" prevsearchval="" ></div></div></div>',FeatureTour:'<h3>{TITLE}</h3><span class="msi-chtclose" data-purpose="close-tour" title="'+Resource.getRealValue("tour.close")+'"></span><p>{DESC}</p>',EmptyState:{chat:"{PARTICIPANTS}<h3>"+Resource.getRealValue("emptystate.chat.title")+' <span class="grntxt">{RECIPIANT}</span></h3><p class="emtycnt">'+Resource.getRealValue("emptystate.chat.desc1")+"</p>",adhocchat:"{PARTICIPANTS}<h3>"+Resource.getRealValue("emptystate.adhocchat.title")+' <span class="grntxt">{RECIPIANT}</span></h3><p class="emtycnt">'+Resource.getRealValue("emptystate.adhocchat.desc1")+"</p>",channel:"<p>{CHANNELIMAGE}</p><h3>"+Resource.getRealValue("emptystate.channel.title")+'</h3><p class="emtycnt">'+Resource.getRealValue("emptystate.channel.desc1")+"</p>",button:'<div class="greet" documentclick="greet_msg" chid={CHID}>'+Resource.getRealValue("emptystate.sayhello")+' <em class="zcslymsg-smile"></em></div>'},PTBroadcastStartWin:'<div id="{{id}}" class="dflx flxG flx-dirC w100 h100"><div class="flxG dflx flx-dirC"><div class="mrgT25 mrgB50 dflxjustcent fshrink"><img class="brdcst-img" id="broadcastpreview" src="{{src}}"></div><div class="brdcst-details">{{select_mode}}<div class="dflxcent mrgT30 fshrink"><div class="w25 bold font14">{{topic}}</div><input id="broadcastTopic" broadcastinput class="brdcst-title" value=""></div>{{select_scope}}{{org_group_sugg_html}}</div></div><div class="brdcst-footer"><div primetimebutton purpose="startBroadcast" class="buttn_pos adbtn">{{start}}</div></div></div>',primetimedlg:'<div class="mcontent"><div class="pt_lhs txtalgncentr"><img src="'+$zcg._IMGDEFAULTSTATICURL+'/pt_dialog.png" width="280" height="218" /><strong class="dB clr0 mrgT15">'+Resource.getRealValue("videobroadcast.dlg.imagetitle")+'</strong></div><div class="pt_rhs"><p class="clr0 fntbld">'+Resource.getRealValue("videobroadcast.dlg.title")+'</p><ul><li class="mcontent_p msi-rgtarw">'+Resource.getRealValue("videobroadcast.dlg.desc1")+'</li><li class="mcontent_p msi-rgtarw">'+Resource.getRealValue("videobroadcast.dlg.desc2")+'</li><li class="mcontent_p msi-rgtarw">'+Resource.getRealValue("videobroadcast.dlg.desc3")+'</li></ul><a href="'+$zcg._PRIMETIMEHELPLINK+'" target="_blank">'+Resource.getRealValue("common.learnmore")+'</a><div class="pt_confirm clr6"><p>'+Resource.getRealValue("videobroadcast.dlg.session")+'</p><div id="primetime_start_confirm" primetimebutton purpose="openPrimeTime" link={{link}} class="dbtn">'+Resource.getRealValue("videobroadcast.dlg.proceed")+"</div></div></div></div>",ChannelPermaLinkUI:'<div id="channelpermalink"{CHANNELID} chid="{CHATID}" class="joinchnlprw"><div id="channeldetails" class="chnldetails posl dIB"><div class="chnlicon">{CHANNELIMG}</div><p id="channelname" class="chnlname">{CHANNELNAME}</p><div class="details"><span class="chnltype msi-sc{CHANNELSCOPE}">{CHANNELTYPE}</span><span class="chnlmembercnt msi-groups"><b> {PARTICIPANTCOUNT} </b>{PARTICIPANTTEXTBASEDONCOUNT}</span></div><div class="hrdtline"></div><div class="chnldesc"><div>'+Resource.getRealValue("common.desc")+'</div><p>{CHANNELDESC}</p></div><div class="chnldesc"><div>'+Resource.getRealValue("group.created.by")+'</div><p class="creatr">{CREATORHTML}{TEAMNAME}&nbsp;<span>{CREATEDTIME}</p></div>{CHANNEL_NAME_FOOTER}</div><div id="recentconv" class="recentconv dIB"><div class="header"><span >'+Resource.getRealValue("common.recentconv")+'</span><span class="clr6">('+Resource.getRealValue("common.active")+'&nbsp;{CHANNEL_LAST_ACTIVE})</span>{GOTOCLIQLINK}</div><div id="channelmsgbody" chid="" purpose="chatbody" class="currchatpanel"><div class="fltbtn"><div class="joinbtn" purpose="{BUTTON_PURPOSE}" chid="{CHATID}" >{BUTTON_TEXT}</div></div><div id="channelmsgarea" class="zchlmsgarea posl" purpose="transcriptholder"></div></div></div>',TranscriptRetryUI:'<div id="transcriptfetcherror" class="infomsg zctrpterrinfo">{{transcripterror}}<span class="msi-resend zctrptretryicn"></span><span purpose="loadtranscriptonretry" fromtime="{{FROMTIME}}" totime="{{TOTIME}}" class="zctrptretrymsg">{{retry}}</span></div>',MessageEditor:'<div id="editcontainer{CHID}" class="zcmsg-edtbx" msguid="{MSGUID}"><div id="editor{CHID}" msgtime="{MSGTIME}" msguid="{MSGUID}" class="zcmsg-edt-inptbx" rule="msg" contenteditable="true" data-type="composer">{MSG}</div><div class="zcmsg-edtbx-bts"><div class="edit-notify-wrp dflxcent">{EDITNOTIFY}<label for="editnotify" class="edit-notfy-txt">'+Resource.getRealValue("message.edited.notifymsg")+'</label></div><div id="saveedit" purpose="saveedit" class="windwbtn dIB mrgR10">'+Resource.getRealValue("common.save")+'</div><span id="canceledit" purpose="canceledit" class="cur font14">'+Resource.getRealValue("common.cancel")+'</span><div id="editor_smileytrigger{CHID}" purpose="smileytrigger" data-trigger="source" class="zc-edt-smily"><em class="msi-zcsmly clr6 cur"></em></div><div id="editor_smileys{CHID}" data-trigger="destination" class="smileydivmn" data-target="1" ignore_giphy="true"></div></div></div>',EditHistoryUI:'<div id="edithistorycontainer" class="edit-his-bdy in-view"><div class="edit-hstry-ldr"><div class="zcldng"></div></div></div>',EditInfoMessage:'<span class="hvrinfo" purpose="viewreplied" msgtime="{{msgtime}}">'+Resource.getRealValue("message.edit.info.message")+"</span>",EditHistoryMsg:'<div class="edit-his-item {{isfirstmsg}} {{islastmsg}}"><div class="edit-his-item-titl"><span class="fontB clr0 bold">{{time}}</span><span class="clr6"> '+Resource.getRealValue("common.on")+"</span> {{date}}</div><pre>{{msg}}</pre></div>",EditHistoryMsgLoading:'<div class="edit-his-item edit-his-last-item"><div class="edit-his-item-titl"><div class="zcloadstatus"></div></div><pre><div class="zcloadstatus"></div></pre></div>',ViewReactions:'<div class="mcontent zcinhds zcrchmcnt"><div class="zcsrch-headr"><div class="flexC zcemoji-head posrel animEmoji" purpose="reactionHeader" currentTab="all" chid="{{chid}}" msguid="{{msguid}}"><div class="zcemoji-all sel font14" purpose="tabs" val="all">'+Resource.getRealValue("common.starmessages.category0")+' <span class="font13 mL5" totalcount>{{count}}</span></div><div class="zcemoji-lst">{{list}}</div></div><div id="reactedUsers-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="'+Resource.getRealValue("quickchat.node.placeholder")+'"></div></div><div id="reactedUsers-results"class="zcrchtlt zcboxhdsdow"><div class="posl mrgT5" id="reactedUsers-list"></div></div></div>',ViewReactionsSmileyList:'<div class="zcemoji-optn" purpose="tabs" val="{{code}}">{{smiley}}<span class="mrgL5">{{count}}</span></div>',reactedUserList:'<div uid="{{USERID}}" elemtype="contact" purpose="search" data-val="{{DNAMEVAL}}"class="zcrtchtcontct cur zc-rct-usr"><div class="floatl adchtlft posl"><img elemtype="user" uid="{{USERID}}" hover="true" src="{{DEFAULTURL}}" originalsrc="{{IMGURL}}"><div class="zcusr-emoji">{{reacted_smiley}}{{count}}</div></div><div class="floatl adchtrht pL20"><div elemtype="user" hover="true" uid="{{USERID}}" class="ellips font14 dIB zvta cur">{{DNAMEVAL}}</div><div class="ellips clr6 font13"><a class="curD" href="javascript:void(0)">{{EMAILID}}</a></div></div><div class="usr-rectime ellips"><span class="mrgR5 clr8 ellips">{{RECENT_TIME}}</span>{{RECENT_REACT}}</div></div>',MessageDiv:"<div {{attrib}}><div class='zcnew-strtng' purpose='time_star_holder'>{{starContent}}{{timeContent}}</div><pre {{msgContentAttrib}}>{{msgContent}}</pre>{{msgOptionsContent}}{{reactionsContent}}</div>",ReactedContent:'<div class="zcsetrectns flexC mrgT10">{{list}}{{addReaction}}</div>',ReactedContentList:'<div class="zcreactn-optns {{cssClass}}" title="{{title}}" purpose="reacted" unicode="{{code}}" documentclick="{{eventID}}">{{codeHtml}}<span>{{count}}</span></div>',AddReaction:'<div class="zcf-addemoji {{class}}" documentclick="{{documentClick}}" purpose="{{purpose}}" id="{{iconId}}" title="'+Resource.getRealValue("message.option.addreactions")+'" reactions></div>',NewOptionReply:'<div class="zcf-reply" title="'+Resource.getRealValue("message.option.reply")+'" documentclick="messageoperations" purpose="reply" id="reply{{chid}}"></div>',NewMessageOptions:'<div purpose="msgoption" class="zcmsgophov zcreactn_emoji">{{addReaction}}{{reply}}{{msgOptions}}</div>',ForwardCheckBox:'<div id="msgchcked{{msgtime}}" purpose="msgselect" class="zcunrdchkbx msi-chkbxdsel {{cssClass}}" checkbox="custom"></div>',ReactionSmileyHolder:'<div class="smileydivmn" id="reactionSmileyHolder" msguid="{{msguid}}" chid="{{chid}}" callback="Reactions.handle.reacted" data-trigger="destination" data-target="1" ignore_giphy="true">',CloudPickerTour:'<div class="mcontent flexG textcent"><img class="cld-pckr-img" src="'+$Util.getImgStaticUrl()+'/cloud-image{theme_mode}.svg"><div class="sharefileT-link mrgT20 ellips">'+Resource.getRealValue("cloud.tour.title")+'</div><p class="mrgT15 font14 ellips clr0">'+Resource.getRealValue("cloud.tour.authenticate")+'</p><p class="mrgT10 font14 ellips clr0">'+Resource.getRealValue("cloud.tour.services")+'</p><div class="sharefile-dashed mrgT20 font12 ellips clr0"><span><span class="msi-tip mrgR5"></span>'+Resource.getRealValue("channel.deluge.note")+"</span> "+Resource.getRealValue("cloud.tour.note",['<span class="msi-attfile font10"></span>'])+"</div></div>",FileAttachmentTour:'<div id ="cloud_picker_tour" class="touranim sharefile-touranim" documentclick="cloud_tour" chid="{{chid}}"><div class="msi-atchmnd cld-pckr-tour flexM"></div></div>',ReactionTour:'<div class="flexC"><div class="fshrink reactn-tour-img"></div><div class="reactn-tour-con flexG"><div class="tour-title font18 clr4A fontb">'+Resource.getRealValue("tour.zcmsgreactions.title")+'</div><div class="tour-desc font15 mT10 line22">'+Resource.getRealValue("tour.zcmsgreactions.desc")+' <span class="reactn-tour-emoji"><em class="zcslymsg-relaxed" code=":relaxed:" nodetype=":" title="Relaxed"></em></span></div></div></div>'};var ZCScroll={};ZCScroll={customScroll:function(e,t,i){if($Util.isMacOs())return void $(e).addClass("macscroll");var a={suppressScrollX:!0,minScrollbarLength:50},s=$.extend({},a,i);e=$(e),e.perfectScrollbar(s),e.hasClass("ps-container ps-active-y")||e.addClass("ps-container ps-active-y"),t&&e.perfectScrollbar("update"),e.find("div.ps-scrollbar-y").attr("tabindex","-1")},updateScroll:function(e){return $Util.isMacOs()?void $(e).addClass("macscroll"):void $(e).perfectScrollbar("update")},resetScroll:function(e,t){return $Util.isMacOs()?void $(e).addClass("macscroll"):($(e).perfectScrollbar("destroy"),void this.customScroll(e,!0,t))},removeScroll:function(e){$Util.isMacOs()||$(e).perfectScrollbar("destroy")},scrollTop:function(e,t,i){e.length||(e=$(e)),i?$(e).animate({scrollTop:t},i):e.scrollTop(t)},getScrollTop:function(e){return e.scrollTop},getScrollDown:function(e,t){var i=e.scrollHeight-e.clientHeight;ZCScroll.scrollTop(e,i,t)},isScrollUp:function(e){return e.scrollTop<=0},isScrollNearBottom:function(e,t){var t=t?t:20,i=e.scrollHeight-e.scrollTop<=e.clientHeight+t;return i},isScrollDown:function(e){return Math.ceil(e.scrollTop)>=e.scrollHeight-e.clientHeight}};var $WC=$WC||{};$WC.WindowObject=function(e){this.id=e.id,this.draggable="undefined"!=typeof e.draggable?e.draggable:!1,this.nav=e.nav===!0,this.sigleton=e.sigleton===!0,this.bg="undefined"!=typeof e.bg?e.bg:!0,this.opencallback="undefined"!=typeof e.openfn?e.openfn:null,this.closecallback="undefined"!=typeof e.closefn?e.closefn:null,this.closebeforecallback="undefined"!=typeof e.closebeforefn?e.closebeforefn:null,this.closeoutside="undefined"!=typeof e.closeoutside?e.closeoutside:!1,this.aligncenter="undefined"!=typeof e.aligncenter?e.aligncenter:!0},$WC.WindowObject.prototype={create:function(e){var t=this.id,i=this.getTemplate(),a=this.aligncenter?" zcalgncntr":"",s='<span id="winclose" title="'+$WC.Resource.getRealValue("common.to.close")+'" class="zchat-close cclose"></span>',n=e.additionalattrs||"";i=i.replace(/{WININDEX}/g,t).replace(/{WINCLASS}/g,"undefined"!=typeof e.class?e.class+a:a).replace(/{WINHEADER}/g,"undefined"!=typeof e.header?$WC.Matcher.replace("escapeReplacementString",e.header):"").replace(/{WINCLOSE}/g,"undefined"!=typeof e.closehtml?$WC.Matcher.replace("escapeReplacementString",e.closehtml):s).replace(/{DRAGGABLE}/g,this.draggable?"drag":"").replace(/{WINADDITIONALATTR}/g,n).replace(/{WINHTML}/g,$WC.Matcher.replace("escapeReplacementString",e.html));var r=document.getElementById("zcwindows");if(r){r.insertAdjacentHTML("beforeend",i);var o=this.getelem(),l=this;return Gator(o).on("mousedown",function(e){l.handleClick(l,e)}),this.getMeFront(),this.focusInputField(),null!=this.opencallback&&this.opencallback(this.id),this.draggable&&Gator(o).on("mousedown",".drag",function(e){l.drag(e,l)}),$WC.$Win.current=t,this.get()}},focusInputField:function(){var e=this.getelem();if(e){var t=e.querySelectorAll("input[type=text]");if(t.length)t[0].focus();else{var i=e.querySelectorAll("textarea");i.length&&i[0].focus()}}},handleClick:function(e,t){var i=t.target.id,a={winnav:function(){e.sigleton&&$WC.$Win.destroy(e.id,!0)},winclose:function(){$WC.$Win.destroy(e.id)}},s=a[i];"function"==typeof s&&s()},drag:function(e,t){function i(e){e.preventDefault();var t=s.style;t.left=e.clientX-n+"px",t.top=e.clientY-r+"px"}function a(e){Gator(s).off("mousemove"),Gator(s).off("mouseup"),e.preventDefault}if(1==e.which||"INPUT"!==e.target.tagName){var s=t.getelem();if(s){var n=e.clientX-s.offsetLeft,r=e.clientY-s.offsetTop;Gator(s).on("mousemove",i),Gator(s).on("mouseup",a)}}},close:function(e){var t=this.getelem();t&&(null!=this.closebeforecallback&&this.closebeforecallback(this.id),t.remove(),null==this.closecallback||e||this.closecallback(this.id))},getelem:function(){return document.getElementById(this.id)},get:function(){return $WC.$CUtil.getConfig("PUREJS")===!0?this.getelem():window.jQuery?jQuery("#"+this.id):$("#"+this.id)},getMeFront:function(){var e=this.getelem();if(e){var t=e.querySelectorAll("#winnav");if(t.length&&t.remove(),this.nav&&$WC.$Win.persists()){var i=e.querySelectorAll("#winhead")[0];i.insertAdjacentHTML("afterbegin",'<span id="winnav" title="'+$WC.Resource.getRealValue("common.back")+'" class="zchat-zcheadicn mrgR10 fl_left"></span>')}$WC.$CUtil.removeClass(e,"zcbg_mask"),this.bg&&$WC.$CUtil.addClass(e,"zcbg_mask"),this.handleCloseOutside(),e.parentNode.appendChild(e)}},handleCloseOutside:function(){var e=this.getelem(),t=this;this.closeoutside&&(e.insertAdjacentHTML("afterbegin",'<div class="zcbg_mask"></div>'),Gator(e).on("click",".zcbg_mask",function(){$WC.$Win.destroy(t.id)}))},getTemplate:function(){return['<div id="{WININDEX}" type="popup" class="modalwindow {WINCLASS} " {WINADDITIONALATTR}><div>','<div id="winhead" class="mheader {DRAGGABLE}">{WINHEADER}{WINCLOSE}</div>{WINHTML}</div>',"</div>"].join("")}},$WC.$Win=function(){var e={},t=function(t,i){e[t]=i},i={"window-created":[],"window-destroyed":[]};return{isExist:function(t){return e.hasOwnProperty(t)},persists:function(){var e=document.getElementById("zcwindows");return e?e.children.length>1:void 0},get:function(t){return this.isExist(t)?e[t].get():null},destroy:function(t,i){if(this.isExist(t)){e[t].close(i),delete e[t];var a=document.getElementById("zcwindows").lastChild;this.current=$WC.$CUtil.isEmpty(a)||$WC.$CUtil.isEmptyObject(a)?null:a.getAttribute("id")}this.triggerEvent("window-destroyed")},handleOutsideClose:function(){var t=this.current;t&&this.isExist(t)&&e[t].closeoutside&&$WC.$Win.destroy(t)},getFront:function(t){e[t].getMeFront()},closeAll:function(){var e=document.getElementById("zcwindows");if(e){var t=e.children,i=t.length;if(!t)return;for(var a=0;i>a;a++){var s=t[a].id;this.isExist(s)&&this.destroy(s)}}},handleEscape:function(){var e=document.getElementById("zcwindows");if(e&&e.lastChild){var t=e.lastChild.id;if(this.isExist(t))return this.destroy(t),!0}return!1},create:function(i){var a=i.id;t(a,new $WC.WindowObject(i));var s=e[a].create(i);return this.triggerEvent("window-created"),s},triggerEvent:function(e){if(i.hasOwnProperty(e))for(var t=i[e],a=function(e){setTimeout(function(){e()},0)},s=0;s<t.length;s++)"function"==typeof t[s]&&a(t[s])},on:function(e,t){i.hasOwnProperty(e)&&i[e].push(t)},off:function(e){i.hasOwnProperty(e)&&(i[e]=[])}}}(),$WC.$Dlg={},$WC.$Dlg=function(){function e(){c===!1&&(t={draggable:!0,bg:!0,"class":"zcdalogbx",openfn:function(){},bodyhtml:"",headerhtml:"",version:1,buttons:[]},i={buttons:[{text:$WC.Resource.getRealValue("common.ok"),colour:n}]},a={buttons:[{text:$WC.Resource.getRealValue("common.ok"),colour:r}]},c=!0)}var t,i,a,s={},n=1,r=2,o=1,l=[1,2],c=!1,d=function(e){s[e.id]={},s[e.id].buttons=e.buttons},u=function(e){return l.includes(e.version)?e.version:1},m=function(e){function t(e,t){switch(e){case 1:return t===r?"buttn_neg":"buttn_pos";case 2:return"zcdlgbtn "+(t===r?"zcdlgbtn-red":t===n?"zcdlgbtn-green":"")}}for(var i="",a=e.imagehtml?'<div class="zcdlg_lft"><div class="zcpp_dlgltin">'+e.imagehtml+"</div></div>":"",s=u(e),l=e.buttons.length,c=!1,d=0;l>d;d++)c||(o=d+1,c=!0),i+='<button button="'+(d+1)+'" class="'+t(s,e.buttons[d].colour)+'">'+e.buttons[d].text+"</button>";return p(s).replace(/{IMAGE}/g,a).replace(/{MESSAGE}/g,$WC.Matcher.replace("escapeReplacementString",e.bodyhtml)).replace(/{BUTTON}/g,i)},p=function(e){switch(e){case 1:return['<div class="mcontent"><div class="dialogmn">{IMAGE}<div class="zcdlg_rht"><div class="zcdlgmsg">{MESSAGE}</div></div></div><div class="wctxtcent">{BUTTON}</div></div>'].join("");case 2:return['<div class="mcontent"><div class="mcontent_txt_con">{MESSAGE}</div><div class="mcontent_btn_con">{BUTTON}</div></div>'].join("")}},h=function(e){d(e);var t=$WC.$Win.create({id:e.id,header:e.headerhtml,closehtml:'<span id="winclose" title="'+$WC.Resource.getRealValue("common.cancel")+'" class="zchat-close cclose"></span>',html:m(e),"class":e.class,draggable:e.draggable,bg:e.bg,openfn:e.openfn,closefn:function(t){delete s[t],"function"==typeof e.closefn&&e.closefn()}});return"undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t[0]),f(t,e.id),t},g=function(e){return e.class+="undefined"==typeof e.imagehtml?" zcdgimgnone":"",e},f=function(e,t){Gator(e).on("click","[button]",function(e){if($WC.$Dlg.isExist(t)){e.stopPropagation();var i=parseInt(this.getAttribute("button")),a=s[t].buttons[i-1].action;"function"==typeof a&&a.call($WC.$Win.get(t)),$WC.$Win.destroy(t)}})};return{GREEN_BUTTON:1,RED_BUTTON:2,GREY_BUTTON:3,create:function(i){if(e(),o=1,!$WC.$Dlg.isExist(i.id)){i=$WC.$CUtil.extend(!0,{},t,i),i=g(i);var a=h(i),s=a.querySelectorAll('[button="'+o+'"]');return s&&s[0]&&s[0].focus(),a}},alert:function(t){e(),t=$WC.$CUtil.extend(!0,{},i,t),this.create(t)},confirm:function(t){e(),t=$WC.$CUtil.extend(!0,{},a,t),this.create(t)},isExist:function(e){return s.hasOwnProperty(e)},destroy:function(e){$WC.$Win.destroy(e)},frameHeaderHTML:function(e){var t="",i=e&&e.ispositive?"mheader_ttl clr-green":"mheader_ttl",a=e&&e.ispositive?"mheader_p clr-green":"mheader_p";return e&&e.imagehtml&&(t+=e.imagehtml),e&&e.header&&(t+='<div class="'+i+'">'+e.header+"</div>"),e&&e.subheader&&(t+='<div class="'+a+'">'+e.subheader+"</div>"),t},frameBodyInfoHTML:function(e){var t=e&&e.info?e.info.length:0,i=e&&e.infoheader?e.infoheader:$WC.Resource.getRealValue("dialogue.info.header"),a=t>0?'<div class="mcontent_ttl">'+i+"</div>":"";if(e&&$WC.$CUtil.isEmpty(e.infoheader)&&1==t)a='<div class="zcdlg_rht">'+e.info[0]+"</div>";else if(t>0)for(var s=0;t>s;s++)a+='<div class="mcontent_p msi-rgtarw">'+e.info[s]+"</div>";return a}}}(),$WC.Widgets=function(){function e(){i===!1&&(t={alert:{"class":"zchat-alrt",title:$WC.Resource.getRealValue("info.warning")},info:{"class":"zchat-hisseld",title:$WC.Resource.getRealValue("info.success")},confirm:{"class":"zchat-question",title:$WC.Resource.getRealValue("info.confirm")}},i=!0)}var t={},i=!1,a=function(e){var t={};return"undefined"!=typeof e.btntxt&&(t.text=e.btntxt),"undefined"!=typeof e.btncallback&&(t.action=e.btncallback),t.colour=$WC.$Dlg.GREEN_BUTTON,t};return{construct:function(i){if(e(),this.isValid(i)){var s='<div class="zcartcnt"><div class="{DLGLASS} wcdIB f40"></div><div class="wcdIB zcfarlt"><div class="zcartnm">{HEADER}</div><div class="clr0">{MSG}</div></div>{INPUT}</div>',n=t[i.type];s=s.replace(/{DLGLASS}/g,n.class).replace(/{HEADER}/g,"undefined"!=typeof i.title?$WC.$CUtil.processXSS(i.title):n.title),s=s.replace(/{MSG}/g,$WC.CMsgUtil.convertLinks(i.description)),s=s.replace(/{INPUT}/g,i.input?'<textarea id="buttonconfirminput" placeholder="'+$WC.$CUtil.processXSS(i.input)+'" maxlength="300" class="zcartinp"></textarea>':"");var r=[];"alert"===i.type?(r=[],r.push(a(i)),$WC.$Dlg.alert({id:"widgetalert",bodyhtml:s,buttons:r})):"confirm"===i.type?(r=[],r.push(a(i)),$WC.$Dlg.confirm({id:"widgetconfirm",bodyhtml:s,buttons:r}),document.getElementById("buttonconfirminput").focus()):"info"===i.type&&(r=[],r.push(a(i)),$WC.$Dlg.alert({id:"widgetinfo",bodyhtml:s,buttons:r}))}},isValid:function(t){e();var i=!1,a=["alert","confirm","prompt","info","poll","photo"];return"undefined"!=typeof t.type&&(i=-1!=a.indexOf(t.type)),i}}}();var $WC=$WC||{};$WC.Ajax={},$WC.Ajax._makeRequest=function(e){var t,i=e.type?e.type:"GET",a="boolean"==typeof e.async?e.async:!0,s=e.callback,n=e.url;if(window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.opts=e.opts,t.onreadystatechange=s,t.open(i,n,a),t.setRequestHeader("Accept","*/*"),e.reqheaders&&e.reqheaders["Content-Type"]?t.setRequestHeader("Content-Type","application/json"):t.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),e.reqheaders)for(var r in e.reqheaders)t.setRequestHeader(r,e.reqheaders[r]);t.send(e.params)},$WC.Ajax._getRequest=function(e,t,i,a,s,n,r,o){e&&(t="/"+e+"/"+t),t+=i?"?"+i+$WC.$CUtil.nocachefix(!0):"?nocache="+(new Date).getTime();var l={onsuccess:a,onfailure:s,callbackargs:n},c={callback:$WC.Ajax.callbackDispatcher,opts:l,url:t,async:r,reqheaders:o};$WC.Ajax._makeRequest(c)},$WC.Ajax._postRequest=function(e,t,i,a,s,n,r,o){if(e&&(t="/"+e+"/"+t),o&&"application/json"===o["Content-Type"])i=JSON.stringify(i);else{var l=$WC.$CUtil.getCSRF();i=i?i+"&"+l:l,i+=$WC.$CUtil.nocachefix(!0)}var c={onsuccess:a,onfailure:s,callbackargs:n},d={type:"POST",callback:$WC.Ajax.callbackDispatcher,url:t,params:i,opts:c,async:r,reqheaders:o};$WC.Ajax._makeRequest(d)},$WC.Ajax._putRequest=function(e,t,i,a,s,n,r,o){if(e&&(t="/"+e+"/"+t),o&&"application/json"===o["Content-Type"])i=JSON.stringify(i);else{var l=$WC.$CUtil.getCSRF();i=i?i+"&"+l:l,i+=$WC.$CUtil.nocachefix(!0)}var c={onsuccess:a,onfailure:s,callbackargs:n},d={type:"PUT",callback:$WC.Ajax.callbackDispatcher,url:t,params:i,opts:c,async:r,reqheaders:o};$WC.Ajax._makeRequest(d)},$WC.Ajax.request=function(e,t,i,a,s,n,r){$WC.Ajax._getRequest($WC.$CUtil.getConfig("WMSCONT"),e,t,i,a,s,n,r)},$WC.Ajax.postRequest=function(e,t,i,a,s,n,r){$WC.Ajax._postRequest($WC.$CUtil.getConfig("WMSCONT"),e,t,i,a,s,n,r)},$WC.Ajax.putRequest=function(e,t,i,a,s,n,r){$WC.Ajax._putRequest($WC.$CUtil.getConfig("WMSCONT"),e,t,i,a,s,n,r)},$WC.Ajax.requestToChat=function(e,t,i,a,s,n,r){$WC.Ajax._getRequest($WC.$CUtil.getConfig("CHATCONT"),e,t,i,a,s,n,r)},$WC.Ajax.postRequestToChat=function(e,t,i,a,s,n,r){$WC.Ajax._postRequest($WC.$CUtil.getConfig("CHATCONT"),e,t,i,a,s,n,r)},$WC.Ajax.putRequestToChat=function(e,t,i,a,s,n,r){$WC.Ajax._putRequest($WC.$CUtil.getConfig("CHATCONT"),e,t,i,a,s,n,r)},$WC.Ajax.postRequestToChatWithLocation=function(e,t,i,a,s,n,r){var o=$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE;if("granted"===o){var l=function(){var o=$WC.$CUtil.cloneObject($WC.$CUtil.getConfig("LOCATION_INFO").CACHED.coords);o.status="granted",r=r||{},r["X-Geo-Location"]=JSON.stringify(o),$WC.Ajax.postRequestToChat(e,t,i,a,s,n,r)};if(void 0!==$WC.$CUtil.getConfig("LOCATION_INFO").CACHED)l();else{void 0!==$WC.$CUtil.getConfig("LOCATION_INFO").WATCH_ID&&navigator.geolocation.clearWatch($WC.$CUtil.getConfig("LOCATION_INFO").WATCH_ID);var c=function(e){var t=void 0===$WC.$CUtil.getConfig("LOCATION_INFO").CACHED;$WC.$CUtil.getConfig("LOCATION_INFO").CACHED=e,$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE="granted",t&&l()},d=function(o){var l;1===o.code?(l="denied",$WC.$CUtil.getConfig("LOCATION_INFO").PERMISSIONSTATE=l):l="failure";var c=void 0===$WC.$CUtil.getConfig("LOCATION_INFO").CACHED;c&&(r=r||{},r["X-Geo-Location"]=JSON.stringify({status:l}),$WC.Ajax.postRequestToChat(e,t,i,a,s,n,r)),delete $WC.$CUtil.getConfig("LOCATION_INFO").CACHED};$WC.$CUtil.getConfig("LOCATION_INFO").WATCH_ID=navigator.geolocation.watchPosition(c,d)}}else r=r||{},r["X-Geo-Location"]=JSON.stringify({status:o}),$WC.Ajax.postRequestToChat(e,t,i,a,s,n,r)},$WC.Ajax.callbackDispatcher=function(){if(4===this.readyState)if(200===this.status||204===this.status){var e=this.responseText;if(""!==e){var t;try{t=JSON.parse(e)}catch(i){try{e=e.slice(0,-1),e="[["+e+"]]",t=JSON.parse(e)}catch(a){"function"==typeof this.opts.onsuccess&&this.opts.onsuccess.call(this)}}if(null===t||void 0===t)return;var s=t.length,n=0;if(s)for(n=0;s>n;n++){var r=t[n],o=r.objString;if(r.objType&&"do"===r.objType&&(o=$WC.Ajax.getObject(r.objType,r.objString)),"function"==typeof this.opts.onsuccess)this.opts.onsuccess.call(this,o);else if($WC.$CUtil.getConfig("AjaxDispatcher")){var l=$WC.$CUtil.getConfig("AjaxDispatcher");l(r.module,r.objType,o)}}else"function"==typeof this.opts.onsuccess&&this.opts.onsuccess.call(this,e)}else"function"==typeof this.opts.onsuccess&&this.opts.onsuccess.call(this)}else"function"==typeof this.opts.onfailure&&this.opts.onfailure.call(this)},$WC.Ajax.getObject=function(e,t){if("do"===e){for(var i=new $WC.DataObject.construct,a=0;a<t.length;a++)for(var s=t[a],n=s.tname,r=s.cols,o=s.rows,l=0;l<o.length;l++){for(var c=o[l],d=[],u=0;u<c.length;u++)d[u]=[r[u],c[u]];i.addRowsForTable(n,d)}return i}return t},WmsContacts.userstatus=function(){},WmsContacts.userstatus.ONLINE=1,WmsContacts.userstatus.OFFLINE=0,WmsContacts.userstatus.FEEDINFO=2,WmsContacts.userstatus.BUSY=3,WmsContacts.userstatus.IDLE=4,WmsContacts.userstatus.WEB_LOGIN=1,WmsContacts.userstatus.MOB_LOGIN=3,WmsContacts.defaultstatusmsg=["Offline","Available","","Busy","Idle"],WmsContacts.invitedcontactslist=[],WmsContacts.pendinginvcontactslist=[],WmsContacts.contactslist={},WmsContacts.zohocontacts={},WmsContacts.updatempscontactlist=function(e){var t=new Array;for(var i in e){var a={},s=e[i].scode,n=e[i].smsg,r=e[i].uname;WmsContacts.contactslist.hasOwnProperty(r)===!1&&(WmsContacts.contactslist[r]={}),a.STATUS=s,WmsContacts.contactslist[r].STATUS=s,a.STATUSMSG=void 0!=n?n:"",WmsContacts.contactslist[r].STATUSMSG=void 0!=n?n:"",a.OWNERID=WmsContacts.getMPLoginName(e[i].uname),WmsContacts.contactslist[r].OWNERID=a.OWNERID,a.USERID=e[i].uname,WmsContacts.contactslist[r].USERID=a.USERID,void 0!=e[i].dname&&""!=e[i].dname&&(a.DNAME=e[i].dname,WmsContacts.contactslist[r].DNAME=a.DNAME),a.EMAILID=WmsContacts.getMPDispName(r),WmsContacts.contactslist[r].EMAILID=a.EMAILID,a.PROTOCOL=e[i].protocol,WmsContacts.contactslist[r].PROTOCOL=a.PROTOCOL,t.push(a)}WmsImplHandler.invoke(WmsContactImpl.handleBulkPresence,a.PROTOCOL,t),WmsContacts.lastupdatetime=(new Date).getTime(),WmsImplHandler.invoke(WmsContactImpl.handleAddressBook)},WmsContacts.removefromobj=function(e,t,i){"zoho"!=e&&(t=i+"|"+t),WmsContacts.contactslist[t]=null,WmsContacts.lastupdatetime=(new Date).getTime()},WmsContacts.updateStatus=function(e){try{var t=e.zuid;(void 0==WmsContacts.contactslist[t]||void 0==WmsContacts.zohocontacts[t])&&(WmsContacts.contactslist[t]={},WmsContacts.contactslist[t].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.contactslist[t].USERID=t,WmsContacts.contactslist[t].DNAME=e.dname,WmsContacts.contactslist[t].EMAILID=e.email,WmsContacts.zohocontacts[t]={},WmsContacts.zohocontacts[t].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.zohocontacts[t].USERID=t,WmsContacts.zohocontacts[t].DNAME=e.dname,WmsContacts.zohocontacts[t].EMAILID=e.email),WmsContacts.contactslist[t].STATUS=e.scode,WmsContacts.contactslist[t].STYPE=e.st,WmsContacts.contactslist[t].STATUSMSG=e.smsg,WmsContacts.zohocontacts[t].STATUS=e.scode,WmsContacts.zohocontacts[t].STYPE=e.st,WmsContacts.zohocontacts[t].STATUSMSG=e.smsg}catch(i){}},WmsContacts.updateFromMDParent=function(e){var t=new Array;try{for(var i in e){var a=e[i].STATUS;-3==a&&t.push(i)}}catch(s){}t.length>0&&(WmsImplHandler.invoke(WmsContactImpl.handleInvitations,t),WMSUI.updateInvitations(t))},WmsContacts.updateContacts=function(e){try{for(var t in e){var i=e[t],a=$WC.$CUtil.splitWmsFormattedString(e[t].s,6,!0),s={};s.zuid=t,s.scode=a[0],s.email=a[1],s.st=a[2],s.uc=a[3],s.dname=a[5][1]||s.email,s.smsg=a[5][0]||WmsContacts.defaultstatusmsg[s.scode],s.scode==WmsConstants.CONTACTSTATUS.REQACC&&-1===WmsContacts.invitedcontactslist.indexOf(t)&&-1===WmsContacts.pendinginvcontactslist.indexOf(t)?(WmsContacts.invitedcontactslist.push(t),WmsContacts.pendinginvcontactslist.push(t)):s.scode==WmsConstants.CONTACTSTATUS.NOCHAT&&-1===WmsContacts.pendinginvcontactslist.indexOf(t)&&WmsContacts.pendinginvcontactslist.push(t),WmsContacts.isMPUser(s.zuid)?WmsContacts.isMP&&(WmsContacts.contactslist[t]={},WmsContacts.contactslist[t].STATUS=s.scode,WmsContacts.contactslist[t].STYPE=s.st,WmsContacts.contactslist[t].STATUSMSG=s.smsg,WmsContacts.contactslist[t].UC=s.uc,WmsContacts.contactslist[t].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.contactslist[t].USERID=t,WmsContacts.contactslist[t].PROTOCOL=i.protocol,WmsContacts.contactslist[t].PHOTO=i.photo,WmsContacts.contactslist[t].DNAME=void 0!=s.dname?s.dname:t.substring(t.indexOf("|")+1,t.lastIndexOf("|")),WmsContacts.contactslist[t].EMAILID=s.email?s.email:t.substring(t.indexOf("|")+1,t.lastIndexOf("|"))):WmsContacts.updatezohocontacts(s)}WmsContacts.lastupdatetime=(new Date).getTime()}catch(n){}WmsContacts.invitedcontactslist.length&&"undefined"!=typeof WmsContactImpl&&WmsImplHandler.invoke(WmsContactImpl.handleInvitations,WmsContacts.invitedcontactslist)},WmsContacts.updateBotContacts=function(e){for(var t in e){var i={ISBOT:!0,EMAILID:$WC.$CUtil.getConfig("Resource").getRealValue("chatbot.smsg"),STATUSMSG:$WC.$CUtil.getConfig("Resource").getRealValue("chatbot.smsg"),TYPE:"",PROTOCOL:"zoho",SCODE:1,UC:e[t].info.uc,ZUID:""};i.DNAME=e[t].name;var a=e[t].status;if(a){var s=Math.round(Math.random()*(a.length-1));i.STATUSMSG=a[s],i.EMAILID=a[s]}i.UNIQUENAME=e[t].uniquename||e[t].info.uniquename,i.PHOTO=e[t].photo||e[t].photoid,i.CHID=e[t].chid,i.USERID=e[t].id,i.PERMISSION=e[t].info&&e[t].info.permission,i.PHOTO=i.PHOTO?"/_chat/botimg/"+i.PHOTO+"/photo.do":i.CHID.endsWith("B1")?"/"+_WMSCONT+"/images/bot-custom.png":"/"+_WMSCONT+"/images/bot-default.png",WmsContacts.contactslist[t]=i}},WmsContacts.updateBotActions=function(e,t){var i=WmsContacts.contactslist[e];$WC.$CUtil.isEmpty(i)||(i.actionhandles=t)},WmsContacts.copyContacts=function(e){var t=new Array;try{for(var i in e){var a=e[i],s=a.USERID;-3==a.STATUS&&t.push(i),WmsContacts.isMPUser(s)?WmsContacts.isMP&&(WmsContacts.contactslist[s]={},WmsContacts.contactslist[s].STATUS=a.STATUS,WmsContacts.contactslist[s].STATUSMSG=a.STATUSMSG,WmsContacts.contactslist[s].OWNERID=$WC.$CUtil.getConfig("zuid"),WmsContacts.contactslist[s].USERID=a.USERID,WmsContacts.contactslist[s].DNAME=a.DNAME,WmsContacts.contactslist[s].EMAILID=a.EMAILID,WmsContacts.contactslist[s].PROTOCOL=a.PROTOCOL,WmsContacts.contactslist[s].PHOTO="",WmsContacts.contactslist[s].PHOTO=""!=a.PHOTO&&void 0!=a.PHOTO?a.PHOTO:""):WmsContacts.copyZohoContacts(a)}WmsContacts.lastupdatetime=(new Date).getTime()}catch(n){}t.length>0&&(WmsImplHandler.invoke(WmsContactImpl.handleInvitations,t),WMSUI.updateInvitations(t))},WmsContacts.copyZohoContacts=function(e){try{var t=e.USERID,i={};i.STATUS=e.STATUS,i.STYPE=e.st,i.STATUSMSG=e.STATUSMSG,i.OWNERID=$WC.$CUtil.getConfig("zuid"),i.USERID=e.USERID,i.DNAME=e.DNAME,i.EMAILID=e.EMAILID,i.PHOTO=""!=e.PHOTO&&void 0!=e.PHOTO?e.PHOTO:"",WmsContacts.zohocontacts[t]=i,WmsContacts.contactslist[t]=i}catch(a){}},WmsContacts.updatezohocontacts=function(e){try{if(e.scode==WmsConstants.CONTACTSTATUS.DELETE)return;var t=e.zuid,i={};i.STATUS=e.scode,i.STYPE=e.st,i.STATUSMSG=e.smsg,i.OWNERID=$WC.$CUtil.getConfig("zuid"),i.USERID=e.zuid,i.DNAME=e.dname,i.EMAILID=e.email,i.PHOTO="",i.UC=e.uc,WmsContacts.zohocontacts[t]=i,WmsContacts.contactslist[t]=i,WmsContacts.lastupdatetime=(new Date).getTime()}catch(a){}},WmsContacts.removeList=function(e){var t=e+"|",i=WmsContacts.getcontacts();for(var a in i)0==a.indexOf(t)&&(WmsContacts.contactslist[a]=null,delete WmsContacts.contactslist[a])},WmsContacts.addinobj=function(e,t,i){"zoho"!=e&&(t=i+"|"+t),WmsContacts.contactslist[t]={},WmsContacts.contactslist[t].STATUS="0",WmsContacts.contactslist[t].STATUSMSG=null,WmsContacts.contactslist[t].OWNERID=null,WmsContacts.contactslist[t].USERID=t,WmsContacts.lastupdatetime=(new Date).getTime()},WmsContacts.updatecontactlist=function(e){if(null!=e){var t=e.Contact;if(null!=t){var i=t.length;if(!(0>=i)){for(var a=0;i>a;a++){var s=t[a].USERID;WmsContacts.contactslist[s]={},WmsContacts.contactslist[s].STATUS=t[a].STATUS,WmsContacts.contactslist[s].STATUSMSG=t[a].STATUSMSG,WmsContacts.contactslist[s].OWNERID=t[a].OWNERID,WmsContacts.contactslist[s].USERID=t[a].USERID,WmsContacts.contactslist[s].CON_ID=t[a].CON_ID,WmsContacts.zohocontacts[s]={},WmsContacts.zohocontacts[s].STATUS=t[a].STATUS,WmsContacts.zohocontacts[s].STATUSMSG=t[a].STATUSMSG,WmsContacts.zohocontacts[s].OWNERID=t[a].OWNERID,WmsContacts.zohocontacts[s].USERID=t[a].USERID,WmsContacts.zohocontacts[s].CON_ID=t[a].CON_ID;try{WmsContacts.contactslist[s].DNAME=t[a].DNAME,WmsContacts.zohocontacts[s].DNAME=t[a].DNAME,WmsContacts.contactslist[s].EMAILID=t[a].EMAILID,WmsContacts.zohocontacts[s].EMAILID=t[a].EMAILID,WmsContacts.contactslist[s].PHOTO=t[a].PHOTO,WmsContacts.zohocontacts[s].PHOTO=t[a].PHOTO}catch(n){}}WmsContacts.lastupdatetime=(new Date).getTime(),WmsImplHandler.invoke(WmsContactImpl.handleAddressBook)}}}},WmsContacts.deletecontact=function(e){delete WmsContacts.zohocontacts[e],delete WmsContacts.contactslist[e]},WmsContacts.enableMP=function(){WmsContacts.isMP=!0},WmsContacts.isInitialised=function(){return WmsContacts.initialized},WmsContacts.init=function(e){WmsContacts.contactslist={},WmsContacts.zohocontacts={},WmsContacts.lastupdatetime=0,WmsContacts.initialized=!1,(_WMSCONFIG&WMSSessionConfig.MP)==WMSSessionConfig.MP&&WmsContacts.enableMP(),"undefined"==typeof WmsContacts.isMP&&(WmsContacts.isMP=!1),void 0!=e&&(WmsContacts.copyContacts(e),WmsContacts.initialized=!0),WmsContacts.isMP&&(WmsMPAccounts.init(),WmsMPAccounts.loginstartup(),setTimeout(function(){WmsMPAccounts.getandlogin()},2e3))},WmsContacts.getcontacts=function(){return WmsContacts.contactslist},WmsContacts.isonline=function(e){return WmsContacts.contactslist[e]?"0"!==WmsContacts.contactslist[e].status:!1},WmsContacts.getZohoContacts=function(){return WmsContacts.zohocontacts},WmsContacts.getStatusMsg=function(e){return WmsContacts.contactslist[e]?WmsContacts.status(e)==WmsConstants.CONTACTSTATUS.UNAPRD?$WC.$CUtil.getConfig("Resource").getRealValue("Invited"):WmsContacts.contactslist[e].STATUSMSG:void 0},WmsContacts.getStatusType=function(e){return WmsContacts.contactslist[e]?WmsContacts.contactslist[e].STYPE:void 0},WmsContacts.status=function(e){return WmsContacts.contactslist[e]?WmsContacts.contactslist[e].STATUS:!1},WmsContacts.getStatusClassName=function(e,t,i){var a={0:"offline",1:"available",3:"busy",4:"idle"};t=t||WmsContacts.status(e),i=i||WmsContacts.getStatusType(e);var s="";return t?(s=a[t]||"",i==WmsContacts.userstatus.MOB_LOGIN&&(s+="_mobile")):e&&-1!==e.indexOf("b-")&&(s+="bot"),s},WmsContacts.add=function(e,t,i){var a,s;0!=t.trim()&&("zoho"==e?(a="addcontact.do",s="ulist="+encodeURIComponent(t)):(a="mpcontact.do",s="zohoid="+WebMessanger.getUserName()+"&mploginid="+i+"&contactid="+t+"&opr=addcon"),$WC.Ajax.postRequestToChat(a,s),"zoho"!=e&&WmsImplHandler.invoke(WmsContactImpl.handleMPAdd,e,t,i))},WmsContacts.reinvite=function(e,t,i,a){if(0!=t.trim()){var s="emailid="+t;$WC.Ajax.postRequest("reinvitebyemailid.sas",s),WmsContacts.addinobj(e,i,a),"zoho"!=e&&WmsImplHandler.invoke(WmsContactImpl.handleMPAdd,e,i,a)}},WmsContacts.updatepresence=function(e,t,i,a){WmsContacts.contactslist[e]={},WmsContacts.contactslist[e].STATUS=t,WmsContacts.contactslist[e].STATUSMSG=i,WmsContacts.contactslist[e].OWNERID=a,WmsContacts.contactslist[e].USERID=e,WmsContacts.lastupdatetime=(new Date).getTime()},WmsContacts.rename=function(e,t,i){WmsContacts.contactslist[e].DNAME=t,WmsContacts.zohocontacts[e].DNAME=t;var a="";try{void 0!=WmsContacts.getEmailId(e)&&(a=WmsContacts.getEmailId(e))}catch(s){}var n="userid="+e+"&email="+encodeURIComponent(a)+"&dname="+encodeURIComponent(t);$WC.Ajax.postRequestToChat("rencont.do",n,"",i)},WmsContacts.renamecontId=function(e,t,i){WmsContacts.contactslist[t].DNAME=i,WmsContacts.zohocontacts[t].DNAME=i;var a="contid="+e+"&dname="+encodeURIComponent(i);$WC.Ajax.postRequestToChat("rencontid.do",a)},WmsContacts.remove=function(e,t,i){var a,s;"zoho"==e?(a="deletecontact.do",s="emailid="+encodeURIComponent(WmsContacts.getEmailId(t))+"&userid="+t):(a="mpcontact.do",s="zohoid="+WebMessanger.getUserName()+"&mploginid="+i+"&contactid="+t+"&opr=removecon"),$WC.Ajax.postRequestToChat(a,s),WmsContacts.removefromobj(e,t,i),"zoho"!=e&&WmsImplHandler.invoke(WmsContactImpl.handleMPDelete,e,t,i)},WmsContacts.get=function(e,t){return WmsContacts.contactslist&&WmsContacts.contactslist[e]?WmsContacts.contactslist[e]:t&&WmsOrgContacts.contactslist&&WmsOrgContacts.contactslist[e]?WmsOrgContacts.contactslist[e]:void 0},WmsContacts.getDisplayName=function(e){try{return WmsContacts.contactslist[e]?WmsContacts.contactslist[e].DNAME:WmsOrgContacts.contactslist[e]?WmsOrgContacts.contactslist[e].DNAME:null}catch(t){return null}},WmsContacts.updateUserStatus=function(e,t,i,a){WmsContacts.contactslist[e]&&WmsContacts.contactslist[e].STATUS>=0&&WmsContacts.contactslist[e].STATUS<=4?(WmsContacts.contactslist[e].STATUS!==t||WmsContacts.contactslist[e].STYPE!==i||WmsContacts.contactslist[e].STATUSMSG!==a)&&(WmsContacts.contactslist[e].STATUS=t,WmsContacts.contactslist[e].STYPE=i,WmsContacts.contactslist[e].STATUSMSG=a,WmsHybridSearch.updatePresence(e),WmsMainUI.updateChatHTML(e)):WmsOrgContacts.contactslist[e]&&(WmsOrgContacts.contactslist[e].STATUS!==t||WmsOrgContacts.contactslist[e].STYPE!==i||WmsOrgContacts.contactslist[e].STATUSMSG!==a)&&(WmsOrgContacts.contactslist[e].STATUS=t,WmsOrgContacts.contactslist[e].STYPE=i,WmsOrgContacts.contactslist[e].STATUSMSG=a,WmsMainUI.updateChatHTML(e))},WmsContacts.handleInviteOperation=function(e){var t=e.getAttribute("data-operation"),i=e.getAttribute("data-id"),a=e.getAttribute("data-dname");if(null===i&&null===a&&(i=e.parentNode.getAttribute("data-id"),a=e.parentNode.getAttribute("data-dname")),"accept"===t?(WmsContacts.accept("zoho",i,$WC.$CUtil.getConfig("zuid")),$WC.$CUtil.removeElementFromArray(WmsContacts.pendinginvcontactslist,i)):"reject"===t?WmsContacts.remindMeLater(i):"addcontact"===t&&(i?WMSUI.inviteMember(i,a):(WMSUI.inviteMember(a,a),WmsMainUI.resetToDefaultUI())),document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat(),"undefined"!=typeof WmsMainUI){var s={};s.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,s)}},WmsContacts.accept=function(e,t,i){var a,s;0!=t.trim()&&("zoho"==e?(a="approvecontact.do",s="status=accept&userid="+t):(a="mpcontact.do",s="zohoid="+WebMessanger.getUserName()+"&mploginid="+i+"&contactid="+t+"&opr=acceptcon"),$WC.Ajax.postRequestToChat(a,s),"zoho"!=e&&WmsImplHandler.invoke(WmsContactImpl.handleMPAccept,e,t,i))},WmsContacts.reject=function(e,t,i){var a,s;0!=t.trim()&&("zoho"==e?(a="approvecontact.do",s="status=reject&userid="+t):(a="mpcontact.do",s="zohoid="+WebMessanger.getUserName()+"&mploginid="+i+"&contactid="+t+"&opr=rejectcon"),$WC.Ajax.postRequestToChat(a,s),"zoho"!=e&&WmsImplHandler.invoke(WmsContactImpl.handleMPReject,e,t,i))},WmsContacts.remindMeLater=function(e){var t="approvecontact.do",i="status=remindmelater&userid="+e;$WC.Ajax.postRequestToChat(t,i)},WmsContacts.isMPUser=function(e){return-1!=e.indexOf("|")},WmsContacts.getMPName=function(e){if(!WmsContacts.isMPUser(e))return"zoho";var t=e.indexOf("@")+1;return e.substring(t,e.indexOf(".",t))},WmsContacts.getEmailId=function(e){return WmsContacts.contactslist[e]?WmsContacts.contactslist[e].EMAILID:WmsOrgContacts.contactslist[e]?WmsOrgContacts.contactslist[e].EMAILID:null},WmsContacts.getMPDispName=function(e){try{return WmsContacts.isMPUser(e)?e.indexOf("|")!=e.lastIndexOf("|")?e.substring(e.indexOf("|")+1,e.lastIndexOf("|")):e.substring(e.indexOf("|")+1,e.length):e}catch(t){return null}},WmsContacts.getMPLoginName=function(e){return WmsContacts.isMPUser(e)?e.substring(0,e.indexOf("|")):e},WmsContacts.verifyUserStatus=function(e){for(var t=!1,i=0;i<e.length;i++){var a=e[i],s=a.uname,n=a.scode,r=a.zuid;if(0!=r.trim().length)try{var o=WmsContacts.status(s);o!==!1&&n!=o&&o>=0&&WebMessanger.verifyUserStatus(a.zuid,WmsContacts.contactslist[s].STATUS)}catch(l){}}t&&WMSUI.updateContacts(!1)},WmsContacts.updateAddressBook=function(e){try{var t=new Array;for(var i in e){var a={},s=void 0!=e[i].scode?e[i].scode:0,n=void 0==e[i].smsg?"":e[i].smsg,r=e[i].uname;WmsContacts.contactslist.hasOwnProperty(r)===!1&&(WmsContacts.contactslist[r]={},a.STATUS=s,WmsContacts.contactslist[r].STATUS=s,a.STATUSMSG=n,WmsContacts.contactslist[r].STATUSMSG=n),a.OWNERID=WmsContacts.getMPLoginName(e[i].uname),WmsContacts.contactslist[r].OWNERID=a.OWNERID,a.USERID=e[i].uname,WmsContacts.contactslist[r].USERID=a.USERID,void 0!=e[i].dname&&""!=e[i].dname&&(a.DNAME=e[i].dname,WmsContacts.contactslist[r].DNAME=a.DNAME),a.EMAILID=WmsContacts.getMPDispName(r),WmsContacts.contactslist[r].EMAILID=a.EMAILID,a.PROTOCOL=e[i].protocol,WmsContacts.contactslist[r].PROTOCOL=a.PROTOCOL,t.push(a)}WmsImplHandler.invoke(WmsContactImpl.handleBulkPresence,a.PROTOCOL,t),WmsContacts.lastupdatetime=(new Date).getTime(),WmsImplHandler.invoke(WmsContactImpl.handleAddressBook)}catch(o){}},WmsContacts.updatempscontactinfo=function(e){try{for(var t in e){var i=e[t],a=i.uname;void 0!=i.dname&&(WmsContacts.contactslist[a].DNAME=i.dname),void 0!=i.photo&&(WmsContacts.contactslist[a].PHOTO=i.photo)}}catch(s){}},WmsMPAccounts.accountstatus=function(){},WmsMPAccounts.accountstatus.LOGGEDIN=1,WmsMPAccounts.accountstatus.LOGGEDOUT=0,WmsMPAccounts.accountstatus.LOGINERROR=-1,WmsMPAccounts.add=function(e,t,i,a,s){var n="username="+e+"&password="+t+"&startup="+a+"&protocol="+s+"&status="+i;$WC.Ajax.postRequest("/addmps.do",n)},WmsMPAccounts.del=function(e){$WC.Ajax.postRequestToChat("delmps.do","username="+e),setTimeout(function(){WmsMPAccounts.get()},2e3)},WmsMPAccounts.get=function(){$WC.Ajax.requestToChat("getmps.do")},WmsMPAccounts.getandlogin=function(){$WC.Ajax.requestToChat("getmps.do","autologin=true")},WmsMPAccounts.login=function(e,t,i,a){var s="username="+e+"&password="+t+"&protocol="+i+"&mailnotification=false";$WC.Ajax.postRequestToChat("mpslogin.do",s),a&&(WmsMPAccounts.add(e,t,1,1,i),setTimeout(function(){WmsMPAccounts.get()},2e3))},WmsMPAccounts.loginstartup=function(){$WC.Ajax.requestToChat("mpsautologin.do")},WmsMPAccounts.logout=function(e){$WC.Ajax.postRequestToChat("mpslogout.do","?username="+e)},WmsMPAccounts.logoutall=function(){$WC.Ajax.postRequestToChat("mpslogoutall.do")},WmsMPAccounts.init=function(){WmsMPAccounts.accounts={}},WmsMPAccounts.updateobj=function(e,t,i,a,s,n){var r=e+a;try{WmsMPAccounts.accounts[r].LOGINID.trim()}catch(o){WmsMPAccounts.accounts[r]={}}WmsMPAccounts.accounts[r].LOGINID=e,WmsMPAccounts.accounts[r].STATUS=t,WmsMPAccounts.accounts[r].STATUSMSG=i,WmsMPAccounts.accounts[r].PROTOCOL=a,void 0==WmsMPAccounts.accounts[r].MOREINFO&&(WmsMPAccounts.accounts[r].MOREINFO={}),WmsMPAccounts.accounts[r].MOREINFO.MAILNOTIFICATION=n,WmsMPAccounts.accounts[r].UENTERID=""!=s?s:e,WmsMPAccounts.accounts[r].LASTLOGINTIME=(new Date).getTime()},WmsMPAccounts.getaccounts=function(){return WmsMPAccounts.accounts},WmsMPAccounts.updateaccountslist=function(e){var t=new Array;try{for(var i=e.MPSAccounts,a=i.length,s=0;a>s;s++)t[s]=i[s].USERNAME}catch(n){}WmsImplHandler.invoke(WmsContactImpl.handleGetAccounts,t)},WmsMPAccounts.removefromobj=function(e){WmsMPAccounts.accounts.splice(e,1)},WmsContacts.getBotPhoto=function(e){var t=WmsContacts.get(e);return t&&t.ISBOT?t.PHOTO:"/"+_WMSCONT+"/images/bot-default.png"},WmsContacts.getUserPhoto=function(e,t){var i=WmsContacts.get(e);if($WC.$CUtil.isEmptyString(e)||"null"==e||WmsContacts.isAnnonUser(e))return"/"+_WMSCONT+"/images/bar/contactphoto.gif";if(i&&i.ISBOT)return WmsContacts.getBotPhoto(e);var a=t||"50";return $WC.$CUtil.getConfig("photoserver")+"/file?ID="+e+"&t=user&height="+a+"&width="+a+"&exp=360000"},WmsContacts.getGroupLogo=function(e){return $WC.$CUtil.getConfig("photoserver")+"/file?ID="+e+"&t=group&height=50&width=50"},WmsContacts.getMPUserPhoto=function(e){var t=WmsContacts.contactslist[e].PHOTO;return void 0!=t&&""!=t?_WMSCHATURL+"mpimg.do?url="+t:"/"+_WMSCONT+"/images/bar/contactphoto.gif"},WmsContacts.getSortedContacts=function(e,t,i,a){var s=[];i=i||WmsContacts.contactslist;for(var n in i)i[n][e]&&s.push(i[n]);return s.sort("UC"===e?$WC.$CUtil.sortBy(e,t,function(e){return parseInt(e,10)}):$WC.$CUtil.sortBy(e,t,function(e){return e.toLowerCase()})),s.slice(0,a)},WmsContacts.isInvitedContact=function(e){var t=WmsContacts.get(e);return t&&t.STATUS==WmsConstants.CONTACTSTATUS.REQACC?!0:!1},WmsContacts.isInvitationPending=function(e){var t=WmsContacts.get(e);return t&&t.STATUS==WmsConstants.CONTACTSTATUS.NOCHAT?!0:!1},WmsContacts.removeInvitations=function(){WmsContacts.invitedcontactslist=[],WmsContacts.pendinginvcontactslist=[]},WmsContacts.isAnnonUser=function(e){return e&&"$"===e.charAt(0)},WmsContacts.lastfetchedtime=0;var WmsChats={list:{},reqcache:[]};WmsChats.updateList=function(e){var t=JSON.parse(e).data,i=t&&t.chats;if(i&&i.length)for(var a=0;a<i.length;){var s={};s.ADDINFO=i[a].addinfo,s.CHATID=i[a].chatid,s.LASTMSGINFO=i[a].lastmsginfo&&JSON.parse(i[a].lastmsginfo),s.PARTICIPANTS=i[a].recipants&&JSON.parse(i[a].recipants)||[],s.PARTICIPANTSCOUNT=i[a].pcount,s.LMTIME=i[a].lmtime,s.TITLE=i[a].title,WmsChats.list[i[a].chatid]=s,a++}this.opts.callbackargs&&this.opts.callbackargs.params&&WmsChats.reqcache.push(this.opts.callbackargs.params);var n=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/chatlist/updateui",{reqid:n})},WmsChats.handleFailure=function(){var e=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/chatlist/updateui",{reqid:e,stat:WmsConstants.REQSTATUS.FAILED})},WmsChats.getList=function(e){return e?WmsHybridSearch.filter("TITLE",e,WmsChats.list):WmsChats.list},WmsChats.isCachedRequest=function(e){return-1!==WmsChats.reqcache.indexOf(WmsChats._constructParams(e))},WmsChats._constructParams=function(e){var t="limit=10";return t+=e?"&title="+e:""},WmsChats.fetchFromServer=function(e,t){var i=WmsChats._constructParams(e);if(-1===WmsChats.reqcache.indexOf(i)){var a={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()};$WC.Ajax.requestToChat("v1/chats",i,WmsChats.updateList,WmsChats.handleFailure,{reqid:t,params:i},null,a)}else $WC.$CUtil.pubsub.publish("/chatlist/updateui",{reqid:t})};var $WC=$WC||{};$WC.DataObject={},$WC.DataObject.construct=function(){this.tableToRowList={},this.tableArray=new Array(0),this.getRowsForTable=$WC.DataObject.getRowsForTable,this.containsTable=$WC.DataObject.containsTable,this.addNewTable=$WC.DataObject.addNewTable,this.addRowsForTable=$WC.DataObject.addRowsForTable},$WC.DataObject.containsTable=function(e){for(var t=this.tableArray.length,i=0;t>i;i++)if(this.tableArray[i]==e)return!0;return!1},$WC.DataObject.getRowsForTable=function(e){return this.tableToRowList[e]},$WC.DataObject.addNewTable=function(e){this.tableArray.push(e),this.tableToRowList[e]=new Array(0)},$WC.DataObject.addRowsForTable=function(e,t){this.containsTable(e)||this.addNewTable(e);var i=this.tableToRowList[e];return i[i.length]=$WC.DataObject.createRow(t),!0},$WC.DataObject.createRow=function(e){for(var t={},i=0;i<e.length;i++)t[e[i][0]]=e[i][1];return t},WmsGroups.init=function(){WmsGroups.grouplist={},WmsGroups.decodedgrouplist={},WmsGroups.lastupdatetime=0,WmsGroups.interval=18e5},WmsGroups.getZohoGroups=function(){return WmsGroups.grouplist},WmsGroups.fetchzohogroups=function(){$WC.Ajax.postRequest("getgroups.sas")},WmsGroups.updategrouplist=function(e){for(var t in e){var i=e[t];WmsGroups.grouplist[t]={ID:t,NAME:i.NAME,OWNER:i.OWNER,MODERATOR:i.MODERATOR,DESC:i.DESC},WmsGroups.decodedgrouplist[t]={ID:t,NAME:ClientDecoder.getDecodedValue(i.NAME),OWNER:i.OWNER,MODERATOR:i.MODERATOR,DESC:ClientDecoder.getDecodedValue(i.DESC)}}WmsGroups.lastupdatetime=(new Date).getTime(),$WC.$CUtil.pubsub.publish("/groups/updateui"),WmsGroupImpl.handleGetGroups()},WmsGroups.updategroupUI=function(){for(var e=0;e<WindowHandler.exist.length;e++)if("empty"!==WindowHandler.exist[e]&&(WindowHandler.exist[e].partcount>2||WindowHandler.exist[e].isZohoGroupChat())&&"block"===WindowHandler.exist[e].membersdispnode.style.display){var t=WindowHandler.exist[e].getGroupID(),i=WmsGroups.grouplist[t];if(i&&(parseInt(i.OWNER)||parseInt(i.MODERATOR)))for(var a=WindowHandler.exist[e].membersdispnode.querySelectorAll('[data-memdel="true"]'),s=0;s<a.length;s++)a[s].className="wms-delmemshow"}},WmsGroups.fetchingStatus=function(){if(void 0==WmsGroups.lastupdatetime||null==WmsGroups.lastupdatetime||0==WmsGroups.lastupdatetime)return!0;if(WmsGroups.lastupdatetime>0){var e=(new Date).getTime();if(e-WmsGroups.lastupdatetime>WmsGroups.interval)return!0}return!1};var WmsBadgeImage={};WmsBadgeImage.getStatusHtml=function(e,t){var i=WmsBadgeImage.getStatusClass(e,t),a="";return i&&(a='<div class="wms-img-badge '+i+'"></div>'),a},WmsBadgeImage.createUserImageHtml=function(e,t){var i='<div class="wms-img-cont">';return i+=t?'<img class="wms-hysearch-result-img" src="'+t+'">':'<img class="wms-hysearch-result-img" src="'+WmsContacts.getUserPhoto(e)+'">',i+=WmsBadgeImage.getStatusHtml(e,!1)+"</div>"},WmsBadgeImage.getStatusClass=function(e,t){var i=WmsContacts.status(e),a="";return i!==!1&&(i=+i,i===WmsContacts.userstatus.ONLINE?a=t?"wms-status-online":"wms-pos-online":i===WmsContacts.userstatus.BUSY?a=t?"wms-status-busy":"wms-pos-busy":i===WmsContacts.userstatus.IDLE?a=t?"wms-status-idle":"wms-pos-idle":i===WmsContacts.userstatus.OFFLINE&&(a=t?"wms-status-offline":"wms-pos-offline"),a&&parseInt(WmsContacts.getStatusType(e),10)===WmsContacts.userstatus.MOB_LOGIN?a+="-mobile":-1!==e.indexOf("b-")&&(a="wms-pos-bot")),a};var WmsChannels={list:{},reqcache:[],last_fetched_time:null,team_memberslist:{},sync:!1,get_channels_onfocus:!1};WmsChannels.insertTeamMemberslist=function(e,t){WmsChannels.team_memberslist[e]||(WmsChannels.team_memberslist[e]=t)},WmsChannels.getTeamChannelMembers=function(e){var t=WmsChannels.get(e),i={};return t.scid.forEach(function(e){if(WmsChannels.team_memberslist[e]){var t=WmsChannels.team_memberslist[e];for(var a in t)i[a]=t[a]}}),i},WmsChannels.getBotId=function(e){for(var t in WmsContacts.contactslist)if(WmsContacts.contactslist[t].ISBOT&&WmsContacts.contactslist[t].CHID===e)return WmsContacts.contactslist[t].USERID},WmsChannels.isSharedChannel=function(e){var t=WmsChannels.get(e);return t&&t.sc===WmsConstants.CHANNELS.SHARED?!0:!1},WmsChannels.isTeamChannel=function(e){var t=WmsChannels.get(e);return t&&t.sc===WmsConstants.CHANNELS.TEAM?!0:!1},WmsChannels.isUserHasPermission=function(e,t){var i=WmsChannels.get(e);if(i&&!$WC.$CUtil.isEmptyObject(i)&&i.permissions){var a=i.currole,s=i.permissions;return a==WmsConstants.USERROLES.SUPER_ADMIN?!0:a==WmsConstants.USERROLES.ADMIN&&0!=(s.adminp&1<<t)?!0:a==WmsConstants.USERROLES.CREATOR&&0!=(s.crp&1<<t)?!0:a==WmsConstants.USERROLES.MODERATOR&&0!=(s.modp&1<<t)?!0:1==i.joined&&0!=(s.partp&1<<t)?!0:!1}return!0},WmsChannels.initChannels=function(){null===WmsChannels.last_fetched_time?("undefined"!=typeof WmsMainUI&&WmsMainUI.updateLoadingForPinnedChats(!0),$WC.Ajax.requestToChat("getchannels.do","pageload=true&mode=joined&limit=50",WmsChannels.updateList,WmsChannels.handleFailure)):(WmsChannels.sync||WmsChannels.last_fetched_time+216e5<(new Date).getTime())&&WmsChannels.syncChannels()},WmsChannels.getChannels=$WC.$CUtil.debounce(function(){(!$WC.$CUtil.getObjectLength(WmsChannels.list)||null===WmsChannels.last_fetched_time||WmsChannels.sync)&&WmsChannels.initChannels()},null,1e3,!0),WmsChannels.getJoinedChannels=function(e){var t=[];for(var i in WmsChannels.list)WmsChannels.list[i].joined&&t.push(WmsChannels.list[i]);return t.sort($WC.$CUtil.sortBy("lmtime",!0)),t.slice(0,e)},WmsChannels.updateChannel=function(e,t,i){"undefined"==typeof WmsChannels.list[e]&&(WmsChannels.list[e]={}),WmsChannels.list[e][t]=i},WmsChannels.updateList=function(e){WmsChannels.last_fetched_time=(new Date).getTime(),WmsChannels.get_channels_onfocus=!1;var t=e.data;setTimeout(function(){$WC.$CUtil.pubsub.publish("/channels/updatelist",$WC.$CUtil.cloneObject(e.data))},1),t&&t.allowed&&t.allowed.forEach(function(e){WmsChannels.list[e.chid]=e,1==e.scid.length&&(WmsChannels.list[e.chid]._teamname=e.scid_name[e.scid[0]])}),t&&t.joined&&t.joined.forEach(function(e){if("1"===e.st&&(WmsChannels.list[e.chid]=e,1==e.scid.length&&(WmsChannels.list[e.chid]._teamname=e.scid_name[e.scid[0]]),WmsChannels.list[e.chid].read&&WmsChannels.list[e.chid].totmsg&&"-1"!=WmsChannels.list[e.chid].read&&(WmsChannels.list[e.chid].unreadmsgs=WmsChannels.list[e.chid].totmsg-WmsChannels.list[e.chid].read),"undefined"!=typeof WindowHandler)){var t=WindowHandler.getWinObjById(e.chid);t&&t.setTitle(WmsChannels.getChannelName(e.chid))}}),"undefined"!=typeof WindowHandler&&WindowHandler.updateChannelProperties(),this.opts.callbackargs&&this.opts.callbackargs.params&&WmsChannels.reqcache.push(this.opts.callbackargs.params);var i=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/channels/updateui",{reqid:i})},WmsChannels.handleFailure=function(){var e=this.opts.callbackargs&&this.opts.callbackargs.reqid;$WC.$CUtil.pubsub.publish("/channels/updateui",{reqid:e,stat:WmsConstants.REQSTATUS.FAILED})},WmsChannels.getList=function(e,t){var i=WmsHybridSearch.filter("cn",e,WmsChannels.list,null,null,null,"_teamname");return t&&(i=i.filter(function(e){return e.joined?!0:void 0})),i},WmsChannels.getListByTeamName=function(e){return WmsHybridSearch.filter("_teamname",e,WmsChannels.list)},WmsChannels.getListByChannelName=function(e){return WmsHybridSearch.filter("cn",e,WmsChannels.list)},WmsChannels.getListByTeam_ChannelName=function(e,t){var i=WmsChannels.getListByTeamName(e);return WmsHybridSearch.filter("cn",t,i)},WmsChannels.isCachedRequest=function(e){return-1!==WmsChannels.reqcache.indexOf(WmsChannels._constructParams(e))},WmsChannels._constructParams=function(e){return"limit=20&search="+encodeURIComponent(e)},WmsChannels.fetchFromServer=function(e,t){var i=WmsChannels._constructParams(e);-1===WmsChannels.reqcache.indexOf(i)?$WC.Ajax.requestToChat("getchannels.do",i,WmsChannels.updateList,WmsChannels.handleFailure,{reqid:t,params:i}):$WC.$CUtil.pubsub.publish("/channels/updateui",{reqid:t})},WmsChannels.getChannelImageHTML=function(e){var t=WmsChannels.get(e);if(t){var i="";t.photoid&&(i='<img src="/'+$WC.$CUtil.getConfig("CHATCONT")+"/channel/"+t.photoid+'/photo.do"></img>');var a,s=t.sc;return"1"===s?a="orgchannel":"2"===s?a="orggroup":"3"===s?a="privatechannel":"4"===s&&(a="shared-channel"),i?'<span class="wms_badge_imgwrapper wms_channelimg_badge wms-'+a+'-small">'+i+"</span>":'<span class="wms_badge_imgwrapper wms_channelimg wms-'+a+'-small">'+i+"</span>"}var n="";return t=WmsRecentChats.get(e),t&&t.TITLE?n=t.TITLE:(t=WmsUnreadChats.chatlist.find(function(t){return t.CHATID==e?!0:void 0}),t&&t.TITLE&&(n=t.TITLE)),'<span class="wms_badge_imgwrapper"><span class="wms_badge_letter">'+WmsHybridSearch.getBadgeLetters(n)+"</span></span>"},WmsChannels.get=function(e){return WmsChannels.list[e]},WmsChannels.isJoinedChannel=function(e){var t=WmsChannels.get(e);return t&&t.joined&&1==t.joined?!0:!1},WmsChannels.getChannelName=function(e){var t=WmsChannels.get(e);if(t){var i=t.dn;return i||(i=t.cn,t._teamname&&(i=i+"@"+t._teamname)),i}},WmsChannels.updateModifiedData=function(){WmsChannels.last_fetched_time=(new Date).getTime(),WmsChannels.get_channels_onfocus=!1,WmsChannels.sync=!1;var e=JSON.parse(this.response)[0].objString;if("clearchanneldb"===this.getResponseHeader("x-zcoperation"))WmsChannels.last_fetched_time=null,WmsChannels.initChannels();else if(e.leftchanneluids||e.deletedchanneluids){var t=e.leftchanneluids||e.deletedchanneluids;for(var i in t){var a=WmsChannels.getChannelByOC_id(i)[0],s=a&&a.chid;delete WmsChannels.list[s]}}else{if(e.newjoinedchannels){var n=e.newjoinedchannels;for(var r in n){var o=n[r].chid;WmsChannels.list[o]=n[r]}}if(e.groupsnamemodified){var l=e.groupsnamemodified,c=WmsHybridSearch.filter("sc",WmsConstants.CHANNELS.TEAM,WmsChannels.list);for(var d in l)c.forEach(function(e){if(-1!==e.scid.indexOf(d)){var t=l[d];e._teamname&&(e._teamname=t),e.scid_name[d]=t}})}if(e.channelidvsdatamodified){var u=e.channelidvsdatamodified;for(var m in u){var p=WmsChannels.getChannelByOC_id(m)[0];if(p){var h=u[m];for(var g in h)p[g]=h[g]}}}}$WC.$CUtil.pubsub.publish("/channels/updateui",{})},WmsChannels.syncChannels=function(){var e="lastsynctime="+WmsChannels.last_fetched_time;$WC.Ajax.requestToChat("synchannels.do",e,WmsChannels.updateModifiedData)},WmsChannels.getChannelByOC_id=function(e){return WmsHybridSearch.filter("oc_id",e,WmsChannels.list)},window.WmsConstants={CHATCFPARAMNAME:"zchat_csrparam",WMSCFPARAMNAME:"wms_csrparam",CHATCFCOOKIENAME:"CT_CSRF_TOKEN",WMSCFCOOKIENAME:"WMS_CSRF_TOKEN",REQSTATUS:{LOADING:1,SUCCESS:2,FAILED:3,NORESULTS:4,INITIALSTATE:5},KEYCODES:{BACKSPACE:8,TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40,ESCAPE:27,ENTER:13,SPACE:32},TRIGGERS:{ADDMEM:"+",DELMEM:"-",ATMENTION:"@",SMILEY:":",SLASH:"/"},CONTACTSTATUS:{UNAPRD:-1,REJECT:-2,REQACC:-3,DELETE:-4,REMOVE:-5,NOCHAT:-6,ACCEPT:10},USERPERMISSIONS:{ADD_MEMBER:6,REMOVE_MEMBER:7,SEND_MESSAGE:8,MENTION_USERS:9},USERROLES:{SUPER_ADMIN:0,ADMIN:1,CREATOR:2,MODERATOR:3,PARTICIPANT:4,ALLOWED_USER:5,NONE:-1},CHANNELS:{ORG:"1",TEAM:"2",PRIVATE:"3",SHARED:"4"}};var WmsHybridSearch=function(){};WmsHybridSearch.constants={CHANNEL:1,CHAT:2,CONTACT:3,DEFAULTRESULT:4,EMPTY:5,FREQCONTACTS:6,GENERICLIST:7,GROUP:8,MESSAGEHINT:9,ORGCONTACT:10,TITLEHINT:11,USERLIST:12,EMPTYUSERHINT:13,EMPTYTITLEHINT:14,EMPTYMSGHINT:15,ADDCONTACT:16,USER_CHANNELLIST:17,CHANNELLIST:18,BOT:19},WmsHybridSearch.constants.modules={CONTACTMENU:1,GROUPMENU:2,CHATMENU:3,SMARTCHAT:4,FILEFWD:5},WmsHybridSearch.tempmsgdetails=[],WmsHybridSearch.hintindex=0,WmsHybridSearch.getCurrentModule=function(){var e=document.getElementById("wms-hysearch"),t=document.getElementById("wms-filefrwrdautocomplete");if(e)return WmsHybridSearch.constants.modules.SMARTCHAT;if(t)return WmsHybridSearch.constants.modules.FILEFWD;var i=document.getElementById("wms_menu_listcontainer");if(i){var a=i.querySelector("[data-selected=true]");if(a){var s=a.getAttribute("data-menuname");if("contact"===s)return WmsHybridSearch.constants.modules.CONTACTMENU;if("channel"===s)return WmsHybridSearch.constants.modules.GROUPMENU;if("chat"===s)return WmsHybridSearch.constants.modules.CHATMENU}}},WmsHybridSearch.getNode=function(e,t){var i,a={inputdiv:"wms_menu_search",resultcontainer:"wms_menu_contactlist",defaultresultdiv:"wms_menu_contactlist_def",searchresultdiv:"wms_menu_contactlist_searchres",inputcontainer:"wms_menu_search",loadingstatus:"wms-contact-loadstatus"},s={inputdiv:"wms_menu_search",resultcontainer:"wms_menu_grouplist",defaultresultdiv:"wms_menu_grouplist_def",searchresultdiv:"wms_menu_grouplist_searchres",inputcontainer:"wms_menu_search",loadingstatus:"wms-channel-loadstatus"},n={inputdiv:"wms_menu_search",resultcontainer:"wms_menu_chatlist",defaultresultdiv:"wms_menu_chatlist_def",searchresultdiv:"wms_menu_chatlist_searchres",recentchatdiv:"wms_menu_chatlist_def",recentchatsdiv:"wms_menu_chatlist_recentchats",inputcontainer:"wms_menu_search",loadingstatus:"wms-chat-loadstatus",recentchatswelcomemsg:"wms_welcome_recentchatsmsg"},r={mainUI:"wms-hysearch",inputcontainer:"wms-hysearch-inpcontainer",inputdiv:"wms-hysearch-actualinp",defaultresultdiv:"wms-hysearch-defrescont",freqcontactsdiv:"wms-hysearch-fcontacts",infomsgdiv:"wms-hysearch-infomsg",loadingstatus:"wms-hysearch-loadstatus",recentchatsdiv:"wms-hysearch-rchats",resultcontainer:"wms-hysearch-rescont",searchresultdiv:"wms-hysearch-searchres",thirdcolumn:"wms-hysearch-thirdcol",thirdcolumnheading:"wms-hysearch-thirdcolheading",fakeinput:"wms-fakeinput"},o={searchresultdiv:"wms-filefrwrdautocomplete",inputcontainer:"wms-filefrwrdrecipant",inputdiv:"wms-filefrwrdrecipant",loadingstatus:"wms-filefwd-loadstatus"};return t=t||WmsHybridSearch.getCurrentModule(),i=t===WmsHybridSearch.constants.modules.SMARTCHAT?r:t===WmsHybridSearch.constants.modules.CONTACTMENU?a:t===WmsHybridSearch.constants.modules.GROUPMENU?s:t===WmsHybridSearch.constants.modules.CHATMENU?n:t===WmsHybridSearch.constants.modules.FILEFWD?o:r,document.getElementById(i[e])},WmsHybridSearch.showUI=function(){$WC.$CUtil.createOverlay(WmsHybridSearch.hideUI),WmsHybridSearch.resshowntext="";var e=document.createElement("div");e.id="wms-hysearch",WmsHybridSearch.keydownlistener=$WC.$CUtil.addEvent(e,"keydown",WmsHybridSearch.handleKeyDown,!1),WmsHybridSearch.keyuplistener=$WC.$CUtil.addEvent(e,"keyup",WmsHybridSearch.handleEvent,!1),e.className="wms-hysearch wms-hvalign",e.style.zIndex=$WC.$CUtil.getConfig("zindex"),e.innerHTML=$WC.template.replace('<div class="wms-hysearch-toppart"><div class="wms-hysearch-searchiconcont"><div class="wms_searchicon wms-hysearch-searchicon"></div></div><div id="wms-hysearch-inpcontainer" class="wms-hysearch-inpcontainer"><input id="wms-hysearch-actualinp" data-selectable="true" data-selected="true" required></input><input style="width:0px;opacity:0" id="wms-fakeinput"><label id="wms-hysearch-placeholder" class="wms-hysearch-placeholder" onclick="WmsHybridSearch.focusInput()"></label></div><div class="wms-hysearch-closeicon" onclick="WmsHybridSearch.hideUI()"></div></div><div id="wms-hysearch-rescont" ><div id="wms-hysearch-defrescont" class="wms-hysearch-rescont"></div><div id="wms-hysearch-searchres" class="wms-hysearch-searchres"></div></div>',{}),document.body.appendChild(e);var t=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div class="wms-hysearch-resheading">'+$WC.$CUtil.getConfig("Resource").getRealValue("menuname.chats")+'</div><div id="wms-hysearch-rchats" data-resset="true" class="wms-hysearch-resset"></div></div>',{}),i=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div class="wms-hysearch-resheading">'+$WC.$CUtil.getConfig("Resource").getRealValue("Contacts")+'</div><div id="wms-hysearch-fcontacts" data-resset="true" class="wms-hysearch-resset"></div></div>',{}),a=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div id="wms-hysearch-thirdcolheading" style="visibility:hidden" class="wms-hysearch-resheading">'+$WC.$CUtil.getConfig("Resource").getRealValue("Contacts")+'</div><div id="wms-hysearch-thirdcol" data-resset="true" class="wms-hysearch-resset"><center><img src="/'+_WMSCONT+'/images/loading1.gif"></center></div></div>',{}),s=document.getElementById("wms-hysearch-defrescont");s.insertAdjacentHTML("beforeend",t),"disable"!=$WC.$CUtil.getConfig("contacts")&&s.insertAdjacentHTML("beforeend",i),$WC.$CUtil.getConfig("isOrgUser")()&&"disable"!=$WC.$CUtil.getConfig("channels")&&s.insertAdjacentHTML("beforeend",a),WmsHybridSearch.showRotationalHint(),$WC.$CUtil.addEvent(WmsHybridSearch.getNode("inputcontainer"),"click",WmsHybridSearch.focusInput),$WC.$CUtil.addEvent(WmsHybridSearch.getNode("recentchatsdiv"),"scroll",$WC.$CUtil.debounce(WmsHybridSearch.checkScrollAndloadMoreChatlist,null,300)),WmsHybridSearch.populateRecentChatsInSmartChat(),"disable"!=$WC.$CUtil.getConfig("contacts")&&($WC.$CUtil.addEvent(WmsHybridSearch.getNode("freqcontactsdiv"),"scroll",$WC.$CUtil.loadImageWithDebounce(WmsHybridSearch.getNode("freqcontactsdiv"))),$WC.$CUtil.addEvent(WmsHybridSearch.getNode("freqcontactsdiv"),"click",function(e){var t=e.target.closest("[data-id]");e.target.getAttribute("data-operation")?WmsContacts.handleInviteOperation(e.target):t&&WmsHybridSearch.handleSelection(t)}),WmsHybridSearch.populateFrequentContactsInSmartChat(),setTimeout(function(){$WC.$CUtil.loadOriginalImage(WmsHybridSearch.getNode("freqcontactsdiv"))},300)),$WC.$CUtil.getConfig("isOrgUser")()&&"disable"!=$WC.$CUtil.getConfig("channels")&&(WmsChannels.initChannels(),WmsHybridSearch.populateThirdColumnInSmartChat()),WmsHybridSearch.focusInput()},WmsHybridSearch.populateThirdColumnInSmartChat=function(){$WC.$CUtil.getConfig("isRegistered")()&&$WC.$CUtil.getConfig("isOrgUser")()&&"disable"!=$WC.$CUtil.getConfig("channels")&&WmsHybridSearch.populateActiveChannels()},WmsHybridSearch.updateLoadingStatus=function(e,t,i,a,s){var n={chat:{},search:{}};n.search[WmsConstants.REQSTATUS.NORESULTS]=$WC.$CUtil.getConfig("Resource").getRealValue("search.noresult"),n.search[WmsConstants.REQSTATUS.FAILED]=$WC.$CUtil.getConfig("Resource").getRealValue("search.failed"),n.chat[WmsConstants.REQSTATUS.NORESULTS]=$WC.$CUtil.getConfig("Resource").getRealValue("chat.noresult"),n.chat[WmsConstants.REQSTATUS.FAILED]=$WC.$CUtil.getConfig("Resource").getRealValue("chat.retrievefailed");var r=e?e.getElementsByClassName("wms-hysearch-loadstatus")[0]:"";r&&(r.onclick=null);var o="",l="";s=s||WmsHybridSearch.getCurrentModule();var c="wms-hysearch-loadstatus";if(s===WmsHybridSearch.constants.modules.FILEFWD?c="wms-filefwd-loadstatus":s===WmsHybridSearch.constants.modules.CHATMENU?c="wms-chat-loadstatus":s===WmsHybridSearch.constants.modules.CONTACTMENU?c="wms-contact-loadstatus":s===WmsHybridSearch.constants.modules.GROUPMENU&&(c="wms-channel-loadstatus"),t===WmsConstants.REQSTATUS.SUCCESS)return void $WC.$CUtil.removeElement(r);if(t===WmsConstants.REQSTATUS.NORESULTS)if("chat"===i&&s===WmsHybridSearch.constants.modules.CHATMENU)if(WmsRecentChats.chatlist.length)o='<div class="wms-hysearch-infotxt wms-hvalign">'+n[i][WmsConstants.REQSTATUS.NORESULTS]+"</div>";else{var d=WmsHybridSearch.getNode("recentchatswelcomemsg",s);$WC.$CUtil.removeElement(d),l='<div id="wms_welcome_recentchatsmsg"><div class="wms-welcome-img wms-welcome-recentchatsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+$WC.$CUtil.getConfig("Resource").getRealValue("recentchats.welcomemessage",['<span data-menuredirect="contact">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.contact")+"</span>",'<span data-menuredirect="channel">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.channel")+"</span>"])+"</div></div></div>"}else!r&&e&&"wms-hysearch-rchats"===e.id&&s===WmsHybridSearch.constants.modules.SMARTCHAT&&"chat"===i?(e.getElementsByClassName("wms-hysearch-infotxt")[0]&&$WC.$CUtil.removeElement(e.getElementsByClassName("wms-hysearch-infotxt")[0]),l='<span id="'+c+'" class="wms-hysearch-infotxt">'+n[i][WmsConstants.REQSTATUS.NORESULTS]+"</span>"):o='<div class="wms-hysearch-infotxt wms-hvalign">'+n[i][WmsConstants.REQSTATUS.NORESULTS]+"</div>";else if(t===WmsConstants.REQSTATUS.LOADING)o='<img class="wms-hvalign" src="/'+_WMSCONT+'/images/loading1.gif">';else if(t===WmsConstants.REQSTATUS.FAILED){if("chat"==i&&!WmsRecentChats.chatlist.length&&s===WmsHybridSearch.constants.modules.CHATMENU){var d=WmsHybridSearch.getNode("recentchatswelcomemsg",s);$WC.$CUtil.removeElement(d)}l='<div id="'+c+'" class="wms-hysearch-loadstatus" data-retry="true" onclick="WmsHybridSearch.handleClick(this)" data-type="'+WmsConstants.REQSTATUS.FAILED+'" onmouseenter="WmsHybridSearch.changeHover(this)"><div class="wms-hysearch-infotxt wms-hvalign">'+n[i][WmsConstants.REQSTATUS.FAILED]+"</div></div>"}l=l||'<div id="'+c+'" class="wms-hysearch-loadstatus wms-nonselectable" data-type="'+t+'">'+o+"</div>",r?r.outerHTML=l:e&&e.insertAdjacentHTML("beforeend",l),t===WmsConstants.REQSTATUS.FAILED&&(WmsHybridSearch.getNode("loadingstatus").onclick=a)},$WC.$CUtil.pubsub.subscribe("/chatlist/updateui",function(e,t){var i=t&&t.reqid;t.stat===WmsConstants.REQSTATUS.FAILED?WmsHybridSearch.updateManager("failureupdate",null,i):WmsHybridSearch.updateManager("update",null,i)}),$WC.$CUtil.pubsub.subscribe("/channels/updateui",function(e,t){var i=t&&t.reqid;t.stat===WmsConstants.REQSTATUS.FAILED?WmsHybridSearch.updateManager("failureupdate",null,i):WmsHybridSearch.updateManager("update",null,i),WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT&&(WmsHybridSearch.populateActiveChannels(),WmsHybridSearch.populateRecentChatsInSmartChat());var a=document.getElementById("wmstoolbar")?!0:!1;a&&!WmsHybridSearch.getSearchText()&&WmsHybridSearch.populateRecentChats(null,WmsHybridSearch.constants.modules.CHATMENU),WmsHybridSearch.populateGroupResultInMainUI(),"undefined"!=typeof WmsMainUI&&WmsMainUI.updateLoadingForPinnedChats(!1)}),$WC.$CUtil.pubsub.subscribe("/orgcontacts/updateui",function(e,t){var i=t&&t.reqid;t.stat===WmsConstants.REQSTATUS.FAILED?WmsHybridSearch.updateManager("failureupdate",null,i):WmsHybridSearch.updateManager("update",null,i)}),$WC.$CUtil.pubsub.subscribe("/orgcontacts/suggestionui",function(e,t){var i={};i.suggestions=t.stat===WmsConstants.REQSTATUS.FAILED?"suggestion_req_failed":"show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,i)}),$WC.$CUtil.pubsub.subscribe("/recentchats/updateui",function(e,t){document.getElementById("wms-hysearch")&&WmsHybridSearch.populateRecentChats(t,WmsHybridSearch.constants.modules.SMARTCHAT);var i=document.getElementById("wmstoolbar")?!0:!1;i&&WmsHybridSearch.populateRecentChats(t)}),$WC.$CUtil.pubsub.subscribe("/groups/updateui",function(){WmsHybridSearch.allowgroupsupdate&&WmsHybridSearch.populateGroups(),WmsHybridSearch.populateGroupResultInMainUI()}),WmsHybridSearch.populateSuggestionList=function(e){var t="",i='<div class="wms_menu_subheading" >'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.suggestions")+"</div>";if(e){var a='<span data-retry="true">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.retry")+"</span>",s='<div class="wms-suggestions-failed">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.failed",a)+"</div>";t+=i,t+=s}else if(WmsOrgContacts.checkAndUpdateContactsList(),$WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist)>0){var n=WmsHybridSearch.generateContactResults(null,!0),r=n.map(function(e){return e.USERID}),o=WmsHybridSearch.generateOrgContactResults("","",r,!0);$WC.$CUtil.getObjectLength(o)>0&&(t+=i,t+=WmsHybridSearch.generateHtml(o))}return t},WmsHybridSearch.focusInput=function(){setTimeout(function(){WmsHybridSearch.getNode("inputdiv").focus()},1)},WmsHybridSearch.hideUI=function(){$WC.$CUtil.removeEvent(document,"keydown",WmsHybridSearch.keydownlistener),$WC.$CUtil.removeEvent(document,"keyup",WmsHybridSearch.keyuplistener),$WC.$CUtil.removeOverlay(),$WC.$CUtil.removeElement(WmsHybridSearch.getNode("mainUI")),WmsHybridSearch.hintindex++},WmsHybridSearch.getChosenUsers=function(){return WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']")},WmsHybridSearch.getChosenUsersName=function(){var e=$WC.$CUtil.convertToArray(WmsHybridSearch.getChosenUsers());return e.map(function(e){var t=$WC.$CUtil.getInnerText(e);return t.slice(1)})},WmsHybridSearch.getTitleHint=function(e){e=$WC.$CUtil.safeHTML(e);var t=WmsHybridSearch.getChosenUsersName().map(function(e){return $WC.$CUtil.safeHTML(e)}),i=t.pop(),a=t.join(", ");return i?0===t.length?$WC.$CUtil.getConfig("Resource").getRealValue("chat.topic.singlemember",["<span>"+e+"</span>","<span>"+i+"</span>"]):$WC.$CUtil.getConfig("Resource").getRealValue("chat.topic.multiplemember",["<span>"+e+"</span>","<span>"+a+"</span>","<span>"+i+"</span>"]):0===t.length?$WC.$CUtil.getConfig("Resource").getRealValue("chat.topic.set","<span>"+e+"</span>"):void 0},WmsHybridSearch.createResultFragment=function(e,t,i,a,s,n,r,o,l,c,d){c=c||WmsHybridSearch.getCurrentModule(),n===WmsHybridSearch.constants.CHAT&&$WC.$CUtil.isChannelChid(e)&&!$WC.$CUtil.isBotChid(e)?a=WmsChannels.getChannelImageHTML(e):(n===WmsHybridSearch.constants.CONTACT&&l&&l.ISBOT&&(a=WmsBadgeImage.createUserImageHtml(e,l.PHOTO)),a=a||WmsBadgeImage.createUserImageHtml(e)),i=i||$WC.$CUtil.getConfig("Resource").getRealValue("channel.nodescription"),t=$WC.$CUtil.unescapeHTML(t);var u=s?'<span class="wms-hysearch-deschint">'+$WC.$CUtil.safeHTML(s)+"</span>":"",m=e?"data-id={{id}} ":"";m+=d?"data-oc_id={{oc_id}}":"";var p;return n===WmsHybridSearch.constants.TITLEHINT?(p='<div class="wms-hysearch-result" onclick="WmsHybridSearch.handleClick(this)" data-type="{{type}}"'+m+">"+a+'<div class="wms-hysearch-result-hint wms-truncate-ellipsis">'+WmsHybridSearch.getTitleHint(t)+"</div></div>",$WC.template.replace(p,{id:e,type:n})):n===WmsHybridSearch.constants.MESSAGEHINT?(p='<div class="wms-hysearch-result" onclick="WmsHybridSearch.handleClick(this)" data-type="{{type}}"'+m+">"+a+'<div class="wms-hysearch-result-hint wms-truncate-ellipsis">'+$WC.$CUtil.getConfig("Resource").getRealValue("hint.openchatandsendmessage","<span>"+$WC.$CUtil.safeHTML(t)+"</span>")+"</div></div>",$WC.template.replace(p,{id:e,type:n,name:t})):c===WmsHybridSearch.constants.modules.SMARTCHAT?(p='<div class="wms-hysearch-result" onclick="WmsHybridSearch.handleClick(this)" data-type="{{type}}"'+m+">"+a+'<div class="wms-hysearch-result-name wms-truncate-ellipsis">{{name}}</div><div class="wms-hysearch-result-desc wms-truncate-ellipsis">'+i+"</div>"+u+"</div>",$WC.template.replace(p,{id:e,name:$WC.$CUtil.unescapeHTML(t?t:$WC.$CUtil.getContactName(e,t)),type:n,oc_id:d})):WmsHybridSearch.generateContactHtml(e,t,i,a,n,r,o,l)},WmsHybridSearch.generateContactHtml=function(e,t,i,a,s,n,r,o){var l,c="wms_menu_item",d="",u="",m="",p="",h="",g="",f="",v="",C="",y="",b="";if(n&&MyDate.formatDate(r)!==MyDate.formatDate(n)&&(d='<div class="wms_menu_item_date">'+MyDate.formatDateWithWords(n)+"</div>"),n&&(u='<span class="wms_menu_item_time" title="'+MyDate.formatDateWithWords(n)+'">'+MyDate.formatTime(n)+"</span>"),y='<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{dname}}">{{dname}}</div>',!e&&o&&o.FEEDSID&&(e=o.FEEDSID,y='<div class="wms_menu_item_name" title="{{dname}}">{{dname}}</div>'),m=WmsHybridSearch.generateImageHtml(e,s,o),s===WmsHybridSearch.constants.CHAT){var E=WmsMainUI.getUnreadCount(e);p=E?'<span style="display:block" class="wms_menu_item_count" data-unreadcount=true>'+E+"</span>":'<span class="wms_menu_item_count" data-unreadcount=true></span>'}if("undefined"!=typeof WmsMainUI)var I=WmsMainUI.getMuteStatus(e);return I&&(h=' data-muted="true" '),s===WmsHybridSearch.constants.CHAT&&WmsMainUI.getZuidForPrivateChat(e)&&(g=WmsMainUI.getZuidForPrivateChat(e)),s===WmsHybridSearch.constants.CHAT?f='<div class="wms_menu_item_msg wms-truncate-ellipsis">'+i+"</div>":s===WmsHybridSearch.constants.CONTACT?((WmsContacts.isInvitedContact(e)||WmsContacts.isInvitationPending(e))&&(i=WmsContacts.getEmailId(e),c="wms_menu_item_invitations"),f='<div class="wms_menu_item_msg wms-truncate-ellipsis" data-smsg="true" title="'+i+'">'+i+"</div>"):f='<div class="wms_menu_item_msg wms-truncate-ellipsis" title="'+i+'">'+i+"</div>",(s===WmsHybridSearch.constants.CONTACT||s===WmsHybridSearch.constants.ORGCONTACT)&&(v='<div class="wms_menu_item_profile_icon wms-valign-mid-block" data-zcprofileid="'+e+'"></div>'),s===WmsHybridSearch.constants.CONTACT&&(WmsContacts.isInvitedContact(e)||WmsContacts.isInvitationPending(e))&&(C+='<div class="wms_menu_inv" data-id="{{id}}" data-dname="{{dname}}"><span data-operation="accept" title="'+$WC.$CUtil.getConfig("Resource").getRealValue("Accept")+'" class="wms_menu_invaccept">'+$WC.$CUtil.getConfig("Resource").getRealValue("Accept")+'</span><span>  |  </span><span title="'+$WC.$CUtil.getConfig("Resource").getRealValue("remind.later")+'" data-operation="reject" class="wms_menu_invreject">'+$WC.$CUtil.getConfig("Resource").getRealValue("remind.later")+"</span></div>"),b=d+'<div class="'+c+'" data-id="{{id}}" {{useridforprivatechat}} data-dname="{{dname}}" '+h+' data-type="{{type}}">'+m+y+u+f+C+p+v+"</div>",s===WmsHybridSearch.constants.CHAT&&g&&(g="data-userid="+g),l={id:e,type:s,dname:$WC.$CUtil.unescapeHTML($WC.$CUtil.getContactName(e,t)),useridforprivatechat:g},$WC.template.replace(b,l)},WmsHybridSearch.generateImageHtml=function(e,t,i,a){var s,n=t,r="",o="none";if(n===WmsHybridSearch.constants.CHAT&&($WC.$CUtil.isChannelChid(e)&&!$WC.$CUtil.isBotChid(e)?n=WmsHybridSearch.constants.CHANNEL:!a&&i&&i.PARTICIPANTS&&2==i.PARTICIPANTS.length&&(e=i.PARTICIPANTS[0].zuid===WebMessanger.zuid?i.PARTICIPANTS[1].zuid:i.PARTICIPANTS[0].zuid,i.PHOTO?(e="b-"+i.CHATID.split("-")[2],r='<img data-zcprofileid="'+e+'" src="'+i.PHOTO+'">'):n=-1!==e.indexOf("b-")&&WmsContacts.contactslist[e]?WmsHybridSearch.constants.BOT:WmsHybridSearch.constants.ORGCONTACT,WmsMainUI.setZuidForPrivateChat(i.CHATID,e))),n===WmsHybridSearch.constants.CONTACT||n===WmsHybridSearch.constants.ORGCONTACT||n===WmsHybridSearch.constants.BOT)s=n===WmsHybridSearch.constants.BOT?e?WmsContacts.getBotPhoto(e):"":e?WmsContacts.getUserPhoto(e):"",r=$WC.$CUtil.isImageLazyLoaded(e)?'<img data-zcprofileid="'+e+'" src="'+s+'">':'<div class="wms_menu_item_img wms_contacticon" data-imgid="'+e+'" data-originalsrc="'+s+'"></div>',o=WmsContacts.getStatusClassName(e);else{if(n===WmsHybridSearch.constants.CHANNEL)return WmsChannels.getChannelImageHTML(e);i&&i.FEEDSID?r='<span class="wms_badge_letter"><span class="wms_notifyicon"></span></span>':"string"==typeof i.TITLE&&i.TITLE.length&&(r='<span class="wms_badge_letter">'+WmsHybridSearch.getBadgeLetters(i.TITLE)+"</span>")}return'<span class="wms_badge_imgwrapper wms_badge_statusicon_'+o+'">'+r+"</span>"},WmsHybridSearch.createInnerSearchFragment=function(e,t,i){var a="wms-hysearch-chosentext";"user"===t&&(a+=" wms-hysearch-atmen"),"topic"===t&&(a+=" wms-hysearch-topic");var s='<span data-id="{{id}}" class="{{classname}}" onmouseenter="WmsHybridSearch.showCloseIcon(this)" onmouseleave="WmsHybridSearch.hideCloseIcon(this)" data-selectable="true" data-type={{type}}>{{name}}<span class="wms-hysearch-chosentext-closeicon" onclick="WmsHybridSearch.removeChosenText(event, this)"></span></span>';return $WC.template.replace(s,{id:i,name:e,classname:a,type:t})},WmsHybridSearch.showCloseIcon=function(e){WmsHybridSearch.resetChosenClose(),$WC.$CUtil.addClass(e,"wms-hysearch-chosentext-close")},WmsHybridSearch.hideCloseIcon=function(e){$WC.$CUtil.removeClass(e,"wms-hysearch-chosentext-close")},WmsHybridSearch.resetChosenClose=function(){var e=WmsHybridSearch.getNode("inputcontainer").getElementsByClassName("wms-hysearch-chosentext-close");if(e.length){e=$WC.$CUtil.convertToArray(e);for(var t=0;t<e.length;t++)$WC.$CUtil.removeClass(e[t],"wms-hysearch-chosentext-close")}},WmsHybridSearch.removeChosenText=function(e,t){$WC.$CUtil.removeElement(t.parentNode),WmsHybridSearch.getNextResultSet()},WmsHybridSearch.virtual_list_objs=[],WmsHybridSearch.populateContactsUsingVirtualList=function(e,t,i,a,s,n){function r(e){var t=l[e],a="",s=WmsHybridSearch.constants.modules.CONTACTMENU,n=WmsHybridSearch.getResultInfo(t._filtertype),r=t.USERID?WmsContacts.getStatusMsg(t.USERID)||t.EMAILID:"";if(t.ISBOT)a=WmsHybridSearch.createResultFragment(t.USERID,t.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(r)),t.PHOTO,n,WmsHybridSearch.constants.CONTACT,null,null,t,s);else if(t.USERID)a=WmsHybridSearch.createResultFragment(t.USERID,t.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(r)),null,n,WmsHybridSearch.constants.CONTACT,null,null,null,s);else if("suggestions"==t)a='<div class="wms_menu_subheading" data-heading="suggestions" data-show="false">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.suggestions")+"</div>";else if("suggestions_heading"==t)a='<div class="wms_menu_subheading" data-heading="suggestions" data-show="true">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.suggestions")+"</div>";else{var o='<span data-retry="true">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.retry")+"</span>";a='<div class="wms-suggestions-failed">'+$WC.$CUtil.getConfig("Resource").getRealValue("suggestions.failed",o)+"</div>"}var c=document.createElement("div");c.innerHTML=a;var d,u=c.firstChild;return d=t.USERID?WmsHybridSearch.getCurrentModule()==WmsHybridSearch.constants.modules.SMARTCHAT?103-i:77-i:29-i,"wms_menu_item"!=u.className&&"wms-hysearch-result"!=u.className&&(u=[u,d]),u}function o(e){var t=e.target?e.target.closest("[data-id]"):e;t&&WmsHybridSearch.changeHover(t)}var l=WmsHybridSearch.generateContactResults(null,!0);if($WC.$CUtil.getConfig("isOrgUser")()&&n&&n.suggestions&&l.length<10){var c=n.suggestions;if("suggestion_req_failed"===c)l.push("suggestions"),l.push("suggestions_failed");else if("show_suggestions"===c){WmsOrgContacts.checkAndUpdateContactsList();var d=l.map(function(e){return e.USERID}),u=WmsHybridSearch.generateOrgContactResults("","",d,!0);u.length&&(l.push("suggestions"),l=l.concat(u))}else"suggestions_heading"===c&&l.push("suggestions_heading")}WmsHybridSearch.virtual_list_objs[s]&&WmsHybridSearch.virtual_list_objs[s].remove_event_listeners(),l.length&&(WmsHybridSearch.virtual_list_objs[s]=new $WC.VirtualList({w:e,h:t,itemHeight:i,totalRows:l.length,generatorFn:r,container:a,hoverFunction:o}))},WmsHybridSearch.populateFrequentContactsInSmartChat=function(){var e=WmsHybridSearch.getNode("freqcontactsdiv");$WC.$CUtil.getObjectLength(WmsContacts.contactslist)||$WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist)?(e.innerHTML="",WmsHybridSearch.populateContactsUsingVirtualList(325,370,74,e,"smartchat")):e.innerHTML='<div class="wms-welcome-msg">'+WmsResource.getRealValue("contacts.welcomemessage")+"</div>"},WmsHybridSearch.populateRecentChatsInSmartChat=function(e){WmsHybridSearch.populateRecentChats(e,WmsHybridSearch.constants.modules.SMARTCHAT)},WmsHybridSearch.generatePinnedChatMenuHtml=function(){var e="",t=WmsPinnedChats.chatlist.sort($WC.$CUtil.sortBy("TITLE",!1));return t.forEach(function(t){var i=WmsHybridSearch.generateImageHtml(t.CHATID,WmsHybridSearch.constants.CHAT,t),a="",s="",n=WmsMainUI.getUnreadCount(t.CHATID);a=n?'<span class="wms_cw_bar_msgcount" data-unreadcount=true style="display: block">'+n+"</span>":'<span class="wms_cw_bar_msgcount" data-unreadcount=true></span>',WmsMainUI.getZuidForPrivateChat(t.CHATID)&&(s=" data-userid="+WmsMainUI.getZuidForPrivateChat(t.CHATID));var r='<div data-pc="true" data-type=2 data-id='+t.CHATID+s+' class="wms_menu_pinnedchats_fragment" title="{{title}}">'+i+a+"</div>",o=t.TITLE;$WC.$CUtil.isChannelChid(t.CHATID)&&(o=WmsChannels.getChannelName(t.CHATID)||o),e+=$WC.template.replace(r,{title:WebMessanger.unescapeHTML(o)})}),e},WmsHybridSearch.generateChatMenuHtml=function(e,t,i,a){var s="",n="";if(e.length>0){var r=a||"LMTIME";e.sort($WC.$CUtil.sortBy(r,!0));var o=!1,l="";n="pinnedchats"==t?WmsHybridSearch.generatePinnedChatMenuHtml():WmsHybridSearch.generateRecentChatResultsHTML(e,WmsHybridSearch.constants.modules.CHATMENU,i),"undefined"!=typeof WmsSettings&&"0"==WmsSettings["c"+t]&&(o=!0,l="display: none"),s='<div id="wms_menu_'+t+'" class="wms_menu_'+t+'" data-menu="'+t+'"><div id="wms_menu_heading_'+t+'" class="wms_menu_subheading" data-heading='+t+" data-show="+o+">"+$WC.$CUtil.getConfig("Resource").getRealValue(t+".title")+'<span id="wms_menu_uccount_'+t+'" class="wms_menu_item_count" data-unreadcount="true"></span></div><div id="wms_menu_chatlist_'+t+'" class="wms_menu_chatlist_'+t+'" style="'+l+'">'+n+"</div></div>"}return s},WmsHybridSearch.populateUnreadChatsHtml=function(){var e=WmsRecentChats.getChatIdList(WmsPinnedChats.chatlist),t=WmsUnreadChats.chatlist.filter(function(t){return-1==e.indexOf(t.CHATID)?!0:!1});return WmsHybridSearch.generateChatMenuHtml(t,"unreadchats",!1)},WmsHybridSearch.populateRecentChats=function(e,t){var i="",a=!0;t=t||WmsHybridSearch.constants.modules.CHATMENU;var s=t===WmsHybridSearch.constants.modules.CHATMENU?"defaultresultdiv":"recentchatsdiv",n=WmsRecentChats.getChats(),r=WmsHybridSearch.getNode("recentchatsdiv",t)||WmsHybridSearch.getNode("defaultresultdiv",t);if(e===WmsConstants.REQSTATUS.FAILED||e===WmsConstants.REQSTATUS.NORESULTS)WmsHybridSearch.updateLoadingStatus(r,e,"chat",WmsRecentChats.loadPreviousChatList,t);else if(n===WmsConstants.REQSTATUS.LOADING||n===WmsConstants.REQSTATUS.NORESULTS)WmsHybridSearch.updateLoadingStatus(r,n,"chat",null,t);else if(t===WmsHybridSearch.constants.modules.CHATMENU){var o=WmsHybridSearch.generateChatMenuHtml(WmsPinnedChats.chatlist,"pinnedchats",!1),l=WmsHybridSearch.populateUnreadChatsHtml(),c=WmsHybridSearch.generateChatMenuHtml(n,"recentchats",!0);i+=l+o+c}else i+=WmsHybridSearch.generateRecentChatResultsHTML(n,t);t!==WmsHybridSearch.constants.modules.SMARTCHAT&&parseInt(WmsUnreadFeeds.count)&&(a=i?!0:!1,i=WmsHybridSearch.generateRecentChatResultsHTML(WmsUnreadFeeds.wrapObj())+i);var d=WmsHybridSearch.getNode(s,t);if(d&&i){var u=d.querySelector("[data-select]");d.innerHTML=i,$WC.$CUtil.loadOriginalImage(d);var m=u?d.querySelector('[data-id="'+u.getAttribute("data-id")+'"]'):"";m&&WmsHybridSearch.changeHover(m)}var p=WmsPinnedChats.chatlist.map(function(e){return e.CHATID});n.length&&(n=n.filter(function(e){return-1==p.indexOf(e.CHATID)?!0:!1})),""!=i&&a&&n.length>6&&WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("recentchatsdiv",t),WmsConstants.REQSTATUS.LOADING,"chat",null,t),"undefined"!=typeof WmsMainUI&&WmsMainUI.updateUnreadChatsCount()},WmsHybridSearch.checkScrollAndloadMoreChatlist=function(e){var t=e.target;("wms-hysearch-rchats"==t.id||"1"==WmsSettings.crecentchats)&&t.scrollTop+t.clientHeight>Math.floor(.75*t.scrollHeight)&&WmsRecentChats.loadPreviousChatList()},WmsHybridSearch.populateActiveChannels=function(){if(WmsChannels.last_fetched_time){var e=WmsChannels.getJoinedChannels($WC.$CUtil.getObjectLength(WmsChannels.list));if(e&&e.length){for(var t,i="",a=0;a<e.length;a++)t=e[a].cd||$WC.$CUtil.getConfig("Resource").getRealValue("channel.nodescription"),i+=WmsHybridSearch.createResultFragment(e[a].chid,WmsChannels.getChannelName(e[a].chid),$WC.$CUtil.safeHTML(t),WmsChannels.getChannelImageHTML(e[a].chid),null,WmsHybridSearch.constants.CHANNEL);$WC.$CUtil.setInnerText(WmsHybridSearch.getNode("thirdcolumnheading"),$WC.$CUtil.getConfig("Resource").getRealValue("menuname.channelsandgroups")),WmsHybridSearch.getNode("thirdcolumnheading").style.visibility="visible",WmsHybridSearch.getNode("thirdcolumn").innerHTML=i}else WmsHybridSearch.getNode("thirdcolumnheading")&&$WC.$CUtil.removeElement(WmsHybridSearch.getNode("thirdcolumnheading").parentNode)}},WmsHybridSearch.populateGroups=function(){if(WmsGroups.lastupdatetime){var e=[];for(var t in WmsGroups.decodedgrouplist)WmsGroups.decodedgrouplist[t]._filtertype=WmsHybridSearch.constants.GROUP,e.push(WmsGroups.decodedgrouplist[t]);if(e.sort($WC.$CUtil.sortBy("NAME",!1,function(e){return e.toLowerCase()})),$WC.$CUtil.setInnerText(WmsHybridSearch.getNode("thirdcolumnheading"),$WC.$CUtil.getConfig("Resource").getRealValue("Groups")),WmsHybridSearch.getNode("thirdcolumnheading").style.visibility="visible",e&&e.length){for(var i,a="",s=0;5>s&&s<e.length;s++)i=e[s].DESC||$WC.$CUtil.getConfig("Resource").getRealValue("channel.nodescription"),a+=WmsHybridSearch.createResultFragment(e[s].ID,e[s].NAME,i,null,null,WmsHybridSearch.constants.GROUP);WmsHybridSearch.getNode("thirdcolumn").innerHTML=a}else WmsHybridSearch.getNode("thirdcolumn").innerHTML='<div class="wms-hysearch-infotxt">'+$WC.$CUtil.getConfig("Resource").getRealValue("groups.none")+' <a onclick="WmsHybridSearch.hideUI();" target="_blank" href="'+WMSIAMURL+'/u/h#groups/allgroups">'+$WC.$CUtil.getConfig("Resource").getRealValue("groups.createinfo")+"</a></div>"}},WmsHybridSearch.toggleUI=$WC.$CUtil.debounce(function(){null===WmsHybridSearch.getNode("mainUI")?("undefined"!=typeof WmsProfileInfo&&WmsProfileInfo.hide(),WmsHybridSearch.showUI()):WmsHybridSearch.hideUI()},null,300,!0),WmsHybridSearch.changeHover=function(e){var t=e.getAttribute("data-type");t&&(WmsHybridSearch.resetHover(),$WC.$CUtil.setAttribute(e,"data-select",!0),$WC.$CUtil.addClass(e,"wms-hysearch-result-select"))},WmsHybridSearch.handleClick=function(e){WmsHybridSearch.handleSelection(e)},WmsHybridSearch.resetHover=function(){var e,t=WmsHybridSearch.getNode("resultcontainer");e=WmsHybridSearch.getNode("searchresultdiv")&&"block"===getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display?WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:t&&t.getElementsByClassName("wms-hysearch-result-select")[0],e&&($WC.$CUtil.removeClass(e,"wms-hysearch-result-select"),e.removeAttribute("data-select"))},WmsHybridSearch.generateSearchResults=function(e,t){function i(e,t){if(e._filtertype===t._filtertype){if(e._filtertype===WmsHybridSearch.constants.CONTACT&&t._filtertype===WmsHybridSearch.constants.CONTACT)return+t.UC-+e.UC;if(e._filtertype===WmsHybridSearch.constants.CHAT&&t._filtertype===WmsHybridSearch.constants.CHAT)return+t.LMTIME-+e.LMTIME;var i=e[b[e._filtertype]].toLowerCase(),a=t[b[t._filtertype]].toLowerCase();return a>i?-1:i>a?1:0}return y.indexOf(e._filtertype)-y.indexOf(t._filtertype)}var a=t;if(!a){var s=WmsHybridSearch.generateContactResults(e),n=s.map(function(e){return e.USERID}),r=WmsHybridSearch.generateRecentChatResults(e),o=r.map(function(e){return e.CHATID}),l=WmsHybridSearch.generateChatResults(e,!0,o),c=l.map(function(e){return e.CHATID}),d=document.getElementById("wms-fileupldwin")&&!0;a=s.concat(WmsHybridSearch.generateOrgContactResults(e,!1,n),r,l,WmsHybridSearch.generateChannelResults(e,null,d,o.concat(c)),WmsHybridSearch.generateGroupResults(e))}var u=a.filter(function(e){return 1===e._filterweight?!0:!1}),m=a.filter(function(e){return 2===e._filterweight?!0:!1}),p=a.filter(function(e){return 3===e._filterweight?!0:!1}),h=a.filter(function(e){return 4===e._filterweight?!0:!1}),g=a.filter(function(e){return 5===e._filterweight?!0:!1}),f=a.filter(function(e){return 6===e._filterweight?!0:!1}),v=a.filter(function(e){return 7===e._filterweight?!0:!1}),C=a.filter(function(e){return 8===e._filterweight?!0:!1}),y=[WmsHybridSearch.constants.CONTACT,WmsHybridSearch.constants.ORGCONTACT,WmsHybridSearch.constants.CHANNEL,WmsHybridSearch.constants.GROUP,WmsHybridSearch.constants.CHAT],b={};return b[WmsHybridSearch.constants.ORGCONTACT]="DNAME",b[WmsHybridSearch.constants.GROUP]="NAME",b[WmsHybridSearch.constants.CHANNEL]="cn",u.sort(i).concat(m.sort(i),p.sort(i),h.sort(i),g.sort(i),f.sort(i),v.sort(i),C.sort(i))},WmsHybridSearch.fetchFromServer=function(){var e=$WC.$CUtil.debounce(function(e,t,i){i=i||WmsHybridSearch.getPlainSearchText(),e===WmsHybridSearch.constants.ORGCONTACT?WmsOrgContacts.fetchFromServer(i,t):e===WmsHybridSearch.constants.CHAT?WmsChats.fetchFromServer(i,t):e===WmsHybridSearch.constants.CHANNEL&&WmsChannels.fetchFromServer(i,t)},this,300);return function(t,i,a){return a=a||WmsHybridSearch.getPlainSearchText(),e(t,i,a),t===WmsHybridSearch.constants.ORGCONTACT?WmsOrgContacts.isCachedRequest(a,i):t===WmsHybridSearch.constants.CHAT?WmsChats.isCachedRequest(a,i):t===WmsHybridSearch.constants.CHANNEL?WmsChannels.isCachedRequest(a,i):void 0}}(),WmsHybridSearch.getResultSet=function(){var e={};return e[WmsHybridSearch.constants.ORGCONTACT]="generateOrgContactResults",e[WmsHybridSearch.constants.CHAT]="generateChatResults",e[WmsHybridSearch.constants.CHANNEL]="generateChannelResults",function(t){var i=WmsHybridSearch.getPlainSearchText();if(1==t&&document.getElementById("wms-fileupldwin"))var a=!0;return""!==i&&t?WmsHybridSearch[e[t]](i,!0,a):void 0}}(),WmsHybridSearch.updateManager=function(){function e(e,t){return s[e]&&"undefined"!=typeof s[e].seqno&&s[e].seqno<t.length?!0:!1}function t(e,t){return s[e]&&"undefined"!=typeof s[e].seqno?s[e].seqno>=t.length?!0:!1:!0}var i=[WmsHybridSearch.constants.ORGCONTACT,WmsHybridSearch.constants.CHANNEL,WmsHybridSearch.constants.CHAT],a=[WmsHybridSearch.constants.ORGCONTACT,WmsHybridSearch.constants.CHAT],s={};return function(n,r,o,l,c){o=o||(new Date).getTime();var d=i;if($WC.$CUtil.getConfig("isOrgUser")()&&"disable"!=$WC.$CUtil.getConfig("channels")||(d=a),s[o])"undefined"!=typeof s[o].seqno?(r=d[s[o].seqno],"update"===n&&e(o,d)&&s[o].seqno++):r=s[o].type;else if(s[o]={},l&&(r?s[o].seqno=d.indexOf(r):(s[o].seqno=0,r=WmsHybridSearch.constants.ORGCONTACT)),s[o].type=r,Object.keys(s).length>50){var u=(new Date).getTime()-18e5;Object.keys(s).forEach(function(e){u>e&&delete s[e]})}if("fetch"===n)WmsHybridSearch.fetchFromServer(r,o,c)===!1&&(c&&WmsOrgContacts.isEmptyResultReq(c.searchtext)===!1&&!c.silentload?Commands.showLoadingIcon(WindowHandler.getWinObjById(c.chid).autocompletediv,c.chid):WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.LOADING,"search"));else if("update"===n){var m,p=WmsHybridSearch.getResultSet(r);if(p&&p.length)WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.SUCCESS,"search"),m=WmsHybridSearch.generateHtml(p),WmsHybridSearch.getNode("searchresultdiv").insertAdjacentHTML("beforeend",m),"undefined"!=typeof WmsMainUI&&$WC.$CUtil.loadOriginalImage(WmsHybridSearch.getNode("searchresultdiv",WmsHybridSearch.getCurrentModule())),!WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select").length&&WmsHybridSearch.getNode("searchresultdiv").firstChild&&WmsHybridSearch.changeHover(WmsHybridSearch.getNode("searchresultdiv").firstChild);else{var h=WmsHybridSearch.getSearchText(),g=WmsHybridSearch.getCurrentModule();!$WC.Matcher.check("emailid",h,!0)||g!==WmsHybridSearch.constants.modules.CONTACTMENU&&g!==WmsHybridSearch.constants.modules.SMARTCHAT||"disable"==$WC.$CUtil.getConfig("other_orguser_chat")||($WC.$CUtil.removeElement(WmsHybridSearch.getNode("searchresultdiv").querySelector('[data-operation="addcontact"]')),m=g===WmsHybridSearch.constants.modules.CONTACTMENU?'<div class="wms_menu_item wms_menu_addcontact" data-operation="addcontact" data-dname="{{searchtext}}" data-type="3">'+WmsHybridSearch.generateImageHtml("",WmsHybridSearch.constants.CONTACT)+'<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{searchtext}}">{{searchtext}}</div><div class="wms_menu_item_msg wms-truncate-ellipsis">'+$WC.$CUtil.getConfig("Resource").getRealValue("contact.invite")+'</div><span data-addcontact="true" class="wms_menu_addicon wms-valign-mid-block"></span></div>':'<div class="wms_hysearch_invite" data-operation="addcontact" data-email="{{searchtext}}">'+WmsHybridSearch.createResultFragment("",h,$WC.$CUtil.getConfig("Resource").getRealValue("contact.invite"),null,null,WmsHybridSearch.constants.ADDCONTACT,null,null,null,WmsHybridSearch.constants.modules.SMARTCHAT)+'<div class="wms_hysearch_addicon wms-valign-mid-block" onclick="WmsHybridSearch.handleClick(this)" data-type="'+WmsHybridSearch.constants.ADDCONTACT+'"></div></div>',m=$WC.template.replace(m,{searchtext:h}),WmsHybridSearch.getNode("searchresultdiv").insertAdjacentHTML("beforeend",m))}t(o,d)&&(WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.SUCCESS,"search"),WmsHybridSearch.getNode("searchresultdiv")&&0===WmsHybridSearch.getNode("searchresultdiv").children.length&&WmsHybridSearch.getSearchText()&&WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.NORESULTS,"search")),e(o,d)&&WmsHybridSearch.getNode("searchresultdiv")&&WmsHybridSearch.getNode("searchresultdiv").children.length<10&&WmsHybridSearch.updateManager("fetch",null,o)}else"failureupdate"===n&&WmsHybridSearch.getSearchText()&&(WmsHybridSearch.updateLoadingStatus(WmsHybridSearch.getNode("searchresultdiv"),WmsConstants.REQSTATUS.FAILED,"search",WmsHybridSearch.invokeRetry),WmsHybridSearch.getNode("loadingstatus").setAttribute("data-reqid",o))}}(),WmsHybridSearch.invokeRetry=function(){WmsHybridSearch.updateManager("fetch",null,WmsHybridSearch.getNode("loadingstatus").getAttribute("data-reqid"))},WmsHybridSearch.generateContactResults=function(e,t){var i,a=[],s=[],n=0;if(t){for(n=0;n<WmsContacts.invitedcontactslist.length;n++){s.push(WmsContacts.invitedcontactslist[n]);var r=WmsContacts.contactslist[WmsContacts.invitedcontactslist[n]];r&&a.push(r)}i=WmsHybridSearch.filter("DNAME","",WmsContacts.contactslist,null,s,"USERID","EMAILID")}else{var o=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']");if(o&&o.length)for(n=0;n<o.length;n++)s.push(o[n].getAttribute("data-id"));i=WmsHybridSearch.filter("DNAME",e,WmsContacts.contactslist,10,s,"USERID","EMAILID")}return i=a.concat(i),i.map(function(e){return e._filtertype=WmsHybridSearch.constants.CONTACT,e})},WmsHybridSearch.generateOrgContactResults=function(e,t,i,a){if(!e&&!a)return[];if(i=i||[],t){var s=$WC.$CUtil.convertToArray(WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']"));s=s.concat($WC.$CUtil.convertToArray(WmsHybridSearch.getNode("searchresultdiv").querySelectorAll("[data-type='"+WmsHybridSearch.constants.CONTACT+"'],[data-type='"+WmsHybridSearch.constants.ORGCONTACT+"']")));var n=0;if(s.length)for(n=0;n<s.length;n++)i.push(s[n].getAttribute("data-id"))}var r=WmsHybridSearch.filter("DNAME",e,WmsOrgContacts.contactslist,10,i,"USERID","EMAILID");return r.map(function(e){return e._filtertype=WmsHybridSearch.constants.ORGCONTACT,e})},WmsHybridSearch.generateGroupResults=function(e,t){var i=t?null:10,a=WmsHybridSearch.filter("NAME",e,WmsGroups.decodedgrouplist,i,null,null,null,"NAME");return a.map(function(e){return e._filtertype=WmsHybridSearch.constants.GROUP,e})},WmsHybridSearch.generateChannelResults=function(e,t,i,a){a=a||[];var s,n=[],r=i?null:10,o=WmsHybridSearch.getSearchText();if(o&&(o.startsWith("@")?s="@":o.startsWith("#")&&(s="#"),o.indexOf("@")>-1&&o.indexOf("#")>-1&&(s="@#")),t){var l=$WC.$CUtil.convertToArray(WmsHybridSearch.getNode("searchresultdiv").querySelectorAll("[data-type='"+WmsHybridSearch.constants.CHANNEL+"'],[data-type='"+WmsHybridSearch.constants.CHAT+"']")),c=0;if(l.length)for(c=0;c<l.length;c++)a.push(l[c].getAttribute("data-id"))}if(i)n=WmsChannels.getList(e,!0);else if("@"===s)n=WmsChannels.getListByTeamName(e);else if("#"===s)n=WmsChannels.getListByChannelName(e);else if("@#"===s){var d,u,m=e.split(/@|#/);o.startsWith("@")?(d=m[0],u=m[1]):o.startsWith("#")&&(d=m[1],u=m[0]),n=WmsChannels.getListByTeam_ChannelName(d,u),e=void 0!==u?u:""}else n=WmsChannels.getList(e);var p=WmsHybridSearch.filter("cn",e,n,r,a,"chid","_teamname","lmtime");return p.map(function(e){return e._filtertype=WmsHybridSearch.constants.CHANNEL,e})},WmsHybridSearch.generateChatResults=function(e,t,i){if(i=i||[],t){var a=$WC.$CUtil.convertToArray(WmsHybridSearch.getNode("searchresultdiv").querySelectorAll("[data-type='"+WmsHybridSearch.constants.CHAT+"']")),s=0;if(a.length)for(s=0;s<a.length;s++)i.push(a[s].getAttribute("data-id"))}var n=WmsHybridSearch.filter("TITLE",e,WmsChats.getList(),10,i,"CHATID");return n.sort($WC.$CUtil.sortBy("LMTIME",!0)),n.map(function(e){return e._filtertype=WmsHybridSearch.constants.CHAT,e})},WmsHybridSearch.generateFreqContactResults=function(){var e=WmsContacts.getSortedContacts("UC",!0,null,WmsContacts.contactslist.length),t="";if(0===e.length)t='<span class="wms-hysearch-infotxt">'+$WC.$CUtil.getConfig("Resource").getRealValue("contacts.frequent.none")+"</span>";else for(var i=0;i<e.length;i++)t+=e[i].ISBOT?WmsHybridSearch.createResultFragment(e[i].USERID,e[i].DNAME,e[i].EMAILID,null,null,WmsHybridSearch.constants.CONTACT,null,null,e[i]):WmsHybridSearch.createResultFragment(e[i].USERID,e[i].DNAME,e[i].EMAILID,null,null,WmsHybridSearch.constants.CONTACT);return t},WmsHybridSearch.generateRecentChatResultsHTML=function(e,t,i){var a,s="",n="";if(t!==WmsHybridSearch.constants.modules.SMARTCHAT&&i&&(e=WmsRecentChats.updateWithUnreadChats(e)),e&&e.length){if(i&&t!==WmsHybridSearch.constants.modules.SMARTCHAT){var r=WmsPinnedChats.chatlist.concat(WmsUnreadChats.chatlist),o=r.map(function(e){return e.CHATID});e=e.filter(function(e){return-1==o.indexOf(e.CHATID)?!0:!1})}a=e}else a=WmsHybridSearch.generateRecentChatResults();for(var l=0;l<a.length;l++){var c=a[l].TITLE;$WC.$CUtil.isChannelChid(a[l].CHATID)&&(c=WmsChannels.getChannelName(a[l].CHATID)||c),s+=WmsHybridSearch.createResultFragment(a[l].CHATID,c,WmsHybridSearch.createLastMsgInfoHtml(a[l]),WmsHybridSearch.createImageCollageHtml(a[l]),null,WmsHybridSearch.constants.CHAT,a[l].LMTIME,n,a[l],t),n=a[l].LMTIME}return s},WmsHybridSearch.generateRecentChatResults=function(e){var t=WmsHybridSearch.filter("TITLE",e,WmsRecentChats.getList(e),10,[],"CHATID");return t.sort($WC.$CUtil.sortBy("LMTIME",!0)),t.map(function(e){return e._filtertype=WmsHybridSearch.constants.CHAT,e})},WmsHybridSearch.getResultInfo=function(e,t){return e===WmsHybridSearch.constants.CONTACT||e===WmsHybridSearch.constants.ORGCONTACT?$WC.$CUtil.getConfig("Resource").getRealValue(t?"topic.adduser":WmsHybridSearch.getSearchText().startsWith("@")?"topic.addusertocreate":"chat.user"):e===WmsHybridSearch.constants.GROUP?$WC.$CUtil.getConfig("Resource").getRealValue("chat.group"):e===WmsHybridSearch.constants.CHANNEL?$WC.$CUtil.getConfig("Resource").getRealValue("channel.join"):e===WmsHybridSearch.constants.CHAT?$WC.$CUtil.getConfig("Resource").getRealValue("chat.continue"):void 0},WmsHybridSearch.generateHtml=function(e,t){for(var i,a,s="",n=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),r=0;r<e.length;r++)if(i=e[r],a=WmsHybridSearch.getResultInfo(i._filtertype,n),i._filtertype===WmsHybridSearch.constants.CONTACT)s+=i.ISBOT?WmsHybridSearch.createResultFragment(i.USERID,i.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(WmsContacts.getStatusMsg(i.USERID))),i.PHOTO,a,WmsHybridSearch.constants.CONTACT,null,null,i,t):i.id?WmsHybridSearch.createResultFragment(i.id,i.name,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(i.statusMsg)),i.photo,null,WmsHybridSearch.constants.CONTACT,null,null,i,t):WmsHybridSearch.createResultFragment(i.USERID,i.DNAME,$WC.$CUtil.safeHTML($WC.$CUtil.unescapeHTML(WmsContacts.getStatusMsg(i.USERID))),null,a,WmsHybridSearch.constants.CONTACT,null,null,null,t);else if(i._filtertype===WmsHybridSearch.constants.ORGCONTACT)s+=WmsHybridSearch.createResultFragment(i.USERID,i.DNAME,i.EMAILID,null,a,WmsHybridSearch.constants.ORGCONTACT,null,null,null,t);else if(i._filtertype===WmsHybridSearch.constants.GROUP)s+=WmsHybridSearch.createResultFragment(i.ID,i.NAME,i.DESC,null,a,WmsHybridSearch.constants.GROUP,null,null,null,t);else if(i._filtertype===WmsHybridSearch.constants.CHANNEL)a=WmsChannels.isJoinedChannel(i.chid)?WmsHybridSearch.getResultInfo(WmsHybridSearch.constants.CHAT,n):a,s+=WmsHybridSearch.createResultFragment(i.chid,WmsChannels.getChannelName(i.chid),$WC.$CUtil.safeHTML(i.cd),WmsChannels.getChannelImageHTML(i.chid),a,WmsHybridSearch.constants.CHANNEL,null,null,null,t,i.oc_id);else if(i._filtertype===WmsHybridSearch.constants.CHAT){var o=i.TITLE;$WC.$CUtil.isChannelChid(i.CHATID)&&(o=WmsChannels.getChannelName(i.CHATID)||o),s+=WmsHybridSearch.createResultFragment(i.CHATID,o,WmsHybridSearch.createLastMsgInfoHtml(i),WmsHybridSearch.createImageCollageHtml(i),a,WmsHybridSearch.constants.CHAT,i.LMTIME,"",i,t)}return s},WmsHybridSearch.handleEvent=function(){function e(e){var t,i,a,s,n=WmsHybridSearch.getNode("resultcontainer");s="block"===getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display?WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:WmsHybridSearch.getNode("defaultresultdiv").getElementsByClassName("wms-hysearch-result-select")[0];var r=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user'],[data-type='topic']");if(!r.length||e!==WmsConstants.KEYCODES.LEFT&&e!==WmsConstants.KEYCODES.RIGHT){if(s){if(WmsHybridSearch.resetHover(),e===WmsConstants.KEYCODES.LEFT||e===WmsConstants.KEYCODES.RIGHT)WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?(i=n.firstChild,s&&(i=s.parentNode.parentNode),a=$WC.$CUtil.getConditionalNextNode(i,e,"data-selectable"),a=a.querySelector("[data-resset]"),t=a.querySelector("[data-id]")):t=s;else if(e===WmsConstants.KEYCODES.UP||e===WmsConstants.KEYCODES.DOWN)if(WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.SMARTCHAT&&WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.CONTACTMENU&&WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.CHATMENU||!(s==s.parentNode.querySelector("[data-id]")&&e===WmsConstants.KEYCODES.UP||s==s.parentNode.lastChild&&e===WmsConstants.KEYCODES.DOWN))t=$WC.$CUtil.getConditionalNextNode(s,e,"data-type");else{var o=s.closest("[data-menu]");if(e===WmsConstants.KEYCODES.UP){var l=o&&o.previousSibling;l&&"wms_menu_pinnedchats"===l.id&&(l=l.previousSibling);var c=l&&l.querySelectorAll("[data-type]");t=c&&c[c.length-1]||s}else{var d=o&&o.nextSibling;d&&"wms_menu_pinnedchats"===d.id&&(d=d.nextSibling),t=d&&d.querySelector("[data-type]")||s}}t&&$WC.$CUtil.bringElemToView(t,e)}else t=WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?"block"===getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display?WmsHybridSearch.getNode("searchresultdiv").firstChild:n.firstChild.getElementsByClassName("wms-hysearch-result")[0]:"block"===getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display?WmsHybridSearch.getNode("searchresultdiv").querySelector("[data-type]"):WmsHybridSearch.getNode("defaultresultdiv").querySelector('[data-type][class="wms_menu_item"]');t&&WmsHybridSearch.changeHover(t)}else{var u=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-selected='true']");if(u){WmsHybridSearch.resetChosenClose(),u.setAttribute("data-selected","false");var m=$WC.$CUtil.getConditionalNextNode(u,e,"data-selectable");m.setAttribute("data-selected","true"),"INPUT"===u.nodeName&&(u.blur(),WmsHybridSearch.getNode("fakeinput").focus()),"INPUT"!==m.nodeName?WmsHybridSearch.showCloseIcon(m):m.focus(),$WC.$CUtil.bringElemToView(m,e,!0)}}}return function(t){!$WC.$CUtil.isEmptyString(WmsHybridSearch.getSearchText())||t.keyCode!==WmsConstants.KEYCODES.LEFT&&t.keyCode!==WmsConstants.KEYCODES.RIGHT?t.keyCode===WmsConstants.KEYCODES.UP||t.keyCode===WmsConstants.KEYCODES.DOWN?e(t.keyCode):(""===WmsHybridSearch.resshowntext||WmsHybridSearch.resshowntext!==WmsHybridSearch.getSearchText()||t.keyCode===WmsConstants.KEYCODES.TAB||t.keyCode===WmsConstants.KEYCODES.ENTER||t.keyCode===WmsConstants.KEYCODES.BACKSPACE)&&(WmsHybridSearch.resshowntext=WmsHybridSearch.getSearchText(),WmsHybridSearch.parseTextInput(t.keyCode)):e(t.keyCode)}}(),WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.handleKeyDown=function(e){""===WmsHybridSearch.getSearchText()&&(WmsHybridSearch.removesearchpart=!0),$WC.$CUtil.preventHandlingTabUpDownEnter(e)},WmsHybridSearch.getPlainSearchText=function(){var e=WmsHybridSearch.getSearchText();return e=e&&(e.startsWith("@")||e.startsWith("#"))?e.slice(1):e},WmsHybridSearch.getSearchText=function(){var e=WmsHybridSearch.getNode("inputdiv"),t=e&&(e.value&&e.value.trim()||e.textContent.trim());return t||""},WmsHybridSearch.parseTextInput=function(e){var t=WmsHybridSearch.getSearchText();if(e===WmsConstants.KEYCODES.BACKSPACE&&$WC.$CUtil.isEmptyString(WmsHybridSearch.getSearchText())){var i=WmsHybridSearch.getNode("inputcontainer").getElementsByClassName("wms-hysearch-chosentext-close");if(1===i.length)$WC.$CUtil.removeElement(i[0]),WmsHybridSearch.focusInput(),WmsHybridSearch.getNode("inputdiv").setAttribute("data-selected","true");else if(WmsHybridSearch.removesearchpart===!0){WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.getNode("inputdiv").setAttribute("data-selected","false");var a=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type]");a.length&&(a[a.length-1].setAttribute("data-selected",!0),$WC.$CUtil.addClass(a[a.length-1],"wms-hysearch-chosentext-close"))}}e===WmsConstants.KEYCODES.ENTER||e===WmsConstants.KEYCODES.TAB&&WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?WmsHybridSearch.handleSelection():t?(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT&&(WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.resetChosenClose()),WmsHybridSearch.getNode("defaultresultdiv").style.display="none",WmsHybridSearch.getNode("searchresultdiv").style.display="block","undefined"!=typeof WmsMainUI&&WmsMainUI.updateLoadingForPinnedChats(!1),WmsHybridSearch.getNextResultSet(),WmsHybridSearch.getNode("searchresultdiv").firstChild&&WmsHybridSearch.changeHover(WmsHybridSearch.getNode("searchresultdiv").firstChild)):WmsHybridSearch.getNextResultSet()},WmsHybridSearch.handleSelection=function(e){var t,i=WmsHybridSearch.getSearchText();e||(e="block"===getComputedStyle(WmsHybridSearch.getNode("searchresultdiv")).display?WmsHybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:WmsHybridSearch.getNode("defaultresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]);var a=e&&+e.getAttribute("data-type");if(e&&"wms_menu_feedsnotify"===e.getAttribute("data-id"))ZMSGUI.launchHistory();else if(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT){var s=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']");if(e&&"true"===e.getAttribute("data-retry"))WmsHybridSearch.invokeRetry();else if(a===WmsHybridSearch.constants.CHAT||a===WmsHybridSearch.constants.CHANNEL)WmsHybridSearch.parseAndOpenChat(e,WmsHybridSearch.constants.modules.SMARTCHAT);else if(i.startsWith("#")&&1==WmsHybridSearch.getChosenUsers().length||s&&1==WmsHybridSearch.getChosenUsers().length&&!i.startsWith("@"))WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("topic.not.allowed"));else if(e&&i.startsWith("@")){var n=e.getElementsByClassName("wms-hysearch-result-name")[0];n=$WC.$CUtil.getInnerText(n),t=e.getAttribute("data-id"),WmsHybridSearch.getNode("inputdiv").insertAdjacentHTML("beforebegin",WmsHybridSearch.createInnerSearchFragment("@"+n,"user",t)),WmsHybridSearch.getNode("inputdiv").value="",WmsHybridSearch.getNode("inputdiv").focus(),WmsHybridSearch.resshowntext="",WmsHybridSearch.getNextResultSet()}else if(s&&i.startsWith("#"))WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("topic.alreadyselected"));else if(s&&0===WmsHybridSearch.getChosenUsers().length)WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("topic.nouser"));else if(!s&&i.startsWith("#")){var r=WmsHybridSearch.getNode("inputdiv").value;WmsHybridSearch.getNode("inputdiv").insertAdjacentHTML("beforebegin",WmsHybridSearch.createInnerSearchFragment(r,"topic")),WmsHybridSearch.getNode("inputdiv").value="",WmsHybridSearch.getNode("inputdiv").focus(),WmsHybridSearch.resshowntext="",WmsHybridSearch.getNextResultSet()}else e&&WmsContacts.isInvitedContact(e.getAttribute("data-id"))?(WmsHybridSearch.hideUI(),"undefined"!=typeof WmsMainUI&&WmsMainUI.showPendingInvitations()):WmsHybridSearch.parseAndOpenChat(e,WmsHybridSearch.constants.modules.SMARTCHAT)}else if(e&&"true"===e.getAttribute("data-retry"))WmsHybridSearch.invokeRetry();else{t=e.getAttribute("data-id");var o=!1;$WC.$CUtil.getConfig("customContacts")&&(o=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").customContactClick,t,e)),o||WmsContacts.isInvitedContact(t)||WmsHybridSearch.parseAndOpenChat(e)}WmsHybridSearch.getNode("inputdiv")&&$WC.$CUtil.bringElemToView(WmsHybridSearch.getNode("inputdiv"),WmsConstants.KEYCODES.RIGHT,!0)},WmsHybridSearch.parseAndOpenChat=function(e,t){var i,a,s,n,r,o,l,c,d,u=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']")||[],m=WmsHybridSearch.getNode("inputcontainer")&&WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),p=[];if(u.length&&(a=$WC.$CUtil.convertToArray(u).map(function(e){return e.getAttribute("data-id")})),m&&(s=$WC.$CUtil.getInnerText(m).slice(1)),a&&(l=WmsHybridSearch.constants.CONTACT,o=a.join(","),a.length>1&&!s&&(a.forEach(function(e){p.push({zuid:e})}),s=WmsHybridSearch.createChatTitle(p)),i=WmsHybridSearch.getSearchText(),WmsHybridSearch.tempmsgdetails.push(i)),e)if(+e.getAttribute("data-type")===WmsHybridSearch.constants.CONTACT||+e.getAttribute("data-type")===WmsHybridSearch.constants.ORGCONTACT)o=e.getAttribute("data-id"),l=WmsHybridSearch.constants.CONTACT;else if(+e.getAttribute("data-type")===WmsHybridSearch.constants.GROUP)c=e.getAttribute("data-id"),l=WmsHybridSearch.constants.GROUP;else if(+e.getAttribute("data-type")===WmsHybridSearch.constants.CHAT)n=e.getAttribute("data-id"),l=WmsHybridSearch.constants.CHAT;else if(+e.getAttribute("data-type")===WmsHybridSearch.constants.CHANNEL)r=e.getAttribute("data-id"),d=e.getAttribute("data-oc_id"),l=WmsHybridSearch.constants.CHANNEL;else if(+e.getAttribute("data-type")===WmsHybridSearch.constants.ADDCONTACT){var h=e.closest("[data-operation]");l=WmsHybridSearch.constants.ADDCONTACT}l?("undefined"!=typeof WmsMainUI&&WmsMainUI.scheduleAutoFocus(),WmsHybridSearch.hideUI(),"disable"==$WC.$CUtil.getConfig("adhocchats")&&a&&a.length>1||WmsHybridSearch.checkAndOpenChat(l,o,s,i,c,r,n,h,t,d),"undefined"!=typeof WmsMainUI&&WmsMainUI.resetToDefaultUI()):WmsHybridSearch.showInfoMessage($WC.$CUtil.getConfig("Resource").getRealValue("Error"),$WC.$CUtil.getConfig("Resource").getRealValue("selection.none"))},WmsHybridSearch.checkAndOpenChat=function(e,t,i,a,s,n,r,o,l){var c,d=WmsContacts.contactslist[t]&&WmsContacts.contactslist[t].CHID;if(r=r||WebMessanger.ucmap[t]||WebMessanger.ucmap[s]||n,r&&WMSUI.handleChatExist(r),l=l==WmsHybridSearch.constants.modules.SMARTCHAT?"smartchat":"mainui",d?(WMSUI.handleChatExist(d),WebMessanger.join(d)):e===WmsHybridSearch.constants.CONTACT&&(i&&(c=!0),!c&&r&&a?Chat.isExists(r)?Message.send(r,a):(WmsChatCache.remove(r),WebMessanger.openUserChat(t,c,i,a,l)):WebMessanger.openUserChat(t,c,i,a,l)),e===WmsHybridSearch.constants.GROUP)WebMessanger.openGroupChat(s,i,a,l);else if(e===WmsHybridSearch.constants.CHAT&&r)WebMessanger.attachSession(r,l);else if(e===WmsHybridSearch.constants.CHANNEL&&n)if(WmsChannels.isJoinedChannel(n)===!1){var u='<div class="wms-dialog-txtcont">'+$WC.$CUtil.safeHTML($WC.$CUtil.getConfig("Resource").getRealValue("channel.confirmjoin",WmsChannels.get(n).cn))+"</div>",m={bodyhtml:u,focusbutton:2,operations:[{name:$WC.$CUtil.getConfig("Resource").getRealValue("Join"),action:function(){WmsMainUI.scheduleAutoFocus(),WebMessanger.joinChannel(n),WmsDialog.removeModal()}},{name:$WC.$CUtil.getConfig("Resource").getRealValue("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(m)}else WebMessanger.attachSession(n,l);else if(e===WmsHybridSearch.constants.ADDCONTACT){var p=o.getAttribute("data-email");WmsHybridSearch.inviteMember(p)}},WmsHybridSearch.filter=function(e,t,i,a,s,n,r,o){function l(e){var t=m.filter(e);return o=o||"UC",t.sort("UC"===o||"lmtime"===o?$WC.$CUtil.sortBy(o,!0,Number):$WC.$CUtil.sortBy(o,!1,function(e){return e.toLowerCase()})),t.forEach(function(e){m.splice(m.indexOf(e),1)}),t}function c(e,t){return e.map(function(e){e._filterweight=t})}t=t.toLowerCase();var d=[];if($WC.$CUtil.isArray(i))d=i;else for(var u in i)d.push(i[u]);s&&s.forEach(function(e){d=d.filter(function(t){return t[n]!==e?!0:!1})});var m=d.slice(0),p=l(function(i){var a=i[e];return a&&a.startsWith("#")&&(a=a.substring(1)),a&&a.toLowerCase().startsWith(t)?!0:void 0}),h=l(function(e){return e[r]&&e[r].toLowerCase()===t?!0:void 0}),g=l(function(e){return e[r]&&e[r].toLowerCase().startsWith(t)?!0:void 0}),f=l(function(i){return i[e]&&-1!==i[e].toLowerCase().indexOf(" "+t)?!0:void 0}),v=l(function(e){return e[r]&&-1!==e[r].toLowerCase().indexOf(" "+t)?!0:void 0}),C=l(function(i){return i[e]&&i[e].toLowerCase()===t?!0:void 0}),y=l(function(i){var a=/[-~!@%&[\]/{}<>()*+?.,^$|:;'"#\s]/g,s=i[e];if(s){s=s.toLowerCase();var n=t.toLowerCase().split(a),r=n.join(".*");if(-1!==s.search(new RegExp(r)))return!0}}),b=l(function(e){var i=/[-~!@%&[\]/{}<>()*+?.,^$|:;'"#\s]/g,a=e[r];if(a){a=a.toLowerCase();var s=t.toLowerCase().split(i),n=s.join(".*");if(-1!==a.search(new RegExp(n)))return!0}});c(p,1),c(h,2),c(f,3),c(C,4),c(y,5),c(g,6),c(v,7),c(b,8);var E=p.concat(h,f,C,y,g,v,b);return a?E.slice(0,a):E.slice(0)},WmsHybridSearch.createChatTitle=function(e){var t,i=e.length;return i>1&&(t=$WC.$CUtil.getContactName(e[0].zuid,e[0].dname)+", "+$WC.$CUtil.getContactName(e[1].zuid,e[1].dname)+" & ",2===i?t+=WebMessanger.getNickName():i>2&&(t+=i-1+" "+$WC.$CUtil.getConfig("Resource").getRealValue("more"))),t},WmsHybridSearch.getNextResultSet=function(e){var t,i=e&&e.inpresultset||WmsHybridSearch.decideResultSet(),a=WmsHybridSearch.getNode("searchresultdiv"),s=e&&e.searchtext||WmsHybridSearch.getSearchText();if(i===WmsHybridSearch.constants.EMPTY)a.innerHTML="";else if(i===WmsHybridSearch.constants.EMPTYUSERHINT)a.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.$CUtil.getConfig("Resource").getRealValue("hint.chooseuser"));else if(i===WmsHybridSearch.constants.EMPTYTITLEHINT)a.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.$CUtil.getConfig("Resource").getRealValue("hint.choosetopic"));else if(i===WmsHybridSearch.constants.EMPTYMSGHINT)a.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.$CUtil.getConfig("Resource").getRealValue("hint.sendmessage"));else if(i===WmsHybridSearch.constants.FREQCONTACTS)a.innerHTML=WmsHybridSearch.generateHtml(WmsHybridSearch.generateFreqContactResults());else if(i===WmsHybridSearch.constants.USERLIST||i===WmsHybridSearch.constants.USER_CHANNELLIST){s=e&&e.searchtext||WmsHybridSearch.getPlainSearchText(),t=[],i===WmsHybridSearch.constants.USER_CHANNELLIST&&(t=WmsHybridSearch.generateChannelResults(s,null,null,null));var n=[];if($WC.$CUtil.getConfig("customContacts"))n=WmsHybridSearch.generateCustomContactResults(s),a.innerHTML=WmsHybridSearch.generateCustomContactsListHtml(n);else{n=WmsHybridSearch.generateContactResults(s);var r=n.map(function(e){return e.USERID}),o=n.concat(WmsHybridSearch.generateOrgContactResults(s,!1,r));e&&e.inpresultset||(a.innerHTML=WmsHybridSearch.generateHtml(o.concat(t))),(o.length<10||$WC.Matcher.check("emailid",s,!0))&&WmsHybridSearch.updateManager("fetch",WmsHybridSearch.constants.ORGCONTACT,null,null,e)}}else if(i===WmsHybridSearch.constants.TITLEHINT||i===WmsHybridSearch.constants.CHANNELLIST)if(s=WmsHybridSearch.getPlainSearchText(),""!==s){if(t=WmsHybridSearch.generateChannelResults(s),a.innerHTML=WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT&&i===WmsHybridSearch.constants.TITLEHINT?WmsHybridSearch.createResultFragment("",s,"","<span></span>",null,WmsHybridSearch.constants.TITLEHINT)+WmsHybridSearch.generateHtml(t):WmsHybridSearch.generateHtml(t),t.length<10){var l=i===WmsHybridSearch.constants.TITLEHINT?!0:!1;WmsHybridSearch.updateManager("fetch",WmsHybridSearch.constants.CHANNEL,null,l)}}else a.innerHTML=WmsHybridSearch.generateHtml(WmsHybridSearch.generateChannelResults("",null,!0));else if(i===WmsHybridSearch.constants.MESSAGEHINT)a.innerHTML=WmsHybridSearch.createResultFragment("",s,"","<span></span>","",WmsHybridSearch.constants.MESSAGEHINT);else if(i===WmsHybridSearch.constants.GENERICLIST){a.innerHTML="";var c=WmsHybridSearch.generateSearchResults(s);a.innerHTML=WmsHybridSearch.generateHtml(c),(c.length<10||$WC.Matcher.check("emailid",s,!0))&&WmsHybridSearch.updateManager("fetch",null,null,!0)}else i===WmsHybridSearch.constants.DEFAULTRESULT&&(WmsHybridSearch.showRotationalHint(),WmsHybridSearch.getNode("defaultresultdiv").style.display=WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.SMARTCHAT?"table":"block",a.style.display="none")},WmsHybridSearch.updatePresence=function(e){var t=document.getElementById("wms_menu_listcontainer");if(t){var i=t.querySelectorAll('[data-id="'+e+'"],[data-userid="'+e+'"]'),a=$WC.$CUtil.unescapeHTML(WmsContacts.getStatusMsg(e));i=$WC.$CUtil.convertToArray(i),i.forEach(function(t){t.firstChild.className="wms_badge_imgwrapper wms_badge_statusicon_"+WmsContacts.getStatusClassName(e),$WC.$CUtil.setInnerText(t.querySelector("[data-smsg]"),a),$WC.$CUtil.setAttribute(t.querySelector("[data-smsg]"),"title",a)})}},WmsHybridSearch.populateContactListInMainUI=function(e,t){if(WmsMainUI.decideRepopulate("contactlist")||e){var i=WmsHybridSearch.getNode("defaultresultdiv",WmsHybridSearch.constants.modules.CONTACTMENU);($WC.$CUtil.getObjectLength(WmsContacts.contactslist)||$WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist))&&(i.innerHTML="",WmsHybridSearch.populateContactsUsingVirtualList(238,293,54,i,"mainui",t)),$WC.$CUtil.loadOriginalImage(WmsMainUI.defaultcontactlist),WmsMainUI.setRePopulateStatus("contactlist",!1)}},WmsHybridSearch.populateCustomContactListInMainUI=function(){var e=WmsHybridSearch.getNode("defaultresultdiv",WmsHybridSearch.constants.modules.CONTACTMENU),t=WmsHybridSearch.generateCustomContactResults(null,!0);if($WC.$CUtil.getObjectLength(t)){e.innerHTML="";var i=WmsHybridSearch.generateCustomContactsListHtml(t);e.innerHTML=i}$WC.$CUtil.loadOriginalImage(WmsMainUI.defaultcontactlist)},WmsHybridSearch.populateGroupResultInMainUI=function(){if(WmsHybridSearch.getCurrentModule()!==WmsHybridSearch.constants.modules.SMARTCHAT&&"undefined"!=typeof WmsMainUI&&WmsMainUI.decideRepopulate("grouplist")){var e=WmsHybridSearch.generateHtml(WmsHybridSearch.generateChannelResults("",null,!0));e&&(document.getElementById("wms_menu_grouplist_def").innerHTML=e)}},WmsHybridSearch.decideResultSet=function(){var e=WmsHybridSearch.getSearchText();if(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.CONTACTMENU)return""===e?WmsHybridSearch.constants.DEFAULTRESULT:WmsHybridSearch.constants.USERLIST;if(WmsHybridSearch.getCurrentModule()===WmsHybridSearch.constants.modules.GROUPMENU)return""===e?WmsHybridSearch.constants.DEFAULTRESULT:WmsHybridSearch.constants.CHANNELLIST;var t,i,a=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type]");return a.length&&""===e?(t=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']"),i=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),i&&(!t.length||1==t.length)||1==t.length?WmsHybridSearch.constants.EMPTYUSERHINT:i&&t.length>1?WmsHybridSearch.constants.EMPTYMSGHINT:t&&t.length>1?WmsHybridSearch.constants.EMPTYTITLEHINT:WmsHybridSearch.constants.EMPTY):""===e?WmsHybridSearch.constants.DEFAULTRESULT:(t=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='user']"),i=WmsHybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),e.startsWith("@")?e.indexOf("#")>0?WmsHybridSearch.constants.CHANNELLIST:WmsHybridSearch.constants.USER_CHANNELLIST:e.startsWith("#")?e.indexOf("@")>0||!t?WmsHybridSearch.constants.CHANNELLIST:i?WmsHybridSearch.constants.EMPTY:WmsHybridSearch.constants.TITLEHINT:t?WmsHybridSearch.constants.MESSAGEHINT:a.length?WmsHybridSearch.constants.EMPTY:WmsHybridSearch.constants.GENERICLIST)},WmsHybridSearch.showInfoMessage=function(){var e;return function(t,i){WmsHybridSearch.hideInfoMessage();var a='<div id="wms-hysearch-infomsg" class="wms-hysearch-infomsg"><div class="wms-shake"><span style="font-weight: bold;">{{heading}}: </span><span>{{msg}}</span></div></div>',s=$WC.template.replace(a,{heading:t,msg:i});WmsHybridSearch.getNode("mainUI").insertAdjacentHTML("beforeend",s),clearTimeout(e),e=setTimeout(WmsHybridSearch.hideInfoMessage,3e3)}}(),WmsHybridSearch.hideInfoMessage=function(){$WC.$CUtil.removeElement(WmsHybridSearch.getNode("infomsgdiv"))},WmsHybridSearch.showRotationalHint=function(){var e=["hint.chatwithmsg","hint.searchtopic"];e.unshift($WC.$CUtil.getConfig("isOrgUser")()&&"disable"!=$WC.$CUtil.getConfig("channels")?"search.commontitle":"search.contactsandchats"),"disable"!=$WC.$CUtil.getConfig("adhocchats")&&e.push("hint.groupchat"),void 0===e[WmsHybridSearch.hintindex]&&(WmsHybridSearch.hintindex=0);var t=$WC.$CUtil.getConfig("Resource").getRealValue(e[WmsHybridSearch.hintindex]);WmsHybridSearch.setPlaceHolderHint(t)},WmsHybridSearch.setPlaceHolderHint=function(e){$WC.$CUtil.setInnerTextById("wms-hysearch-placeholder",e)},WmsHybridSearch.createLastMsgInfoHtml=function(e){if(e.LASTMSGINFO&&e.LASTMSGINFO.msg){var t="";if(e.LASTMSGINFO.__module){var i=e.LASTMSGINFO.sender===$WC.$CUtil.getConfig("zuid")?!0:!1;return"att"===e.LASTMSGINFO.__module?t=i?$WC.$CUtil.getConfig("Resource").getRealValue("chat.file.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.file.shared",$WC.$CUtil.getContactName(e.LASTMSGINFO.sender,e.LASTMSGINFO.dname,!0)):"contact"===e.LASTMSGINFO.__module?t=i?$WC.$CUtil.getConfig("Resource").getRealValue("chat.contact.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.contact.shared",$WC.$CUtil.getContactName(e.LASTMSGINFO.sender,e.LASTMSGINFO.dname,!0)):"location"===e.LASTMSGINFO.__module?t=i?$WC.$CUtil.getConfig("Resource").getRealValue("chat.location.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.location.shared",$WC.$CUtil.getContactName(e.LASTMSGINFO.sender,e.LASTMSGINFO.dname,!0)):"event"===e.LASTMSGINFO.__module&&(t=i?$WC.$CUtil.getConfig("Resource").getRealValue("chat.event.shared.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.event.shared",$WC.$CUtil.getContactName(e.LASTMSGINFO.sender,e.LASTMSGINFO.dname,!0))),t}if("string"==typeof e.LASTMSGINFO.msg)if(-1!==e.LASTMSGINFO.msg.indexOf("<img"))t=$WC.$CUtil.getConfig("Resource").getRealValue("chat.img");else if(-1!==e.LASTMSGINFO.msg.indexOf("<hr>"))t=e.LASTMSGINFO.msg.replace("<hr>","---");else{var a=e.LASTMSGINFO.msg.lastIndexOf("<br>"),s=e.LASTMSGINFO.msg.lastIndexOf("\n");t=e.LASTMSGINFO.msg.substring(-1!==a?a+4:-1!==s?s+1:0),t=Smiley.replace(t,!0),t=$WC.$CUtil.formatMentions(t)}return"2"===e.PARTICIPANTSCOUNT&&e.LASTMSGINFO.sender!==$WC.$CUtil.getConfig("zuid")?t:e.LASTMSGINFO.sender===$WC.$CUtil.getConfig("zuid")?'<span class="wmsgrey">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.you")+": </span>"+t:'<span class="wmsgrey">'+$WC.$CUtil.getContactName(e.LASTMSGINFO.sender,e.LASTMSGINFO.dname,!0)+": </span>"+t}return e.LASTMSGINFO&&"63"===e.LASTMSGINFO.mtype?'<span class="wms-delmsg">'+$WC.$CUtil.getConfig("Resource").getRealValue("chat.info.deletemsg")+"</span>":e.desc?e.desc:""},WmsHybridSearch.createImageCollageHtml=function(e){for(var t="",i=[],a=0;a<e.PARTICIPANTS.length;a++)e.PARTICIPANTS[a].zuid!==$WC.$CUtil.getConfig("zuid")&&i.push(e.PARTICIPANTS[a].zuid);if(e.ADDINFO&&-1!==e.ADDINFO.indexOf("GROPUID")){var s=e.ADDINFO.split(":"),n=s[s.indexOf("GROUPID")+1];t='<img class="wms-imgcoll1" src="'+WmsContacts.getGroupLogo(n)+'">'}else 1===i.length?t=e.PHOTO?'<img class="wms-imgcoll1" src="'+e.PHOTO+'">':-1!==i[0].indexOf("b-")&&WmsContacts.contactslist[i[0]]?'<img class="wms-imgcollbot" src="'+WmsContacts.contactslist[i[0]].PHOTO+'"><div class="wms-img-badge wms-pos-bot"></div>':'<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(i[0])+'">':e.PARTICIPANTSCOUNT>5?t='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(i[0])+'"><img class="wms-imgcoll2" src="'+WmsContacts.getUserPhoto(i[1])+'"><img class="wms-imgcoll3" src="'+WmsContacts.getUserPhoto(i[2])+'"><span class="wms-numcoll">+'+(e.PARTICIPANTSCOUNT-4)+"</span>":2===i.length?t='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(i[0])+'"><img class="wms-imgcoll4" src="'+WmsContacts.getUserPhoto(i[1])+'">':3===i.length?t='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(i[0])+'"><img class="wms-imgcoll3" src="'+WmsContacts.getUserPhoto(i[1])+'"><img class="wms-imgcoll4" src="'+WmsContacts.getUserPhoto(i[2])+'">':4===i.length?t='<img class="wms-imgcoll1" src="'+WmsContacts.getUserPhoto(i[0])+'"><img class="wms-imgcoll2" src="'+WmsContacts.getUserPhoto(i[1])+'"><img class="wms-imgcoll3" src="'+WmsContacts.getUserPhoto(i[2])+'"><img class="wms-imgcoll4" src="'+WmsContacts.getUserPhoto(i[3])+'">':"string"==typeof e.TITLE&&e.TITLE.length&&(t='<div class="wms-lettercoll"><span>'+WmsHybridSearch.getBadgeLetters(e.TITLE)+"</span></div>");return'<div class="wms-imgcollage">'+t+"</div>"},WmsHybridSearch.inviteMember=function(e){WMSUI.inviteMember(e)},WmsHybridSearch.clearInvite=function(e){if(e.status==WmsConstants.CONTACTSTATUS.NOCHAT&&-1===WmsContacts.pendinginvcontactslist.indexOf(e.zuid)?WmsContacts.pendinginvcontactslist.push(e.zuid):e.status!=WmsConstants.CONTACTSTATUS.NOCHAT&&$WC.$CUtil.removeElementFromArray(WmsContacts.pendinginvcontactslist,e.zuid),$WC.$CUtil.removeElementFromArray(WmsContacts.invitedcontactslist,e.zuid),document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat(),"undefined"!=typeof WmsMainUI){var t={};t.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,t),WmsMainUI.resetToDefaultUI()}},WmsHybridSearch.showInvite=function(e){if(-1===WmsContacts.invitedcontactslist.indexOf(e.zuid)&&-1===WmsContacts.pendinginvcontactslist.indexOf(e.zuid)&&(WmsContacts.invitedcontactslist.push(e.zuid),WmsContacts.pendinginvcontactslist.push(e.zuid)),"undefined"!=typeof WmsMainUI){WmsMainUI.updateChatInvitationCount();var t={};t.suggestions="show_suggestions",WmsHybridSearch.populateContactListInMainUI(!0,t)}document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat()},WmsHybridSearch.getBadgeLetters=function(e){e.startsWith("#")&&(e=e.slice(1));var t=e.split(" "),i="";return t&&(i=t.length>1?t[0].charAt(0)+t[1].charAt(0):e.charAt(0)),i.toUpperCase()},WmsHybridSearch.generateCustomContactResults=function(e,t){var i=[],a=[],s=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").customContactsList);if(t)if(i=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").invitationsList),i=i?i:[],$WC.$CUtil.isArray(s))a=i.concat(s);else if($WC.$CUtil.getObjectLength(s)){var n=[];for(var r in s)if($WC.$CUtil.isArray(s[r])){n.push(r);var o=s[r];o.forEach(function(e){n.push(e)})}a=i.concat(n)}else a=i;else a=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").customContactsList,e);return a},WmsHybridSearch.generateCustomContactsListHtml=function(e){function t(e){var t="wms_menu_item",a="",s="",n="",r="",o="",l="",c="",d="",u="";if("string"==typeof e){var m='<div class="wms_menu_subheading" data-heading="{{heading}}">{{heading}}</div>';return $WC.template.replace(m,{heading:e})}e.time&&(a='<span class="wms_menu_item_time" title="'+MyDate.formatDateWithWords(e.time)+'">'+MyDate.formatTime(e.time)+"</span>"),c='<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{dname}}">{{dname}}</div>',s=i(e);var p=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").getUnreadCount,e.id)||!1;n=p?'<span style="display:block" class="wms_menu_item_count" data-unreadcount=true>'+p+"</span>":'<span class="wms_menu_item_count" data-unreadcount=true></span>';var h=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").isInvitationPending,e.id)||!1;if(h?(u=e.statusMsg?e.statusMsg:e.mailId,t="wms_menu_item_invitations"):u=e.statusMsg,r='<div class="wms_menu_item_msg wms-truncate-ellipsis" data-smsg="true" title="'+u+'">'+u+"</div>",$WC.$CUtil.getConfig("customContacts").getChatOwner){var g=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").getChatOwner,e.id);if(g&&g.id!=WebMessanger.zuid)var f=i(g)}h&&(l='<div class="wms_menu_inv" data-dname="{{dname}}"><span data-customoperation="accept" data-id="{{id}}" data-type="{{type}}" title="{{invitationAcceptLabel}}" class="wms_menu_invaccept" > {{invitationAcceptLabel}} </span><span>  |  </span><span data-customoperation="reject" data-id="{{id}}" data-type="{{type}}" title="{{invitationDeclineLabel}}" class="wms_menu_invreject" > {{invitationDeclineLabel}} </span></div>'),f?o='<div class="wms_menu_item_profile_icon_img wms-valign-mid-block" data-zcprofileid="'+e.id+'" style="visibility:visible">'+f+"</div>":p||(o='<div class="wms_menu_item_profile_icon wms-valign-mid-block" data-zcprofileid="'+e.id+'"></div>'),d='<div class="'+t+'" data-id="{{id}}" data-dname="{{dname}}" data-type="{{type}}">'+s+c+a+r+l+n+o+"</div>";var v=$WC.$CUtil.getConfig("customContacts").invitationActions||null,C={id:e.id,time:e.time,type:WmsHybridSearch.constants.CONTACT,dname:$WC.$CUtil.unescapeHTML($WC.$CUtil.getContactName(e.id,e.name)),invitationAcceptLabel:v?v[0].label:$WC.$CUtil.getConfig("Resource").getRealValue("Accept"),invitationDeclineLabel:v?v[1].label:$WC.$CUtil.getConfig("Resource").getRealValue("remind.later")};return $WC.template.replace(d,C)}function i(e){var t="",i=WmsImplHandler.invokeSynchronously($WC.$CUtil.getConfig("customContacts").getStatusClass,e.id)||"";return t=e.name&&e.photo?'<img data-zcprofileid="'+e.id+'" src="'+e.photo+'"/>':'<span data-zcprofileid="'+e.id+'" class="wms_badge_letter">'+WmsHybridSearch.getBadgeLetters(e.name)+"</span>",'<span class="wms_badge_imgwrapper wms_badge_statusicon_'+i+'">'+t+"</span>"}var a="";return e.forEach(function(e){a+=t(e)}),a};var WmsImplHandler={};WmsImplHandler.invoke=function(){var e=arguments;setTimeout(function(){var t=Array.prototype.slice.call(e,1);"function"==typeof e[0]&&e[0].apply(null,t)},1)},WmsImplHandler.invokeSynchronously=function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);if("function"==typeof e)try{return e.apply(null,t)}catch(i){setTimeout(function(){throw i},1)}};var WmsOrgContacts={contactslist:{},reqcache:{result:[],noresult:[]}};WmsOrgContacts.updateList=function(e){for(var t in e)WmsOrgContacts.contactslist[t]={USERID:t,DNAME:e[t][0],EMAILID:e[t][1],UC:e[t][3]};this.opts.callbackargs&&this.opts.callbackargs.params&&($WC.$CUtil.isEmptyObject(e)?WmsOrgContacts.reqcache.noresult.push(this.opts.callbackargs.params):WmsOrgContacts.reqcache.result.push(this.opts.callbackargs.params));var i=this.opts.callbackargs&&this.opts.callbackargs.reqid,a=this.opts.callbackargs&&this.opts.callbackargs.topicname;a?(WmsOrgContacts.putContactsListInLocalStorage(),$WC.$CUtil.pubsub.publish("/orgcontacts/"+a,{callbackargs:this.opts.callbackargs,stat:$WC.$CUtil.isEmptyObject(e)?WmsConstants.REQSTATUS.NORESULTS:""})):$WC.$CUtil.pubsub.publish("/orgcontacts/updateui",{reqid:i})},WmsOrgContacts.handleFailure=function(){var e="updateui",t=this.opts.callbackargs&&this.opts.callbackargs.reqid,i=this.opts.callbackargs&&this.opts.callbackargs.chid;this.opts.callbackargs&&this.opts.callbackargs.topicname&&(e=this.opts.callbackargs.topicname);var a=this.opts&&this.opts.callbackargs;$WC.$CUtil.pubsub.publish("/orgcontacts/"+e,{stat:WmsConstants.REQSTATUS.FAILED,chid:i,reqid:t,callbackargs:a})},WmsOrgContacts._constructParams=function(e){var t="limit=50";return t+="&search="+e},WmsOrgContacts.getContacts=function(e,t){WmsOrgContacts.fetchFromServer(e,null,"getapi");var i=$WC.$CUtil.pubsub.subscribe("/orgcontacts/getapi",function(){t(),$WC.$CUtil.pubsub.unsubscribe(i)})},WmsOrgContacts.fetchFromServer=function(e,t,i){var a=e&&e.chid,s=e&&e.searchtext||e,n=WmsOrgContacts._constructParams(s),r=e&&e.silentload;if(i=e&&e.topicname||i,WmsOrgContacts.isCachedRequest(s)===!1)$WC.Ajax.requestToChat("getorgusers.do",n,WmsOrgContacts.updateList,WmsOrgContacts.handleFailure,{reqid:t,params:n,topicname:i,chid:a,silentload:r});else if(i){var o={reqid:t,params:n,topicname:i,chid:a,silentload:r};$WC.$CUtil.pubsub.publish("/orgcontacts/"+i,{callbackargs:o})}else $WC.$CUtil.pubsub.publish("/orgcontacts/updateui",{reqid:t})},WmsOrgContacts.isCachedRequest=function(e){for(var t=e&&e.searchtext||e,i=WmsOrgContacts._constructParams(t),a=0;a<WmsOrgContacts.reqcache.result.length;a++){var s=WmsOrgContacts.reqcache.result[a];if(-1!==s.indexOf(i))return!0}return WmsOrgContacts.isEmptyResultReq(t)},WmsOrgContacts.checkAndUpdateContactsList=function(){var e=(new Date).getTime(),t=864e5,i=WmsLocalStorage.getItem(WebMessanger.zuid+"_wms_orgcontacts");return null!=i&&e-i.reqtime>t?(WmsOrgContacts.reqcache.result=[],WmsOrgContacts.reqcache.noresult=[],WmsOrgContacts.removeContactsListFromLocalStorage(),void WmsOrgContacts.fetchFromServer("","","suggestionui")):void(0==$WC.$CUtil.getObjectLength(WmsOrgContacts.contactslist)&&(null!=i?$WC.$CUtil.getObjectLength(i.contacts)>0&&WmsOrgContacts.pullContactsListFromLocalStorage():WmsOrgContacts.fetchFromServer("","","suggestionui")))},WmsOrgContacts.pullContactsListFromLocalStorage=function(){var e=WmsLocalStorage.getItem(WebMessanger.zuid+"_wms_orgcontacts");WmsOrgContacts.contactslist=e.contacts},WmsOrgContacts.putContactsListInLocalStorage=function(){var e={};e.contacts=WmsOrgContacts.contactslist,e.reqtime=(new Date).getTime(),WmsLocalStorage.setItem(WebMessanger.zuid+"_wms_orgcontacts",e)},WmsOrgContacts.removeContactsListFromLocalStorage=function(){WmsLocalStorage.removeItem(WebMessanger.zuid+"_wms_orgcontacts")},WmsOrgContacts.isEmptyResultReq=function(e){for(var t=WmsOrgContacts._constructParams(e),i=0;i<WmsOrgContacts.reqcache.noresult.length;i++){var a=WmsOrgContacts.reqcache.noresult[i];if(t.startsWith(a))return!0}return!1};var WmsRecentChats={chatlist:[],last_fetched_time:null,constants:{LOADING:1,NOCHATS:2,SUCCESS:3,FAILED:4}},WmsUnreadChats={chatlist:[],channellist:[]},WmsPinnedChats={chatlist:[],last_fetched_time:null},WmsUnreadFeeds={};WmsUnreadFeeds.count=0,WmsUnreadFeeds.wrapObj=function(){var e=[],t={};return t.FEEDSID="wms_menu_feedsnotify",t.PARTICIPANTS=[],t.LMTIME="",t.TITLE=1===WmsUnreadFeeds.count?$WC.$CUtil.getConfig("Resource").getRealValue("chat.feed.you"):$WC.$CUtil.getConfig("Resource").getRealValue("chat.feeds.you",[WmsUnreadFeeds.count]),t.desc=$WC.$CUtil.getConfig("Resource").getRealValue("view.click.here"),e.push(t),e},WmsRecentChats.initRecentChats=function(){null===WmsRecentChats.last_fetched_time&&WmsRecentChats.loadPreviousChatList()},WmsRecentChats.get=function(e){return WmsRecentChats.chatlist.filter(function(t){return t.CHATID===e?!0:void 0})[0]},WmsRecentChats.updateTitle=function(e,t){var i=WmsRecentChats.get(e);i&&(i.TITLE=t,$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS))},WmsRecentChats.updatePinnedChatList=function(e){WmsPinnedChats.last_fetched_time=(new Date).getTime();var t=e&&JSON.parse(e);for(var i in t){var a=WmsRecentChats.getFromPinnedChatList(i);if(!a){var s={};s.ADDINFO=t[i].addinfo,s.CHATID=i,s.LASTMSGINFO=t[i].lastmsginfo&&JSON.parse(t[i].lastmsginfo),s.PARTICIPANTS=t[i].recipants&&JSON.parse(t[i].recipants),s.PARTICIPANTSCOUNT=t[i].pcount,s.TITLE=t[i].title,s.LMSGTIME=t[i].lastmsginfo&&JSON.parse(t[i].lastmsginfo).time,WmsPinnedChats.chatlist.push(s);var n=WindowHandler.getWinObjById(i);n&&n.updatePinnedInfo(!0)}}WmsHybridSearch.populateRecentChats()},WmsRecentChats.getFromPinnedChatList=function(e){return WmsPinnedChats.chatlist.find(function(t){return t.CHATID===e?!0:void 0})},WmsRecentChats.getFromUnreadChatList=function(e){return WmsUnreadChats.chatlist.find(function(t){return t.CHATID===e?!0:void 0})},WmsRecentChats.updateLastMsgInfo=function(e){function t(t){t.LASTMSGINFO||(t.LASTMSGINFO={}),t.LASTMSGINFO.sender=e.sender,t.LASTMSGINFO.dname=$WC.$CUtil.getContactName(e.sender,e.dname),t.LASTMSGINFO.msg=e.msg,t.LMTIME&&(t.LMTIME=e.lmtime),e.module?t.LASTMSGINFO.__module=e.module:delete t.LASTMSGINFO.__module}var i=WmsRecentChats.getFromPinnedChatList(e.chid)||WmsRecentChats.getFromUnreadChatList(e.chid);i&&(i.LMSGTIME=e.lmtime,t(i));var a=WmsRecentChats.get(e.chid);a&&t(a),"undefined"!=typeof WmsMainUI&&$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)},WmsRecentChats.removeFromRecentChats=function(e){var t=WmsRecentChats.get(e);t&&(WmsRecentChats.chatlist.splice(WmsRecentChats.chatlist.indexOf(t),1),$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS))},WmsRecentChats.getChats=function(e){return WmsRecentChats.chatlist.length?(WmsRecentChats.chatlist.sort($WC.$CUtil.sortBy("LMTIME",!0)),e?WmsRecentChats.chatlist.slice(0,e):WmsRecentChats.chatlist.slice(0)):WmsConstants.REQSTATUS.NORESULTS},WmsRecentChats.getChatIdList=function(e){var t=e.map(function(e){return e.CHATID});return t},WmsRecentChats.getRecentChatsFromChatServer=function(e,t){e=e||4;var i="limit="+e;t&&(i="totime="+t+"&limit="+e);var a={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.$CUtil.getCSRF()};$WC.Ajax.requestToChat("v1/chats",i,function(e){WmsRecentChats.last_fetched_time=(new Date).getTime();var t=JSON.parse(e).data,i=t&&t.chats,a=WmsConstants.REQSTATUS.NORESULTS;i&&i.length?(i.forEach(function(e){var t={};t.ADDINFO=e.addinfo,t.CHATID=e.chatid,t.LASTMSGINFO=e.lastmsginfo&&JSON.parse(e.lastmsginfo),t.PARTICIPANTS=e.recipants&&JSON.parse(e.recipants)||[],t.PARTICIPANTSCOUNT=e.pcount,t.LMTIME=e.lmtime,t.TITLE=e.title,$WC.$CUtil.isBotChid(t.CHATID)&&(t.PHOTO=WmsRecentChats.getImageUrl(t.CHATID));var i=WmsRecentChats.get(t.CHATID);i?WmsRecentChats.chatlist[WmsRecentChats.chatlist.indexOf(i)]=t:WmsRecentChats.chatlist.push(t)}),a=WmsConstants.REQSTATUS.SUCCESS):a=WmsConstants.REQSTATUS.INITIALSTATE,$WC.$CUtil.pubsub.publish("/recentchats/updateui",a)},function(){$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.FAILED)},null,null,a)},WmsRecentChats.getImageUrl=function(e){var t="b-"+e.split("-")[2];return WmsContacts.contactslist[t]&&WmsContacts.contactslist[t].PHOTO?WmsContacts.contactslist[t].PHOTO:void 0},WmsRecentChats.updateFromActiveChats=function(e){for(var t in e){var i={};i={},i.CHATID=t,i.LASTMSGINFO=JSON.parse(e[t].lmhash),i.PARTICIPANTS=[];var a=JSON.parse(e[t].recipantssummary);for(var s in a)i.PARTICIPANTS.push({zuid:s,dname:a[s]});i.PARTICIPANTSCOUNT=e[t].pcount,i.TITLE=e[t].title,i.ADDINFO=e[t].addinfo,i.LMTIME=e[t].lmtime,$WC.$CUtil.isBotChid(i.CHATID)&&(i.PHOTO=WmsRecentChats.getImageUrl(i.CHATID));var n=WmsRecentChats.get(t),r=WmsRecentChats.getFromPinnedChatList(t);r&&(WmsPinnedChats.chatlist[WmsPinnedChats.chatlist.indexOf(r)]=i),n?WmsRecentChats.chatlist[WmsRecentChats.chatlist.indexOf(n)]=i:WmsRecentChats.chatlist.push(i)}"undefined"!=typeof WmsMainUI&&$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)},WmsRecentChats.updatePinnedChat=function(e,t){if(t){var i=WmsRecentChats.get(e),a=WmsRecentChats.getFromPinnedChatList(e);if(a)return;if(i)i=JSON.stringify(i),i=JSON.parse(i),i.LMTIME="",i.LMSGTIME=i.LASTMSGINFO.time,WmsPinnedChats.chatlist.push(i);else if(-1==e.indexOf("CT")||$WC.$CUtil.isBotChid(e))WebMessanger.getPinnedChats();else{var s=WmsChannels.list[e];if(s){var n={};n.ADDINFO=s.addinfo,n.CHATID=e,n.LASTMSGINFO=s.lminfo&&JSON.parse(s.lminfo),n.PARTICIPANTS=[],n.TITLE=s.cn,n.LMSGTIME=s.lminfo&&JSON.parse(s.lminfo).time,WmsPinnedChats.chatlist.push(n),WmsHybridSearch.populateRecentChats()}}}else{var r=WmsRecentChats.getFromPinnedChatList(e);r&&WmsPinnedChats.chatlist.splice(WmsPinnedChats.chatlist.indexOf(r),1)}},WmsRecentChats.updateUnReadChats=function(e,t){for(var i in e){var a=WmsRecentChats.wrapUnreadObj(e[i],i),s=WmsRecentChats.checkPresence(a.CHATID,t);s?t[t.indexOf(s)]=a:t.push(a),e[i].mute?WmsMainUI.setMuteStatus(i,!0):WmsMainUI.setMuteStatus(i,!1),WmsMainUI.setUnreadCount(i,a.UNREADMSGS),WindowHandler.checkAndHighlightChat(a.CHATID)}WmsMainUI.updateUnreadChatsCount()},WmsRecentChats.wrapUnreadObj=function(e,t){var i={};i.ADDINFO=e.addinfo,i.CHATID=t||e.chid,i.LASTMSGINFO=e.lastmsginfo&&JSON.parse(e.lastmsginfo)||e.lminfo&&JSON.parse(e.lminfo)||e.lmhash&&JSON.parse(e.lmhash);var a=e.recipantssummary&&JSON.parse(e.recipantssummary),s=[];for(var n in a)s.push({dname:a[n],zuid:n});return i.PARTICIPANTS=s||WmsRecentChats.checkPresence(i.CHATID,WmsRecentChats.chatlist).PARTICIPANTS,i.PARTICIPANTSCOUNT=e.pcount||e.pc,i.LMTIME=e.unreadtime||e.lmtime,i.TITLE=e.title||e.cn,i.UNREADMSGS=e.unreadmsgs?e.unreadmsgs:"1",$WC.$CUtil.isBotChid(i.CHATID)&&(i.PHOTO=WmsRecentChats.getImageUrl(i.CHATID)),i},WmsRecentChats.updateWithUnreadChats=function(e){for(var t,i=0;i<WmsUnreadChats.chatlist.length;i++)WmsUnreadChats.chatlist[i]&&(t=WmsRecentChats.checkPresence(WmsUnreadChats.chatlist[i].CHATID,e),t?e[e.indexOf(t)].UNREADMSGS="1":e.unshift(WmsUnreadChats.chatlist[i]));return e},WmsRecentChats.removeFromUnreadChats=function(e){var t;for(t=0;t<WmsUnreadChats.chatlist.length;t++)WmsUnreadChats.chatlist[t]&&WmsUnreadChats.chatlist[t].CHATID===e&&WmsUnreadChats.chatlist.splice(t,1)},WmsRecentChats.resetUnreadChats=function(){WmsUnreadChats.chatlist=[],WmsUnreadChats.channellist=[]},WmsRecentChats.checkPresence=function(e,t){for(var i in t)if(t[i].CHATID===e)return t[i];return!1},WmsRecentChats.getList=function(e){return WmsHybridSearch.filter("TITLE",e,WmsRecentChats.chatlist)},WmsRecentChats.loadPreviousChatList=function(){var e=(new Date).getTime();WmsRecentChats.chatlist.length&&(e=WmsRecentChats.chatlist[WmsRecentChats.chatlist.length-1].LMTIME),WmsRecentChats.getRecentChatsFromChatServer(15,e)},WmsRecentChats.getRecentChatTime=function(){var e=WmsRecentChats.chatlist[0]&&WmsRecentChats.chatlist[0].LMTIME;return e?+e:void 0},$WC.$CUtil.pubsub.subscribe("/channels/updateui",function(){$WC.$CUtil.pubsub.publish("/recentchats/updateui",WmsConstants.REQSTATUS.SUCCESS)}),WMSSessionConfig.CHAT=1,WMSSessionConfig.CHAT_PRESENCE=2,WMSSessionConfig.PRESENCE_PERSONAL=4,WMSSessionConfig.PRESENCE_ORG=8,WMSSessionConfig.LOADBALANCED=16,WMSSessionConfig.MP=32,WMSSessionConfig.CROSS_PRD=64,WMSSessionConfig.MULTI_DISPATCH=128,WMSSessionConfig.REUSE_SESSION=256;var $ZCAjx={},$PexImpl={};$ZCAjx={CUSTOM_HEADER_NAME:"X-ZCOperation",options:["success","error","protocol","paramdesc","status","ontimeout"],plan_error_codes:[4505,4203,4704,4303,4002,7031,"platform_storage_creation_limit_exceeded"],ACCEPTED:202,NOT_MODIFIED:304,storagelimit:25,storage:{},livexhr:{},ajax:function(e){if("undefined"!=typeof e.zc_module&&!SecurityManager.hasPermission(e.zc_module))return void SecurityManager.handleError();if(this.updateStatus(e.status,"loading"),"pex"===e.protocol&&$PexImpl.isSuppported())return void $PexImpl.request(e);if($WC.$CUtil.isEmpty(e.type)||"GET"===e.type){var t=this.getCacheKey(e);if($ZCAjx.storage[t])return void this.complete($ZCAjx.storage[t],e,$ZCAjx.livexhr[t])}if(e.setLocation&&navigator.geolocation)return void _handleAjaxWithLocation(e);if(!InitRequestManager.wasSentRecently(e)){var i=$ZCAjx.request(e);return i.done(function(t,i,a){$ZCAjx.complete(t,e,a)}).fail(function(t,i){var a=t.status;return a===$zcg._UNAUTHORIZED_HTTP_STATUS_CODE?void _handleInvalidSession():void("timeout"==i&&"function"==typeof e.ontimeout?e.ontimeout(t):$ZCAjx.complete(t.responseText,e,t))}),_print("ajaxcalls",[e.url,e.data,$Util.getSyncedCurrentTime()]),i}},request:function(e){var t={};for(var i in e)-1===$.inArray(i,this.options)&&(t[i]=e[i]);$WC.$CUtil.isEmpty(e.timeout)||(t.timeout=e.timeout),t.data=t.data||{},t.headers=t.headers||{},t.headers[$zcg.JSON_EXCEPTION_HEADER]=!0,t.headers[$zcg.CLIENT_HEADER_FIELD]=$zcg.CLIENT_HEADER_VALUE,t.headers[$zcg.CONSENTS_VERSION_HEADER]=1,t.trialExecutionChid&&IntegrationsCwin.chat.id===t.trialExecutionChid&&(t.headers[$zcg.TRIAL_EXECUTION_HEADER]=!0);var a="";($WC.$CUtil.isEmpty(t.type)||"GET"===t.type)&&(a=this.getCacheKey(t),t.data.nocache=(new Date).getTime()),("POST"===t.type||"PUT"===t.type||"DELETE"===t.type||t.url.startsWith("/v1/"))&&("true"!==t.internalCrossDomain&&(t.headers[$zcg.CSRF_HEADER]=$zcg._CFPARAMNAME+"="+Cookie.get($zcg._CFCOOKIENAME)),e.contentType&&"application/json"===e.contentType&&(t.data=JSON.stringify(e.data))),t.sendSID&&(t.headers[$zcg.SID_HEADER]=WmsImpl.getSid());var s=$.ajax(t);return a&&($ZCAjx.livexhr[a]=s),s},getCacheKey:function(e){var t=e.data;if("object"==typeof t&&t.cache){var i=[];for(var a in t){var s=t[a];"nocache"!==a&&"undefined"!=typeof s&&"function"!=typeof s&&"object"!=typeof s&&i.push(a+"="+encodeURI(t[a]))}return i.unshift(e.url),i.join("&")}return""},complete:function(e,t,i){if("undefined"==typeof t.status||"string"!=typeof t.status.loading&&"boolean"!=typeof t.status.loading||$("#loadingline").stop(!0,!1).animate({width:$(window).width()+"px"},300,function(){$(this).hide()}),$WC.$CUtil.isEmpty(t.type)||"GET"===t.type){var a=this.getCacheKey(t);$ZCAjx.updatecache(a,e)}var s=!0,n=(t.success,t.error,i.getResponseHeader(this.CUSTOM_HEADER_NAME));try{if("object"!=typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(0===e.length)return;e=e[0]}}catch(r){s=!1}if(s)if(t.url.startsWith("/v2"))this.isStatusCodeSuccess(i)?this.onSuccess(e,t):this.onError(e,t,"error",i);else if("undefined"!=typeof e.status){var o=e.status;if("OK"===o){var l={data:e.data,meta:e.meta,header:n};this.onSuccess(l,t,"object")}else if("FAILED"===o){var c=e.data;c.desc=e.desc,this.onError(c,t,"error",i)}}else{if(!this.isStatusCodeSuccess(i)&&SecurityManager.isSecurityError(e))return void SecurityManager.handleError(e);var d=e.objType,u=e.module,m=e.objString,p=$Util.getObject(d,m);"error"!==u&&"error"!==d?this.onSuccess(p,t,d,u,n):this.onError(p,t,d,i)}else this.isStatusCodeSuccess(i)?"function"==typeof t.cacheCallback&&i.status===$ZCAjx.NOT_MODIFIED?t.cacheCallback(t):this.onSuccess(e,t,"html","",n):this.onError(e,t,"html",i)},handleLoadingStateOnCompletion:function(e,t){"undefined"!=typeof e.status&&"object"==typeof e.status.loading&&$Util.Button.showCompletionAndResetContent(e.status.loading,t)},onSuccess:function(e,t,i,a,s){this.handleLoadingStateOnCompletion(t,!1),this.updateStatus(t.status,"success"),"function"==typeof t.success&&t.success(e,a,i,s)},onError:function(e,t,i,a){if(SecurityManager.isSecurityError(e))return void SecurityManager.handleError(e);this.handleLoadingStateOnCompletion(t,!0);var s=e;if("html"!==i){var n,r,o,l,c;r=t.status;var d=t.ignorableerrorcodes,u=e.ERRCODE;if(e.error_code&&(u=e.error_code),void 0===u&&(u=e.code),-1!==$.inArray(u,this.plan_error_codes)&&Plan.isFreePlan())return void Plan.populateLimitExcededWindow(u);"undefined"!=typeof e["I18N.KEY"]?(n=e.ERRMSG,o=e["I18N.KEY"],l=e["I18N.PARAMS"],c=e["I18N.ERRORPARAMS"]):(n=e.desc,o=e.error_key,l=e.error_keyparams,c=e.error_params),"undefined"!=typeof r&&(n=r.error?Resource.getRealValue(r.error):n),"undefined"!=typeof o&&("undefined"!=typeof l?n=Resource.getRealValue(o,l):"undefined"!=typeof c?("undefined"!=typeof t.paramdesc&&"undefined"!=typeof t.paramdesc[c]&&(c=Resource.getRealValue(t.paramdesc[c])),n=Resource.getRealValue(o,[c]),n="",_sendDebugMail("Incorrect values submitted in "+c+" params for "+t.url+" request","Incorrect Param Error")):n=Resource.getRealValue(o)),$WC.$CUtil.isEmpty(n)||-1!=$.inArray(u,d)||UI.updateBanner(n,2e3,!0)}0==a.readyState&&"function"==typeof t.networkerror?t.networkerror(s,a):"function"==typeof t.error&&t.error(s,a)},updateStatus:function(e,t){if("undefined"!=typeof e){var i=e[t];"undefined"!=typeof i&&("loading"===t?"string"==typeof i||"boolean"==typeof i?$("#loadingline").css({width:"0px"}).show().animate({width:"90%"},1200):$Util.Button.addLoadIconForAjax(i):UI.updateBanner(Resource.getRealValue(i),2e3,!1))}},formData:function(e,t,i,a){var s=new FormData;for(var n in e)s.append(n,e[n]);if(a&&s.append($zcg._CFPARAMNAME,Cookie.get($zcg._CFCOOKIENAME)),"undefined"!=typeof i)for(var n=0,r=i.length;r>n;n++){var o=i[n];"undefined"!=typeof o[1]?s.append(t,o[0],o[1]):s.append(t,o[0])}return s},updatecache:function(e,t){if(e&&($ZCAjx.storage[e]||($ZCAjx.storage[e]=t),$Util.getObjectKeysLength($ZCAjx.storage)>=$ZCAjx.storagelimit))for(var i in $ZCAjx.storage){try{delete $ZCAjx.storage[i]}catch(a){}break}},removeFromCache:function(e){delete $ZCAjx.storage[e],$ZCAjx.livexhr[e]&&delete $ZCAjx.livexhr[e]},removeFromCacheByChid:function(e){if(e)for(var t in $ZCAjx.storage)-1!=t.indexOf(e)&&this.removeFromCache(t)},removeFromCacheByUrlandChid:function(e,t){if(t&&e)for(var i in $ZCAjx.storage)i.includes(e)&&i.includes(t)&&this.removeFromCache(i)},isStatusCodeSuccess:function(e){return void 0!==e&&(200===e.status||204===e.status||e.status===$ZCAjx.NOT_MODIFIED||e.status==$ZCAjx.ACCEPTED)}},$PexImpl={request:function(e){var t=e.data,i=Cookie.get($zcg._CFCOOKIENAME);"POST"===e.type&&(t[$zcg._CFPARAMNAME]=i),$pex.process({header:{Cookie:"CT_CSRF_TOKEN="+i},data:e.data,operation:"req."+(e.type?e.type:"GET")+"@"+$zcg._PRD+":"+e.url.slice(1),complete:function(t,i){i?$ZCAjx.complete(JSON.stringify(t.response.d),e):UI.updateBanner(Resource.getRealValue("common.connectivity.error"),2e3,!0)}})},isSuppported:function(){try{return top.frames.wmspconnect.frames.wms.isWS}catch(e){return!1}}},_handleAjaxWithLocation=function(e){var t=function(){var t=$ZCAjx.request(e);t.done(function(t,i,a){$ZCAjx.complete(t,e,a)}).fail(function(t){$ZCAjx.complete(t.responseText,e,t)}),_checkAndUpdateLocationPermissionStatus()};e.headers=e.headers||{};var i=$zcg.LOCATION_INFO.PERMISSIONSTATE;if("granted"===i||"undefined"==typeof i){var a=function(){var i=$Util.checkAndRemoveUndefinedKeys($zcg.LOCATION_INFO.CACHED.coords);i.status="granted",e.headers[$zcg.GEO_LOCATION_HEADER]=JSON.stringify(i),t()};if("undefined"!=typeof $zcg.LOCATION_INFO.CACHED)a();else{"undefined"!=typeof $zcg.LOCATION_INFO.WATCH_ID&&navigator.geolocation.clearWatch($zcg.LOCATION_INFO.WATCH_ID);var s=function(e){var t="undefined"==typeof $zcg.LOCATION_INFO.CACHED;$zcg.LOCATION_INFO.CACHED=e,"undefined"==typeof i&&($zcg.LOCATION_INFO.PERMISSIONSTATE="granted"),t&&a()},n=function(a){var s;1===a.code?(s="denied","undefined"==typeof i&&($zcg.LOCATION_INFO.PERMISSIONSTATE=s)):s="failed",navigator.geolocation.clearWatch($zcg.LOCATION_INFO.WATCH_ID),delete $zcg.LOCATION_INFO.WATCH_ID;var n="undefined"==typeof $zcg.LOCATION_INFO.CACHED;n&&(e.headers[$zcg.GEO_LOCATION_HEADER]=JSON.stringify({status:s}),t()),delete $zcg.LOCATION_INFO.CACHED};$zcg.LOCATION_INFO.WATCH_ID=navigator.geolocation.watchPosition(s,n)}}else e.headers[$zcg.GEO_LOCATION_HEADER]=JSON.stringify({status:"undefined"!=typeof i?i:"failure"}),t()},_handleInvalidSession=function(){$WC.$Dlg.confirm({id:"reloginalert",version:2,"class":"zcdalogbx zcbg_mask alert_dialog hidecloseicon",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-red"></div>',header:[Resource.getRealValue("invalidticket.title")]}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("invalidticket.info")]}),buttons:[{text:Resource.getRealValue("invalidticket.relogin"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){_logout(!0)}}]})};var KeyHandler={};KeyHandler=function(){var e=["191","37","39","32"],t=["171670","1769","171669","171677","1784","171666","171672"],i=["1732","171632","171665","171672","171670","171673","171669","17191","1716191"],a={27:function(e){KeyHandler.esc(e)},1627:function(e){$(e.target).blur()},1732:function(){ZCTrack.track("SPOTLIGHT_SEARCH",{TRIGGER:"Keyboard"}),WmsBarImpl.open()},171632:function(){ZCTrack.track("SPOTLIGHT_SEARCH",{TRIGGER:"Keyboard"}),WmsBarImpl.open()},171665:function(){ContactsUI.inviteContactUI.create()},171672:function(){ZCTrack.track("CHAT_HISTORY_VIEW",{TRIGGER:"Keyboard"}),ChatHistory.load()},171670:function(e){ZCTrack.track("NEW_SEARCH",{TRIGGER:"Keyboard"}),GSUI.initializeResultsDom(e)},1769:function(e){Smiley.handleShortCut($(e.target),e)},171673:function(){InstantChat.Create()},171669:function(e){SecurityManager.hasPermission(Modules.Events)&&EventsUI.handle.open(e)},171677:function(e){e.preventDefault(),Sound.toggleMuteAll()},32:function(){ImgViewer.playMedia()},37:function(){ImgViewer.keyboardPrev()},39:function(){ImgViewer.keyboardNext()}};_isDesktopApp()&&(a[1784]=function(){QuickChat.createwin(void 0,"directmessagewin")},"mac"===$Util.getOS()?(a[171666]=function(){StarMessagesUI.open()},a[171672]=function(){MainUI.getMefront("home",!0)}):(a[1766]=function(){StarMessagesUI.open()},a[1836]=function(){MainUI.getMefront("home",!0)}));var s=function(e){return e.indexOf("meta")>-1},n=(function(){if("mac"==$Util.getOS()){var e="";for(var s in a)if(t.indexOf(s)>-1&&(e=s.replace(/17/g,"meta"),a[e]=a[s],delete a[s]),i.indexOf(s)>-1&&t.indexOf(s)>-1){e=s.replace(/17/g,"meta"),i.push(e);var n=i.indexOf(s);n>-1&&i.splice(n,1)}}}(),function(t,i){return"TEXTAREA"!==t.tagName&&"INPUT"!==t.tagName&&"true"!==t.getAttribute("contenteditable")||-1===e.indexOf(i)?$(t).parents("#delugeEditorArea").length>0?!1:!0:!1}),r=function(e){var t=$(e);if("BODY"===e.tagName)return!1;if("true"===e.getAttribute("readonly"))return!1;if("TEXTAREA"===e.tagName&&t.val().length>0)return t.val(""),!0;if("INPUT"===e.tagName){var i=t.attr("type");if("text"===i&&t.val().length>0)return t.val(""),!0}return!1},o=function(e){var t=""+e.which;return e.shiftKey&&(t=16+t),e.altKey&&(t=18+t),e.ctrlKey&&(t=17+t),(e.metaKey||91===t||93===t||224===t)&&(t="meta"+t),t},l=function(e){return-1!=$.inArray(e,i)};return{preventDefault:function(e){var t=o(e),i=a[t];"function"==typeof i&&n(e.target,t)&&(e.preventDefault(),s(t)&&(this.doOnShortcuts(t),i(e)))},execute:function(e){var t=o(e),i=a[t];if("function"==typeof i&&n(e.target,t)){if(e.preventDefault(),s(t))return;this.doOnShortcuts(t),i(e)}},esc:function(e){var t=!1;_isDesktopApp()&&(t=DesktopApp.handleEscape()),!t&&$("#wms-hysearch").length>0&&(t=WmsBarImpl.handleEscape(),$("#wms-hysearch-actualinp").length>0)||(t||(t=HoverDetails.handleEscape()),t||(t=r(e.target)),t||(t=Clickoutside.handleEscape(e)),t||(t=ImgViewer.Annotator.close()),t||(t=ImgViewer.close()),t||(t=IntegrationUI.handle.escape(e)),t||(t=$WC.$Win.handleEscape()),t||(t=ChannelsUI.handleEscape()),t||(t=UI.overlay.close()),t||(t=MMChat.handleEscape()),!t&&MainUI.isCurrentisChat()&&(t=$ZCVideoBroadcast.handleEscape(MainUI.current)),t||(t=Topbar.hideHamburgermenu()),!t&&MainUI.isCurrent("home")&&(ZCTrack.track("NEW_SEARCH",{TRIGGER:"Keyboard"}),GSUI.initializeResultsDom(e)),t||MainUI.handleEscape(),MainUI.setCurrentWinFocus())},doOnShortcuts:function(e){"27"!==e&&HoverDetails.hide(),ImgViewer.isVisible()&&l(e)&&ImgViewer.close()}}}();var Clickoutside={};Clickoutside={currentchain:[],data:{},bind:function(e){if(e.closeOnClickSrc="undefined"==typeof e.closeOnClickSrc?!0:e.closeOnClickSrc,"undefined"!=typeof e.event&&(e.event.stopPropagation(),delete e.event),this.currentchain.length)if(this.isDuplicateSource(e.srcid)){if(e.closeOnClickSrc)return this.triggerCallback(e.destid,!0),!1}else this.triggerCallback(e.destid),"function"==typeof e.customShow?e.customShow(e):document.getElementById(e.destid).style.display="block",this.addData(e);else this.addData(e),"function"==typeof e.customShow?e.customShow(e):document.getElementById(e.destid).style.display="block";return!0},handleClick:function(e){this.triggerCallback(e.target,void 0,e)},handleEscape:function(){var e=this.currentchain.length,t=!0,i=e-1;return e&&this.data[this.currentchain[i]].ignoreesc!==!0?this.executeCallback(i,e,t):!1},handleClickOnChild:function(e,t){e.stopPropagation(),"undefined"==typeof t&&(t=e.target),this.triggerCallback(t,!0,e)},clearCurrentElement:function(e){var t=this.currentchain.indexOf(e);-1!==t&&(delete this.data[e],this.currentchain.splice(t,1))},clear:function(e){var t=this.currentchain.indexOf(e);-1!==t&&this.clearEntries(t,this.currentchain.length)},addData:function(e){this.currentchain.push(e.destid),this.data[e.destid]=e},isDuplicateSource:function(e){for(var t in this.data)if(this.data[t].srcid===e)return!0},triggerCallback:function(e,t,i){var a=this.currentchain.length,s=0,n=this.findLCA(e);"undefined"!=typeof n&&(s=this.currentchain.indexOf(n),s=t===!0?s:s+1),a>s&&this.executeCallback(s,a,void 0,i)},findLCA:function(e){for("string"==typeof e&&(e=document.getElementById(e));e;){if(-1!==this.currentchain.indexOf(e.id))return e.id;e=e.parentNode}},executeCallback:function(e,t,i,a){for(var s=!1,n={},r=t-1;r>=e;r--){var o=document.getElementById(this.currentchain[r]);if(o){var l=Clickoutside.data[this.currentchain[r]],c=!1,d=!1;if("function"==typeof l.doNotClose&&(c=l.doNotClose(l,i,a,n)),!c){d=!0,s=!0,"function"==typeof l.customHide?l.customHide(l):o.style.display="none";var u=this.data[this.currentchain[r]];u&&"function"==typeof u.callback&&u.callback(u.srcid,u.destid),this.clear(this.currentchain[r])}l.isClosed=d,n[l.destid]=l}}return s},clearEntries:function(e,t){for(var i=t-1;i>=e;i--)delete this.data[this.currentchain[i]];this.currentchain.splice(e)}};var ImgViewer={};ImgViewer={queue:[],UI:null,currimgpos:-1,currimg:{},multiplier:1,LEFTMARGIN:6,TOPMARGIN:6,getUI:function(){var e=this.UI||$("#imgviewer");return e},bindEvents:function(){var e=this.getUI();e.find("#closeimgviewer").on("click",function(e){e.stopPropagation(),ImgViewer.close()}),e.find("#imgprev").on("click",function(){ImgViewer.prev($(this))}),e.find("#imgnext").on("click",function(){ImgViewer.next($(this))}),e.on("keyup",function(e){e.which===$zcg.ESCAPE_KEYCODE&&(e.stopPropagation(),ImgViewer.close())}),e.find("#imgdownload").on("click",function(){var t=e.find("#userinfo").attr("uid"),i=Users.getImgUrlById(t,"original");if(Contacts.isBotId(t))if(-1!==i.indexOf(".do"))window.location=i+"?download=true";else{var a=document.createElement("a");a.href=i,a.download="photo",document.body.appendChild(a),a.click(),document.body.removeChild(a)}else window.location=i}),e.find("#startchat").on("click",function(){var t=e.find("#userinfo").attr("uid");ImgViewer.close(),$WC.$Win.closeAll(),ContactsList.reqForChat(t)}),e.find("#imgviewerdetails").on("click","[thumbnail]",function(){ImgViewer.Thumbnails.handleClick(this)});var t=e.find("#imgpreviewlist");t.on("mousemove","[zoom]",function(e){ImgViewer.showImgDetails(),e.preventDefault()}),t.on("wheel","[zoom]",function(e){ImgViewer.handleZoomInOut(e),e.preventDefault()}),t.on("click","[zoom]",function(e){ImgViewer.handleZoomInOut(e,$(this).attr("purpose")),e.preventDefault()})},clearZoomOptions:function(){this.currimg={},this.multiplier=1,$("#zoomimgholder"+ImgViewer.currimgpos).css("display","none")},isZoomAvailableForCurrent:function(){return"undefined"!=typeof ImgViewer.currimg.ratio},handleZoomInOut:function(e,t){this.scaleZoomImage(e,t),this.handleZoomOptions(),this.setLeftTop(e.originalEvent)},handleZoomOptions:function(){var e=$("#imgviewer");return ImgViewer.multiplier===1/ImgViewer.currimg.ratio*2?void e.attr("zoomout","true"):1===ImgViewer.multiplier?(ImgViewer.showImgDetails(),void e.attr("zoomout","false")):(e.find("#imgviewerdetails").css("opacity",0),void e.removeAttr("zoomout"))},scaleZoomImage:function(e,t){var i=1/ImgViewer.currimg.ratio*2,a=$("#zoomimgpreview"+ImgViewer.currimgpos),s=!0,n=1.2;if("wheel"===e.type)s=e.originalEvent.deltaY<0;else if("click"===e.type&&(s=t?"zoom-in"===t:!0,ImgViewer.multiplier===i&&s||1===ImgViewer.multiplier&&!s))return;ImgViewer.multiplier=s?Math.min(ImgViewer.multiplier*n,i):Math.max(ImgViewer.multiplier/n,1),a.css({width:ImgViewer.currimg.fittedwidth*ImgViewer.multiplier,height:ImgViewer.currimg.fittedheight*ImgViewer.multiplier,cursor:ImgViewer.multiplier===i?"zoom-out":"zoom-in"})},setLeftTop:function(e){var t=$("#zoomimgpreview"+ImgViewer.currimgpos),i=$("#zoomimgholder"+ImgViewer.currimgpos).offset(),a={},s=$(window);e.target.getAttribute("purpose")?(a.x=s.width()/2-i.left,a.y=s.height()/2-i.top):(a.x=e.pageX-i.left,a.y=e.pageY-i.top);var n=(ImgViewer.multiplier-1)*-ImgViewer.currimg.fittedwidth,r=(ImgViewer.multiplier-1)*-ImgViewer.currimg.fittedheight,o=Math.min(Math.max(n,(1-ImgViewer.multiplier)*a.x),0),l=Math.min(Math.max(r,(1-ImgViewer.multiplier)*a.y),0);t.css({left:o+"px",top:l+"px"})},showImgDetails:function(){clearTimeout(this.imgholdertimer);var e=$("#imgviewerdetails");e.css("opacity",1),this.imgholdertimer=setTimeout(function(){ImgViewer.multiplier>1&&e.css("opacity",0)},2e3)},isImageAttachment:function(e){return!$WC.$CUtil.isEmpty(e)&&"img"===e.toLowerCase()},Thumbnails:{initThumbnailOptions:function(){this.MAXTHUMBNAILHOLDERWIDTH=100,this.allowedcount=1,this.THUMBNAILWIDTH=70,this.SELECTEDTHUMBNAILWIDTH=90,this.THUMBNAILMARGIN=10},setThumbnailsHolderCSS:function(){for(var e=.35*$(window).width(),t=this.MAXTHUMBNAILHOLDERWIDTH,i=1;ImgViewer.queue.length>i&&(i++,t=(i-1)*this.THUMBNAILWIDTH+this.SELECTEDTHUMBNAILWIDTH+i*this.THUMBNAILMARGIN,!(t>e));)this.allowedcount++;var a=(this.allowedcount-1)*this.THUMBNAILWIDTH+this.SELECTEDTHUMBNAILWIDTH+this.allowedcount*this.THUMBNAILMARGIN;$("#thumbnailsmainholder").css("width",a+"px"),$("#thumbnails").css({"margin-left":-a/2+"px",width:a+"px"})},populate:function(){if(!($("#thumbnails").length||ImgViewer.queue.length<1)){this.initThumbnailOptions();var e='<div id="thumbnails" class="thumbpreview"><div id="thumbnailsmainholder" class="thumbnailsholder"></div>';$("#imgviewerdetails").append(e);var t=$("#thumbnailsmainholder");this.setThumbnailsHolderCSS();for(var i=0;i<ImgViewer.queue.length;i++){var a=ImgViewer.queue[i].getAttribute("contenttype"),s=ImgViewer.queue[i].getAttribute("hasthumbnail");if($WC.$CUtil.isEmpty(a)||-1!==a.indexOf("image")&&ImgViewer.isImageAttachment(ImgViewer.queue[i].tagName)||"true"===s){var n=ImgViewer.queue[i].hasAttribute("src")?' src="'+ImgViewer.queue[i].getAttribute("src")+'"':"";if(n.length>0){var r=$('<img class="attimg" thumbnail="'+i+'"'+n+'><div id="imagestatus" class="imgstatus"></div>');ImgViewer.queue[i].hasAttribute("originalsrc")&&r.attr("originalsrc",ImgViewer.queue[i].getAttribute("originalsrc")),t.append('<div id="thumbnailholder'+i+'" class="elemholder"></div>'),t.find("#thumbnailholder"+i).html(r)}else t.append('<div id="thumbnailholder'+i+'" class="elemholder"></div>'),t.find("#thumbnailholder"+i).html('<div class="cur" thumbnail="'+i+'"><span class="zcftype posa font10 bold ellips">'+ImgViewer.queue[i].getAttribute("filetype")+'</span><span class="msi-atchfle dIB"></span></div>')}else t.append('<div id="thumbnailholder'+i+'" class="elemholder"></div>'),t.find("#thumbnailholder"+i).html('<div class="cur" thumbnail="'+i+'"><span class="zcftype posa font10 bold ellips">'+ImgViewer.queue[i].getAttribute("filetype")+'</span><span class="msi-atchfle dIB"></span></div>')}t.find("img").addClass("thumbnails"),this.select()}},handleClick:function(e){ImgViewer.pauseMediaAndHide(ImgViewer.currimgpos),ImgViewer.clearZoomOptions();var t=$(e).attr("thumbnail");ImgViewer.currimgpos=parseInt(t),ImgViewer.show(ImgViewer.queue[t])},select:function(){var e,t,i=ImgViewer.getUI(),a=ImgViewer.queue.length,s=0;a>this.allowedcount&&(this.allowedcount%2==1?(e=(this.allowedcount-1)/2,t=ImgViewer.currimgpos<=e?e:ImgViewer.currimgpos>=a-e?a-1-e:ImgViewer.currimgpos):(e=this.allowedcount/2,t=ImgViewer.currimgpos<=e?e:ImgViewer.currimgpos>=a-e?a-e:ImgViewer.currimgpos),s=t-e,left=s*(this.THUMBNAILWIDTH+this.THUMBNAILMARGIN),i.find("#thumbnailsmainholder").css("left",-left+"px")),i.find(".selthumbnail").removeClass("selthumbnail").addClass("elemholder"),i.find(".selimg").removeClass("selimg").addClass("thumbnails");var n=i.find("#thumbnailholder"+ImgViewer.currimgpos);n.removeClass().addClass("selthumbnail"),n.children("[thumbnail]").removeClass("thumbnails").addClass("selimg"),n.find("#imagestatus").html(Resource.getRealValue("common.imageview.status",[ImgViewer.currimgpos+1,ImgViewer.queue.length]));for(var r=0,o=s;r<this.allowedcount;r++,o++){var l=$("#thumbnailholder"+o).find("img");l.length>0&&""===l.attr("src")&&(ChatUI.loadOriginalSource(l),ChatUI.loadOriginalSource(ImgViewer.queue[o]))}}},resizeNavigationPosition:function(){var e=$("#imgnavigation");e.css("top",$(window).height()/2-e.height()/2)},enqueue:function(e){for(var t=e.parents("[purpose='transcriptholder']").find("[previewelem]"),i=t.length,a=0;i>a;a++)if(e[0]===t[a]){this.currimgpos=a;break}this.queue=t,this.Thumbnails.populate()},resetWrapperData:function(){this.UI.find("#imgviewer-fname").html(""),this.UI.find("#imgviewer-fdetails").html(""),this.UI.find("#imgviewer-fsender").attr("src","")},show:function(e,t){function i(e){return"undefined"!=typeof e.attr("customsender_name")}if(e){if(e=$(e),void 0!==e.attr("originalsrc")){ChatUI.loadOriginalSource(e);var a=$("#thumbnailholder"+this.currimgpos).find("img");a.length>0&&ChatUI.loadOriginalSource(a)}if(this.UI=this.getUI(),this.UI.attr("zoomout","false"),t){var s=e.attr("uid");if(HoverDetails.hide(),this.UI.show(),this.UI.find("#imgloading").show(),this.resetWrapperData(),$("#imgmaskbg").show(),s){ImgViewer.UI.find("#imgvieweruseroption").show();var n=void 0!==document.createElement("a").download;!Contacts.isBotId(s)||-1!==e.attr("imgsrc").indexOf(".do")||$Util.Browser.isChrome()&&n?ImgViewer.UI.find("#imgdownload").show():ImgViewer.UI.find("#imgdownload").hide()}else ImgViewer.UI.find("#imgvieweruseroption").hide();if(Users.isUserPeopleInfoExist(s))var r=Users.getInfo(s),o=Users.getName(s,r.fullname),l=(r.emailid,r.designation),c=r.departmentname,d=r.mobile,u=r.extension;else if(Users.isExist(s)){var o=Users.getName(s);Users.getEmailId(s)}var m=[];$WC.$CUtil.isEmpty(o)||m.push("<span>"+$WC.$CUtil.processXSS(o)+"</span>"),$WC.$CUtil.isEmpty(l)||m.push("<span>"+$WC.$CUtil.processXSS(l)+"</span>"),$WC.$CUtil.isEmpty(c)||m.push("<span>"+$WC.$CUtil.processXSS(c)+"</span>"),$WC.$CUtil.isEmpty(d)||m.push('<span class="msi-mbico"></span><span>'+$WC.$CUtil.processXSS(d)+"</span>"),$WC.$CUtil.isEmpty(u)||m.push('<span class="msi-extnico"></span><span>'+$WC.$CUtil.processXSS(u)+"</span>"),profileinfo=m.join(' <span class="prfbar">|</span> '),ImgViewer.UI.find("#userinfo").html(profileinfo).attr("uid",s),Chat.hasProfile(s)&&!WmsImpl.isLocalUser(s)?ImgViewer.UI.find("#startchat").show():ImgViewer.UI.find("#startchat").hide(),ImgViewer.UI.find("#profileinfo").show(),ImgViewer.UI.find("#imgnavigation").hide(),ImgViewer.UI.find("#imgviewerdetails").hide(),ImgViewer.UI.find("#imgdetails").hide(),ImgViewer.UI.find("#imgholder").removeClass("imgholder").addClass("posl").hide(),ImgViewer.UI.find("#imgpreviewlist").append('<img id="imgpreview'+s+'" uid="'+s+'">').find("#imgpreview"+s).on("load",function(){ImgViewer.populate(this)}).attr("src",e.attr("imgsrc")).addClass("mrgT40")}else{this.Thumbnails.select(),ImgViewer.UI.find("#imgnavigation").show(),ImgViewer.UI.find("#imgviewerdetails").show(),ImgViewer.UI.find("#imgdetails").show(),ImgViewer.UI.find("#profileinfo").hide(),ImgViewer.UI.find("#imgholder").removeClass("posl").addClass("imgholder").show(),0===this.queue.length&&this.enqueue(e),this.enableNavigation(),this.UI.show();var p,h,g,f,v,C,y=e.parents("[chid]"),b=y.attr("fname"),E=b?!0:!1,I="",T=this.UI.find("#imgviewer-fsendername");if(this.UI.find("#imgloading").show(),this.UI.find("#imgviewer-fforward").show(),this.UI.find("#imgviewer-fdownload").show(),this.UI.find("#imgviewer-openoriginal").show(),this.UI.find("#imgviewer-annotate").hide(),ImgViewer.UI.find("#imgholder").removeAttr("type"),$WC.Matcher.check("imagemimetype",e.attr("contenttype"))&&(ImgViewer.Annotator.loadFiles(function(){ImgViewer.UI.find("#imgviewer-annotate").show()}),ImgViewer.UI.find("#imgholder").attr("type","image")),this.resetWrapperData(),E)p=y.attr("fsender"),g=y.attr("senttime"),f=y.attr("fsendername"),C=Users.getImgUrlById(p,"thumb"),h=y.find("#comment").text(),I=" | <span>"+y.attr("fsize")+"</span>",this.UI.find("#imgviewerdetails").attr("chid",y.attr("chid")).attr("url",y.attr("url")).attr("content",y.attr("content")).attr("fname",b).attr("comment",h).attr("isv1","true"===y.attr("isv1")),this.UI.find("#imgviewer-openoriginal").hide();else{var y=e.parents("[msgtime]"),S=y.prevAll('[purpose="sender"]');v=S.attr("nname"),i(S)?(p=S.attr("sender").split("_")[0],f=$WC.$CUtil.isEmpty(S.attr("customsender_name"))?Users.getName(p,v):S.attr("customsender_name"),C=$(S[0]).find("img").attr("src")):(p=S.attr("sender"),f=$WC.$CUtil.decodeHTMLEntities(Users.getName(p,v)),C=Users.getImgUrlById(p,"thumb")),g=y.attr("msgtime"),b=e.attr("alt"),this.UI.find("#imgviewerdetails").attr("url",e.attr("src")).removeAttr("chid").removeAttr("content").removeAttr("fname").removeAttr("comment"),this.UI.find("#imgviewer-fforward").hide(),this.UI.find("#imgviewer-fdownload").hide()}I="<span>"+$Date.date(g,{shortmonth:!0})+"</span> | <span>"+$Date.time(g)+"</span>"+I,this.UI.find("#imgviewer-fname").html(b).attr("title",b),this.UI.find("#imgviewer-fdetails").html(I),this.UI.find("#imgviewer-fsender").attr("src",C),T.text(f),h?(T.removeClass("litbxtitone"),this.UI.find("#imgviewer-fcomment").html('<span class="msi-qut"></span>'+$WC.$CUtil.processXSS(h))):(T.addClass("litbxtitone"),this.UI.find("#imgviewer-fcomment").empty()),$("#imgmaskbg").show();var R=e.attr("contenttype");if("undefined"!=typeof R&&-1===R.indexOf("image"))this.populateAttachment(e);else{var A=this.UI.find("#imgpreview"+this.currimgpos);if(this.UI.find("#imgholder").hide(),A.length){if(this.populate(A[0]),ImgViewer.isZoomAvailableForCurrent()){var M=this.UI.find("#zoomimgpreview"+this.currimgpos);this.populateOrigImage(M[0])}}else{var U=e.attr(e.attr("previewfilesrc")?"previewfilesrc":"src");this.UI.find("#imgpreviewlist").append('<img id="imgpreview'+this.currimgpos+'">').find("#imgpreview"+this.currimgpos).on("load",function(){var t=$(this)[0].id;t.substring("imgpreview".length)==ImgViewer.currimgpos&&("true"==e.attr("hasthumbnail")&&(e.attr("src").endsWith("/thumbnail")||e.attr("src").indexOf("thumbnail")>0)&&(ChatUI.addToImageCache(U),e.attr("src",U)),ImgViewer.populate(this),ImgViewer.isZoomAvailableForCurrent()&&(ImgViewer.UI.find("#imgpreviewlist").append('<div id="zoomimgholder'+ImgViewer.currimgpos+'" class="zoomimgholder"></div>'),ImgViewer.UI.find("#zoomimgholder"+ImgViewer.currimgpos).append('<img id="zoomimgpreview'+ImgViewer.currimgpos+'" zoom="true" class="zoomedimage">').find("#zoomimgpreview"+ImgViewer.currimgpos).on("load",function(){ImgViewer.populateOrigImage(this)}).attr("src",U)))}).on("error",function(){ImgViewer.isImageAttachment(e.prop("tagName"))&&ChatUI.sendUDSDownloadFailureMail(e.parents("[chid]"),!0)}).attr("src",U)}}}}},sizeAttachmentHolder:function(){var e=$(window),t=0,i=(25*this.LEFTMARGIN,this.UI.find("#imgdetails").height()+this.UI.find("#imgviewerdetails").outerHeight()),a=e.width()-50*this.LEFTMARGIN,s=e.height()-i-this.TOPMARGIN,n=this.UI.find("#imgholder");return n.css({width:a,height:s,margin:"auto",top:t}),{imgholderwid:a,imgholderhei:s}},appendDocinHTML:function(e){this.UI.find("#imgpreviewlist").append(e),this.UI.find("#imgpreview"+this.currimgpos).children().on("load",function(){var e=$(this).parent()[0].id;e.substring("imgpreview".length)==ImgViewer.currimgpos&&(ImgViewer.UI.find("#imgloading").hide(),ImgViewer.UI.find("#imgholder").show())})},fileNotPreviewable:function(){this.isPreviewNotPresent()&&(this.UI.find("#imgloading").hide(),this.UI.find("#imgholder").show(),html=$WC.template.replace(Template.NoPreviewAvail,{$nopreview:"common.attachment.nopreview",CURRIMGPOS:this.currimgpos}),this.UI.find("#imgpreviewlist").append(html))},populateDocInIframe:function(e,t){if(this.isImgviewerVisible()&&this.isPreviewNotPresent()){var i=this.sizeAttachmentHolder(),a=this.getIframeHTML(i,e,t);this.UI.find("#imgloading").hide(),this.UI.find("#imgholder").show(),this.UI.find("#imgpreviewlist").append(a)}},isImgviewerVisible:function(){return $("#imgviewer").is(":visible")},isPreviewNotPresent:function(){return 0===$("#imgviewer").find("#imgpreview"+this.currimgpos).length},getIframeHTML:function(e,t,i){return $WC.template.replace(Template.FilePreviewIframe,{CURRIMGPOS:this.currimgpos,WIDTH:e.imgholderwid,HEIGHT:e.imgholderhei,SRC:t,CONTENTTYPE:i,$nopreview:"common.attachment.nopreview"})},populateAttachment:function(e){var t="",i=e.attr("previewfilesrc"),a=e.attr("contenttype"),s=e.attr("filetype"),n="true"===e.attr("hasthumbnail"),r=this.sizeAttachmentHolder();if(this.isPreviewNotPresent())if(MsgUtil.isSupportedEmbedType(a,s)||MsgUtil.isSupportedVideoType(a,s)||MsgUtil.isSupportedAudioType(a,s)){if(MsgUtil.isSupportedEmbedType(a,s))if(this.UI.find("#imgholder").hide(),"undefined"!=typeof DesktopApp&&"application/pdf"==a)t=this.getIframeHTML(r,DesktopApp.getPDFViewerSource(i),a),this.appendDocinHTML(t);else if(MsgUtil.isSupportedDocType(a,s)){var o=e.parents('[documentclick="viewattachment"]').attr("url");this.openDocument(o,a)}else{var l=MsgTemplate.getViewModeLink(i);t=this.getIframeHTML(r,i+l,a),this.appendDocinHTML(t)}else{if(MsgUtil.isSupportedVideoType(a,s))t='<div id="imgpreview'+this.currimgpos+'" class="videoholder"></div>',this.UI.find("#imgholder").hide(),this.populateVideo(this.currimgpos,i,a,s,n);else if(MsgUtil.isSupportedAudioType(a,s)){var c=-1!==a.indexOf("audio")?a:"audio/"+s;t='<div id="imgpreview'+this.currimgpos+'" class="videoholder"><span class="msi-audioicn atchmntcntr"></span><audio class="audioholder" preload=none class="atchmntcntr" style="width:85%;" controls src="'+i+'" type="'+c+'"><div class="nopreviewfiletxt">'+Resource.getRealValue("common.attachment.nopreview")+"</div></audio></div>",this.UI.find("#imgloading").hide()}this.UI.find("#imgpreviewlist").append(t)}this.UI.find("#imgpreview"+this.currimgpos).children("audio,video,iframe").on("error",function(){ImgViewer.UI.find("#imgloading").hide();var e=$(this).parent()[0].id;e.substring("imgpreview".length)==ImgViewer.currimgpos&&ImgViewer.UI.find("#imgpreview"+ImgViewer.currimgpos).html('<div class="nopreviewfiletxt">'+Resource.getRealValue("common.file.notsupported")+"</div>")})}else this.fileNotPreviewable();else this.UI.find("#imgloading").hide(),this.UI.find("#imgpreview"+this.currimgpos).show()},populateVideo:function(e,t,i,a,s){var n=document.createElement("video");n.preload="metadata",n.src=t;var r=-1!==i.indexOf("video")?i:"video/"+a;$(n).on("loadeddata error",function(i){var a;if("error"===i.type)a='<div class="nopreviewfiletxt">'+Resource.getRealValue("common.file.notsupported")+"</div>";else if(s){var o=t+(ChatUI.isUDSDownloadEnabled()?"&x-cli-msg="+encodeURIComponent("{thumbnail:true}"):"/thumbnail");a='<video preload="none" poster="'+o+'" class="atchmntcntr" controls src="'+t+'" type="'+r+'"><div class="nopreviewfiletxt">'+Resource.getRealValue("common.attachment.nopreview")+"</div></video>"}else if(ChatUI.isUDSDownloadEnabled())a='<video preload="none" class="atchmntcntr" controls src="'+t+'" type="'+r+'"><div class="nopreviewfiletxt">'+Resource.getRealValue("common.attachment.nopreview")+"</div></video>",ImgViewer.UI.find("#imgpreview"+e).addClass("msi-video");else{var l=document.createElement("canvas");l.width=1*n.videoWidth,l.height=1*n.videoHeight,l.getContext("2d").drawImage(n,0,0,l.width,l.height),a='<video preload="none" poster="'+l.toDataURL()+'" class="atchmntcntr" controls src="'+t+'" type="'+r+'"><div class="nopreviewfiletxt">'+Resource.getRealValue("common.attachment.nopreview")+"</div></video>"}ImgViewer.UI.find("#imgpreview"+e).append(a),e===ImgViewer.currimgpos&&(ImgViewer.UI.find("#imgloading").hide(),ImgViewer.UI.find("#imgholder").show())})},getImageOffsetInsideHolder:function(){var e={};return e.left=$("#imgpreview"+this.currimgpos).offset().left-$("#imgpreview"+this.currimgpos).parent().offset().left,e.top=$("#imgpreview"+this.currimgpos).offset().top-$("#imgpreview"+this.currimgpos).parent().offset().top,e},setImageDefaultValue:function(e){e.css({left:"0px",top:"0px",width:ImgViewer.currimg.fittedwidth,height:ImgViewer.currimg.fittedheight,cursor:"zoom-in"})},populateOrigImage:function(e){this.setImageDefaultValue($(e));var t=this.getImageOffsetInsideHolder(),i=$("#imgviewer");i.attr("zoomout","false"),$("#zoomimgholder"+this.currimgpos).css({left:t.left,top:t.top,width:ImgViewer.currimg.fittedwidth,height:ImgViewer.currimg.fittedheight,display:"block"}).append('<div id="zoomoption" class="zoomoption"><span class="zoomout" zoom="true" purpose="zoom-out" title="Zoom Out">-</span><span class="msi-srchicon zoomout" purpose="originalimg" title="Reset Zoom">-</span><span class="zoomin" zoom="true" purpose="zoom-in" title="Zoom In">+</span></div>').on("click","[purpose='originalimg']",function(e){$(this).attr("disable")||(ImgViewer.setImageDefaultValue(i.find("#zoomimgpreview"+ImgViewer.currimgpos)),ImgViewer.multiplier=1,ImgViewer.showImgDetails(),i.attr("zoomout","false"),e.preventDefault())})},openDocument:function(e,t){$WC.$CUtil.isEmpty(e)?this.fileNotPreviewable():$ZCAjx.ajax({url:"v1/attachments/"+e+"/preview",type:"GET",ignorableerrorcodes:[7504],success:function(e){var i=e.data.response;i&&ImgViewer.populateDocInIframe(i,t)},error:function(){ImgViewer.isImgviewerVisible()&&ImgViewer.fileNotPreviewable()}})},populate:function(e){this.UI=this.getUI();var t="undefined"!=typeof e.getAttribute("fname")?!0:!1,i=$(window),a=t?this.UI.find("#imgdetails").height()+this.UI.find("#imgviewerdetails").outerHeight():0,s=400,n=300,r=i.width()-2*this.LEFTMARGIN,o=i.height()-a-this.TOPMARGIN,l=0,c=0,d=e.width,u=e.height;if(d>r||u>o){var m=$Util.getAspectRatioFit(d,u,r,o);ImgViewer.currimg.fittedwidth=m.width,ImgViewer.currimg.fittedheight=m.height,ImgViewer.currimg.ratio=m.ratio,d=m.width,u=m.height}var p=d,h=u,g=o/2-h/2,f=r/2-p/2;(s>d||n>u)&&(s>d&&(p=s),n>u&&(h=n),l=g,c=f,g=o/2-h/2,f=r/2-p/2),this.UI.find("#imgloading").hide();var v=this.UI.find("#imgholder"),C=this.UI.find(e);v.css({width:p+2*this.LEFTMARGIN,height:h+this.TOPMARGIN,margin:"auto",top:g}),(0!==l||0!==c)&&(c-=f,l-=g),C.css({width:d,height:u,left:c+this.LEFTMARGIN,top:l+this.TOPMARGIN}),C.show(),v.show().focus()},keyboardNext:function(){this.UI&&!(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)&&this.next(this.UI.find("#imgnext"))},keyboardPrev:function(){this.UI&&!(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)&&this.prev(this.UI.find("#imgprev"))},pauseMediaAndHide:function(e){var t=this.getUI().find("#imgpreview"+e),i=t.find("audio,video");i.length>0&&i[0].pause(),t.hide()},next:function(e){e.hasClass("arwdsb")||(this.clearZoomOptions(),this.pauseMediaAndHide(this.currimgpos),this.currimgpos++,this.show(this.queue[this.currimgpos]))},prev:function(e){e.hasClass("arwdsb")||(this.clearZoomOptions(),this.pauseMediaAndHide(this.currimgpos),this.currimgpos--,this.show(this.queue[this.currimgpos]))},enableNavigation:function(){var e=this.getUI();this.currimgpos>0?e.find("#imgprev").removeClass("arwdsb"):e.find("#imgprev").addClass("arwdsb"),this.currimgpos<this.queue.length-1?e.find("#imgnext").removeClass("arwdsb"):e.find("#imgnext").addClass("arwdsb")},playMedia:function(){if(this.UI){var e=this.getUI().find("#imgpreview"+this.currimgpos).find("audio,video");e.length>0&&(e[0].paused?e[0].play():e[0].pause())}},close:function(){var e=this.getUI();return"block"===e.css("display")?(e.attr("zoomout","false"),e.find("#imgviewerdetails").css("opacity",1),$("#imgmaskbg").hide(),this.clearZoomOptions(),e.hide(),this.queue=[],this.currimgpos=0,e.find("#imgpreviewlist").empty(),e.find("#thumbnails").remove(),this.UI=null,MainUI.setCurrentWinFocus(),!0):!1},isVisible:function(){return null!=this.UI&&"none"!=this.UI.css("display")},Annotator:{loadFiles:function(e){$Util.loadDynamicFiles({type:"link",url:$zcg._CSSTATICURL+"/officechat/styles/annotator-min.css",callback:function(){ImgViewer.Annotator.loadJSFile(e)}})},loadJSFile:function(e){$Util.loadDynamicFiles({type:"script",url:$zcg._JSSTATICURL+"/officechat/js/annotator-min.js",callback:function(){e()}})},close:function(){var e=document.getElementById("zimageeditor");return e?($(e).find(".zimageeditor__cancel").trigger("click"),!0):void 0},annotateAndForwardImage:function(e,t,i){var a=e.attr("url"),s=e.attr("chid"),n=e.attr("fname"),r=e.attr("content"),o="true"===e.attr("isv1");a.startsWith("data")||(a="/v1/attachments/"+a);var l=e.find("#filecommentlimit"+s+0).text();$Util.annotateImage({type:r,name:n,url:a,load:function(){ImgViewer.close()},success:function(a){$WC.$Win.destroy("fileforwardwin");var c;t&&(c={fillusersuggestfield:!0,sugguserid:t,suggusertype:i}),FileForwardUI.handle(s,r,a,n,l,o,"true"===e.attr("hasthumbnail"),c)}})}}};var $Date=function(){var e=["date.january","date.february","date.march","date.april","date.may","date.june","date.july","date.august","date.september","date.october","date.november","date.december"],t=["date.jan","date.feb","date.mar","date.apr","date.may","date.jun","date.jul","date.aug","date.sep","date.oct","date.nov","date.dec"],i=["date.sunday","date.monday","date.tuesday","date.wednesday","date.thursday","date.friday","date.saturday"],a=["date.sun","date.mon","date.tue","date.wed","date.thu","date.fri","date.sat"],s=[Resource.getRealValue("date.today"),Resource.getRealValue("date.yesterday"),Resource.getRealValue("date.tomorrow")],n={seconds:"Just now",minute:"%d min",minutes:"%d mins",hour:"%d hour",hours:"%d hours",day:"Yesterday",days:"%d days",month:"%d month",months:"%d months",year:"about a year",years:"%d years",suffixago:"ago"},r=function(e){return{date:e.getDate(),day:e.getDay(),month:e.getMonth(),year:e.getFullYear(),hours:e.getHours(),minutes:e.getMinutes(),object:e}};return{append0:function(e){return 10>e?"0"+e:e},get:function(e){return"undefined"!=typeof e?"string"==typeof e||"number"==typeof e?r(new Date(Number(e))):e:r(new Date)},isSameDay:function(e,t){var i=this.get(e),a=t?this.get(t):this.get();return i.year===a.year&&i.month===a.month&&i.date===a.date},isOnSameTime:function(e,t){var i=this.get(e),a=t?this.get(t):this.get();return i.year===a.year&&i.month===a.month&&i.date===a.date&&i.hours===a.hours&&i.minutes===a.minutes},isSameYear:function(e){var t=this.get(e),i=this.get();return t.year===i.year},getDateSuffix:function(){return""},getDateString:function(e,t){var i=this.get(e),a=i.date;return t?a+this.getDateSuffix(a):a},getDayString:function(e,t){var s=this.get(e),n=this.get(),r=s.day;if(s.year===n.year&&s.month===n.month){var o=s.date,l=n.date;if(o===l)return Resource.getRealValue("date.today");if(o===l-1)return Resource.getRealValue("date.yesterday");if(o===l+1)return Resource.getRealValue("date.tomorrow")}return Resource.getRealValue(t?a[r]:i[r])},getMonthString:function(i,a){var s=this.get(i);return Resource.getRealValue(a?t[s.month]:e[s.month])},time:function(e){var t=this.get(e),i=t.hours,a=t.minutes,s=this.append0(a);return i>=12?(12===i?i:this.append0(i-12))+":"+s+" PM":(0===i?12:this.append0(i))+":"+s+" AM"},date:function(e,t){var i={withtime:!1,withday:!1,shortmonth:!1,shorten:!1,datesuffix:!0,shortday:!1},t=$.extend({},i,t),a=this.get(e),n=this.isSameYear(e)?"":"&nbsp;"+a.year,r=this.getMonthString(e,t.shortmonth),o=this.getDateString(e,t.datesuffix),l=this.getDayString(e,t.shortday),c="";return c=s.indexOf(l)>-1?t.shorten?l:l+",&nbsp;"+r+"&nbsp;"+o:(t.withday?l+",&nbsp;":"")+r+"&nbsp;"+o+n,c+(t.withtime?",&nbsp;"+this.time(e):"")},day:function(e,t){var i={shortday:!1,shortmonth:!1,shorten:!1,datesuffix:!0},t=$.extend({},i,t),a=this.get(e),n=this.getDayString(e,t.shortday),r=this.getDateString(e,t.datesuffix),o=this.getMonthString(e,t.shortmonth);return s.indexOf(n)>-1?t.shorten?n:n+",&nbsp;"+o+"&nbsp;"+r:n+",&nbsp;"+o+"&nbsp;"+r+(this.isSameYear(e)?"":"&nbsp;"+a.year)},daytime:function(e,t){var i={withtime:!1,raw:!1,shortday:!1,shortmonth:!1,shorten:!1,datesuffix:!0},t=$.extend({},i,t),a=this.get(e),n=this.getMonthString(e,!0),r=this.time(a),o=this.getDayString(e,t.shortday),l="";if(t.stringformat){var c=new Date(Number(e)),d=this.isSameYear(e)?"":", "+c.getFullYear();return this.getDayString(e)+" "+this.getDateString(e)+" "+this.getMonthString(e,t.shortmonth)+d+" "+$Date.time(e)}if(l=this.isSameDay(e)?r:s.indexOf(o)>-1?o+", "+r:n+" "+this.getDateString(e,!0)+(this.isSameYear(e)?"":" "+a.year)+", "+r,t.raw)return l;var u={withtime:t.withtime,withday:!0,shortmonth:t.shortmonth,shorten:t.shorten};return"<span title='"+this.date(e,u)+"'>"+l+"</span>"},relative:function(e,t){var i={shorten:!1};$.extend(i,t);var a=this.getRelativeTimeString(e,i);return i.shorten?a:"<span title='"+this.date(e,{withtime:!0,withday:!0})+"'>"+a+"</span>"},relativetimeleft:function(e){var t="",i=parseInt(e)-+new Date;if(i/=1e3,60>=i)return Resource.getRealValue("common.less.than.min");if(i>86400){var a=parseInt(i/86400);t+=1===a?a+" Day ":a+" Days ",i%=86400}if(i>3600){var a=parseInt(i/3600);t+=1===a?a+" Hour ":a+" Hours ",i%=3600}if(i>60){var a=parseInt(i/60);t+=1===a?a+" Min ":a+" Mins ",i%=60}return t+=" left"},relativeDays:function(e){var t=+new Date-parseInt(e),i=parseInt(Math.abs(t)/864e5);return i},getOtherZoneTime:function(e,t){var i=new Date,a=i.getTime()+6e4*i.getTimezoneOffset(),s=this.time(a+parseInt(t));return timestring=s+" ( "+e+" )"},getDaysArray:function(){for(var e=[],t=0;t<i.length;t++)e[t]=Resource.getRealValue(i[t]);return e},getRelativeTimeString:function(e,t){var i=n;t.shorten&&$.extend(i,{seconds:"Just now",minute:"%dm",minutes:"%dm",hour:"%dh",hours:"%dh",day:"%dd",days:"%dd",month:"%d mo",months:"%d mo",year:"%dy",years:"%dy",suffixago:"ago"});var a=+new Date-parseInt(e),s=a>6e4,r=Math.abs(a)/1e3,o=r/60,l=o/60,c=l/24,d=c/365,u=function(e,t,a){var s=a?"":i.suffixago;return e.replace(/%d/i,t)+" "+s},m=60>r&&u(i.seconds,parseInt(r),!s)||120>r&&u(i.minute,1,!s)||60>o&&u(i.minutes,parseInt(o),!s)||120>o&&u(i.hour,1,!s)||24>l&&u(i.hours,parseInt(l),!s)||48>l&&u(i.day,1,!t.shorten||!s)||30>c&&u(i.days,parseInt(c),!s)||60>c&&u(i.month,1,!s)||365>c&&u(i.months,parseInt(c/30),!s)||2>d&&u(i.year,1,!s)||u(i.years,parseInt(d),!s);return m}}}(),Sound={};Sound={IS_AUDIO_TAG_SUPPORTED:!1,MAX_LOOP:100,MIN_LOOP:1,IS_FLASH_EXIST:!1,supported_audio_formats:[],supported_video_formats:[],extn:"mp3",cache:{},timer:0,callback:null,playing:0,MENTION_TONE:"Cue",MEDIA_PATH:"/officechat/sound/",tonemapping:{0:"None",1:"Cora",2:"Cue",3:"Celesta",4:"Hail",5:"Bell",6:"Pac",7:"Ting",8:"Triangle",9:"Wink",10:"Heavenly",11:"ViolinPing",12:"Reverberate",13:"Speedy",14:"MusicboxDuo",15:"MusicboxTriplet"},init:function(){if(Sound.usertonesmapping={DIRECT_MESSAGE_TONE:this.tonemapping[Settings.getFromObj("smymessage")],ALL_MESSAGE_TONE:this.tonemapping[Settings.getFromObj("smessage")],EVENT_REMINDER_TONE:this.tonemapping[Settings.getFromObj("scalendar")]},"undefined"!=typeof window.Audio?(this.extn=""!==(new Audio).canPlayType("audio/wav")&&"no"!==(new Audio).canPlayType("audio/wav")?"wav":"mp3",this.IS_AUDIO_TAG_SUPPORTED=!0,Sound.initSupportedAudioFormats(),Sound.initSupportedVideoFormats(),Sound.bindEvents()):("undefined"!=typeof window.ActiveXObject&&new ActiveXObject("ShockwaveFlash.ShockwaveFlash")||void 0!==typeof navigator.mimeTypes["application/x-shockwave-flash"])&&(this.IS_FLASH_EXIST=!0),this.IS_FLASH_EXIST){var e=window.location.protocol,t=document.createElement("SPAN");t.style.position="absolute",t.style.top="-10000px",t.style.left="-10000px",t.style.display="block",t.innerHTML='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+e+'//fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" width="28" height="20" id="audioplayer" align="middle" wmode="transparent"><param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="flash/player.swf" /><param name="quality" value="high" /><param name="bgcolor" value="" /><param name="wmode" value="transparent"/><embed src="flash/player.swf" quality="high"  width="28" height="20" name="audioplayer" align="middle" allowScriptAccess="sameDomain" wmode="transparent" type="application/x-shockwave-flash" pluginspage="'+e+'//www.macromedia.com/go/getflashplayer" /></object>',document.body.appendChild(t)}},initSupportedAudioFormats:function(){for(var e=new Audio,t=["mp3","mpeg","wav","aac","amr","flac","gsm","tta","wv","x-wav"],i=0,a=t.length;a>i;i++)""!==e.canPlayType("audio/"+t[i])&&"no"!==e.canPlayType("audio/"+t[i])&&this.supported_audio_formats.push("audio/"+t[i])},initSupportedVideoFormats:function(){var e=document.createElement("video");this.IS_VIDEO_TAG_SUPPORTED=!!e.canPlayType;for(var t=["webm","mkv","flv","ogg","avi","mov","qt","wmv","asf","mp4","3gp"],i=0,a=t.length;a>i;i++)""!==e.canPlayType("video/"+t[i])&&"no"!==e.canPlayType("video/"+t[i])&&this.supported_video_formats.push("video/"+t[i])},bindEvents:function(e){var t=$.extend({},this.tonemapping,this.usertonesmapping),i=e?this.tonemapping:this.usertonesmapping,a=function(e){var t=$(e.data).attr("src").substr(($zcg._MEDIASERVERURL+Sound.MEDIA_PATH).length);Sound.playing=$Util.getKeyByValue(Sound.tonemapping,t.split(".")[0]),PersonalizeUI.handleSound(!0)},s=function(){PersonalizeUI.handleSound(!1,function(){Sound.playing=0})};for(var n in i){var r=t[n];if("None"!=r){("undefined"==typeof this.cache[r]||4!==this.cache[r].readyState)&&(this.cache[r]=new Audio($zcg._MEDIASERVERURL+this.MEDIA_PATH+r+"."+this.extn));var o=$(this.cache[r]);o.bind("play",o,a),o.bind("ended",s)}}},toggleMuteAll:function(){"0"===$("#ztb-globalmute").attr("mute")?(Sound.globalSoundDisabled(),Settings.update({globalsoundnotify:0},null,Sound.globalSoundEnabled)):(Sound.globalSoundEnabled(),Settings.update({globalsoundnotify:1},null,Sound.globalSoundDisabled))},globalSoundDisabled:function(){$("#ztb-globalmute").removeClass("msi-glmute").addClass("msi-glunmute").attr({mute:"1",title:Resource.getRealValue("common.globalunmute")})},globalSoundEnabled:function(){$("#ztb-globalmute").removeClass("msi-glunmute").addClass("msi-glmute").attr({mute:"0",title:Resource.getRealValue("common.globalmute")})},isSupportedAudioFormat:function(e){return this.supported_audio_formats.indexOf(e)>-1?!0:!1},isSupportedVideoFormat:function(e){return this.supported_video_formats.indexOf(e)>-1?!0:!1},play:function(e,t){if("None"!==e)if(clearTimeout(this.timer),Sound.playing>0&&(this.stop(Sound.tonemapping[Sound.playing]),PersonalizeUI.handleSound(!1)),"undefined"!=typeof t&&(this.callback=t.callback),this.IS_AUDIO_TAG_SUPPORTED)"undefined"==typeof this.cache[e]||4!==this.cache[e].readyState?this.cache[e]=new Audio($zcg._MEDIASERVERURL+this.MEDIA_PATH+e+"."+this.extn):0!==this.cache[e].currentTime&&(this.cache[e].currentTime=0),"undefined"!=typeof t&&"undefined"!=typeof t.duration?(this.cache[e].loop=!0,this.cache[e].play(),this.timer=setTimeout(function(){Sound.stop(e)},t.duration)):this.cache[e].play();else if(this.IS_FLASH_EXIST){var i=window.document.audioplayer;"undefined"!=typeof t&&"undefined"!=typeof t.duration?(i.SetVariable("_root.loops",this.MAX_LOOP),i.TCallLabel("_root.$listener","setloops"),i.SetVariable("_root.$listener.fpath",$zcg._MEDIASERVERURL+this.MEDIA_PATH+e+"."+this.extn),i.TCallLabel("_root.$listener","playfile"),this.timer=setTimeout(function(){Sound.stop()},t.duration)):(i.SetVariable("_root.loops",this.MIN_LOOP),i.TCallLabel("_root.$listener","setloops"),i.SetVariable("_root.$listener.fpath",$zcg._MEDIASERVERURL+this.MEDIA_PATH+e+"."+this.extn),i.TCallLabel("_root.$listener","playfile"))}},stop:function(e){this.IS_AUDIO_TAG_SUPPORTED&&"undefined"!=typeof this.cache[e]?this.cache[e].pause():this.IS_FLASH_EXIST&&window.document.audioplayer.TCallLabel("_root.$listener","stopSound"),"function"==typeof this.callback&&(this.callback(),this.callback=null)}};var NotifyByTitle={};NotifyByTitle={defaulttitle:Resource.getRealValue("common.title.tag.info",["null"===$zcg._APPACCOUNTNAME?Resource.getRealValue("common.title.tag"):$zcg._APPACCOUNTNAME]),start:function(e,t){clearTimeout(this.timer),this.flag=0,this.timer="",this.show(e,t)},show:function(e){var t=this.flag?this.defaulttitle:e;document.title=t,this.flag^=!0,clearTimeout(this.timer),this.timer=setTimeout(function(){NotifyByTitle.show(e)},800)},stop:function(){clearTimeout(this.timer),this.flag=0,document.title=this.defaulttitle}};var Cookie={};Cookie={get:function(e){var t=document.cookie.indexOf(e),i=document.cookie.length,a=null;if(-1!==t){var s=e.length,n=t+s;a=document.cookie.substr(n+1,i),-1!==a.indexOf(";")&&(a=a.substring(0,a.indexOf(";")))}return a},set:function(e,t,i){var a=new Date;return(null===i||""===i)&&(i=2592e6),a.setTime(a.getTime()+i),document.cookie=e+"= "+t+";expires= "+a.toGMTString()+";path= /",!0},remove:function(e){var t=Cookie.get(e);if(t){var i=new Date;document.cookie=e+"=;expires= "+i.toGMTString()+"; path= /"}return t}};var CloudFilePreviewHandler={getFiles:function(e){e=JSON.parse(e);var t=[];for(var i in e)for(var a=e[i],s=0;s<a.length;s++){var n=a[s],r={service:i,fromCloud:!0,size:0,name:decodeURIComponent(n.docName)};r=$.extend({},r,n),t.push(r)}return t},showPreview:function(e){$WC.$Win.handleEscape(),FileUploadUI.handlePreview(e.chid,this.getFiles(e.cloudFiles))}},FileUploadHandler={},$FileUpload=function(e){this.chid=e,this.uploadedfilecount=0,this.filesdetails={},this.total=0,this.uploaded=0,this.startingtime=(new Date).getTime()};$FileUpload.prototype={getTotalFileCount:function(){return this.uploadedfilecount+$Util.getObjectKeysLength(this.filesdetails)},getSharingFilesCount:function(){var e=this.uploadedfilecount+1,t=this.getTotalFileCount();return e>t?t:e},getRemainingFilesCount:function(){return $Util.getObjectKeysLength(this.filesdetails)},getFileDetails:function(e){return e?this.filesdetails[e]:this.filesdetails},getReplyMsgId:function(){var e=this.repliedmsguid;return delete this.repliedmsguid,e},addFileForUpload:function(e,t,i,a){var s=this.getTotalFileCount(),n=e.name;if(!n){var r=e.type,o=r.substring(r.indexOf("/")+1,r.length);n=Resource.getRealValue("common.file.autofill.name")+" - "+$Date.time($Util.getSyncedCurrentTime())+"."+o,e.name=n}n=n+"_"+s+"_"+$Util.getSyncedCurrentTime(),"undefined"==typeof this.filesdetails[n]&&(this.filesdetails[n]=[],this.filesdetails[n].fileobj=e,this.filesdetails[n].comment=t,this.filesdetails[n].uploaded=0,this.filesdetails[n].total=e.size,this.filesdetails[n].startingtime=(new Date).getTime(),this.filesdetails[n].req=null,this.filesdetails[n].progressing=!1,this.filesdetails[n].fromTextAsAttachment=!1,this.filesdetails[n].fromCloud=!!a,this.total=this.total+e.size)},isAlreadyInProgress:function(){for(var e in this.filesdetails)if(null!==this.filesdetails[e].req)return!0;return!1},updateProgressDetails:function(e,t){t>this.filesdetails[e].uploaded&&(this.uploaded=this.uploaded+(t-this.filesdetails[e].uploaded),this.filesdetails[e].uploaded=t)},removeFileFromUpload:function(e,t){var i=this.filesdetails;if(e){if(!$.isEmptyObject(i)&&"undefined"!=typeof i[e]){var a=i[e].req;if(null===a||t)t&&(this.uploadedfilecount=this.uploadedfilecount+1);else if(0===a.status&&"abort"===a.statusText){var s=i[e].fileobj.size-i[e].uploaded;this.uploaded=this.uploaded+(s>0?s:0)}else i[e].req.abort();delete this.filesdetails[e]}}else{var n={};for(var r in i)"undefined"!=typeof i[r]&&null!==i[r].req?n[r]=i[r]:delete this.filesdetails[r];for(var o in n)n[o].req.abort(),delete this.filesdetails[o]}}},FileUploadHandler=function(){var e={},t=function(e,t){FileUploadHandler.startFileUpload(e,t)},i=function(e,t,i){var a=i.fnametosend,s=i.filedetails,n=i.fup,r=i.additionalparam,o={"Content-type":encodeURIComponent(s.fileobj.type),"x-streammode":"1","x-service":$zcg.UDS_CLIQ_SERVICE,charset:"UTF-8","x-dfs-service":"zfs","upload-id":e,"x-cliq-content-type":encodeURIComponent(s.fileobj.type),"file-name":encodeURIComponent(a),"x-cliq-sid":WmsImpl.getSid(),"x-cliq-msgid":t};return $WC.$CUtil.isEmpty(s.comment)||(o["x-cliq-comment"]=encodeURIComponent(s.comment)),r&&r.type&&(o["x-cliq-type"]=r.type),n.repliedmsguid&&(o["x-cliq-repliedmsguid"]=n.getReplyMsgId()),o},a=function(e,t){if(e.length>t){var i=e.lastIndexOf("."),a=i>0?e.substring(i):"";a=a.length>t/2?a.substring(0,t/2):a,e=i>0?e.substring(0,i):e,e=e.substring(0,t-(a.length+1))+a}return e},s=function(e,t,i,a){var s="common.file.upload.error";if(i)if($WC.$CUtil.isEmpty(t)||$WC.$CUtil.isEmpty(t.getResponseHeader("x-error")))a&&a["x-cliq-comment"]&&(a["x-cliq-comment"]="****"),_sendDebugMail("Unable to upload file via UDS for user "+$zcg._ZUID+" | "+window.location.origin+" | "+JSON.stringify(a),"UDS Unable to upload File");else{var n=JSON.parse(t.getResponseHeader("x-error"));$WC.$CUtil.isEmpty(n.error_key)||(s=n.error_key)}else $WC.$CUtil.isEmpty(e)||$WC.$CUtil.isEmpty(e.error_key)||(s=e.error_key);return s},n=function(e,n,l,c){var d=l.progresscallback,u=l.successcallback,m=l.errorcallback,p=FileUploadHandler.getLivefupObj(e),h=p.getFileDetails(n),g=$Util.getSyncedCurrentTime();0==p.uploaded&&(p.startingtime=(new Date).getTime());var f=a($WC.Matcher.replace("invalidfilenamechars",h.fileobj.name,"-"),FileUploadUI.MAX_ALLOWED_FILE_NAME_LENGTH),v=ChatUI.isUDSUploadEnabled()&&!h.fromCloud&&!$WC.$CUtil.isEmpty(h.fileobj.type),C=h.fromCloud,y={},b={url:v?$zcg._UPLOADSERVERURL+"/webupload":"/v1/attachments",type:"POST",processData:C,trialExecutionChid:e,xhr:function(){return"function"==typeof d?d(e,n):void 0},success:function(i){FileUploadHandler.cleanUpFileUpload(e,l,n,!0),"function"==typeof u&&u(e,n,i),t(e,l)}};if(v)y=i(e,g,{fnametosend:f,filedetails:h,fup:p,additionalparam:c}),b=$.extend(b,{headers:y,xhrFields:{withCredentials:!0},internalCrossDomain:"true",data:h.fileobj,contentType:!1});else{var E=[],I={id:e,sid:WmsImpl.getSid()};if(I=c?$.extend(I,c):I,E.push([h.fileobj,f,h.comment]),E=o(E),E=r(E,C),$WC.$CUtil.isEmpty(E.comments)||(I.comment=JSON.stringify(E.comments)),p.repliedmsguid&&(I.repliedmsguid=p.getReplyMsgId()),C){var T=$Util.cloneObject(h.fileobj,!0);T.name=E.filesdetails[0][1],delete T.size,I.cloudfiles=JSON.stringify(T),b=$.extend(b,{data:I})}else b=$.extend(b,{data:$ZCAjx.formData(I,"files",E.filesdetails,!0),contentType:!1})}MyBots.needsLocation(e)&&(b.setLocation=!0),h.startingtime=(new Date).getTime(),h.req=$ZCAjx.ajax($.extend(b,{error:function(i,r){if(FileUploadHandler.cleanUpFileUpload(e,l,n),"function"==typeof m&&m(e,n),"abort"!==r.statusText){var o=s(i,r,v,y);UI.updateBanner(Resource.getRealValue(o,[$WC.$CUtil.processXSS(a(h.fileobj.name,30)),$Util.getFileSize(FileUploadUI.MAX_ALLOWED_FILE_SIZE)]),3e3,!0)}t(e,l)}}))},r=function(e){var t={};t.comments={},t.filesdetails=[];for(var i=!1,a=e.length,s=0;a>s;s++)if(e[s][2]){i=!0;break}for(s=0;a>s;s++){var n=e[s],r=n.splice(2,1)[0];i&&(n[1]=s+1+"_"+n[1],r&&(t.comments[s+1]=r)),t.filesdetails.push(n)}return t},o=function(e){return"undefined"==typeof e[1]&&e[0].hasOwnProperty("name")&&(e[1]=e[0].name),e};return{islivefupExist:function(t){return e.hasOwnProperty(t)},getLivefupObj:function(t){return e[t]},setReplyMsgId:function(t,i){return e[t].repliedmsguid=i},addFileForUpload:function(t,i,a,s){this.islivefupExist(t)||(e[t]=new $FileUpload(t));var n=this.getLivefupObj(t),r=!1;i.fromCloud&&(r=i.fromCloud,delete i.fromCloud),n.addFileForUpload(i,a,s,r)},startFileUpload:function(e,t,i){if(this.islivefupExist(e)){var a=this.getLivefupObj(e);if(!a.isAlreadyInProgress()){var s=Object.keys(a.filesdetails)[0];n(e,s,t,i),FileUploadUI.toggleCancelButton(e,s,!a.filesdetails[s].fromCloud)}}},cleanUpFileUpload:function(t,i,a,s){var n=!this.islivefupExist(t)||$WC.$CUtil.isEmpty(a),r=this.getLivefupObj(t);if(n||!this.islivefupExist(t)||$WC.$CUtil.isEmpty(a)||r.removeFileFromUpload(a,s),(n||0==r.getRemainingFilesCount())&&($WC.$CUtil.isEmpty(i)||"function"!=typeof i.oncompletecallback||i.oncompletecallback(t),this.islivefupExist(t))){var r=this.getLivefupObj(t);r.removeFileFromUpload(),delete e[t]}},isAjaxUploadCompatible:function(){return"undefined"!=typeof(new XMLHttpRequest).upload}}}();var FileUploadUI={},FileForwardUI={},CommandFileUploadUI={},CloudPickerUI={};CloudPickerUI=function(){var e=function(e){var i=$WC.$Win.create({id:"filepickerwin","class":"fileupldwin zccomwin",header:'<div class="ellips">'+("hi"===$zcg._LANG?Resource.getRealValue("common.share.with",[ChatUI.getTitle(e)]):Resource.getRealValue("common.share.with")+" "+ChatUI.getTitle(e))+"</div>",html:a(e)});t(e,i)},t=function(e,t){t.find("#cloudpickeriframe").on("load",function(){$(this).show(),t.find("#filepickerloader").hide()})},i=function(e,t){if(t){e+="?";for(var i in t)e+=i+"="+t[i]+"&";e=e.slice(0,-1)}return e},a=function(e){var t={sources:["zohodocs","gdrive","dropbox","skydrive","box","evernote"],zservice:"zcliq",frameorigin:$zcg._SERVERURL,attachLimit:5,serURL:$zcg._SERVERURL+"/cloudpicker.do?chid="+e,customCss:$zcg._CSSTATICURL+"/officechat/styles/pages/cloudpicker_min.css"};return Template.FilePickerWindow.replace(/{URL}/g,i($zcg._GADGETSURL+"/CloudPicker",t))};return{handlePreview:function(t){e(t)},showTour:function(e){if(!$WC.$Win.isExist("filepickertourwin")){Settings.update({cloud_picker_tour:"1"});var t=function(e){var t=e.replace("filepickertourwin","");Clickoutside.bind({destid:"filepickeractionsholder"+t,callback:function(e,t){var i=$("#"+t);i.removeClass("vsble");var a=t.replace("filepickeractionsholder",""),s=i.find("[purpose=cloudatchmnt"+a+"]");s.html(Resource.getRealValue("common.attach.method.cloud")),s.removeClass("touractive"),i.show()}})},i=Settings.isDarkModeChoosed()?"-dark":"";$WC.$Win.create({id:"filepickertourwin"+e,"class":"sharefileT",html:Template.CloudPickerTour.replace(/{CHID}/g,e).replace(/{theme_mode}/g,i),closefn:t})}}}}(),FileUploadUI=function(){var e={},t=function(t,i,a){var s="fileuploadwin";$WC.$CUtil.isEmpty(e[t])||(i=Array.prototype.slice.call(i).concat(e[t])),$WC.$Win.isExist(s)&&$WC.$Win.destroy(s);var n='<div class="ellips">'+("hi"===$zcg._LANG?Resource.getRealValue("common.share.with",[ChatUI.getTitle(t)]):Resource.getRealValue("common.share.with")+" "+ChatUI.getTitle(t))+"</div>";1===i.length&&$WC.Matcher.check("imagemimetype",i[0].type)&&(n+='<div id="annotate" class="msi-edit annotate ellips" chid="'+t+'" purpose="annotateImg">'+Resource.getRealValue("common.edit")+"</div>");var r=$WC.$Win.create({id:s,"class":"fileupldwin zccomwin",header:n,html:d(t,i,a),closefn:function(){FileUploadHandler.islivefupExist(t)&&!FileUploadHandler.getLivefupObj(t).isAlreadyInProgress()&&FileUploadHandler.cleanUpFileUpload(t),delete e[t],h(t)}});ImgViewer.Annotator.loadFiles(function(){r.find('[purpose="annotateImg"]').show()}),$("#filecommentlimit"+t+"0").focus(),u(t,i,r),FileUploadUI.bindEvents(t,r),p(t,i),e[t]=Array.prototype.slice.call(i)},i=function(e){return e.fromCloud?"":" - ("+$Util.getFileSize(e.fileobj.size)+")"},a=function(t,i){var a=e[i];if(a)for(var s=0;s<a.length;s++){var n=a[s],r=t.find("#filecommentlimit"+i+s).text();n.comment=r}},s=function(i,a){var s=(i.attr("fileextn"),parseInt(i.attr("fileindex"))),n=$WC.$CUtil.cloneObject(e),r=n[a][s],o=i.find("img").attr("src");$WC.Matcher.check("imagemimetype",r.type)&&$Util.annotateImage({url:o,type:r.type,name:r.name,success:function(e){$WC.$Win.destroy($WC.$Win.isExist("fileuploadwin")?"fileuploadwin":"fileforwardwin"),e.comment=r.comment,n[a][s]=e,t(a,n[a])}})},n=function(e,t){var a=FileUploadHandler.getLivefupObj(e),s=a.getFileDetails(),n="",r=$("#"+e+"_filepbar");if(a.getTotalFileCount()>1){var o=!0;for(var l in s){var c=r.find('[filename="'+l+'"]');if(0===c.length){var d=s[l],u=Template.UploadingFilesDiv,m=d.fromCloud&&null!=d.req;u=u.replace(/{FILE_DISPLAY_NAME}/g,$WC.$CUtil.processXSS(d.fileobj.name)+i(d)).replace(/{INDETERMINATE}/g,m?"posa prgrs-bar":"").replace(/{DISPLAY}/g,m?'style="display:none;"':"");var p=$("<div>"+u+"</div>");p.find("[filename]").attr("filename",l),n+=p[0].innerHTML,o=!1}}var h=r.find("#expandfilescontainer").append(n);o?r.find("#expandfilescontainer").perfectScrollbar("update"):r.find("#expandfilescontainer").perfectScrollbar(),h.find(".msi-close").on("click",function(i){var a=i.currentTarget.getAttribute("filename");FileUploadUI.cleanUpFileUpload(e,t,a)})}f(r,e,a)},r=function(e,t,i){var a=$("#"+e+"_filepbar");if(t){var s=a.find('[filename="'+t+'"]');i?(s.find(".msi-close").removeClass("msi-close").addClass("msi-hissel"),setTimeout(function(){s.slideUp()},2e3)):s.slideUp(),a.find("#expandfilescontainer").perfectScrollbar("update")}else a.find("#expandfilescontainer").slideUp(400,function(){$(this).empty()}),a.find("#zcfileexpandicon").removeClass("msi-shrink").addClass("msi-expand"),a.fadeOut(),a.find("#fileupldprgbr"+e).show();f(a,e)},o=function(e){if("none"!==$("#msgoptionspreview"+e).css("display")){var t=$("#msgoptionspreview"+e).attr("msguid");$WC.$CUtil.isEmpty(t)||FileUploadHandler.setReplyMsgId(e,t),MessageOperations.clearreplypreview(e)}},l=function(e,t){function i(e){return e instanceof File}return ChatUI.hasPermission(e,"fileshare")?i(t[0])&&$Util.isFilesizeExceeded(t,FileUploadUI.MAX_ALLOWED_FILE_SIZE)?($Util.showInvalidFileAlert($("#file"+e),t.length>1?$Util.CUMULATIVEFILESIZE_INVALID:$Util.FILESIZE_INVALID,parseInt(FileUploadUI.MAX_ALLOWED_FILE_SIZE/1048576)),h(e),!1):null===e?!1:!0:($WC.$Dlg.alert({id:"filetransfernotsupported",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("common.file.transfer.not.supported")]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-red"></div>'}),buttons:[{text:Resource.getRealValue("common.okgotit"),colour:$WC.$Dlg.GREEN_BUTTON}]}),!1)},c=function(e,t){for(var i="",a=t.length,s=0;a>s;s++)i+=Template.FilePreviewInFileUploadWindow.replace(/{CHID}/g,e).replace(/{FILEINDEX}/g,s).replace(/{COMMENTPLACEHOLDER}/g,Resource.getRealValue("common.add.comment")+" ("+Resource.getRealValue("common.uploadfile.shortcut")+")").replace(/{ANNOTATE}/g,a>1&&$WC.Matcher.check("imagemimetype",t[s].type)?'<div chid="'+e+'" purpose="annotateImg" class="msi-edit" title='+Resource.getRealValue("common.edit")+"></div>":"");return i},d=function(e,t,i){var a=Template.FileUploadWindow,s=t.length;return a=1===s?a.replace(/{FILESCOUNTCLASS}/g,"zppwd1"):2===s?a.replace(/{FILESCOUNTCLASS}/g,"zppwd2"):a.replace(/{FILESCOUNTCLASS}/g,""),a=a.replace(/{FILESLIST}/g,c(e,t)).replace(/{CLEAR_COMPOSER}/g,i?"true":"false")},u=function(e,t,i){var a=i.find('[type="file"]'),s=0,n=t.length;for(1===n&&i.find(a[s]).find('[purpose="close"]').hide();n>s;s++){var r=t[s],o=r.name,l="";o||(o=FileUploadUI.generateName(r));var c=o.lastIndexOf("."),d=i.find(a[s]),u=d.find('[type="preview"]');-1!==c?l=o.substring(c):c=o.length,o=o.substring(0,c),o=$WC.Matcher.replace("invalidfilenamechars",o,"-"),o=o.substring(0,FileUploadUI.MAX_ALLOWED_FILE_NAME_LENGTH-(l.length+1)),d.attr("fileextn",l),d.find('[type="name"]').text(o).attr("data-val",o),d.find("#filecommentlimit"+e+s).html($WC.$CUtil.processXSS(r.comment)),d.attr("content",r.type),m(d,u,r)}},m=function(e,t,i){if($WC.Matcher.check("imagemimetype",i.type)){var a=new FileReader;a.onload=function(e){t.html('<img src="'+e.target.result+'" />')},a.readAsDataURL(i)}else if($WC.Matcher.check("videomimetype",i.type)){var a=new FileReader;a.onload=function(){var e=new Blob([a.result],{type:i.type}),s=URL.createObjectURL(e),n=document.createElement("video");n.addEventListener("pause",function(){URL.revokeObjectURL(s)}),n.setAttribute("type","video/mp4"),n.addEventListener("loadeddata",function(){var e=document.createElement("canvas");e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0,e.width,e.height);var i=e.toDataURL();i.length>1e5&&(t.html('<img src="'+i+'" />'),n.pause())}),n.src=s},a.readAsArrayBuffer(i)}t.children().length||(e.addClass("zfle"),t.html('<div class="msi-upldfile"></div>'))},p=function(e,t){for(var i=0,a=t.length,s={minScrollbarLength:20};a>i;i++)ZCScroll.customScroll("#filecommentlimit"+e+i,!0,s);ZCScroll.customScroll("#filescontainer")},h=function(e){void 0!==$("#chatwindows #upload"+e)[0]&&$("#chatwindows #upload"+e)[0].reset()},g=function(e,t,i){if(ChatUI.isExist(e)){var a=$("#"+e+"_filepbar"),s=a.find("#fileupldprgbr"+e),n=t.fup,r=function(e,t){var i=e/t*100;return i=Math.round(i),100>=i?i:100};if(s.css("width",r(n.uploaded,n.total)+"%"),n.getTotalFileCount()>1){var o=a.find('[filename="'+i+'"]').find("#progressbar");o.css("width",r(t.uploaded,t.total)+"%")}}},f=function(e,t,a){if(a=$WC.$CUtil.isEmpty(a)?FileUploadHandler.getLivefupObj(t):a,!$WC.$CUtil.isEmpty(a)){var s=Object.keys(a.getFileDetails())[0];if(!$WC.$CUtil.isEmpty(s)){if(1==a.getTotalFileCount()){var n=a.getFileDetails(s);e.find("#filecountbar").html(Resource.getRealValue("chat.file.sharing",[$WC.$CUtil.processXSS(n.fileobj.name),i(n)])),e.find("#zcfileexpandicon").hide(),e.find("#fileupldprgbr"+t).show(),e.find("#expandfilescontainer").hide()}else e.find("#filecountbar").html(Resource.getRealValue("chat.files.sharing",[a.getSharingFilesCount(),a.getTotalFileCount()])),e.find("#zcfileexpandicon").show();e.show()}}},v=function(e,t,i){if(!$WC.$CUtil.isEmpty(i)&&!$WC.$CUtil.isEmpty(i.data)){var a=i.data,s=new $CliqChatId(e);if(s.isCustomBot()&&"undefined"!=typeof a.dreResponse){var n=MyBots.getBotId(e),o=MyBots.getNameByChid(e);IntegrationsResponse.populateOutput({module:Integration.Components.Bot,id:n,name:o,imageUrl:Users.getImgUrlById(n)},a.dreResponse,e)}else s.isDefaultBot()||ChatUI.displayMsg(i.data)}r(e,t,!0)},C=function(e,t){for(var i=0,a=t.length;a>i;i++){var s=e.find(t[i]),n=s.find('[type="name"]'),r=s.find('[type="comment"]'),o=n.text();if(n.removeClass("error"),$WC.Matcher.check("invalidfilenamechars",o)||$WC.Matcher.check("empty",o))return n.addClass("error"),$Util.scrollToView(s,"filescontainer"),e.find("#errormsg").text(Resource.getRealValue("common.filename.invalid")).slideDown(),!1;if(o.length>100)return n.addClass("error"),$Util.scrollToView(s,"filescontainer"),e.find("#errormsg").text(Resource.getRealValue("common.filename.too.long")).slideDown(),!1;if(r.removeClass("error"),r.val().length>1e3)return r.addClass("error"),$Util.scrollToView(s,"filescontainer"),e.find("#errormsg").text(Resource.getRealValue("common.filecomment.invalid")).slideDown(),!1}return!0},y=function(t,i){var a=$("#fileuploadwin"),s=$(i.target).parent(),n=s.attr("fileindex");e[t].splice(parseInt(n),1),a.find(i.target).parents('[type="file"]').remove();for(var r=$("#fileuploadwin").find('[type="file"]'),o=r.length,l=0;o>l;l++)r[l].setAttribute("fileindex",l);if(3>o){var c=a.find("#fileuploadwinbody");1===o?(r.find('[purpose="close"]').hide(),c.removeClass("zppwd2").addClass("zppwd1"),c.find('[purpose="annotateImg"]').remove(),1===r.length&&$WC.Matcher.check("imagemimetype",r.attr("content"))&&(a.find("#winclose").before('<div id="annotate" class="msi-edit annotate ellips" chid="'+t+'" purpose="annotateImg">'+Resource.getRealValue("common.edit")+"</div>"),a.find("#annotate").show())):2===o&&c.addClass("zppwd2")}$WC.DivEditor.focus("filecommentlimit"+t+r.attr("fileindex")),ZCScroll.updateScroll($("#filescontainer"))},b=function(e,t,i){e.stopPropagation();var a=i.html();if(!$WC.$CUtil.isEmpty(a)&&a.length>0){$WC.DivEditor.clear(i[0]);var s=i.parent().attr("fileindex");E(i,t,s)}else $WC.$Win.destroy($WC.$Win.isExist("fileuploadwin")?"fileuploadwin":"fileforwardwin"),document.getElementById("composer"+t)&&$WC.DivEditor.focus(document.getElementById("composer"+t));e.preventDefault()},E=function(e,t,i){$Dom.limitInput(e);var a=e.parent();a.find("#filecommentcount"+t+i).removeClass("dN").addClass("dB")},I=function(e,t){var i=t.currentTarget,a=$(i).parents(".smileydivmn").parent(),s=a.attr("fileindex"),n=$("#filecommentlimit"+e+s);$WC.DivEditor.focus("filecommentlimit"+e+s),Composer.handleSmileyInsertion(t,i,"filecommentlimit"+e+s),E(n,e,s)},T=function(t,i){var a=i.currentTarget,s=a.getAttribute("purpose");if("cancel"===s||"upload"===s)if(document.getElementById("composer"+t)&&$WC.DivEditor.focus(document.getElementById("composer"+t)),"cancel"===s)delete e[t],h(t),$WC.$Win.destroy($WC.$Win.isExist("fileuploadwin")?"fileuploadwin":"fileforwardwin");else{var n=a.getAttribute("clearcomposer");"true"===n&&(Composer.updateHelpTip(t,"",""),$WC.DivEditor.clear($("#composer"+t)[0])),FileUploadUI.uploadFile(t),i.preventDefault(),i.stopImmediatePropagation()}else if("forward"===s)FileForwardUI.handleForward(t);else if("deleterecipant"===s)$("#fileforward-usersuggest-search-field").html("").attr("contenteditable","true").focus();else if("close"===s)y(t,i);else if("smileys"===s){var r=$(a).parent(),o=r.attr("fileindex");Smiley.showSmileyUI("triggersmileys"+t+o,"smileys"+t+o,i)}},S=function(e,t){var i=t.currentTarget,a=i.getAttribute("type");if("comment"===a){if("keydown"===t.type&&13===t.which&&(t.ctrlKey||t.metaKey)&&($WC.$Win.isExist("fileuploadwin")?FileUploadUI.uploadFile(e):FileForwardUI.handleForward(e),"true"===i.getAttribute("clearcomposer")&&(Composer.updateHelpTip(e,"",""),$WC.DivEditor.clear("composer"+e)),document.getElementById("composer"+e)&&$WC.DivEditor.focus(document.getElementById("composer"+e)),t.preventDefault()),"keydown"===t.type&&13===t.which&&!t.ctrlKey&&!t.metaKey){var s=$(i).parent(),n=s.attr("fileindex"),r="filecommentlimit"+e+n,o=$("#filecommentlimit"+e+n);$WC.DivEditor.insertObject(r,o,document.createElement("br")),t.preventDefault()}"keyup"===t.type&&t.which===$zcg.ESCAPE_KEYCODE&&b(t,e,$(i))}else $Util.handleEditor(t,i,{focusclass:"zctitfcs",handleblur:!0})};return{MAX_ALLOWED_FILE_NAME_LENGTH:100,MAX_ALLOWED_FILE_SIZE:$zcg._MAX_ALLOWED_FILE_SIZE||52428800,handlePreview:function(e,i,a,s){return l(e,i)?a&&Composer.hasCommandRule(e)?(CommandFileUploadUI.handleCommandUpload(e,i),void h(e)):void t(e,i,s):void 0},handlePaste:function(e,t){for(var i=[],a=0,s=t.length;s>a;a++){var n=t[a].type;if($WC.Matcher.check("imagemimetype",n)){var r=t[a].getAsFile();if($WC.$CUtil.isEmpty(r))return;i.push(t[a].getAsFile())}}0!==i.length&&this.handlePreview(e,i,!0)},uploadFile:function(t,i,a,s){var i=i||$("#fileuploadwin"),l=i.find('[type="file"]');if(C(i,l)){for(var a=a||e[t],c=0;c<a.length;c++){var d=i.find(l[c]),u=d.find('[type="comment"]')[0],m=$WC.$CUtil.processXSS(FileUploadUI.getFileComment(t,u));FileUploadHandler.addFileForUpload(t,a[c],m)}var p={progresscallback:FileUploadUI.handleProgress,successcallback:v,errorcallback:r,oncompletecallback:r};o(t),FileUploadHandler.startFileUpload(t,p,s),h(t),delete e[t],$WC.$Win.destroy("fileuploadwin",name),n(t,p)}},generateName:function(e){var t=e.type,i=t.substring(t.indexOf("/")+1,t.length);return Resource.getRealValue("common.file.autofill.name")+" - "+$Date.time($Util.getSyncedCurrentTime())+"."+i},getFileComment:function(e,t){for(var i=$WC.DivEditor.getNodes(t),a=0,s=i.length,n="";s>a;a++)if(i[a].nodeType===Node.TEXT_NODE)n+=i[a].nodeValue;else{var r=i[a].getAttribute("nodetype");n+=":"===r?Composer.getSmileyCode(i[a]):"BR"===i[a].tagName?"\n":$(i[a]).text()}return n=$WC.DivEditor.removeBufferCharacters(n),n=$.trim(n)},bindEvents:function(e,t){for(var i=t.find('[type="file"]'),n=0;n<i.length;n++){var r=i[n].getAttribute("fileindex"),o="filecommentlimit"+e+r;$WC.DivEditor.initEditor(o,{highlightclass:"sel"})}$WC.DivEditor.focus("filecommentlimit"+e+0),t.on("click","[code]",function(t){I(e,t)}),t.on("click","[purpose]",function(t){T(e,t)}),t.on("focusin keyup mouseup focus keydown","[listen='keyup']",function(){E($(this),e,$(this).parent().attr("fileindex"))}),t.on("focusout blur","[listen='keyup']",function(){t.find("#filecommentcount"+e+$(this).parent().attr("fileindex")).removeClass("dB").addClass("dN")}),t.on("focusin focusout keyup keydown",'[type="name"], [type="comment"]',function(t){S(e,t)}),t.find("#filescontainer").on("focusin",function(){$("#fileuploadwin #errormsg").slideUp()}),t.on("click","[purpose='annotateImg']",function(){var e=$(this),i=e.attr("chid");if(a(t,i),"forward"===e.attr("data-operation")){var n=$("#fileforwardwinbody"),r=n.find("#selrecipant");ImgViewer.Annotator.annotateAndForwardImage(n.find("#filecontainer"),r.attr("selid"),r.attr("selelemtype")),ZCTrack.track("ANNOTATE",{TRIGGER:"Fileforward"})}else{var n=e.parents("[type='file']"),o=t.find("[type='file']");1===o.length&&(o.attr("fileindex",0),n=o),s(n,i),ZCTrack.track("ANNOTATE",{TRIGGER:"Fileupload"})}})},handleProgress:function(e,t){function i(i){if(i.lengthComputable){var a=FileUploadHandler.getLivefupObj(e);if(!$WC.$CUtil.isEmpty(a)&&!$.isEmptyObject(a)&&a.getTotalFileCount()>0&&"undefined"!=typeof a.getFileDetails(t)){var s=a.getFileDetails();if(!$WC.$CUtil.isEmpty(s[t])){s[t].fromCloud||a.updateProgressDetails(t,i.loaded,i.total);var n=s[t],r={uploaded:n.uploaded,total:n.total,fup:a};g(e,r,t)}}}}var a=new window.XMLHttpRequest;return a.upload.addEventListener("progress",i,!1),a.addEventListener("progress",i,!1),a},expandFilesContainer:function(e){var t=$("#"+e+"_filepbar"),i=t.find("#zcfileexpandicon").hasClass("msi-expand");if(i){t.find("#expandfilescontainer").slideDown(),t.find("#zcfileexpandicon").removeClass("msi-expand").addClass("msi-shrink"),t.find("#zcfileexpandicon").attr("title",Resource.getRealValue("common.collapse"));var a=t.find("#fileupldprgbr"+e);a.hide()}else{t.find("#expandfilescontainer").slideUp(),t.find("#zcfileexpandicon").removeClass("msi-shrink").addClass("msi-expand"),t.find("#zcfileexpandicon").attr("title",Resource.getRealValue("common.expand"));var a=t.find("#fileupldprgbr"+e);a.show()}},cleanUpFileUpload:function(e,t,i){FileUploadHandler.cleanUpFileUpload(e,t,i),r(e,i)},toggleCancelButton:function(e,t,i){if(!$WC.$CUtil.isEmpty(e)){var a=$("#"+e+"_filepbar"),s=a.find("#fileupldprgbr"+e);if(i)a.find("#uploadcancel").show(),s.removeClass("posa prgrs-bar");else if(!$WC.$CUtil.isEmpty(t)&&FileUploadHandler.islivefupExist(e)&&(a.find("#uploadcancel").hide(),s.addClass("posa prgrs-bar"),FileUploadHandler.getLivefupObj(e).getTotalFileCount()>1)){var n=a.find('[filename="'+t+'"]');n.find("#progressbar").addClass("posa prgrs-bar"),n.find('[purpose="close"]').hide()}}}}}(),FileForwardUI=function(){var e={},t='<div uid="{USERID}" elemtype="contact" purpose="search" class="zcffddwn"><span class="usrimgsts"><div class="usrimgsts floatl zc-1"><img class="zcgp1" src="{IMGURL}"><span class="{STATUSCLASS}"></div></span><span class="usrname ellips">{DNAMEVAL}<em>{EMAILID}</em></span></div>',i='<div id="group{ID}" uid="{GROUPID}" elemtype="group" purpose="search" class="zcffddwn"><span class="usrimgsts"><div class="usrimgsts floatl zc-1"><img class="zcgp1" src="{IMGURL}"></div></span><span id="groupdname{ID}" class="usrname ellips">{DNAMEVAL}<em>{PARTICIPANTSDETAIL}</em></span></div>',a='<div id="channel{ID}" uid="{CHANNELID}" chid="{CHID}" elemtype="channel" purpose="search" class="zcffddwn"><span class="usrimgsts"><div class="usrimgsts floatl zc-1"><span class="zcgp1">{IMG}</span></div></span><span id="channelname{ID}" class="usrname ellips">{DNAMEVAL} </span></div>',s=function(e){var t=Template.FileForwardWindow,i=Template.FilePreviewInFileUploadWindow.replace(/{CHID}/g,e).replace(/{FILEINDEX}/g,"0").replace(/{COMMENTPLACEHOLDER}/g,Resource.getRealValue("common.add.comment")+" ("+Resource.getRealValue("common.forwardfile.shortcut")+")").replace(/{ANNOTATE}/g,"");return t=t.replace(/{FILESLIST}/g,i)},n=function(e,t){FileUploadUI.bindEvents(e,t),SearchField.init("fileforward-usersuggest"),t.on("keydown",'[type="comment"]',function(t){13===t.which&&(t.ctrlKey||t.metaKey)?FileForwardUI.handleForward(e):""}),t.on("focusin",function(){$("#fileforwardwin #errormsg").slideUp(),t.find("#fileforwardsuggestions").removeClass("zcsldwn")}),t.on("click",'[type="usersuggestimg"]',function(){r($(this))})},r=function(e){var t,i,a,s=e.attr("elemtype");t=e.attr("chat"===s||"channel"===s||"chathistory"===s?"chid":"uid"),i=SearchField.getRecipientName(s,t),a="chat"===s||"chathistory"===s?ChatsList.isGroupChat(t)?$Util.getImgStaticUrl()+"/group.png":Users.getImgUrlById(e.find("img").attr("uid")):SearchField.getImageUrlByType(s,t),Contacts.isBotId(t)&&(s="chat",t=MyBots.getChid(t));var n='<div id="selrecipant" selid="'+t+'" selelemtype="'+s+'" class="posl"><img class="zcffimg" src="'+a+'"/><span class="ellips mrgLR5">'+$WC.$CUtil.processXSS(i)+'</span><div purpose="deleterecipant" class="msi-close cur"></div></div>',r=$("#fileforwardwin");r.find("#fileforward-usersuggest-search-field").html(n).attr("contenteditable","false"),r.find('[purpose="forward"]').focus()},o=function(t,i,a,s,n,r,o,l){var c=t.find("#filecontainer"),d="",u=n.lastIndexOf(".");-1!==u?d=n.substring(u):u=n.length;var m=n.substring(0,u);if(c.find('[purpose="close"]').remove(),c.attr("chid",i),c.attr("fileextn",d),c.attr("content",a),c.attr("url",s),c.attr("isv1",o),c.find('[type="name"]').text(m),c.attr("fname",n),$WC.$CUtil.isEmpty(r)||c.find('[type="comment"]').html(r),"string"!=typeof s){var p=s;if($WC.Matcher.check("imagemimetype",p.type)){var h=new FileReader;h.onload=function(e){c.attr("url",e.target.result),c.find('[type="preview"]').html('<img src="'+e.target.result+'" />')},h.readAsDataURL(p),e[i]=[p]}}else $WC.Matcher.check("imagemimetype",a)?c.find('[type="preview"]').html('<img src="'+MsgTemplate.getCachedImageLink(a,s,n,o,l,!0)+'"/>'):(c.find('[type="file"]').addClass("zfle"),c.find('[type="preview"]').html('<div class="msi-upldfile"></div>'))},l=function(e,t,i,a,s,n,r){var o={id:t,type:e,mod:"att",sid:WmsImpl.getSid(),comment:n};r||(o.mime=s,o.fname=i,o.url=a);var l=r?"/v1/attachments/"+a+"/forward":"/fileforward.do";$ZCAjx.ajax({url:l,type:"POST",data:o,status:{error:"chat.attachment.forward.error"}})},c=function(e){$("#fileforward-usersuggest-search-field").focus();for(var t=Contacts.getAll(),i=Contacts.sortByUsage(t),a=[],s=0,n=0;n<i.length;n++){var r=i[n][1];if(5===s)break;Contacts.isBot(r)||(a.push('<img uid="'+r+'" elemtype="contact" type="usersuggestimg" title="'+Contacts.getDisplayName(r)+'" src="'+Users.getImgUrlById(r)+'"/>'),s++)}i.length>0&&SecurityManager.hasPermission(Modules.DirectMessage)&&(e.find("#usrsugg").removeClass("zcflnosugg").addClass("zcflsugg"),$("#fileforwardusesugg").html(a))},d=function(e,t){var i=t,a=e;if(Channels.isExist(Channels.getChannelId(e)))i="channel";else{i="chat";var s=MyBots.chidVsBotId[e];if(s)i="bot",a=s;else if(ChatsList.isOnetoOneChat(e)||Users.isExist(e)){var n=ChatsList.getRecipientDatafor121chat(e);i="contact",a=n.zuid}}r($('<div elemtype="'+i+'" uid="'+(a||e)+'" chid="'+e+'"></div>'))};return{handleForward:function(t){var i=$("#fileforwardwin"),a=i.find("#filecontainer"),s=i.find("#selrecipant");if(0===s.length)return s.addClass("error"),i.find("#fileforwardsuggestions").addClass("zcsldwn"),void i.find("#errormsg").text(Resource.getRealValue("common.select.recipant")).slideDown();var n=s.attr("selid"),r=s.attr("selelemtype"),o=a.attr("url"),c=a.attr("fileextn"),d=$.trim(a.find('[type="name"]').text())+c,u=a.find('[type="comment"]')[0],m=$WC.$CUtil.processXSS(FileUploadUI.getFileComment(t,u)),p=a.attr("content");m=m.length?m:void 0;var h="true"===a.attr("isv1");if("chat"===r||"chathistory"===r||"contact"===r||"group"===r||"channel"===r){var g="chat"===r||"chathistory"===r?"chat":"contact"===r?"im":"channel";if(e[t]){var f={type:g};FileUploadUI.uploadFile(n,i,e[t],f),delete e[t]}else l(g,n,d,o,p,m,h)}$WC.$Win.destroy("fileforwardwin")},handle:function(e,t,i,a,r,l,u,m){var p='<div class="ellips">'+Resource.getRealValue("common.forward.file")+"</div>";$WC.Matcher.check("imagemimetype",t)&&(p+='<div id="annotate" class="msi-edit annotate ellips" chid="'+e+'" data-operation="forward" purpose="annotateImg">'+Resource.getRealValue("common.edit")+"</div>");var h=$WC.$Win.create({id:"fileforwardwin","class":"fileupldwin zccomwin",header:p,html:s(e)});if(o(h,e,t,i,a,r,l,u),n(e,h),m&&m.fillusersuggestfield){var g=m.sugguserid?m.sugguserid:e;d(g,m.suggusertype)}ImgViewer.Annotator.loadFiles(function(){h.find('[purpose="annotateImg"]').show()}),c(h),ZCScroll.customScroll($("#filecommentlimit"+e+"0"),!0),$("#fileforward-usersuggest-search-field").focus()},search:function(e){function s(){var e=0;return SecurityManager.hasPermission(Modules.DirectMessage)&&(e=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS+SearchAgent.CHATHISTORY),SecurityManager.hasPermission(Modules.Bots)&&(e+=SearchAgent.BOTS),SecurityManager.hasPermission(Modules.Channels)&&(e+=SearchAgent.CHANNELS),e}var n=$("#fileforward-usersuggest-results");n.html('<div id="fileforward-usersuggest-list" class="flefrwdlst"></div>');var r=SearchAgent.search({searchin:s(),val:e,permission:["fileshare"],protocol:["zoho"],allstatuscontacts:!1,listid:"fileforward-usersuggest-list",debugsource:"FileForward",contactshtml:t,orgcontactshtml:t,groupshtml:i,chathistoryhtml:Template.forwardchathistorysearchhtml,chatshtml:Template.forwardchathistorysearchhtml,channelshtml:a,channelcategory:ChannelsUI.List.RETRIVE_JOINED,replacecontentonsuccesscallback:!0,successcallback:function(){n.find("[purpose='search']").first().addClass("srchbn sel")},clearcallback:function(){FileForwardUI.clear(),n.empty().hide()}});if(r){n.find("[purpose='search']").first().addClass("srchbn sel");var o="block"===n.css("display");o||Clickoutside.bind({srcid:"fileforward-usersuggest-search-field",destid:"fileforward-usersuggest-results"}),ZCScroll.customScroll($("#fileforward-usersuggest-results")),ZCScroll.scrollTop($("#fileforward-usersuggest-results"),0)}else FileForwardUI.clear(),n.empty().hide()},handleAction:function(e,t,i){i&&(r(t),Clickoutside.handleClickOnChild(e,t))},clear:function(){$("#fileforward-usersuggest-results").hide().find("#fileforward-usersuggest-list").empty(),Clickoutside.clear("fileforward-usersuggest-results")}}}(),CommandFileUploadUI=function(){var e={},t=function(t,i){e.hasOwnProperty(t)||(e[t]=[]);for(var a=0;a<i.length;a++)e[t].push(i[a])},i=function(e,t,i){for(var s=0;s<t.length;s++){var n=a(t[s],s+i);$WC.DivEditor.insertObject(e,$("#"+e)[0],n)}},a=function(e,t){var i=document.createElement("SPAN"),a=e.name||FileUploadUI.generateName(e),s=$WC.$CUtil.decodeHTMLEntities(a),n=a.lastIndexOf("."),r=n>0?a.substring(n):"";a=n>0?a.substring(0,n):a,a=a.substring(0,FileUploadUI.MAX_ALLOWED_FILE_NAME_LENGTH-(r.length+1)),i.setAttribute("filename",a+r),i.setAttribute("title",$WC.$CUtil.processXSS(s)),i.setAttribute("elemtype","att"),i.setAttribute("nodetype","att"),i.setAttribute("fileindex",""+t),i.setAttribute("contenteditable","false"),i.setAttribute("class","selusr zcimgnde");var o=s.length>20?s.substr(0,19)+"...":s,l='<span class="msi-close posa textcent dN cur"></span><span class="msi-atchfile"></span>'+$WC.$CUtil.processXSS(o);return i.innerHTML=l,i};return{getCommandFiles:function(t){return e[t]},handleCommandUpload:function(a,s){var n=s,r=e[a],o=$WC.$CUtil.isEmpty(r)?0:r.length;t(a,n),i("composer"+a,n,o),$WC.$Win.destroy("fileuploadwin",name)},cleanUpCommandFiles:function(t){delete e[t]}}}();var $EC={},$EC={GROUP_DOESNOT_CONTAIN_MEMBER:2001,CHANNEL_CREATION_FAILED:3e3,CHANNEL_DELETION_FAILED:3001,CHANNEL_NOT_EXIST:3002,CHANNEL_JOIN_FAILED:3003,CHANNEL_LEAVE_FAILED:3004,CHANNEL_ACTION_FAILED:3005,CHANNEL_APPROVE_FAILED:3006,CHANNEL_REJECT_FAILED:3007,CHANNEL_ALREADY_EXIST:3008,CHANNEL_ALREADY_APPROVED:3009,CHANNEL_ALREADY_REJECTED:3010,CHANNEL_ADMIN_ACTION_FAILED:30011,CHANNEL_INVITEMEMBERS_FAILED:3012,CHANNEL_RETRIVAL_FAILED:3013,CHANNEL_JOINED_RETRIVAL_FAILED:3014,CHANNEL_ALLOWED_RETRIVAL_FAILED:3015,CHANNEL_CREATION_NEED_GROUP:3016,CHANNEL_ALREADY_EXIST_PENDINGSTATE:3017,CHANNEL_EXTERNAL_INVALID_USERS_FORINVITE:3018,CHANNEL_ALREADY_EXIST_DISABLED:3019,CHANNEL_NOT_MEMBER:3020,CHANNEL_INVALID_USERS_FORINVITE:3021,CHANNEL_MAXLIMIT_REACHED:3022,CHANNEL_EDITNAME_FAILED:3023,CHANNEL_EDITDESC_FAILED:3024,CHANNEL_PREVIEW_ERROR:3025,CHANNEL_NOUSERSJOINED:3026,CHANNEL_EDIT_FAILED:3027,CHANNEL_MESSAGE_SEND_FAILED:3028,CHANNEL_CREATION_NEED_USERS:3029,CHANNEL_USER_NOT_PERSISTENT:3030,CHANNEL_USER_INVITATION_REMOVED:3031,CHANNEL_CLEAR_MSG_FAILED:3032,CHANNEL_COUNT_PLANLIMIT_REACHED:3033,CHANNEL_PARTICIPANT_PLANLIMIT_REACHED:3034,CHANNEL_INVALID_SERVICE:3037,CHANNEL_USER_SYNC_FAILED:3039,CHANNEL_USERADDITION_LIMIT_REACHED:3040,CHANNEL_TEAM_CREATION_NOTALLOWED:3041,CHANNEL_ARCHIVED_LEAVE_NOTALLOWED:3042,CHANNEL_STATUS_PENDING:3043,CHANNEL_STATUS_ARCHIVED:3044,CHANNEL_MAX_ADMINS_LIMIT_REACHED:3045,CHANNEL_ALREADY_UNARCHIVED:3046,CHANNEL_UNARCHIVED_FAILED:3047,CHANNEL_ACTION_NOT_ALLOWED_FOR_ARCHIVED:3048,CHANNEL_ACTION_NOT_ALLOWED_FOR_PENDING:3049,CHANNEL_ACTION_NOT_ALLOWED_FOR_CREATED:3050,CHANNEL_PERMISSION_CHANGE_FAILED:3051,CHANNEL_PERMISSION_NOT_DEFINED:3052,CHANNEL_PERMISSION_ALREADY_SAME:3053,CHANNEL_ROLE_NOT_DEFINED:3054,CHANNEL_INVALID_STATE:3055,CHANNEL_PERMISSION_CHANGE_NOT_ALLOWED_FOR_FREE_PLAN:3056,CHANNEL_NOT_ENABLED:3057,CHANNEL_LICENSE_EXCEPTION:3058,CHANNEL_OPERATION_NOT_ALLOWED_EXTERNAL_USER:3059,CHANNEL_UNARCHIVED_NOT_ALLOWED_FOR_APP:3060,CHANNEL_ROLE_CHANGE_NOT_ALLOWED_FOR_EXTERNAL:3061,CHANNEL_CREATOR_ROLE_CHANEGE_NOT_ALLOWED:3062,CHANNEL_PERMISSION_CHANEGE_NOT_ALLOWED_ACTION:3063,CHANNEL_NOT_ALLOWED_TO_CHAT_WITH_NON_ORG_USER:3064,CHANNEL_CREATOR_CANNOTBE_DELETED:3065,CHANNEL_ONLY_SAME_ORG_USERS_ALLOWED_TO_MANAGE:3066,CHANNEL_PAGE_REFRESH:3067,CHANNEL_REMOVE_MEMBER_FAILED:3068,CHANNEL_SEND_MESSAGE_NOT_ALLOWED:3069,CHANNEL_USER_MENTION_NOT_ALLOWED:3070,CHANNEL_SPECIAL_MENTION_NOT_ALLOWED:3071,CHANNEL_CHANGE_SPECIAL_MENTION_PERMISSION_NOT_ALLOWED:3072,CHANNEL_CHANGE_MENTION_PERMISSION_NOT_ALLOWED:3073,CHANNEL_EXTERNAL_CREATION_NOTALLOWED:3074,CHANNEL_INVLAID_SCOPE_FOR_OTHER_SERVICES:3075,CHANNEL_TEAM_UNARCHIVE_NOTALLOWED:3076,CHANNEL_EXTERNAL_UNARCHIVE_NOTALLOWED:3077,CHANNEL_SUPER_ADMIN_LEAVE_NOT_ALLOWED:3078,CHANNEL_ARCHIVE_NOTALLOWED_FOR_APP:3079,CHANNEL_DELETE_NOTALLOWED_FOR_APP:3080,CHANNEL_ARCHIVED_FAILED:3081,CHANNEL_PERMISSION_CHANEGE_NOT_ALLOWED_ROLE:3082,CHANNEL_ROLE_CHANGE_FAILED:3083,OPERATION_NOT_ALLOWED:1002,SECURITY_IPLOCKED:9005,CS_DISABLED_BY_ADMIN:"module_disabled_by_admin",CS_ACTION_DISABLED_BY_ADMIN:"action_disabled_by_admin"},$WC=$WC||{};$WC.DivEditor={RANGE_HANDLER:document,CREATERANGE_HANDLER:document,editors:{},defaultoptions:{currentRange:!1,current_caret:!1,highlightclass:"",dataattr:"nodetype",handleKeyDown:function(){},handleKeyUp:function(){},handlePaste:function(){},handleTextPaste:function(){},handleInitialize:function(){}},initEditor:function(e,t){this.editors[e]={},$WC.$CUtil.extend(this.editors[e],this.defaultoptions,t),this.editors[e].sel=this.RANGE_HANDLER.getSelection(),this._bindEvents(e),this.editors[e].handleInitialize(e,this.editors[e].trigger)},_bindEvents:function(e){var t=document.getElementById(e);t&&(Gator(t).on("keydown",function(t){$WC.DivEditor._onKeyDown(e,t),$WC.DivEditor.editors[e].handleKeyDown(e,t,this),$WC.DivEditor.cleanEditor(t,this)}),Gator(t).on("keyup",function(t){$WC.DivEditor._onKeyUp(e,t),$WC.DivEditor.editors[e].handleKeyUp(e,t,this),$WC.DivEditor.cleanEditor(t,this)}),Gator(t).on("paste",function(t){$WC.DivEditor._onPaste(t,e,this)}),Gator(t).on("mouseup",function(t){$WC.DivEditor._onMouseUp(e,t,this),$WC.DivEditor.cleanEditor(t,this)}),Gator(t).on("blur",function(e){$WC.DivEditor.cleanEditor(e,this)}))},disableEditor:function(e,t){var i=document.getElementById(e);i&&("undefined"!=typeof t&&(i.innerHTML=t),i.setAttribute("contenteditable","false"))},cleanEditor:function(e,t){for(var i=t.childNodes,a="",s=0,n=i.length;n>s;s++){if(i[s].nodeType!==Node.TEXT_NODE)return;a+=i[s].nodeValue}0!==a.length&&(a=this.removeBufferCharacters(a),0===a.length&&this.clear(t))},_onPaste:function(e,t,i){var a,s;if(window.clipboardData&&(e.preventDefault(),s=window.clipboardData.getData("Text")))return a=this.insertText(t,s),$WC.DivEditor.editors[t].handleTextPaste(i,t,s),a;var n=(e.originalEvent||e).clipboardData;if(n){if(e.preventDefault(),s=n.getData("text/plain"))return a=this.insertText(t,s),$WC.DivEditor.editors[t].handleTextPaste(i,t,s),a;var r=n.items;r&&$WC.DivEditor.editors[t].handlePaste(t,r)}return!1},_onKeyDown:function(e,t){var i=null,a=null,s=t.which;if(this.editors[e].sel=this.RANGE_HANDLER.getSelection(),this.editors[e].sel.rangeCount){var n=this.editors[e].sel.getRangeAt(0);if(!n.collapsed)return}switch(s){case 0:break;case 98:case 66:case 105:case 73:case 117:case 85:if(t.ctrlKey)return void t.preventDefault();break;case 8:var r=!1;if("stop"===(r=this._backspaceZeroSpace(e,t)))return;(i=this._checkForAdjacentObject(e,"left"))&&(this.deleteObject(e,i.dom_node),i.preventDefault&&t.preventDefault());break;case 46:var o=!1;if("stop"===(o=this._deleteZeroSpace(e)))return;(i=this._checkForAdjacentObject(e,"right"))&&(this.deleteObject(e,i.dom_node),t.preventDefault());break;case 37:var l=this._getCaretPosition(e);if(i=this._isEmbeddedObject(e,l.dom_node)){this._setCaretPositionRelative(e,i.previousSibling,"end"),t.preventDefault();break}(a=this._moveCaret(e,l.dom_node,l.offset,"left"))&&(a.checkForObjects&&(i=this._checkForAdjacentObject(e,"left"))&&(this._setCaretPositionRelative(e,i.dom_node.previousSibling,"end"),t.preventDefault()),a.preventDefault&&t.preventDefault());break;case 39:var c=this._getCaretPosition(e);if(i=this._isEmbeddedObject(e,c.dom_node)){this._setCaretPositionRelative(e,i.nextSibling,"beginning");break}(a=this._moveCaret(e,c.dom_node,c.offset,"right"))&&(a.checkForObjects&&(i=this._checkForAdjacentObject(e,"right"))&&this._setCaretPositionRelative(e,i.dom_node.nextSibling,"beginning"),a.preventDefault&&t.preventDefault())}},_onKeyUp:function(e,t){var i=null,a=t.which;if(!this._handleRangeSelection(e))switch(this._saveRange(e),this._highlightObject(e),a){case 37:case 39:case 8:i=this._getCaretPosition(e);var s=this._clickedOnObject(e,i.dom_node);if(s)return void this._setCaretPositionRelative(e,s,"before");break;case 38:case 40:i=this._getCaretPosition(e);var n=this._clickedOnObject(e,i.dom_node);n&&this._setCaretPositionRelative(e,n,"before")}},_onMouseUp:function(e,t,i){if(!$WC.$CUtil.hasFocus(i))return!0;if(!this._handleRangeSelection(e)){this._saveRange(e);var a=this._clickedOnObject(e,t.target);a&&(this._setCaretPositionRelative(e,a,"before"),t.preventDefault()),this._highlightObject(e)}},_handleRangeSelection:function(e){var t=this.RANGE_HANDLER.getSelection();try{var i=t.getRangeAt(0)}catch(a){return!1}var s=null,n=null;return i.collapsed?!1:((s=this._clickedOnObject(e,i.startContainer))&&i.setStartBefore(s),(n=this._clickedOnObject(e,i.endContainer))&&i.setEndAfter(n),(s||n)&&(t.removeAllRanges(),t.addRange(i)),!0)},_saveRange:function(e,t){if("undefined"==typeof t)try{t=this.editors[e].sel.getRangeAt(0)}catch(i){return!1}this.editors[e].currentRange=t.cloneRange()},getCurrentNodeValue:function(e){var t=document.getElementById(e);t.normalize();var i=this._getCaretPosition(e);return i&&-1!==i.offset?i.dom_node.nodeValue.substring(0,i.offset):!1},_checkForAdjacentObject:function(e,t){var i={},a=null;if(!(i=this._getCaretPosition(e)))return!1;if(a=i.dom_node,this._isEmbeddedObject(e,a))return{dom_node:a,container_spanned:!1,preventDefault:!0};if((i=this._treeWalker(e,i.dom_node,i.offset,t))===!1)return!1;if(this.hasMOZ_DIRTY_hack(a)){if("left"!==t)return!1;if((i=this._treeWalker(e,i.dom_node.previousSibling,i.offset,t))===!1)return!1}if(3===i.dom_node.nodeType)if("left"===t&&0===i.offset){if(this._isEmbeddedObject(e,i.dom_node.previousSibling))return{dom_node:i.dom_node.previousSibling,container_spanned:!i.checkForObjects,preventDefault:i.preventDefault}}else if("right"===t&&i.offset===i.dom_node.nodeValue.length&&this._isEmbeddedObject(e,i.dom_node.nextSibling))return{dom_node:i.dom_node.nextSibling,container_spanned:!i.checkForObjects,preventDefault:i.preventDefault};return this._isEmbeddedObject(e,i.dom_node)?{dom_node:i.dom_node,container_spanned:!i.checkForObjects,preventDefault:i.preventDefault}:!1},_clickedOnObject:function(e,t){for(;$WC.$CUtil.getAttribute(t,"id")!==e;){if(this._isEmbeddedObject(e,t))return t;t=t.parentNode}return!1},_moveCaret:function(e,t,i,a){var s={};if((s=this._treeWalker(e,t,i,a))===!1)return!1;if("object"===s.type)return"left"===a?this._setCaretPositionRelative(e,s.dom_node,"after"):this._setCaretPositionRelative(e,s.dom_node,"before"),s;if("container"===s.type){if("left"===a){var n=s.dom_node.previousSibling;return"DIV"===n.nodeName||"P"===n.nodeName?0===n.childNodes.length?!1:(this._setCaretPositionRelative(e,n,"end"),s.dom_node=n.childNodes[n.childNodes.length-1],s):3===n.nodeType?(s.dom_node=n,0===s.dom_node.nodeValue.length?!1:(this._setCaretPositionRelative(e,s.dom_node,"end"),s)):(s.dom_node=n,this._setCaretPositionRelative(e,s.dom_node,"before"),s)}if(null===s.dom_node.nextSibling)return this._setCaretPositionRelative(e,s.dom_node,"after"),s;if("DIV"===s.dom_node.nextSibling.nodeName||"P"===s.dom_node.nextSibling.nodeName){if(0===s.dom_node.nextSibling.childNodes.length)return!1;s.dom_node=s.dom_node.nextSibling.childNodes[0]}return this._setCaretPositionRelative(e,s.dom_node,"after"),s}if("child"===s.type)return 3===s.dom_node.nodeType?0===s.dom_node.nodeValue.length?(this._selectTextNode(e,s.dom_node,0),s):(this._selectTextNode(e,s.dom_node,0),s):s;if(3===s.dom_node.nodeType)return this._selectTextNode(e,s.dom_node,s.offset),s;if("BR"===s.dom_node.nodeName){if(this.hasMOZ_DIRTY_hack(s.dom_node))return"left"===a?(s.type="_moz_dirty",s.preventDefault=!0,this._setCaretPositionRelative(e,s.dom_node,"before"),s):(this._setCaretPositionRelative(e,s.dom_node,"after"),s);"left"===a?this._setCaretPositionRelative(e,s.dom_node,"before"):this._setCaretPositionRelative(e,s.dom_node,"after")}return s},_backspaceZeroSpace:function(e,t){var i=null,a={},s={},n={},r=null;if(a=this._getCaretPosition(e),i=a.dom_node,3!==i.nodeType&&"BR"!==i.nodeName)return!1;if("BR"===i.nodeName){if(this.hasMOZ_DIRTY_hack(i))return"stop";var o=i.previousSibling;if(null===o)return this._setCaretPositionRelative(e,i,"before"),i.remove(),!0;if(3!==o.nodeType)return this._setCaretPositionRelative(e,i,"before"),i.remove(),t.preventDefault(),!0;this._setCaretPositionRelative(e,o,"end"),i.remove()}return n=this._getCaretPosition(e),(s=this._walkTextNode(e,n.dom_node,n.offset,"left"))===!1?!1:(this.editors[e].sel=this.RANGE_HANDLER.getSelection(),r=this.CREATERANGE_HANDLER.createRange(),3!==s.dom_node.nodeType?r.setStartAfter(s.dom_node):r.setStart(s.dom_node,s.offset),r.setEnd(n.dom_node,n.offset),r.deleteContents(),this.editors[e].sel.removeAllRanges(),this.editors[e].sel.addRange(r),this._saveRange(e),!0)},_deleteZeroSpace:function(e){var t={},i={},a=null,s=null;return t=this._getCaretPosition(e),3!==t.dom_node.nodeType?!1:(i=this._walkTextNode(e,t.dom_node,t.offset,"right"))===!1?!1:t.dom_node===i.dom_node&&t.offset===i.offset?!1:(a=this.RANGE_HANDLER.getSelection(),s=this.CREATERANGE_HANDLER.createRange(),s.setStart(t.dom_node,t.offset),3!==i.dom_node.nodeType?s.setEndBefore(i.dom_node):s.setEnd(i.dom_node,i.offset),s.deleteContents(),a.removeAllRanges(),a.addRange(s),this._saveRange(e),!0)},_treeWalker:function(e,t,i,a){for(var s={type:""},n=100,r=!1,o=!1;t;){if(n--<=0)return!1;if(3===t.nodeType){if((s=this._walkTextNode(e,t,i,a))===!1)return!1;switch(s.type){case"text":if(s.dom_node.nodeValue.length>0)return s.preventDefault=r,s;t="left"===a?s.dom_node.previousSibling:s.dom_node.nextSibling,i=-1;continue;case"element":case"object":t=s.dom_node,i=-1;break;case"container":r=!0,o=!0,i=-1,t=s.dom_node;break;case"end":return!1}}if(this._isEmbeddedObject(e,t)){var l=!0;return o&&(l=!1),{dom_node:t,offset:-1,type:"object",preventDefault:r,checkForObjects:l}}if("BR"===t.nodeName)return this.hasMOZ_DIRTY_hack(t)?{dom_node:t,offset:-1,type:"element",preventDefault:r,checkForObjects:!1}:{dom_node:t,offset:-1,type:"element",preventDefault:r,checkForObjects:!1};if("container"===s.type||"DIV"!==t.nodeName&&"SPAN"!==t.nodeName&&"P"!==t.nodeName){if("left"===a&&null===t.previousSibling||"right"===a&&null===t.nextSibling){if($WC.$CUtil.getAttribute(t.parentNode,"id")===e)return!1;t=t.parentNode}t="left"===a?t.previousSibling:t.nextSibling,s.type=""}else{r=!0,o=!0;var c=t.childNodes;if(0===c.length){var d=this._insertEmptyNode(t,"child");return{dom_node:d,offset:0,type:"child",preventDefault:r,checkForObjects:!1}}var u=null;if(u="left"===a?c[c.length-1]:c[0],3!==u.nodeType&&!this._isEmbeddedObject(e,u)&&"DIV"!==u.nodeName&&"P"!==u.nodeName&&"BR"!==u.nodeName)return{dom_node:t,offset:-1,type:"child",preventDefault:r,checkForObjects:!1};if(3===u.nodeType&&u.nodeValue.match(/^[\u200B]+$/))return{dom_node:u,offset:0,type:"child",preventDefault:r,checkForObjects:!1};t=u}}return!1},_walkTextNode:function(e,t,i,a){var s=200;if(3!==t.nodeType)return!1;switch(-1===i&&(i="left"===a?t.nodeValue.length:0),a){case"left":var n=!1;for(0===i&&(n=!0);;){if(s--<=0)return!1;if(n){if(n=!1,null===t.previousSibling)return $WC.$CUtil.getAttribute(t.parentNode,"id")===e?{dom_node:t,offset:0,type:"end",preventDefault:!1,checkForObjects:!0}:{dom_node:t.parentNode,offset:-1,type:"container",preventDefault:!1,checkForObjects:!0};if(3!==t.previousSibling.nodeType)return t=t.previousSibling,{dom_node:t,offset:-1,type:"element",preventDefault:!1,checkForObjects:!0};if(t=t.previousSibling,0===(i=t.nodeValue.length)){i=0,n=!0;continue}}if("\u200b"!==t.nodeValue.charAt(i-1))return{dom_node:t,offset:i,type:"text",preventDefault:!1,checkForObjects:!1};i--,0===i&&(n=!0)}return!1;case"right":for(;;){if(s--<=0)return!1;if(i===t.nodeValue.length){if(null===t.nextSibling){if($WC.$CUtil.getAttribute(t.parentNode,"id")===e)return{dom_node:t,offset:i,type:"end",preventDefault:!1,checkForObjects:!1};if($WC.$CUtil.getAttribute(t.parentNode,"id")===e){var r=this._insertEmptyNode(t,"after");return{dom_node:r,offset:0,type:"end",preventDefault:!1,checkForObjects:!0}}return{dom_node:t.parentNode,offset:-1,type:"container",preventDefault:!1,checkForObjects:!0}}if(3!==t.nextSibling.nodeType)return t=t.nextSibling,{dom_node:t,offset:-1,type:"element",preventDefault:!1,checkForObjects:!0};if(t=t.nextSibling,i=0,0===t.nodeValue.length)continue}if("\u200b"!==t.nodeValue.charAt(i))return{dom_node:t,offset:i,type:"text",preventDefault:!1,checkForObjects:!0};i++}}},_highlightObject:function(e){var t=!1;this._unHighlightObjects(e,document.getElementById(e)),(t=this._checkForAdjacentObject(e,"left"))&&(t.container_spanned||"SPAN"!==t.dom_node.nodeName||$WC.$CUtil.addClass(t.dom_node,this.editors[e].highlightclass)),(t=this._checkForAdjacentObject(e,"right"))&&(t.container_spanned||"SPAN"!==t.dom_node.nodeName||$WC.$CUtil.addClass(t.dom_node,this.editors[e].highlightclass))},_unHighlightObjects:function(e,t){for(var i=t.children,a=0;a<i.length;a++){var s=i[a];$WC.DivEditor._isEmbeddedObject(e,s)?$WC.$CUtil.removeClass(s,$WC.DivEditor.editors[e].highlightclass):s.children.length>0&&$WC.DivEditor._unHighlightObjects(e,s)}},_selectTextNode:function(e,t,i){if(3!==t.nodeType)return!1;var a=this.RANGE_HANDLER.getSelection(),s=this.CREATERANGE_HANDLER.createRange();s.setStart(t,i),s.setEnd(t,i),s.collapse(!0),a.removeAllRanges(),a.addRange(s),this._saveRange(e,s)},_setCaretPositionRelative:function(e,t,i){var a=this.RANGE_HANDLER.getSelection(),s=null;if(this._isEmbeddedObject(e,t)){switch(s=this._getObjectRange(e,t),i){case"before":case"beginning":s.collapse(!0);break;case"after":case"end":s.collapse(!1)}return a.removeAllRanges(),a.addRange(s),void this._saveRange(e)}switch(s=a.getRangeAt(0),i){case"before":if("BR"===t.nodeName){var n=this._insertEmptyNode(t,"before");return void this._setCaretPositionRelative(e,n,"end")}s.setStartBefore(t),s.setEndBefore(t),s.collapse(!0),a.removeAllRanges(),a.addRange(s),this._saveRange(e);break;case"after":if("BR"===t.nodeName){s.setStartBefore(t),s.setEndBefore(t),s.collapse(!1),a.removeAllRanges(),a.addRange(s),this._saveRange(e);break}s.setStartAfter(t),s.setEndAfter(t),s.collapse(!1),a.removeAllRanges(),a.addRange(s),this._saveRange(e);break;case"beginning":if(3!==t.nodeType)return;s.setStart(t,0),s.setEnd(t,0),s.collapse(!1),a.removeAllRanges(),a.addRange(s),this._saveRange(e);break;case"end":if(3!==t.nodeType)return;s.setStart(t,t.nodeValue.length),s.setEnd(t,t.nodeValue.length),s.collapse(!1),a.removeAllRanges(),a.addRange(s),this._saveRange(e)}if("DIV"===s.startContainer.nodeName&&$WC.$CUtil.getAttribute(s.startContainer,"id")===e&&s.startOffset===s.startContainer.childNodes.length){var r=this._insertEmptyNode(s.startContainer,"child");this._selectTextNode(e,r,0)}},_getObjectRange:function(e,t){var i=this.editors[e].sel.getRangeAt(0);if(this.editors[e].sel.rangeCount){var a,s=t.previousSibling;null===s?(a=this._insertEmptyNode(t,"before"),i.setStart(a,0)):3!==s.nodeType?(a=this._insertEmptyNode(t,"before"),i.setStart(a,0)):null===s.nodeValue?(a=this._insertEmptyNode(t,"before"),i.setStart(a,0)):0===s.nodeValue.length?(a=this._insertEmptyNode(t,"before"),i.setStart(a,0)):i.setStart(s,s.nodeValue.length),this.CREATERANGE_HANDLER.createRange();var n=t.nextSibling;return null===n?(a=this._insertEmptyNode(t,"after"),i.setEnd(a,1)):3!==n.nodeType?(a=this._insertEmptyNode(t,"after"),i.setEnd(a,1)):null===n.nodeValue?(a=this._insertEmptyNode(t,"after"),i.setEnd(a,1)):0===n.nodeValue.length?(a=this._insertEmptyNode(t,"after"),i.setEnd(a,1)):"\u200b"!==n.nodeValue?(a=this._insertEmptyNode(t,"after"),i.setEnd(a,1)):i.setEnd(n,1),i}},_getCaretPosition:function(e){var t=null,i=null,a=null;try{var s=this.RANGE_HANDLER.getSelection().getRangeAt(0)}catch(n){return!1}if(!s.collapsed)return!1;if(t=s.startContainer,a=this._isEmbeddedObject(e,t))return{dom_node:a,offset:-1};if(3===t.nodeType)return{dom_node:t,offset:s.startOffset};if($WC.$CUtil.getAttribute(t,"id")===e||"DIV"===t.nodeName||"P"===t.nodeName){if(0===t.childNodes.length)return i=this._insertEmptyNode(t,"child"),this._selectTextNode(e,i,0),{dom_node:i,offset:0};if(s.startOffset>=t.childNodes.length)return i=this._insertEmptyNode(t,"after"),this._selectTextNode(e,i,1),{dom_node:i,offset:1};if(t=t.childNodes[s.startOffset],3===t.nodeType)return this._selectTextNode(e,t,0),{dom_node:t,offset:0}}return{dom_node:t,offset:-1}},_insertEmptyNode:function(e,t,i){var a=document.createTextNode("\u200b");switch(t){case"before":if(!i&&e.previousSibling&&3===e.previousSibling.nodeType&&e.previousSibling.nodeValue.length>0)return e.previousSibling;e.parentNode.insertBefore(a,e);break;case"after":if(!i&&e.nextSibling&&3===e.nextSibling.nodeType&&e.nextSibling.nodeValue.length>0)return e.nextSibling;e.parentNode.insertBefore(a,e.nextSibling);break;case"child":var s=e.childNodes,n=s.length;if(n&&3===s[n-1].nodeType)return s[n-1];e.appendChild(a)}return a},_isEmbeddedObject:function(e,t){function i(e,t){for(var i=e.parentNode;i!==document;){if(i.hasAttribute(t))return i;i=i.parentNode}}return null===t?!1:$WC.$CUtil.getAttribute(t,this.editors[e].dataattr)?t:i(t,this.editors[e].dataattr)},insertText:function(e,t){var i=this.RANGE_HANDLER.getSelection();return window.clipboardData?(this.RANGE_HANDLER.selection.createRange().pasteHTML(t),this._saveRange(e,i.getRangeAt(0)),!0):this.RANGE_HANDLER.queryCommandEnabled("insertHTML")&&(t=$WC.$CUtil.processXSS(t,!0),t=t.replace(/\u200B/gm,"").replace(/\r\n|\n/gm,"<br/>"),i.rangeCount>0&&this.RANGE_HANDLER.execCommand("insertHTML",!1,t))?(this._saveRange(e,i.getRangeAt(0)),!0):!1},insertObject:function(e,t,i){if(this.focus(e),!this.editors[e].currentRange){var a=this._insertEmptyNode(t,"child");this._selectTextNode(e,a,1)}var s=this.RANGE_HANDLER.getSelection(),n=this.editors[e].currentRange;s.removeAllRanges(),s.addRange(n),n.insertNode(i),n.setStartAfter(i),n.collapse(!0),s.removeAllRanges(),s.addRange(n),this._insertEmptyNode(i,"before",!0);var r=this._insertEmptyNode(i,"after",!0);this._selectTextNode(e,r,1)},deleteObject:function(e,t){var i=this.RANGE_HANDLER.getSelection(),a=t.parentNode,s=this._getObjectRange(e,t);s.deleteContents(),s.collapse(!0),i.removeAllRanges(),i.addRange(s),$WC.$CUtil.getAttribute(a,"id")!==e&&0===a.childNodes.length&&(s.setStartBefore(a),s.setEndAfter(a),s.deleteContents(),s.collapse(!0),i.removeAllRanges(),i.addRange(s)),this._saveRange(e)},replaceWord:function(e,t,i,a){var s=this.CREATERANGE_HANDLER.createRange(),n=this.editors[e].current_caret,r="undefined"!=typeof i?n.dom_node.nodeValue.lastIndexOf(" "+i)+1||n.dom_node.nodeValue.lastIndexOf("\xa0"+i)+1||n.dom_node.nodeValue.lastIndexOf("\u200b"+i)+1:-1;-1===r&&(r=0),s.setStart(n.dom_node,r),s.setEnd(n.dom_node,n.offset),s.deleteContents(),this._saveRange(e,s),this.insertObject(e,t,a)},insertSelection:function(e,t,i){var a=e;"string"!=typeof e?a=$WC.$CUtil.getAttribute(e,"id"):e=document.getElementById(a),this.replaceWord(a,e,t,i)},clear:function(e){"string"==typeof e&&(e=$("#"+e)[0]);var t=!1;document.execCommand("selectAll")&&(t=document.execCommand("delete")),t||($(e).empty(),$(e).focus())},focus:function(e){var t=e;if("string"!=typeof e?t=$WC.$CUtil.getAttribute(e,"id"):e=document.getElementById(t),document.activeElement!=e){var i=this.editors[t].currentRange;i&&-1===t.indexOf("composer")||(i=this.CREATERANGE_HANDLER.createRange(),i.selectNodeContents(e),i.collapse(!1));var a=this.editors[t].sel;a.removeAllRanges(i),a.addRange(i),this._saveRange(t,i),e.focus();var s=e.lastChild;s&&"composer"===e.getAttribute("data-type")&&(3!==s.nodeType&&("BR"===s.nodeName?(e.insertBefore(document.createTextNode(" "),s),s=s.previousSibling):(e.appendChild(document.createTextNode("")),s=e.lastChild)),this._setCaretPositionRelative(t,s,"end"))}},initObj:function(e){var t=this.editors[e];t&&(t.currentRange=!1,t.current_trigger=!1)},clearObj:function(e){delete this.editors[e]},getSearchValueAndTrigger:function(e,t){var i=this.getCurTextValue(t),a=0,s=e.length,n=0,r="";for(i=this.removeBufferCharacters(i);s>a;a++){var o=i.lastIndexOf(" "+e[a])+1;0===o&&0!==i.indexOf(e[a])&&(o=-1),-1!==o&&o>=n&&(n=o,r=e[a])}return i=i.substring(n),i=i.substring(r.length),{trigger:r,val:r?i:""}},getNodes:function(e){var t=[];return"string"==typeof e&&(e=document.getElementById(e)),e&&(e.normalize(),t=e.childNodes),t},getInsertedNodes:function(e){var t=[];return"string"==typeof e&&(e=document.getElementById(e)),e&&(t=e.children),t},getCurTextValue:function(e){var t=this._getCaretPosition(e),i="";return this.editors[e].current_caret=t,t&&-1!==t.offset&&(i=t.dom_node.nodeValue.substring(0,t.offset)),i},getCurrNodeTextValue:function(e){var t=this._getCaretPosition(e),i="";return this.editors[e].current_caret=t,t&&-1!==t.offset&&(i=t.dom_node.nodeValue),i},deleteCurrentNode:function(e){var t=this._getCaretPosition(e);this.deleteObject(e,t.dom_node)},removeBufferCharacters:function(e){return e=e.replace(/\u200B/g,""),e.replace(/\u00A0/g," ")},hasMOZ_DIRTY_hack:function(e){return e.hasAttribute&&e.hasAttribute("_moz_dirty")}};var WmsBarImpl={};WmsBarImpl={open:function(){GSUI.isNewSearchEnabled()&&GSUI.isNewSearchUIShown()||WmsHybridSearch.toggleUI()},contactNotifyStatus:function(e){var t=$WC.$CUtil.splitWmsFormattedString(e.s);e.zuid=t[0],e.scode=t[1],e.dname=$WC.$CUtil.getContactName(e.zuid),e.email=t[2],e.st=t[3],e.smsg=t[4]||WmsContacts.defaultstatusmsg[e.scode],WmsContacts.updateStatus(e),WmsHybridSearch.updatePresence(e.zuid)},updateBotContacts:function(e){WmsContacts.updateBotContacts(e)},updateContacts:function(e){WmsContacts.updateContacts(e)},updateFromActiveChats:function(e){WmsRecentChats.updateFromActiveChats(e.ac)},handleEscape:function(){var e=WmsHybridSearch.getNode("inputdiv").value.trim();if(chosenelements=WmsHybridSearch.getNode("inputcontainer").querySelectorAll("[data-type]"),$WC.$CUtil.isEmpty(e)&&0==chosenelements.length)WmsHybridSearch.hideUI();else{WmsHybridSearch.getNode("inputdiv").value="";for(var t=0;t<chosenelements.length;t++)$WC.$CUtil.removeElement(chosenelements[t]);WmsHybridSearch.getNextResultSet()}return!0},updateChannelName:function(e,t){var i=WmsChannels.list[e];"undefined"!=typeof i&&(i.cn=t),WmsRecentChats.updateTitle(e,t)},updateTitle:function(e,t){WmsRecentChats.updateTitle(e,t)},updateLastMsgAttInfo:function(e){var t=WmsImpl.isLocalUser(e.sender)?Resource.getRealValue("common.you"):Users.getName(e.sender,e.nname),i=$.isEmptyObject(e.info)?"":Resource.getRealValue("chat."+e.info.mod+".shared",[t]);i=Smiley.convertAnimatedTo24(i),WmsRecentChats.updateLastMsgInfo({chid:e.chid,sender:e.sender,dname:e.dname,msg:i,lmtime:e.time,module:e.mod})},updateLastMsgTxtInfo:function(e){var t=Smiley.convertAnimatedTo24(e.msg);WmsRecentChats.updateLastMsgInfo({chid:e.chid,sender:e.sender,dname:e.dname,msg:t,lmtime:e.time})},updateDeletedMsgInfo:function(e){var t=MsgTemplate.getDeletedMsgText();WmsRecentChats.updateLastMsgInfo({chid:e.chid,sender:e.sender,dname:e.dname,msg:t,lmtime:e.origin_time})}};var WmsliteImpl={},WmsImpl={};WmsliteImpl={handleServiceMessage:function(e){if("undefined"!=typeof e.msg&&$Util.isJSONString(e.msg)){var t=JSON.parse(e.msg);"showannouncement"===t.msgtype&&($zcg._ANNOUNCEMENT={msg:t.msg,version:t.version,link:t.link,type:t.type,exptime:t.exptime},UI.Announcement.show())}},showAnnouncement:function(e){UI.updateAnnouncementBanner(e,UI.Announcement.TOP_BANNER,!0)},hideAnnouncement:function(){$("#wmsannouncementbanner").slideUp()},handleAccountDisabled:function(){_checkAndLogout()},reconnectionCountDown:function(e){var t=Math.trunc(e/60);t=(""+t).length>1?t:"0"+t;var i=e%60;i=(""+i).length>1?i:"0"+i;var a=document.getElementById("bannertext");a&&(a.innerHTML=1>e?Resource.getRealValue("common.connecting"):Resource.getRealValue("common.network.connecting",['<span class="clr6"> '+t+":"+i+"</span>"]))},handleLogout:function(){_logout()},serverup:function(e){_print("serverup"," Session Reconnected :msg : "+JSON.stringify(e)+" === "+new Date+" state : "+$zcg._CONNECTED),e?(_syncWithServerTime(e.t),InitRequestManager.onInitialAndReregister(!1)):InitRequestManager.onInitialAndReregister(!0),UI.updateReconnectionBanner(!0),MMChat.handleServerStatus(!0),$ZCVideoBroadcast.handleWmsConnectionStatus(!0),Conference.handleWmsConnectionStatus(!0)},serverdown:function(){UI.updateReconnectionBanner(),$zcg._CONNECTED=!1,$zcg.WMS_DISCONNECT_TIME=(new Date).getTime(),MMChat.handleServerStatus(!1),$ZCVideoBroadcast.handleWmsConnectionStatus(!1)},handleMessage:function(e,t){var i=parseInt(e);23!==i&&105!==i&&104!==i&&110!==i&&4!==i&&27!==i&&102!==i&&_print("wmsmsg",[e,t]),(27===i||102===i)&&_print("contacts",[e,t,$Util.getSyncedCurrentTime()]),WmsImpl.push(e,t)},disableWms:function(){WmsLite.disableWms()}},WmsImpl={isReadOnlyMode:function(){return $zcg._READONLY},getSubDomain:function(){return $zcg._SUBDOMAIN},getPrd:function(){return WmsLite.prd},getSilent:function(){return $zcg.silent===!0},getZuid:function(){return WmsLite.zuid},getSid:function(){return WmsLite.sid},getRawsid:function(){return WmsLite.rsid},getNickName:function(){return WmsLite.nname},isdisablewms:function(){return WmsLite.disablewms},isOrgUser:function(){return"null"!==$zcg._ORGID},isLocalUser:function(e,t){var i=e===this.getZuid();return"undefined"!=typeof t&&(i=i&&!MsgUtil.isSentByBot(t)),i},isFromApi:function(e){return!$WC.$CUtil.isEmpty(e.temp_info)&&e.temp_info.api},isSameBrowser:function(e){return e===this.getSid()},isChatSupported:function(e){return e=parseInt(e),e===$zcg.CHAT||5===e||e===$zcg.ORGCHANNEL||e===$zcg.NO_OPERATIONCHAT||e===$zcg.ENTITYCHAT},isAnnonUser:function(e){return-1!==e.indexOf("$")},custommsghandler:function(){var e={CHANNEL_APPROVAL:function(e){Channels.handleApproval(e)},CHANNEL_CANCEL_APPROVALREQUEST:function(e){Channels.deleteApproval(e.oc_id)},CHANNEL_APPROVED:function(e){Channels.handleMyChannelsApproved(e)},CHANNEL_REJECTED:function(e){Channels.handleMyChannelsRejected(e)},CHANNEL_ADMIN_APPROVED:function(e){Channels.handleAdminApproved(e)},CHANNEL_ADMIN_REJECTED:function(e){Channels.handleAdminRejected(e)},MYMENTION:function(e){Mentions.addMentionfromNonJoinedChannel($Util.cloneObject(e,!0))},CHANNEL_DELETED:function(e){Channels.handleDelete(e.channelid)},CHANNEL_SYNC:function(e){Channels.handleSync(e)},CHANNEL_NOTIFY_CREATE:function(e){Channels.handleNotifyCreate(e)},CHANNEL_ARCHIVED:function(e){Channels.handleArchive(e)},CHANNEL_UNARCHIVE:function(e){Channels.handleUnArchive(e)},CHANNEL_CHANGE_PERMISSION:function(e){Channels.handlePermissionChange(e)},CHANNEL_CHANGE_ROLE:function(e){Channels.handleRoleChange(e)},CHANNEL_LEAVE:function(e){Channels.handleLeave(e.oc_id)},CHANNEL_JOIN:function(e){Channels.handleJoinChannelSuccess(e.CHANNEL,e.CHAT)},UPDATE_PARTICIPANTLIST:function(e){Channels.isExternalChannel(Channels.getByChid(e.chid))?delete Channels.AllowedUsers[e.chid]:"",Participants.update(e.chid,e.users,"USER JOINED"===e.mode?"14":"15")},CHANNEL_EDIT:function(e){Channels.handleEdit(e.oc_id,e)},CLEAR_MESSAGE:function(e){Channels.updateLastMsgInfo(e.chid)},COMMAND_CREATED:function(e){Commands.store(e)},COMMAND_EDITED:function(e){Commands.store(e)},REMOVE_ALLOWED_CHANNEL:function(e){Channels.removeAllowedChannels(e)},COMMAND_DELETED:function(e){Commands.deleteInObj(e.commandid)},BOT_DELETED:function(e){Contacts.deleteInObject(e.id)},BOT_SYNC_ACTION_HANDLERS:function(e){var t=e.id;Contacts.updateBotActions(t,void 0);var i=MyBots.getChid(t);ChatUI.isExist(i)&&Bots.getActions(t)},BOT_TYPING_START:function(e){var t=MyBots.getChid(e.id);ChatUI.updateTypingStatus(t,"chat.is.typing",e.id,e.name,!0)},BOT_TYPING_END:function(e){var t=MyBots.getChid(e.id);ChatUI.updateTypingStatus(t,"")},MESSAGEACTION_CREATED:function(e){MessageActions.store(e)},MESSAGEACTION_EDITED:function(e){MessageActions.store(e)},MESSAGEACTION_DELETED:function(e){MessageActions.deleteInObj(e.messageactionid)},SCHEDULER_CREATED:function(e){Schedulers.updateStorage(e.schedulers)},SCHEDULER_EDITED:function(e){Schedulers.updateStorage(e.schedulers)},SCHEDULER_DELETED:function(e){Schedulers.deleteInStorage(e.schedulerid)},STORAGE_CREATED:function(e){PlatformDatabases.updateStorage(e.platformdatabases)},STORAGE_EDITED:function(e){PlatformDatabases.updateStorage(e.platformdatabases)},STORAGE_DELETED:function(e){PlatformDatabases.deleteInStorage(e.platformdatabaseid)},APP_INSTALLED:function(e){Applications.store({installedapplications:[e]}),Applications.storeComponents(e)},APP_ADMIN_ENABLED:function(e){Applications.store({installedapplications:[e]}),Applications.storeComponents(e)},APP_UNINSTALLED:function(e){var t=Applications.getObjectByStoreId(e.storeAppId);Applications.deleteInObj(t),Applications.deleteAppEntities(e.storeAppId)},APP_ADMIN_DISABLED:function(e){var t=Applications.getObjectByStoreId(e.storeAppId);Applications.deleteInObj(t),Applications.deleteAppEntities(e.storeAppId)},APP_PUBLISHED:function(e){Applications.updateTime(e.store_appid,void 0,(new Date).getTime()),e.published_app&&Applications.store({installedapplications:[e.published_app]}),ApplicationsUI.repopulateAppInList(e.store_appid)},APP_MODIFIED:function(e){Applications.updateTime(e.store_appid,e.lmtime),ApplicationsUI.repopulateAppInList(e.store_appid)},NEW_USER_JOINED:function(e){var t=$Util.isPendingInviteeChatPresent(e.mailid);-1!==t&&ChatUI.isExist(t)?$ZCAjx.ajax({url:"/attachsession.do",type:"POST",protocol:"pex",data:{chid:t,sid:WmsImpl.getSid()}}):$Util.notify({title:Resource.getRealValue("newuser.desktop.notification.title",[$zcg._USERFULLNAME]),body:Resource.getRealValue("newuser.desktop.notification.body",[e.name]),type:"status",clickcallback:function(){Chat.create(e.zuid,"im")}})},NOTIFY_RECONNECTION_FAILURE:function(){_sendDebugMailforReconnectionFailure(!0)},MODULE_STATUS_CHANGE:function(e){SecurityManager.update(e)},TEMP_MESSAGE:function(e){var t=e.sid;if("undefined"==typeof t||WmsImpl.isSameBrowser(t)){var i=e.dreResponse.message_source||e.dreResponse.output.meta.message_source;IntegrationsResponse.populateOutput(i,e.dreResponse,e.chid)}},STARRED:function(e){StarMessages.handleStar(e,!0)},UNSTARRED:function(e){StarMessages.handleStar(e,!1)}};return function(t){"function"==typeof e[t.ACTION]&&e[t.ACTION](t.data)}}(),push:function(){var e=function(e){var t=e.oc,i=t.split(":",3);return t=t.substring(i.join(":").length+1),i.push(t),i},t={"-3":function(){$zcg._CONNECTED=!1,_print("serverup"," Session Reconnected on reregister === "+new Date+" state : "+$zcg._CONNECTED),UI.updateReconnectionBanner(!0),InitRequestManager.handleReconnection()},"-17":function(){_checkAndLogout()},"-12":function(){_checkAndLogout()},23:function(e){var t=e.s,i=t.split(":",4),a=i[0],s=parseInt(i[1]),n=parseInt(i[3]),r=t.substring(i.join(":").length+1),o=Contacts.getStatus(a),l=Contacts.getContactSmsg(a);s===$zcg.CON_INVISIBLE&&(r="Offline"),o===$zcg.CON_IDLE||s!==$zcg.ONLINE&&s!==$zcg.CON_BUSY||s===o&&r===l||Settings.getFromObj("vustatus")&&parseInt(MySelf.scode)!==$zcg.CON_BUSY&&$Util.notify({type:"status",icon:Users.getImgUrlById(a),title:$WC.$CUtil.decodeHTMLEntities(Contacts.getDisplayName(a)),body:$WC.$CUtil.decodeHTMLEntities($WC.$CUtil.isEmpty(r)||"Idle"===r?Contacts.getStatusMsg(null,s):Contacts.getStatusMsg(null,s)+" ("+Contacts.getStatusMsg(r,s)+") ")}),Contacts.updateStatus(a,s,r,n),ContactsHandle.presence(a),WmsBarImpl.contactNotifyStatus(e)},24:function(e){e.smsg=$WC.$CUtil.decodeHTMLEntities(e.smsg),StatusController.updateStatusfromOthertab(e.scode,e.smsg)},54:function(e){"0"===e.scode&&(e.scode="2",e.smsg="Invisible");var t=$WC.$CUtil.decodeHTMLEntities(e.smsg);StatusController.updateStatusfromOthertab(e.scode,t)},60:function(e){Contacts.storeBotsAsContacts(e),BotContactsList.populateBotContacts(),WmsBarImpl.updateBotContacts(e)},27:function(e){Contacts.update(e),ContactsHandle.bulkUpdate(),ChatUI.updateBulkParticipantStatusInUI(e),WmsBarImpl.updateContacts(e),$WC.$CUtil.isEmpty(Users.fetchtimer)&&(Users.fetchtimer=setTimeout(Users.getOrgUsersforLHS(),3e3)),$WC.$CUtil.isEmpty(OrgInvitees.fetchtimer)&&(OrgInvitees.fetchtimer=setTimeout(OrgInvitees.getOrgInviteesForLHS(),3e3))},102:function(e){ContactsHandle.notification(e)},100:function(e){e.guid,e.guname,e.title,Chat.create(e.guid,"guestim",e.guname+" - "+e.title)},10:function(e){WmsImpl.isChatSupported(e.ctype)&&(delete e.users,ChatUI.create(e))},103:function(e){ChatUI.updateGuestData(e,"url")},12:function(e){e.mtype="12",e.saved="0"!==e.history;var t=MsgUtil.getMsgObjVersion(e),i=!1,a=-1;if("v0"==t&&(e=$WC.CMsgUtil.convertMsgObj(e)),1!==parseInt(e.h)){if(WmsImpl.isChatSupported(e.ctype)&&!WmsImpl.getSilent()){e.mtype="12";var s=ChatUI.isExist(e.chid);if(WmsImpl.isLocalUser(e.sender,e)&&!e.includesenderinunread){if(!$WC.$CUtil.isEmpty(e.sid)&&!WmsImpl.isSameBrowser(e.sid)&&!WmsImpl.isFromApi(e))return ChatUI.removeWindow(e.chid),void NotifyByTitle.stop();s||!WmsImpl.isFromApi(e)||"undefined"!=typeof e.sid&&!WmsImpl.isSameBrowser(e.sid)||(ChatUI.create(e),Chat.join(e.chid,e.ctype,!1,!0)),ChatUI.isExist(e.chid)&&(ChatUI.isUndeliveredMsg(e)&&ChatUI.updateMsgDeliverance(e),i=ChatUI.isLastMsgMissingInChatWindow(e),a=i?ChatUI.exist[e.chid].wmslmsgtime:-1,e.msglist?ChatUI.updateForwardMsginCwin(e,e.chid):ChatUI.displayMsg(e),ChatUI.handleMyMsg(e),ChatUI.hasUnreadOrUnseenMsgs(e.chid)&&ChatUI.removeNewmsgNotification(e.chid))}else s||(ChatUI.create(e),Chat.join(e.chid,e.ctype,!1,!0)),ChatUI.updateMuteStatus(e.chid,e.m?1:0),i=ChatUI.isExist(e.chid)&&ChatUI.isLastMsgMissingInChatWindow(e),a=i?ChatUI.exist[e.chid].wmslmsgtime:-1,e.msglist?ChatUI.updateForwardMsginCwin(e,e.chid):ChatUI.displayMsg(e),ChatUI.updateTypingStatus(e.chid,""),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateBadge("undefined"==typeof e.m);0!==parseInt(e.history)&&(ChatsList.updateLastMsgInfo(e),WmsBarImpl.updateLastMsgTxtInfo(e)),LeftPannel.LHSList.rearrangeLHSList(void 0,e)}i&&ChatUI.updateMissingTranscript(e,a)}},70:function(e){if(e=e.msg,301===parseInt(e.addldatatype)){var t=ChatUI.exist[e.chid];if(t){var i=t.storage.getMessage(e.msguid);i&&(i.reactions=Reactions.convertObject(JSON.parse(e.addldata)),ChatUI.updateReactionsInCwin(e.chid,i))}}},65:function(e){ChatUI.updateEditedMsgInfoFromWms(e)},64:function(e){ChatUI.updateEditedMsgFromWms(e)},63:function(e){if(e&&e.chid){if(e.mtype=""+$zcg.DELETE_MTYPE,ChatUI.isExist(e.chid)){var t=ChatUI.exist[e.chid];t.deleteMsginChatTranscript(e)}Chat.removeDeletedMsgInOtherArea(e)}},13:function(e){if(WmsImpl.isChatSupported(e.ctype)&&!WmsImpl.getSilent()){var t=e.zuid,i=e.chid,a=WmsImpl.isLocalUser(t);if(a)0===parseInt(e.status)&&"true"===e.close&&(ChatUI.removeWindow(i),NotifyByTitle.stop());else{var s="13";Participants.update(i,[e],s);var n=LeftPannel.container.find('[profileid="'+t+'"]',"#tab"+i);ChatsList.updatePresence(n,t,"contact",e.cstatus),0!==parseInt(e.status)&&ChatUI.updateTypingStatus(i,"")}}},28:function(e){WmsImpl.isChatSupported(e.ctype)&&!WmsImpl.getSilent()&&(ChatUI.removeWindow(e.chid),ChatUI.removeNewmsgNotification(e.chid,!0),NotifyByTitle.stop())},22:function(e){var t=e.s.split(":");WmsImpl.isChatSupported(t[2])&&!WmsImpl.getSilent()&&(ChatUI.isChannel(t[2])?WmsImpl.isLocalUser(t[0])||Channels.handleDelete(Channels.getChannelId(t[1]),!0):(ChatUI.removeWindow(t[1]),NotifyByTitle.stop(),ChatsList.delete(t[1])),$ZCVideoBroadcast.handleDelete(e.chid))},20:function(e){e.mtype="20",e.saved="0"!==e.history;var t=MsgUtil.getMsgObjVersion(e);if("v0"==t&&(e=$WC.CMsgUtil.convertMsgObj(e)),1!==parseInt(e.h)){if(!$.isEmptyObject(e.info)&&"undefined"!=typeof e.info.mod&&WmsImpl.isChatSupported(e.ctype)&&!WmsImpl.getSilent()&&(WmsImpl.isSameBrowser(e.sid)||!WmsImpl.isLocalUser(e.sender)||ChatUI.isExist(e.chid))){e.mtype="20",ChatUI.isExist(e.chid)||(WmsImpl.isLocalUser(e.sender)||ChatUI.create(e),Chat.join(e.chid,e.ctype,!1,!0)),ChatUI.updateMuteStatus(e.chid,e.m?1:0);var i=ChatUI.isExist(e.chid)&&ChatUI.isLastMsgMissingInChatWindow(e);wmslmsgtimeinwin=i?ChatUI.exist[e.chid].wmslmsgtime:-1,e.msglist?ChatUI.updateForwardMsginCwin(e,e.chid):ChatUI.displayMsg(e),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateBadge("undefined"==typeof e.m),i&&ChatUI.updateMissingTranscript(e,wmslmsgtimeinwin)}0!==parseInt(e.history)&&(ChatsList.updateLastMsgInfo(e),WmsBarImpl.updateLastMsgAttInfo(e)),LeftPannel.LHSList.rearrangeLHSList(void 0,e)}},14:function(e){if(WmsImpl.isChatSupported(e.ctype)&&!WmsImpl.getSilent()){var t="14";Participants.update(e.chid,e.users,t)}},15:function(e){if(WmsImpl.isChatSupported(e.ctype)&&!WmsImpl.getSilent()){var t="15";Participants.update(e.chid,e.users,t)}},16:function(e){e.mtype="16";var t=MsgUtil.getMsgObjVersion(e);if("v0"==t&&(e=$WC.CMsgUtil.convertMsgObj(e)),1!==parseInt(e.h)){if(e.mtype="16",ChatUI.isChannel(e.ctype)){var i=e.info;if("USER ADDED"===i.mode||"USER DELETED"===i.mode){var a=[],s=i.userslist;for(var n in s)a.push({zuid:n,uname:n,dname:s[n]});Participants.update(e.chid,a,"USER ADDED"===i.mode?"14":"15")}}if(ChatUI.isExist(e.chid)){var r=ChatUI.exist[e.chid],o=ChatUI.isLastMsgMissingInChatWindow(e),l=o?r.wmslmsgtime:-1;ChatUI.displayMsg(e),o&&ChatUI.updateMissingTranscript(e,l)}}},18:function(e){ChatUI.updateGuestData(e,"option")},19:function(e){ChatUI.isChannel(e.ctype)||(ChatUI.isExist(e.chid)?ChatUI.updateTitle(e):ChatsList.updateElement(e.chid,e.msg.title,!1,ChatUI.isChannel(e.ctype)))},21:function(e){var t=e.s.split(":");WmsImpl.isChatSupported(t[2])&&!WmsImpl.getSilent()&&(ChatUI.isChannel(e.ctype)?Channels.join(t[1],!1):Chat.join(t[1],e.ctype,!1,!0))},104:function(t){var i=e(t);WmsImpl.isLocalUser(i[2])||ChatUI.updateTypingStatus(i[0],"chat.is.typing",i[2],i[3],!0)},105:function(t){var i=e(t);WmsImpl.isLocalUser(i[2])||ChatUI.updateTypingStatus(i[0],"")},110:function(t){var i=e(t);WmsImpl.isLocalUser(i[2])||ChatUI.updateTypingStatus(i[0],"chat.entered.text",i[2],i[3],!1)},106:function(e){LiveSupport.create(e)},108:function(e){LiveSupport.remove(e.chid)},109:function(e){LiveSupport.missed(e.chid)},113:function(e){if(ChatUI.isExist(e.chid)){var e={msg:{mode:"ZC CUSTOM MESSAGE",opruser:{zuid:WmsImpl.getZuid()},msg:"chat.support.end"},mtype:"16",chid:e.chid,time:e.time};ChatUI.displayMsg(e)}},32:function(e){"notifyunreadcount"===e.opr?(ChatsList.removeBubble(e.data.chid),MainUI.removeChatsFromHideport(e.data.chid)):"clearunreadcount"===e.opr&&ChatsList.markAllread()},47:function(e){ChatUI.isExist(e.chid)&&ChatUI.enableDisableHistory(e)},57:function(e){ChatsList.unreadchatarr=e.uctime,_print("unreadchats"," chatarr is ==>"+JSON.stringify(ChatsList.unreadchatarr)+" time: ===>"+new Date),ChatsList.removeallunreadchats()},50:function(e){if(e){e=$Util.filteronlyAllowedChat(e);var t=jQuery.extend(!0,{},e);ChatsList.update({resp:e.uc||e.ac,isunread:!!e.uc},"chats"),WmsBarImpl.updateFromActiveChats(t)}},34:function(e){var t=ChatsList.getCatagory(e[0]);$WC.$CUtil.isEmpty(t)||(ChatUI.removeWindow(e[0]),ChatsList.delete(e[0]))},1:function(e){FeedsUI.addNewFeed(e)},4:function(e){if("ZcalNotification"===e.operation||"ATTENDEE STATUS UPDATE"===e.operation){var t=JSON.parse(e.data);"Reminder"!==t.module||$WC.$CUtil.isEmpty(t.module)?Events.getWithDelay():EventsUI.showReminder(t.euid)}},2:function(e){WmsImpl.custommsghandler(e)},38:function(e){if("cw_opr"===e.module){var t=e.data;!$WC.$CUtil.isEmpty(t.info)&&"true"===t.info.unpin&&ChatsList.get(t.chid)?(ChatUI.removeWindow(t.chid),ChatsList.delete(t.chid)):"close"===t.action?ChatUI.removeWindow(t.chid):"seen"===t.action?(ChatUI.removeNewmsgNotification(t.chid,!0),MainUI.removeChatsFromHideport(e.data.chid),$WC.$CUtil.isEmpty(t.mentionmsgid)||Mentions.markasRead(t.mentionmsgid,"",!0)):("pin"===t.action||"unpin"===t.action)&&(Chat.isChannelChid(t.chid)?Channels.pinUnpinChannel(t.chid,"pin"===t.action):ChatsList.get(t.chid)&&ChatsList.pinUnpinChat(t.action,t.chid))}else if("updatewmssettings"===e.module)Settings.updateInObj(e.data);else if("markcomponentsasseen"===e.module)HomeUI.removeComponentsFromUI(e.data.id,e.data.type);else if("markeventasseen"===e.module){var i=Events.getAllSeenEvents();i[e.data.eventid]=!0,Events.markEventAsSeen(e.data.eventid)}},29:function(e){MMChat.handleWMSMessage(e)},59:function(e){e.module&&"conference"===e.module?Conference.handleWmsMessage(e):$ZCVideoBroadcast.handleWmsMessage(e)},61:function(e){MyBots.handleBotOpr(e)}};return function(e,i){"function"==typeof t[e]&&t[e](i)}}()};var UI={},InstantChat={};UI={bannertimer:"",servicebannertimer:"",quotetimer:"",quoteShareWin:null,init:function(){this.handleNiceUrl(),$("body").append(Template.UI),MainUI.getLHSOrderHTML(),this.container=$("#outercontainer"),this.bindEvents(),DREImpl.bindEvents(),IntegrationsCwin.bindEvents(),$ZCVideoBroadcast.bindEvents(),Commands.init(),MessageActions.init(),Bots.init(),Functions.init(),Schedulers.init(),PlatformDatabases.init(),Applications.init(),LeftPannel.init(),ContactsList.init(),ChatsList.init(),ChannelsUI.init(),ChatUI.init(),ChatHistoryTitleSearch.init(),MainUI.init(),Composer.init(),LiveSupport.init(),LeftPannel.container.find("#myname").text($zcg._USERFULLNAME),Sound.init(),MediaPlayer.init(),this.onresize(),HoverDetails.init(),ZCScroll.customScroll($("#leftpannel #list"),!0),Home.init(),Events.init(),Reminders.init(),Conference.initialize(),MessageContextParser.init(),"false"===$zcg._ISZOHOONELAUNCHERENABLED&&($("#ztb-switch-menu").one("mouseover",Topbar.initializeZAppsMenu),$("#ztb-switch-menu").click(Topbar.initializeZAppsMenu)),window.addEventListener("online",UI.handlePreFetch),$zcg._ISFIRSTLOGIN&&UI.FeedBack.loadChat(!0),this.handleRTL()},handleRTL:function(){var e=["ar","ur","he","fa","ha","ckb","ku","ps","yi"];e.includes($zcg._USERLANG)&&$("body").addClass("rtl-mode")},handleNiceUrl:function(e,t){var e=e?e:window.location.pathname.split("/"),i=e[1],a=e[2],s=!1;if("undefined"!=typeof a){var n;switch("extensions"===i&&(n=a,i=e[3],a=e[4]),i){case"channels":Channels.handleChannelPermaLink(a,t),s=!0;break;case"bots":BotsUI.handlePermaLink(a,n),s=!0;break;case"huddle":Conference.handlePermaLink(a,t),s=!0}return s}},handleLoadingPage:function(){var e=$("#quoteui");if(0!==e.length){$zcg._INITIALISED=!0;var t=e.addClass("zcqut_anim").find("#quotebg");t.fadeOut(300,function(){var t=$("#zcdashnotify"),i=e.find("#quotecontainer");$('<h1 id="wlcm_title" class="zcheretext zcquthd">'+Resource.getRealValue("home.quote.header")+'</h1><h1 class="zcheretext zchurnm">'+Resource.getRealValue("home.greeting",['<span class="clr0" data-name>'+$WC.$CUtil.processXSS($zcg._USERNICKNAME)+"</span>"])+"</h1>").prependTo(i),$('<div id="sharequote" class="mT15"><span purpose="twitter" class="msi-twitter curP"></span></div>').appendTo(i),t.append(i.addClass("msi-qut zcqut_anim")),e.remove(),t.find("#quotecontainer").hide().fadeIn(1e3)})}},loadDependancyFiles:function(){if("undefined"!=typeof $WC&&"undefined"!=typeof $WC.$CUtil&&($WC.$CUtil.setConfig({Resource:Resource,zuid:$zcg._ZUID,dname:$zcg._USERNICKNAME,zindex:1e3,photoserver:$zcg._PHOTOSERVER,CHATCONT:"_chat",orgid:$zcg._ORGID,isOrgUser:function(){return!0},isRegistered:function(){return!0},SystemApiHandler:$WC.ButtonActionsImpl.handle,ExecuteButtonResponseHandler:$WC.ExecuteButtonResponseImpl.handle,CHATCFPARAMNAME:$zcg._CFPARAMNAME,CHATCFCOOKIENAME:$zcg._CFCOOKIENAME,getSilentUserMention:MsgUtil.getDisplayableSilentUserMentionMsg}),$WC.$CUtil.pubsub.subscribe("/channels/updatelist",function(e,t){Channels.updateData(t)})),!$WC.$CUtil.isEmpty($zcg._SPOTLIGHTPROPS)){var e=document.createElement("script");e.src=($WC.$CUtil.isEmpty($zcg._JSSTATICURL)?"/officechat/javascript":$zcg._JSSTATICURL+"/officechat/js")+"/common/spotlight.js",e.onload=function(){ZCTrack.init(),$ZCAjx.ajax({url:"/registerinspotlight.do",type:"POST"})},document.head.appendChild(e)}MMChat.isAnyMediaOptionEnabled()&&MMChat.loadAndinit()},topbar:{height:function(){return $("#ztb-topband").outerHeight()}},bindEvents:function(){$("body").on("click","a",function(){$(this).attr("rel","noopener noreferrer");var e=this.getAttribute("dataurl");e&&$(this).attr("href",MsgTemplate.getRedirectLink(e))}),$("#trynow").on("click",function(){WmsLite.retryConnection(),$("#bannertimer").html('<span id="bannertext" class="conntext grclr">'+Resource.getRealValue("common.connecting")+"</span>")}),$("#quotecontainer").on("click","[purpose]",function(e){var t,i=e.currentTarget,a=$(i).attr("purpose"),s=$zcg.quote.txt,n=$zcg.quote.author,r='"'+s+'" - '+n+" via @zohocliq\n",o=(window.screen.height-500)/2,l=(window.screen.width-700)/2,c="height=500,width=700,left="+l+",top="+o;if("twitter"===a&&(t=$zcg.twittersharelink.split("?")[0]+'?hashtags=QuoteOfTheDay,CliqInspiration,ZohoCliq&url=""&text='+encodeURIComponent(r)),t){if(UI.quoteShareWin&&!UI.quoteShareWin.closed)return void UI.quoteShareWin.focus();UI.quoteShareWin=window.open(t,"",c),UI.quoteShareWin.focus()}}),ImgViewer.bindEvents()},handleAttachmentOperations:function(e,t){t=$(t);var i=t.attr("documentclick"),a=t.parents("#imgviewerdetails");a.length||(a=t.parents("[fname]"));var s=a.attr("url"),n=a.attr("chid"),r=a.attr("fname"),o=a.attr("content"),l="true"===a.attr("isv1");if("attdownload"===i)r?"undefined"!=typeof DesktopApp?DesktopApp.downloadURL(MsgTemplate.getFileDownloadLink(o,s,r,l)):window.location=MsgTemplate.getFileDownloadLink(o,s,r,l):window.open(MsgTemplate.getRedirectLink(s),"_blank");else if("attforward"===i){var c=$WC.$CUtil.processXSS(a.attr("comment"));ImgViewer.close(),FileForwardUI.handle(n,o,s,r,c,l,"true"===a.attr("hasthumbnail"))}else"annotateimage"===i&&(ZCTrack.track("ANNOTATE",{TRIGGER:"Imgviewer"}),ImgViewer.Annotator.annotateAndForwardImage(a,a.attr("chid")))},handleLinkAudioVideoPlay:function(e){e=$(e);var t=e.attr("iframe");e.html(t)},handleHashValue:function(){var e=window.location.hash,t=e.split("/"),i=t[0],a=t.slice(1,t.length),s=window.location.pathname;if(s.startsWith("/users/")){var n=s.split("/users/")[1];$WC.$CUtil.isEmpty(n)||Chat.create(n,"im"),window.history.pushState({},null,window.location.origin+"/index.do")}else if(s.startsWith("/chats/")){var r=s.split("/chats/")[1];$WC.$CUtil.isEmpty(r)||Chat.attachSession(r),window.history.pushState({},null,window.location.origin+"/index.do")}else s.startsWith("/verifysuccess")&&window.history.pushState({},null,window.location.origin+"/index.do");if(i=i.substring(1),"unreadchats"===i)HistoryUI.init(),ChatHistory.getUnread();else if("joinchannel"===i)a.length>0&&Channels.join(a[0],!0);else if("chat"===i||"createim"===i)a.length>0&&Chat.create(a[0],"im");else if("continuechat"===i)a.length>0&&Chat.attachSession(a[0]);else if("approvechannel"===i){var o=parseInt(a[0]),l={1:"channel.approved",2:"channel.rejected",3:"channel.alreadyapproved",4:"channel.approve.failed",5:"channel.reject.failed",6:"channel.notexist"},c=(a[1],Resource.getRealValue("undefined"!=typeof l[o]?l[o]:"channel.approve.failed",Resource.getRealValue("channel.head")));1===o||2===o||3===o?UI.updateBanner(c,5e3):UI.updateBanner(c,5e3,!0)}else if("chatsettings"===i){PersonalizeUI.createWindow();var d=$("#personalizewin");PersonalizeUI.changeOption(d,d.find('[option="advance"]'))}else"cliqapps"===i?a.length>0&&(IntegrationUI.init(Integration.Modules.Applications),Applications.preview(a[0])):"createchannel"===i?ChannelsUI.create():"extensions"===i&&IntegrationUI.init(Integration.Modules.Applications);_nullifyHashChange()},onresize:function(){var e=$Util.getOuterCntHeight();this.container.height(e),LeftPannel.setHeight(e),MainUI.resize(),ImgViewer.resizeNavigationPosition(),DREImpl.resize(),MMChat.handleUIResize(),ChatsList.updateUnreadNotifier(),Tour.positionTourTip(),RemindersUI.handleResize(),Conference.handleResize()},updateBanner:function(e,t,i,a){if(!$WC.$CUtil.isEmpty(e)){clearTimeout(this.bannertimer);var s=i===!0?'<em class="ldng_error msi-alert" />':'<em class="ldng_success msi-like"><span class="hintanim" /></em>';s=a?'<em class="ldng_neutral msi-alerttriangle" />':s;var n=$("#ajaxstatus");n.html(s+e),n.slideDown();var r=$WC.$CUtil.getDirectTextFromHtmlString(e),o=r.split(" ").length,t=2e3;o>10&&(t=1e3*Math.round(o/4)),this.hideBanner(t)}},hideBanner:function(e){clearTimeout(this.bannertimer),e?this.bannertimer=setTimeout(function(){$("#ajaxstatus").slideUp()},e):$("#ajaxstatus").slideUp()},updateServiceBanner:function(e,t,i){clearTimeout(this.servicebannertimer);var a=$("#servicebanner");a.find("#servicebannermsg").html(e),a.slideDown(),t?$("#hideservicebanner").one("click",function(){$("#servicebanner").slideUp()}):this.hideServiceBanner(i?i:2e3)},hideServiceBanner:function(e){clearTimeout(this.servicebannertimer),e?this.servicebannertimer=setTimeout(function(){$("#servicebanner").slideUp()},e):$("#servicebanner").slideUp()},updateAnnouncementBanner:function(e,t,i){if(e=$.trim(e),e=Smiley.replace(e),t=parseInt(t),t==UI.Announcement.TOP_BANNER){$("#topbanner").length&&$("#topbanner").remove(),$("#forumbanner").length&&$("#forumbanner").remove();var a='<div id="topbanner" class="zclq_wmsbnr" style="display: none;"><div id="redstrip" class="zclq_strip"></div><div id="wmsannmsg" class="zclq_olymn"><span id="annmsg">'+e+'</span><div id="hide" class="msi-dwnarw"></div><span id="close" class="dntshow">'+Resource.getRealValue("announcement.close")+"</span></div></div>";$("#outercontainer").prepend(a);var s=$("#topbanner");s.on("click",function(e){var t=s.find("#wmsannmsg"),a=e.target.id,n=e.target.tagName;"redstrip"==a?t.slideDown():"hide"==a||"A"==n?t.slideUp():"close"==a&&(s.slideUp(400,function(){s.remove()}),i?WmsLite.clearAnnouncement():Settings.update({announcementversion:$zcg._ANNOUNCEMENT.version}))}),s.slideDown()}else if(t==UI.Announcement.BOTTOM_DLG){$("#forumbanner").length&&$("#forumbanner").remove();var n=$zcg._ANNOUNCEMENT.link,a='<div style="display:none;" id="forumbanner" class="zcanocemnt"><div class="zcupbnr zcancbnr"><div class="msi-announceicn"></div><div class="msi-announceicn zcancbk"></div><div class="font18 mrgT5">'+Resource.getRealValue("announcement.forum.title")+'?</div><div id="annmsg" class="zcancim mrgT10">'+e+'</div><div id="close" class="msi-close cur"></div><div class="mrgT10"><div class="dIB clr6 font15 valgnspr">'+Resource.getRealValue("announcement.forum.share")+':</div><div class="zcscllnk dIB mrgL5"><a target="_blank" href="'+$zcg.fbsharelink+n+'"><span class="msi-fb"></span></a><a target="_blank" href="'+$zcg.twittersharelink+n+'"><span class="msi-twitter"></span></a><a target="_blank" href="'+$zcg.gpsharelink+n+'"><span class="msi-gplus"></span></a><a target="_blank" href="'+$zcg.linkedinsharelink+n+'"><span class="msi-lnkin"></span></a></div></div></div></div>';$("#chatsection").prepend(a);var r=$("#forumbanner");r.find("#close").on("click",function(){r.slideUp(400,function(){r.remove()}),Settings.update({announcementversion:$zcg._ANNOUNCEMENT.version})}),r.fadeIn(600)}else if(t==UI.Announcement.SURVEY_BANNER&&!$zcg._ISZOHOORZYLKER){$("#forumbanner").length&&$("#forumbanner").remove();var n=$zcg._ANNOUNCEMENT.link,a='<div style="display:none;" id="forumbanner" class="zcanocemnt zcsurveyann"><div purpose="close" class="msi-close cur"></div><div class="dflxcent justifySB"><div class="zcsurvey-msg">'+e+'</div><div class="zcsurvey-img"><img src="/officechat/images/default/survey_img.png"></div></div><a purpose="close" class="zcsurvey-btn" target="_blank" href="'+n+"?email="+$zcg._EMAILID+'">'+Resource.getRealValue("announcement.survey.btn")+"</a></div>";$("#chatsection").prepend(a);var r=$("#forumbanner");r.find('[purpose="close"]').on("click",function(){r.slideUp(400,function(){r.remove()}),Settings.update({announcementversion:$zcg._ANNOUNCEMENT.version})}),r.fadeIn(600)}},checkConnectionAndUpdateBanner:function(e){var t=$("<img/>"),i='<em class="ldng_error msi-alert"></em>',a=e.find("#statusmsg"),s="<span id='bannertimer' class='bannertimer'><span id='bannertext' class='conntext grclr'>"+Resource.getRealValue("common.connecting")+"</span></span>";t.on("load",function(){"wmsdown"!==a.attr("data-purpose")&&(a.attr("data-purpose","wmsdown"),a.html(i+Resource.getRealValue("common.wmsdown.error",[s])),e.slideDown())}),t.on("error",function(){"neterror"!==a.attr("data-purpose")&&(a.attr("data-purpose","neterror"),a.html(i+Resource.getRealValue("common.network.error",[s])),e.slideDown())}),t.attr("src",$Util.getImgStaticUrl()+"/network-connection.png?t="+(new Date).getTime())},updateReconnectionBanner:function(e){var t=$("#networkstatus");e?(t.find("#statusmsg").removeAttr("data-purpose"),t.slideUp()):UI.checkConnectionAndUpdateBanner(t)},handlePreFetch:function(){var e=$('<link id="domainPreload" rel="preconnect" href="'+window.location.origin+'">');$(document.head).append(e),$(e).remove()},logout:function(){$DB.clearSessionStorage(),"undefined"!=typeof DesktopApp?DesktopApp.logout($zcg._LOGOUTLINK):window.location.href=$zcg._LOGOUTLINK},initializeInTopbar:function(){var e=$("#ztb-switch-menu").detach();_initializeTopBar(),$("#ztb-topband").prepend(e),FeedsUI.init(),MentionsUI.init(),Settings.isEmbedChatEnabled()&&EmbedUI.init(),CheckList.init(),GSUI.init(),QuickAction.init()},overlay:{memory:[],exist:function(){return this.memory.length>0},add:function(e){-1===this.memory.indexOf(e)&&this.memory.push(e)},remove:function(e){this.memory.splice(this.memory.indexOf(e),1)},removeBasedonOpener:function(e){for(var t=0,i=this.memory.length;i>t;t++){var a=this.memory[t];if(0===a.indexOf(e+"|")){this.remove(a);break}}},close:function(){if(this.exist()){var e=this.memory[this.memory.length-1];return operationdetails=e.split("|"),window[operationdetails[0]][operationdetails[1]](operationdetails[2]),Chat.pauseMedia(operationdetails[0]),this.remove(e),!0}return!1}},KeyboardShortcuts:{createwin:function(){if(!$WC.$Win.isExist("keyshortcutwin")){var e=Template.keyboardshortcuts,t="mac"===$Util.getOS()?"cmd":"ctrl";e=e.replace(/{CTRLKEY}/g,"ctrl").replace(/{CMD_OR_CTRL}/g,t);{$WC.$Win.create({id:"keyshortcutwin","class":"keyscutwin",aligncenter:!1,header:Resource.getRealValue("keyshrotcut.keyboardshortcuts"),html:e})}Settings.isPrivateGroupEnabled()||$("#keyshortcutwin").find("#creategroupshortcut").remove()}}},FeedBack:{requestsent:!1,fileobj:[],attachmentlimit:5,attachmentsize:0,attachmentmaxsize:10485760,constructUI:function(){var e=ProfileMenuUI.htmls.feedbackui;e="true"===$zcg._ISADMIN?e.replace(/{FAQHTML}/g,ProfileMenuUI.htmls.feedbackuiadminfaqshtml).replace(/{FEEDBACKCOMPOSER}/g,ProfileMenuUI.htmls.feedbackuicomposerhtml):e.replace(/{FAQHTML}/g,ProfileMenuUI.htmls.feedbackuiuserfaqshtml).replace(/{FEEDBACKCOMPOSER}/g,ProfileMenuUI.htmls.feedbackuicomposerhtml);var t=$("#accountmenu").find("#usermenu");t.after(e);var i=$("#accountmenu").find('[purpose="feedbackUI"]');i.addClass("show"),$("#feedbackcomment").focus(),UI.FeedBack.bindEvents(i)},bindEvents:function(e){e.find("[purpose='openlink']").on("click",function(){window.open($(this).attr("link"))}),e.find("[purpose='submit']").on("click",function(){UI.FeedBack.handleFeedBackSubmit()}),e.find("[type='file']").on("change",function(){UI.FeedBack.addFileinWin(e,this.files)}),e.find("#feedbackcomment").on("paste",function(){var e=this.id;$WC.DivEditor.editors[e]={handlePaste:function(){},handleTextPaste:function(){}},$WC.DivEditor._onPaste(event,e,this),event.preventDefault()}),$zcg._IE9||e.on("drop",function(t){var i=t.originalEvent;i.dataTransfer&&i.dataTransfer.files.length&&UI.FeedBack.addFileinWin(e,i.dataTransfer.files)})},handleFeedBackSubmit:function(){var e=$("#feedbackcomment").text(),t=$.trim(e).length;if(t>0){if(t>4e3)return void UI.updateBanner(Resource.getRealValue("feedback.msg.length.alert"),2e3,!0);var i=$ZCAjx.formData({msg:e,triggerfrom:"Settings"},"files",UI.FeedBack.fileobj,!0);UI.FeedBack.submitFeedback(i),UI.FeedBack.fileobj=[],UI.FeedBack.attachmentsize=0}},addFileinWin:function(e,t){var i=e.find('[type="filelist"]'),a=t.length;if(i.find('[type="preview"]').length+a>UI.FeedBack.attachmentlimit)return void UI.updateBanner(Resource.getRealValue("common.file.cumulative.count.exceeded.threshold",[UI.FeedBack.attachmentlimit]),2e3,!0);for(var s=0;a>s;s++){var n=t[s];if(UI.FeedBack.attachmentsize+n.size>UI.FeedBack.attachmentmaxsize)return void UI.updateBanner(Resource.getRealValue("feedback.error.sendfile"),2e3,!0);UI.FeedBack.attachmentsize+=n.size,UI.FeedBack.fileReader(n,i)}e.find("#upload")[0].reset(),ZCScroll.customScroll(i.parent(),!0,{suppressScrollX:!1,suppressScrollY:!0})},fileReader:function(e,t){if($WC.Matcher.check("imagemimetype",e.type)){var i=new FileReader;i.onload=function(i){var a='<img src="'+i.target.result+'" /><span id="close" class="zchat-close dN" title="'+Resource.getRealValue("common.remove")+'"></span></div>';UI.FeedBack.addAttachment(t,a,e.name,e)},i.readAsDataURL(e)}else{var a='<div class="filetypcon msi-atchfle font24" "><span class="fltypnm ellips">{FILETYPE}</span></div><span id="close" class="zchat-close dN" title="'+Resource.getRealValue("common.remove")+'"></span>';UI.FeedBack.addAttachment(t,a,e.name,e)}},addAttachment:function(e,t,i,a){var s=[a,i];UI.FeedBack.fileobj.push(s);var n=i.lastIndexOf(".")+1;if(-1!==n){var r=i.substring(n);t=t.replace(/{FILETYPE}/g,r)}else t=t.replace(/{FILETYPE}/g,"");e.prepend('<div type="preview" name="'+i+'" class="posl dIB upfile">'+t+"</div>"),$("#close").on("click",function(e){e.stopImmediatePropagation();for(var t=$(this).parent(),i=t.attr("name"),a=UI.FeedBack.fileobj,s=a.length,n=0;s>n;n++)if(a[n][1]===i)return UI.FeedBack.attachmentsize-=a[n][0].size,UI.FeedBack.fileobj.pop(a[n]),void t.remove();t.remove()})},showChatWithUs:function(){try{var e=$zcg._SUPPORTCHATURL+"/isavail.ls?widgetcode=90643b459b1adf9d5c8ba650d8418fb920e08b0db97505d0356abd50f79ef960b98c1a63374591ce9bfceccb13c55f5b";$.ajax({url:e,type:"GET",dataType:"jsonp",data:{format:"callback"},success:function(e){if(e){var t=$("#accountmenu");if(0===t.find('[purpose="chatwithus"]').length){var i='<div purpose="chatwithus"><span class="msi-livechat"></span><span class="ellips">'+Resource.getRealValue("feedback.chatwithus")+"</span></div>";t.find('[purpose="feedback"]').after(i).fadeIn(500)}}}})}catch(t){}},loadChat:function(e){if($("#siqcht").length)return void UI.FeedBack.showChatWithUs();var t={};e&&(t.op=$zcg._IS_DIRECT_CLIQUSER?"DIRECT_SIGN_UP":"EXISTING_SIGN_UP",t.e=$zcg._EMAILID,t.sn="Cliq",t.zsoid=$zcg._APPACCOUNTID);var i=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript";var s='var $zoho=$zoho || {}; $zoho.salesiq = $zoho.salesiq || { widgetcode:"90643b459b1adf9d5c8ba650d8418fb920e08b0db97505d0356abd50f79ef960b98c1a63374591ce9bfceccb13c55f5b",values:{},ready:function(){}};var d=document;s=d.createElement("script");s.type="text/javascript";s.id="zsiqscript";s.defer=true;s.src="'+$zcg._SALESIQURL+'";t=d.getElementsByTagName("script")[0];t.parentNode.insertBefore(s,t);';a.innerHTML=s;var n=document.createElement("script"),r='$zoho.salesiq.ready=function(embedinfo){UI.FeedBack.showChatWithUs();$zoho.salesiq.floatbutton.visible("hide");$zoho.salesiq.chat.logo("'+$.getImgStaticUrl()+'/cliq-support.png");$zoho.salesiq.floatwindow.minimize(function(){$zoho.salesiq.floatbutton.visible("hide");'+(e?"$zoho.salesiq.visitor.customaction('"+JSON.stringify(t)+"');":"")+"});}";n.innerHTML=r,i.appendChild(a),i.appendChild(n)},submitFeedback:function(e){this.requestsent||($ZCAjx.ajax({url:"/sendofficechatuserfb.do",type:"POST",data:e,processData:!1,contentType:!1,success:function(){UI.FeedBack.requestsent=!1,$("#feedbackcomposer").html(ProfileMenuUI.htmls.feedbackuisuccessstatushtml).fadeIn(300)},error:function(){UI.FeedBack.fileobj=[],UI.FeedBack.attachmentsize=0,UI.FeedBack.requestsent=!1},paramdesc:{phoneno:"common.phoneno"}}),this.requestsent=!0)}},Announcement:{TOP_BANNER:1,BOTTOM_DLG:2,SURVEY_BANNER:3,isNewAnnouncementAvailable:function(){var e=$zcg._ANNOUNCEMENT.version,t=parseInt($zcg._ANNOUNCEMENT.exptime);return e&&Settings.getFromObj("announcementversion",!0)!==e&&(-1==t||$Util.getSyncedCurrentTime()<t)?!0:!1},show:function(){UI.Announcement.isNewAnnouncementAvailable()&&!$WC.$CUtil.isEmpty($zcg._ANNOUNCEMENT.msg)&&UI.updateAnnouncementBanner($zcg._ANNOUNCEMENT.msg,$zcg._ANNOUNCEMENT.type)}},Logo:{getGeneralURL:function(e){return this.getLogoURL("general",e)},getIconURL:function(e){return this.getLogoURL("icon",e)},getFavIconURL:function(e,t){return this.getLogoURL(e?"unreadfavicon":"favicon",t)},getLogoURL:function(e,t){return $zcg._LOGOURLS&&$zcg._LOGOURLS.hasOwnProperty(e)?$zcg._LOGOURLS[e]:t},isCustomized:function(e){return $zcg._LOGOURLS&&$zcg._LOGOURLS.hasOwnProperty(e)}},Theme:{updateTheme:function(){if($Util.isMacOs()&&$("body").addClass("mac-os"),$Util.isRetina()&&$("body").addClass("is-retina"),$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME)||$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME.primary_color))if($WC.$CUtil.isEmpty($zcg._CUSTOMTHEME)||$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME.theme_name)){var e="cust_theme ";$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME)||$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME.theme_name)||(e+=" "+$zcg._CUSTOMTHEME.theme_name),$("body").removeClass(function(t,i){return e+(i.match(/theme\d/,"g")||[]).join(" ")}).addClass("theme"+Settings.getFromObj("cthemes"))}else{var t=$zcg._CUSTOMTHEME.theme_name;$("body").addClass(t)}else{var i=$zcg._CUSTOMTHEME.primary_color;$("body").addClass("theme1 cust_theme");var a="body { --main-bg-color: "+i+";}",s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=a:n.appendChild(document.createTextNode(a)),s.appendChild(n)}if(Settings.isDarkModeChoosed()){var e="theme"+Settings.getFromObj("cthemes")+" cust_theme theme1 ";$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME)||$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME.theme_name)||(e+=" "+$zcg._CUSTOMTHEME.theme_name),$("body").removeClass(e).addClass("nite-mode")}else $("body").removeClass("nite-mode")}}},InstantChat={Create:function(){var e=$WC.$Win.create({id:"inschatwin",header:Resource.getRealValue("common.instantchat"),"class":"inschatwin",html:Template.InstantChat});this.bindEvents(e)},bindEvents:function(e){e.find("#inssend").on("click",function(){var e=$("#inschatwin"),t=e.find("#insemailid"),i=e.find("#insmsg"),a=t.val().trim(),s=i.val().trim();$WC.Matcher.check("emailid",a)?s.length>1e3?(e.find("#inserrmsg").html(Resource.getRealValue("common.message.error")).show(),i.addClass("error")):($(this).val(Resource.getRealValue("common.sending.continuation")),InstantChat.sendInvitation(a,s)):(e.find("#inserrmsg").html(Resource.getRealValue("common.emailid.error")).show(),t.addClass("error"))}),e.find("#insmsg, #insemailid").on("focusin keydown",function(){var e=$("#inschatwin"),t=e.find("#insemailid, #insmsg");$(this).parent().addClass("zcplctop"),t.hasClass("error")&&(t.removeClass("error"),e.find("#inserrmsg").slideUp("slow"))}),e.on("click","[purpose='focus']",function(){$(this).addClass("zcplctop").find("[purpose='textval']").focus()}),e.on("focusout blur","[purpose='textval']",function(){$WC.$CUtil.isEmpty($(this).val())&&$(this).parent().removeClass("zcplctop")})},sendInvitation:function(e,t){var i={mailid:e,MYMAIL:$zcg._EMAILID,elang:$zcg._LANG};t&&(i.msg=t),$ZCAjx.ajax({url:"/invitetozoho.do",type:"POST",data:i,success:function(){UI.updateBanner(Resource.getRealValue("common.invitation.sent.success")),$WC.$Win.destroy("inschatwin")},error:function(){$("#inssend").val(Resource.getRealValue("common.send.request")),UI.updateBanner(Resource.getRealValue("common.invitation.sent.error"),2e3,!0)}})}};var ChatBot={getTitle:function(){return $DB.get("bot").dname},getChid:function(){return $DB.get("bot").chid},getImgUrl:function(){return $zcg._IMGDEFAULTSTATICURL+"/taz.png"},getHoverImgUrl:function(){return $zcg._IMGDEFAULTSTATICURL+"/taz-hover.png"},isBot:function(e){if(!$WC.$CUtil.isEmpty(e)){var t=new $CliqChatId(e);if(t.chatType==t.RestoreTypes.TAZ)return!0}return!1},storeIfSystemBot:function(e){!$WC.$CUtil.isEmpty(e)&&this.isBot(e.chid)&&$DB.update("bot",e)},join:function(){if(!$DB.isEmpty("bot")){var e=$DB.get("bot").chid;Chat.join(e,$zcg.NO_OPERATIONCHAT,!1,!0)}}},SmartSearch={},SearchEntities={},SearchField={},SearchActions={},SearchHTML={};WmsHybridSearch.checkAndOpenChat=function(e,t,i,a,s,n,r,o,l,c){if(e===WmsHybridSearch.constants.CHANNEL&&(n||c)){var d=n?Channels.getByChid(n).oc_id:c;ChannelsUI.trackChannelClick("spotlight"),!Channels.isJoined(d)||Channels.isArchived(d)||Channels.isPending(d)?ChannelsUI.triggerPreview(d):Channels.handlejoin(n,!0)}else if(e===WmsHybridSearch.constants.CHAT&&r)Chat.attachSession(r);else if(e===WmsHybridSearch.constants.CONTACT&&t)a=$WC.$CUtil.isEmpty(a)?void 0:a,i?Chat.create(t,"nim",i,a):a?Chat.create(t,"im",void 0,a):Chat.create(t,"im");else if(e===WmsHybridSearch.constants.ADDCONTACT){var u=elem.getAttribute("data-email"),m=[];m.push(u),Contacts.add("zoho",m.join())}},SearchEntities={"channels-groupsuggest":"ChannelsUI.groupsuggestion","channels-usersuggest":"ChannelsUI.usersuggestion","preview-usersuggest":"ChannelsUI.Preview.inviteusersuggest",spotlight:"SmartSearch",morejoinedchannels:"ChannelsUI.List.LHS.showAllChannels",invitecontact:"ContactsUI.inviteContactUI","commands-groupsuggest":"CommandsUI.groupsuggestion","messageactions-groupsuggest":"MessageActionsUI.groupsuggestion","fileforward-usersuggest":"FileForwardUI","Events-usersuggest":"EventsUI.participantsSuggestion","bots-groupsuggest":"BotsUI.groupsuggestion","createcht-usersuggest":"QuickChat","forwardmessages-usersuggest":"MessageOperations.forward","createforkchat-usersuggest":"MessageOperations.fork","participants-usersuggest":"ParticipantsWin","addparticipants-usersuggest":"ParticipantsAddWin","msg-actions":"MessageActionsUI.cwin","integrations-chatsuggest":"IntegrationsCwin.chatSuggestion",showallcontacts:"ContactsUI.showAllContacts",showallbots:"BotContactsList.showAllBots","reminder-addparticipants":"RemindersUI.userSuggest","events-addparticipants":"EventsContextCUWidget.userSuggest",reactedUsers:"Reactions"},SearchField={init:function(e){this.bindEvents(e)},getEntityObject:function(e){return $Util.getNamespace(e,SearchEntities)},bindEvents:function(e){var t=$("#"+e+"-search-field");"INPUT"===t[0].tagName?(t.on("keydown",function(t){SearchField.handleKeyDown(e,t,$.trim(this.value))}),t.on("keyup",function(t){SearchField.handleKeyUp(e,t,$.trim(this.value))})):$WC.DivEditor.initEditor(e+"-search-field",{highlightclass:"sel",handleKeyDown:function(e,t){var i=e.substring(e,e.indexOf("-search-field")),a=$WC.DivEditor.removeBufferCharacters($WC.DivEditor.getCurrNodeTextValue(e));SearchField.handleKeyDown(i,t,a)},handleKeyUp:function(e,t){var i=e.substring(e,e.indexOf("-search-field")),a=$WC.DivEditor.removeBufferCharacters($WC.DivEditor.getCurrNodeTextValue(e));SearchField.handleKeyUp(i,t,$.trim(a))}});var i=$("#"+e);i.on("mouseover click",'[purpose="search"]',function(t){var a=i.find(this);if("mouseover"===t.type){i.find(".sel").removeClass("sel"),a.addClass("sel");var s=SearchField.getEntityObject(e);"function"==typeof s.handleMouseOver&&s.handleMouseOver(t);var n=$("#"+e+"-helptip");SearchField.updateHelpTip(e,n,a)}else SearchField.handleAction(e,t,$(this),!0)}),i.on("click","[purpose]",function(){var t=this.getAttribute("purpose");if("deleteSelectedNode"===t||"deletenode"===t){var i=$(this).parents("[nodetype]"),a=SearchField.getEntityObject(e),s=!1;if("function"==typeof a.handleDeleteNode&&(s=a.handleDeleteNode(i,e)),!s){i.remove(),SearchField.clear(e),SearchField.populateDefaultResult(e);var n=$("#"+e+"-search-field");"INPUT"===n[0].tagName?n.focus():$WC.DivEditor.focus(e+"-search-field")}}})},handleKeyDown:function(e,t,i){var a=t.which,s=SearchField.getEntityObject(e),n=$("#"+e).find("[data-selections]");if(a===$zcg.ENTER_KEYCODE||a===$zcg.TAB_KEYCODE||a===$zcg.UP_KEYCODE||a===$zcg.DOWN_KEYCODE)t.preventDefault();else if(n.length>0)if(a===$zcg.LEFT_KEYCODE||a===$zcg.RIGHT_KEYCODE){var r=DropdownUtil.handleSelectionNavigation(t,n,$(t.target));"undefined"!=typeof r&&this.clear(e)}else if(a===$zcg.BACKSPACE_KEYCODE||a===$zcg.DELETE_KEYCODE){var r=DropdownUtil.removeSelection(t,n,$(t.target));"undefined"==typeof r&&this.search(e,"",!0)}else $(t.target).hasClass("hide-caret")&&t.preventDefault();"function"==typeof s.handleKeyDown&&s.handleKeyDown(t,i)},handleKeyUp:function(e,t,i){var a=t.which,i=$.trim(i),s="block"===$("#"+e+"-results").css("display");if(a===$zcg.TAB_KEYCODE||a===$zcg.SHIFT_KEYCODE||a===$zcg.CTRL_KEYCODE);else if(a===$zcg.ENTER_KEYCODE){var n=$("#"+e+"-results").find(".sel");this.handleAction(e,t,n,s),t.stopPropagation()}else if(a===$zcg.ESCAPE_KEYCODE){if(s)t.stopPropagation(),this.clear(e);else if(this.hasNodes(e+"-search-field")||0!==i.length){t.stopPropagation(),this.clear(e),this.clearSearchField(e),this.focus(e);var r=SearchField.getEntityObject(e);return"function"==typeof r.handleKeyUp&&r.handleKeyUp(t,i),void(i="")}}else if(a===$zcg.UP_KEYCODE||a===$zcg.DOWN_KEYCODE){if(s){var o=$("#"+e),l=DropdownUtil.handleListNavigation(t,o.find("#"+e+"-list"),'[purpose="search"]');if("undefined"!=typeof l){var c=$("#"+e+"-helptip");this.updateHelpTip(e,c,l)}}}else 0===i.length?(this.clear(e),$("#"+e+"-search-field").attr("prevsearchval",""),this.focus(e)):this.search(e,i);0!==i.length||$Util.isArrowKey(a)||$Util.isModifierKey(a,t)||this.populateDefaultResult(e);var r=SearchField.getEntityObject(e);"function"==typeof r.handleKeyUp&&r.handleKeyUp(t,i)},handleAction:function(e,t,i,a){var s=$("#"+e+"-search-field");if("click"===t.type&&(t.stopPropagation(),"INPUT"!==s[0].tagName&&$WC.DivEditor.focus(e+"-search-field")),a){var n=this.insertSelection(e,i.attr("elemtype"),i.attr("uid"));n&&s.val("").focus()}var r=SearchField.getEntityObject(e);"function"==typeof r.handleAction&&r.handleAction(t,i,a),this.clear(e),s.attr("prevsearchval",""),this.populateDefaultResult(e)},insertSelection:function(e,t,i,a){var s=$("#"+e).find("[data-selections]");if(s.length>0){var n=SearchField.getImageUrlByType(t,i),r=SearchField.getRecipientName(t,i);$WC.$CUtil.isEmpty(r)&&(r=a);var o=DropdownUtil.getSelectionHTML(r,i,n);return s.append(o),!0}},search:function(e,t,i){var a=$("#"+e+"-search-field");if(i||t.length>0&&a.attr("prevsearchval")!==t){a.attr("prevsearchval",t);var s=SearchField.getEntityObject(e).search(t);s||this.displayNoResultFound(e,t)}},focus:function(e){$("#"+e+"-search-field").focus()},clearSearchField:function(e){$("#"+e+"-search-field").text(""),$("#"+e+"-search-field").attr("prevsearchval","")},clear:function(e){var t=SearchField.getEntityObject(e);"function"==typeof t.clear&&t.clear()},populateDefaultResult:function(e){var t=SearchField.getEntityObject(e);"function"==typeof t.populateDefaultResult&&t.populateDefaultResult()},displayNoResultFound:function(e,t){var i=SearchField.getEntityObject(e);"function"==typeof i.displayNoResultFound&&i.displayNoResultFound(t)},updateHelpTip:function(e,t,i){var a=SearchField.getEntityObject(e);"function"==typeof a.updateHelpTip&&a.updateHelpTip(t,i)},getImageUrlByType:function(e,t){if("contact"===e)return Users.getImgUrlById(t);if("emailids"===e)return Users.getDefaultImgUrl();if("channel"===e){var i=new $CliqChatId(t);return i.isChannel()?Channels.getImgUrlByChid(t):Channels.getImgUrl(Channels.getObject(t))}return"group"===e?Groups.getImgUrlById(t):"bot"===e?MyBots.getImgById(t):void 0},getRecipientName:function(e,t){if("chat"===e||"chathistory"===e)return ChatHistoryTitleSearch.getTitle(t)||ChatsList.getTitle(t);if("contact"===e||"bot"===e)return Users.getName(t);if("group"===e)return Groups.getDisplayName(t);if("channel"===e){var i=new $CliqChatId(t);return i.isChannel()?$WC.$CUtil.processXSS(Channels.getByChid(t).cn):Channels.getName(t)}},getNodeforSelection:function(e,t,i){var a=e.uid,s=e.type;if(t){var n=SearchField.getImageUrlByType(s,a),r=document.createElement("div");r.setAttribute("uid",a),r.setAttribute("class","zccontcnt dIB ellips zvta"),r.setAttribute("elemtype",s),r.setAttribute("contenteditable",!1),r.setAttribute("nodetype","+");var o='<div class="zcgrpmimg"><img src="{IMGSRC}">'+(i?"":'<div purpose="deletenode" class="msi-close cur"></div>')+'</div><span title="{DNAME}">{DNAME}</span>';return o=o.replace(/{IMGSRC}/,n).replace(/{DNAME}/g,$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(e.name,!1))),r.innerHTML=o,r}var l=document.createElement("SPAN");l.setAttribute("uid",a),l.setAttribute("elemtype",s),l.setAttribute("contenteditable",!1),l.setAttribute("class","selusr"),l.setAttribute("nodetype","+");var c=$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(e.name,!1));return"undefined"!=typeof e.trigger&&(l.setAttribute("nodetype",e.trigger),c=trigger+c),l.innerHTML=c,l},getMultiTypeSelectedList:function(e){for(var t=$WC.DivEditor.getInsertedNodes(e),i={},a=0,s=t.length;s>a;a++){var n=t[a],r=n.getAttribute("elemtype"),o=n.getAttribute("uid");null!=r&&null!=o&&(i[r]||(i[r]=[]),i[r].push(o))}return i},getSelectedList:function(e){for(var t=$WC.DivEditor.getInsertedNodes(e),i=[],a=0,s=t.length;s>a;a++){var n=t[a];null!=n.getAttribute("elemtype")&&null!=n.getAttribute("uid")&&i.push(n.getAttribute("uid"))}return i},insertNodeinField:function(e,t,i){var a=e+"-search-field",s=$("#"+a);$WC.DivEditor.deleteCurrentNode(a),$WC.DivEditor.insertObject(a,s[0],i)},checkAndAddEmailInAutocomplete:function(e,t,i){var a=$("#"+e+"-results");if("true"===$zcg._ISNONORGMEMBERINVITEALLOWED&&$WC.Matcher.check("emailid",t,!0)){a.show();var s='<div id="suggested" searchcatagory="suggested" class="zcemidsugg"><div uid="'+t+'" data-val="'+t+'" elemtype="emailids" purpose="search" class="srchbn sel"><span class="usrimgsts"><img width="24" height="24" src="'+Users.getDefaultImgUrl()+'"></span><span class="usrname ellips"><em>'+t+"</em></span></div></div>";return i&&(s='<div uid="'+t+'" elemtype="emailids" purpose="search" class="zcrtchtcontct cur"><div class="floatl adchtlft posl"><img src="'+Users.getDefaultImgUrl()+'"><div class="usrstatus msi-addicon"></div></div><div class="floatl adchtrht mrgL10"><div class="ellips font16">'+t+'</div><div class="ellips clr6 font14">'+Resource.getRealValue("chat.participant.nonorg")+"</div></div></div>"),a.find("#"+e+"-list").append(s),!1}return!0},hasNodes:function(e){var t=$WC.DivEditor.getInsertedNodes(e).length;return t?!0:!1}},SearchActions={doAction:function(e,t,i){e.shiftKey?this.searchInHistory(i):e.ctrlKey||"info"===e.target.id?this.viewDetails(t):this.createChat(t)},createChat:function(e){var t=e.attr("elemtype");if(void 0!==t){var i={contact:function(e){ContactsList.reqForChat(e.attr("uid"),!1)},channel:function(e){ChannelsUI.trackChannelClick("globalsearch");var t=e.attr("chid");Channels.isJoined(e.attr("uid"))&&!Channels.isArchived(new $CliqChatId(t))?Channels.handlejoin(e.attr("chid"),!0):ChannelsUI.triggerPreview(e.attr("uid"))},chathistory:function(e){Chat.attachSession(e.attr("chid"))},bot:function(e){Chat.attachSession(e.attr("chid"))},privatechat:function(e){InstantChat.sendInvitation(e.attr("val"))},message:function(e){var t=e.attr("ctype");"1"===t||"9"===t?i.chathistory(e):"8"===t&&i.channel(e)}};i[t](e)}},viewDetails:function(e){var t=e.attr("elemtype");if(void 0!==t){var i=e.attr("uid"),a={contact:function(e){Contacts.getProfileDetails(e)},channel:function(e){ChannelsUI.triggerPreview(e)},chathistory:function(){Chat.attachSession(e.attr("chid"))},bot:function(){MyBots.continue(e.attr("uid"))}};a[t](i)}},searchInHistory:function(e){HistoryUI.construct(),$("#historysearch").val(e),HistoryUI.getSearchResults(e,400),e.length<3&&UI.updateBanner(Resource.getRealValue("common.searchhistory.minchars"),2e3,!1)}},SearchHTML={searchinhistoryhtml:'<div class="zblbsrmgrt"><span class="gray">shift +</span><span class="msi-zcentr_ico mrgR10 gray"></span>'+Resource.getRealValue("common.search.history")+"</div>",botsearchhtml:'<div id="bot{BOTID}" chid="{CHID}" uid="{BOTID}" elemtype="bot" data-key="{BOTID}" purpose="search" class="zcuserstatus withimg"><img id="contactuserimg{BOTID}" class="floatl rds4" style="width:40px;height:40px" src="{IMGURL}"><div class="floatl userdetails"><div id="contactdname{BOTID}" class="ellips">{NAME} {CREATOR}</div><span class="ellips glbsrctxt">{DESC}</span></div><div id="contactscode{ID}" scode ="{SCODE}" class="{STATUSCLASS}"></div></div>',contactsearchhtml:'<div id="contact{ID}" uid="{USERID}" elemtype="contact" purpose="search" data-key="{USERID}" class="zcuserstatus withimg"><img id="contactuserimg{ID}" class="floatl rds4" style="width:40px;height:40px" src="{IMGURL}"><div class="floatl userdetails"><span id="contactdname{ID}" class="ellips">{DNAMEVAL}</span><span id="contactmailid{ID}" class="ellips glbsrctxt">{EMAILID}</span></div><div id="contactscode{ID}" scode ="{SCODE}" class="{STATUSCLASS}"></div>{PROFILELINK}</div>',groupsearchhtml:'<div id="group{ID}" uid="{GROUPID}" elemtype="group" purpose="search" class="zcuserstatus withimg"><img class="floatl rds4" style="width:40px;height:40px" src="{IMGURL}"><div class="floatl userdetails"><span id="groupdname{ID}" class="ellips">{DNAMEVAL}</span><div class="ellips glbsrctxt"><span class="msi-grpstatus-{ROLE}"></span>{PARTICIPANTSDETAIL}</div></div><div id="info" title="'+Resource.getRealValue("common.info")+'" class="msi-zinfo"></div></div>',chathistorysearchhtml:'<div id="GS{CHID}" elemtype="chathistory" data-key="{CHID}" purpose="search" chid="{CHID}" isremoved="{ISREMOVED}" deleted="{DELETEDSTATUS}" class="zcuserstatus {NONLASTMSGCLASS} withimg">{CHATIMAGE}<div class="zcunrd-rht"><div class="zcunrdlt-txt floatl ellips"><span class="floatl ellips bold zcunrdtit" title="{TITLE}">{TITLENAME}</span></div>{LASTMSGHTML}</div><div class="msi-chatico"></div></div>',channelshtml:'<div id="channel{ID}" uid="{CHANNELID}" chid="{CHID}" data-key="{CHID}" elemtype="channel" purpose="search" class="zcsschlist"><span class="usrimgsts zcssimg floatl">{IMG}</span><div class="userdetails floatl"><span id="channelname{ID}" class="ellips">{DNAMEVAL} </span><span class="ellips glbsrctxt">{CDESCRIPTION}</span></div><div id="info" title="Info " class="msi-zinfo"></div></div>'};var QuickAction={},QuickChat={};QuickAction={actionshtml:'<div id="global-action-menu" class="crtactn">{{direct_message}}{{adhoc_chat}}{{start_broadcast}}{{start_call}}{{create_channel}}{{create_reminder}}{{create_event}}</div>',quickChatHtml:'<div id="createcht-usersuggest" class="mcontent zcinhds zcrchmcnt"><div  class="zccrhd font16 bold mrgL20">{{header}}</div><div id="chtheader" class="dN mrgL20"><div  class="font15 bold mrgT15" data-target="checklist">{{chattitle}}</div><input id="chattile" type="text" data-target="checklist" class="zccrhd font15 mrgT5" name="" placeholder="{{inputplaceholder}}"></div><div id="chttitle-err" class="chttiterr mrgL20">{{chaterror}}</div><div id="createcht-usersuggest-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="{{quickchtnode}}"></div><div id="createcht-usersuggest-results" class="zcrchtlt"><div id="createcht-usersuggest-list" class="posl w100 h100"></div></div><div class="crchndcnt"><div id="usernodecnt" class="zcrchicnt"><div id="createcht-usersuggest-select-field" contenteditable="false" class=""></div></div><div id="createchatbtn" class="windwbtn dIB cur mrgL15">{{create}}</div></div></div>',quickchatcontacthtml:'<div uid="{USERID}" elemtype="contact" purpose="search" data-val="{DNAMEVAL}"class="zcrtchtcontct cur"><div class="msi-hisseld floatl adchtlft posl"><img src="{IMGURL}"><div class="{STATUSCLASS}"></div></div><div class="floatl adchtrht mrgL10"><div class="ellips font16">{DNAMEVAL}</div><div class="ellips clr6 font14"><a class="cur" href="javascript:void(0)">{EMAILID}</a></div></div></div>',quickdirectmsgcontacthtml:'<div uid="{USERID}" elemtype="contact" quickaction purpose="{PURPOSE}" data-val="{DNAMEVAL}"class="zcrtchtcontct cur"><div class="floatl adchtlft posl"><img src="{IMGURL}"><div class="{STATUSCLASS}"></div></div><div class="floatl adchtrht mrgL10"><div class="ellips font16">{DNAMEVAL}</div><div class="ellips clr6 font14"><a class="cur" href="javascript:void(0)">{EMAILID}</a></div></div></div>',videoaudiocallcontacthtml:'<div uid="{USERID}" elemtype="contact" class="zcrtchtcontct cur" quickaction purpose="{{purpose}}" ><div class=" floatl adchtlft posl"><img src="{IMGURL}"><div class="{STATUSCLASS}"></div></div><div class="floatl adchtrht mrgL10"><div class="ellips font14">{DNAMEVAL}</div><div class="ellips clr6 font13"><a class="cur" href="javascript:void(0)">{EMAILID}</a></div></div><div class="floatr posl callicons mrgL5"><div class="dflxcent">{{audiocallhtml}}{{videocallhtml}}</div></div></div>',init:function(){QuickAction.bindEvents(),QuickAction.updateIcon()},showActions:function(e){var t="",i="",a="",s="",n="",r="",o="";if(SecurityManager.hasPermission(Modules.DirectMessage)&&(r=$WC.template.replace('<div id="directmessagewin" quickaction purpose="directmessagewin" class="msi-dirctmsg ellips" title="{{directmsg}}">{{directmsg}}</div>',{$direct_message:"quickaction.create.reminder"})),SecurityManager.hasPermission(Modules.DirectMessage)&&(o=$WC.template.replace('<div id="adhocchatwin" quickaction purpose="adhocchatwin" class="msi-adhoccht ellips" title="{{groupchat}}">{{groupchat}}</div>',{$adhoc_chat:"quickaction.create.reminder"})),$ZCVideoBroadcast.isStreamingEnabled()&&(t=$WC.template.replace('<div id="startbroadcast" quickaction purpose="showBroadcastStartWin" class="msi-broadcast">{{start_broadcast}}</div>',{$start_broadcast:"quickaction.start.broadcast"})),SecurityManager.hasPermission(Modules.Reminders)&&(i=$WC.template.replace('<div id="createremwin" quickaction purpose="showReminderCreateWin" class="msi-remquickadd">{{create_reminder}}</div>',{$create_reminder:"quickaction.create.reminder"})),SecurityManager.hasPermission(Modules.Events)&&(a=$WC.template.replace('<div id="createevntwin" quickaction purpose="showEventCreateWin" class="msi-eventcreate">{{create_event}}</div>',{$create_event:"quickaction.create.event"})),MMChat.isAudioVideoCallEnabled()){var l="";MMChat.isAudioCallEnabled()&&(l+=".audio"),MMChat.isVideoCallEnabled()&&(l+=".video"),s=$WC.template.replace('<div id="calluserwin" quickaction purpose="calluserwin" class="msi-usrcall">{{start_call}}</div>',{$start_call:"quickaction.header.calluserwin"+l})}ChannelsPermission.hasPermission(MActions.Create)&&(n=$WC.template.replace('<div id="createchnlwin" quickaction purpose="showChannelCreateWin" class="msi-chnlcreate">{{create_channel}}</div>',{$create_channel:"checklist.channel.create"}));var c=QuickAction.actionshtml;c=$WC.template.replace(c,{direct_message:r,adhoc_chat:o,start_broadcast:t,create_reminder:i,create_event:a,start_call:s,create_channel:n},"InSecureHTML"),c=$WC.template.replace(c,{$directmsg:"quickaction.header.directmessagewin",$groupchat:"quickaction.create.group"}),$("#createchatcontainer").html(c),Clickoutside.bind({srcid:"createchatcontainer",event:e,customShow:function(e){$("#"+e.srcid).addClass("show")},destid:"global-action-menu",customHide:function(e){$("#"+e.srcid).removeClass("show").html("")}})},bindEvents:function(){$(document).on("click","[quickaction]",function(e){e.stopPropagation();var t=$(this),i=t.attr("purpose");"directmessagewin"==i||"adhocchatwin"==i||"calluserwin"==i?(Clickoutside.handleClickOnChild(e),QuickChat.createwin(void 0,i)):QuickAction.handle[i](t,e)})},updateIcon:function(){QuickAction.isAnyOptionEnabled()?$("#createchatcontainer").show():$("#createchatcontainer").hide()},isAnyOptionEnabled:function(){return SecurityManager.hasPermission(Modules.DirectMessage)||$ZCVideoBroadcast.isStreamingEnabled()||SecurityManager.hasPermission(Modules.Reminders)||SecurityManager.hasPermission(Modules.Events)||MMChat.isAudioVideoCallEnabled()||ChannelsPermission.hasPermission(MActions.Create)},handle:{showChannelCreateWin:function(e,t){ZCTrack.track("GA_CREATECHANNEL"),Clickoutside.handleClickOnChild(t),ChannelsUI.create()},showEventCreateWin:function(e,t){ZCTrack.track("GA_CREATEEVENT"),EventsUI.handle.open(t)},showReminderCreateWin:function(e){RemindersUI.handle.setCustomDate(e)},showBroadcastStartWin:function(e,t){Clickoutside.handleClickOnChild(t),$ZCVideoBroadcast.showBroadcastStartWin()},showQuickActions:function(e,t){QuickAction.showActions(t)},initiateChat:function(e){ZCTrack.track("GA_DIRECTMESSAGE"),$WC.$Win.destroy("addgroupchatwin"),Chat.create(e.attr("uid"),"im")},startAudioCall:function(e){ZCTrack.track("GA_AUDIOVIDEOCALL"),$WC.$Win.destroy("addgroupchatwin"),MMChat.triggerAudioCall(e.attr("uid"),"button_system_api")},startVideoCall:function(e){ZCTrack.track("GA_AUDIOVIDEOCALL"),$WC.$Win.destroy("addgroupchatwin"),MMChat.triggerVideoCall(e.attr("uid"),"button_system_api")}}},QuickChat={titlechange:"",createwin:function(e,t){var i=e&&e.classname||"";if(!$WC.$Win.isExist("addgroupchatwin")){var a=t;"calluserwin"==t&&(MMChat.isAudioCallEnabled()&&(a+=".audio"),MMChat.isVideoCallEnabled()&&(a+=".video"));var s=$WC.template.replace(QuickAction.quickChatHtml,{$header:"quickaction.header."+a,$chattitle:"common.chat.title",$inputplaceholder:"quickchat.input.placeholder",$chaterror:"chat.title.error",$quickchtnode:"quickchat.node.placeholder",$create:"common.start"}),n=$WC.$Win.create({id:"addgroupchatwin","class":t+" quickactin adchtwin"+i,html:s});$("#addgroupchatwin").attr("action",t),this.searchInput=$("#createcht-usersuggest-search-field"),SearchField.init("createcht-usersuggest"),this.bindEvents(n,t)}},bindEvents:function(e,t){"adhocchatwin"===t&&(e.find("#createchatbtn").on("click",function(){QuickChat.Createchatwin("createcht-usersuggest-select-field")}),e.on("click","[purpose='deleteimgnode']",function(){$(this).parents("[nodetype]").remove(),$WC.DivEditor.focus("createcht-usersuggest-search-field"),QuickChat.handleChatTitleInput(),QuickChat.setChatTitle(),QuickChat.populateDefaultResult(),$WC.$CUtil.isEmpty($("#createcht-usersuggest-select-field").html())&&$("#createcht-usersuggest").addClass("zcrchmcnt")}),e.find("#chattile").on("blur",function(){var e=$(this).val(),t=$WC.$CUtil.isEmpty($(this).val());if(QuickChat.titlechange=!1,t)return QuickChat.titlechange=!0,void QuickChat.setChatTitle();var i=QuickChat.getChatTitle();t||e!==$.trim(i)||(QuickChat.titlechange=!0,QuickChat.setChatTitle())}),e.find("#chattile").on("keydown",function(e){return e.which===$zcg.ENTER_KEYCODE?void QuickChat.Createchatwin("createcht-usersuggest-select-field"):void $("#chttitle-err").removeClass("zcfdk_tmbzoom")}),QuickChat.titlechange=!0),e.find("#createcht-usersuggest-search-field").focus(),this.populateDefaultResult(),ZCScroll.customScroll($("#createcht-usersuggest-list"),!0);var i={suppressScrollX:!1,minScrollbarLength:50};ZCScroll.customScroll($("#usernodecnt"),!0,i)},search:function(e){var t=$("#addgroupchatwin").attr("action"),i=QuickAction.quickchatcontacthtml;if("directmessagewin"===t)i=QuickAction.quickdirectmsgcontacthtml.replace(/{PURPOSE}/,"initiateChat");else if("calluserwin"===t){i=QuickAction.videoaudiocallcontacthtml;var a=MMChat.isAudioCallEnabled()?'<div class="mrgR10 dIB audio-icon"><span uid="{USERID}" quickaction purpose="startAudioCall" class="msi-call"></span></div>':"",s=MMChat.isVideoCallEnabled()?'<div class="dIB video-icon"><span uid="{USERID}" quickaction purpose="startVideoCall" class="msi-video"></span></div>':"";i=$WC.template.replace(i,{audiocallhtml:a,videocallhtml:s,purpose:MMChat.isAudioCallEnabled()?"startAudioCall":"startVideoCall"},"InSecureHTML")}var n=$("#createcht-usersuggest-results"),r=SearchField.getSelectedList("createcht-usersuggest-select-field"),o=$("#createcht-usersuggest-list");o.html("");var l=SearchAgent.search({searchin:SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,ignorelist:r,listid:"createcht-usersuggest-list",val:e,contactshtml:i,orgcontactshtml:i,allstatuscontacts:!1,successcallback:function(){QuickChat.focusFirstResult(n)},clearcallback:function(){QuickChat.populateEmptyResult()}});l?(QuickChat.focusFirstResult(n),ZCScroll.scrollTop(o,0)):QuickChat.populateEmptyResult()},focusFirstResult:function(e){var t=$WC.DivEditor.removeBufferCharacters(QuickChat.searchInput.text());if(!$.trim(t).length)return void e.find(".sel").removeClass("sel");var i=e.find("[purpose='search']");i.length&&0===e.find(".sel").length&&i.first().addClass("sel")},handleKeyUp:function(e,t){var i=e.which;if(e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&($WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes("createcht-usersuggest-search-field")?$WC.$Win.destroy("addgroupchatwin"):SearchField.clearSearchField("createcht-usersuggest")),i===$zcg.ESCAPE_KEYCODE){var a=$WC.DivEditor.removeBufferCharacters($("#createcht-usersuggest-search-field").text());$WC.$CUtil.isEmpty(a)&&this.populateDefaultResult()}SearchField.hasNodes("createcht-usersuggest-list")||QuickChat.populateEmptyResult()},handleAction:function(e,t){var i=t.attr("uid"),a=Users.getName(i),s=t.attr("elemtype"),n='<div uid="'+i+'" elemtype="'+s+'" title="'+a+'" nodetype="@" class="dIB zcricnt posl"><img src="'+Users.getImgUrlById(i)+'"/><div class="msi-close posa dN cur" purpose="deleteimgnode"></div></div>';t.remove(),$WC.$CUtil.isEmpty(i)||($("#createcht-usersuggest-select-field").append(n),$("#createcht-usersuggest").removeClass("zcrchmcnt"),SearchField.clearSearchField("createcht-usersuggest"),QuickChat.handleChatTitleInput(),QuickChat.setChatTitle())},getChatTitle:function(){var e=Composer.parseEditor("createcht-usersuggest-select-field"),t=QuickChat.createChatTitle(e.ulist),i=SearchField.hasNodes("createcht-usersuggest-select-field");return i?$WC.$CUtil.isEmpty(t)?$WC.DivEditor.getNodes("createcht-usersuggest-select-field")[0].title:t:void 0},handleChatTitleInput:function(){var e=Composer.parseEditor("createcht-usersuggest-select-field"),t=$("#addgroupchatwin").find("#chtheader");e.ulist.length>=2?(t.slideDown(),t.addClass("chtheader")):(t.slideUp(),t.removeClass("chtheader"),$("#chttitle-err").removeClass("zcfdk_tmbzoom"))},setChatTitle:function(){var e=SearchField.hasNodes("createcht-usersuggest-select-field");e&&QuickChat.titlechange?$("#chattile").val(QuickChat.getChatTitle()):!e&&QuickChat.titlechange&&$("#chattile").val("")},createChatTitle:function(e){var t,i=e.length;return i>1&&(t=Composer.getDnameForChatTitle(e[0])+", "+Composer.getDnameForChatTitle(e[1])+" & ",2===i?t+=Composer.getDnameForChatTitle(WmsImpl.getZuid()):i>2&&(t+=Resource.getRealValue("common.more"))),t},emptyStateAdhocChatTitle:function(e){e.splice(e.indexOf(WmsImpl.getZuid()),1);var t=e.length;return 2===t?Composer.getDnameForChatTitle(e[0])+" & "+Composer.getDnameForChatTitle(e[1]):t>2?Composer.getDnameForChatTitle(e[0])+", "+Composer.getDnameForChatTitle(e[1])+" & "+Resource.getRealValue("common.more"):void 0},populateDefaultResult:function(){var e=$WC.DivEditor.removeBufferCharacters($("#createcht-usersuggest-search-field").text());$WC.$Win.isExist("addgroupchatwin")&&$WC.$CUtil.isEmpty(e)&&this.search("*")},populateEmptyResult:function(){var e=$("#createcht-usersuggest-list"),t="quickchat.no.result";e.html(""),$WC.$CUtil.isEmpty($("#createcht-usersuggest-search-field").text())&&(t="quickchat.no.contact"),e.html('<div class="clr6 dflxjustcent h100"><span>'+Resource.getRealValue(t)+"</span></div>")},Createchatwin:function(e){var t,i=$.trim($("#chattile").val()),a=Composer.parseEditor(e);type="im";var s=QuickChat.getChatTitle(),n=a.ulist.length,r=i===s||1===n?void 0:i,t="";if(a.ulist.length){if(r?(type="n"+type,t=r):t=1===n?void 0:a.title,n>1&&-1!==t.indexOf("#"))return $("#chttitle-err").addClass("zcfdk_tmbzoom"),void $("#chattile").focus();ZCTrack.track("GA_ADHOCCHAT"),Chat.create(a.ulist.join(","),type,t,void 0,"smartchat"),$WC.$Win.destroy("addgroupchatwin")}}},_initializeTopBar=function(){var e={rebranding:{logo:UI.Logo.getGeneralURL($Util.getImgStaticUrl()+("fuji"===$zcg._BRAND?"/logo.png":"/logo-white.png"))},menus:[{uitype:"search",id:"ztb-search"},{uitype:"button",id:"starredmessages",iconClass:"zcf-star",title:Resource.getRealValue("common.starmessages"),action:function(){$("#ztb-starredmessages").find(".touranim").length||StarMessagesUI.open()}},{uitype:"button",id:"atmention",iconClass:"zcf-mention",title:Resource.getRealValue("tour.zcatmention.title"),action:function(){$("#ztb-atmention").find(".touranim").length||MentionsUI.open()}},{uitype:"button",id:"history",iconClass:"zcf-history",title:Resource.getRealValue("common.chat.history"),action:function(){$("#ztb-history").find(".touranim").length||(ZCTrack.track("CHAT_HISTORY_VIEW",{TRIGGER:"Mouse"}),ChatHistory.load())}},{uitype:"button",id:"reminders",iconClass:"zcf-reminders",title:Resource.getRealValue("reminders.title"),action:function(e){e.stopPropagation(),RemindersUI.handle.getAndShowInRHS($(e.target),!0)}},{uitype:"button",id:"events",iconClass:"zcf-calendar",title:Resource.getRealValue("common.notification.event"),action:function(e){EventsUI.show(e)}},{uitype:"button",id:"setintegration",iconClass:"zcf-integ",title:Resource.getRealValue("integration.title"),action:function(e){IntegrationUI.init(void 0,e)}}],userInfo:{userId:$zcg._ZUID,photo:$zcg._PHOTOSERVER+"/file?fs=thumb&nocache="+Date.now(),id:"profile",action:function(e){ProfileMenu.init(e)}}};if(("fuji"===$zcg._BRAND||"baihui"===$zcg._BRAND)&&($WC.$CUtil.isEmpty($zcg.topbarhomelink)||(e.zohoHomeLink=$zcg.topbarhomelink),$WC.$CUtil.isEmpty($zcg.topbaraccountslink)||(e.myAccountLink=$zcg.topbaraccountslink),$WC.$CUtil.isEmpty($zcg.topbarwebsitelink)||(e.zohoWebsiteLink=$zcg.topbarwebsitelink),$WC.$CUtil.isEmpty($zcg.topbarbloglink)||(e.blogLink=$zcg.topbarbloglink),$WC.$CUtil.isEmpty($zcg.topbarforumlink)||(e.forumLink=$zcg.topbarforumlink)),!SecurityManager.hasPermission(Modules.Taz)){var t={uitype:"button",id:"feed",iconClass:"zcf-feed font15",title:Resource.getRealValue("common.notification.feed")};e.menus.splice(3,0,t)}Topbar.init(e),SecurityManager.hasPermission(Modules.StarredMessages)||$("#ztb-starredmessages").hide(),SecurityManager.hasPermission(Modules.Reminders)||$("#ztb-reminders").hide(),Integration.isAnyPlatformComponentEnabled()||$("#ztb-setintegration").hide(),SecurityManager.hasPermission(Modules.Events)||$("#ztb-events").hide(),window.onZDLibraryReady=function(){ZDLibrary.Launcher.init({icon:{element:document.getElementById("ztb-switch-menu"),is_product_icon_available:!1,is_hamburger_available:!0},menuBar:document.getElementById("ztb-topband"),csrfName:$zcg._CFPARAMNAME,getCsrfValue:function(){return Cookie.get($zcg._CFCOOKIENAME)}})}},Topbar={actionobj:{},init:function(e){function t(t){var i=Topbar,a={rebranding:function(){return i.getLogoHTML(e.rebranding)},menus:function(){return i.getMenuHTML(e.menus)},userInfo:function(){return i.getUserInfoHTML(e.userInfo)}};return"function"==typeof a[t]?a[t]():""}var i="";for(var a in e)Topbar.updateActionObject(e[a]),i+=t(a);var s=$("#ztb-topband");s.html(i),s.find("div[type]").wrapAll('<div class="ztb-item-bx" id="ztb-menu-container" data-action-wrap/>'),"fuji"===$zcg._BRAND&&s.find("#ztb-logo").addClass("ztb-fjlogo"),Topbar.appendInviteUseHtml(),this.bindEvents(),0===Settings.getFromObj("globalsoundnotify")&&Sound.globalSoundDisabled(),ProfileMenu.isDarkmodeTourAvail()?ProfileMenu.triggerDarkmodeTour():"v0"===Settings.getFromObj("darkmodetourversion",!0)&&Settings.update({darkmodetourversion:"v1"})},appendInviteUseHtml:function(){if("true"==$zcg._ISAPPACCOUNTENABLED){var e="",t="";t="null"!=$zcg._APPACCOUNTID?_isAppAccountAdmin()&&$zcg._ACTIVE_APPACC_MEMBERS_COUNT<=4?"inviteusers":"":"setup",""!=t&&(e='<div id="orghandlebutton" purpose="'+t+'" class="zcorgbtn tpbricon zcinviteusers">+ '+Resource.getRealValue("createcompany."+t)+"</div>",$("#ztb-menu-container").prepend(e))}},updateActionObject:function(e){e&&e.id&&e.action&&(Topbar.actionobj[e.id]=e.action)},hideHamburgermenu:function(){return HamburgerMenu.removeZAppsMenu()},initializeZAppsMenu:function(e){e.stopPropagation(),"click"===e.type?HamburgerMenu.getZAppsMenu():HamburgerMenu.getHamburgerMenu()},getMenuHTML:function(e){function t(e){var t={search:function(){return GSUI.getTemplate()},button:function(){var t=Template.TopBarButtonHTML;return t.replace(/{ID}/g,e.id).replace(/{TITLE}/g,e.title).replace(/{CLASS}/g,e.iconClass)}};return"function"==typeof t[e.uitype]?t[e.uitype]():""}for(var i="",a=0;a<e.length;a++)Topbar.updateActionObject(e[a]),i+=t(e[a]);return i},getUserInfoHTML:function(e){return'<div type="profile" class="ztb-profile tpbricon mrgL10" id="ztb-profile"><div class="posrel" purpose="userimage"><img id="ztb-profile-image" src="'+e.photo+'"><span class="usrstatus zcstatus-1"></span></div></div>'},getLogoHTML:function(e){return'<a id="ztb-logo"><img src="'+e.logo+'" id="ztb-logo-rebrand"><label mute="0" title="'+Resource.getRealValue("common.globalmute")+'" class="msi-glmute glsound" id="ztb-globalmute"></a>'},bindEvents:function(){$("#topbar [data-action-wrap]").children().on("click",function(e){var t=$(this).attr("id");t=t.indexOf("-")>0?t.split("-")[1]:t,Topbar.actionobj[t]&&Topbar.actionobj[t](e)}),$("#ztb-globalmute").bind("click",Sound.toggleMuteAll),$("#orghandlebutton").on("click",function(){var e=$(this).attr("purpose");"inviteusers"===e?InviteUsersToOrg.createInviteUserPopUpUI():window.open("/createcompany.do")})}};var HamburgerMenu=function(){var e={},t=function(){zmwp.HamburgerMenu.loadResources(e),$("#ztb-apps-loading").length&&zmwp.HamburgerMenu.show(e)},i=function(e,t){var i={type:"script",url:e,callback:t};$Util.loadDynamicFiles(i)},a=function(){return'<div id="hamburgerHolder" class="zcbg_mask"><div id="ztb-apps-loading" class="ztb-apps ztb-font-family ztb-expand"><div class="zc_srch_ldng clr8"><span></span></div></div></div>'},s=function(){$("#hamburgerHolder").remove()},n=function(){var e=$(document.body).find("#ztbApps");return e.length?(zmwp.HamburgerMenu.remove(),!0):!1},r=function(a){var n=$(document.body);e={defaultAppList:["mail","chat","connect","docs","showtime","meeting","writer","sheet","show"],removeOnEscape:!1,removeOnOutsideClick:!0,parent:n.find("#ztb-apps-loading")[0],arrow:"topLeft",jsBasePath:a[1].jsBasePath,cssBasePath:a[1].cssBasePath,zohoHomeDomain:$zcg._HOMEDOMAIN,allAppsUrl:"/api/allapps",onShow:function(){n.find("#ztb-apps-loading").attr("id","ztbApps")},onRemove:s,text:{workplaceApps:"Workplace Apps",allApps:"All Zoho Apps"}},i(a[1].initialJS,t)},o=function(){$.ajax({url:$zcg._MAILDOMAIN+"/biz/getHamburgerMenu.do",type:"GET",success:r,error:s})},l=function(){var t=$(document.body),i=t.find("#ztbApps"),n=t.find("#ztb-apps-loading");i.length||n.length||(t.find("#zcwindows").append(a()),t.one("click",s),$WC.$CUtil.isEmptyObject(e)||(e.parent=t.find("#ztb-apps-loading")[0],zmwp.HamburgerMenu.show(e)))};return{getHamburgerMenu:o,getZAppsMenu:l,removeZAppsMenu:n}}(),GSUI=function(){var e={limit:5,currval:"",CONTACTS:1,USERS:2,CHATS:4,CHANNELS:8,MESSAGES:16,BOTS:32,RECENTCHATS:64,DEPARTMENTS:128,ignorelist:{},additionalcriteria:{},setSearchValue:function(t){e.searchvalue=$WC.$CUtil.trim(t).toLowerCase()},changeInputforFileType:function(e){if(e.file)for(var t=0,i=v.length;i>t;t++)if(v[t]===e.file){e.filetype=e.file.substring(e.file.lastIndexOf(".")+1),delete e.file;break}},getCriteria:function(t){var i={val:e.searchvalue,limit:this.additionalcriteria.limit,ignorelist:"undefined"!=typeof this.additionalcriteria.ignorelist?$Util.removeDuplicateEntries(this.additionalcriteria.ignorelist):[],populateid:t,successcallback:this.handleSuccess,emptycallback:this.additionalcriteria.emptycallback||this.handleEmpty},a=this.getAdditionalCriteria(t),s=$WC.$CUtil.extend(!0,i,a);return $WC.$CUtil.extend(!0,s,this.additionalcriteria)},getAdditionalCriteria:function(t){var i,a="",s={},n=this.additionalcriteria.chathtml,r=5;switch(t){case"contacts":i=Contacts.getSearchResults;case"users":a=this.additionalcriteria.contactshtml||SearchHTML.contactsearchhtml,this.additionalcriteria.ignorepeopledata||(s={peopledata:!0,container:H().querySelector("#resultsnodes"),getfrompeoplesearch:!0}),s.ignorelimit=this.additionalcriteria.ignorelimit,i=i||Users.getSearchResults;break;case"channels":n&&(a=n.replace(/{TITLE}/g,"{CNAME}").replace(/{MOCKID}/g,u)),a=a||SearchHTML.channelshtml;var o=this.additionalcriteria.searchprefix||"";s={ignorespecialchar:this.additionalcriteria.ignorespecialchar,channelshtml:a,val:o+e.searchvalue},i=Channels.getSearchResults;break;case"departments":a=T.departmentshtml,i=Department.getSearchResults;break;case"chats":"undefined"!=typeof n&&(a=n.replace(/{TITLE}/g,"#{TITLENAME}")),a=(a||SearchHTML.chathistorysearchhtml).replace(/{MOCKID}/,d),s={ignorebot:!0,filterusers:!0,addchatlist:!0},i=ChatHistoryTitleSearch.getSearchResults;break;case"bots":a=this.additionalcriteria.bothtml||SearchHTML.botsearchhtml,"undefined"!=typeof this.additionalcriteria.bothtml&&(a=a.replace(/{NAME}/g,"@{NAME}")),a=a.replace(/{MOCKID}/g,m),s={getbots:!0,getbotsonly:!0,nocreatorinfo:!0,includechatbot:!0,issubscribedonly:this.additionalcriteria.issubscribedonly,addrsltstoignorelist:!0},i=Bots.search}return s.limit=r,s.html=a,s.method=i,s},getResults:function(e,t){switch(e){case"contacts":return Contacts.getSearchResults(t);case"users":return Users.getSearchResults(t);case"channels":return Channels.getSearchResults(t);case"departments":return Department.getSearchResults(t);case"chats":return ChatHistoryTitleSearch.getSearchResults(t);case"bots":return Bots.search(t)}},isSearchAvailable:function(e,t){return t&this[e.toUpperCase()]&&1!==respMapping[moduleobj[e].index]},doSearch:function(t,i){this.additionalcriteria=i||this.additionalcriteria,e.searchvalue=t;var a=i.ignorelist||[WmsImpl.getZuid()],s=0,n=i.furtherreqmade||!1,r={searchin:i.searchin,ignorelist:a,respmapping:respMapping};this.additionalcriteria=$.extend(this.additionalcriteria,$Util.cloneObject(r,!0));for(var o=["contacts","users","bots","channels","chats","departments"],l=o.length,c=0;l>c;c++){var d=o[c];if(this.isSearchAvailable(d,i.searchin)){var u=this.getCriteria(d);u.ignorelist=u.ignorelist.concat(this.additionalcriteria.ignorelist),mi()&&(u.startswithsearch=!0);var m=this.getResults(d,u)||{},p=m.searchedlist||[];this.additionalcriteria.ignorelist=this.additionalcriteria.ignorelist.concat(p),s+=p.length,n=n||m.furtherreq;var h=this.getResultsContent(m);this.handleSuccess(h,null,d,m.furtherreq,m.val||t),this.checkAndUpdateAdditionalInfo(i,d)}}},checkAndHandleMsgLevelSearch:function(t,i){Ht()&&(i||(i={message:t}),q(),bi(),li(),Q(),oa(i,null,"messages",e.handleSuccess,e.handleEmpty,e.searchvalue))},checkAndUpdateAdditionalInfo:function(e){(!this.additionalcriteria.ignorepeopledata&&"contacts"===e||"users"===e)&&Users.updateUserDetails(searchedlist,H())},getResultsContent:function(t){return this.additionalcriteria.breakword?e.breakDname(t.content):t.content},handleSuccess:function(t,i,a,s,n){ti(a,t,s,e.additionalcriteria,n)},handleEmpty:function(t,i,a){ti(a,"",!1,e.additionalcriteria.populateinfo,t)},checkAndUpdateContainsSearch:function(t,i){var a=H(),s=a.querySelector("#resultsnodes");s.querySelector("#loadmore")||$(s).append('<div id="loadmore" class="loadmore"><div id="loadingoldmsgs" class="hst-loadngmn"><div class="hst-loadng dB"></div></div></div>'),respMapping=i.respmapping,i.containssearch=!0,e.doSearch(t,i)},breakDname:function(e){for(var t=$(e),i="",a=14,s=t.length,n=0;s>n;n++){var r=t[n].querySelector("[which='dname']"),o=r.innerText;o.length>a&&(o=o.split(" "),o.length>2?o=(o[0]+" "+o[1]).substring(0,a)+"...":(o=o.join(" "),o=o.length>a?o.substring(0,a)+"...":o)),r.innerText=o,i+=t[n].outerHTML}return i},parseMessageAsHTML:function(e,t){function i(e,t,i){var a=e.chid,s=ChatsList.getTitle(a,e.ctitle),n="",r="",o=s;e.sendername&&e.sender&&(o=Users.getName(e.sender,e.sendername));var l="clr6";t.from&&(l="ctit"),o=s===o?"":'<span class="'+l+'">'+o+":&nbsp;</span>";var c=aa(e);c=Smiley.replace(c),c=MsgUtil.getDisplayableSilentUserMentionMsg(c),-1!=c.indexOf("<br>")&&(n="scrhmore",r='<em class="scrhmoreico msi-more" data-purpose="show_more"></em>');var d=e.channeluid?Channels.getByChid(a).oc_id:"";return i=$WC.template.replace(i,{CHID:a,USRID:e.sender,CHAT_TITLE:s,MESSAGE:c,TIME:e.time,CHAT_TIME:$Date.daytime(e.time),CTYPE:e.ctype,USER_NAME:o,UID:d,SEARCH_MORE:r,CLASS_NAME:n},"InSecureHTML"),i=Smiley.convertAnimatedTo24(i)}for(var a="",s=e.length<t.lim?e.length:t.lim,n=0;s>n;n++)a+=i(e[n],t,T.message_details);return t.pno?a:'<div class="srchmsg_node"><div id="messagediv" class="srch-msgs" data-page="1">'+a+"</div></div>"},getMessages:function(t,i,a,s,n,r){function o(e){var t=e.fromtime,i=e.totime;return t&&i&&t>i&&(e.fromtime=i,e.totime=t),e}t&&e.isMsgSrchEnabled&&(this.changeInputforFileType(t),t=o(t),$ZCAjx.ajax({url:"/v1/messagesearch",data:t,success:function(n){if($("#messagediv").find("#loadmore").remove(),""===Ri().exactvalue)return tt(),void ra();if(ri(),$WC.$CUtil.isEmptyObject(n.data)||$WC.$CUtil.isEmpty(n.data.messages))E=$WC.$CUtil.extend(!0,{},Mi()),ti("messages","",!1,"",r);else{var o=n.data.messages,l=e.parseMessageAsHTML(o,t);l?(s(l,i,a,"",r),n.data.messages.length>t.lim&&ca()):ti("messages",l,!1,"",r)}},error:function(){ti("messages","",!1,"",r)}}))}},t=null,i=null,a=null,s=null,n=[],r="",o="",l=1,c=2,d=3,u=4,m=6,p=["@","#"],h={from:"from: @",to:"to: @","in":"in: #",after:"after: ",before:"before: ",on:"on: ",hasfile:"hasfile: ",haslink:"haslink: "},g={from:1,to:2,"in":3},f={hasfile:"file",haslink:"link",after:"fromtime",before:"totime",on:["fromtime","totime"]},v=["*.png","*.gif","*.jpeg","*.doc"],C={},y=[],b=/^(0[1-9]|1[012])\/(0[1-9]|[12][0-9]|3[01])\/([0-9]{4})$/,E={},I=["january","february","march","april","may","june","july","august","september","october","november","december"],T={tutor:'<div id="tutordiv" class="tutordiv"><div class="zcglrscnt"><div id="tutor" class="zcglrs-node mrgL15" target="default"></div><div class="header bold" data-purpose="header"><span>'+Resource.getRealValue("globalsearch.header.one")+"</span></div></div></div>",heading:'<div class="header bold" data-purpose="header"><span>{{TEXT}}</span></div>',msg_modifier_suggestion:'<div class="mrgL15 ellips"><div class="ds_in_blk cur" purpose="search" dataval="{MODIFIER}:&nbsp;{DNAME}" data-id="{ID}" mockid="1"><span class="clr8" uid="{ID}">{MODIFIER}:</span> {DNAME}</div></div>',chats_channelshtml:'<div class="ellips mrgL15"><div class="ds_in_blk cur" purpose="search" dataval="{MODIFIER}:&nbsp;{TITLE}" data-id="{CHID}" mockid="{MOCKID}"><span class="clr8" uid="{CHID}">{MODIFIER}:</span> {TITLE}</div></div>',tutorcontactshtml:'<div id="contact{ID}" uid="{ID}" tutorview="true" elemtype="contact" purpose="search" class="zcsschlistt dIB textcent posl"><div class="gstutorimg posl"><img src="{IMGURL}" class="rds4 dB mrgLR5" id="contactuserimg{ID}"><div id="contactscode{ID}" scode="{SCODE}" class="{STATUSCLASS}"></div></div><div id="userdetails" class="userdetails"><span id="contactdname{ID}" class="dname font13" which="dname">{DNAMEVAL}</span></div></div>',tutorchanhtml:'<div id="channel{ID}" uid="{CHANNELID}" chid="{CHID}" tutorview="true" elemtype="channel" purpose="search" class="zcsschlistt dIB textcent"><div class="gstutorimg"><span class="usrimgsts zcssimg mrgLR5">{IMG}</span></div><div class="userdetails"><span id="channelname{ID}" class="dname font13" which="dname">{DNAMEVAL} </span></div></div>',botshtml:'<div class="ellips mrgL15"><div class="ds_in_blk cur" purpose="search" dataval="{MODIFIER}:&nbsp;{NAME}" data-id="{BOTID}" mockid="{MOCKID}"><span class="clr8" uid="{BOTID}">{MODIFIER}:</span> {NAME}</div></div>',departmentshtml:'<div id="depart{ID}" elemtype="department" class="zcuserstatus  withimg dflx" data-key="{ID}" purpose="search" name="{TITLE}">{IMG}<div class="userdetails floatl"><div class="zcunrdlt-txt floatl ellips">{NAME}</div><div class="zcunrdltmsg glbsrctxt">{MEMBERS-COUNT}</div></div></div>',msg_modifier_value_suggestion:'<div class="msgmod ellips"><span>{MSGMODIFIERTEXT}</span>&nbsp;<span uid="{ID}" type="{TYPE}"  msgmodifier="{MSGMODIFIER}">{DATA}</span></div>',message_details:'<div class="zcsscht zcuserstatus clr6 {{CLASS_NAME}}" id="{{CHID}}_{{TIME}}" purpose="search" elemtype="message" data-key="{{CHID}}" chid={{CHID}} ctype={{CTYPE}} time={{TIME}} uid={{UID}}><div id="textnode" class="ovr_hiden"><div class="srch-title clearfix"><div class="ellips floatl ">{{CHAT_TITLE}}</div><div class="floatr ellips ">{{CHAT_TIME}}</div></div><div id=\'msgsender\' uid={{USRID}} class="ellips clr6">{{USER_NAME}}{{MESSAGE}}</div>{{SEARCH_MORE}}</div></div>',message_trancript:'<div class="zsrctranscnt zcmulticht {CLS}" id="{ID}"><div class="profilecon"><div class="profileinfo" id="profileinfo"></div><div class="floatr zcsstrscnt" id="trans_actions"><div id="chatoption"></div><div class="msi-close cur zchsicn" title=\''+Resource.getRealValue("common.to.close")+'\' id="closechat" data-purpose="close"></div></div></div><div id="currenttranscript" class="currchatpanel mrgL20 zch100" purpose="transcriptholder"><div id="addinfo" class="zcsrch-addinfo"><div class="" which="addinfo"></div></div></div></div>',empty:'<div class="emptyresult" id="emptyresult"><div class="zcglrscnt"><div class="zcnorsfd"><img src=\'{{STATICURL}}/gs_emptystate.svg\' /><div>'+Resource.getRealValue("globalsearch.empty")+'</div><div class="srchin">{{SEARCH_INPUT}}</div><div class="gschtbtn" purpose="newsearch">'+Resource.getRealValue("globalsearch.trynew")+"</div></div></div>",loading:'<div id="zc_srch_ldngtxt" class="zc_srch_ldng clr8"><span  id="zc_srch_ldng"></span><div>{{QUOTE}}</div></div>',userprofile:'<div class="zcsrcpdt clr0 font14"><div class="zcbsprfl"><div class="zcsrpsac posrel cur"><img src="{{IMGURL}}" height="50" width="50" imgsrc="{{IMGURL}}" documentclick="viewprofileimage" uid="{{UID}}" class="mrgR18" / ><div id="contactscode{{UID}}" scode ="{{SCODE}}" class="{{STATUSCLASS}}"></div><div id="media{{UID}}"></div></div><div class="bold mrgT20 font16 dname posl">{{DNAMEVAL}}</div><div id="contactmailid{{UID}}" class="font15">{{DEPTINFO}}</div><div id="peopleinfo" class="mrgT25 gsprofopt font14" uid="{{UID}}"><span class="{{CURPAGE}} posl" purpose="profileInfo" which="profrhsheader">{{PROFTEXT}}</span><span class="posl dN" chid="" purpose="conversation" which="profrhsheader">'+Resource.getRealValue("globalsearch.header.conversation")+'</span><span class="{{CHATCLS}}" purpose="chats" which="profrhsheader">'+Resource.getRealValue("common.mutualchats")+"</span></div></div></div>",emptyuserprofile:'<div class="emcht-inftxtmn"><div class="emcht-inftxt">{{TEXT}}</div><div class="gschtbtn dB" uid="{{UID}}" operation="continuechat">'+Resource.getRealValue("globalsearch.startchat")+"</div></div>",loadmore:'<div class="loadmorediv"><div class="cur" module="{{MODULE}}" purpose="loadmore">{{TEXT}}</div></div>'},S=function(){t=null,i=null,a=null,s=null,M(),$zcg._ISONESEARCHENABLED&&WebMessanger.loadZGSHandler()},R=function(){return Template.NewSearchHTML},A=function(){return $zcg._NEWSEARCH&&"true"==$zcg._NEWSEARCH},M=function(){var e=k(),t=H();Gator(e).on("keydown",function(e){Dt(e,$(this))}),Gator(e).on("keyup",function(e){13!==e.which&&Nt(e)}),Gator(e).on("paste",function(e){setTimeout(function(){Nt(e)},100),e.stopImmediatePropagation()}),Gator(x().querySelector("#GSinputcontainer")).on("click",function(e){"GScloseinput"===e.target.getAttribute("id")?ra():(B()||ZCTrack.track("NEW_SEARCH",{TRIGGER:"Mouse"}),Kt(e)),e.stopImmediatePropagation()}),Gator(t).on("click","#trans_actions",function(e){var t=e.target,i=t.getAttribute("data-purpose"),a=t.getAttribute("chid");"continue"===i?W(e,a):"join"===i?(ChannelsUI.trackChannelClick("globalsearch"),Channels.join(a,!0),Y()):"close"===i&&bi(),e.stopImmediatePropagation()}),Gator(t).on("click",'[data-purpose="show_more"]',function(e){$(this).parents("div[purpose]").toggleClass("hidemore"),e.stopPropagation()}),Gator(t).on("click",'[operation="inviteuser"]',function(){$Util.Button.addLoadIcon($(this)),Contacts.add("zoho",this.parentNode.getAttribute("uid"),void 0,void 0,Z)}),Gator(t).on("click",'[operation="continuechat"]',function(){ContactsList.reqForChat(this.getAttribute("uid")),U($(this),"contact"),Y()}),Gator(t).on("click",'[operation="subscribe"]',function(){$Util.Button.addLoadIcon($(this)),Bots.subscribe(this.getAttribute("uid"),"",Z)}),Gator(t).on("click",'[operation="accept"]',function(){Contacts.acceptorreject(this.parentNode.getAttribute("uid"),this.getAttribute("operation")),Y()}),Gator(t).on("click",'[purpose="search"]',function(e){var t=this;if(!e.target.getAttribute("documentclick")){if("true"===t.getAttribute("tutorview")){N(e,$(t),!0);var i=t.getAttribute("target")||t.getAttribute("elemtype");ZCTrack.track("NEW_SEARCH",{TRIGGER:"Single Click",type:i,source:"Tutorview"})}else clearTimeout(this.clicktimer),this.clicktimer=setTimeout(function(){L(e,t),ZCTrack.track("NEW_SEARCH",{TRIGGER:"Single Click"})},400);e.stopPropagation()}}),Gator(t).on("dblclick",'[purpose="search"]',function(e){ZCTrack.track("NEW_SEARCH",{TRIGGER:"Double Click"}),clearTimeout(this.clicktimer),N(e,$(this))}),Gator(t).on("click","[which='profrhsheader']",function(e){w(e)}),Gator(t).on("click","[purpose='newsearch']",function(e){ra(),q(),j(),k().focus(),ZCTrack.track("NEW_SEARCH",{TRIGGER:"Try new button click"}),e.stopPropagation()}),Gator(t).on("mouseover",'[elemtype="contact"]',function(){var e=$(this),t=e.attr("uid"),i=UserInfo.getMediaHtml(t);return e.find("#media")[0]||"true"===e.attr("tutorview")?void 0:void e.append(i)}),Gator(t).on("click","[purpose='clearrecentsearch']",function(){H().querySelector("#recentsearchnodes").innerHTML="",$DB.clear("recentsearch")}),Gator(t).on("click","[purpose='searchacross']",function(e){"undefined"!=typeof zgssearch&&(zgssearch.toggleGlobalsearch(e),Y())})},U=function(e,t){e.attr("elemtype",t),wi(e)},w=function(e){var t=$(e.target),i=t.attr("purpose");$WC.$CUtil.removeClass(t.siblings(".curpage")[0],"curpage");var a=t.parent().attr("uid"),s=$(H()).find("#currenttranscript");s.off(),s.html(et()).removeAttr("isnomrg"),$WC.$CUtil.addClass(t[0],"curpage"),"profileInfo"===i?Vi(a,i):"chats"===i&&($("#chatoption").empty(),O(a,$(s)))},_=function(e,t){t.off().on("scroll",function(){r&&ZCScroll.isScrollNearBottom(this)&&(t.find("#userrecentchatsloadmore")[0]||(t.append('<div id="userrecentchatsloadmore" purpose="chathistoryrow" class="hstrset"><div class="hst-lodngmn"><div class="hst-lodngsb">'+Resource.getRealValue("common.loading")+"</div></div></div>"),O(e,t)))})},O=function(e,t){var i=t.find("[elemtype='chathistory']").last().attr("lmtime"),a={lim:15,recipient:e,totime:i,successcallback:function(i){D(e,i,t)}};ChatHistory.getAll(a,!0)},D=function(e,t,i){var a=$(H());if("chats"===a.find(".curpage").attr("purpose")){i.attr("isnomrg",!0),a.find("#userrecentchatsloadmore").remove(),i.html(Qt(e,t.data.chats,i));var s=i.find('[elemtype="chathistory"]').attr("newtab",!0);"message_transcriptpart"===i.parent().attr("id")&&s.removeAttr("purpose").addClass("curD").removeAttr("newtab").append("<div id='trans_actions' class='gschtbtn' data-purpose='continue' chid='"+chid+"'>"+Resource.getRealValue("common.open")+"</div>"),_(e,i)}},N=function(e,t,i){var a=t.attr("elemtype");"department"===a||"bot"===a&&!Contacts.isExist(t.attr("uid"))||("message"===a?Chat.jumpToConversation(t.attr("chid"),t.attr("time"),t.find("#msgsender").attr("uid")):SearchActions.doAction(e,t,""),i||wi(t),Y(),yi())},L=function(e,t){t.parentNode&&"default"===t.parentNode.getAttribute("target")?vi(t,e):"recentsearch"===t.getAttribute("target")?Li(e,$(t)):t.getAttribute("elemtype")?Hi(t,e):(ei(),Ei(e,$(t))),k().focus(),e?e.stopPropagation():""},W=function(e,t){Chat.isChannelChid(t)&&ChannelsUI.trackChannelClick("globalsearch"),Chat.attachSession(t),U($(e.target),e.target.getAttribute("elemtype")),Y()},x=function(){return null!=t?t:t=document.querySelector("#GSContainer")},k=function(){return null!=i?i:i=document.querySelector("#GS-search-field")},z=function(){return null!=a?a:a=document.querySelector("#GS-mockdiv")},H=function(){return null!=s?s:s=document.querySelector("#GS-results")},P=function(){var e=H().querySelectorAll(".sel");return e[e.length-1]},V=function(e){return 1===e||2===e?"@":3===e||4===e?"#":5===e?"/":void 0},B=function(){return $WC.$CUtil.hasClass(x(),"scale-anim")},F=function(e){B()||(q(),Clickoutside.bind({srcid:"GSinputcontainer",destid:"GS-results",event:e,closeOnClickSrc:!1,customShow:function(){j()},customHide:function(){Y()},doNotClose:function(){return ImgViewer.isVisible()||!!$WC.$Win.current||"block"===$("#hover").css("display")}}))},j=function(){$WC.$CUtil.addClass(x(),"scale-anim"),ei(),oi(),Xt(),Department.ispeopleorg=!0,Zt(),$zcg._ISONESEARCHENABLED&&xt()},G=function(){Clickoutside.clear("GS-results"),Clickoutside.clear("message-transcript"),$WC.$CUtil.removeClass(x(),"scale-anim"),X()},q=function(){for(var e=H(),t=e.querySelectorAll(".zcglrs-node"),i=0;i<t.length;i++){var a=t[i];"default"!==a.getAttribute("target")&&(t[i].innerHTML="")}Clickoutside.clear("message-transcript")},Y=function(){G(),q(),bi()},Z=function(e){var t=H();if(Contacts.isBotId(e))i=$(t).find("[operation='subscribe']"),a=Resource.getRealValue("common.continue");else var i=$(t).find("[operation='inviteuser']"),a=Resource.getRealValue("contact.reinvite");i.removeClass("reqprocess_anim").text(a).attr("operation","continuechat")},K=function(){z().innerHTML=""},X=function(){K(),k().value="",e.currval="",oi(),ei(),J(),Bt()},J=function(){C={},e.ignorelist={},y=[],n=[]},Q=function(){clearTimeout(this.loadingtimer),this.loadingtimer=setTimeout(function(){if(gi()){var e=H(),t=e.querySelector("#emptyresult");t||e.querySelector("[data-module='module'] zc_srch_ldng")||(q(),bi(),ci(e),$WC.$CUtil.hasClass(e,"zsrcleft")&&$WC.$CUtil.removeClass(e,"zsrcleft"),ii(),document.getElementById("groupsnodes").innerHTML=et(),ZCScroll.updateScroll(document.getElementById("srchscroll")))}},300)},et=function(){return $WC.template.replace(T.loading,{QUOTE:o})},tt=function(e){e=e||H().querySelector("[data-module='module']"),$WC.$CUtil.removeElement(H().querySelector("[data-module='module'] #zc_srch_ldngtxt"))},it=function(e,t,i){var a="",s="";e?(a=s=e+":",i&&(a+=t+":"+i)):i&&(a=t+":"+i),a&&(s&&at(s),C.hasOwnProperty(a)||(C[a]=""))},at=function(e){return C.hasOwnProperty(e)?(delete C[e],!0):!1},st=function(e){function t(e,t){if(0===t)return!0;var i=$WC.$CUtil.trim(e.slice(0,t));return i&&":"===i.charAt(i.length-1)&&h[i.replace(":","")]?!0:!1}for(var i=0,a=p.length,s=0,n="";a>i;i++){var r=e.lastIndexOf(p[i]);0===r&&0!==e.indexOf(p[i])&&(r=-1),-1!==r&&r>=s&&t(e,r)&&(s=r,n=p[i])}return e=e.substring(s),e=e.substring(n.length),{modifier:n,val:n?e:""}},nt=function(e){return $WC.$CUtil.trim(Resource.getRealValue("common."+e).toLowerCase())},rt=function(e){var t=e;if(e=e.toLowerCase(),!$WC.$CUtil.isEmpty(e)){var i=[],a=[];for(var s in h){var n=nt(s).toLowerCase();if(!ot(n)){var r=(n+":").lastIndexOf(e);-1===r&&e.lastIndexOf(n+":")>-1&&(r=0),-1!=r&&(0===r?i.push(n):a.push(n))}}if(i.length>0||a.length>0){var o={};o.matches=i.concat(a),o.bestmatch=i.length>0?i[0]:"",o.usertyped=t;var l=e.indexOf(":"),c=l>-1?e.slice(e.indexOf(":")+1):"";return c&&(o.aftercolon=$WC.$CUtil.trim(c)),o}}return null},ot=function(e){if(Rt(e)){var t=z().querySelector(".cmp_search");if(null!==t&&!t.getAttribute("timestamp"))return y.indexOf(e)>-1}return!1},lt=function(e){return h[e]},ct=function(e){for(var t in h)if(nt(t)===e)return t;return!1},dt=function(e){var t=k().value,i=t.substring(0,t.lastIndexOf(e));if(-1!=i.lastIndexOf(":")){i=i.substring(0,i.lastIndexOf(":"));var a=i.lastIndexOf(" ");if(a=-1!=a?a+1:0,i=i.substring(a).toLowerCase(),i=ct(i))return i}return null},ut=function(e,t){var i=t;if(e===l||e===m)i="@"+Users.getName(t,"",100);else if(e===c)i="@"+Groups.getDisplayName(t);else if(e===d){var a=ChatHistoryTitleSearch.getTitle(t)||ChatsList.getTitle(t);i="#"+a}else e===u&&(i=Channels.getDisplayNameForChannel(Channels.getByChid(t)));return i},mt=function(e){var t=$WC.$CUtil.processXSS(Ri().exactvalue),i=[],a=[],s=[];for(var n in C){var r=gt(n);3===r.length?a.push(r):i.push(r)}for(var o=Pt(Ri().before_caret),l=a.length,n=0;l>n;n++){var r=a[n],c=r[0],d=parseInt(r[1]),u=ut(d,r[2]);u=$WC.$CUtil.processXSS(u);var m=new RegExp("("+$WC.Matcher.replace("escaperegexp",nt(c))+":)(\\s"+$WC.Matcher.replace("escaperegexp",u)+")");m.test(t)?xi():s.push(r.join(":")),t=t.replace(m,$WC.template.replace('<span class="cmp_search" {{TIME-ATTR}}><span class="mockval">$1</span><span class="mockdv">$2</span></span>',{"TIME-ATTR":ht(c,r[2])}))}if(e&&!$WC.$CUtil.isEmptyObject(e)){var p=e.msgmodifier||"",h=e.helptip_text,g=e.usertyped,f=e.msgmodifier.substring(0,e.msgmodifier.indexOf(":")+1),v=pt(h,g);if(!v)return;h=g+h.substr(v.end,h.length);var y=$WC.template.replace('<span id="input-autocomplete" modifier="{{MOD-KEY}}" class="clr8 cmp_search"><span class="mockval">{{MOD}}</span><span class="mockdv">{{USERTYPED}}</span></span>',{"MOD-KEY":p,MOD:f,USERTYPED:g.substring(f.length,h.length)}),b=g.indexOf(":")>-1?y:"";if(g){var E=new RegExp($WC.Matcher.replace("escaperegexp",g)+"$","i");t=$.trim(t).replace(E,b)}else t+=b}else if(!l&&t.indexOf(":")>-1&&o){var I=Ii(),b=I+$WC.template.replace('<span  modifier="{{BESTMATCH}}" class="clr8 cmp_search"><span class="mockval">{{BESTMATCH}}:</span><span class="mockdv">{{AFTERCOLON}}</span></span>',{BESTMATCH:o.bestmatch,AFTERCOLON:o.aftercolon});t=o.bestmatch&&o.aftercolon?b:t}return z().innerHTML=t,s.length>0&&s.forEach(function(e){at(e),xi()}),!0},pt=function(e,t,i){var a=0,s=-1,n=t.slice(0).split(" ").join("");i||(i=0);for(var r=i;r<e.length;r++)if(" "!==e[r]){var o=0;a=r;for(var l=r;l<e.length;l++)if(" "!==e[l]){if(e[l]!==n[o])break;if(o++,o===n.length){s=l+1;break}}if(-1!==s)return{begin:a,end:s}}return null},ht=function(e,t){return Rt(e)&&b.test(t)?"timestamp="+new Date(t).getTime():""},gt=function(e){var t=e.split(":");if(t.length>3){var i=t.slice(3).join(":");t[2]+=":"+i,t.splice(3)}return t},ft=function(e){var t=k(),i=Ri(),a=(t.selectionEnd,$WC.$CUtil.trim($WC.$CUtil.decodeHTMLEntities(i.exactvalue))),s=i.after_caret,n=a.lastIndexOf(" "),r=":"===a.charAt(n-1),o=r?"":a.substring(0,n),l=e.getAttribute("dataval")||x().querySelector("#input-autocomplete").innerHTML;t.value=(o+" "+l+s).replace(/^\s+/g,""),K(),mt(),Ci()},vt=function(t){var i=t.bestmatch,a="";i===nt("from")||i===nt("to")?a=bt(i,t.inputval):i===nt("in")?a=It(i,t.inputval):i===nt("hasfile")||i===nt("haslink")?a=$t(t):(i===nt("after")||i===nt("before")||i===nt("on"))&&(a=St(t),a=a||ia());var s=H(),n=s.querySelector("#resultsnodes");n.innerHTML=a,ta(),e.setSearchValue(""),ii({ismodifiersearch:!0})},Ct=function(e,t){var i=$(H().querySelector("#pickadatenodes"));i.attr("module","calendar");var a=$Util.getDateWithoutTime(),s=new Date;t?b.test(t)&&yt(i,t,e):i.DatePicker({flat:!0,format:"m/d/Y",date:a,current:a,starts:0,onChange:function(t,a){a.valueOf()<=s.valueOf()&&(K(),yt(i,t,e))},onRender:function(e){return{disabled:e.valueOf()>s.valueOf()}}})},yt=function(e,t,i){e.attr({"data-id":t,mockid:9,dataval:i+": "+t}),Ei(null,e)},bt=function(e,t){for(var i=Contacts.sortByUsage(Contacts.getAll()),a="from"===e?Et():"",s=0,n=i.length,r=0;n>r&&5!==s;r++){var o=i[r][1],c=Contacts.getDisplayName(o),d=e+":"+l+":"+o;Mt(d)||t&&-1===c.indexOf(t)||Contacts.isBot(o)||(a+=T.msg_modifier_suggestion.replace(/{MODIFIER}/g,e).replace(/ID/g,o).replace(/{DNAME}/g,"@"+c),s++)}return a},Et=function(t){if(t&&-1==="me".indexOf(t.toLowerCase()))return"";var i=e.ignorelist.from||[],a="";return-1===i.indexOf(WmsImpl.getZuid())&&(a+=T.msg_modifier_suggestion.replace(/{MODIFIER}/g,"from").replace(/{ID}/g,WmsImpl.getZuid()).replace(/{DNAME}/g,"@Me")),a},It=function(t,i){for(var a=Channels.getJoinedFromLocalStorage(),s="",n=0,r=a.length,o=0;r>o&&5!==n;o++){var l=Channels.getObject(a[o]),c=l.chid,d=Channels.getDisplayNameForChannel(l),m=e.ignorelist[t]||[];-1===m.indexOf(c)&&(s+=T.chats_channelshtml.replace(/{MODIFIER}/g,t).replace(/{CHID}/g,c).replace(/{TITLE}/g,d).replace(/{MOCKID}/g,u),n++)}return 5>n&&(s+=Tt(t,i,5-n)),s},Tt=function(e,t,i){for(var a=ChatsList.getAllSortedChats(),s="",n=0;i>n;n++){if(!a[n])return s;var r=a[n][0],o=ChatsList.getTitle(r);t&&-1===o.indexOf(t)||(s+=T.chats_channelshtml.replace(/{MODIFIER}/g,e).replace(/{CHID}/g,r).replace(/{TITLE}/g,"#"+o).replace(/MOCKID/g,d))}return s},$t=function(e){var t={};t[nt("hasfile")]=v,t[nt("haslink")]=[""];for(var i=e.bestmatch,a=t[i],s="",n=e.aftercolon||"",r=0;r<a.length;r++){var o=a[r];if(n&&-1===o.indexOf(n)){if(""!==s||r+1!==a.length)continue;o=n}var l=i+": "+o;s+=$WC.template.replace('<div class="ellips mrgL15"><div class="ds_in_blk cur" purpose="search" dataval="{{suggtdata}}" data-id="{{file}}" mockid="9">{{suggtdata}}</div></div>',{suggtdata:l,file:o})}return s},St=function(e){function t(e){var t=3,i=(new Date).getMonth();return i>=t?e.slice(i-t,i):e.slice(e.length-(t-i),e.length).concat(e.slice(0,i))}var i=e.aftercolon,a=["today","yesterday","this week","this month","this year"];i||a.splice(3,2),a="after"===e.bestmatch?t(I):a;var s="",n=i?a.concat(I):a;n=$Util.removeDuplicateEntries(n);for(var r=n.length,o=0;r>o;o++){var l=n[o].toLowerCase();if(!i||0==l.indexOf(i.toLowerCase())){var c=e.bestmatch+": "+l;s+='<div class="ellips mrgL15"><div class="ds_in_blk cur" purpose="search" dataval="'+c+'" data-id="'+l+'" mockid="9"><span class="clr8">'+e.bestmatch+": </span>"+l+"</div></div>"}}return s},Rt=function(e){return["on","before","after"].indexOf(e)>-1||[Resource.getRealValue("common.on").toLowerCase(),Resource.getRealValue("common.before").toLowerCase(),Resource.getRealValue("common.after").toLowerCase()].indexOf(e)>-1},At=function(e){return["from","to","in"].indexOf(e)>-1||[Resource.getRealValue("common.from").toLowerCase(),Resource.getRealValue("common.to").toLowerCase(),Resource.getRealValue("common.in").toLowerCase()].indexOf(e)>-1},Mt=function(t){if(C[t])return!0;var i=t.split(":"),a=$WC.$CUtil.extend(!0,{},e.ignorelist);return a&&a[i[0]]?-1!==a[i[0]].indexOf(i[2]):void 0},Ut=function(e,t){for(var i={},a=0;a<e.length;a++){var s=(new Date).getTime();"fromtime"===e[a]?s=wt({bestmatch:"on",aftercolon:t.aftercolon}):"totime"===e[a]&&(s=wt({bestmatch:"after",aftercolon:t.aftercolon})),i[e[a]]=s}return i},wt=function(e){function t(e,t){var i={after:function(){return t.setHours(23,59,59,999)},before:function(){var e=new Date(t.setDate(t.getDate()-1));return e.setHours(23,59,59,999)},on:function(){return t.setHours(0,0,0,0)}};return"function"==typeof i[e]?i[e]():void 0}var i=e.bestmatch,a=e.aftercolon;return t(i,_t(a,i))},_t=function(e,t){var i=new Date,a=i.getFullYear(),s=i.getMonth(),n={today:function(){return i},yesterday:function(){return new Date(i.setDate(i.getDate()-1))},"this week":function(){var e=i.getDate()-i.getDay();return new Date("after"===t?i.setDate(e+6):i.setDate(e))},"this month":function(){return"after"===t?new Date(a,s+1,0):new Date(a,s,1)},"this year":function(){return"after"===t?new Date(a+1,0,0):new Date(a,0,1)}};if(I.indexOf(e.toLowerCase())>-1){var r=Ot(e);return"after"===t&&(r=new Date(r.getFullYear(),r.getMonth()+1,0)),r}return b.test(e)?new Date(e):"function"==typeof n[e]?n[e]():void 0},Ot=function(e,t){var t=I.indexOf(e.toLowerCase()),i=new Date;return i.getMonth()<t?new Date(i.getFullYear()-1,t,1):new Date(i.getFullYear(),t,1)},Dt=function(t){var i=t.which;if(i==$zcg.BACKSPACE_KEYCODE&&(t.ctrlKey||t.metaKey))return void K();if(i===$zcg.UP_KEYCODE||i===$zcg.DOWN_KEYCODE||i===$zcg.TAB_KEYCODE)return void t.preventDefault();if(i===$zcg.ENTER_KEYCODE){var a=H().querySelectorAll(".sel");if(a.length>0)return ZCTrack.track("NEW_SEARCH",{TRIGGER:"Enter"}),na(a[0])?(N(t,$(a)),void document.activeElement.blur()):(L(t,a[0]),!1)}return i===$zcg.BACKSPACE_KEYCODE?(mt(),e.ignorelist={},void(1===$WC.$CUtil.trim(Ri().exactvalue)&&(e.ignorelist={},ra()))):void Nt(t)},Nt=function(t,i){{var a=t.which,s=Ri();$(H())}if(a===$zcg.UP_KEYCODE||a===$zcg.DOWN_KEYCODE)return void sa(t);var n=$WC.$CUtil.trim(s.exactvalue);if(a!==$zcg.ESCAPE_KEYCODE){if(!i&&(a===$zcg.ENTER_KEYCODE||$WC.$CUtil.trim(e.currval)===n))return void mt();var r=zt(s);if(ei(),0===n.length)clearTimeout(this.timer),q(),oi(),Xt(),F(t),X();else{var o=r.val_before_caret;E={},Ci(),e.setSearchValue(o),Q();var l=!0;jt(n);var c=Mi();if(kt(r)||!o.length&&!c.message)Ai();else{if($WC.$CUtil.removeAllClass(H(),"sel"),Vt(),F(t),Ci(),r.matched_sys_modifier)return void(l=$i(r.matched_sys_modifier));if(r.matched_msg_modifier){var d=r.matched_msg_modifier;l=Si(d),d.usertyped.indexOf(h[d.bestmatch])>-1?"":Ft(Mi())}else Ci(),q(),Ft(Mi())}}$zcg._ISONESEARCHENABLED&&Lt()}else if(n.length>0&&!$WC.$CUtil.hasClass(H(),"zsrcleft"))return ra(),void t.stopPropagation()},Lt=function(){var e=H();gi()||$WC.$CUtil.hasClass(e,"zsrcleft")?Wt():xt()},Wt=function(){document.getElementById("zcsearchacross").style.display="none"},xt=function(){document.getElementById("zcsearchacross").style.display="block"},kt=function(t){if(e.isMsgSrchEnabled){var i=t.matched_msg_modifier,a=t.matched_sys_modifier;return i&&!$WC.$CUtil.isEmptyObject(i)||a&&!$WC.$CUtil.isEmptyObject(a)?!1:!0}return!1},zt=function(t){var t=t||Ri(),i=Pt(Yt()),a=st(Yt()),s={val_before_caret:$WC.$CUtil.trim(t.before_caret),val_after_caret:$WC.$CUtil.trim(t.after_caret),exactvalue:$WC.$CUtil.trim(t.exactvalue),matched_msg_modifier:i&&i.bestmatch?i:void 0,matched_sys_modifier:a&&a.modifier?a:void 0};return e.currval=t.exactvalue,s},Ht=function(){return!(Gt()||$WC.$CUtil.trim(Ri().exactvalue).length<3)},Pt=function(e,t){var i=rt(e);if(!i&&e&&!t){var a=e.split(" "),s=a.length>1?a[a.length-1]:"";s&&(i=rt(s))}return i},Vt=function(){var e=document.getElementById("GScloseinput");e&&!$WC.$CUtil.hasClass(e,"srchclose")&&$WC.$CUtil.addClass(e,"srchclose")},Bt=function(){var e=$WC.$CUtil.trim(Ri().exactvalue),t=document.getElementById("GScloseinput");!e.length&&t&&$WC.$CUtil.hasClass(t,"srchclose")&&$WC.$CUtil.removeClass(t,"srchclose")},Ft=function(t,i){var a,s=t.msg_modifier,n=t.modifier,r=t.val;if(n)if(oi(),s)if("from"!==s&&"to"!==s||"@"!==n){if("in"===s&&"#"===n){if($WC.$CUtil.isEmpty(r))return void vt({bestmatch:s});Q();var o=$WC.$CUtil.extend(!0,{},e.ignorelist),a=e.CHANNELS+e.CHATS;respMapping=[1,1,1,0,0,1],e.doSearch(r,{modifier:s,chathtml:T.chats_channelshtml.replace(/{MODIFIER}/g,s),ignorelist:o[s],limit:t.limit,searchin:a,ismodifiersearch:!0})}}else{Q();var o=$WC.$CUtil.extend(!0,{},e.ignorelist),l=H().querySelector("#resultsnodes");l.innerHTML="from"===s?Et(r):"",a=r?e.CONTACTS+e.USERS+e.BOTS:e.CONTACTS+e.BOTS,e.doSearch(r,{modifier:s,contactshtml:T.msg_modifier_suggestion.replace(/{MODIFIER}/g,s).replace(/{DNAME}/g,"@{DNAME}"),bothtml:T.botshtml.replace(/{MODIFIER}/g,s),emptycallback:hi,ignorelist:o[s],issubscribedonly:!0,limit:e.limit,searchin:a,ismodifiersearch:!0})}else{var a=0,c=Ri().exactvalue,d={emptycallback:hi};Gt()&&("@"===n?(a=e.CONTACTS+e.USERS+e.BOTS,c.length>1?(a+=e.CHANNELS,respMapping=[0,0,0,0,1,1],d={searchprefix:"@",ignorespecialchar:!0}):respMapping=[0,0,0,1,1,1],H().querySelector("#resultsnodes").innerHTML=""):"#"===n&&(a=e.CHANNELS+e.CHATS,respMapping=[1,1,1,0,0,1])),q(),d.searchin=a,e.doSearch(r,d)}else if(r=r||Yt(),$Util.getObjectKeysLength(t)<=2){var i=i||{};respMapping=i.respmapping||[0,0,0,0,0,0];var a=i.searchin||e.DEPARTMENTS+e.CONTACTS+e.USERS+e.CHATS+e.CHANNELS+e.BOTS+e.MESSAGES;i.ignorelimit=!0,i.searchin=a,i.messagecriteria=t,e.doSearch($WC.$CUtil.trim(r),i)}else Ai()},jt=function(e){var t=C;for(var i in t)-1===$WC.$CUtil.decodeHTMLEntities(e).indexOf($.trim(C[i]))&&at(i)},Gt=function(){var e=Ri().exactvalue;return 0===e.indexOf("@")||0===e.indexOf("#")},qt=function(e,t){return'<div id="'+t.id+'" class="zcglrscnt" data-module="module"><div id="'+t.id+'nodes" data-node="result" mockid="'+t.mockid+'" class="clearfix zcglrs-node"></div>'+e+"</div>"},Yt=function(){var e=Ri();return e.before_caret+e.after_caret},Zt=function(){o=$Util.getRandomQuotes()},Kt=function(e){if(!$WC.$Win.isExist("spotlight")){var t=H();if(""!==t.innerHTML)return Bt(),k().focus(),void F(e);for(var i=[{id:"results",mockid:"results",heading:Resource.getRealValue("globalsearch.header.users")},{id:"pickadate",mockid:"date",heading:Resource.getRealValue("globalsearch.calendar.header")},{id:"recentsearch",mockid:"recentsearch",heading:Resource.getRealValue("globalsearch.recent")},{id:"groups",mockid:"groups",heading:"Recent chats"}],a=T.tutor,s=0;s<i.length;s++){var n=i[s];a+=qt($WC.template.replace(T.heading,{TEXT:n.heading}),n)}var r=T.message_trancript.replace(/{ID}/g,"message-transcript").replace(/{CLS}/g,"");H().innerHTML='<div id="srchscroll" class="width100"><div id="srchlhsrslt" class="srchresultbox paddB20"><div class="msgsrchhint cur"  id="msgsrchhint" purpose="msgsearch"></div>'+a+"</div></div>"+r,$zcg._ISONESEARCHENABLED&&(H().innerHTML='<div id="srchscroll" class="width100"><div id="srchlhsrslt" class="srchresultbox paddB20 posl"><div class="msgsrchhint cur" id="msgsrchhint" purpose="msgsearch"></div><div id="zcsearchacross" class="zc-saz" purpose="searchacross">'+Resource.getRealValue("onesearch.header")+'<span class="msi-searchacross font12 mrgL10"></span></div>'+a+"</div></div>"+r),F(e),k().focus(),ZCScroll.resetScroll(document.getElementById("srchscroll"))}},Xt=function(t){yi();var i=H();$WC.$CUtil.removeClass(i,"zsrcleft");var a=[[nt("from")+": @"+Resource.getRealValue("globalsearch.usermodifier.tip"),nt("to")+": @"+Resource.getRealValue("globalsearch.usermodifier.tip"),nt("in")+": #"+Resource.getRealValue("globalsearch.inmodifier.tip")],[nt("after")+": "+Resource.getRealValue("globalsearch.datemodifier.tip"),nt("before")+": "+Resource.getRealValue("globalsearch.datemodifier.tip"),nt("on")+": "+Resource.getRealValue("globalsearch.datemodifier.tip")],[nt("hasfile")+": "+Resource.getRealValue("globalsearch.filemodifier.tip"),nt("haslink")+": "+Resource.getRealValue("globalsearch.linkmodifier.tip")]];t=t||$WC.$CUtil.trim(Ri().before_caret).toLowerCase(),$("#tutor > div").not('[data-purpose="header bold"]').remove();for(var s=0;s<a.length;s++){for(var n=a[s],r="",o=0;o<n.length;o++)if(""===t||0===n[o].indexOf(t)){var l=n[o].split(": ");l.length&&l[1]&&(l[1]=n[o].replace(l[1],'<span class="clr8">$&</span>'));var c=lt(l[0])||l[0]+" ";r+='<div class="tutorsug"  target="default"><div class="ds_in_blk cur" purpose="search" dataval="'+c+'">'+l[1]+"</div></div>"}r&&$("#tutor").append(r).show().parent()}t||(respMapping=[0,-1,-1,-1,-1,-1],e.doSearch(t,{contactshtml:T.tutorcontactshtml,chathtml:T.tutorchanhtml,limit:Jt(i,85),breakword:!0,ignorepeopledata:!0,searchin:e.CONTACTS}),di()),ta(),si(),ZCScroll.updateScroll(document.getElementById("srchscroll"))},Jt=function(e,t){var i=e.offsetWidth;return Math.round(i/t)},Qt=function(e,t,i){var a=t.length,s="";tt();var n=i.find("#gsrecentchtscon");if(n=n.length?n:$("<div class='height100 gsrecentchtscon' id='gsrecentchtscon'></div>"),r=t.length>=UserProfile.recentchatslimit+1,a)for(var o=0;a>o;o++){var l=t[o].chatid||t[o].chid;if(0==n.find("[chid="+l+"]").length){var c=ChatsList.getTitle(l,t[o].title),d=HistoryUI.getRecipantsPhoto($WC.$CUtil.isEmpty(t[o].recipantssummary)?{}:JSON.parse(t[o].recipantssummary),t[o].pcount,Chat.parseAddinfo(t[o].addinfo),c,t[o].chat_type,l,t[o].customgroup),u=ChatsList.getLastMsgHTML(l,ChatsList.parseLastMsgInfo(l,t[o].lastmsginfo),c);s=ChatHistoryTitleSearch.searchhtml.replace(/{CHID}/g,l).replace(/{TITLE}/g,$WC.Matcher.replace("escapeReplacementString",c)).replace(/{TITLENAME}/g,$WC.Matcher.replace("escapeReplacementString",c)).replace(/{NONLASTMSGCLASS}/g,u?"":"zcunrdone").replace(/{LASTMSGHTML}/g,$WC.Matcher.replace("escapeReplacementString",u)).replace(/{DELETEDSTATUS}/g,t[o].deleted).replace(/{CHATIMAGE}/g,$WC.Matcher.replace("escapeReplacementString",d)),n.append($(s).attr({lmtime:t[o].lmtime,isremoved:1===t[o].removed}))}}else if(!n[0].childElementCount){var m=Users.getName(e);n.html($WC.template.replace(T.emptyuserprofile,{UID:e,TEXT:Resource.getRealValue("chat.norecent",[m])},"InSecureHTML"))}return n},ei=function(){moduleobj={contacts:{index:0},users:{index:1},bots:{index:2},channels:{index:3},chats:{index:4},departments:{index:5},messages:{index:6}},respMapping=[]},ti=function(t,i,a,s,n){var r=Ri().exactvalue.toLowerCase();if(n=$.trim(n).toLowerCase(),!(n!==e.searchvalue&&n!==r||e.isMsgSrchEnabled&&"messages"!==t)){!a&&respMapping.length&&(respMapping[moduleobj[t].index]=1);var o=H(),l=o.querySelector("#resultsnodes");$.trim(i).length>0&&(tt(),fi(),ci(l),$(l).append(i),"messages"!==t&&ui($(l)),ii(s),ta(),pi(n)),(-1===respMapping.indexOf(0)||e.isMsgSrchEnabled)&&(mi()&&!e.isMsgSrchEnabled?e.checkAndUpdateContainsSearch(n,e.additionalcriteria):(ci(o),"none"===o.querySelector("#tutordiv").style.display&&hi())),ZCScroll.updateScroll(document.getElementById("srchscroll"))}},ii=function(e){e&&e.breakword?ai("<span>"+Resource.getRealValue("globalsearch.header.freqcontacts"))+"</span>":(ai("<span>"+Resource.getRealValue("globalsearch.results")+"</span>"),si(e))},ai=function(e){H().querySelector("#msgsrchhint").innerHTML="";var t=H().querySelector("#results [data-purpose='header']");t.innerHTML=e},si=function(t){if(!Ht()||e.isMsgSrchEnabled||t&&t.ismodifiersearch)li();else{var i='<div class="msgsrch"><span purpose="msgsearch" class="cur msi-srchicon">{{search_title}}</span></div>';i=$WC.template.replace(i,{$search_title:["globalsearch.msgsearchtip",[e.searchvalue]]}),H().querySelector("#msgsrchhint").innerHTML=i,ni()}},ni=function(){var t=H();Gator(t).on("click","[purpose='msgsearch']",function(i){ci(t),ri(),e.checkAndHandleMsgLevelSearch(e.searchvalue,Mi()),ZCTrack.track("NEW_SEARCH",{TRIGGER:"Messagelevel search"}),i.stopPropagation()})},ri=function(){e.isMsgSrchEnabled=!0},oi=function(){e.isMsgSrchEnabled=!1},li=function(){H().querySelector('[purpose="msgsearch"]').innerHTML=""},ci=function(e){var t=e.querySelector("#loadmore");t&&t.remove()},di=function(){var e=H().querySelector("#recentsearch");e.querySelector("[purpose='clearrecentsearch']")||$(e.querySelector("[data-purpose='header']")).append("<span class='posl gsrecntsrchclr zcpredot' purpose='clearrecentsearch'>"+Resource.getRealValue("common.clear")+"</span>"),e.querySelector("[data-node='result']").innerHTML=Di()},ui=function(e){e.append('<div id="loadmore" class="loadmore mrgTB15"><div id="loadingoldmsgs" class="hst-loadngmn"><div class="hst-loadng dB"></div></div></div>')},mi=function(){var t=e.additionalcriteria;return!t.breakword&&!t.containssearch&&!t.ismodifiersearch},pi=function(e){if(e){e=$.trim($WC.Matcher.replace("removespecialchars",e," ")).split(" ").join("|");var t=new RegExp(e,"gi");$("#resultsnodes").find('div[purpose="search"] *').contents().each(function(e,i){var a=$(i).parents()[1];if(3===i.nodeType&&"textnode"===a.id){var s=$WC.$CUtil.processXSS(i.data);if(s=s.replace(t,'<b class="clr0">$&</b>')){var n=$("<span>").html(s);$(i).before(n.contents()).remove()}}})}},hi=function(){if(Ri().exactvalue){tt(),Ci();var t=gi(),i=H();t?($WC.$CUtil.removeClass(i,"zsrcleft"),i.querySelector("#resultsnodes").innerHTML=ia(),e.isMsgSrchEnabled||ii()):(fi(),ZCScroll.updateScroll(document.getElementById("srchscroll")))}},gi=function(){var e=!0,t=$(H());return t.find("div[data-module]").each(function(){var t=$(this).find("[data-node]");!t.find("#emptyresult").length&&t.html().length>0&&(e=!1)}),e=e&&"block"!==t.find("#tutordiv").css("display")},fi=function(){$WC.$CUtil.removeElement(H().querySelector("#emptyresult"))},vi=function(e,t){if(e.getAttribute("purpose","search"))ft(e);else{var i=k(),a=Ri().before_caret,s=i.value;s=s.replace(a,""),s=s?s+" ":"",i.value=s+Ti(e)}Nt(t,!0),Ci(),$WC.$CUtil.removeAllClass(H(),"sel"),ta(!0)},Ci=function(){document.getElementById("tutordiv").style.display="none"},yi=function(){document.getElementById("tutordiv").style.display="block"},bi=function(){var e=H(),t=document.getElementById("message_transcriptpart");if(t){var i=t.querySelector("#currenttranscript");$(i).off("scroll"),i&&(i.innerHTML="",$(t).remove(),$("#message-transcript").removeAttr("issection")),Clickoutside.clear("message_transcriptpart")}else{$WC.$CUtil.removeClass(e,"zsrcleft");var i=e.querySelector("#currenttranscript");$(i).off("scroll"),i&&(e.querySelector("#message-transcript").outerHTML=T.message_trancript.replace(/{ID}/g,"message-transcript")),Clickoutside.clear("message-transcript")}},Ei=function(t,i){var a=k(),s=i.attr("data-id");if(!$WC.$CUtil.isEmpty(s)){var n=Ii();a.value=n?n+" "+Ti(i[0]):Ti(i[0]);var r=Ri();e.currval=$WC.$CUtil.trim(r.exactvalue);var o=Ri().before_caret;if($.trim(o).length){var l=st(o),c="";if(l.modifier?c=dt(l.val):(c=rt(o))&&(c=ct(c.bestmatch)),c&&!$WC.$CUtil.isEmpty(s)){if(b.test(s)){var d=$Util.size(C);for(var u in C)0!==d&&u.split(":")[0]==c&&delete C[u]}it(c,i.attr("mockid"),s),Wi(),mt(),Ci(),e.setSearchValue(Ui()),Ai(),k().focus()}}}},Ii=function(){var e=Ri().before_caret,t=rt(e),i="";if(t){var a=e.indexOf(t.bestmatch);a&&(i=e.slice(0,a))}return i},Ti=function(e){var t=e.getAttribute("dataval");return t&&(t=t.replace(/<[\/]{0,1}(B|b)[^><]*>/g,"").replace(/\u00a0/g," ")),t},$i=function(t){k();t=t||st(Ri().before_caret);var i=dt(t.val);return i&&it(i),Ci(),q(),Ft({modifier:t.modifier,val:t.val,msg_modifier:i,limit:e.limit}),!mt()},Si=function(e){var t=e.bestmatch,i=Ri().after_caret,a=!0,s=e.usertyped;return t&&0===i.length&&(a=!mt({msgmodifier:t,helptip_text:h[t]||t+": ",usertyped:s})),q(),At(t)&&e.aftercolon?(Ft({msg_modifier:t,val:e.aftercolon,modifier:V(g[t])}),K(),Ci()):(Xt(s),s.indexOf(h[t])>-1&&(b.test(e.aftercolon)||vt(e),Rt(t)&&Ct(t,e.aftercolon))),a},Ri=function(){var e=k(),t=e.value,i=e.selectionEnd,a=C,s=t.substring(0,i);for(var n in a){var r=a[n];r&&-1!==s.indexOf(r)&&(s=s.replace(r,""))}return{before_caret:s,after_caret:t.substring(i),exactvalue:$WC.$CUtil.processXSS(t)}},Ai=function(){q(),Q();var t=Mi(),i=t.message||"";e.setSearchValue(i);$(H());ri(),oa(t,null,"messages",function(e,t,i,a,s){ti(i,e,"","",s)},"",i)},Mi=function(){var e=Yt(),t=Ii();t&&(e=t);var i={lim:20},a=zi();if(e=$WC.$CUtil.trim(e),!$WC.$CUtil.isEmpty(e)&&e.length>0)i=$WC.$CUtil.extend({},{message:e},i);else{var t=$WC.$CUtil.trim(Ui());t&&(i=$WC.$CUtil.extend({},{message:t},i))}$WC.$CUtil.isEmptyObject(a)||(i=$WC.$CUtil.extend({},a,i));var s=document.getElementById("messagediv");if(s){var n=s.getAttribute("data-page");n&&(i.pno=parseInt(n)+1)}return i},Ui=function(){var e=$("span.cmp_search:last"),t="";return e.length&&(t=e[0].previousSibling?e[0].previousSibling.nodeValue:""),t},wi=function(t){var i=$DB.get("recentsearch"),a={};$WC.$CUtil.isArray(i)||(i=[]),$WC.$CUtil.isEmptyObject(C)?t?a=Oi(t):$WC.$CUtil.isEmptyObject(C)&&e.searchvalue&&(a={val:e.searchvalue,type:"message"}):a=_i();var s=JSON.stringify(a);-1===i.indexOf(s)&&i.unshift(s),$DB.update("recentsearch",i.slice(0,5))},_i=function(){var e=$WC.$CUtil.isEmptyObject(C)?{}:C,t=[],i={};for(var a in e){delete $DB.get("recentsearch")[a];var s=a.split(":");e[a]&&(i={modifier:s[0],mockid:s[1],chid:s[2],type:"message",val:e[a]},t.push(i))}return t},Oi=function(t){var i={},a=t.attr("elemtype");if("message"===a&&e.searchvalue)i={val:e.searchvalue,type:a};else{var s=t.attr("chid"),n=t.attr("uid");"chathistory"===a&&ChatsList.isOnetoOneChat(s)&&(n=ChatsList.getRecipientDatafor121chat(s).zuid,a="contact",s=""),i={uid:n,chid:s||"",type:a}}return i},Di=function(){var e=$DB.get("recentsearch");if(!$WC.$CUtil.isArray(e)||!e.length)return"";for(var t='<div class="zcsrcrs"><div class="zcsugkeys btlst posl">{{recent_searchhtml}}</div>',i="",a=0;a<e.length;a++){var s=JSON.parse(e[a]);if($.isArray(s)||"message"===s.type)i+=Ni(s);else{var n=s.chid,r=s.type,o=s.uid,l=getChatInfoRecentSearch(o||n,r);i+=l?"<div purpose='search' class='zcuserstatus withimg' tutorview='true' target='recentsearch' elemtype='"+r+"' uid='"+o+"' chid='"+n+'\'><div class="usrimgsts zcssimg">'+l.url+"</div><div class='ellips padlt8'>"+l.name+"</div></div>":""}}return i?$WC.template.replace(t,{recent_searchhtml:i},"InSecureHTML"):""},Ni=function(e){var t="",i="";if($.isArray(e)){for(var a=0;a<e.length;a++){var s=e[a];t+="<div class='srchtxt posl paddR10' dataval='"+$WC.$CUtil.processXSS(s.val)+"' data-id='"+s.chid+"' mockid='"+s.mockid+"'><div class='ellips padlt8'>"+$WC.$CUtil.processXSS(s.val)+"</div></div>"}i+='<div id="recentsrch" purpose="search" target="recentsearch" class="recentsrch zcuserstatus"><div class="usrimgsts floatl"><span class="msi-history"></span></div>'+t+"</div>"}else{var n=e.val,r=e.type;i+="<div purpose='search' class='zcuserstatus withimg' target='recentsearch' dataval='"+r+"'><div class='usrimgsts floatl'><span class='msi-history'></span></div><div class='ellips padlt8'>"+$WC.$CUtil.processXSS(n)+"</div></div>"}return i};getChatInfoRecentSearch=function(e,t){var i="",a="";if("contact"===t)i=Users.getImgUrlById(e),a=Users.getName(e);else if("channel"===t){var s=Channels.getObject(e);s&&!$WC.$CUtil.isEmptyObject(s)&&(i=ChannelsUI.getImage(s.oc_id,s.sc,void 0,!0),a=$WC.$CUtil.processXSS(s.cn))}else if("bot"===t){i=Bots.getImgUrl(e);var n=Bots.getObject(e)||Contacts.get(e);a=n.name||n.dname}i="channel"!==t&&i?'<img src="'+i+'">':i;var r=ChatsList.get(e);return"chathistory"===t&&r&&(a=r.title,i=HistoryUI.getRecipantsPhoto(r.recipants,r.pcount,"",a,r.ctype,e,r.customgroup)),a&&i?{name:a,url:i}:""};var Li=function(t,i){if(J(),K(),"message"===i.attr("dataval")){var a=k();a.value=i.text(),e.isMsgSrchEnabled=!0,Nt(t)}else if(i.attr("elemtype"))N(t,i);else for(var a=i.children(),s=0;s<a.length;s++)Ei(t,$(a[s]))},Wi=function(){var e=C,t="";for(var i in e)""===e[i]&&(C[i]=Ri().before_caret),t+=" "+e[i];k().value=$WC.$CUtil.trim(t)+" "},xi=function(){y=[],e.ignorelist={};for(var t in C){var i=t.split(":"),a=i[0],s=i[2];Rt(a)&&("on"===a?y.push("after","before"):y.push(a)),At(a)&&!$WC.$CUtil.isEmpty(s)&&ki(a,s)}return y},ki=function(t,i,a){e.ignorelist[t]||(e.ignorelist[t]=[]),e.ignorelist[t].push(i),a||("from"===t&&ki("to",i,!0),"to"===t&&ki("from",i,!0))},zi=function(){var e=C,t={};for(var i in e){var a=gt(i),s=a[0];if(3===a.length){var n=Rt(s);la(s);var s=f[s]||s,r=a[2];if(At(s)){t[s]=t[s]?t[s].split(","):[],t[s].push(r),t[s]=t[s].join(",");continue}n?$WC.$CUtil.isArray(s)?$WC.$CUtil.extend(t,Ut(s,{bestmatch:a[0],aftercolon:r})):t[s]=wt({bestmatch:a[0],aftercolon:r}):t[s]=r}}return t},Hi=function(e,t,i){e=$(e);var a=e.attr("elemtype");clearTimeout(this.keytimer);var s=$(H());if(s.find(e).length){if("result"===e.parent().attr("data-node")||"department"!==a){var n=e.parent();n="result"===n.attr("data-node")?s:n;{n.find(".sel")}$WC.$CUtil.removeAllClass(n[0],"sel"),$WC.$CUtil.addClass(e[0],"sel")}Xi(e,t);var r=s.find("#message_transcriptpart");s=r[0]?r:s;var o=e.attr("uid");return s.find('[data-purpose="srch-chnl-info"]').remove(),s.find("#chatoption").empty(),s.find("#profileinfo").html(""),s.find("#currenttranscript").html(et()).removeAttr("isnomrg"),"contact"===a||"bot"===a?void Vi(o):"department"===a?void Pi(e,s):o&&!Channels.isJoined(o)?void qi(o,e.attr("chid"),t):void(i?this.keytimer=setTimeout(function(){Yi(e,t)},300):(Yi(e,t),"message"===e.attr("elemtype")&&wi()))}},Pi=function(e,t){var i=t.find("#currenttranscript"),a=e.attr("data-key");UserInfo.getDepartmentMembersHTML(a,e.attr("name")||e.text(),function(t){var s=P();if("department"===s.getAttribute("elemtype")&&"profview"===e.attr("data-purpose"))var n=e.attr("data-key");else{var n=s.getAttribute("data-key");Users.isExist(n)&&(n=Users.getInfo(n).department_id)}s&&n==a&&(i.html(t),UserInfo.updateLeadInfo(i,a),i.find('[purpose="search"]').attr("newtab","true"),i.attr("isnomrg","true"))})},Vi=function(e,t){var i=H(),a=i.querySelector("#message_transcriptpart")||i.querySelector("#message-transcript"),s=$(a).find("#currenttranscript").off("scroll"),n=$(a).find("#profileinfo"),r=Contacts.isBotId(e);if(s.length){if(!t){var o="",l="";r?(o=Resource.getRealValue("globalsearch.header.bot"),l="dN"):o=Resource.getRealValue("common.profile");var c=$WC.template.replace(T.userprofile,{UID:e,PROFTEXT:o,CURPAGE:"curpage",CHATCLS:l},"InSecureHTML");n.html(UserInfo.getUserHeaderHTML(e,c))}Bi(e,$(a)),ZCScroll.resetScroll(s),Qi()}},Bi=function(e,t){UserInfo.updateUserDetails({uid:e,container:t,reportingtohover:!0,callback:function(e,i){var a=P();a&&e==a.getAttribute("data-key")&&"profileInfo"===t.find(".curpage").attr("purpose")&&(Fi(e,i,t),UserInfo.checkAndRemoveEmptyHeader(t))}})},Fi=function(e,t,i){var a=i.find("#currenttranscript");a.html(t);var s=a.find('[data-purpose="inviteuser"]'),n="",r="";if(Contacts.isBotId(e)){r=Contacts.getBotStatusMsg(e);var o=Contacts.isExist(e),l=o?"continuechat":"subscribe",c=o?"common.continue":"bots.subscribe";n='<div operation="'+l+'" class="zchovrcht" uid="'+e+'">'+Resource.getRealValue(c)+"</div>"}else r=getDepartmentInfo(e),ji([e]);var d=!n&&""===s.html();!WmsImpl.isLocalUser(e)&&(Users.isSameOrg(e)||d)&&SecurityManager.hasPermission(Modules.DirectMessage)&&(n='<div operation="continuechat" class="zchovrcht" uid="'+e+'">'+Resource.getRealValue("globalsearch.chat.user")+"</div>"),i.find("[which='desig']").html(r),a.append('<div class="zcflt_btn" uid="'+e+'" operation="button" data-purpose="inviteuser">'+n+"</div>")};getDepartmentInfo=function(e){var t=Users.getInfo(e)||{},i=$WC.$CUtil.processXSS(t.designation),a=$WC.$CUtil.processXSS(t.departmentname),a=a?'<span class="clickable" elemtype="department" data-key="'+t.department_id+'" purpose="search" name="'+a+'" data-purpose="profview">'+a+"</span>":"";return Users.getDepartmentInfo(a,i)||Users.getEmailId(e)};var ji=function(t){for(var i=t.length,a=H(),s=0;i>s;s++){var n=t[s];if(Users.isAdditionalInfoExist(n)){var r=Users.getUserDetailsForHtml({contact:Users.getInfo(n),val:e.searchvalue,highlight:!0,ispeopledata:!0}),o=a.querySelector("#contactdname"+n),l=a.querySelector("#contactmailid"+n);o&&l&&(o.innerHTML=r.dname,l.innerHTML=r.departmentinfo||r.emailid)}}},Gi=function(e){var t=e.attr("action");"startchat"===t&&U(e,"contact");var i=t+"/"+e.attr("uid");$WC.ButtonActionsImpl.handle(i),UserInfo.destroyView(),GSUI.clearAndHideResults()},qi=function(e,t){var i=Channels.getObject(e),a=ChannelsUI.Preview.getPreviewHtml(i,!1),s=ChannelsUI.Preview.getPreviewHeaderHtml(i),n=$('<div class="srch-chnl-preview" data-purpose="srch-chnl-info"><div class="header bold">'+s+"</div>"+a+"</div>"),r=H(),o=$(r).find("#currenttranscript").off("scroll");$(r).find("#profileinfo").append(n),n.find("#viewoption").hide();var l=n.find("#recentconversation"),c=Resource.getRealValue(i.pc>1?"common.participants":"common.participant");c='<div class="clr8 font12 mrgT5 floatl">'+i.pc+" "+c+"</div>",n.find("#channelsdesc").parent().append(c),l.html(Resource.getRealValue("common.recentconv")).addClass("header bold curpage"),Channels.preview(e,"",function(a){e==e&&(o.find("#zc_srch_ldngtxt").remove(),ChannelsUI.Preview.updatePreviewTranscript(i,a,o,o),Ki(e,t),ZCScroll.resetScroll(o),Qi())})},Yi=function(e){var t=e.attr("chid");if(!t)return void Zi(e);var i=e.attr("uid");i=i||"";var a=e.attr("time"),n={chid:t,time:a,totime:$Util.getSyncedCurrentTime(),callback:function(t,i,n,r,o){var l,c=$(P());"currenttranscript"===$("#gsrecentchtscon").parent().attr("id")&&(l=$(s).find("#message_transcriptpart")),(c.attr("data-key")===e.attr("data-key")&&"conversation"!==c.attr("purpose")||$WC.$CUtil.hasClass(e[0],"curpage")||"gsrecentchtscon"===e.parent().attr("id"))&&Ji(t,i,n,r,o,n+"|"+e.find("#msgsender").attr("uid")+"|"+a,l)},lineslimit:30},r=$(s).find("#message_transcriptpart");cntainer=r[0]?r:$(s).find("#message-transcript");var o=cntainer.find("#currenttranscript")[0];if(o){o.innerHTML=et();var l=$(o).find("[msgtime='"+a+"'].msgtxt");if(o.getAttribute("chid")===t&&l.length)return void MentionsUI.handleMsgScroll(l,$(o));o.setAttribute("chid",t),o.setAttribute("uid",i),o.removeAttribute("hastopmore"),o.removeAttribute("hasbottommore")}clearTimeout(this.transcripttimer),this.transcripttimer=setTimeout(function(){ChatHistory.getTranscript(n)},500)},Zi=function(e){var t="",i=e.parent().attr("uid");"conversation"===e.attr("purpose")&&(t+='<div class="part_img mrgB15"><img title="'+Users.getName($zcg._ZUID)+'"src="'+Users.getImgUrlById($zcg._ZUID)+'"/><img title="'+Users.getName(i)+'"src="'+Users.getImgUrlById(i)+'"/></div>');var a=H().querySelector("#currenttranscript");a.setAttribute("isnomrg",!0),a.innerHTML=$WC.template.replace(T.emptyuserprofile,{UID:i,TEXT:t+Resource.getRealValue("globalsearch.emptyconv.info",[Users.getName(i)])},"InSecureHTML")},Ki=function(e,t){var i=document.getElementById("chatoption");if(i){var a=$(P()),s="true"===a.attr("isremoved")?'<div class="remchat">'+Resource.getRealValue("globalsearch.remchat.info")+"</div>":'<div class="zcflt_btn" data-purpose="hide-on-scroll"><div class="zchovrcht" id="continuechat" chid="{{CHID}}" uid="{{UID}}" data-purpose="{{PURPOSE}}" elemtype="'+a.attr("elemtype")+'">{{VALUE}}</div></div>',n="msi-chatico cur zchsicn",r="common.continue",o="continue";Channels.isArchived(new $CliqChatId(t))?n="dsp_none":$WC.$CUtil.removeClass(i,"dsp_none"),!e||Channels.isJoined(e)||Contacts.isBot(e)||(o="join",r="common.join"),e&&Contacts.isBotId(e)&&Contacts.isBot(e)&&(o="subscribe",r="bots.subscribe"),i.innerHTML=$WC.template.replace(s,{CHID:t,UID:e,VALUE:Resource.getRealValue(r),PURPOSE:o})}},Xi=function(e){var t=H(),i=t.querySelector("#message-transcript"),a=t.querySelector("#message_transcriptpart");if(e.attr("newtab")){a||(i.setAttribute("issection","true"),i.insertAdjacentHTML("afterbegin",T.message_trancript.replace(/{CLS}/g,"section2").replace(/{ID}/g,"message_transcriptpart")));var s="message-transcript",n="message_transcriptpart",r=function(){i.removeAttribute("issection"),$("#message_transcriptpart").remove(),k().focus()}}else i.removeAttribute("issection"),$(a).remove();if($WC.$CUtil.hasClass(t,"zsrcleft")||$WC.$CUtil.addClass(t,"zsrcleft"),!s&&!n){s="messagediv",n="message-transcript";var r=function(){$WC.$CUtil.removeClass(t,"zsrcleft"),k().focus()}}Clickoutside.bind({srcid:s,destid:n,closeOnClickSrc:!1,customShow:function(){$WC.$CUtil.addClass(t,"zsrcleft"),$(n).find("#currenttranscript").html(et())},doNotClose:function(){var e=H(),t=e.querySelector(".sel");return t&&"profview"===t.getAttribute("data-purpose")?(t.removeAttribute("data-purpose"),Hi(t),!0):ImgViewer.isVisible()||!!$WC.$Win.current||"block"===$("#hover").css("display")},customHide:function(){r()}})},Ji=function(e,t,i,a,n,r,o){if(e){var l=t.length,c=o?o.find("#currenttranscript"):$(s).find("#currenttranscript");if(c.length){c.find("#zc_srch_ldngtxt").remove(),c.find("#loadingoldmsgs").remove();var d=c.attr("uid");if(0===l)return tt(),c.html('<div class="emcht-inftxtmn"><div class="emcht-inftxt" ><span>'+Resource.getRealValue("channel.conv.none")+"</span>"+Resource.getRealValue("channel.conv.none.chat")+'<em code=":smile:" title=":smile:" class="zcslymsg-smile"></em></div></div>'),Ki(d,i),"";c.find("#zc_srch_ldngtxt").remove(),$Util.handleTranscript(e,t,i,a,n,r,c,"globalSearch"),clearTimeout(onscroll),Qi(),Ki(d,i),ea(c)}}},Qi=function(){var e=$(H()).find("#currenttranscript");e.on("scroll",function(t){e.hasClass("ps-active-y")&&e.find(".ps-scrollbar-y-rail").is(":visible")&&(ea(e),t.stopImmediatePropagation())})},ea=function(e){clearTimeout(onscroll),e.parent().find(".zcflt_btn").addClass("btn-anim"),onscroll=setTimeout(function(){e.parent().find(".zcflt_btn").removeClass("btn-anim")},200)},ta=function(){var e=H(),t=$(e).find('[purpose="search"]:visible:first'),i=$(e).find("#srchlhsrslt");t.hasClass("sel")||i.find(".sel")[0]||($WC.$CUtil.removeAllClass(e,"sel"),t.addClass("sel"),t.length&&!t[0].hasAttribute("dataval")?L("",t[0]):$WC.$CUtil.removeClass(e,"zsrcleft"))},ia=function(){return bi(),e.isMsgSrchEnabled&&!Ht()?'<div class="emptyresult" id="emptyresult">'+Resource.getRealValue("globalsearch.msgsearchhint")+"</div>":$WC.template.replace(T.empty,{SEARCH_INPUT:Ri().exactvalue,STATICURL:$Util.getImgStaticUrl()},"InSecureHTML")},aa=function(e){var t=e.message||"",i="";return"3"===e.messagetype&&(t=e.fname||"",i=$WC.$CUtil.processXSS(e.fcomment)||"",i=Markdown.apply(i)),$WC.$CUtil.isEmpty(i)?t:t+", "+i},sa=function(e){var t=$(H()),i=t.find(".sel"),a=$(i[i.length-1]),s=a.attr("newtab")?"message-transcript":"srchscroll";DropdownUtil.handleListNavigation(e,t.find("#"+s),'[purpose="search"]:visible');var a=$("#"+s).find(".sel");na(a[0])&&"true"!==a.attr("tutorview")?Hi(a[1]?$(a[1]).next()[0]:a[0],e):bi(),ZCScroll.updateScroll(document.getElementById(""+s))},na=function(e){if(!e)return!1;var t=e.getAttribute("elemtype");return["message","chathistory","channel","contact","bot","department"].indexOf(t)>-1},ra=function(){e.setSearchValue(""),X(),q(),Xt()},oa=function(t,i,a,s,n,r){return clearTimeout(this.timer),Ht()?void(this.timer=setTimeout(function(){e.getMessages(t,i,a,s,n,r)},500)):void ti("messages","",!1,"",r)},la=function(e){n||(n=[]),h.hasOwnProperty(e)&&-1===n.indexOf(e)&&(0===n.length&&0===Ri().exactvalue.indexOf(e)&&ZCTrack.track("SEARCH_QUANTIFIER",{TYPE:"First Input As Quantifier"}),n.push(e),ZCTrack.track("SEARCH_QUANTIFIER",{TYPE:e}))},ca=function(){$("#messagediv").attr("data-page")>1||!e.isMsgSrchEnabled||$("#srchscroll").off().on("scroll",function(){var e=Mi(),t=e.message||"";if(Ht()&&ZCScroll.isScrollNearBottom($(this)[0])&&JSON.stringify(E)!==JSON.stringify(e)){var i=$("#messagediv"),a=H(),s=$(a).find("#resultsnodes");e.pno&&!s.find("#loadmore")[0]&&(i.attr("data-page",e.pno),s.append('<div id="loadmore" class="loadmore mrgT20"><div id="loadingoldmsgs" class="hst-loadngmn"><div class="hst-loadng dB"></div></div></div>')),oa(e,null,"messages",function(s,n,r,o,l){return i.length?(ci(a),i.attr("data-page",e.pno).append(s),void pi(t)):void ti(r,s,!1,o,l)},"",t)}})};return{init:S,getTemplate:R,initializeResultsDom:Kt,isNewSearchEnabled:A,clearAndHideResults:Y,isNewSearchUIShown:B,handeUserProfileEvents:Gi,getLoadingHtml:et}}(),WebMessanger=WebMessanger||{},WmsResource=WmsResource||{},WmsUIImpl=WmsUIImpl||{},WMSUI=WMSUI||{},_WMSEMPTYBAR=!1,zgssearch=zgssearch||{};!function(){var e={jsstaticdomain:WmsLite.jsstaticdomain,isChatPaused:function(){return!1},continueChat:function(e){ChatsList.attachContinueActiveChat(e)},chat:function(e){ContactsList.reqForChat(e)},startVideoCall:function(e){MMChat.triggerVideoCall(e,"button_system_api")},startAudioCall:function(e){MMChat.triggerAudioCall(e,"button_system_api")},setZIndex:function(){},getRebrand:function(){return $zcg._BRANDNAME},getZuid:function(){return WmsImpl.getZuid()},renderTranscript:function(e,t){$(e).html('<span class="zcldng"></span>');var i={chid:t,target:e,issearchacross:!0,callback:HistoryUI.updateTranscript,totime:$Util.getSyncedCurrentTime(),lineslimit:Chat.LINESLIMIT};ChatHistory.getTranscript(i)},getZIndex:function(){return 999},isCliqDomain:function(){return!0},closeOpenPopup:function(){HoverDetails.handleEscape(),ImgViewer.Annotator.close(),ImgViewer.close(),$WC.$Win.current&&$WC.$Win.destroy($WC.$Win.current),GSUI.clearAndHideResults()},loadZGSHandler:function(){var e=document.createElement("script");e.type="text/javascript",e.src=$zcg._HTTPS+$zcg._JSSTATICSERVER+"/zohosearch/h1/js/gshandler.js?_T="+(new Date).getTime(),e.onload=function(){zgssearch.initZGSHandler({gsjs:$zcg._JSSTATICSERVER,gscss:$zcg._CSSTATICSERVER,gsrebrand:$zcg._BRANDNAME,gslanguage:$zcg._LANG})},document.getElementsByTagName("head").item(0).appendChild(e)},hideOnesearch:function(){!$WC.$CUtil.isEmptyObject(zgssearch)&&zgssearch.isGSOpened&&zgssearch.toggleGlobalsearch()},disableOneSearchShortcut:function(e){$WC.$CUtil.isEmptyObject(zgssearch)||zossearch.disbaleGSShortCutKey(e)},isMediaCallEnabled:function(e){return"voice"===e?MMChat.isAudioCallEnabled():"video"===e?MMChat.isVideoCallEnabled():"screen"===e?MMChat.isScreenSharingEnabledInAVCall():void 0}};WebMessanger=$.extend({},WebMessanger,e),WmsResource.getRealValue=function(){},WmsUIImpl.UIReady=function(){},WMSUI.handleChatExist=function(e){MainUI.getMefront(e,!0)}}(),function(e){var t=function(t){return t=e.zossearch||{},t.shortCutKey=t.shortCutKey||!1,t.disbaleGSShortCutKey=function(e){t.shortCutKey=e},t.getGSShortCutKey=function(){return t.shortCutKey},t}(t);e.zossearch=t}(window);var MainUI={};MainUI={container:"",current:null,currentchat:null,scrolltimer:"",ontabwindoworder:["home","chats","globalsearch"],paneviewminwidth:330,init:function(){this.container=UI.container.find("#midcontainer"),this.bindEvents(),this.resize(),Settings.updateHandler("cpaneview",function(e){MainUI.switchview(e),e?UI.updateBanner(Resource.getRealValue("setting.broadsheetview.enabled"),2e3,!1):UI.updateBanner(Resource.getRealValue("setting.broadsheetview.disabled"),2e3,!1)})},isExist:function(e){return this.container.find("#"+e).length>0||$ZCVideoBroadcast.isDomExist(e)||Conference.isCurrentChat(e)},isChatPaneView:function(){return 1===parseInt(Settings.getFromObj("cpaneview",!0))},isCurrent:function(e){return this.current===e},isAnyChatsInView:function(){return null!==this.container.find("#chatwindowsviewport")[0].firstChild},isCurrentisChat:function(){return this.current?this.isChatView(this.current):!1},isChatView:function(e){return"chatview"===$("#"+e).attr("purpose")},isChatinViewport:function(e){return this.isChatPaneView()?this.isCurrentisChat()?this.container.find("#chatwindowsviewport").find("#"+e).length>0:void 0:this.current===e},getVisibleChats:function(){var e=[];if(this.isChatPaneView())for(var t=this.container.find("#chatwindowsviewport").children(),i=0,a=t.length;a>i;i++)e.push(t[i].id);else e.push(this.current);return e},getAllOngoingChats:function(){for(var e=[],t=this.container.find("#chatwindowsviewport").children(),i=0,a=t.length;a>i;i++)e.push(t[i].id);for(var s=this.container.find("#chatwindowshideport").children(),i=0,a=s.length;a>i;i++)e.push(s[i].id);return e},getOngoing121ChatwithRecipient:function(e){for(var t,i=this.getAllOngoingChats(),a=0;a<i.length;a++){var s=i[a],n=Participants.get(s);if(2==parseInt(n.pcount)&&n.getRecipientFor121Chat()==e){t=s;break}}return t},setCurrentWinFocus:function(){this.isCurrentisChat()&&$WC.DivEditor.focus("composer"+this.current)},bindEvents:function(){var e=MainUI.container.find("#transcriptview");e.find("#transcriptviewholder").on("click","[purpose='viewreplied']",function(t){"a"===t.target.tagName.toLowerCase()&&t.preventDefault(),t.stopPropagation();var i=$(t.currentTarget),a=i.attr("msgtime"),s=i.parents("[mtype]").attr("chid"),n=i.find('[elemtype="user"]').attr("uid"),r=s+"|"+n+"|"+a,o=e.find("#transcriptviewholder");"undefined"!=typeof a&&$Util.fetchAndScrollToMsg(r,o,function(e,t,i,a,s,n){UserProfile.handleTranscript(e,t,i,a,s,n)})}),e.on("click","[operation]",function(){var e=this.getAttribute("operation");if("transcriptviewclose"===e)MainUI.Transcript.close();else if("continue"===e||"join"===e){var t=this.getAttribute("chid");if(!$WC.$CUtil.isEmpty(t)){var i=this.getAttribute("operationfor");parseInt(i)===$zcg.ORGCHANNEL?ChannelsUI.getChat(t):Chat.attachSession(t)}}})},createProfile:function(e,t,i){var a=this.container.find("#profileview");a.length||(a=this.container.find("#chatsection").append('<div id="profileview" profileid="" profile="" style="display:none"></div>').find("#profileview")),a.html(i).attr("profileid",e).attr("profile",t),this.getMefront("profileview",!0),this.resize()},checkAdaptability:function(){var e=this.container.find("#chatwindowsviewport");return e.width()-e.children().length*this.paneviewminwidth>this.paneviewminwidth},getViewportCapacity:function(){var e=this.container.find("#chatwindowsviewport"),t=Math.floor(e.width()/this.paneviewminwidth);return 0==t?1:t},addChatInView:function(e,t,i){var a=this.container.find("#chatwindowsviewport"),s=this.container.find("#chatwindowshideport"),n=this.isChatPaneView();if(i)if(n){if(!this.checkAdaptability()){var r=a.children().last(),o=r.attr("id");this.handleIframes(o),s.prepend(r)}a.prepend(e),this.normalizeChatWindow(a)}else a.prepend(e),this.handleIframes(this.current);else n?s.prepend(e):a.prepend(e);this.resize(),MMChat.handleUIResize();var l=ChatUI.exist[t];"undefined"!=typeof l&&(l.scrolldown=!0)},normalizeChatWindow:function(e){var t=e.width(),i=e.children(),a=e.children().length,s=this.paneviewminwidth+(t-a*this.paneviewminwidth)/a;a>=0&&i.outerWidth(s);var n=MainUI.container.find("#chatwindows");a>1?n.addClass("zcmulticht"):1==a&&n.removeClass("zcmulticht"),a>=0&&ZCScroll.updateScroll($(i).find("#chatbody")),Tour.positionTourTip(),ChatUI.retainScrollPosition(this.getVisibleChats())},handleIframes:function(e){if(!$WC.$CUtil.isEmpty(e)&&$("#"+e).length>0)for(var t=$("#"+e).find("iframe"),i=0;i<t.length;i++){var a=$(t[i]),s=a.parent(),n='<div class="msi-videoplybtn"></div><img width="100%" height="224px" src="'+s.attr("thumbnailurl")+'"/>';a.replaceWith(n)}},getMefront:function(e,t,i){if(IntegrationsCwin.isCurrent(e)&&IntegrationsCwin.handleShow(e),t){var a=this.container.find("#"+this.current);if(this.current===e)return void(this.isCurrentisChat()&&(ChatUI.flicker(e),ChatUI.exist[e].focus()));if(null!==this.current&&this.isExist(this.current)){{this.isCurrentisChat()}this.isCurrentisChat()?(MainUI.container.find("#chatwindows").hide(),this.isChatPaneView()?a.removeClass("selcht chatanim"):a.hide(),ChatUI.doChangesBeforeHide(this.current)):a.hide(),this.Transcript.close()}LeftPannel.container.find(".chatsel").removeClass("chatsel"),this.current=e;var s=this.container.find("#"+e),n=LeftPannel.container.find("#tab"+e);if(this.isChatView(e)){if(this.container.find("#chatwindows").show(),this.currentchat=e,this.isChatPaneView()){var r=MainUI.container.find("#chatwindowsviewport");if(0===r.find("#"+e).length){var o=r.children().last(),l=o.attr("id"),c=MainUI.container.find("#chatwindowshideport");this.checkAdaptability()||(c.prepend(o),this.handleIframes(l)),r.prepend(c.find("#"+e)),s.show()}var d=i?"selcht chatanim":"selcht";s.addClass(d)}s.show(),n.addClass("chatsel"),MainUI.resize(),ChatUI.doChangesAfterVisible(e)}else"home"===e&&(this.currentchat=null,HomeUI.handleCalendarTimer()),s.show(),n.length&&n.addClass("chatsel");"home"===e&&HomeUI.handleCalendarTimer(),MMChat.handleGetMeFront(),Conference.handleGetMeFront(e)}},removeChatsFromHideport:function(e){var t=$("#chatwindowshideport");if(e){e=e.split(",");for(var i=0;i<e.length;i++)t.find("#"+e[i]).length&&!ChatUI.isOpenedbyMe(e[i])&&MainUI.close(e[i])}else{var a=t.children();if(a.length)for(var i=0;i<a.length;i++){var s=$(a[i]).attr("id");ChatUI.hasUnreadOrUnseenMsgs(s)||ChatUI.isOpenedbyMe(s)||MainUI.close(s)}}},close:function(e){var t=function(e){var t=e.next('[purpose="chatview"]');return 0===t.length&&(t=e.prev('[purpose="chatview"]')),t},i=function(e){for(var t=$("#chatwindowsviewport"),i=t.children('[purpose="chatview"]').first(),a=e.attr("id");0!==i.length;){var s=i.attr("id");if(s!==a&&ChatUI.isOpenedbyMe(s))break;i=i.next('[purpose="chatview"]')}return i};if(this.isExist(e))if("profileview"===e){var a=$("#profileview");"contact"===a.attr("profile")&&UserProfile.handleClose(a.attr("profileid")),this.getMefront(this.currentchat?this.currentchat:"home",!0)}else if("mentions"===e||"starmessages"===e)this.getMefront(this.currentchat?this.currentchat:"home",!0);else if(this.isChatView(e)){var s=this.container.find("#chatwindowsviewport"),n=!1;if(this.isChatPaneView()&&s.find("#"+e).length){for(var r=$(this.container.find("#chatwindowshideport")[0].firstChild),o=r.attr("id");ChatUI.isExist(o);){if(!ChatUI.isMuted(o)&&ChatUI.isOpenedbyMe(o)){{ChatUI.exist[o]}s.append(r),r.show(),ChatUI.doChangesAfterVisible(o);break}r=r.next(),o=r.attr("id")}n=!0}var l=this.current===e,c=this.container.find("#"+e),d=[];l&&(d=this.isChatPaneView()?t(c):i(c)),this.currentchat=this.currentchat===e?null:this.currentchat,ChatUI.doChangesBeforeHide(e),ChatUI.delete(e),LeftPannel.container.find("#tab"+e).removeClass(".chatsel"),c.remove(),n&&this.resize(),l&&(d.length?this.getMefront(d.attr("id"),!0):(this.container.find("#chatwindows").hide(),this.getMefront("home",!0)))}"undefined"!=typeof DesktopApp&&null==MainUI.currentchat&&DesktopApp.disableMenu(["close-chat"])},toggleChatView:function(){var e=this.isChatPaneView()?0:1;PersonalizeUI.updatePaneView(e)},switchview:function(e){if(0===e){for(var t=this.container.find("#chatwindowsviewport"),i=t.children(),a=0,s=i.length;s>a;a++){var n=$(i[a]);n.attr("id")!==this.current&&($(n).hide(),this.handleIframes(n.attr("id")))}var r=this.container.find("#chatwindowshideport").children();$(r).hide(),t.append(r);var o=$("#chatwindows");o.removeClass("zcmulticht zcbroadsheet"),t.find(".selcht").removeClass("selcht chatanim"),this.isCurrentisChat()&&(ChatUI.focus(this.current),this.resize(),ChatUI.retainScrollPosition([this.current]));var l=t.children();$(l).css("width","inherit");for(var a=0;a<l.length;a++)ZCScroll.updateScroll($(l).find("#chatbody")),ZCScroll.updateScroll($(l).find("#participantsui"))}else if(1===e){$("#chatwindows").addClass("zcbroadsheet").append("<div id='tempwindows' style='display:block'></div>");var c=this.container.find("#tempwindows"),t=this.container.find("#chatwindowsviewport"),d=this.container.find("#chatwindowshideport"),u=parseInt($("#chatsection").width()/this.paneviewminwidth)-1;this.isCurrentisChat()&&t.find("#"+this.current).addClass("selcht");var m=t.children(),p=m.length;u=p>u?u:p;for(var a=0;a<m.length;a++){var n=$(m[a]),h=n.attr("id");h!=this.current&&(u>0&&!ChatUI.isMuted(h)&&ChatUI.isOpenedbyMe(h)?(c.append(n),u--):d.append(n))}var g=c.children();t.append(g),$(g).show(),c.remove(),this.resize(),$("#chatwindowsviewport > div ").each(function(){this.current&&this.current!=this.id&&ChatUI.exist[this.id].getScrollDown()}),this.isCurrentisChat()&&ChatUI.focus(this.current)}MMChat.handleGetMeFront()},handleEscape:function(){if(this.isCurrentisChat()){var e=this.current,t=ChatUI.exist[e],i=t.win().find("#urlinfopreview"+e);if("block"===i.css("display")){var a=i.attr("currentlink");return void t.closePreviewUI(a)}Chat.quit(e,void 0,void 0,$zcg._ESCEVENT)}else MainUI.close(this.current)},onTabChange:function(e,t){var i=t?"globalsearch":this.current,a=this.next(i,e);"globalsearch"===a?$("#ztb-search-field").focus():"home"===a?this.getMefront(a,!0):ChatUI.isExist(a)?(document.activeElement.blur(),this.getMefront(a,!0)):ChatsList.isExist(a)&&ChatsList.attachContinueActiveChat(a)},next:function(e,t){if(this.isChatPaneView()){for(var i=e,a=Object.keys(MainUI.getVisibleChats()).length,s=0;a>s;){var n=this.nextInPaneView(i,t);if(ChatUI.isExist(n)&&!ChatUI.exist[n].iscomposerdisabled)return n;i=n,s++}return e}var r=this.nextWithUnreadMsg(e,t);return r?r:this.nextInTheOrder(e,t)},nextInPaneView:function(e,t){if(!this.isCurrentisChat())return null;var i="",a=$("#"+e);if(i=t?a.prev():a.next(),0===i.length){var s=MainUI.container.find("#chatwindowsviewport").children();i=t?s.last():s.first()}return i.attr("id")},nextWithUnreadMsg:function(e){var t=function(e,t){var i=t.indexOf(e);if(-1!==i){t.splice(i,1);var a=t.splice(i);return a.concat(t)}return t},i=t(e,ChatsList.getCHIDsfromListView()),a=i.length;if(a)for(var s=0;a>s;s++)if(ChatUI.isExist(i[s])&&ChatUI.exist[i[s]].unreadmsgcount>0)return i[s]},nextInTheOrder:function(e,t){var i=function(e,t,i,a){e.splice(t,i);for(var s=t,n=0,r=a.length;r>n;s++,n++)e.splice(s,0,a[n]);return e},a=$Util.cloneArray(this.ontabwindoworder);i(a,a.indexOf("chats"),1,ChatsList.getCHIDsfromListView());var s=a.indexOf(e),n="home";if(-1!==s){var r=a.length;n=t?0===s?a[r-1]:a[s-1]:s===r-1?a[0]:a[s+1]}return n},resize:function(){if(MainUI.isExist(this.current)){var e=UI.container.find("#chatsection"),t=this.current,i=UI.container.outerHeight();if(e.height(i),e.width(UI.container.outerWidth()-LeftPannel.container.outerWidth(!0)),this.Transcript.resize(),"profileview"===t||"mentions"===t||"starmessages"===t){var a=UI.container.find("#"+t),s=a.find("[domtype='viewheader']");bodyheader=a.find("[domtype='bodyheader']"),viewbody=a.find("[domtype='body']"),viewbody.height(i-s.outerHeight()-(bodyheader.length?bodyheader.outerHeight():0))}else if(this.isCurrentisChat()){{var n=e.find("#"+t);n.find("#chatbody")}if(n.length){var r=i-n.find("#header")[0].clientHeight-n.find("#compcontainer")[0].clientHeight;this.isChatPaneView()&&this.normalizeChatWindow(this.container.find("#chatwindowsviewport"),r,!0)}MyBots.populateActions(this.current)}Tour.positionTourTip()}},hasOverlayWindow:function(){return $("#zcwindows").children().length>0},revertToViewPort:function(e){MainUI.handleIframes(e),$("#chatwindows").find('.selcht[purpose="chatview"]').removeClass("selcht"),MainUI.isCurrentisChat()&&(MainUI.current="home"),MainUI.isChatPaneView()?$("#chatwindowshideport").append($("#"+e)):($("#chatwindowsviewport").prepend($("#"+e)),$("#chatwindowsviewport").children('[purpose="chatview"]').hide()),MainUI.getMefront(e,!0),ZCScroll.customScroll($("#"+e).find("#chatbody"),!0),MainUI.resize()},Transcript:{load:function(e,t){var i=MainUI.container.find("#transcriptview");i.find("#transcriptviewholder").html('<div id="loadingoldmsgs" class="emcht-inftxtmn"><span class="zcldng"></span></div>'),i.show().attr("opener",e),UI.overlay.add(t)},close:function(){var e=MainUI.container.find("#transcriptview").attr("opener");$WC.$CUtil.isEmpty(e)||(window[e].closeTranscript(),UI.overlay.removeBasedonOpener(e)),MainUI.handleIframes("transcriptviewholder"),Chat.pauseMedia(e)},resize:function(){var e=UI.container.outerHeight()-parseInt(MainUI.container.find("#chatsection").css("margin-top")),t=MainUI.container.find("#transcriptview");t.height(e),t.find("#transcriptviewholder").height(e-t.find("#transcriptviewheader").outerHeight())},markMentionsAsRead:function(e,t){for(var i=0,a=t.length;a>i;i++)e.find("[mentionmsgid='"+$Util.escapeId(t[i])+"']").removeAttr("unreadmention")}},getLHSOrderHTML:function(e){var t=Settings.getFromObj("lhs_order",!0);if("undefined"!=typeof t)for(var i={0:"pinnedchats",1:"chats",2:"channelslhs",3:"mutedchats",4:"generalcontacts",5:"botcontacts"},a=e?0:$("#contactinvitations").index(),s=$(e?"#LHS-list":"#list"),n=1;n<=t.length;n++){var r=t.indexOf(n.toString()),o=s.find(e?'div[dragitem="'+i[r]+'"]':"#"+i[r]),l=s.children().eq(a);o.insertAfter(l),a++}}};var Home={};Home={init:function(){LeftPannel.updateCallback({type:"triggerhome",action:function(){MainUI.getMefront("home",!0)}}),MainUI.getMefront("home",!0),Home.NOTIFYLIMIT=3,ZCScroll.customScroll($("#zcdashbdmain"),!0),UI.Announcement.show()},handleCurrentEvents:function(){var e=Events.getAll(),t=Events.getAllSeenEvents(),i=$("#zceventsnotify"),a=!1;i.find(".off_msgbx").remove();for(var s in e){var n=e[s];if(!t[n.EUID]&&$Date.isSameDay(n.ST)&&!Events.isEndedEvent(n.ET)){var r=EventsUI.getHtml(n),a=!0;r=$(r).removeClass("zcevnt-msgmn").addClass("zcmsgbox curr_evnt off_msgbx"),r.append('<em eventid="'+n.EUID+'" ckey="'+n.CKEY+'" class="off_mrkrd" documentclick="clearevents" >'+Resource.getRealValue("home.event.gotit")+"</em>"),i.append(r)}}a?($("#zcdashnotify").addClass("hasnotify"),i.fadeIn().find('[hover="true"]').attr("hover","false"),HomeUI.handleCalendarTimer()):HomeUI.handleRemoveCallBack(i)},getHeaderObj:function(e,t){var i,a=($("#off_"+e),new $CliqChatId(e)),s="";if($WC.$CUtil.isEmpty(t.recipants)||"object"==typeof t.recipants||(t.recipants=JSON.parse(t.recipants)),a.isSystemChat()||a.isChannel()||t.pcount>2)if(a.isSystemChat()||(s+=" off_chnl_msg"),a.isChannel()){var n=Channels.getByChid(e);i=$.isEmptyObject(n)?'<div class="rds4 chtch cur" elemtype="channel" hover="true" uid="'+t.oc_id+'" >'+ChannelsUI.getImageByPhotoId(t.photoid,parseInt(t.sc))+"</div>":'<div class="rds4 chtch cur" elemtype="channel" hover="true" uid="'+n.oc_id+'" >'+ChannelsUI.getImage(n.oc_id)+"</div>"}else if(a.isDefaultBot())i='<div class="rds4 chtch"><img src="'+ChatBot.getImgUrl()+'"/></div>';else if(a.isCustomBot()){var r=MyBots.getBotId(e),o=MyBots.getImgByChid(e);i='<div class="rds4 chtch"><img  elemtype="contact" hover="true" uid="'+r+'" src="'+o+'" class="cur"/></div>'}else i=HistoryUI.getRecipantsPhoto(t.recipants,t.pcount,t.addinfo,t.title,t.ctype,e,t.cutsomgroup);else if(s="singlecht",t.recipants){var l=ChatsList.getRecipantIds(t.recipants,$zcg._ZUID)[0];i='<img elemtype="user" hover="true" uid="'+l+'" src="'+Users.getImgUrlById(l)+'" height="55" width="55" class="floatl rds4 cur" />'}else i='<img elemtype="user" hover="true" uid="" src="'+Users.getDefaultImgUrl()+'" height="55" width="55" class="floatl rds4 cur" />';var c=t.title||t.cn;return c="undefined"==typeof c?"":c,c=$WC.$CUtil.decodeHTMLEntities(c),{imghtml:i,title:c,classname:s,totalmsg:t.unreadmsgs,ctype:t.ctype}}},HomeUI={alreadyrequested:[],alreadypopulated:[],MAX_REQUEST_LIMIT:5,MAX_UNREAD_CHAT_IN_HOME_UI:3,reinit:function(){this.removeAllUnreadChatDiv(),this.alreadyrequested=[],this.alreadypopulated=[]},populateUnreadAndUnseenMsg:function(e){var t=this.getUnreadChatsList(e);$.isEmptyObject(t)||$Util.getObjectKeysLength(t)<=0||this.getTranscriptAndPopulate(t)},getTranscriptAndPopulate:function(e){Chat.getMultipleTranscriptFromRServer(e,function(e){for(var t in e){if($Util.getObjectKeysLength(HomeUI.alreadypopulated)>=HomeUI.MAX_UNREAD_CHAT_IN_HOME_UI)return;var i=Home.getHeaderObj(t,e[t]),a=$("#zcoffmsgnotify");a.append(HomeUI.getOfflineChatHTML(t,i).replace(/{CONTENT}/g,"")),HomeUI.handleTrancript(t,e[t].transcript,e[t].msgtime),HomeUI.alreadypopulated.push(t),$("#zcdashnotify").addClass("hasnotify"),a.fadeIn()}})},getUnreadChatsList:function(e){var t=ChatsList.unreadchatarr;if(!$.isEmptyObject(ChatsList.unreadchatarr)&&$Util.getObjectKeysLength(t)){var i=$Util.getObjectKeysLength(ChatsList.unreadchatarr),a=$Util.getObjectKeysLength(HomeUI.alreadypopulated),s=$Util.getObjectKeysLength(HomeUI.alreadyrequested);if(!(a>=HomeUI.MAX_UNREAD_CHAT_IN_HOME_UI||s>=i)){var n=0,r=[];for(var o in e)if(!(!ChatsList.unreadchatarr.hasOwnProperty(o)||ChatUI.isMuted(o)||!$.isEmptyObject(this.alreadyrequested)&&this.alreadyrequested.indexOf(o)>=0)){if(n===this.MAX_REQUEST_LIMIT)break;n++,r.push({chid:o,msgtime:ChatsList.unreadchatarr[o]}),HomeUI.alreadyrequested.push(o)}return r}}},populateMentionsNotify:function(){var e=Mentions.getUnreadObj();if(!$WC.$CUtil.isEmptyObject(e)){var t="",i=$("#zcmentionnotify");i.find(".off_msgbx").remove();var a=Mentions.sendernames;for(var s in e){var n=e[s];t+=MentionsUI.getRow(n,a)}i.append(t).fadeIn(),this.injectAdditionalMentionData(i),$("#zcdashnotify").addClass("hasnotify")}},getAndpopulateLatestComponents:function(){$ZCAjx.ajax({url:"/getlatestcomponents.do",success:function(e){e.commands&&e.commands.length&&(Commands.store(e),HomeUI.showLatestComponents(e.commands,"commands","command")),e.bots&&e.bots.length&&(Bots.store(e),HomeUI.showLatestComponents(e.bots,"bots","bot")),e.messageactions&&e.messageactions.length&&(MessageActions.store(e),HomeUI.showLatestComponents(e.messageactions,"messageactions","messageaction"))}})},showLatestComponents:function(e,t,i){var a="",s=$("#zc"+t+"notify");s.find(".off_msgbx").remove();var n=$("#"+t+"homelistview").children('[purpose="componentview"]').length;for(var r in e)a+=0==s.find("#homeui_"+e[r].id).length?this.getHomeViewHTMLForComponents(e[r],t):"",n++;if(!$WC.$CUtil.isEmpty(a)){a='<div id="'+t+'homelistview" purpose="componentsview" class="'+t+'list">'+a+"</div>";var o="";n>3&&0==$("#"+t+"homelistshowall").length&&(o+='<em id ="'+t+'homelistshowall" documentclick="expandcomponentsview" expand="true" category="'+t+'" class="off_mrksn cur">'+Resource.getRealValue("home.showall")+"</em>"),o+=0==$("#"+t+"homelistmarkseen").length?'<em id ="'+t+'homelistmarkseen" class="off_mrksn" documentclick="mark_allseen" type="'+i+'">'+Resource.getRealValue("home.markasseen")+"</em>":"",s.children().eq(0).append($WC.$CUtil.isEmpty(o)?"":'<div class="dIB">'+o+"</div>"),s.append(a).fadeIn(),$("#zcdashnotify").addClass("hasnotify")}},getHomeViewHTMLForComponents:function(e,t){switch(t){case"bots":return BotsUI.getBotsHomeViewHTML(e);case"commands":return CommandsUI.getCommandsHomeViewHtml(e);case"messageactions":return MessageActionsUI.getMessageActionsHomeViewHtml(e)}},markComponentAsSeen:function(e,t){$ZCAjx.ajax({url:"/markcomponentasseen.do",type:"POST",data:{type:t,id:e}})},markandRemoveComponentAllSeen:function(e){var t=$(e).attr("type"),i="-1",a="command"===t?"0":"bot"===t?"1":"messageaction"===t?"3":"2";HomeUI.markComponentAsSeen(i,a),setTimeout(function(){HomeUI.removeComponentsFromUI(i,a)},300)},removeComponentsFromUI:function(e,t){if(2!==parseInt(t))if("-1"===e){t=""+t;var i="0"===t?"commands":"1"===t?"bots":"3"===t?"messageactions":"2",a=$("#zc"+i+"notify");HomeUI.handleRemoveCallBack(a)}else{var s=$("#homeui_"+e);this.removeComponentFromView(s)}else Channels.removeNewAllowedChannels(e)},removeComponentFromView:function(e){e&&(e.addClass("zchmbtbxanim"),setTimeout(function(){var t=e.parents('[purpose="componentsview"]'),i=e.parents("div[data-notify]");e.remove(),3==t.children('[purpose="componentview"]').length&&i.find('[documentclick="expandcomponentsview"]').remove();var a=i.find('[purpose="componentsview"]').children().length;1>a&&(i.hide(),HomeUI.checkAndShowQuotes()),ZCScroll.updateScroll($("#zcdashbdmain"))},500))},checkAndShowQuotes:function(){var e=$("#zcdashnotify");HomeUI.getVisibleChildCount(e.children("div[data-notify]"))||e.removeClass("hasnotify")},expandComponentView:function(e){var e=$(e),t=e.attr("category"),i=e.attr("expand"),a=$("#"+t+"homelistview");"true"===i?(e.attr("expand","false"),e.html(Resource.getRealValue("common.collapse")),a.addClass("zcshowmore")):(e.attr("expand","true"),e.html(Resource.getRealValue("home.showall")),a.removeClass("zcshowmore")),ZCScroll.updateScroll($("#zcdashbdmain"))},markseenAndRemoveComponentDiv:function(e,t){var i="commands"===t?"0":"bots"===t?"1":"messageactions"===t?"3":"2";if($("#"+e).length>0){HomeUI.removeComponentFromView($("#"+e));var a=e.indexOf("_");HomeUI.markComponentAsSeen(e.substr(a+1),i)}},injectAdditionalMentionData:function(e){e.find('.zcunrdmn[purpose="mention"]').removeAttr("documentclick"),e.find('.zcunrdmn:not([purpose="mention"])').each(function(){var e=$(this).parent().addClass("off_msgbx"),t=e.find("span[data-msgtime]");t.replaceWith('<em class="off_msg_time">'+$Date.date(t.attr("data-msgtime"),{withtime:!0,shortmonth:!0})+"</em>"),HomeUI.showMarkReadLink($(this).find("div:last"),!0),$(this).wrap('<div class="off_msg currchatpanel" chid="'+e.attr("chid")+'"  mentionmsgid="'+e.attr("id")+'"/>'),HomeUI.bindEvents($(this).parent(),e)})},getOfflineChatHTML:function(e,t){return Template.HomeNotificationHTML.replace(/{CHID}/g,e).replace(/{TITLE}/g,$WC.$CUtil.processXSS(t.title)).replace(/{IMGHTML}/g,t.imghtml).replace(/{CLASS_NAME}/g,t.classname).replace(/{CHAT_TYPE}/g,t.ctype)},handleTrancript:function(e,t,i,a,s){function n(e,t){for(var i=0;c>i;i++)t[i].sender||(t[i].sender=e)}{var r=$("#off_"+e),o=r.find("#msgarea"),l=!$.isEmptyObject(t.splice(5,1)),c=t.length,d="undefined"!=typeof a&&"undefined"==typeof s;ChatUI.exist[e]}i="undefined"!=typeof i?i:-1,d&&c>0&&(i=t[0].time),UIDataPersist.hasWindow(e)&&(i=UIDataPersist.handleUnreadTime(e,t));var u={chid:e,unreadmarkertime:ChatsList.unreadchatarr[e],origin:"home"};if(c&&d){var m=o.find('[purpose="sender"]').last().attr("sender");"undefined"==typeof m&&(m=null),n(m,t)}var p=MsgUtil.formatTranscript(t,u);MsgUtil.updateTranscript(o,p,a,s),this.handleAdditionalOperations(o,r,l)},handleAdditionalOperations:function(e,t,i){e.find('div[purpose="date"]').remove(),t.hasClass("singlecht")&&t.find('div[purpose="sender"]').remove(),e.find("div.nwmsg:first").addClass("firstmsg"),i&&e.append('<div class="msgtxt nwmsg"><em class="off_viewmre">'+Resource.getRealValue("home.viewmore")+"</em>"),this.showMarkReadLink(e.find("div.msgtxt:last")),this.bindEvents(e,t);var a=$("#zcdashbdmain");0===a.scrollTop()&&ChatUI.loadVisibleImages(a[0]),a.on("scroll",function(){clearTimeout(HomeUI.scrolltimer),HomeUI.scrolltimer=setTimeout(function(){ChatUI.loadVisibleImages(a[0])},$zcg.ORIGINALIMG_LOAD_TIMEOUT)})},bindEvents:function(e,t){e.children().on("click",function(){return Home.childclicked?void delete Home.childclicked:(Mentions.setUnreadChatObj(e),ChatsList.attachContinueActiveChat(e.attr("chid")),void HomeUI.removeOfflineDiv(t))}),e.find("img").add('[hover="true"]').add("[documentclick]").on("click",function(e){Home.childclicked=!0,e.preventDefault()}),e.find("a").on("click",function(){Home.childclicked=!0})},removeOfflineDiv:function(e){e.length&&setTimeout(function(){var t=e.parents("div[data-notify]");e.remove(),HomeUI.handleRemoveCallBack(t)},1e3)},removeAllUnreadChatDiv:function(){$("#zcdashbdmain").find('[profile="off_chat"]').remove(),HomeUI.handleRemoveCallBack($("#zcoffmsgnotify"))},showMarkReadLink:function(e,t){var i=t?"mentions":"chat";e.append('<em class="off_mrkrd" documentclick="mark_offline_read" data-opr="'+i+'">'+Resource.getRealValue("home.markasread")+"</em>")},handleRemoveCallBack:function(e){if(ZCScroll.updateScroll($("#zcdashbdmain")),!HomeUI.getVisibleChildCount(e.find(".off_msgbx"))){e.hide(),"zceventsnotify"===e.attr("id")&&clearTimeout(HomeUI.calendartimer);var t=e.parent(".hasnotify");HomeUI.getVisibleChildCount(t.children("div[data-notify]"))||t.removeClass("hasnotify")}},getVisibleChildCount:function(e){return e.filter(function(){return"none"!=$(this).css("display")}).length},markAsRead:function(e){var t=e.parents(".off_msgbx");t.slideUp(function(){if("mentions"===e.attr("data-opr"))Mentions.read([t.attr("id")],"",t.attr("mention_on"));else{var i=e.parents("#msgarea").attr("chid");Chat.propagateMsgSeen(i),Mentions.clearUnreadMentions(i),ChatUI.removeNewmsgNotification(i,!0)}HomeUI.handleRemoveCallBack(t.parent())})},handleCalendarTimer:function(){var e=$("#home");clearTimeout(HomeUI.calendartimer),SecurityManager.hasPermission(Modules.Events)&&e.is(":visible")&&Events.isAnyEventToday()&&(e.find("div[ckey]").each(function(){var t=$(this),i=t.find("div[data-event-etime]"),a=i.attr("data-event-etime");return Events.isEndedEvent(a)?(Events.removeEndedEvent(t.attr("eventid")),void t.fadeOut(function(){HomeUI.handleRemoveCallBack(e.find("#zceventsnotify"))})):void i.html($Date.relativetimeleft(a).replace(" left",""))}),HomeUI.calendartimer=setTimeout(function(){HomeUI.handleCalendarTimer()},6e4))}};var MentionsUI={},Mentions={};MentionsUI={Limit:100,prevdate:"",currentchat:null,mentioncount:0,unreadmentionsreadtimer:"",selectedMentionMsgIdFromList:null,permissionMapping:{orgChannel:{participant:1,teamMember:0,orgUser:1},orgPrivateChannel:{participant:1,teamMember:0,orgUser:0},teamChannel:{participant:1,teamMember:1,orgUser:0},external:{participant:1,teamMember:0,orgUser:0},chat:{participant:1,teamMember:0,orgUser:0}},init:function(){$("#ztb-atmention").append('<div id="ztb-atmentioncount" class="msgnotify mrgT3">0</div>'),MentionsUI.updateCount(0),$("#ztb-atmention #ztb-atmentioncount").on("click",function(){MentionsUI.open()})},bindEvents:function(){var e=this;$("#mentionrows").on("scroll",function(){!e.loadingMore&&ZCScroll.isScrollNearBottom(this,150)&&e.loadMore()})},bindTranscriptEvents:function(){$("#mentionscontainer").on("click","[purpose='transcriptoptions']",function(e){e.stopPropagation(),MentionsUI.handleTranscriptoptions($(this),e)}),$("#mentionscontainer").on("click","[purpose='viewreplied']",function(e){"a"===e.target.tagName.toLowerCase()&&e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),i=t.attr("msgtime"),a=t.parents("[mtype]").attr("chid"),s=t.find('[elemtype="user"]').attr("uid"),n=a+"|"+s+"|"+i,r=$("#mentionscontainer").find("#currenttranscript");"undefined"!=typeof i&&$Util.fetchAndScrollToMsg(n,r,MentionsUI.handleTranscript)})},handleTranscriptoptions:function(e,t){var i=e.attr("operation");if("continue"===i||"join"===i){var a=e.attr("chid");if(!$WC.$CUtil.isEmpty(a)){var s=e.attr("operationfor");parseInt(s)===$zcg.ORGCHANNEL?"join"===i?Channels.join(a,!0):ChannelsUI.getChat(a):Chat.attachSession(a),Clickoutside.clear("transcriptcontainer"),$WC.$Win.destroy("mentionscontainer"),MentionsUI.currentchat=null,MentionsUI.selectedMentionMsgIdFromList=null}}else"transcriptclose"===i&&($("#mentionscontainer").find(".sel").removeClass(".sel"),MentionsUI.currentchat=null,MentionsUI.selectedMentionMsgIdFromList=null,Clickoutside.handleClickOnChild(t))},loadMore:function(){Mentions.get(null,Mentions.lmtime-1,!0)},showLoadMore:function(){$("#mentionrows").append('<div id="loadmore" purpose="chathistoryrow" class="hstrset"><div class="hst-lodngmn"><div class="hst-lodngsb">'+Resource.getRealValue("common.loading")+'<span class="hst-loadng"></span></div></div></div>')},removeLoadMore:function(){$("#mentionrows #loadmore").remove()},updateCount:function(e){if($Util.updateNotificationCount($("#ztb-atmentioncount"),e),e>0){$("#ztb-atmentioncount").removeClass("cunseen");var t=Mentions.getUnseenCount(),i=e-t,a="";t>0&&($("#ztb-atmentioncount").addClass("cunseen"),a=Resource.getRealValue("common.unseenmentions",[t,Resource.getRealValue(t>1?"tour.zcatmention.title":"common.mention")])),i>0&&(a+=t>0?" | ":"",a+=Resource.getRealValue("common.offmentions",[i,Resource.getRealValue(i>1?"tour.zcatmention.title":"common.mention")])),$("#ztb-atmention").attr("ztooltip",a)}else $("#ztb-atmention").attr("ztooltip",Resource.getRealValue("tour.zcatmention.title"))},open:function(){if(this.prevdate="",this.currentchat=null,this.selectedMentionMsgIdFromList=null,this.populate(),null===Mentions.viewing){var e=$("#mentionscontainer").addClass("loadingdata");$Util.updateStatusMsg(e.find("#mentionrows"),"loading"),this.bindEvents()}0===Mentions.getUnreadCount()&&Mentions.viewing!==Mentions.VIEW_READ&&Mentions.get()},populate:function(){var e=Mentions.getAll(),t=[];for(var i in e){var a=e[i];t.push([a.mentionmsgid,a.msgtime])}t=$Util.sort(t,1,!0);for(var s="",n=Mentions.sendernames,r=0,o=t.length;o>r;r++){var l=e[t[r][0]];s+=this.getRow(l,n)}s=$.trim(s).length>0?s:'<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("common.mentions.empty")+"</div></div>",$WC.$Win.isExist("mentionscontainer")||$WC.$Win.create({id:"mentionscontainer","class":"fullwin mntnoverlay",aligncenter:!1,header:'<div class="atmshdr">@'+Resource.getRealValue("tour.zcatmention.title")+"</div>",html:Template.MentionHistory,closefn:function(){delete Mentions.trancriptcache}});var c=$("#mentionscontainer").removeClass("loadingdata").find("#mentionrows");c.html(s),ZCScroll.resetScroll(c,!0),MentionsUI.updateCount(Mentions.getUnreadCount(!0))},getRow:function(e,t){var i=e.sender,a=Users.getName(i,"undefined"!=typeof t[i]?t[i]:"",1),s=parseInt(e.status),n=this.getMentionMsgObj(e),r=ChatsList.getTitle(e.chid,e.title),o='<div id="'+e.mentionmsgid+'" class="atmnsmg zcunrdmn {UNREADCLASS}" chid="'+e.chid+'" mention_on="'+e.mentionon+'" purpose="mention" documentclick="mentionrow">'+(parseInt(e.mentionon)===$zcg.ORGCHANNEL?e.channeltype?ChannelsUI.getImage(null,e.channeltype):"":'<span  title="'+Resource.getRealValue("common.directmessage")+'" class="msi-chacunt mnicon"></span>')+'<div class="atmnstit floatl" holder="chattitle">'+r+'</div><span class="zcunrd-dt ellips" data-msgtime="'+e.msgtime+'">'+$Date.daytime(e.msgtime)+"</span>"+Template.MentionDescHTML+"</div>",l=s===Mentions.UNREAD,c=s===Mentions.UNSEEN,d=e.deleted===$zcg.DELETED_STATUS?'<div class="dltinfomsg">'+MsgTemplate.getDeletedMsgText()+"</div>":n.msg;return o=o.replace(/{UNREADCLASS}/g,l?"unread":c?"unseen":"").replace(/{SENDERUID}/g,i).replace(/{SENDERNAME}/g,a).replace(/{IMGSRC}/g,Users.getImgUrlById(i)).replace(/{I18nTEXT}/g,n.mentioni18nstr).replace(/{MESSAGE}/g,d)},getMentionMsgObj:function(e){var t="undefined"!=typeof e.groups?e.groups:[],i="undefined"!=typeof e.channels?e.channels:[],a="&nbsp;"+Resource.getRealValue("common.mentioned"),s="&nbsp;"+Resource.getRealValue("common.and");if(e.mine&&(a+="&nbsp;"+Resource.getRealValue("common.you.small")),t.length>0||i.length>0){var n="&nbsp;"+Resource.getRealValue(1===t.length?"common.yourgroup":"common.yourgroups"),r="&nbsp;"+Resource.getRealValue(1===i.length?"common.yourchannel":"common.yourchannels");t.length>0&&i.length>0?a+=(e.mine?",":"")+n+s+r:(t.length>0&&(a+=(e.mine?s:"")+n),i.length>0&&(a+=(e.mine?s:"")+r))}var o=MsgTemplate.getMessageText(e);return{mentioni18nstr:a,msg:o}},getDateString:function(e){var t=$Date.day(e);return this.prevdate===t?"":(this.prevdate=t,'<div class="zcmsg_dvdrmn"> <div class="zcdvdmsg">'+t+"</div></div>")},viewormarkmention:function(e){var e=$(e),t=e.attr("id"),i=Mentions.getObject(t),a=e.attr("chid"),s=i.status===Mentions.UNREAD,n=i.status===Mentions.UNSEEN;MentionsUI.selectedMentionMsgIdFromList=t,$("#mentionscontainer").find(".sel").removeClass("sel"),e.addClass("sel");var r=$("#transcriptcontainer");r.length?$("#transcriptcontainer").find("#currenttranscript").attr("data-chid",a):($("#mentionrows").after(Template.TransriptOverlay.replace(/{CHID}/g,a)),r=$("#transcriptcontainer"));var o=r.attr("mentionmsgid",t).find("#currenttranscript");if(o.removeAttr("hastopmore").removeAttr("hasbottommore"),"mention"===e.attr("purpose")){if("none"===r.css("display")&&Clickoutside.bind({destid:"transcriptcontainer",customShow:function(e){var t=$("#"+e.destid);t.show().animate({left:"35%"},500);var i=t.attr("mentionmsgid");HomeUI.removeOfflineDiv($("#zcmentionnotify").find('div[mentionmsgid="'+i+'"]').parent())},doNotClose:function(){return ImgViewer.isVisible()||"mentionscontainer"!==$WC.$Win.current},customHide:function(e){$("#"+e.destid).animate({left:"100%"},500,function(){$(this).hide()}),$("#mentionscontainer").find(".sel").removeClass("sel"),MentionsUI.currentchat=null,MentionsUI.selectedMentionMsgIdFromList=null}}),o.find('[mentionmsgid= "'+t+'"]').length)return s&&Mentions.read([t],"mentionrecentchat",parseInt(e.attr("mention_on"))),void this.scrollToMsg(t);var l={chid:a,cache:!0,mentionmsgid:t,unreadmention:s,ctype:parseInt(e.attr("mention_on")),callback:MentionsUI.handleTranscript};$Util.updateStatusMsg(o,"loading"),l.lineslimit=Chat.LINESLIMIT,ChatHistory.getTranscript(l),MentionsUI.bindTranscriptEvents()}(s||n)&&Mentions.markasRead(t)},markasRead:function(e,t){for(var i=$("#mentionscontainer"),a=0,s=e.length;s>a;a++){var n=$Util.escapeId(e[a]);i.find("#"+n).removeClass("unread").removeClass("unseen");var r=Mentions.getObject(e[a]);"undefined"==typeof r.chid||!ChatUI.hasUnreadOrUnseenMsgs(r.chid)&&t||(Chat.propagateMsgSeen(r.chid,e[a]),ChatsList.markRead(r.chid)),HomeUI.removeOfflineDiv($("#zcmentionnotify").find('div[mentionmsgid="'+e[a]+'"]').parent())}},scrollToMsg:function(e){var t=Mentions.getObject(e),i=$("#mentionscontainer").find("#currenttranscript");return i=i.length?i:$("#"+t.chid).find("#chatbody"),element=i.find("[msgtime='"+t.msgtime+"'][mtype='12']"),0===element.length?void UI.updateBanner(Resource.getRealValue("common.mention.aftertime"),2e3):void this.handleMsgScroll(element,i)},handleMsgScroll:function(e,t){var i=Math.ceil(t[0].scrollTop),a=$Util.getParentChildOffset(e,t),s=!0,n=t.innerHeight()/2-e.innerHeight()/2;a.elementtop<a.containertop?i-=a.containertop-a.elementtop+n:a.elementbottom>a.containerbottom?i+=a.elementbottom-a.containerbottom+n:s=!1,Mentions.autoscroll=!0,t.stop(!0,!0),s?t.animate({scrollTop:i},function(){$Util.addHighlighterClass(e),Mentions.autoscroll=!1}):(ZCScroll.scrollTop(t,i),$Util.addHighlighterClass(e),Mentions.autoscroll=!1)},handleTranscript:function(e,t,i,a,s,n){var r=$("#mentionscontainer"),o=r.find("#transcriptcontainer"),l=o.find("#currenttranscript");if(l.find("#loadingoldmsgs").remove(),o.find("#loadmore").remove(),l.removeAttr("chid"),l.attr("mentionmsgid",n),e){var c=t.length;if(0===c){if(a||s)return void $("#loadingoldmsgs").remove();l.html('<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("chat.history.empty")+"</div></div>")}else{if(MentionsUI.currentchat=i,n&&MentionsUI.selectedMentionMsgIdFromList){var d=r.find("#"+$Util.escapeId(MentionsUI.selectedMentionMsgIdFromList)),u='<div class="floatl font15 ellips" holder="transcriptviewtitle">'+$WC.$CUtil.processXSS(d.find("[holder='chattitle']").text())+"</div>",m=Mentions.getObject(MentionsUI.selectedMentionMsgIdFromList);l.attr("mentionon",m.mentionon);var p=$Util.getTranscriptOptionHtml(m.chid,m);o.find("#transcriptheader").html(u+p)}var h={chid:i,dom:l,origin:"mentionView"},g=MsgUtil.formatTranscript(t,h);try{ChatUI.updateFirstMsgOffsetValue(s,a,l),MsgUtil.updateTranscript(l,g,a,s)}catch(f){}ZCScroll.resetScroll(l),ChatUI.handleScrollToLoadMore({dom:o,chid:i,fetchmethod:ChatHistory.getTranscript,totime:s,fromtime:a,data:{chid:i,callback:MentionsUI.handleTranscript,lineslimit:Chat.LINESLIMIT,ctype:l.attr("mentionon")}})}if(!a&!s){var v=n.split("|"),C=$("#mentionscontainer").find("#currenttranscript");msguid=v[1]+"_"+v[2],$Util.scrollToMsgInCurrentTranscriptView(msguid,C,i)}else ChatUI.scrollToMsgView(s,a,l);clearTimeout($Util.ontranscroll),$Util.handleTransViewScroll(o),$Util.animateBtnTransView(o)}else l.html('<div class="emcht-inftxtmn"><span purpose="transcriptoptions" class="msi-close cclose" operation="transcriptclose"></span><div class="emcht-inftxt">'+Resource.getRealValue("mentions.get.error")+"</div></div>");0===l.scrollTop()&&ChatUI.loadVisibleImages(l[0])},populatePermissions:function(e,t){var i="chat";t.isChannel()&&(i="external",t.isOrgChannel()?i="orgChannel":t.isOrgGroupChannel()?i="teamChannel":t.isPrivateChannel()&&(i="orgPrivateChannel"));var a=this.permissionMapping[i],s={1:" ( "+Resource.getRealValue("common.user.will.notified")+" )",0:" ( "+Resource.getRealValue("common.user.will.not.notified")+" )"};e.find('[mentiontitle="participant"] span').text(s[a.participant]),e.find('[mentiontitle="teamMember"] span').text(s[a.teamMember]),e.find('[mentiontitle="orgUser"] span').text(s[a.orgUser]),e.find('[mentiontitle="participant"] span').text(s[a.participant])},isSpecialMentionOnBoarded:function(){var e=Settings.getFromObj("specialmentions_onboarded");return isNaN(e)&&(e=0),1===e},getTemplateforSpecialMention:function(e){var t='<span class="star-svg"></span>';return e===Mentions.AvailableMention?'<div class="zc-aTinfo aThere ellips" purpose="search" data-val="participants" elemtype="participantsmention" uid="participants"><span class="zc-aTbx">@participants</span><span class="ellips">'+Resource.getRealValue("special.participants")+"</span>"+(this.isSpecialMentionOnBoarded()?"":t)+"</div>":'<div class="zc-aTinfo ellips" purpose="search" data-val="available" elemtype="available" uid="available" id="available"><span class="zc-aTbx">@available</span><span class="ellips">'+Resource.getRealValue("special.available")+"</span>"+(this.isSpecialMentionOnBoarded()?"":t)+"</div>"},getSpecialMentionHTML:function(e,t){if(t.specialmentions){var i="",a=!1,s=!1,n="*"===t.val?"":t.val.toLowerCase(),r=new $CliqChatId(t.chid);return $zcg._ISSPECIALMENTION_ENABLED&&((r.isChannel()&&ChannelsPermission.hasPermission(Channels.ACTIONS.SPECIAL_MENTIONS,Channels.getChannelId(t.chid))||ChatsList.isGroupChat(t.chid)&&r.isChat())&&(a=-1==t.ignorelist.indexOf(Mentions.specialMentionResource[Mentions.ParticipantsMention])&&0==="participants".indexOf(n),s=-1==t.ignorelist.indexOf(Mentions.specialMentionResource[Mentions.AvailableMention])&&0==="available".indexOf(n),i='<div id="specialmentions" '+(this.isSpecialMentionOnBoarded()?"":'class="spclmentionintro"')+' searchcatagory="specialmentions">'+(a?this.getTemplateforSpecialMention(Mentions.AvailableMention):"")+(s?this.getTemplateforSpecialMention(Mentions.ParticipantsMention):"")+"</div>"),a&&s&&this.markSpecialMentionOnboardingComplete()),(a||s)&&$zcg._ISSPECIALMENTION_ENABLED?i:""}return""},markSpecialMentionOnboardingComplete:function(){Settings.update({specialmentions_onboarded:1})},hasMentionSearch:function(e){return"chat".includes(e.val)||"channel".includes(e.val)||"available".includes(e.val)}},Mentions={UserMention:1,GroupMention:2,ChannelMention:3,BotMention:4,AllMention:5,ParticipantsMention:6,AvailableMention:7,lmtime:Number.MAX_VALUE,isLoadingMore:!1,isLoadMoreComplete:!1,specialMentionResource:{6:"participants",7:"available"},mentionRegex:{2:/{[@#][G](.*?)}/g,3:/{[#][OT](.*?)}/g,4:/{[@#][b][-](.*?)}/g,6:"{@participants}",7:"{@available}"},UNSEEN:-1,UNREAD:1,READ:0,VIEW_UNRAD:"unread",VIEW_READ:"read",viewing:null,UnSeen:{},storage:{},sendernames:{},unreadmentionsreadtimer:"",autoscroll:!1,isExist:function(e){return this.storage.hasOwnProperty(e)},getObject:function(e){return $Util.cloneObject(this.storage[e],!0)},getAll:function(){return $Util.cloneObject(this.storage,!0)},getMentionMsgId:function(e){var t=MsgUtil.getTimefromMsgObj(e);return e.chid+"|"+e.sender+"|"+t},getMentionData:function(e){var t=e.split(":"),i=t[1],a=parseInt(t[2]);return t=t.slice(3),t.pop(),{type:a,mentionedid:i,dname:$WC.$CUtil.decodeHTMLEntities(t.join(":"))}},isMine:function(e){function t(t){if(null!=t)for(var a=0;a<t.length;a++){var s;if(s=i&&e.mentions.hasOwnProperty(Mentions.getMentionId(t[a]))?Mentions.getNewMentionObj(t[a],e.chid):Mentions.getMentionData(t[a]),s.type===Mentions.UserMention&&WmsImpl.isLocalUser(s.mentionedid))return!0;if(s.type===Mentions.GroupMention&&Groups.isOrgGroupExist(s.mentionedid)&&Groups.isMyGroup(s.mentionedid))return!0;if(s.type===Mentions.ParticipantsMention)return!0;if(s.type===Mentions.AvailableMention&&MySelf.scode===$zcg.ONLINE)return!0}return!1}var i=!1,a=e.msg;if("string"!=typeof a)return!1;if(WmsImpl.isLocalUser(e.sender))return!1;if($WC.Matcher.check("atmentiontemplate",a,!0)){var s=$WC.Matcher.match("zcatmention",a);return t(s)}i=!0;var s=Mentions.getNewMentionMatch(a);return t(s)},updateMentionedContext:function(e,t){var i=[],a=MsgUtil.isNewMentionMsg(t);i=a?Mentions.getNewMentionMatch(t):$WC.Matcher.match("zcatmention",t);var s=[],n=[];if(null!=i){for(var r=0,o=i.length;o>r;r++){var l={};l=a?Mentions.getNewMentionObj(i[r]):this.getMentionData(i[r]),l.type===this.UserMention&&WmsImpl.isLocalUser(l.mentionedid)&&(e.mine=!0),l.type===this.GroupMention&&Groups.isOrgGroupExist(l.mentionedid)&&s.push(l.mentionedid),l.type===this.ChannelMention&&Channels.isJoined(l.mentionedid)&&n.push(l.mentionedid)}s.length>0&&(e.groups=s),n.length>0&&(e.channels=n)}},addLiveMentionMsg:function(e){var t=this.getMentionMsgId(e),i={sender:e.sender,msgtime:MsgUtil.getTimefromMsgObj(e),msg:e.msg,mentionon:parseInt(e.ctype),status:this.UNSEEN,mentionmsgid:t,chid:e.chid,title:ChatUI.getTitle(e.chid),joined:!0};if("undefined"!=typeof e.mentions&&(i.mentions=e.mentions),parseInt(e.ctype)===$zcg.ORGCHANNEL){var a=Channels.getByChid(e.chid);i.channeltype=a?a.sc:Channels.Org}this.updateMentionedContext(i,e.msg);var s={};s[t]=i;var n={};return n[e.sender]=e.nname,Mentions.update(s,n),this.updateMentionsUI(e.chid),t},updateMentionsUI:function(e){$("#mentionscontainer").is(":visible")?MentionsUI.populate():MainUI.isChatinViewport(e)||MentionsUI.updateCount(Mentions.getUnreadCount(!0)),Tour.isNewTourAvailable("mentions")&&Tour.showLoadingAnimation("mentions")},addMentionfromNonJoinedChannel:function(e){var t=e.mention;t.status=this.UNSEEN,this.updateMentionedContext(t,t.msg);var i={};i[t.mentionmsgid]=t,Mentions.update(i,e.sendernames),$("#mentionscontainer").is(":visible")?MentionsUI.populate():MentionsUI.updateCount(Mentions.getUnreadCount(!0))},updateDeletedMention:function(e){var t=this.getMentionMsgId(e);if(this.isExist(t)){var i={msg:MsgTemplate.getDeletedMsgText(),deleted:$zcg.DELETED_STATUS},a={};a[e.sender]=e.nname,this.updateByMentionId(t,i,a),this.updateMentionsUI(e.chid)}},updateEditedMention:function(e){var t=this.getMentionMsgId(e),i=this.isExist(t),a=this.isMine(e);if(i){if(a){var s={msg:e.msg,mentions:e.mentions};this.updateByMentionId(t,s)}else this.deleteMentionFromStorage(t);this.updateMentionsUI(e.chid)}else a&&this.addLiveMentionMsg($Util.cloneObject(e,!0))},updateByMentionId:function(e,t,i){var a=this.getObject(e),s={};if(a){for(var n in t)a[n]=t[n];s[e]=a,this.update(s,i)}},update:function(e,t){var i=this.storage;for(var a in e)i.hasOwnProperty(a)&&parseInt(i[a].status)===this.UNSEEN&&(e[a].status=this.UNSEEN),i[a]=e[a],e[a].msgtime<this.lmtime&&(this.lmtime=e[a].msgtime);if("undefined"!=typeof t)for(var a in t)this.sendernames[a]=t[a]},markasRead:function(e,t,i){e=e.split(",");for(var a=0,s=e.length;s>a;a++){var n=e[a];if(this.storage.hasOwnProperty(n)){var r=this.storage[n];(parseInt(r.status)===this.UNREAD||parseInt(r.status)===this.UNSEEN)&&(r.status=this.READ)}}if(i?MentionsUI.markasRead(e,!0):MentionsUI.markasRead(e,!1),MentionsUI.updateCount(this.getUnreadCount(!0)),t){var o;"mentionrecentchat"===t?o=MainUI.container.find("#transcriptview #transcriptviewholder"):"chathistory"===t&&(o=$WC.$Win.get("chathistory")),MainUI.Transcript.markMentionsAsRead(o,e)}},getUnreadCount:function(e){var t=this.getAll(),i=0;for(var a in t){var s=t[a],n=parseInt(s.status);(n===this.UNREAD||e&&n===this.UNSEEN)&&i++}return i},getUnseenCount:function(){var e=this.getAll(),t=0;for(var i in e){var a=e[i],s=parseInt(a.status);s===this.UNSEEN&&t++}return t},get:function(e,t,i){var a=this;if(!i||!this.isLoadMoreComplete&&!this.isLoadingMore){var s={};s.limit=MentionsUI.Limit,"undefined"!=typeof t&&(s.totime=t),e&&(s[e]=e),$ZCAjx.ajax({url:"/getmymentions.do",data:s,success:function(e){var t;"undefined"!=typeof e.meta&&(t=e.meta.userdnames),Mentions.update(e.data.mentions,t),MentionsUI.populate(),$Util.size(Mentions.storage)>0&&(Mentions.viewing=Mentions.VIEW_READ),$Util.size(e.data.mentions)<MentionsUI.Limit&&(a.isLoadMoreComplete=!0),MentionsUI.removeLoadMore(),a.isLoadingMore=!1},error:function(){MentionsUI.removeLoadMore(),a.isLoadingMore=!1}}),this.isLoadingMore=!0,i&&MentionsUI.showLoadMore()}},getUnread:function(){$ZCAjx.ajax({url:"/getmyunreadmentions.do",success:function(e){var t;"undefined"!=typeof e.meta&&(t=e.meta.userdnames),Mentions.update(e.data.mentions,t),MentionsUI.updateCount(Mentions.getUnreadCount(!0)),Mentions.getUnreadCount()>0&&(Mentions.viewing=Mentions.VIEW_UNRAD)}})},read:function(e,t,i){for(var a=[],s=0,n=e.length;n>s;s++){var r=e[s];"undefined"!=typeof r&&a.push(r)}a=a.join(","),0!==a.length&&$ZCAjx.ajax({url:"/markmentionasread.do",data:{mentionmsgid:a,type:i},success:function(e){"true"===e.status&&Mentions.markasRead(a,t)}})},captureAndRead:function(e,t){this.autoscroll||(clearTimeout(this.unreadmentionscatchtimer),this.unreadmentionscatchtimer=setTimeout(function(){var i=e.offset().top,a=i+e[0].clientHeight,s=$(window).height;a>s&&(a=s);for(var n,r=e.find("[unreadmention='true']"),o=[],l=[],c=0,d=r.length;d>c;c++){var u=$(r[c]),m=u.offset().top;m>i&&a>m&&(parseInt(u.attr("mention_status"))===Mentions.UNREAD?o.push(u.attr("mentionmsgid")):parseInt(u.attr("mention_status"))===Mentions.UNSEEN&&l.push(u.attr("mentionmsgid"))),void 0==n&&(n=parseInt(u.attr("mention_on")))}o.length>0&&Mentions.read(o,t,n),l.length>0&&Mentions.markasRead(l.join(","),t)},300))},clearUnreadMentions:function(e){var t=[];for(var i in this.storage){var a=i.split("|")[0];a==e&&1==this.storage[i].status&&t.push(i)}t.length&&this.read(t)},setUnreadChatObj:function(e){var t=e.attr("mentionmsgid");t&&(Mentions.offlinemsgs={},Mentions.offlinemsgs[e.attr("chid")]=t)},handleOfflineUnreadMsg:function(e){if(Mentions.offlinemsgs&&Mentions.offlinemsgs[e]){var t=Mentions.offlinemsgs[e];Mentions.read([t],"mentionrecentchat",Mentions.getObject(t).mentionon),ChatUI.hideLeftBarMsgCount(e),ChatUI.focus(e),MentionsUI.scrollToMsg(t),delete Mentions.offlinemsgs}},getUnreadObj:function(){var e=Mentions.getAll(),t={};for(var i in e){var a=e[i],s=parseInt(a.status);s===Mentions.UNREAD&&(t[i]=a)}return t},deleteMentionFromStorage:function(e){delete this.storage[e]},getNewMentionMatch:function(e){return $WC.Matcher.match("zcatmention_v2",e,"g")},getMentionMetaHash:function(e,t){var i={},a={},s=this.getNewMentionMatch(e);if(null!=s)for(var n=0;n<s.length;n++){var r=Mentions.getNewMentionObj(s[n],t);a[r.mentionedid]={name:r.dname,type:r.type,id:r.mentionedid,mentionmsg:r.mentionmsg}}return i.mentions=a,i},getNewMentionObj:function(e){function t(e,t){if(e===Mentions.GroupMention||e===Mentions.BotMention||e===Mentions.ChannelMention){var i=Mentions.mentionRegex[e];return i.lastIndex=0,i.test(t)}return e===Mentions.ParticipantsMention?"{@channel}"===t||"{@chat}"===t||"{@participants}"===t:t===Mentions.mentionRegex[Mentions.AvailableMention]}var i,a,s=this.getMentionId(e);if(s=s.toString(),t(Mentions.GroupMention,e)){s=s.substr(1);var n="",r=Groups.get(s);void 0!=r&&(n=r.name),i=new $NewMention(e,n,Mentions.GroupMention,s)}else t(Mentions.ChannelMention,e)?i=new $NewMention(e,Channels.getName(s),Mentions.ChannelMention,s):t(Mentions.ParticipantsMention,e)&&$zcg._ISSPECIALMENTION_ENABLED?(a=Mentions.specialMentionResource[Mentions.ParticipantsMention],i=new $NewMention(e,a,Mentions.ParticipantsMention,a)):t(Mentions.AvailableMention,e)&&$zcg._ISSPECIALMENTION_ENABLED?(a=Mentions.specialMentionResource[Mentions.AvailableMention],i=new $NewMention(e,a,Mentions.AvailableMention,a)):i=new $NewMention(e,Users.getName(s),t(Mentions.BotMention,e)?Mentions.BotMention:Mentions.UserMention,s);return i},getMentionId:function(e){var t=$WC.Matcher.regexes.zcatmention_v2;t.lastIndex=0;var i=t.exec(e)[1];return i},isSpecialMention:function(e){return e===Mentions.AvailableMention||e===Mentions.ParticipantsMention},isSpecialMentionElemType:function(e){return"participantsmention"===e||"available"===e}};var $NewMention=function(e,t,i,a){this.type=i,this.mentionedid=a,this.dname=t,this.mentionmsg=$WC.$CUtil.isEmpty(e)?this.getMentionFormat(this):e};$NewMention.prototype.getMentionFormat=function(){var e=this.type!==Mentions.ChannelMention?"@":"#",t=this.type===Mentions.GroupMention?"G":"",i=e+t+this.mentionedid,a="{"+i+"}";return a};var StarMessagesUI={},StarMessages={};StarMessagesUI={Limit:50,searchmore:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0},currentchat:null,selectedStarredMsgId:null,open:function(){this.currentchat=null,this.selectedStarredMsgId=null,this.searchmore={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0},StarMessages.storage={0:[],1:[],2:[],3:[],4:[],5:[]},StarMessages.lastfetchedstarmessagetime={0:0,1:0,2:0,3:0,4:0,5:0},StarMessages.lastfetchedstarmessageid={0:"",1:"",2:"",3:"",4:"",5:""},$WC.$Win.isExist("starmessagescontainer")||$WC.$Win.create({id:"starmessagescontainer","class":"fullwin mntnoverlay  currentchat floatl zcstarmsg ",aligncenter:!1,header:'<div class="atmshdr">'+Resource.getRealValue("common.starmessages")+"</div>",html:Template.StarMessages,closefn:function(){Clickoutside.handleEscape(),$WC.$Win.destroy("starmessagescontainer")}});var e=$("#starmessagescontainer").addClass("loadingdata");$Util.updateStatusMsg(e.find("#starsempty"),"loading"),StarMessages.get(),ZCScroll.scrollTop($("#starmessagescontainer"),Math.ceil(0))},showStarOptions:function(e,t){var i,a=e.attr("id"),s=(e.attr("star"),e.attr("type")),n=e.parents("[mtype]"),r=n.attr("chid")?n.attr("chid"):e.attr("chid"),o=n.attr("uid")?n.attr("uid"):e.attr("uid");if(e.addClass("zcstroptn"),!$("#staroptions_"+a).length){i='<div id="staroptions_'+a+'" msguid="'+o+'" chid="'+r+'" class="staroptnsbox chtwndw">',"undefined"!=typeof s&&(i+='<span purpose="unstar" type="'+s+'" class="msi-starsel type'+s+' unstar"></span>');for(var l=1;5>=l;l++)l!=s&&(i+='<span purpose="star" type="'+l+'" class="msi-starsel type'+l+'"></span>');i+="</div>",e.html(i)}Clickoutside.bind({srcid:a,destid:"staroptions_"+a,event:t,customShow:function(){},doNotClose:function(e,t,i){return t?void 0:"undefined"!=typeof i?$(i.target).attr("id")===a:!1},customHide:function(e){$("#"+e.srcid).removeClass("zcstroptn")},callback:function(e,t){$("#"+t).remove()}})},starMessage:function(e){var t=e.attr("type"),i=e.parent(),a=i.attr("id").split("_")[1],s=i.attr("msguid"),n=i.attr("chid"),r=$("#"+n).find("#"+a);r=r.length?r:$("#"+a),i.remove(),r.parent().removeClass("zcopsel"),r.removeClass("stariconseld").addClass("stariconsel"),StarMessages.star(n,s,t,r),Tour.isNewTourAvailable("starmsg")&&Tour.showLoadingAnimation("starmsg")},unstarMessage:function(e){var t=e.attr("type"),i=e.parent(),a=i.attr("id").split("_")[1],s=i.attr("msguid"),n=i.attr("chid"),r=$("#"+n).find("#"+a);i.remove(),r.parent().removeClass("zcopsel"),r.removeClass("stariconseld").addClass("stariconsel"),StarMessages.unStar(n,s,t,r)},bindEvents:function(){var e=$("#starmessagescontainer"),t=$("#starmessages");e.on("click","[purpose='transcriptoptions']",function(e){e.stopPropagation(),StarMessagesUI.handleTranscriptoptions($(this),e)}),e.on("click","[category]",function(e){e.stopPropagation(),StarMessagesUI.showCategory($(this),e)}),t.on("scroll",function(){StarMessagesUI.handleScroll()}),t.on("click","a",function(e){e.preventDefault()}),t.on("click","[purpose='star']",function(e){e.stopPropagation(),Clickoutside.handleClickOnChild(e),StarMessagesUI.starMessage($(this))}),t.on("click","[purpose='unstar']",function(e){e.stopPropagation(),Clickoutside.handleClickOnChild(e),StarMessagesUI.unstarMessage($(this))}),t.on("click","[purpose='staroptions']",function(e){e.stopImmediatePropagation(),StarMessagesUI.showStarOptions($(this),e)}),t.on("click","[purpose='starmessage']",function(e){e.stopPropagation(),StarMessagesUI.viewstarredmessage($(this))}),e.on("click","[purpose='viewreplied']",function(e){"a"===e.target.tagName.toLowerCase()&&e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),i=t.attr("msgtime"),a=t.parents("[mtype]").attr("chid"),s=t.find('[elemtype="user"]').attr("uid"),n=a+"|"+s+"|"+i;container=$("#starmessagescontainer").find("#currenttranscript"),"undefined"!=typeof i&&$Util.fetchAndScrollToMsg(n,container,StarMessagesUI.handleTranscript)})},handleScroll:function(){var e=$("#starcatview").children("[selected]").attr("category"),t=parseInt(e);ChatUI.loadVisibleImages($("#starmessages")[0]),ZCScroll.isScrollDown($("#starmessages")[0])&&StarMessagesUI.loadMore(t)},loadMore:function(e){var t=0===e?StarMessagesUI.searchmore[e]:StarMessagesUI.searchmore[0]&&StarMessagesUI.searchmore[e],i=$("#starmessages").find("#container"+e);if(t&&0===i.find("#loadmore").length){var a="";a=Object.keys(StarMessages.storage[e]).length>0?'<div id="loadmore" class="hstrset"><div class="hst-lodngmn"><div class="hst-lodngsb">'+Resource.getRealValue("common.loading")+'<span class="hst-loadng"></span></div></div></div>':'<div class="hstrset" id="loadmore"><div class="emcht-inftxtmn"><span class="zcldng"></span><div id= "fetchinghistories" class="emcht-inftxt">'+$Util.getRandomQuotes()+"</div></div></div>",i.append(a),StarMessages.get(StarMessages.lastfetchedstarmessagetime[e]-1,e)}},showCategory:function(e,t){if(!e[0].hasAttribute("selected")){$("#starmessagescontainer").find(".sel").removeClass(".sel"),StarMessagesUI.currentchat=null,StarMessagesUI.selectedStarredMsgId=null,Clickoutside.handleClickOnChild(t);var i=e.attr("category"),a=$("#starmessages").find("#container"+i),s=a.siblings(),n=e.siblings();n.removeAttr("selected"),e[0].setAttribute("selected",""),s.removeAttr("selected"),a[0].setAttribute("selected",""),ChatUI.loadVisibleImages($("#starmessages")[0]),i>0&&StarMessagesUI.loadMore(parseInt(i)),ZCScroll.resetScroll($("#starmessages"),!0)}},scrolltoStarredMsginStarUI:function(e){var t=$("#starmessages"),i=t.find("[id='"+e+"']");$("#starmessagescontainer").find(".sel").removeClass("sel");var a=Math.ceil(t[0].scrollTop),s=$Util.getParentChildOffset(i,t),n=!0;s.elementtop<s.containertop?a-=s.containertop-s.elementtop:s.elementbottom>s.containerbottom?a+=s.elementbottom-s.containerbottom:n=!1,t.stop(!0,!0),n?t.animate({scrollTop:a},function(){i.addClass("sel")}):(ZCScroll.scrollTop(t,a),i.addClass("sel"))},handleTranscriptoptions:function(e,t){var i=e.attr("operation");if("continue"===i||"join"===i){var a=e.attr("chid");if(!$WC.$CUtil.isEmpty(a)){var s=e.attr("operationfor");parseInt(s)===$zcg.ORGCHANNEL?"join"===i?Channels.join(a,!0):ChannelsUI.getChat(a):Chat.attachSession(a),Clickoutside.clear("transcriptcontainer"),$WC.$Win.destroy("starmessagescontainer"),StarMessagesUI.currentchat=null,StarMessagesUI.selectedStarredMsgId=null}}else"transcriptclose"===i&&($("#starmessagescontainer").find(".sel").removeClass(".sel"),StarMessagesUI.currentchat=null,StarMessagesUI.selectedStarredMsgId=null,Clickoutside.handleClickOnChild(t))},insertStarInBetween:function(e,t){var i=Object.keys(StarMessages.storage[t]).length,a=$("#starmessages").find("#container"+t),s=StarMessagesUI.getRow(e);if(0===i)a.html($(s));else{for(var n=a.find('[documentclick="starmessagerow"]'),r=!1,o=0;o<=n.length-1;o++){var l=Number(n[o].getAttribute("msgtime"));if(Number(e.time)>l){var c=$Util.escapeId(n[o].getAttribute("id"));a.find("#"+c).before($(s).hide().fadeIn()),r=!0;break}}if(!r){var c=$Util.escapeId(n[n.length-1].getAttribute("id"));a.find("#"+c).after($(s).hide().fadeIn())}}},populateCategory:function(e,t,i){if(e.length||i)if(t>0&&!i){for(var a="",s=0,n=e.length;n>s;s++)a+=this.getRow(e[s]);var r=$("#starmessages").find("#container"+t);""===r.html()||$(r.html()).hasClass("emcht-inftxtmn")?r.html(a):r.find("#"+StarMessages.lastfetchedstarmessageid[t]).after($(a).hide().fadeIn());var o=e[e.length-1].starmessageid.split("|");StarMessages.lastfetchedstarmessagetime[t]=Number(o[2]),StarMessages.lastfetchedstarmessageid[t]=$Util.escapeId(e[e.length-1].starmessageid)}else for(var l=1;5>=l;l++){var c=StarMessages.storage[l],d=Object.keys(c).length;if(!(i&&l==t&&d>0)){var a="",r=$("#starmessages").find("#container"+l);if(0!==d||StarMessagesUI.searchmore[0]&&!i){if(d>0){for(var s in c)a+=this.getRow(c[s]);r.html(a);var o=Object.keys(c)[d-1];StarMessages.lastfetchedstarmessagetime[l]=Number(o.split("|")[2]),StarMessages.lastfetchedstarmessageid[l]=$Util.escapeId(o)}}else a='<div class="emcht-inftxtmn"><div class="middlealign"><div class="emcht-inftxt">'+Resource.getRealValue("common.starmessages.empty"+l)+"</div></div></div>",r.html(a)}}else if(t>0&&0==Object.keys(StarMessages.storage[t]).length){var a='<div class="emcht-inftxtmn"><div class="middlealign"><div class="emcht-inftxt">'+Resource.getRealValue("common.starmessages.empty"+t)+"</div></div></div>";$("#starmessages").find("#container"+t).html(a)}},populate:function(e){var t="";if(0==e.length&&0==Object.keys(StarMessages.storage[0]).length){t='<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("common.starmessages.empty")+"</div></div>";var i=$("#starmessagescontainer").removeClass("loadingdata").find("#starmessages");i.find("#starsempty").html(t)}else{for(var a=0,s=e.length;s>a;a++)t+=this.getRow(e[a]);var i=$("#starmessagescontainer").find("#starmessages"),n=i.find("#starsempty"),r=i.find("#container0");$("#starmessagescontainer").hasClass("loadingdata")?($("#starmessagescontainer").removeClass("loadingdata"),i.before(Template.StarMessagesHeaders),n[0].removeAttribute("selected"),n.html(),r[0].setAttribute("selected",""),r.html(t)):0===StarMessages.lastfetchedstarmessagetime[0]?r.append(t):r.find("#"+StarMessages.lastfetchedstarmessageid[0]).after(t),StarMessagesUI.bindEvents(),ChatUI.loadVisibleImages($("#starmessages")[0]);var o=e[e.length-1].starmessageid.split("|");StarMessages.lastfetchedstarmessagetime[0]=Number(o[2]),StarMessages.lastfetchedstarmessageid[0]=$Util.escapeId(e[e.length-1].starmessageid),ZCScroll.resetScroll(i,!0)}},getRow:function(e){var t=e.sender,i=Users.getName(t,e.sendername),a="",s=e.startype,n=e.receiver?Users.getName(e.receiver,e.title):ChatsList.getTitle(e.chid,e.title),r=t+"_"+e.time,o='<img elemtype="user" hover="true" uid="'+t+'"class=" floatl rds4" title="'+i+'" src="'+Users.getImgUrlById(t)+'"/>',l=e.mtype?e.mtype:"12",c=e.status===$zcg.DELETED_STATUS;if(e.receiver&&!WmsImpl.isLocalUser(e.receiver)&&(o='<img elemtype="user" hover="true" uid="'+e.receiver+'"class=" floatl rds4" title="'+n+'" src="'+Users.getImgUrlById(e.receiver)+'"/>'),c)a='<div class="dltinfomsg">'+MsgTemplate.getDeletedMsgText()+"</div>";else{if("12"==l)a='<div class="strbmsg">'+MsgTemplate.getMessageText(e)+"</div>";else if("20"==l){e.msg="string"==typeof e.msg?JSON.parse(e.msg):e.msg;var d=e.msg.__module||e.mode;e.info=$Util.cloneObject(e.msg,!0),e.nname=e.dname,e.mod=d,a='<div class="strbmsg"><pre class="zcmsgcnt">'+MsgTemplate.getAttachment(e)+"</pre></div>"}a=Smiley.convertAnimatedTo24(a)}var u='<div class="strsmg" id="'+e.starmessageid+'" purpose="starmessage" chid="'+e.chid+'" msgtime = "'+e.time+'" chattitle="'+n+'" ctype="'+e.ctype+'" documentclick="starmessagerow" '+(c?' deleted="true"':"")+'><div class="zcstrrow"><div class="usrimgsts floatl zc-1">'+o+'</div><div class="zcunrd-rht"><div class="zcunrdlt-txt"><span class="floatl ellips bold zcunrdtit">'+i+'    <span class="zcstarw">&nbsp;&#10093;&#10093;&nbsp;</span> <span class="ellips bold zcunrdtit" holder="chattitle">    '+n+' </span></span><span class="zcunrd-dt ellips">'+$Date.daytime(e.time)+'</span></div><div id="starmessage'+e.time+'" chid="'+e.chid+'" uid="'+r+'" star="true" type="'+s+'" purpose="staroptions" class="msi-starsel type'+s+' cur" ></div>'+a+"</div></div></div>";return u},viewstarredmessage:function(e){var e=$(e),t=e.attr("chid"),i=e.attr("id");StarMessagesUI.selectedStarredMsgId=i,$("#starmessagescontainer").find(".sel").removeClass("sel"),e.addClass("sel");var a=i.split("|"),s=$("#starmessagescontainer").find("#currenttranscript");if(StarMessagesUI.currentchat===t&&s.find("[mtype][msgtime='"+a[2]+"'] ").length>0)StarMessagesUI.scrollChatTranscriptToStarredMsg(i);else{var n=$("#transcriptcontainer");n.length?s.attr("data-chid",t):($("#starmessages").after(Template.TransriptOverlay.replace(/{CHID}/g,t)),n=$("#transcriptcontainer"));var r=n.find("#currenttranscript");r.removeAttr("hastopmore").removeAttr("hasbottommore"),"none"===n.css("display")&&Clickoutside.bind({destid:"transcriptcontainer",customShow:function(e){$("#"+e.destid).show().animate({left:"35%"},500)},doNotClose:function(){return ImgViewer.isVisible()||"starmessagescontainer"!==$WC.$Win.current||"undefined"!=typeof event&&"staroptions"===event.target.getAttribute("purpose")},customHide:function(e){$("#"+e.destid).animate({left:"100%"},500,function(){$(this).hide()}),$("#starmessagescontainer").find(".sel").removeClass("sel"),StarMessagesUI.currentchat=null,StarMessagesUI.selectedStarredMsgId=null}});var o={chid:t,cache:!0,mentionmsgid:i,ctype:parseInt(e.attr("ctype")),callback:StarMessagesUI.handleTranscript};$Util.updateStatusMsg(r,"loading"),o.lineslimit=Chat.LINESLIMIT,ChatHistory.getTranscript(o)}},scrollChatTranscriptToStarredMsg:function(e){var t=e.split("|"),i=$("#starmessagescontainer").find("#currenttranscript"),a=i.find("[mtype][msgtime='"+t[2]+"'] ");if(0===a.length)return void UI.updateBanner(Resource.getRealValue("common.star.aftertime"),2e3);var s=Math.ceil(i[0].scrollTop),n=$Util.getParentChildOffset(a,i),r=!0,o=i.innerHeight()/2-a.innerHeight()/2;$Util.removeHighlighterClass(a),n.elementtop<n.containertop?s-=n.containertop-n.elementtop+o:n.elementbottom>n.containerbottom?s+=n.elementbottom-n.containerbottom+o:r=!1,i.stop(!0,!0),r?i.animate({scrollTop:s},function(){$Util.addHighlighterClass(a)}):(ZCScroll.scrollTop(i,s),$Util.addHighlighterClass(a))},handleTranscript:function(e,t,i,a,s,n){var r=$("#starmessagescontainer"),o=r.find("#transcriptcontainer"),l=o.find("#currenttranscript");if(o.find("#loadmore").remove(),l.removeAttr("chid"),l.find("#loadingoldmsgs").remove(),e){var c=t.length;if(0===c){if(a||s)return;l.html('<div class="emcht-inftxtmn"><div class="middlealign"><div class="emcht-inftxt">'+Resource.getRealValue("chat.history.empty")+"</div></div></div>")}else{if(StarMessagesUI.currentchat=i,n&&StarMessagesUI.selectedStarredMsgId){var d=r.find("#"+$Util.escapeId(StarMessagesUI.selectedStarredMsgId)),u='<div class="floatl font15 ellips" holder="transcriptviewtitle">'+$WC.$CUtil.processXSS(d.attr("chattitle"))+"</div>",m=StarMessages.getObject(StarMessagesUI.selectedStarredMsgId),p=$Util.getTranscriptOptionHtml(i,m);o.find("#transcriptheader").html(u+p)}var h={chid:i,dom:l,origin:"starList"},g=MsgUtil.formatTranscript(t,h);ChatUI.updateFirstMsgOffsetValue(s,a,l),MsgUtil.updateTranscript(l,g,a,s),ZCScroll.resetScroll(l),ChatUI.handleScrollToLoadMore({dom:o,chid:i,fetchmethod:ChatHistory.getTranscript,totime:s,fromtime:a,data:{chid:i,callback:StarMessagesUI.handleTranscript,lineslimit:Chat.LINESLIMIT}})}if(!a&!s){var m=StarMessages.getObject(n),f=(m.status=$zcg.DELETED_STATUS,n.split("|")),v=$("#starmessagescontainer").find("#currenttranscript");msguid=f[1]+"_"+f[2],$Util.scrollToMsgInCurrentTranscriptView(msguid,v,i)}else ChatUI.scrollToMsgView(s,a,l);clearTimeout($Util.ontranscroll),$Util.handleTransViewScroll(o),$Util.animateBtnTransView(o)}else l.html('<div class="emcht-inftxtmn"><div class="middlealign"><span operation="transcriptviewclose" class="msi-close cclose"></span><div class="emcht-inftxt">'+Resource.getRealValue("starmessage.get.error")+"</div></div></div>");0===l.scrollTop()&&ChatUI.loadVisibleImages(l[0])},closeTranscript:function(){return $("#starmessagescontainer").find(".sel").removeClass("sel"),StarMessagesUI.currentchat=null,StarMessagesUI.selectedStarredMsgId=null,$("#transcriptview").hide(),MainUI.handleIframes("transcriptviewholder"),!0},handleModuleStatusChange:function(){SecurityManager.hasPermission(Modules.StarredMessages)?$("#ztb-starredmessages").show():$("#ztb-starredmessages").hide()}},StarMessages={defaultType:3,storage:{0:[],1:[],2:[],3:[],4:[],5:[]},lastfetchedstarmessagetime:{0:0,1:0,2:0,3:0,4:0,5:0},lastfetchedstarmessageid:{0:"",1:"",2:"",3:"",4:"",5:""},getObject:function(e){return $Util.cloneObject(this.storage[0][e],!0)},get:function(e,t){var i={};i.limit=StarMessagesUI.Limit,t="undefined"!=typeof t?t:0,i.type=t,"undefined"!=typeof e&&(i.totime=e),$ZCAjx.ajax({url:"/v1/stars",type:"GET",data:i,success:function(e){$("#starmessages").find("#container"+t).find("#loadmore").remove(),StarMessages.update(e.data.starmessages,t)}})},star:function(e,t,i,a){$ZCAjx.ajax({url:"/v1/stars",type:"POST",data:{chid:e,msguid:t,type:i},success:function(s){$(a).removeClass("stariconsel").addClass("stariconseld"),s.data.status&&($ZCAjx.removeFromCacheByChid(e),StarMessages.updateUIonStar(e,t,i,s.data.starredmessage))},error:function(){$(a).removeClass("stariconsel").addClass("stariconseld")}})},unStar:function(e,t,i,a){var s=t+"_"+i+"_"+e;$ZCAjx.ajax({url:"/v1/stars/"+s,type:"DELETE",success:function(i){$(a).removeClass("stariconsel").addClass("stariconseld"),i.data.status&&($ZCAjx.removeFromCacheByChid(e),StarMessages.updateUIonUnstar(e,t))},error:function(){$(a).removeClass("stariconsel").addClass("stariconseld")}})},update:function(e,t){if(e.length<StarMessagesUI.Limit){if(StarMessagesUI.searchmore[t]=!1,0==e.length&&StarMessages.storage[t].length>0)return;StarMessagesUI.populateCategory(e,t)}for(var i in e){var a=e[i].starmessageid;a in StarMessages.storage[t]&&StarMessages.removeStarObject(a,t),0===t&&(this.storage[0][a]=e[i]),this.storage[e[i].startype][a]=e[i]}0==t&&StarMessagesUI.populate(e),StarMessagesUI.populateCategory(e,t)},handleLiveUpdate:function(e){var t=(e.chid,""+e.time),i=(e.sender,e.startype),a=$Util.escapeId(e.starmessageid),s=StarMessages.storage[0][e.starmessageid];StarMessages.storage[0][e.starmessageid]=e,StarMessages.storage[i][e.starmessageid]=e;{var n=parseInt($("#starcatview").children("[selected]")[0].getAttribute("category"));$("#starmessages").find("#container"+i)}if(!$WC.$CUtil.isEmpty(s)&&s.startype!=i){StarMessages.removeElementFromCategoryUI(s.starmessageid,s.startype,!0);var r=$("#starmessages").find("#container0").find("#"+a),o=r.find("#starmessage"+t);o.removeClass().addClass("msi-starsel type"+e.startype+" cur"),o.attr("type",""+e.startype)}n===i&&StarMessagesUI.insertStarInBetween(e,i),$WC.$CUtil.isEmpty(s)&&StarMessagesUI.insertStarInBetween(e,0),StarMessagesUI.populateCategory(e,n,!0),(n===i||0===n)&&StarMessagesUI.scrolltoStarredMsginStarUI(a)},removeStarObject:function(e,t){if(t="undefined"!=typeof t?t:0,StarMessages.storage[t][e]){var i=StarMessages.storage[t][e].startype;StarMessages.removeElementFromCategoryUI(e),StarMessages.removeElementFromCategoryUI(e,i)}},removeElementFromCategoryUI:function(e,t){var t="undefined"!=typeof t?t:0,i=$Util.escapeId(e),a=$("#starmessages").find("#container"+t),s=a.find("#"+i),n=Object.keys(StarMessages.storage[t]).length;if(delete StarMessages.storage[t][e],s.length>0){if(s.hide("slow",function(){$(this).remove(),$("#starmessages").perfectScrollbar("update")}),0===n&&t>0){var r='<div class="emcht-inftxtmn"><div class="middlealign"><div class="emcht-inftxt">'+Resource.getRealValue("common.starmessages.empty"+t)+"</div></div></div>";a.html(r),MainUI.handleIframes("starmessagescontainer"),$("#transcriptcontainer").animate({left:"100%"},500,function(){$(this).hide()})}if(0===n.length){var o='<div class="emcht-inftxtmn"><div class="middlealign"><div class="emcht-inftxt">'+Resource.getRealValue("common.starmessages.empty")+"</div></div></div>",l=$("#starmessages").find("#starsempty"),c=l.siblings();c.removeAttr("selected"),$("#starcatview").remove(),l.html(o),l[0].setAttribute("selected",""),MainUI.handleIframes("starmessagescontainer"),$("#transcriptcontainer").animate({left:"100%"},500,function(){$(this).hide()})}}},updateUIonStar:function(e,t,i,a){var s=t.split("_"),n=(s[0],s[1]),r=$("#"+e).find("#msgarea").find("#star"+n);r.length>0&&(r.removeClass().addClass("msi-starsel type"+i+" starselicon cur"),r.attr("type",""+i),r.attr("star","true"),r.parents('[purpose="msgoption"]').addClass("zcmsgstrd"));var o=$("#currenttranscript").find("#star"+n),l=$("#transcriptviewholder").find("#star"+n);if(o.length>0||l.length>0){var c=$(o.length>0?"#currenttranscript":"#transcriptviewholder"),d=c.find("#star"+n);d.removeClass().addClass("msi-starsel type"+i+" starselicon cur"),d.attr("type",""+i),d.attr("star","true")}$("#starmessagescontainer").length>0&&StarMessages.handleLiveUpdate(a)},updateUIonUnstar:function(e,t){var i=t.split("_"),a=i[0],s=i[1],n=$("#"+e).find("#msgarea").find("#star"+s);n.length>0&&(n.removeClass().addClass("msi-star staricon cur"),n.attr("star","false"),n.removeAttr("type"),n.parents('[purpose="msgoption"]').removeClass("zcmsgstrd"));var r=$("#currenttranscript").find("#star"+s),o=$("#transcriptviewholder").find("#star"+s);if(r.length>0||o.length>0){var l=$(r.length>0?"#currenttranscript":"#transcriptviewholder"),c=l.find("#star"+s);c.removeClass().addClass("msi-star staricon cur"),c.attr("star","false"),c.removeAttr("type")}$("#starmessagescontainer").length>0&&StarMessages.removeStarObject(e+"|"+a+"|"+s)},handleStar:function(e,t){var i=e.chat_id,a=e.sender_id+"_"+e.time;if(t){var s=e.star_message,n=e.star_type;this.updateUIonStar(i,a,n,s)}else this.updateUIonUnstar(i,a)}},SecurityManager.register(Modules.StarredMessages,StarMessagesUI.handleModuleStatusChange);var Reactions={};Reactions={isEnabled:function(){return $zcg._IS_REACTION_ENABLED},handle:{openSmileyBox:function(e,t,i){var a=e.closest("[msguid]"),s=a.attr("chid"),n=a.attr("msguid"),r="reactionSmileyHolder",o=$WC.template.replace(Template.ReactionSmileyHolder,{msguid:n,chid:s});$("body").append(o);var l=$("#"+s).find("#chatbody");i=i?i:function(){$("#reactionSmileyHolder").remove()},Smiley.showSmileyUI(e.attr("id"),r,t,i,!0),$Util.positionContainer(e,l,$("#"+r)),Smiley.focus($("#"+e.attr("id")))},reacted:function(e,t){var i=e.closest("[msguid]"),a=e.attr("unicode");a=$WC.$CUtil.isEmpty(a)?e.attr("code"):a;var s=i.attr("msguid"),n=i.attr("chid"),r=ChatUI.exist[n];if(r){var o=r.storage.getMessage(s),l="POST";o.reactions&&o.reactions[a]&&o.reactions[a].isIamReacted&&(l="DELETE");var c={emoji_code:a};$ZCAjx.ajax({url:"/v2/chats/"+n+"/messages/"+s+"/reactions",type:l,contentType:"application/json",data:c,success:function(){var e=ChatUI.exist[n];if(e){var t=e.storage.getMessage(s),i="POST"===l?"add":"remove";t.reactions=Reactions[i](t.reactions,a,WmsImpl.getZuid(),WmsImpl.getNickName(),$Util.getSyncedCurrentTime()),ChatUI.updateReactionsInCwin(n,t)}}})}Clickoutside.handleClickOnChild(t)}},search:function(e){var t=$("#reactionsView");if(e=$.trim(e).toLowerCase(),e=e||"*",t.length){var i=t.find("[purpose=reactionHeader]"),a=i.attr("currentTab"),s=i.attr("msguid"),n=i.attr("chid"),r=ChatUI.exist[n];if(r){var o=r.storage.getMessage(s);if(o&&o.reactions){var l='<div class="ellips clr6 font13"><a class="curD" href="javascript:void(0)">{{EMAILID}}</a></div>',c='<div class="'+(Participants.get(n).participantspopulated?'ellips clr6 font13">'+Resource.getRealValue("chat.participant.nonorg"):'zcloadstatus">')+"</div>",d=o.reactions,u=new Map,m=function(e,t,i){for(var a=e.length,s=0;a>s;s++){var n=e[s],r=n.zuid,o=t.get(r);o||(o=$WC.$CUtil.cloneObject(n),o.code=[]),o.code.push({code:i,time:n.time}),t.set(r,o)}return t};if("all"===a)for(var p in d)u=m(d[p].users,u,p);else u=m(d[a].users,u,a);var h=this.sort("BYUC");u=new Map(Array.from(u).sort(function(e,t){return h(e[1],t[1])}));var g="";u.size<10?$("#reactedUsers-search-field").hide():$("#reactedUsers-search-field").show(),u.forEach(function(t,i){var a=Users.getName(i,t.dname),s=Users.getName(i,t.dname,-1),n=Users.getEmailId(i);t.code.sort(Reactions.sort());var r=Smiley.replace(t.code[0].code,!0,!0),o="",d="",u=t.code[0].time;u=$Date.date(u,{shortmonth:!0,shortday:!0,withtime:!0});var m=t.code.length;if(m>1){o='<span class="zcusr-emoji-count">+'+(m-1)+"</span>",d='<div class="rcnt-emoji">',m=m>5?5:m;for(var p=1;m>p;p++)d+=Smiley.replace(t.code[p].code,!0,!0);d+="</div>"}var o=t.code.length>1?'<em class="zcusr-emoji-count">+'+(t.code.length-1)+"</em>":"";("*"===e||$WC.$CUtil.decodeHTMLEntities(s).toLowerCase().includes(e)||$WC.$CUtil.decodeHTMLEntities(n).toLowerCase().includes(e))&&(n=n?$WC.template.replace(l,{EMAILID:n}):c,g+=$WC.template.replace(Template.reactedUserList,{USERID:i,DNAMEVAL:a,ADDCONTACTORROLEHTML:"",DELETEMEMBER:"",DEFAULTURL:Users.getDefaultImgUrl(),IMGURL:Users.getImgUrlById(i),EMAILID:n,reacted_smiley:r,count:o,RECENT_REACT:d,RECENT_TIME:u},"InSecureHTML"))});var f=t.find("#reactedUsers-list");return f.html(g),ChatUI.loadVisibleImages(f[0]),u.size}}}},showAll:function(e,t){var i=ChatUI.exist[t],a=i.storage.getMessage(e),s=a.reactions;if(s){var n=[],r=0;for(var o in s){var l=s[o].users.length,c={};c.html=$WC.template.replace(Template.ViewReactionsSmileyList,{code:$WC.$CUtil.processXSS(o),smiley:Smiley.replace(o,!0,!0),count:l},"InSecureHTML"),c.time=s[o].lastReactedTime,c.uc=s[o].users.length,n.push(c),r++}n.sort(this.sort("BYUC")),n=n.map(function(e){return e.html}).join("");var d=$WC.$Win.create({id:"reactionsView","class":"chtwinparts adchtwin zcrectn-popup",closeoutside:!0,html:$WC.template.replace(Template.ViewReactions,{count:r,list:n,chid:t,msguid:e},"InSecureHTML")});SearchField.init("reactedUsers"),this.bindEvent(d);var u=this.search("*"),m=d.find("[purpose=reactionHeader]");m.find("[totalcount]").html(u);var p=function(){Reactions.search("*")};Participants.getIDsAfterPopulated(t,p,p)}},bindEvent:function(e){e.find("[purpose=tabs]").on("click",function(){var e=$(this),t=e.closest("[purpose=reactionHeader]");t.attr("currentTab")!==e.attr("val")&&(t.attr("currentTab",e.attr("val")),Reactions.search("*"),t.find(".sel").removeClass("sel"),e.addClass("sel"))}),e.find("#reactedUsers-results").on("scroll",function(){ChatUI.loadVisibleImages(this)})},convertObject:function(e){if(e&&!(Object.keys(e).length<1)){var t={};for(var i in e){for(var a=e[i],s=!1,n=-1,r=0;r<a.length;r++){var o=a[r];o=o.split(":");var l=-2;Contacts.isExist(o[1])?l=Contacts.get(o[1]).uc:WmsImpl.isLocalUser(o[1])&&(l=-1,s=!0),n=parseInt(o[0]),a[r]={time:n,zuid:o[1],dname:o[2],uc:l}}t[i]={},t[i].users=a.sort(this.sort("BYUC")),t[i].isIamReacted=s,t[i].lastReactedTime=n}return t}},getToolTipContent:function(e,t){var i="",a=t.length,s="",n=Smiley.getSmileyTitle(e);n=n?"<strong class='mrgB5 dib-mid'>"+n+"</strong>":"",a>5&&(s="<div>+"+(a-5)+" "+Resource.getRealValue("common.more.continuation")+"</div>",a=5);for(var r=0;a>r;r++)i+="<div>"+$WC.$CUtil.processXSS(Users.getName(t[r].zuid,t[r].dname,!0),!0)+"</div>";return $Util.getCustomTooltip(n+i+s,"html","","north")},showToolTip:function(e){var t=e.attr("unicode"),i=e.closest("[msguid]").attr("msguid"),a=e.closest("[chid]").attr("chid"),s=ChatUI.exist[a];if(!s)return"";var n=s.storage.getMessage(i);return n||n.reactions||n.reactions[t]?this.getToolTipContent(t,n.reactions[t].users):""},sort:function(e){var t;switch(e){case"BYUC":t=function(e,t){return-1!==e.uc&&-1!==t.uc||e.uc===t.uc?e.uc>t.uc?-1:e.uc<t.uc?1:e.time>t.time?-1:e.time===t.time?0:1:-1===e.uc?-1:1};break;case"BYMINE":t=function(e,t){return e.me&&!t.me?-1:!e.me&&t.me?1:e.count>t.count?-1:e.count===t.count?0:1};break;default:t=function(e,t){return e.time>t.time?-1:e.time===t.time?0:1}}return t},add:function(e,t,i,a,s){var n=0,r=!1;Contacts.isExist(i)?n=Contacts.get(i).uc:WmsImpl.isLocalUser(i)&&(n=-1,r=!0);var o={uc:n,time:s,zuid:i,dname:a};e=e?e:{},e[t]=e[t]?e[t]:{};var l=e[t].users;l=l?l:[];for(var c=0;c<l.length;c++)if(l[c].zuid===i)return e;return l.push(o),e[t].users=l.sort(this.sort("BYUC")),e[t].isIamReacted=r,e[t].lastReactedTime=s,e},remove:function(e,t,i){if(!e||!e[t])return e;for(var a=e[t].users,s=0;s<a.length;s++)if(a[s].zuid===i){a.splice(s,1);break}return a.length>0?(e[t].users=a.sort(this.sort()),e[t].lastReactedTime=e[t].users[0].time,e[t].users.sort(this.sort("BYUC")),e[t].isIamReacted=e[t].isIamReacted&&WmsImpl.isLocalUser(i)?!1:e[t].isIamReacted):(delete e[t],e=Object.keys(e).length<1?void 0:e),e},handleKeyUp:function(e,t){var i=e.which,a=$("#reactedUsers-search-field");if(i===$zcg.ESCAPE_KEYCODE)t.length<=0?$WC.$Win.destroy("reactionsView"):(a.html(""),this.search("*"));else if(t.length<=0){var a=$("#reactedUsers-search-field"),t=$WC.DivEditor.removeBufferCharacters(a.html());t=t?$WC.$CUtil.decodeHTMLEntities(t):"*",this.search(t)}},getTourHTML:function(){return Template.ReactionTour}};var MessageOptionsUI={};MessageOptionsUI={getGroupList:function(e,t){var i="",a="",s=Template.commonMessageAction,n=Template.commonMessageItem;for(var r in e){var o=e[r],l=o.length,c="";l%3===1&&(a+=this.getSingleList(o.splice(--l,1)[0]));for(var d=0;l>d;d++)0!=d&&d%3==0&&(i+=t(s,{msgitems:c},"InSecureHTML"),c=""),c+=t(n,o[d]);c&&(i+=t(s,{msgitems:c},"InSecureHTML"))}return i+a},getSingleList:function(e){var t=MsgUtil.escape(e.name),i=$WC.template.replace;e.showTour&&(e.class+=" touractive",t=i(Template.messageOperationTour,e));var a=i(Template.messageOperationHtml,e);return i(a,{content:t},"InSecureHTML")},getHtml:function(e){for(var t=$WC.template.replace,i=(Template.messageOperationHtml,Template.messageOperationTour,{}),a=[],s=e.length,n=0;s>n;n++){var r=e[n],o=r.commonmsg;if(o)i[o]||(i[o]=[]),i[o].push(r);else{var l=r.html;void 0===l&&(l=this.getSingleList(r)),a.push(l)}}return this.getGroupList(i,t)+a.join("")}};var MessageOperations={};MessageOperations={EDIT:2,DELETE:4,REPLY:8,FORWARD:16,FORK:32,getMsgOperationsDiv:function(e,t){var i=e.mtype||"12",a="12"==i&&"undefined"!=typeof e.info&&"undefined"!=typeof e.info.linkdetails,s=a?!0:e.msg?$WC.Matcher.checkWithFlag("linkRegExp",$WC.$CUtil.decodeHTMLEntities(e.msg),"i"):!1;s=s?s:e.msg?$WC.Matcher.checkWithFlag("zcWWWlinkRegExp",$WC.$CUtil.decodeHTMLEntities(e.msg),"i"):!1;var n=t?"zcf-more zcf-msgoptcnt left":"msi-optmore mgoptcnt cur",r='<div purpose="messageoperations" documentclick="messageoperations" id="msgoptns{CHID}_{MSGTIME}" class="'+n+'" msginfo="haslink:'+s+'" ></div>';return r.replace(/{CHID}/g,e.chid).replace(/{MSGTIME}/g,MsgUtil.getTimefromMsgObj(e))},getMsgOptionsList:function(e,t){var i=ChatUI.exist[e.chid],a=i.getMessageOptions(),s=[],n=Resource.getRealValue,r=!$ZCVideoBroadcast.isVideoBroadcastPage,o=i.storage.getMessage(e.msguid);return 0!=(a&this.FORK)&&(SecurityManager.hasPermission(Modules.DirectMessage)?s.push({"class":"zcf-fork",name:n("message.option.fork"),purpose:"fork",id:"fork{CHID}"}):""),e.iscustom||(s.push({"class":"zcf-copy",name:n("common.copy"),purpose:"copy",id:"",commonmsg:1}),s.push({html:RemindersUI.getMsgOptionHTML(e)})),0!=(a&this.FORWARD)&&r&&!e.isnativewidget&&s.push({"class":"zcf-forward",name:n("common.forward"),purpose:"forward",id:"forward{CHID}",commonmsg:1}),$zcg._MARK_UNREAD_ENABLED&&s.push({"class":"zcf-markunread",name:n("message.option.markunread"),purpose:"makeunread",id:"makeunread{CHID}"}),MsgUtil.isMsgEditable(e,a)&&!e.isnativewidget&&s.push({"class":"zcf-edit",name:n("message.option.edit"),purpose:"edit",id:"edit{CHID}"}),0!=(a&this.DELETE)&&MsgUtil.isMsgDeletable(e,t,i)&&s.push({"class":"zcf-delete notheme",name:n("message.option.delete"),purpose:"delete",id:"delete{CHID}"}),o&&o.reactions&&s.push({"class":"zcf-emoji",name:n("message.option.reactions"),purpose:"reactions",id:"reactions{CHID}"}),s},getOptionsHtml:function(e,t){var i=Template.messageOptionsHtml.replace(/{CHID}/g,e.chid).replace(/{MSGTIME}/g,MsgUtil.getTimefromMsgObj(e)),a=this.getMsgOptionsList(e,t);i=i.replace(/{OPTIONS}/g,MessageOptionsUI.getHtml(a)),i=i.replace(/{CHID}/g,e.chid),i=i.replace(/{OPTCUSTOM}/g,e.iscustom?"zcmsgopddcustm":"");var s=MessageActionsUI.getOptionsHTML("","",e);return i=i.replace(/{OPTAPPMENUS}/g,s.classname),i=i.replace(/{APPOPTIONS}/g,s.html),i.replace(/{OTHEROPTION}/g,"")},hideMsgOperation:function(e){var t=e.find('div[purpose="message_actions"]').attr("id");Clickoutside.clear(t);var e=e.empty();e.parent().removeClass("zcvsble")},handle:{messageoperations:function(e,t,i){Tour.isNewTourAvailable("msgactions")&&$('#onboardtour[module="msgactions"]').length&&Tour.closeTour();var t=$(t),a=t.parents().eq(1),s=t.attr("msginfo"),n=MsgUtil.getMsgObjfromElem(a,e);n.msginfo=s;var r=MsgUtil.getTimefromMsgObj(n),o=MessageOperations.getOptionsHtml(n,a),l=$("#msgoptns"+e+"_"+r);l.html(o),MessageActionsUI.handleMsgActionCallback();var c=$("#"+e).find("#chatbody"),d=$("#msgoptns"+e+"_"+r),u=$("#optnslist"+e+"_"+r),m=d.offset().top,p=c.offset().top,h=c.height(),g=u.height()/2;u.addClass("zcmsgoptn-top").removeClass("zcmsgoptn-btm"),h-(m-(p-50))>2*g&&u.addClass("zcmsgoptn-btm").removeClass("zcmsgoptn-top"),t.parent().addClass("zcvsble"),t.children().addClass("msgoptnanim"),Clickoutside.bind({srcid:"msgoptns"+e+"_"+r,destid:"optnslist"+e+"_"+r,event:i,doNotClose:function(t,i,a){return i?void 0:"undefined"!=typeof a?$(a.target).attr("id")==="msgoptns"+e+"_"+r:!1},callback:function(){MessageOperations.hideMsgOperation($("#msgoptns"+e+"_"+r)),t.children().addClass("msgoptnanim")}})},forward:function(e,t,i){MessageOperations.clearreplypreview(e);var a=t.parents("[msgtime]").attr("msgtime"),s=$("#"+e),n=s.find("#chatbody"),r=(s.find("#msgarea"),t.parents("[msgtime]"));s.find('[purpose="staroptions"]').css("display","none"),n.attr("msgselectionmode","true"),n.addClass("zcmsgsel"),s.find('[purpose="msgselect"]').addClass("msgsel"),r.addClass("zcmsgselbx");var o=r.prev().hasClass("sender");o&&r.prev().addClass("zcmsgselbx"),s.find("#msgchcked"+a).removeClass("msi-chkbxdsel").addClass("msi-chkbxsel"),s.find("#chatwindropdown").css("display","none"),s.find("#helptip").css("visibility","hidden"),$("#triggeractions"+e).css("display","none"),s.find("#header").css("pointer-events","none"),s.find("#cclose").css("pointer-events","auto");var l='<div id="chatwindropdown" class="chateditrmn zceditrsndfile"><div class="width100"><span class="msi-close"  purpose="fwdclose"></span><div class="msgselcnt"><span id="msgselectcnt">1/'+MessageOperations.forward.fwdMsgLimit+"</span>&nbsp;"+Resource.getRealValue("message.forward.selected")+'</div></span><span class="msi-cmdarw" title="'+Resource.getRealValue("common.forward")+'" purpose="fwdnext"></span></div>';$("#messageoperationcontrol"+e).html(l).css("display","block"),Clickoutside.bind({srcid:e,destid:"messageoperationcontrol"+e,event:i,doNotClose:function(t,i,a){return i?void 0:"undefined"!=typeof a&&($(a.target).closest("#"+e).length||$("#forwardmessageswin").length)?!0:!1},callback:function(){MessageOperations.forward.clearSelection(e)}})},reply:function(e,t){var i=t.closest("[msgtime][mtype]"),a=$("#msgoptionspreview"+e),s=$(i).attr("uid"),n=($("#"+e),MessageOperations.getFormattedRepliedMsg(i));a.find("#preview").html("<pre>"+n+"</pre>"),a.attr("msguid",s).show(),a.find("#closepreview").one("click",function(){MessageOperations.clearreplypreview(e)}),$WC.DivEditor.focus("composer"+e)},attdownload:function(e,t){MessageOperations.clearreplypreview(e);var i=t.parents("[msgtime]"),a=$WC.DivEditor.getNodes($(i).find("[msgtype]")[0]);msgelem=a[0],"BLOCKQUOTE"===msgelem.nodeName&&"quotedmsgdiv"===msgelem.className&&(msgelem=a[1]);var s=$(msgelem),n=s.attr("url"),r=s.attr("fname"),o=s.attr("content"),l=s.attr("isv1");r?"undefined"!=typeof DesktopApp?DesktopApp.downloadURL(MsgTemplate.getFileDownloadLink(o,n,r,"true"===l)):window.location=MsgTemplate.getFileDownloadLink(o,n,r,"true"===l):window.open(MsgTemplate.getRedirectLink(n),"_blank")},fork:function(e,t){MessageOperations.clearreplypreview(e);var i=t.parents("[msgtime]").attr("uid");MessageOperations.fork.createwin(e,i)},copy:function(e,t){ZCTrack.track("ACTIONS_ON_MSG",{TYPE:"Copy Message"});var i=t.parents("[msgtime]").attr("msgtime"),a=$($("#"+e).find("[mtype][msgtime='"+i+"']")),s=a.find("[msgtype]")[0],n=Markdown.convertToActualMsg(s),r='<textarea id="copyhidden" style="display:block;">'+n+"</textarea>";a.find('[purpose="messageoperations"]').after(r),a.find("#copyhidden").select(),document.execCommand("copy"),a.find("#copyhidden").remove(),UI.updateBanner(Resource.getRealValue("message.option.copied"),2e3,!1)},edit:function(e,t){var i=t.parents("[msgtime]").attr("uid");MessageOperations.edit.createwin(e,i),MessageOperations.edit.bindEvents(e)},"delete":function(e,t){var i=t.parents("[msgtime]"),a=i.attr("uid");if(!$WC.$CUtil.isEmpty(a))var s=a.split("_")[1];var n=i.attr("msguid");MessageOperations.delete.createwin(e,n,s)},reactions:function(e,t){var i=t.closest("[msguid]").attr("msguid");Reactions.showAll(i,e)},addReactions:function(e,t,i){t.parent().addClass("zcvsble"),Reactions.handle.openSmileyBox(t,i,function(e){var t=$("#"+e.srcid);t.parent().removeClass("zcvsble"),$("#reactionSmileyHolder").remove()})},makeunread:function(e,t){var i=t.closest("[msguid]"),a=i.attr("msguid"),s=i.attr("msgtime");Chat.makechatasunread(e,a,s)}},getFormattedRepliedMsg:function(e){e=$(e);var t,i=e.attr("msgtime"),a=e.prevAll('[purpose="sender"]:first'),s=a.attr("sender"),n=a.attr("customsender_name"),r=a.attr("nname"),o=e.find('[msgtype="msg"]')[0],l=e.find("[nativewidget]"),c=e.attr("mtype");if(MsgUtil.isTextMsg(c)){var d="";"undefined"!=typeof n?d='<div class="quotedmsgsender"><span msgtime="'+i+'" class="floatl ellips bold w100">'+n+'&nbsp;&nbsp;<span class="reply-dt ellips">'+$Date.daytime(i)+"</span></span></div>":(s&&s.indexOf("_")>-1&&(s=s.substring(0,s.indexOf("_"))),d='<div class="quotedmsgsender"><span elemtype="user" hover="true" msgtime="'+i+'" uid="'+s+'" class="cur floatl ellips bold w100">'+Users.getName(s,r)+'&nbsp;&nbsp;<span class="reply-dt ellips">'+$Date.daytime(i)+"</span></span></div>");var u="";if(l.length){var m=NativeWidgetHandler.getMsgObj(l.attr("componentid"),l.attr("nativewidget"));t=m.msg}else"undefined"==typeof o?(o=$(e).find('[msgtype="custommsg"]')[0],t=MessageOperations.formatCustomMsgForOperations(o)):(u=MsgUtil.escape(Markdown.convertToActualMsg(o),!0),t=Markdown.apply(u),t=MsgTemplate.getMarkedDownContent(t));return t=Smiley.convertAnimatedTo24(t),'<span class="msi-reply zcclr floatl"></span><div class="quotedmsgellips">'+d+t+"</div>"}if("20"===c){var p=$(o).parents().attr("mode"),h=$WC.DivEditor.getNodes(o);if(h.length>0){var d='<div elemtype="user" hover="true" msgtime="'+i+'" uid="'+s+'" class=" cur mrgT6 ellips bold dIB w100">'+Users.getName(s,r)+'&nbsp;&nbsp;<span class="reply-dt ellips">'+$Date.daytime(i)+"</span></div>",g="";if("att"===p){var f=h[0];"BLOCKQUOTE"===f.nodeName&&"quotedmsgdiv"===f.className&&(f=h[1]),f=$(f);var v=f.attr("fname"),C=f.attr("url"),y=f.attr("content"),b=f.attr("comment"),E="true"===f.attr("isv1"),I="true"===f.attr("hasthumbnail"),T=MsgTemplate.getCachedImageLink(y,C,v,E,I,!0);b=b?b:"",g=y&&-1!==y.indexOf("image")?"<div class='zcimgld posl'> <img errorpurpose='replymsgimg' extn='"+v.split(".").pop()+"'  src='"+T+"'/></div>":'<div class="zcimgld posl"> <span class="zcftype posa font10 bold ellips">'+v.split(".").pop()+'</span><span class="zcf-file dIB"></span></div>',$WC.$CUtil.isEmpty(b)?g+="<div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' ><span class='msi-attfile font10'></span>"+$WC.$CUtil.processXSS(v)+"</div></div>":(b=MsgTemplate.getCommentForFileAttachment($WC.$CUtil.processXSS(b)),g+="<div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' ><span class='msi-qut'></span>"+b+"</div></div>")}else if("contact"===p){var S=$($(o).html()).find("[name]").attr("name");g="<div class='zcimgld posl'><span class='msi-atchcontact dIB floatl'></span></div><div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' ><span class='msi-attcontact font14'></span>&nbsp"+$WC.$CUtil.processXSS(S)+"</div></div>"}else if("location"===p){var R=$($(o).html()).find("[name]"),A=R.attr("name"),M=R.attr("lat"),U=R.attr("lng");g='<div class="zcimgld posl"><a href="http://maps.google.com/?q='+M+","+U+'" target="_blank" class="msi-location zclomglftsb"></a></div><div class="zcattmsgdet floatl mrgL10">'+d+'<div class="zcattmsgcmnt" ><span class="msi-location font14"></span>&nbsp'+$WC.$CUtil.processXSS(A)+"</div><div>"}else if("event"===p){var R=$($(o).html()).find("[name]"),w=R.attr("name"),_=Number(R.attr("startdate")),O=R.attr("enddate");eventtime=$Date.daytime(_,{withtime:!1,raw:!0})+" "+Resource.getRealValue("common.to.small")+" "+$Date.daytime(O,{withtime:!1,raw:!0}),y='<div class="zcevedte"><div class="zcemonth">'+new Date(_).getFullYear()+'</div><div class="zcetime">'+$Date.getMonthString(_,!0)+'<div class="font10 clr6">'+$Date.getDateString(_,!0)+"</div></div></div>",g="<div class='zcimgld posl'>"+y+"</div><div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' >&nbsp"+$WC.$CUtil.processXSS(w)+"</div></div>"}return'<span class="msi-reply zcclr floatl"></span><div class="zcattmsgrly">'+g+"</div>"}}},clearreplypreview:function(e){$("#msgoptionspreview"+e).find("#preview").html(""),$("#msgoptionspreview"+e).attr("msgtime","").hide(),$("#smileys"+e).css("bottom",""),$("#compautocomplete"+e).css("bottom",""),$("#"+e).find("#header").css("pointer-events",""),Clickoutside.clearCurrentElement("msgoptionspreview"+e)},reply:{viewRepliedMessage:function(e,t,i){var a=$("#"+e).find("#chatbody"),s=$Util.getMessageElement(a,t);if(MessageOperations.delete.isExist(e,t))$Util.showInfoInCwinHeader(e,Resource.getRealValue("info.reply.deleted"),"cwin-hdr-info-warn",2e3);else if(s.length>0){var n=s.attr("msgtime");this.scrolltoMsginChatWindow(e,n)}else{var r={chid:e,mentionmsgid:e+"|"+i+"|"+t,callback:MessageOperations.reply.handleTranscript,lineslimit:16};ChatHistory.getTranscript(r)}},loadbetweenTranscript:function(e,t,i,a,s){t=t?parseInt(t)+1:void 0,Chat.getTranscriptFromRServer(e,void 0,t,void 0,function(e,t,n,r,o){MessageOperations.reply.handleRepliedMsgTranscript(e,t,n,i,o,r,a),"function"==typeof s&&s()},Chat.LINESLIMIT)},handleTranscript:function(e,t,i,a,s,n){MessageOperations.reply.handleRepliedMsgTranscript(i,t,a,parseInt(n.split("|")[2]),void 0,n.split("|")[2])},handleRepliedMsgTranscript:function(e,t,i,a,s,n,r){function o(e,t){for(var i=0;i<t.length;i++)t[i].sender||(t[i].sender=e)}if(ChatUI.isExist(e)){var l=$("#"+e).find("#msgarea"),c=!!t.length,d=!1,u=a;if(l.find("#loadingoldmsgs").remove(),t.length){var m=l.find('[purpose="sender"]').last().attr("sender"),p=-1;"undefined"==typeof m&&(m=null),o(m,t);var h={chid:e,unreadmarkertime:p};if(r){var g=t.find(function(e){return MsgUtil.getTimefromMsgObj(e)===a});"undefined"!=typeof g?(t.splice(t.indexOf(g)),c=!1):u=MsgUtil.getTimefromMsgObj(t[t.length-2]);var f=MsgUtil.formatTranscript(t,h);MsgUtil.updateTranscriptInBetween(l,f,i,a)}else{var v=t.find(function(e){return MsgUtil.getTimefromMsgObj(e)===n});if(v){u=MsgUtil.getTimefromMsgObj(t[t.length-2]),d=!0;var C=l.find("[mtype][msgtime]")[0];if("undefined"!=typeof C){var y=$(C).attr("msgtime"),b=t.find(function(e){return e.time===y});"undefined"!=typeof b&&(t.splice(t.indexOf(b)),c=!1)}var f=MsgUtil.formatTranscript(t,h);ChatUI.updateFirstMsgOffsetValue(a,i,l),MsgUtil.updateTranscript(l,f,i,a)}else c=!1}}if(c){var E=$Util.getMessageElement(l,u);E.length&&E.after('<div class="zcmsgmr_dvdr textcent"><div purpose="loadbetweenmsgs" class="zcmsgmr dIB posl"><div>'+Resource.getRealValue("common.load.inbetween")+"</div></div></div>"),"undefined"!=typeof n&&this.scrolltoMsginChatWindow(e,n)}else"undefined"!=typeof n&&(d?this.scrolltoMsginChatWindow(e,n):UI.updateBanner(Resource.getRealValue("message.replied.doesnotexist"),2e3,!1));if(i){var I=i-1;l.find('[loadfromtime="'+I+'"]').remove()}var T=ChatUI.exist[e];T&&T.storage.setAllMessages(t)}},scrolltoMsginChatWindow:function(e,t){if(MessageOperations.delete.isExist(e,t))return void $Util.showInfoInCwinHeader(e,Resource.getRealValue("info.reply.deleted"),"cwin-hdr-info-warn",2e3);var i=$("#"+e).find("#chatbody");$Util.scrollToMsgInCurrentTranscriptView(t,i)}},forward:{fwdIndividualUserLimit:10,fwdMsgLimit:25,initUI:function(e){var t=$WC.$Win.create({id:"forwardmessageswin","class":"adchtwin",closeoutside:!0,html:Template.forwardMessagesHtml.replace(/{CHID}/g,e)});this.bindEvents(t)},bindEvents:function(e){SearchField.init("forwardmessages-usersuggest");var t="forwardmessages-usersuggest-search-field";e.find("#sendbtn").on("click",function(){var e=$.trim($("#forwardmessages-usersuggest").attr("chid"));MessageOperations.forward.send(e),$WC.$Win.destroy("forwardmessageswin"),MessageOperations.forward.clearSelection(e)}),e.on("click","[purpose='deleteimgnode']",function(){var e=$("#forwardmessages-usersuggest-select-field")[0];$(this).parents("[nodetype]").remove(),$WC.DivEditor.focus(t),MessageOperations.forward.populateDefaultResult(),$WC.$CUtil.isEmpty($("#forwardmessages-usersuggest-select-field").html())&&$("#forwardmessages-usersuggest").addClass("zcrchmcnt"),1==e.childNodes.length&&($("#fwdradio").remove(),$("#titleheader").hide(),$("#chattitle").hide(),$("#forwardmessages-usersuggest-results").removeClass("fwdradiogrpcls").removeClass("fwdradiocls")),0===e.childNodes.length&&$("#selectheader").html(Resource.getRealValue("message.forward.select")),e.childNodes.length>1&&e.childNodes.length<MessageOperations.forward.fwdIndividualUserLimit&&0===$("#fwdradio").find("#group").length&&($("#titleheader").hide(),$("#chattitle").hide(),$("#fwdradio").remove(),MessageOperations.forward.createRadioButton(),$("#forwardmessages-usersuggest-results").addClass("fwdradiocls").removeClass("fwdradiogrpcls").removeClass("fwdgrpcls"))}),e.on("click","[purpose='deleterecipant']",function(){$(this).parents("[elemtype]").remove();var e=$("#forwardmessages-usersuggest-select-field")[0];0===e.childNodes.length&&$("#selectheader").html(Resource.getRealValue("message.forward.select")),$WC.$CUtil.isEmpty($("#forwardmessages-usersuggest-select-field").html())&&$("#forwardmessages-usersuggest").addClass("zcrchmcnt"),MessageOperations.forward.populateDefaultResult()}),e.on("click","[id='group_radio']",function(){$("#titleheader").show(),$("#chattitle").show(),$("#forwardmessages-usersuggest-results").removeClass("fwdradiocls").addClass("fwdradiogrpcls")}),e.on("click","[id='individual_radio']",function(){$("#titleheader").hide(),$("#chattitle").hide(),$("#forwardmessages-usersuggest-results").removeClass("fwdradiogrpcls").addClass("fwdradiocls")}),e.find("#"+t).focus(),MessageOperations.forward.populateDefaultResult(),ZCScroll.customScroll($("#forwardmessages-usersuggest-list"),!0)},populateDefaultResult:function(){$WC.$Win.isExist("forwardmessageswin")&&this.search("*")},createRadioButton:function(){var e=[{id:"group",value:1,label:Resource.getRealValue("Group"),checked:!1},{id:"individual",value:2,label:Resource.getRealValue("Individual"),checked:!0}],t='<div id="fwdradio" class="fwdradio dIB floatr mrgL20">'+Resource.getRealValue("message.forward.as")+"&nbsp"+$Dom.radio.construct("forwardas",e)+"</div>";$("#selectheader").before(t),$("#forwardmessages-usersuggest-results").addClass("fwdradiocls")},search:function(e){var t=$("#forwardmessages-usersuggest-select-field")[0],i=SearchField.getSelectedList("forwardmessages-usersuggest-select-field");$("#forwardmessages-usersuggest-list").html("");var a=this.getSearchCriteriaBasedonModulesEnabled(t),s=SearchAgent.search({searchin:a,val:e,contactshtml:Template.quickChatcontactHtml,orgcontactshtml:Template.quickChatcontactHtml,chathistoryhtml:Template.forwardchathistorysearchhtml,chatshtml:Template.forwardchathistorysearchhtml,channelshtml:Template.forwardchannelshtml,channelcategory:ChannelsUI.List.RETRIVE_JOINED,replacecontentonsuccesscallback:!0,ignorelist:i,listid:"forwardmessages-usersuggest-list"});s||MessageOperations.forward.populateEmptyResult(),0===$("#forwardmessages-usersuggest-list").find("[elemtype]").length&&MessageOperations.forward.populateEmptyResult()},getSearchCriteriaBasedonModulesEnabled:function(e){var t=0;return SecurityManager.hasPermission(Modules.DirectMessage)&&(t+=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS+SearchAgent.CHATHISTORY),SecurityManager.hasPermission(Modules.Channels)&&(t+=SearchAgent.CHANNELS),e.childNodes.length>0&&"contact"===$(e.childNodes[0]).attr("elemtype")&&SecurityManager.hasPermission(Modules.DirectMessage)?t=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS:e.childNodes.length>0&&(t=SecurityManager.hasPermission(Modules.DirectMessage)?SearchAgent.CHATHISTORY:0,t+=SecurityManager.hasPermission(Modules.Channels)?SearchAgent.CHANNELS:0),t},handleKeyUp:function(e,t){var i=e.which;e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&($WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes("forwardmessages-usersuggest-search-field")?$WC.$Win.destroy("forwardmessageswin"):SearchField.clearSearchField("forwardmessages-usersuggest")),$WC.$CUtil.isEmpty(t)&&MessageOperations.forward.populateDefaultResult(),SearchField.hasNodes("forwardmessages-usersuggest-list")||MessageOperations.forward.populateEmptyResult()},handleAction:function(e,t){var i=t.attr("elemtype");if("contact"===i){var a=t.attr("uid"),s=Users.getName(a),n=t.attr("elemtype"),r=$("#forwardmessages-usersuggest-select-field")[0],o='<div uid="'+a+'" elemtype="'+n+'" title="'+s+'" nodetype="@" class="dIB zcricnt posl"><img src="'+Users.getImgUrlById(a)+'"/><div class="msi-close posa dN cur" purpose="deleteimgnode"></div></div>';t.remove(),$WC.$CUtil.isEmpty(a)||($("#selectheader").html(Resource.getRealValue("quickchat.select")),$("#forwardmessages-usersuggest-select-field").append(o),$("#forwardmessages-usersuggest").removeClass("zcrchmcnt"),SearchField.clearSearchField("forwardmessages-usersuggest")),r.childNodes.length==MessageOperations.forward.fwdIndividualUserLimit&&($("#forwardmessages-usersuggest-results").removeClass("fwdradiocls").removeClass("fwdradiogrpcls").addClass("fwdgrpcls"),$("#fwdradio").html(Resource.getRealValue("message.forward.asgroup")),$("#titleheader").show(),$("#chattitle").show()),r.childNodes.length>1&&r.childNodes.length<MessageOperations.forward.fwdIndividualUserLimit&&0===$("#fwdradio").length&&($("#forwardmessages-usersuggest-results").removeClass("fwdgrpcls").addClass("fwdradiocls"),this.createRadioButton()),MessageOperations.forward.populateDefaultResult()}else{var l,c,d=t.attr("chid"),u=d;if("channel"===i){var m=Channels.getByChid(d);l=$WC.$CUtil.processXSS(m.cn),d=m.oc_id,c=ChannelsUI.getImage(m.oc_id,m.sc)}else{var l=ChatHistoryTitleSearch.getTitle(d)||ChatsList.getTitle(d);c=ChatsList.isGroupChat(d)?$Util.getImgStaticUrl()+"/group.png":Users.getImgUrlById(t.find("img").attr("uid")),c='<img src="'+c+'"/>'}var p='<div id="selrecipant" chid="'+u+'" uid="'+d+'" title="'+l+'" elemtype="'+i+'" class="zcricnt posl zcfwdsel dIB"><div class="usrimgsts zcssimg floatl">'+c+'</div><div class="msi-close posa dN cur" purpose="deleterecipant"></div></div>';$("#forwardmessages-usersuggest-select-field").append(p),$("#selectheader").html(Resource.getRealValue("message.forward.select.chats")),$("#forwardmessages-usersuggest").removeClass("zcrchmcnt"),SearchField.clearSearchField("forwardmessages-usersuggest"),MessageOperations.forward.populateDefaultResult()}},populateEmptyResult:function(){var e=$("#forwardmessages-usersuggest-list"),t="message.forward.no.result";if(e.html(""),$WC.$CUtil.isEmpty($("#forwardmessages-usersuggest-search-field").text())){var i=$("#forwardmessages-usersuggest-select-field")[0];"contact"===$(i.childNodes[0]).attr("elemtype")&&(t="quickchat.no.contact")}e.html('<div class="textcent clr6 zcnorst posa h35"><span>'+Resource.getRealValue(t)+"</span></div>")},send:function(e){var t,i=$("#"+e).find(".msi-chkbxsel"),a=[],s="/v1/chats/"+e+"/forward",n=0;if(i.length>0){for(;n<i.length;n++){var r=$(i[n]).parent().attr("uid");"undefined"!=typeof r&&a.push(r)}var o=$("#forwardmessages-usersuggest-select-field")[0];if(contactlist="contact"===$(o.childNodes[0]).attr("elemtype")){var l=!1,c=Composer.parseEditor("forwardmessages-usersuggest-select-field"),d=c.ulist.join(),u=(c.ulist[0],$.trim($("#chattitle").val()));o.childNodes.length>1&&(l=o.childNodes.length<MessageOperations.forward.fwdIndividualUserLimit?$("#group_radio").is(":checked"):!0),t={msguids:a.join(),userids:d,fwdasgroup:l,sid:WmsImpl.getSid()},$WC.$CUtil.isEmpty(u)||(t.title=u)}else{for(var m=o.childNodes,p=[],n=($(m[0]).attr("chid"),0);n<m.length;n++)p.push(m[n].getAttribute("chid"));t={msguids:a.join(),fwdchidlists:p.join(),sid:WmsImpl.getSid()}}$ZCAjx.ajax({url:s,type:"POST",contentType:"application/json",data:t})}},handleMsgSelection:function(e,t,i){e=$(e);var a=e.parents("[msgtime]"),s=$("#"+t),n=s.find("#msgselectcnt"),r=n.parent(),o=s.find(".msi-chkbxsel").length;if(i&&o===MessageOperations.forward.fwdMsgLimit){var l=s.find("#messageoperationcontrol"+t);return l.addClass("zcfdk_tmbzoom"),l.handleAnimationEnd(function(){l.removeClass("zcfdk_tmbzoom")}),void r.addClass("zcchcoutdec")}if(r.removeClass("zcchcoutdec"),i){a.addClass("zcmsgselbx");var c=a.prev().hasClass("sender");c&&a.prev().addClass("zcmsgselbx"),e.removeClass("msi-chkbxdsel").addClass("msi-chkbxsel"),o++}else{a.removeClass("zcmsgselbx");var c=a.prev().hasClass("sender");c&&a.prev().removeClass("zcmsgselbx"),e.removeClass("msi-chkbxsel").addClass("msi-chkbxdsel"),o--}n.html(o+"/"+MessageOperations.forward.fwdMsgLimit),0===o&&MessageOperations.forward.clearSelection(t)},clearSelection:function(e){var t=$("#"+e),i=t.find("#chatbody"),a=t.find("#msgarea");a.find("[mtype]").css("background-color",""),a.find("[sender]").css("background-color",""),i.removeClass("zcmsgsel"),i.removeAttr("msgselectionmode"),a.find("[mtype]").removeClass("zcmsgselbx"),a.find("[sender]").removeClass("zcmsgselbx"),t.find('[purpose="staroptions"]').css("display",""),t.find('[purpose="msgselect"]').removeClass("msgsel"),t.find('[purpose="msgselect"]').removeClass("msi-chkbxsel").addClass("msi-chkbxdsel"),$("#messageoperationcontrol"+e).css("display","none"),t.find("#chatwindropdown").css("display",""),t.find("#helptip").css("visibility",""),$("#triggeractions"+e).css("display",""),t.find("#header").css("pointer-events","")}},edit:{init:function(e,t){this.createwin(e,t),this.bindEvents(e)},isSameExist:function(e,t){var i=$("#editcontainer"+e),a=i.length>0&&t===i.attr("msguid");return a},createwin:function(e,t){var i=$("#"+e),a=i.find('[uid="'+t+'"]'),s=i.find("#chatbody"),n=a.attr("msguid"),r=a.attr("msgtime");if(2!==Settings.getFromObj("edit_msg_tour")&&Settings.update({edit_msg_tour:"2"}),"undefined"!=typeof n){var o="",l=$("#editcontainer"+e).length>0;l&&MessageOperations.edit.clearComposer(e);var c=a.find('[msgtype="msg"]')[0],d=a.attr("mtype");MsgUtil.isTextMsg(d)&&(o=MessageOperations.formatMessageForEdit(c));var u=Template.MessageEditor.replace(/{MSG}/g,o).replace(/{CHID}/g,e).replace(/{MSGUID}/g,n).replace(/{MSGTIME}/g,r);u=$Util.CustomCheckbox.construct(u,[{html:'<input id="editnotify" type="checkbox" class="zcunrdchkbx"/>',key:"{EDITNOTIFY}",checked:!1}]),a.before(u),a.hide();var m="editor"+e,p=$("#editcontainer"+e);$WC.DivEditor.initEditor(m,{highlightclass:"sel",handleKeyDown:Composer.handleKeyDown,handleKeyUp:Composer.handleKeyUp,handleTextPaste:Composer.handleTextPaste,trigger:"editor",handleInitialize:Composer.handleInitialize}),setTimeout(function(){$Util.scrollToView(p,s,400)},250),$WC.DivEditor.focus(m)}},bindEvents:function(e){var t=ChatUI.exist[e],i=t.win().find("#editcontainer"+e);i.find("#editor"+e).on("focus",function(){t.win().find("#compautocomplete"+e).attr("trigger","editor")}),i.find("#saveedit").on("click",function(){var t=i.find("#editor"+e)[0];Composer.sendMsgOnEnter(e,t)}),i.find("#canceledit").on("click",function(){MessageOperations.edit.clearComposer(e)}),i.find('[purpose="smileytrigger"]').on("click",function(t){$(this).attr("id");Smiley.showSmileyUI("editor_smileytrigger"+e,"editor_smileys"+e,t);var a={maxwidth:440,top_offset:43,minwidth:325},s=$("#editor_smileys"+e);s.css($Util.positionTargetElementUpDown(i,s,a)),s.show()}),i.on("click","[code]",function(t){MessageOperations.edit.handleSmileyClick(e,t)}),i.find("#editnotify").on("change",function(){var e="checked"===$(this).attr("checked");e?$(this).removeAttr("checked"):$(this).attr("checked",!0)})},handleSmileyClick:function(e,t){var i=t.currentTarget;Composer.handleSmileyInsertion(t,i,"editor"+e)},clearComposer:function(e){var t=ChatUI.exist[e],i=t.win().find("#chatbody"),a=i.find("#editcontainer"+e),s=a.attr("msguid"),n=i.find('[uid][msguid="'+s+'"]');n.show(),a.remove(),ZCScroll.updateScroll(i),t.focus()},showMsgHistoryUI:function(e,t){var i="editmsghistory";$WC.$Win.isExist(i)&&$WC.$Win.destroy(i),$WC.$Win.create({id:i,header:'<div class="edit-his-hd">'+Resource.getRealValue("message.edit.history")+"</div>",html:Template.EditHistoryUI,closeoutside:!0,"class":"edit-history"});var a=function(e){for(var t="",i=$WC.template.replace,a=$WC.CMsgUtil.convertMsgObj,s=($Date.time,$Date.date,e.length),n=0;s>n;n++){var r=a(e[n]),o=r.time,l=$Date.time(o),c=$Date.date(o),d={time:l,date:c,msg:MsgTemplate.getDisplayContent(r,!1,!1),islastmsg:n===s-1?"dark":"",isfirstmsg:0===n?"edit-his-last-item":""};t=i(Template.EditHistoryMsg,d,"InSecureHTML")+t}var u=$("#editmsghistory #edithistorycontainer");u.html(t),ZCScroll.customScroll(u,!0)},s=function(){var e="editmsghistory";$WC.$Win.isExist(e)&&$WC.$Win.destroy(e),UI.updateBanner(Resource.getRealValue("operation.failed"),3e3,!0)};Chat.getMsgHistoryTranscript(e,t,a,s)},getEditableLastMsg:function(e){var t=e.win().find("[msguid][mymsg=true][mtype=12]");if(0!==t.length){var i=MsgUtil.getMsgObjfromElem(t.last());return MsgUtil.isMsgEditable(i,e.getMessageOptions())?i:!1}}},"delete":function(){var e={};return{add:function(t,i){var a=MsgUtil.getTimefromMsgObj(i);"undefined"==typeof e[t]&&(e[t]={}),e[t][a]=i},get:function(t,i){return e[t]?e[t][i]:void 0},remove:function(t,i){e[t]&&delete e[t][i]},isExist:function(t,i){return e[t]?e[t].hasOwnProperty(i):void 0},createwin:function(e,t,i){$WC.$Dlg.create({id:"deletemessage",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-delete clr-red"></div>',header:Resource.getRealValue("info.message.delete.header")}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("info.message.delete.info1")]}),buttons:[{text:Resource.getRealValue("info.message.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Chat.deleteMessage(e,t,i)}}]})}}}(),fork:{createwin:function(e,t){var i=Template.forkChatHtml.replace(/{CHID}/g,e).replace(/{MSGUID}/g,t),a=ChatUI.exist[e];if(!$WC.$Win.isExist("forkchatwin")){var s=$WC.$Win.create({id:"forkchatwin","class":"adchtwin",closeoutside:!0,html:i});SearchField.init("createforkchat-usersuggest"),this.bindEvents(s),$("#chattitle").val(a.title+" "+Resource.getRealValue("message.option.fork.title"))}},bindEvents:function(e){var t="createforkchat-usersuggest-search-field";e.find("#includeall").on("click",function(){MessageOperations.fork.populateDefaultResult()}),e.find("#createforkchatbtn").on("click",function(){MessageOperations.fork.createForkedChat("createforkchat-usersuggest-select-field")}),e.on("click","[purpose='deleteimgnode']",function(){$(this).parents("[nodetype]").remove(),$WC.DivEditor.focus(t),MessageOperations.fork.populateDefaultResult(),$WC.$CUtil.isEmpty($("#createforkchat-usersuggest-select-field").html())&&$("#createforkchat-usersuggest").addClass("zcrchmcnt")}),e.find("#chattitle").on("focus",function(){$(this).removeClass("zcfdk_tmbzoom")}),e.find("#"+t).focus(),this.populateDefaultResult(),ZCScroll.customScroll($("#createforkchat-usersuggest-list"),!0)},search:function(e){var t=$.trim($("#createforkchat-usersuggest").attr("chid")),i=Participants.get(t),a=SearchField.getSelectedList("createforkchat-usersuggest-select-field");$("#createforkchat-usersuggest-list").html(""),$("#includeall").is(":checked")&&(a=a.concat(i.recipants));var s=SearchAgent.search({searchin:SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,ignorelist:a,listid:"createforkchat-usersuggest-list",val:e,contactshtml:Template.quickChatcontactHtml,orgcontactshtml:Template.quickChatcontactHtml,allstatuscontacts:!1});s||MessageOperations.fork.populateEmptyResult(),s&&$("#createforkchat-usersuggest-list").find("[uid]").length<10?$("#createcht-usersuggest-search-field").hide():$("#createcht-usersuggest-search-field").show()},handleKeyUp:function(e,t){var i=e.which;e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&($WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes("createforkchat-usersuggest-search-field")?$WC.$Win.destroy("forkchatwin"):SearchField.clearSearchField("createforkchat-usersuggest")),SearchField.hasNodes("createforkchat-usersuggest-list")||MessageOperations.fork.populateEmptyResult()},handleAction:function(e,t){var i=t.attr("uid"),a=Users.getName(i),s=t.attr("elemtype"),n='<div uid="'+i+'" elemtype="'+s+'" title="'+a+'" nodetype="@" class="dIB zcricnt posl"><img src="'+Users.getImgUrlById(i)+'"/><div class="msi-close posa dN cur" purpose="deleteimgnode"></div></div>';t.remove(),$WC.$CUtil.isEmpty(i)||($("#createforkchat-usersuggest-select-field").append(n),$("#createforkchat-usersuggest").removeClass("zcrchmcnt"),SearchField.clearSearchField("createforkchat-usersuggest"))},populateDefaultResult:function(){$WC.$Win.isExist("forkchatwin")&&this.search("*")},populateEmptyResult:function(){var e=$("#createforkchat-usersuggest-list"),t="quickchat.no.result";e.html(""),$WC.$CUtil.isEmpty($("#createforkchat-usersuggest-search-field").text())&&(t="quickchat.no.contact"),e.html('<div class="textcent clr6 zcnorst posa h35"><span>'+Resource.getRealValue(t)+"</span></div>")},createForkedChat:function(e){var t=$.trim($("#chattitle").val());if($WC.$CUtil.isEmpty(t))return void $("#chattitle").addClass("zcfdk_tmbzoom");var i=$.trim($("#createforkchat-usersuggest").attr("chid")),a=$.trim($("#createforkchat-usersuggest").attr("msguid")),s=Composer.parseEditor(e),n=ChatUI.exist[i],r=$("#includeall").is(":checked"),o=s.ulist.join();if($WC.$CUtil.isEmpty(t)&&(t=n.title+" "+Resource.getRealValue("message.option.fork.title")),s.ulist.length){var l={msguid:a,userids:o,title:t,includeparticipants:r,sid:WmsImpl.getSid()};$ZCAjx.ajax({url:"/v1/chats/"+i+"/fork",type:"POST",contentType:"application/json",data:l}),$WC.$Win.destroy("forkchatwin")}}},formatCustomMsgForOperations:function(e){var t=$WC.DivEditor.getNodes(e),i="";if(t.length>0){var a=$(t[0]).find(".msgtt"),s=$(t[0]).find(".zcdesc");a.length>0?i=a.text():s.length>0&&(i=s.text())}return i=MsgUtil.escape(i,!0)},formatMessageForEdit:function(e){var t="";return"undefined"==typeof e?(e=selectedmsgdiv.find('[msgtype="custommsg"]')[0],msg=MessageOperations.formatCustomMsgForOperations(e)):(t=MsgUtil.escape(Markdown.convertToActualMsg(e,!0),!0),msg=t.replace(/ /g,"  "),msg=Smiley.replace(msg,!0,!0),msg=MessageOperations.formatDisplayableMentionsforEdit(msg,e.parentElement.getAttribute("chid"))),msg=Smiley.convertAnimatedTo24(msg),msg=msg.replace(/\n/g,"<br>"),msg=msg.replace(/  /g,"&nbsp;")+"&#8203;"},formatDisplayableMentionsforEdit:function(e,t){var i=function(e){var t;return e=parseInt(e),t=e===Mentions.UserMention||e===Mentions.BotMention?"contact":e===Mentions.GroupMention?"group":e===Mentions.AvailableMention?"available":e===Mentions.ParticipantsMention?"participantsmention":"channel"};return e=MsgUtil.isNewMentionMsg(e)?$WC.Matcher.replaceWithFlag("zcatmention_v2",e,"g",function(e){var a=(new $CliqChatId(t),Mentions.getNewMentionObj(e,t)),s=i(a.type),n=$(Composer.getCreatedMentionMemberNode(a.mentionedid,s,"@",t,a.dname));return n.addClass("ellips"),n[0].outerHTML+"&nbsp;"}):$WC.Matcher.replace("zcatmention",e,function(e,a){var s=a.split(":"),n=s[0],r=i(s[1]),o=s[2],l=$(Composer.getCreatedMentionMemberNode(n,r,"@",t,o));return l.addClass("ellips"),l[0].outerHTML+"&nbsp;"}),e=$WC.Matcher.replace("addchatmember",e,function(e,t){var i=t.split(":"),a=i[0],s=$WC.$CUtil.decodeHTMLEntities(i.join(":"));s=Users.getName(a,s),s="+"+s;var n='<span uid="'+a+'" elemtype="contact" contenteditable="false" class="selusr" nodetype="@" title="'+s+'">'+s+"</span>";return n}),e=$WC.Matcher.replace("deletechatmember",e,function(e,t){var i=t.split(":"),a=i[0],s=$WC.$CUtil.decodeHTMLEntities(i.join(":"));s=Users.getName(a,s),s="-"+s;var n='<span uid="'+a+'" elemtype="contact" contenteditable="false" class="selusr" nodetype="@" title="'+s+'">'+s+"</span>";return n})},unsent:{resend:function(e,t){var i=$(t).parents().eq(0).find("[msgtype]")[0];MessageOperations.unsent.send(i,e),MessageOperations.unsent.removeExisting($(t).parents().eq(0),e)},resendall:function(e,t){for(var i=$(t).parents().eq(3).find(".msi-resend"),a=i.length,s=0;a>s;s++){var n=$(i[s]).parents().eq(0).find("[msgtype]")[0];MessageOperations.unsent.send(n,e),MessageOperations.unsent.removeExisting($(i[s]).parents().eq(0),e)}},remove:function(e,t){MessageOperations.unsent.removeExisting($(t).parents().eq(0),e)},removeExisting:function(e,t){$Util.removeMsginMsgArea(e),$("#"+t).find("#chatbody").perfectScrollbar("update")},resendoptions:function(e,t,i){var a=$(t).parent(),s=a.find(".chtpopup"),n=a.attr("id"),r=s.attr("id"),o=$(t).parents().eq(2).find(".msi-resend").length,l=s.find('[purpose="resendall"]');0===l.length&&o>1?s.find('[purpose="resend"]').after('<div purpose="resendall" title="'+Resource.getRealValue("message.option.retryall")+'">'+Resource.getRealValue("message.option.retryall")+"</div>"):l.length>0&&1>=o&&s.find('[purpose="resendall"]').remove,s.css("display","block"),Clickoutside.bind({srcid:n,destid:r,event:i})},getrepliedmsguid:function(e){for(var t=$WC.DivEditor.getNodes(e),i=0,a=t.length;a>i;i++)if(t[i].nodeType!==Node.TEXT_NODE){var s=t[i].nodeName;if("BLOCKQUOTE"===s&&"viewreplied"===t[i].getAttribute("purpose")){var n=t[i].innerHTML,e=$(n).find("[msgtime]"),r=e.attr("uid")+"_"+e.attr("msgtime");return r}}},send:function(e,t){var i=Markdown.convertToActualMsg(e,!0),a=this.getrepliedmsguid(e),i=$.trim($WC.DivEditor.removeBufferCharacters(i)),s=$Util.getSyncedCurrentTime();if(Chat.sendMessage(t,i,s,void 0,void 0,a),i=MsgUtil.escape(i,!0),i=Composer.wrapMentionMessage(i),i=MsgUtil.isChatMemberAdded(i)?MsgTemplate.getDisplayableAddition(i):i,i=MsgUtil.isChatMemberDeleted(i)?MsgTemplate.getDisplayableDeletion(i):i,i=Markdown.apply(i),a){var n=a.slice(a.indexOf("_")+1),r=$("#"+t).find("[mtype][msgtime='"+n+"']"),o='<blockquote class="quotedmsgdiv" purpose="viewreplied"><span class="msi-reply zcclr floatl"></span>'+MessageOperations.getFormattedRepliedMsg(r)+"</blockquote>";$WC.$CUtil.isEmpty(o)||(i=o+i)}var l={msg:i,sender:WmsImpl.getZuid(),time:s,msgid:s,chid:t},c=ChatUI.exist[t];return c.updateMsg(l,{isundelivered:!0}),c.toggleLinkPreview(!1),!0}}};var UserProfile={};UserProfile={currentuserid:"",currentLoadingCount:1,recentchatslimit:10,recentchatsautoloadingcount:10,recentchatsloadmore:!1,init:function(){this.currentchat=null,this.recentchatsloadmore=!1},createWithRecentChats:function(e,t){if("none"!==MainUI.container.find("#transcriptview").css("display")&&MainUI.Transcript.close(),this.create(e,t),"undefined"!=typeof t.recentchats)this.populateRecentChats(JSON.parse(t.recentchats));else{var i=Users.getName(e);MainUI.container.find("#userrecentchats").html('<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("chat.norecent",[i])+"</div></div>")}},create:function(e,t){this.init();var i=Contacts.get(e),a=Resource.getRealValue("common.offline");this.currentuserid=e,this.currentLoadingCount=1;var s=[],n=[];if($WC.$CUtil.isEmpty(t.designation)||s.push('<span class="prfgry"><span class="clr8">'+Resource.getRealValue("common.designation")+" : </span>"+$WC.$CUtil.processXSS(t.designation)+"</span>"),$WC.$CUtil.isEmpty(t.departmentname)||s.push('<span class="prfgry"><span class="clr8">'+Resource.getRealValue("common.departmentname")+" : </span>"+$WC.$CUtil.processXSS(t.departmentname)+"</span>"),t.reportingto&&s.push('<span class="clr8">'+Resource.getRealValue("common.reporting")+' : </span><span hover="true" uid="'+t.reportingto+'" elemtype="user" userid="'+t.reportingto+'"><a class="bluelink">'+Users.getName(t.reportingto,t.reportingto_fullname)+"</a></span>"),!$WC.$CUtil.isEmpty(t.timezone)){var r=$Date.getOtherZoneTime(t.timezone,t.timeoffset);n.push("<span>"+Resource.getRealValue("common.localtime")+' : </span><span class="prfgry">'+$WC.$CUtil.processXSS(r)+"</span>")}$WC.$CUtil.isEmpty(t.location)?$WC.$CUtil.isEmpty(t.country)||n.push("<span>"+Resource.getRealValue("common.country")+' : </span><span class="prfgry">'+$WC.$CUtil.processXSS(t.country)+"</span>"):n.push("<span>"+Resource.getRealValue("common.location")+' : </span><span class="prfgry">'+$WC.$CUtil.processXSS(t.location)+"</span>"),$WC.$CUtil.isEmpty(t.mobile)||n.push("<span>"+Resource.getRealValue("common.mobile")+' : </span><span class="prfgry">'+$WC.$CUtil.processXSS(t.mobile)+"</span>"),$WC.$CUtil.isEmpty(t.extension)||n.push("<span>"+Resource.getRealValue("common.extension")+' : </span><span class="prfgry">'+$WC.$CUtil.processXSS(t.extension)+"</span>");var o=s.join(' <span class="prfbar">|</span> '),l=n.join(' <span class="prfbar">|</span> '),c=Contacts.isMutual(e)||Users.isSameOrg(e)?i?i.emailid:t.emailid:"",d='<div class="prfhdr-rht"><div class="hdrsub"><div id="dname" operation="rename" uid="'+e+'" type="contact" contenteditable="true" class="mrgR10 zcprflnm" data-val="{DNAME}">{DNAME}</div>'+($WC.$CUtil.isEmpty(c)?"":'<span class="clr6 dIB">&#40;'+c+"&#41;</span>")+'<span class="prfbar zvta">|</span><span title="{STATUSMSG}" class="grayish ellips">{STATUSMSG}</span></div>{DESIGNATIONDETAILS}{OTHERDETAILS}</div><div class="prfhdr-rhtmn">{ICONS}</div>',u=MMChat.isCallIconAllowed()?'<div class="msi-call" operation="audiocall" title="'+Resource.getRealValue("videochat.audiocall")+'" userid="'+e+'"></div><div class="msi-video" operation="videocall" title="'+Resource.getRealValue("videochat.videocall")+'" userid="'+e+'"></div>':"",m='<div class="gpvrht-action">';(Contacts.isMutual(e)||Users.isSameOrg(e))&&(m+=(Contacts.isMutual(e)?'<div operation="hdelete" userid="'+e+'" class="msi-grpmbrdel floatr" title="'+Resource.getRealValue("contact.delete")+'"><span></span></div>':"")+'<span operation="createchat" userid="'+e+'" title="'+Resource.getRealValue("common.click.continue")+'" class="msi-grpcht floatr"></span>'),null===i||i.status!==$zcg.CON_REQACC&&i.status!==$zcg.CON_REMIND_ME_LATER?null!==i&&i.status===$zcg.CON_UNAPRD?m+='<span operation="hreinvite" userid="'+e+'" title="'+Resource.getRealValue("contact.reinvite")+'" class="msi-reinvite" ></span><div operation="hdelete" userid="'+e+'" class="msi-grpmbrdel floatr" title="'+Resource.getRealValue("contact.delete")+'"><span></span></div>':!Contacts.isMutual(e)&&Users.isSameOrg(e)&&(m+='<span operation="invite" userid="'+e+'" title="'+Resource.getRealValue("contact.invite")+'" class="msi-newchat"></span>'):m+='<span operation="reject" userid="'+e+'" title="'+Resource.getRealValue("contact.delete")+'" class="msi-grpmbrdel floatr"></span><span operation="accept" userid="'+e+'" title="'+Resource.getRealValue("common.accept")+'" class="msi-aprvl floatr"></span>',m+=u+"</div>",d=d.replace(/{DNAME}/g,$WC.Matcher.replace("escapeReplacementString",Users.getName(e,t.fullname))).replace(/{ICONS}/g,m).replace(/{STATUSMSG}/g,$WC.Matcher.replace("escapeReplacementString",i?Contacts.getStatusMsg(i.smsg,i.status):a)).replace(/{DESIGNATIONDETAILS}/g,$WC.$CUtil.isEmpty(o)?"":'<div class="usrprftxt">'+o+"</div>").replace(/{OTHERDETAILS}/g,$WC.$CUtil.isEmpty(l)?"":'<div class="usrprftxt">'+l+"</div>");var p=Template.UserView;p=p.replace(/{USERID}/g,e).replace(/{IMGURL}/g,Users.getImgUrlById(e,"original")).replace(/{STATUSCLASS}/g,Contacts.getStatusStyle(e,i?i.status:void 0)).replace(/{MOREDETAILS}/,$WC.Matcher.replace("escapeReplacementString",d));var h=$Util.createSafeElement(p,{});this.bindEvents(h),MainUI.createProfile(e,"contact",h)},bindEvents:function(e){e.on("click","[purpose='chathistoryrow']",function(e){var t=$(this),i=t.attr("chid");if(e.stopPropagation(),$("#transcriptviewholder").off("scroll").attr("hasbottommore","false"),"userrecentchatsloadmore"===t.attr("id"))UserProfile.loadMoreRecentChats();else if(UserProfile.currentchat!==i){var a=$("#userrecentchats");a.find("#userrecentchat"+UserProfile.currentchat).removeClass("sel"),a.addClass("prfui-sel"),t.addClass("sel"),MainUI.Transcript.load("UserProfile","UserProfile|closeTranscript|-1");var s=MainUI.container.find("#transcriptview");s.find("#transcritpviewoperation").empty(),s.find('[holder="transcriptviewtitle"]').empty();var n={chid:i,totime:(new Date).getTime(),unreadchat:t.hasClass("unread"),callback:UserProfile.handleTranscript,lineslimit:Chat.LINESLIMIT};ChatHistory.getTranscript(n),UserProfile.currentchat=i}}),e.find("#dname").on("mouseup focus blur keyup keydown",function(e){$Util.handleEditor(e,this,{focusclass:"zctlefcs",action:function(e,t){return Contacts.rename(e.attr("uid"),t),!0}})}),e.on("click","[operation]",function(){var e=$(this),t=e.attr("operation");if("audiocall"===t)MMChat.triggerAudioCall(e.attr("userid"),"search_userprofile");else if("videocall"===t)MMChat.triggerVideoCall(e.attr("userid"),"search_userprofile");else if("close"===t)UserProfile.close(UserProfile.currentuserid);else if("createchat"===t)ContactsList.reqForChat(e.attr("userid"));else if("hdelete"===t)ContactsList.doOperation(t,e.attr("userid"));else if("accept"===t||"reject"===t)Contacts.acceptorreject(e.attr("userid"),t),UserProfile.close(UserProfile.currentuserid);else if("hreinvite"===t||"invite"===t){var i=e.attr("userid"),a=Users.getEmailId(i);Contacts.add("zoho",a)}}),e.on("click","a",function(e){e.preventDefault()}),e.find("[domtype='body']").on("scroll",function(){if(UserProfile.recentchatsloadmore&&ZCScroll.isScrollNearBottom(this)){var t=$(this),i=t.find("#userrecentchats");if(0===i.find("#userrecentchatsloadmore").length){var a=UserProfile.currentLoadingCount<=UserProfile.recentchatsautoloadingcount;i.append('<div id="userrecentchatsloadmore" purpose="chathistoryrow" class="hstrset"><div class="hst-lodngmn"><div class="hst-lodngsb">'+(a?Resource.getRealValue("common.loading")+'<span class="hst-loadng"></span>':Resource.getRealValue("common.click.more"))+"</div></div></div>"),a&&UserProfile.loadMoreRecentChats()}}0===this.scrollTop?e.find('[domtype="bodyheader"]').removeClass("zcborsh"):e.find('[domtype="bodyheader"]').addClass("zcborsh")}),e.find("#file"+this.currentuserid).on("change",function(){Chat.sendFile($(this).parent()[0])})},populateRecentChats:function(e){var t=e.length,i="",a=t>this.recentchatslimit?this.recentchatslimit:t;this.recentchatsloadmore=t>=this.recentchatslimit+1;var s=MainUI.container.find("#profileview[profileid='"+this.currentuserid+"']"),n=s.find("[chid]").length>0;if(t>0)for(var r=0;a>r;r++)0==s.find("[chid="+e[r].chatid+"]").length&&(i+=HistoryUI.getRowforChat(e[r],"userrecentchat"));if(s.find("[domtype='bodyheader']").html('<div class="floatl prf-title"><span class="floatl">'+Resource.getRealValue("chat.recent")+"</span></div>"),n){var o=s.find("#userrecentchats");o.find("#userrecentchatsloadmore").remove(),o.append(i),ZCScroll.resetScroll($("#profileview").find("[domtype='body']"))}else{if(0===$.trim(i).length){var l=Users.getName(this.currentuserid);i='<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("chat.norecent",[l])+"</div></div>"}s.find("#userrecentchats").html(i),ZCScroll.customScroll($("#profileview").find("[domtype='body']"))}},loadMoreRecentChats:function(){this.currentLoadingCount++;var e={lim:this.recentchatslimit,recipient:this.currentuserid,successcallback:function(e){UserProfile.populateRecentChats(e.data.chats)}},t=MainUI.container.find("#profileview[profileid='"+this.currentuserid+"']").find("[domtype='body']").find("[lmtime]").last().attr("lmtime");"undefined"!=typeof t&&(e.totime=t),ChatHistory.getAll(e,!0)},handleTranscript:function(e,t,i,a,s,n){if(UserProfile.currentchat===i){var r=MainUI.container.find("#transcriptview"),o=r.find("#transcriptviewholder");if(r.find("#transcritpviewoperation").empty(),o.find("#loadingoldmsgs").remove(),e){if("undefined"==typeof t)o.html('<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("chat.history.empty")+"</div></div>"),o.removeAttr("chid");else{MainUI.container.find("#userrecentchat"+i).removeClass("unread"),r.find("[holder='transcriptviewtitle']").text($("#userrecentchattitle"+i).text());var l={dom:o,chid:i,origin:"userProfile"},c=MsgUtil.formatTranscript(t,l);if(ChatUI.updateFirstMsgOffsetValue(s,a,o),MsgUtil.updateTranscript(o,c,a,s),a||s||!n)ChatUI.scrollToMsgView(s,a,o);else{var d=n.split("|"),u=d[1]+"_"+d[2];$Util.scrollToMsgInCurrentTranscriptView(u,o,i)}o.attr("chid",i);var m=$("#userrecentchats #userrecentchat"+i),p=0===parseInt(m.attr("removed"))?'<div class="zcflt_btn"><div class="zchovrcht" operation="continue" chid="'+i+'" operationfor="chat">'+Resource.getRealValue("common.continue")+"</div></div>":"";r.find("#transcritpviewoperation").html(p),MainUI.Transcript.resize(),ZCScroll.resetScroll(o[0])}clearTimeout($Util.ontranscroll),$Util.handleTransViewScroll(r),$Util.animateBtnTransView(r),o.off("scroll").on("scroll",function(){if(i&&ChatUI.hasLoadMoreMsgs(o)){var e={},t='<div id="loadingoldmsgs" class="hst-loadngmn"><div class="hst-loadng"></div></div>';if(ZCScroll.isScrollUp(o[0])){o.prepend(t);var a=o.find("[mtype]").first().attr("msgtime");e={totime:parseInt(a)-1}}else{o.append(t);var s=o.find("[mtype]").last().attr("msgtime");e={fromtime:parseInt(s)+1}}var n={chid:i,callback:UserProfile.handleTranscript,lineslimit:Chat.LINESLIMIT};n=$.extend({},e,n),ChatHistory.getTranscript(n)}Mentions.captureAndRead(o,"mentionrecentchat"),clearTimeout(ChatUI.scrolltimer),ChatUI.scrolltimer=setTimeout(function(){ChatUI.loadVisibleImages(o[0])},$zcg.ORIGINALIMG_LOAD_TIMEOUT)})}else o.html('<div class="emcht-inftxtmn"><span operation="transcriptviewclose" class="msi-close cclose"></span><div class="emcht-inftxt">'+Resource.getRealValue("recentchats.get.error",Users.getName(UserProfile.currentuserid))+"</div></div>"),o.removeAttr("chid");0===o.scrollTop()&&ChatUI.loadVisibleImages(o[0])}},closeTranscript:function(){var e=$("#userrecentchats");return UserProfile.currentchat=null,e.find(".sel").removeClass("sel"),e.removeClass("prfui-sel"),$("#transcriptview").hide(),MainUI.handleIframes("transcriptviewholder"),!0},close:function(e){this.currentuserid===e&&MainUI.close("profileview")},handleClose:function(){}};var UserInfo=function(){var e=function(e){var e=$(e);e.on("click",'[purpose="search"]',function(e){var i=this;e.target.getAttribute("documentclick")||(t(e,$(i)),e.stopPropagation())}),e.on("click","[operation]",function(){var e=$(this);ContactsList.doOperation(e.attr("operation"),e.attr("uid"))})},t=function(e,t){var a=t.attr("elemtype"),s=t.attr("data-key");if("department"===a){var n=t.text();S(s,n)}"contact"===a&&i(s,"contact"===t[0].id,t)},i=function(e,t,i){var s,n=Users.getInfo(e)||Contacts.get(e),r=i?i.text():n.dname,o=Contacts.getDisplayName(e)||r,l=a(e,o);if(t){var c=i.closest("#departmentdetails");c.find("#profileinfo").remove(),c.append(l).addClass("nav"),s=c.closest('[type="popup"]')}else s=p({id:"userinfo"+e,header:$WC.template.replace(A("header"),{UID:e,TYPE:"contact",NAME:$WC.$CUtil.processXSS(o)}),uid:e,html:l});Users.isAdditionalInfoExist(e)||Contacts.isBotId(e)||C(e,s),R(s),f(e,i),ZCScroll.resetScroll(s.find("#profileinfo"))},a=function(e,t){var i=(Users.getInfo(e),s(e,i,t)),a="",o="";return userinfo&&Users.isAdditionalInfoExist(e)?(a=n(e)+u(e),o=c(e)):a=Contacts.isBotId(e)?r(e):GSUI.getLoadingHtml(),$WC.template.replace(i,{ADDITIONAL_INFO:a,MEDIA:o},"InSecureHTML")},s=function(e,t,i){t=t||A("userheader");var a="",s=Contacts.isBotId(e);if(s){var n=Bots.getObject(e)||Contacts.get(e);a=$WC.template.replace(t,{UID:e,DNAMEVAL:$WC.$CUtil.processXSS(n.name),IMGURL:Bots.getImgUrl(e),STATUSCLASS:"",SCODE:"",DEPTINFO:Contacts.getBotStatusMsg(e)})}else a=$WC.template.replace(t,{UID:e,DNAMEVAL:(Contacts.getDisplayName(e)||i)+l(e),SCODE:Contacts.getStatus(e),IMGURL:Users.getImgUrlById(e,"thumb"),STATUSCLASS:Contacts.isExist(e)?Contacts.getStatusStyle(e):"",DEPTINFO:d(e)},"InSecureHTML");return a},n=function(e,t,i){t=t||A("add_info");var a=(Users.getInfo(e),Users.getEmailId(e)),s=o(e,i);return t=HoverDetails.getinfoHtml(e,{addinfo:t,ignoretrim:!0,getstatus:!0,getlocation:!0}).replace(/{DESIGNATION}/g,"").replace(/{DEPARTMENT}/g,"").replace(/{DEPARTMENT_ID}/g,"").replace(/{UID}/g,e).replace(/{COUNTRY}/g,""),$WC.template.replace(t,{DNAMEVAL:Users.getName(e),MAILIDVAL:a?'<a class="cur clr0" href="mailto:'+a+'">'+a+"</a>":"",REPORTINGTOHTML:s},"InSecureHTML")},r=function(e,t){if(t=t||A("botaddinfo"),ChatBot.isBot(MyBots.getChid(e)))t=t.replace(/{DESC}/g,Resource.getRealValue("chat.bot.hoverdesc")).replace(/{EXTN}/g,"").replace(/{CREATOR-NAME}/g,"").replace(/{SUBSC-USERS}/g,"").replace(/{API}/g,"");else{var i=Bots.getObject(e),a='<span hover="true" uid="'+i.creator+'" elemtype="user" userid="'+i.creator+'"><a class="bluelink">'+i.creator_name+"</a></span>";t=t.replace(/{DESC}/g,$WC.$CUtil.processXSS(i.desc)).replace(/{CREATOR-NAME}/g,a).replace(/{SUBSC-USERS}/g,i.usercount),t=HoverDetails.getinfoHtml(e,{addinfo:t,ignoretrim:!0,getstatus:!0})}return t},o=function(e,t){var i=Users.getInfo(e),a="";if(!i)return a;if(i.reportingto){if(t)var s='<span hover="true" uid="'+i.reportingto+'" elemtype="user" userid="'+i.reportingto+'"><a class="bluelink">'+Users.getName(i.reportingto,i.reportingto_fullname)+"</a></span>";else var s='<a data-key="'+i.reportingto+'" purpose="search" elemtype="contact" class="bluelink cur">'+Users.getName(i.reportingto,i.reportingto_fullname)+"</a>";a=$WC.template.replace(A("reportingtohtml"),{REPORTING:s},"InSecureHTML")}return a},l=function(e){var t=Users.getCheckinStatus(e);return'<span id="checkin_status" uid="'+e+'" class="font14 checkin_status zcpredot '+t+'">'+t+"</span>"},c=function(e){Contacts.getStatus(e);if(WmsImpl.isLocalUser(e)||!Users.isSameOrg(e)&&!Contacts.isMutual(e))return"";var t=A("mediahtml");return t=$WC.template.replace(t,{audiohtml:MMChat.isAudioCallEnabled()?A("audiohtml"):"",videohtml:MMChat.isVideoCallEnabled()?A("videohtml"):"",startchathtml:A("startchathtml")},"InSecureHTML"),$WC.template.replace(t,{UID:e,DISABLE:MMChat.isCallIconAllowed()?!1:!0})},d=function(e){var t=Users.getInfo(e)||{},i=$WC.$CUtil.processXSS(t.departmentname||""),a=$WC.$CUtil.processXSS(t.designation||""),s="",n=A("deptinfo");return i&&(i='<span class="clickable" elemtype="department" dataval="'+t.department_id+'" data-key="'+t.department_id+'" purpose="search" name="'+i+'" data-purpose="profview">'+i+"</span>"),!Users.isAdditionalInfoExist(e)||i||a?(i&&a&&(s='<em class="splt"></em>'),$WC.template.replace(n,{DEPTNAME:i,DESGNAME:a,SPLTHTML:s,UID:e},"InSecureHTML")):Contacts.getEmailId(e)},u=function(e){return!Contacts.isExist(e)||WmsImpl.isLocalUser(e)?"":'<div class="msi-delete" uid="'+e+'" operation="hdelete"><span>'+Resource.getRealValue("contact.delete")+"</span></div>"},m=function(e,t,i,a){var s=t;Department.getDepartmentUsers(t,e,function(t){var a=Department.getDepartmentInfo(e)||{},n=a.lead_info,r="";n&&n.name&&(r=$WC.template.replace(A("leadinfo"),{$LEADNAME:$WC.$CUtil.processXSS(n.name),$LEADID:n.zuid}));var o=$WC.template.replace(A("departmentuserlist"),{$DEPTNAME:$WC.$CUtil.processXSS(s),$DEPTID:e,$DEPTMEMBERS:t,$LEADINFO:r},"InSecureHTML");"function"==typeof i&&i(o)},a)},p=function(t){var i=$("#zcwindows").find("#"+t.id);if(i.length)return h(i),f(t.uid,i.find("#hdr"+t.uid)),i;for(var i=$WC.$Win.create({id:t.id,header:g(t.header),"class":"userdetail rhsoverly",additionalattrs:"userinfo",aligncenter:!1,closeoutside:!0,html:t.html,closefn:function(){v()}}),a=i.find("#winheader").children(),s=0;s<a.length-1;s++)a[s].setAttribute("purpose","search");return e(i),i},h=function(e){for(var t=$("#zcwindows").find('[type="popup"]'),i=t.length-1;i>=0;i--){var a=t[i].id;if(a===e[0].id)return;$(t[i]).remove()}},g=function(e){var t=$("#zcwindows").children().last(),i=t.find("#winheader");return i.length?i.append(e)[0].outerHTML:'<div id="winheader" class="winheader">'+e+"</div>"},f=function(e,t){if(e="hdr"+e,t&&t.attr("id")===e)for(var i=t.parent(),a=i.children(),s=a.length-1;s>0;s--){var n=a[s];if(!n||n.id===e)return;$("#"+n.id).remove()}},v=function(){for(var e=$("#zcwindows").find("[userinfo]"),t=0;t<e.length;t++)$WC.$Win.destroy(e[t].id)},C=function(e,t){I({uid:e,container:t,callback:function(e,i){t.find("#zc_srch_ldngtxt")[0].outerHTML=i+u(e),R(t)}})},y=function(e,t){t.html(c(e))},b=function(e,t){t.find("#contactmailid"+e).html(d(e))},E=function(e,t){y(e,t.find("#media"+e)),b(e,t),Users.updateAvailabilityStatus(e,t)},I=function(e){var t=e.uid;if(Contacts.isBotId(t))return void e.callback(t,r(t,e.botinfohtml));var i=Users.getInfo(t);i&&Users.isAdditionalInfoExist(t)?(e.callback(t,n(t,e.userinfohtml,e.reportingtohover)),E(t,e.container),Users.checkAndUpdateAvailabilityStatus(t,e.container)):(clearTimeout(this.profiletimer),this.profiletimer=setTimeout(function(){PeopleServerData.getProfileInfoFromServer(t,function(i){t===i&&(e.callback(i,n(i,e.infohtml,e.reportingtohover)),E(i,$(e.container)))})},500))},T=function(e,t){var i=Department.getDepartmentInfo(t)||{},a=i.lead_info;(!a||$WC.$CUtil.isEmptyObject(a))&&PeopleServerData.getDepartmentLeadName(t,function(){var i=Department.getDepartmentInfo(t).lead_info;i&&i.name&&e.find("#leadinfo").html($WC.template.replace(A("leadinfo"),{$LEADNAME:i.name,$LEADID:i.zuid}))})},S=function(e,t){m(e,t,function(i){var a=p({id:"userinfo"+e,header:$WC.template.replace(A("header"),{UID:e,TYPE:"department",NAME:$WC.$CUtil.processXSS(t)}),uid:e,html:i});a.find("#profileinfo").remove(),ZCScroll.resetScroll(a.find("#zcdeplist")),f(e,a.find("#hdr"+e))})},R=function(e){for(var t=e.find("[prof-header]"),i=t.length,a=0;i>a;a++)for(var s=t[a],n=s.querySelectorAll("[prof-val]"),r=0;r<n.length&&!n[r].innerHTML;r++)r===n.length-1&&(s.querySelector("[header]").innerHTML="",s.removeAttribute("prof-header"));e.find("[prof-header]").last().addClass("bornone")},A=function(e){var t={userheader:'<div id="profileinfo" class="font14 hvprofileinfo"><div class="zcbsprfl"><div class="zcsrpsac posrel cur"><img src="{{IMGURL}}" imgsrc="{{IMGURL}}" documentclick="viewprofileimage" uid="{{UID}}" class="mrgR18" / ><div id="contactscode{{UID}}" scode ="{{SCODE}}" class="{{STATUSCLASS}}"></div></div><div class="usrinfo ellips"><span id="contactdname{{UID}}" class="ellips font17 bold">{{DNAMEVAL}}</span><div id="contactmailid{{UID}}" class="glbsrctxt zclin18 margT15 ellips">{{DEPTINFO}}</div></div><div id="media{{UID}}">{{MEDIA}}</div></div><div>{{ADDITIONAL_INFO}}</div></div>',add_info:'<div class="prfinfo" prof-header><div class="bold font14 mrgT15" header>'+Resource.getRealValue("globalsearch.contact")+'</div><div class="posrel pair"><div class="prf-adinfo" prof-val>{{DNAMEVAL}}</div><div>'+Resource.getRealValue("common.name")+'</div></div><div class="posrel pair"><div class="prf-adinfo" prof-val>{{MAILIDVAL}}</div><div>'+Resource.getRealValue("settings.noti.email")+'</div></div><div class="posrel pair"><div class="prf-adinfo zc-srch-contct" prof-val>{MOBILE}</div><div class="">'+Resource.getRealValue("common.mobile")+'</div></div><div class="posrel pair"><div class="prf-adinfo zc-srch-contct" prof-val>{EXTN}</div><div>'+Resource.getRealValue("common.extension")+'</div></div></div><div class="prfinfo" prof-header><div class="bold font14 mrgT15" header>'+Resource.getRealValue("smiley.work")+'</div><div class="posrel pair"><div class="prf-adinfo" prof-val>{DESIGNATION}</div><div>'+Resource.getRealValue("common.designation")+'</div></div><div class="posrel pair"><a class="prf-adinfo bluelink" data-key="{DEPARTMENT_ID}" elemtype="department" purpose="search" data-purpose="profview" prof-val>{DEPARTMENT}</a><div>'+Resource.getRealValue("common.departmentname")+'</div></div>{{REPORTINGTOHTML}}<div class="posrel pair"><div class="prf-adinfo" prof-val>{WORKLOCATION}</div><div>'+Resource.getRealValue("common.worklocation")+'</div></div><div class="posrel pair"><div class="prf-adinfo" prof-val>{EMPID}</div><div>'+Resource.getRealValue("common.empid")+'</div></div><div class="posrel pair"><div class="prf-adinfo" prof-val>{STATUSDIV}</div><div>'+Resource.getRealValue("common.status")+'</div></div></div><div class="prfinfo bornone" prof-header><div class="bold font14 mrgT15" header>'+Resource.getRealValue("globalsearch.location")+'</div><div class="posrel pair"><div class="prf-adinfo" prof-val>{COUNTRY}</div><div class="">'+Resource.getRealValue("common.country")+'</div></div><div class="posrel pair"><div class="prf-adinfo" prof-val>{LOCALTIME}</div><div class="">'+Resource.getRealValue("common.localtime")+'</div></div></div><div class="zcflt_btn" uid={UID} operation="button" data-purpose="inviteuser">{INVITEUSER}</div>',botaddinfo:'<div class="prfinfo bornone"><div class="posrel pair"><div class="prf-adinfo zc-srch-contct">{EXTN}</div><div>'+Resource.getRealValue("app.app")+'</div></div><div class="posrel pair"><div class="prf-adinfo">{CREATOR-NAME}</div><div>'+Resource.getRealValue("channel.role.2")+'</div></div><div class="posrel pair"><div class="prf-adinfo">{DESC}</div><div>'+Resource.getRealValue("common.desc")+'</div></div><div class="posrel pair"><div class="prf-adinfo zc-srch-contct">{SUBSC-USERS}</div><div>'+Resource.getRealValue("globalsearch.bot.subscribed")+'</div></div><div class="posrel pair"><div class="prf-adinfo">{API}</div><div>'+Resource.getRealValue("channel.restapi.endpoint")+'</div></div></div><div class="zcflt_btn" uid={UID} operation="button" data-purpose="inviteuser">{INVITEUSER}</div>',mediahtml:'<div class="gsmediacon">{{audiohtml}}{{videohtml}}{{startchathtml}}</div>',audiohtml:'<div id="media" class="mrgR15 call" media-disable="{{DISABLE}}"><div class="msi-call" action="audiocall" documentclick="user-profile-actions" title="'+Resource.getRealValue("videochat.audiocall")+'" uid={{UID}}></div></div>',videohtml:'<div id="media" class="mrgR15 call video" media-disable="{{DISABLE}}"><div class="msi-video" action="videocall" documentclick="user-profile-actions" title="'+Resource.getRealValue("videochat.videocall")+'" uid={{UID}}></div></div>',startchathtml:SecurityManager.hasPermission(Modules.DirectMessage)?'<div id="media" class="mrgR15 call chat"><div class="msi-chat" action="startchat" documentclick="user-profile-actions" title="'+Resource.getRealValue("common.click.continue")+'" uid={{UID}}></div></div>':"",reportingtohtml:'<div class="posrel"><div class="prf-adinfo">{{REPORTING}}</div><div id="repheader">'+Resource.getRealValue("common.reporting")+"</div></div>",departmentuserlist:'<div id="departmentdetails"><div class="departmentheader"><div class="departmentname font16 bold" name="{{DEPTNAME}}">{{DEPTNAME}}<div id="leadinfo" class="font14">{{LEADINFO}}</div></div></div><div id="zcdeplist" class="zcdeplist">{{DEPTMEMBERS}}</div></div>',leadinfo:'<span class="font14">'+Resource.getRealValue("globalsearch.lead")+': </span><span hover="true" uid="{{LEADID}}" elemtype="user"><a class="bluelink">{{LEADNAME}}</a></span>',deptinfo:'<div class="deptinfo"><span id="deprt{{UID}}" class="posl">{{DEPTNAME}}</span>{{SPLTHTML}}<span id="desig{{UID}}" class="posl">{{DESGNAME}}</span></div>',header:'<span id="hdr{{UID}}" data-key="{{UID}}" elemtype="{{TYPE}}" purpose="search">{{NAME}}</span>'};return t[e]};return{getUserHeaderHTML:s,updateUserDetails:I,createUserRHSView:i,checkAndRemoveEmptyHeader:R,destroyView:v,getMediaHtml:c,getDepartmentMembersHTML:m,updateLeadInfo:T}}(),ParticipantsWin={},ParticipantsAddWin={},ParticipantsWin={chid:"",id:"",deletemember:!1,invitemember:!1,createModelWindow:function(e,t,i,a){if("undefined"==typeof Channels.AllowedUsers[t]){var s=Channels.getByChid(t);Channels.isExternalChannel(s)&&(Channels.isAdmin(s)||Channels.isSuperAdmin(s))&&Channels.getAllowedUsers(s.oc_id,function(e){Channels.AllowedUsers[t]=e,ParticipantsWin.repopulateParticipants()})}if(this.chid=t,this.id=e,this.deletemember=i,this.invitemember=a,!$WC.$Win.isExist(e)){var n=Template.participantsHtml.replace(/{ID}/g,e).replace(/{SELECTEDFEILD}/g,"").replace(/{INVITEMEMBER}/g,a?'<div class="zcrtchtcl cur zcadptscnt mrgL20" purpose="addmem"><div class="msi-plus zcadprts" title="'+Resource.getRealValue("channel.action.6")+'"></div><div class="adchtrht mrgL10 dIB paddT10">'+Resource.getRealValue("channel.action.6")+"</div></div>":""),r=$WC.$Win.create({id:e,"class":"chtwinparts adchtwin",closeoutside:!0,html:n});$("#"+e+"-usersuggest-search-field").focus();{ChatUI.exist[t]}ZCScroll.customScroll($("#"+e+"-usersuggest-list"),!0),this.bindEvents(e,t,r),this.repopulateParticipants()}},repopulateParticipants:function(){if($WC.$Win.isExist("participants")){{var e=ParticipantsWin.chid,t=ParticipantsWin.id;ChatUI.exist[e]}Participants.get(e).hasAllParticipants()?(this.populateDefaultResult(t),ChatUI.loadVisibleImages($("#"+t+"-usersuggest-results")[0])):($("#participants-usersuggest-list").html('<div class="zcldng"></div>'),Chat.getParticipants(e,!0))}},bindEvents:function(e,t,i){SearchField.init(e+"-usersuggest");var a=ChatsList.getTitle(t);i.find("#"+e+"title").html('<div class="zcinhds ellips">'+a+"</div>"),i.on("click","[purpose]",function(s){s.stopPropagation();var n=$(this).attr("purpose");if("addmem"===n){var r=i.find("#"+e+"-usersuggest-search-field").text();SearchField.clearSearchField(e+"-usersuggest"),ParticipantsAddWin.createModelWindow("add"+e,t,a,r)}}),i.find("#participants-usersuggest-list").on("scroll",function(){ChatUI.loadVisibleImages(this)}),i.find("#participantstitle").on("click mouseup focus blur keyup keydown",function(e){if(ChatUI.isExist(t)){{var a=ChatUI.exist[t];e.type}a.isGroupChat()&&!a.isChannel()&&("click"===e.type&&i.find("#participantstitle").attr("contenteditable","true").focus(),$Util.handleEditor(e,this,{select:!0,focusclass:"zctlefcs",action:function(e,i){Chat.setTitle(t,i),a.updateTitle(i)}}))}})},search:function(e){var t=this.id,i=ChatUI.exist[this.chid],a=i.isChannel()?!0:"",s=$("#"+t+"-usersuggest-results");$("#"+t+"-usersuggest-list").html('<div class="zcldng"></div>');var n=SearchAgent.search({searchin:SearchAgent.PARTICIPANTS,val:e,listid:t+"-usersuggest-list",participantshtml:Template.participantscontactHtml,chid:this.chid,allstatuscontacts:!0,deletemember:this.deletemember,categorize:a,scrlcontainer:$("#"+t+"-usersuggest-list")});if(n)ZCScroll.scrollTop(s,0),ChatUI.loadVisibleImages(s[0]),ChatUI.exist[this.chid].isOnetoOneChat()&&$("#"+t+"-usersuggest-list").find("[purpose='delmem']").remove();else{var r=Channels.getByChid(this.chid);Channels.isTeamChannel(r)?this.populateEmptyResultforTeamChannel(t,r):this.populateEmptyResult(t)}},handleKeyUp:function(e,t){var i=e.which,a=this.id;e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&("block"===$("#hover").css("display")?HoverDetails.hide():$WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes(a+"-usersuggest-search-field")?$WC.$Win.destroy(a):SearchField.clearSearchField(a+"-usersuggest"));var s=$WC.DivEditor.removeBufferCharacters($("#"+a+"-usersuggest-search-field").text());$WC.$CUtil.isEmpty(s)&&this.populateDefaultResult(a),SearchField.hasNodes(a+"-usersuggest-list")||this.populateEmptyResult(a)},handleAction:function(e,t){var i=$(e.target).attr("purpose"),a=$(e.target).attr("uid"),s=$(e.target).attr("hover"),t=$(e.target);if($("#rolechangedropdown").is(":visible")&&"changerole"!=i&&(Clickoutside.handleClickOnChild(e,"rolechangedropdown"),$("[purpose='changerole']").removeClass("zcrleddsel")),"true"===s)e.stopPropagation(),HoverDetails.show(t,!1);else if("addcontact"===i){var n=$(e.target).attr("uid"),r="zoho";Contacts.add(r,n,void 0,void 0,ParticipantsWin.handleContactAction)}else if("accept"===i){var n=$(e.target).attr("uid");Contacts.acceptorreject(n,i,ParticipantsWin.handleContactAction)}else if("delmem"===i){{ChatUI.exist[this.chid]}$Util.showChatDeleteMemberAlert(this.chid,Users.getName(a),[a])}else if("changerole"===i){var o=t.attr("sameorguser");this.handleChannelRoleOption(!0,"",o,t,e)}else"changeassuperadmin"===i?this.changeChannelUserRole(t,0,e):"changeasadmin"===i?this.changeChannelUserRole(t,1,e):"changeasmoderator"===i?this.changeChannelUserRole(t,3,e):"changeasparticipants"===i&&this.changeChannelUserRole(t,4,e)},populateDefaultResult:function(e){if($WC.$Win.isExist(e)){var t=$WC.DivEditor.removeBufferCharacters($("#"+e+"-usersuggest-search-field").text());this.search($WC.$CUtil.isEmpty(t)?"*":t)}},populateEmptyResult:function(e){var t=$("#"+e+"-usersuggest-list"),i="quickchat.no.result";t.html(""),$WC.$CUtil.isEmpty($("#"+e+"-usersuggest-search-field").text())&&(i=""),t.html('<div class="textcent clr6 zcnorst posa h35"><span>'+Resource.getRealValue(i)+"</span></div>")},populateEmptyResultforTeamChannel:function(e,t){var i=$("#"+e+"-usersuggest-list"),a="quickchat.no.resultteamchannel",s=Resource.getRealValue(a),n=[];for(key in t.scid_name)n.push(t.scid_name[key]);s=s.replace("$1",n.toString()),i.html(""),$WC.$CUtil.isEmpty($("#"+e+"-usersuggest-search-field").text())&&(a=""),i.html('<div class="textcent clr6 zcnorst posa h35"><span>'+s+"</span></div>")},updateChannelParticipantsUI:function(e){e?Chat.getParticipants(this.chid,!0):$WC.$Win.isExist(this.id)&&this.populateDefaultResult("participants")},handleChannelRoleOption:function(e,t,i,a,s){function n(e){var t=Contacts.isMutual(e),i=Contacts.get(e),a=i?parseInt(i.status):0;return!(t||a===$zcg.CON_UNAPRD||WmsImpl.isAnnonUser(e))}var r,i,o=Channels.getChannelId(this.chid),l=Channels.getObject(o),c="",d="";if(e)c=a.attr("uid"),d=parseInt(a.attr("currentrole")),r=n(c),i=a.attr("sameorguser");else if(c=t.zuid,d=parseInt(t.currentrole),r=n(c))return!0;var u=(Channels.isUserAllowedtoChangeRole(l,d),Channels.isUserAllowedtoChangeRole(l,Channels.ROLES.SUPER_ADMIN,d,i)),m=Channels.isUserAllowedtoChangeRole(l,Channels.ROLES.ADMIN,d,i),p=Channels.isUserAllowedtoChangeRole(l,Channels.ROLES.MODERATOR,d,i),h=Channels.isUserAllowedtoChangeRole(l,Channels.ROLES.PARTICIPANT,d,i),g=Channels.isUserAllowedtoChangeRole(l,Channels.ROLES.ALLOWED_USER,d,i);if(!e)return u||m||p||h||g?!0:!1;$("[purpose='changerole']").removeClass("zcrleddsel"),$("[purpose='roledropdown']").remove(),a.addClass("zcrleddsel");var f="",v=r?'<div uid="'+c+'" purpose="addcontact" title="'+Resource.getRealValue("contact.add")+'">'+Resource.getRealValue("contact.add")+"</div>":"",C=u?'<div class="ellips" purpose="changeassuperadmin" title="'+Resource.getRealValue("channel.role.makeas.superadmin")+'" uid="'+c+'">'+Resource.getRealValue("channel.role.makeas.superadmin")+"</div>":"",y=m?'<div class="ellips" purpose="changeasadmin" title="'+Resource.getRealValue("channel.role.makeasadmin")+'" uid="'+c+'">'+Resource.getRealValue("channel.role.makeasadmin")+"</div>":"",b=p?'<div class="ellips" purpose="changeasmoderator" title="'+Resource.getRealValue("channel.role.makeasmoderator")+'" uid="'+c+'">'+Resource.getRealValue("channel.role.makeasmoderator")+"</div>":"",E=h?'<div class="ellips" purpose="changeasparticipants" title="'+Resource.getRealValue("channel.role.makeasparticipants")+'" uid="'+c+'">'+Resource.getRealValue("channel.role.makeasparticipants")+"</div>":"",I=g?'<div uid="'+c+'" title="'+Resource.getRealValue("chat.remove.participant")+'" purpose="delmem">'+Resource.getRealValue("common.remove")+"</div>":"";f='<div id="rolechangedropdown" purpose="roledropdown" class="zchrlchg">'+v+C+y+b+E+I+"</div>",a.append(f),Clickoutside.bind({srcid:a.attr("id"),destid:"rolechangedropdown",event:s,callback:function(){$("[purpose='changerole']").removeClass("zcrleddsel")}}),this.displayTopPosition("rolechangedropdown",a.attr("id"),"participants-usersuggest-results")},changeChannelUserRole:function(e,t,i){var a=Channels.getChannelId(this.chid),s=e.attr("uid");$("#rolechange"+s).before('<div class="msi-tickcircle zcrldng"></div>'),Channels.changeRoles(a,s,t),Clickoutside.handleClickOnChild(i,"rolechangedropdown")},checkParticipantsWinExits:function(){return $WC.$Win.isExist(this.id)?!0:void 0},participantsWinExitsAndisChannel:function(){var e=ChatUI.exist[this.chid];return ParticipantsWin.checkParticipantsWinExits()&&e.isChannel()?!0:!1},displayTopPosition:function(e,t,i){var a=$("#"+t),e=$("#"+e),i=$("#"+i),s=a.offset().top-i.offset().top+a.height()+e.height();i.height()>s?e.removeClass("zcdrptop"):e.addClass("zcdrptop")},handleContactAction:function(e,t){var i=$("#participants");if("block"===i.css("display")){var a=i.find("#participants-usersuggest-list #participants");if(!$WC.$CUtil.isEmpty(a[0])){var s=a.children('[uid="'+e+'"]');if(!$WC.$CUtil.isEmpty(s[0])){var n=s.find('[purpose="'+t+'"]');"addcontact"==t?n.removeAttr("title").removeAttr("purpose").attr("class","zcddivted").text(Resource.getRealValue("contact.invited")):"accept"==t&&n.remove()}}}},handleStatusChange:function(e){var t=$("#participants");if("block"===t.css("display")){var i=t.find("#participants-usersuggest-list #participants");if(!$WC.$CUtil.isEmpty(i[0])){var a=i.children('[uid="'+e+'"]');if(!$WC.$CUtil.isEmpty(a[0])){var s=a.find("#userstatus");s.attr("class",Contacts.getStatusStyle(e))}}}}};ParticipantsAddWin={createModelWindow:function(e,t,i,a){if(this.id=e,!$WC.$Win.isExist(e)){var s=Template.participantsHtml.replace(/{ID}/g,e).replace(/{SELECTEDFEILD}/g,'<div id="participantsaddcnt" class="crchndcnt zcaddprtcnt"><div id="participantsnodecnt" class="zcrchicnt"><div id="addparticipants-usersuggest-select-field" contenteditable="false" class=""></div></div><div id="addparticipantsbtn" class="windwbtn dIB cur mrgL15">'+Resource.getRealValue("common.add")+"</div></div>").replace(/{INVITEMEMBER}/g,""),n=$WC.$Win.create({id:e,"class":"adchtwin zcadptwin",closeoutside:!0,html:s});this.bindEvents(n,t,i,a)}},bindEvents:function(e,t,i,a){var s=this.id;this.searchinput=e.find("#"+s+"-usersuggest-search-field"),this.selctfieldid=s+"-usersuggest-select-field",this.usersugglist=e.find("#"+s+"-usersuggest-list"),this.usersuggresult=e.find("#"+s+"-usersuggest-results"),this.userselectedlist=e.find("#"+s+"-usersuggest-select-field"),this.searchinput.focus(),e.find("#"+s+"title").html('<div class="ellips"><span id="winclose" title="'+Resource.getRealValue("common.back")+'" class="zchat-zcheadicn mrgR10 fl_left"></span><span class="zcinhds">'+Resource.getRealValue("chat.win.addparticipants",[$WC.$CUtil.processXSS(i)])+"</span></div>"),e.find("#"+s+"header").remove(),e.on("click","[purpose='deleteimgnode']",function(){$(this).parents("[nodetype]").remove(),$WC.DivEditor.focus(s+"-usersuggest-search-field"),ParticipantsAddWin.populateDefaultResult(),$WC.$CUtil.isEmpty(ParticipantsAddWin.userselectedlist.html())&&$("#"+s+"-usersuggest").addClass("zcrchmcnt").removeClass("zcadprtwin")}),e.find("#addparticipantsbtn").on("click",function(){for(var e=$WC.DivEditor.getNodes(ParticipantsAddWin.selctfieldid),i=[],a=0;a<e.length;a++)i.push(e[a].getAttribute("uid"));$("#participants-usersuggest-list").html('<div class="zcldng"></div>'),ParticipantsAddWin.closeWin();var s=i.join(",");Chat.addMember(t,s,"",{success:function(){if(ChatUI.isExist(t)){{var e=[];ChatUI.exist[t]}for(var a in i){var s=i[a];e.push({zuid:s,uname:s,dname:Users.getName(s)})}Participants.get(t).addParticipants(e)}ParticipantsWin.repopulateParticipants()},error:function(){ParticipantsWin.populateDefaultResult(ParticipantsWin.id)}})}),e.find("#winclose").on("click",function(){ParticipantsAddWin.closeWin()});var n={suppressScrollX:!1,minScrollbarLength:50};ZCScroll.customScroll($("#participantsnodecnt"),!0,n),ZCScroll.customScroll(this.usersugglist,!0),SearchField.init(s+"-usersuggest"),$WC.$CUtil.isEmpty(a)?ParticipantsAddWin.populateDefaultResult():(this.searchinput.text(a),this.search(a))},search:function(e){var t=this.id,i=ParticipantsWin.chid,a=ChatUI.exist[i],s="",n=this.usersuggresult;this.usersugglist.html(""),a.isChannel()&&!a.isSharedChannel()?(s=SearchAgent.ORGCONTACTS,a.isOrgGroupChannel()?s=SearchAgent.CUSTOMSEARCH:Channels.hasAnyAdvancedRules(new $CliqChatId(a.chid))&&(s=SearchAgent.ALLOWEDUSERSEARCH)):s=SearchAgent.ORGCONTACTS+SearchAgent.CONTACTS;var r=Participants.get(i).recipants.concat(SearchField.getSelectedList(this.selctfieldid)),o=SearchAgent.search({searchin:s,val:e,listid:t+"-usersuggest-list",contactshtml:Template.quickChatcontactHtml,orgcontactshtml:Template.quickChatcontactHtml,chid:a.chid,ignorelist:r,allstatuscontacts:!0,customobject:a.getAllowedUsers(),successcallback:function(){$WC.$CUtil.isEmpty($WC.DivEditor.removeBufferCharacters(ParticipantsAddWin.searchinput.text()))&&ParticipantsAddWin.focusFirstResult(n)},clearcallback:function(){ParticipantsAddWin.populateEmptyResult()}});o?(this.focusFirstResult(n),ZCScroll.scrollTop(this.usersugglist,0)):this.populateEmptyResult()},handleKeyUp:function(e){var t=e.which,i=this.id;if(e.stopPropagation(),t==$zcg.ESCAPE_KEYCODE){var a=$WC.DivEditor.getCurTextValue(i+"-usersuggest-search-field");$WC.$CUtil.isEmpty(a)?ParticipantsAddWin.closeWin():(SearchField.clearSearchField("addparticipants-usersuggest"),ParticipantsAddWin.populateDefaultResult())}SearchField.hasNodes(i+"-usersuggest-list")||this.populateEmptyResult()},handleAction:function(e,t){var i=t.attr("uid"),a=Users.getName(i),s=t.attr("elemtype"),n=this.id,r='<div uid="'+i+'" elemtype="'+s+'" title="'+a+'" nodetype="@" class="dIB zcricnt posl"><img src="'+Users.getImgUrlById(i)+'"/><div class="msi-close posa dN cur" purpose="deleteimgnode"></div></div>',o=$("#participantsaddcnt");t.remove(),o.is(":visible")||$("#participantsaddcnt").show(),$WC.$CUtil.isEmpty(i)||(this.userselectedlist.append(r),$("#"+n+"-usersuggest").removeClass("zcrchmcnt").addClass("zcadprtwin"),SearchField.clearSearchField(n+"-usersuggest"),this.populateDefaultResult())},populateDefaultResult:function(){var e=this.id;if($WC.$Win.isExist(e)){var t=$WC.DivEditor.removeBufferCharacters(this.searchinput.text());this.search($WC.$CUtil.isEmpty(t)?"*":t)}},populateEmptyResult:function(){var e=this.usersugglist,t="quickchat.no.result";e.html(""),$WC.$CUtil.isEmpty(this.searchinput.text())&&(t="quickchat.no.contact"),e.html('<div class="textcent clr6 zcnorst posa h35"><span>'+Resource.getRealValue(t)+"</span></div>")},focusFirstResult:function(e){var t=$WC.DivEditor.removeBufferCharacters(this.searchinput.text());if(!$.trim(t).length)return void e.find(".sel").removeClass("sel");var i=e.find("[purpose='search']");i.length&&0===e.find(".sel").length&&i.first().addClass("sel")},closeWin:function(){$WC.$Win.destroy(this.id)}};var Settings={},PersonalizeUI={};Settings={handlers:{},init:function(e){this.store={};for(var t in e)this.store[t]=e[t];this.store.cofflinelist=1},updateHandler:function(e,t){this.handlers[e]=t},getFromObj:function(e,t){return t?this.store[e]:parseInt(this.store[e])},isPrivateGroupEnabled:function(){return!1},isHomeFeedbackUINeeded:function(){if("456089"===$zcg._ORGID)return!1;var e=Settings.getFromObj("feature_usage_count"),t=1==Settings.getFromObj("homefbsubmitted");return!t&&e>=15},isEmbedChatEnabled:function(){return 1==Settings.getFromObj("enableembedchats")},isDarkModeChoosed:function(){return SecurityManager.hasPermission(Modules.DarkMode)&&Settings.getFromObj("darkmode")},updateInObj:function(e){for(var t in e){if("shId"==t)this.store[e.shId]=e.shState;else if("shState"==t)continue;this.store[t]=e[t],this.handlers.hasOwnProperty(t)&&this.handlers[t](e[t])}"undefined"!=typeof DesktopApp&&(DesktopApp.updateBroadsheetViewMenu(),DesktopApp.updateDisableOtherServiceMenu())},update:function(e,t,i){this.updateInObj(e),"undefined"!=typeof DesktopApp&&DesktopApp.updateBroadsheetViewMenu(),$ZCAjx.ajax({url:"/updbsettings.do",type:"POST",data:e,success:function(){"function"==typeof t&&t()},error:function(){UI.updateBanner(Resource.getRealValue("setting.update.error"),2e3,!0),"function"==typeof i&&i()}})},updateWmsSettings:function(e){var t=1===parseInt(e.cturnoff),i={property:"bchatsettings",key:"deact",value:"ALL",opr:t?"add":"rem"};$ZCAjx.ajax({url:"/updwmssettings.do",type:"POST",data:i,success:function(e){Settings.updateInObj(e),UI.updateBanner(Resource.getRealValue(t?"common.chatturnoff.info":"common.chatturnon.info"),2e3)}})}},PersonalizeUI={visibledrpdown:"",bindEvents:function(e){Sound.bindEvents(!0),e.on("change","[category]",function(e){var t=$(this).attr("category"),i=$("#personalizecontent"),a={},s=e.target.id,n=e.target.checked;if(a[s]=+n,"visual"===t){if("vmessage"==s&&n){var r=n?1:0,o=$("#vmymessage"),l=$("#vmention");o.prop("checked",n),l.prop("checked",n),$Util.CustomCheckbox.setStatus(o,n),$Util.CustomCheckbox.setStatus(l,n),a.vmymessage=r,a.vmention=r}}else if("sound"===t){var r=n?1:0;if("msgsoundnotify"==s&&n){var o=$("#mymsgsoundnotify"),l=$("#mentionsoundnotify");o.prop("checked",n),l.prop("checked",n),$Util.CustomCheckbox.setStatus(o,n),$Util.CustomCheckbox.setStatus(l,n),a.mymsgsoundnotify=r,a.mentionsoundnotify=r}else if(n&&("av_call_sound_notify"==s||"screen_call_sound_notify"==s)){var c=$("#"+s);c.prop("checked",n),$Util.CustomCheckbox.setStatus(c,n),"av_call_sound_notify"==s?a.av_call_sound_notify=r:a.screen_call_sound_notify==r}}else if("general"===t){if("cturnoff"===e.target.id)return Settings.updateWmsSettings(a),void($.isEmptyObject(a)||(1==a.cturnoff?$("#cturnofftip").removeClass("dN"):$("#cturnofftip").addClass("dN"),ZCScroll.getScrollDown(i[0])))}else if("notify"==t)if("msgnotify"==s){{var r=n?0:1;$("#msgnotify")}a.msgnotify=r,$("#notificationpreview").html(PersonalizeUI.getNotificationPreviewHTML(n,1==Settings.getFromObj("dcstickynotif")))}else if("dcstickynotif"==s){{var r=n?1:0;$("#dcstickynotif")}_isDesktopApp()&&DesktopApp.setStickyNotification(r),a.dcstickynotif=r,$("#notificationpreview").html(PersonalizeUI.getNotificationPreviewHTML(0==Settings.getFromObj("msgnotify"),n))}Settings.update(a)}),e.on("click","[purpose]",function(e){var t=$("#personalizewin"),i=t.find(this),a=i.attr("purpose");if("category"===a&&!i.hasClass("sel")){var s=i.attr("option");PersonalizeUI.changeOption(s)}if("subcategory"!==a||i.hasClass("sel")){if("soundplay"===a||"soundpause"===a)e.stopPropagation(),0!==parseInt(i.parent().attr("val"))&&("soundplay"===a?(i.attr({"class":"msi-pause",purpose:"soundpause"}),Sound.play(i.attr("tone"))):"soundpause"===a&&(i.attr({"class":"msi-soundplay",purpose:"soundplay"}),Sound.stop(i.attr("tone"))));else if("ddhead"===a){var n,r,o=["mymessagesoundddhead","allmessagesoundddhead","eventsoundddhead","mentionsoundddhead"],l=i.attr("id");switch(l){case"mymessagesoundddhead":n="mymessagesoundddhead",r="mymessagesoundlist";break;case"allmessagesoundddhead":n="allmessagesoundddhead",r="allmessagesoundlist";break;case"eventsoundddhead":n="eventsoundddhead",r="eventsoundlist";break;case"mentionsoundddhead":n="mentionsoundddhead",r="mentionsoundlist"}if("mymessagesoundddhead"===l&&"block"===$("#mymessagesoundlist")[0].style.display||"allmessagesoundddhead"===l&&"block"===$("#allmessagesoundlist")[0].style.display||"eventsoundddhead"===l&&"block"===$("#eventsoundlist")[0].style.display||"mentionsoundddhead"===l&&"block"===$("#mentionsoundlist")[0].style.display)return;-1!=$.inArray(l,o)&&(i.addClass("sel"),Clickoutside.bind({event:e,srcid:n,destid:r,callback:function(e){$("#"+e).removeClass("sel"),PersonalizeUI.handleSound(!1,function(){PersonalizeUI.visibledrpdown=""})}}),ZCScroll.customScroll($("#"+r)));var c=$("#"+r),d={positionparent:!1,maxtop:t.offset().top+t.height()-(c.height()+10),leftoffset:-8};$Util.positionTargetElement(i,c,d),PersonalizeUI.visibledrpdown=r}else if("theme"===a){var u=t.find("#personalizecontent"),m=u.find(e.target).attr("val");i.hasClass("zcthclrsel")||(u.find('[purpose="theme"][val="'+Settings.getFromObj("cthemes")+'"]').removeClass("zcthclrsel"),u.find('[purpose="theme"][val="nite-mode"]').removeClass("zcthclrsel"),u.find('[purpose="theme"][val="'+m+'"]').addClass("zcthclrsel"),"nite-mode"===m?($("#darkmode_spinner").addClass("reqprocess_anim"),ProfileMenu.loadDarkModeFiles(function(){Settings.update({darkmode:1},function(){UI.Theme.updateTheme(),$("#darkmode_spinner").removeClass("reqprocess_anim")})})):Settings.update({cthemes:m,darkmode:0},function(){UI.Theme.updateTheme()}))}else if("view"===a){var p=parseInt(t.find("#personalizecontent").find(e.target).attr("val"));PersonalizeUI.updatePaneView(p)}else if("selecttone"===a){var u=t.find("#personalizecontent"),h=u.find(e.target).attr("val"),l=u.find(e.target).parent().attr("id");Clickoutside.handleClickOnChild(e);var g={};"mymessagesoundlist"===l?(g.smymessage=h,u.find("#mymessagesoundselected").attr("val",h).html(Sound.tonemapping[h])):"allmessagesoundlist"===l?(g.smessage=h,u.find("#allmessagesoundselected").attr("val",h).html(Sound.tonemapping[h])):"eventsoundlist"===l?(g.scalendar=h,u.find("#eventsoundselected").attr("val",h).html(Sound.tonemapping[h])):"mentionsoundlist"===l&&(g.smention=h,u.find("#mentionsoundselected").attr("val",h).html(Sound.tonemapping[h])),Settings.update(g),u.find(e.target).parent().find(".msi-ticktwo").remove(),u.find(e.target).append('<div class="msi-ticktwo clrgr dIB floatr font11 mrgT3 mrgR10"></div>'),PersonalizeUI.handleSound(!1)}}else{var f=i.attr("option");PersonalizeUI.loadNotificationContent(f)}})},updatePaneView:function(e){var t=$("#personalizecontent"),i=Settings.getFromObj("cpaneview");e!=i&&(t.length&&(t.find('[purpose="view"][val="'+Settings.getFromObj("cpaneview")+'"]').removeClass("sel"),t.find('[purpose="view"][val="'+e+'"]').addClass("sel")),Settings.update({cpaneview:e}))},createWindow:function(){if(!$WC.$Win.isExist("personalizewin")){var e=$WC.$Win.create({id:"personalizewin","class":"personalizewin",aligncenter:!1,html:Template.PersonalizeSetting.replace(/{PERSONALIZECONTENT}/g,this.getGeneralHTML())});this.handleGeneralSettings(),this.bindEvents(e),$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME)||$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME.primary_color)&&$WC.$CUtil.isEmpty($zcg._CUSTOMTHEME.theme_name)||$("#ps_themes").hide(),ZCScroll.customScroll($("#personalizecontent"),!0)}},changeOption:function(e){var t=$("#personalizewin");this.loadContent(e),t.find('[purpose="category"][option]').removeClass("sel"),t.find('[purpose="category"][option="'+e+'"]').addClass("sel")},loadNotificationContent:function(e){var t=$("#personalizewin");t.find("#personalizecontent").html(PersonalizeUI.getNotificationHTML(e)),t.find('[purpose="subcategory"][option]').removeClass("sel"),t.find('[purpose="subcategory"][option="'+e+'"]').addClass("sel")},loadContent:function(e){var e={notification:function(){$("#personalizecontent").html(PersonalizeUI.getNotificationHTML())},themes:function(){$("#personalizecontent").html(PersonalizeUI.getThemesHTML()),Settings.isDarkModeChoosed()?$("#personalizecontent").find('[val="nite-mode"]').addClass("zcthclrsel"):$("#personalizecontent").find('[val="'+Settings.getFromObj("cthemes")+'"]').addClass("zcthclrsel")},general:function(){$("#personalizecontent").html(PersonalizeUI.getGeneralHTML()),PersonalizeUI.handleGeneralSettings()}};return function(t){e[t]()}}(),handleSound:function(e,t){var i=PersonalizeUI.visibledrpdown,a=Sound.playing;if(!$WC.$CUtil.isEmpty(i)){var s=$("#personalizewin #"+i).find(".msi-pause");if(s.attr({"class":"msi-soundplay",purpose:"soundplay",title:Resource.getRealValue("common.play")}),e){var n=$("#personalizewin #"+i).find('[val="'+a+'"]').find(".msi-soundplay");n.attr({"class":"msi-pause",purpose:"soundpause",title:Resource.getRealValue("common.pause")})}"function"==typeof t&&t()}},getNotificationPreviewHTML:function(e,t){var i=$Util.Browser.getBrowserImgUrl(),a=$Util.getImgStaticUrl()+(e?"/sample_user_image.png":"/chaticon.png"),s="",n='<img id="notificationimg" src="'+a+'">',r='<br><span class="ellips">via <b>'+window.location.hostname+"</b></span>";_isDesktopApp()&&(s="browsrimgdc ",r="",e||(n=""),DesktopApp.isWIN&&(i=a,n=t?'<div class="wdcclsdiv"><div>'+Resource.getRealValue("common.close")+"</div></div>":""));var o='<div class="'+s+'" ><img src="'+i+'" class="browsrimg"></span><span class="msginfo ellips"><b>'+Resource.getRealValue(e?"settings.sampleuname":"common.zoho.chat")+"</b>"+r+"<br>"+Resource.getRealValue(e?"settings.samplemsg":"notification.message")+"</span>"+n+"</div>";return o},getNotificationHTML:function(e){var t="";switch(e){default:var i=Settings.getFromObj("msgnotify")?!1:!0,a=1==Settings.getFromObj("dcstickynotif");t=Template.PersonalizeNotificationSettings.replace(/{INNERHTML}/g,Template.Personalize.DesktopNotification).replace(/{NOTIFICATION}/g,PersonalizeUI.getNotificationPreviewHTML(i,a)),t=$Util.CustomCheckbox.construct(t,[{html:'<input id="vmessage" category="visual" type="checkbox" {VALLMESSAGE} class="zcunrdchkbx"/>',key:"{VALLMESSAGE}",checked:Settings.getFromObj("vmessage")},{html:'<input id="vmymessage" category="visual" type="checkbox" {VMYMESSAGE} class="zcunrdchkbx"/>',key:"{VMYMESSAGE}",checked:Settings.getFromObj("vmessage")||Settings.getFromObj("vmymessage")},{html:'<input id="vmention" category="visual" type="checkbox" {VMENTION} class="zcunrdchkbx"/>',key:"{VMENTION}",checked:Settings.getFromObj("vmessage")||Settings.getFromObj("vmention")},{html:'<input id="vcalendar" category="visual" type="checkbox" {VEVENT} class="zcunrdchkbx"/>',key:"{VEVENT}",checked:Settings.getFromObj("vcalendar")},{html:'<input id="vustatus" category="visual" type="checkbox" {VUSTATUS} class="zcunrdchkbx"/>',key:"{VUSTATUS}",checked:Settings.getFromObj("vustatus")},{html:'<input id="msgnotify" category="notify" type="checkbox" {MSGNOTIFY} class="zcunrdchkbx"/>',key:"{MSGNOTIFY}",checked:i},{html:'<input id="dcstickynotif" category="notify" type="checkbox" {STICKYNOTIF} class="zcunrdchkbx"/>',key:"{STICKYNOTIF}",checked:a}]),t=t.replace(/{VALLMESSAGE}/g,Settings.getFromObj("vmessage")?"checked":"").replace(/{VMYMESSAGE}/g,Settings.getFromObj("vmessage")?"checked":Settings.getFromObj("vmymessage")?"checked":"").replace(/{VMENTION}/g,Settings.getFromObj("vmessage")?"checked":Settings.getFromObj("vmention")?"checked":"").replace(/{VEVENT}/g,Settings.getFromObj("vcalendar")?"checked":"").replace(/{VUSTATUS}/g,Settings.getFromObj("vustatus")?"checked":"").replace(/{MSGNOTIFY}/g,i?"checked":"").replace(/{STICKYNOTIF}/g,a?"checked":"");break;case"sound":for(var s="",n="",r="",o="",l=1;l<Object.keys(Sound.tonemapping).length;l++)s+='<li val="'+l+'" purpose="selecttone"><em class="msi-soundplay" title="'+Resource.getRealValue("common.play")+'" tone="'+Sound.tonemapping[l]+'" purpose="soundplay"></em>'+Sound.tonemapping[l]+(Settings.getFromObj("smymessage")===l?'<div class="msi-ticktwo clrgr dIB floatr font11 mrgT3 mrgR10"></div>':"")+"</li>",n+='<li val="'+l+'" purpose="selecttone"><em class="msi-soundplay" title="'+Resource.getRealValue("common.play")+'" tone="'+Sound.tonemapping[l]+'" purpose="soundplay"></em>'+Sound.tonemapping[l]+(Settings.getFromObj("smessage")===l?'<div class="msi-ticktwo clrgr dIB floatr font11 mrgT3 mrgR10"></div>':"")+"</li>",r+='<li val="'+l+'" purpose="selecttone"><em class="msi-soundplay" title="'+Resource.getRealValue("common.play")+'" tone="'+Sound.tonemapping[l]+'" purpose="soundplay"></em>'+Sound.tonemapping[l]+(Settings.getFromObj("scalendar")===l?'<div class="msi-ticktwo clrgr dIB floatr font11 mrgT3 mrgR10"></div>':"")+"</li>",o+='<li val="'+l+'" purpose="selecttone"><em class="msi-soundplay" title="'+Resource.getRealValue("common.play")+'" tone="'+Sound.tonemapping[l]+'" purpose="soundplay"></em>'+Sound.tonemapping[l]+(Settings.getFromObj("smention")===l?'<div class="msi-ticktwo clrgr dIB floatr font11 mrgT3 mrgR10"></div>':"")+"</li>";t=Template.PersonalizeNotificationSettings.replace(/{INNERHTML}/g,Template.Personalize.SoundNotification),t=$Util.CustomCheckbox.construct(t,[{html:'<input id="msgsoundnotify" category="sound" type="checkbox" {MSGSOUNDNOTIFY} class="zcunrdchkbx"/>',key:"{MSGSOUNDNOTIFY}",checked:Settings.getFromObj("msgsoundnotify")},{html:'<input id="mymsgsoundnotify" category="sound" type="checkbox" {MYMSGSOUNDNOTIFY} class="zcunrdchkbx"/>',key:"{MYMSGSOUNDNOTIFY}",checked:Settings.getFromObj("mymsgsoundnotify")},{html:'<input id="mentionsoundnotify" category="sound" type="checkbox" {MENTIONSOUNDNOTIFY} class="zcunrdchkbx"/>',key:"{MENTIONSOUNDNOTIFY}",checked:Settings.getFromObj("mentionsoundnotify")},{html:'<input id="eventsoundnotify" category="sound" type="checkbox" {EVENTSOUNDNOTIFY} class="zcunrdchkbx"/>',key:"{EVENTSOUNDNOTIFY}",checked:Settings.getFromObj("eventsoundnotify")},{html:'<input id="av_call_sound_notify" category="sound" type="checkbox" {AVSOUNDNOTIFY} class="zcunrdchkbx"/>',key:"{AVSOUNDNOTIFY}",checked:Settings.getFromObj("av_call_sound_notify")},{html:'<input id="screen_call_sound_notify" category="sound" type="checkbox" {SSSOUNDNOTIFY} class="zcunrdchkbx"/>',key:"{SSSOUNDNOTIFY}",checked:Settings.getFromObj("screen_call_sound_notify")}]),t=t.replace(/{MSGSOUNDNOTIFY}/g,Settings.getFromObj("msgsoundnotify")?"checked":"").replace(/{MYMSGSOUNDNOTIFY}/g,Settings.getFromObj("mymsgsoundnotify")?"checked":"").replace(/{MENTIONSOUNDNOTIFY}/g,Settings.getFromObj("mentionsoundnotify")?"checked":"").replace(/{EVENTSOUNDNOTIFY}/g,Settings.getFromObj("eventsoundnotify")?"checked":"").replace(/{AVSOUNDNOTIFY}/g,Settings.getFromObj("av_call_sound_notify")?"checked":"").replace(/{SSSOUNDNOTIFY}/g,Settings.getFromObj("screen_call_sound_notify")?"checked":"").replace(/{MYMSGTONE}/g,Sound.tonemapping[Settings.getFromObj("smymessage")]).replace(/{ALLMSGTONE}/g,Sound.tonemapping[Settings.getFromObj("smessage")]).replace(/{EVENTTONE}/g,Sound.tonemapping[Settings.getFromObj("scalendar")]).replace(/{MENTIONTONE}/g,Sound.tonemapping[Settings.getFromObj("smention")]).replace(/{MYMSGTONEVAL}/g,Settings.getFromObj("smymessage")).replace(/{ALLMSGTONEVAL}/g,Settings.getFromObj("smessage")).replace(/{EVENTTONEVAL}/g,Settings.getFromObj("scalendar")).replace(/{MENTIONTONEVAL}/g,Settings.getFromObj("smention")).replace(/{MYMSGTONESLIST}/g,s).replace(/{ALLMSGTONESLIST}/g,n).replace(/{EVENTTONESLIST}/g,r).replace(/{MENTIONTONESLIST}/g,o);break;case"email":t=Template.PersonalizeNotificationSettings.replace(/{INNERHTML}/g,Template.Personalize.EmailNotification),t=$Util.CustomCheckbox.construct(t,[{html:'<input id="unreadchatnotify" category="notify" type="checkbox" {UNREADCHATNOTIFY} class="zcunrdchkbx"/>',key:"{UNREADCHATNOTIFY}",checked:Settings.getFromObj("unreadchatnotify")},{html:'<input id="unreadmentionnotify" category="notify" type="checkbox" {UNREADMENTIONNOTIFY} class="zcunrdchkbx"/>',key:"{UNREADMENTIONNOTIFY}",checked:Settings.getFromObj("unreadmentionnotify")},{html:'<input id="chatinvitenotify" category="notify" type="checkbox" {CHATINVITENOTIFY} class="zcunrdchkbx"/>',key:"{CHATINVITENOTIFY}",checked:Settings.getFromObj("chatinvitenotify")}]),t=t.replace(/{UNREADCHATNOTIFY}/g,Settings.getFromObj("unreadchatnotify")?"checked":"").replace(/{UNREADMENTIONNOTIFY}/g,Settings.getFromObj("unreadmentionnotify")?"checked":"").replace(/{CHATINVITENOTIFY}/g,Settings.getFromObj("chatinvitenotify")?"checked":"")}return t},getThemesHTML:function(){var e='<div class="zcnotifymn themeview dIB mrgT20"><span>{{theme_dark}}</span><div class="zcthmcnt"><div purpose="theme" val="nite-mode" class="cp"><span></span><em val="nite-mode" class="msi-hissel"></em><div id="darkmode_spinner"></div></div></div></div>',t=$WC.template.replace(Template.PersonalizeThemes,{$theme_desc:"settings.themes.desc",$theme_one:"setting.themes.one",$theme_two:"setting.themes.two",$theme_three:"setting.themes.three",$theme_four:"setting.themes.four",$theme_five:"setting.themes.five"});return t=$WC.template.replace(t,{dark_mode:SecurityManager.hasPermission(Modules.DarkMode)?e:""},"InSecureHTML"),t=$WC.template.replace(t,{$theme_dark:"setting.themes.darktheme"})},getGeneralHTML:function(){var e=Settings.getFromObj("deact",!0),t="undefined"!=typeof e?e.split(","):[],i=-1!=$.inArray("ALL",t),a=$Util.getOS(),s="";"mac"==a?s=$zcg._MACAPPURL:"windows"==a?s=$zcg._WINDOWSAPPURL:"linux"==a&&(s=$zcg._LINUXAPPURL);var n=Template.PersonalizeGeneralSetting.replace(/{LOGOURL}/g,UI.Logo.getGeneralURL($Util.getImgStaticUrl()+"/logo-white.png")).replace(/{MUTESTATUS}/g,0===Settings.getFromObj("globalsoundnotify")?"msi-glunmute":"msi-glmute");return n=$Util.CustomCheckbox.construct(n,[{html:'<input id="cturnoff" category="general" type="checkbox" {CTURNOFFSTATE} class="zcunrdchkbx"/>',key:"{CTURNOFF}",checked:i}]),n=n.replace(/{CTURNOFFSTATE}/g,i?"checked":"").replace(/{TURNOFFTIP}/g,Resource.getRealValue("settings.tip.desc",[s]))},handleGeneralSettings:function(){var e=Settings.getFromObj("deact",!0),t="undefined"!=typeof e?e.split(","):[],i=-1!=$.inArray("ALL",t);$("#personalizewin #personalizecontent").find('[purpose="view"][val="'+Settings.getFromObj("cpaneview")+'"]').addClass("sel"),SecurityManager.hasPermission(Modules.Bots)&&$("#LHS-list").find("[dragitem='botcontacts']").show(),MainUI.getLHSOrderHTML(!0),PersonalizeUI.handleDragDrop(),i&&$("#cturnofftip").removeClass("dN")},handleDragDrop:function(){function e(e){e.preventDefault()}var t=$("#LHS-dragable");t.find("div[dragitem]").on("mousedown.LHSdrag",function(i){var a=$(this).addClass("draggable-item"),s=a.parent().offset().top,n=s+a.parent().height(),r=a.offset().top,o=i.pageY-r,l=function(e){var t=e.pageY-o;if(s>t)a.offset({top:s}),a.prev().length>0&&a.insertBefore(a.prev().css({top:-a.height()}).animate({top:0},100));else if(t+a.height()>n)a.offset({top:n-a.height()}),a.next().length>0&&a.insertAfter(a.next().css({top:a.height()}).animate({top:0},100));else{a.offset({top:t});var i=!1;r-t>a.height()-1?(a.insertBefore(a.prev().css({top:-a.height()}).animate({top:0},100)),i=!0):t-r>a.height()-1&&(a.insertAfter(a.next().css({top:a.height()}).animate({top:0},100)),i=!0),i&&(a.css({top:0}),r=a.offset().top,t=e.pageY-o,o=e.pageY-r)}},c=function(){t.off("mousemove.LHSdrag",l).off("mouseup.LHSdrag",c),t.off(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",e),PersonalizeUI.updateLHSOrder(a),a.animate({top:0},100,function(){a.removeClass("draggable-item")})};t.on("mousemove.LHSdrag",l).on("mouseup.LHSdrag",c).on("contextmenu",c),t.on(($.support.selectstart?"selectstart":"mousedown.")+".ui-disableSelection",e),$("#LHS-dragable").off("mouseleave.LHSdrag").on("mouseleave.LHSdrag",function(e){c(e,!0)})})},updateLHSOrder:function(e){var t=e.attr("dragindex");curpos=e.index()+1;var i=Settings.getFromObj("lhs_order",!0);("undefined"==typeof i||i[t]!=curpos)&&$ZCAjx.ajax({url:"/setlhsheaderorder.do",type:"POST",data:{lhsheaderkey:t,order:curpos},success:function(e){Settings.updateInObj({lhs_order:e.lhs_order}),MainUI.getLHSOrderHTML()},error:function(){UI.updateBanner(Resource.getRealValue("setting.update.error"),2e3,!0)}})}};var SearchAgent={};SearchAgent={PARTICIPANTS:1,CONTACTS:2,GROUPS:4,ORGCONTACTS:8,CHATHISTORY:16,SMILEY:32,CHATTITLE:64,COMMANDS:128,CHATS:256,CUSTOMSEARCH:512,ORGGROUPS:1024,CHANNELS:2048,FUNCTIONS:4096,BOTS:8192,MESSAGEACTIONS:16384,ALLOWEDUSERSEARCH:32768,GROUPING_CHATS:1,GROUPING_CHANNELS:2,clearcallback:null,srcid:null,destid:null,search:function(e){var t=function(){var t={ignorelist:[],protocol:[],permission:[],emailid:!0,srcid:null,destid:null,clearcallback:null,successcallback:null,allstatuscontacts:!0,limit:25,highlight:!0,debugsource:""};return $.extend({},t,e)},e=t();return this.val=e.val,e.searchin&this.PARTICIPANTS?(SearchAgent.getResultsWithParticipants(e),!0):SearchAgent.getResultsWithoutParticipants(e)},getResults:function(e){this.clearcallback=e.clearcallback,this.successcallback=e.successcallback,this.srcid=e.srcid,this.destid=e.destid;var t,i=e.searchin,a=e.ignorelist,s=(e.val,$("#"+e.listid)),n=e.limit,r=e.furtherrequestmade||!1,o=e.totalsearchedlength||0,l=e.searchedlength||0,c="";if(e.specialmentions&&(c=MentionsUI.getSpecialMentionHTML(s,e),$WC.$CUtil.isEmptyString(c)||(o+=jQuery.parseHTML(c).length),this.appendInDom(s,c,e.groupingmode)),i&this.CHATS&&(e.limit=n-o,t=this.getChats(e),o=t.searchedlist.length,a=a.concat(t.searchedlist),a=a.concat(ChatsList.getRecipantForChats(a)),o&&(c='<div id="chats" searchcatagory="chats">'+t.content+"</div>",this.appendInDom(s,c,e.groupingmode))),i&this.CHANNELS&&n>o&&(e.limit=n-o,e.ignorelist=a,t=this.getChannels(e),r=r||t.furtherreq,l=t.searchedlist.length,a=a.concat(t.searchedchids),o+=l,(r||l)&&(c='<div id="channels" searchcatagory="channels">'+t.content+"</div>",this.appendInDom(s,c,e.groupingmode))),i&this.CUSTOMSEARCH&&(e.ignorelist=a,t=this.getCustomSearchResults(e),l=t.searchedlist.length,o+=l,a=a.concat(t.searchedlist),l&&(c='<div id="custom" searchcatagory="custom">'+t.content+"</div>",this.appendInDom(s,c,e.groupingmode),e.peopledata&&Users.updateUserDetails(t.searchedlist,s))),i&this.ALLOWEDUSERSEARCH&&(e.ignorelist=a,t=this.getAllowedUsers(e),l=t.searchedlist.length,o+=l,a=a.concat(t.searchedlist),r=r||t.furtherreq,(l||t.furtherreq)&&(c='<div id="alloweduser" searchcatagory="alloweduser">'+t.content+"</div>",this.appendInDom(s,c,e.groupingmode),e.peopledata&&Users.updateUserDetails(t.searchedlist,s))),i&this.CONTACTS&&n>o&&(e.limit=n-o,e.ignorelist=a,t=this.getContacts(e),l=t.searchedlist.length,o+=l,a=a.concat(t.searchedlist),c='<div id="contacts" searchcatagory="contacts">'+t.content+"</div>",SearchAgent.appendInDom(s,c,e.groupingmode),l&&e.peopledata&&Users.updateUserDetails(t.searchedlist,s)),i&this.BOTS&&n>o&&(e.limit=n-o,e.ignorelist=a,e.getbots=!0,e.getbotsonly=!0,t=this.getContacts(e),l=t.searchedlist.length,o+=l,a=a.concat(t.searchedlist),l&&(c='<div id="botcontacts" searchcatagory="contacts">'+t.content+"</div>",this.appendInDom(s,c,e.groupingmode))),i&this.ORGCONTACTS&&n>o&&(a.push(WmsImpl.getZuid()),e.limit=n-o,e.ignorelist=a,t=this.getOrgContacts(e),r=r||t.furtherreq,l=t.searchedlist.length,o+=l,a=a.concat(t.searchedlist),(l||t.furtherreq)&&(c='<div id="orgcontacts" searchcatagory="orgcontacts" '+(t.furtherreq?'furtherreq="true"':"")+">"+t.content+"</div>",this.appendInDom(s,c,e.groupingmode))),i&this.CHATHISTORY&&n>o&&(e.limit=n-o,e.ignorelist=a,t=ChatsList.getSearchResults({val:e.val,html:e.chathistoryhtml,permission:e.permission,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit}),o+=t.searchedlist.length,a=a.concat(t.searchedlist),a=a.concat(ChatsList.getRecipantForChats(a)),o&&(c='<div id="chats" searchcatagory="chats">'+t.content+"</div>",this.appendInDom(s,c,e.groupingmode)),e.limit=n-o,e.ignorelist=a,t=this.getChatHistory(e),r=r||t.furtherreq,l=t.searchedlist.length,o+=l,(l||t.furtherreq)&&(c='<div id="chathistory" searchcatagory="chathistory" '+(t.furtherreq?'furtherreq="true"':"")+">"+t.content+"</div>",this.appendInDom(s,c,e.groupingmode))),i&this.ORGGROUPS&&n>o&&(e.limit=n-o,e.ignorelist=a,t=this.getOrgGroups(e),l=t.searchedlist.length,o+=l,l)){var c=$('<div id="orggroupshtml" searchcatagory="orggroups"></div>');c.html(t.content),this.appendInDom(s,c,e.groupingmode)}return i&this.SMILEY&&(t=this.getSmileys(e),t.length&&(c='<div id="smileys" searchcatagory="smileys">'+t+"</div>",this.appendInDom(s,c,e.groupingmode),o++)),i&this.CHATTITLE&&(t=this.getChatTitle(e),t.length&&(c='<div id="chattitle" searchcatagory="chattitle">'+t+"</div>",this.appendInDom(s,c,e.groupingmode),o++)),i&this.COMMANDS&&(t=this.getCommands(e),t.length&&(c='<div id="shortcut" searchcatagory="shortcut">'+t+"</div>",this.appendInDom(s,c,e.groupingmode),o++)),i&this.MESSAGEACTIONS&&(t=this.getMessageActions(e),t.length&&(c='<div id="shortcut" searchcatagory="shortcut">'+t+"</div>",this.appendInDom(s,c,e.groupingmode),o++)),e.totalsearchedlength=o,e.furtherrequestmade=r,SearchAgent.updateResultsContainer(e,s)},getParticipants:function(e){return Participants.searchParticipants({val:e.val,html:e.participantshtml,chid:e.chid,protocol:e.protocol,peopledata:e.peopledata,pageno:e.pageno,ignorelist:e.ignorelist,listid:e.listid,destid:e.destid,highlight:e.highlight,limit:e.limit,deletemember:e.deletemember,categorize:e.categorize,restricttosameorg:e.restricttosameorg,successcallback:e.successCallback,emptycallback:function(e,t,i){SearchAgent.emptyCallback(e,t,i)}})},getContacts:function(e){return Contacts.getSearchResults({val:e.val,html:e.contactshtml,restricttosameorg:e.restricttosameorg,protocol:e.protocol,emailid:e.emailid,peopledata:e.peopledata,allstatus:e.allstatuscontacts,getbots:e.getbots,getbotsonly:e.getbotsonly,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit})},getOrgContacts:function(e){return Users.getSearchResults({val:e.val,html:e.orgcontactshtml,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit,peopledata:e.peopledata,emailid:e.emailid,listid:e.listid,destid:e.destid,debugsource:e.debugsource,populateid:e.groupingmode>0?e.listid:"orgcontacts",successcallback:function(t,i,a,s){t='<div id="orgcontacts" searchcatagory="orgcontacts" >'+t+"</div>",SearchAgent.successCallback(t,i,a,null,s,e.groupingmode)},emptycallback:function(e,t,i){SearchAgent.emptyCallback(e,t,i)}})},getChatHistory:function(e){return ChatHistoryTitleSearch.getSearchResults({val:e.val,html:e.chathistoryhtml,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit,listid:e.listid,populateid:"chathistory",successcallback:function(e,t,i){SearchAgent.successCallback(e,t,i)},emptycallback:function(e,t,i){SearchAgent.emptyCallback(e,t,i)}})},getAllowedUsers:function(e){return Chat.getAllowedUsers({val:e.val,html:"undefined"!=typeof e.contactshtml?e.contactshtml:Contacts.searchhtml,chid:e.chid,id:e.id,protocol:e.protocol,peopledata:e.peopledata,pageno:e.pageno,listid:e.listid,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit,deletemember:e.deletemember,categorize:e.categorize,populateid:"alloweduser",successcallback:function(e,t,i){SearchAgent.successCallback(e,t,i)},emptycallback:function(e,t,i){SearchAgent.emptyCallback(e,t,i)}})},getSmileys:function(e){return Smiley.getSearchResults({val:e.val,html:e.smileyhtml})},getChatTitle:function(e){var t=$.trim(e.val);return"*"!==t&&t.length>0?Composer.getTitleAutoCompleteHTML(t,e.limit):""},getCommands:function(e){return CommandsUtil.search({val:e.val,html:CommandsUtil.searchhtml,limit:e.limit,ignoredefaultcommands:e.ignoredefaultcommands,ignorelist:e.ignorelist})},getMessageActions:function(e){return MessageActionsUtil.search({val:e.val,html:CommandsUtil.searchhtml,limit:e.limit,ignoredefaultcommands:e.ignoredefaultcommands,ignorelist:e.ignorelist})},getChats:function(e){return ChatsList.getSearchResults({val:e.val,html:e.chatshtml,permission:e.permission,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit})},getOrgGroups:function(e){return Groups.getSearchResults({allorggroups:e.allorggroups,val:e.val,html:e.groupshtml,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit,validorggroups:e.validorggroups})},getChannels:function(e){return Channels.getSearchResults({val:e.val,channelshtml:e.channelshtml,ignorelist:e.ignorelist,highlight:e.highlight,limit:e.limit,listid:e.listid,separationheaders:e.separationheaders,sortorder:e.sortorder,category:e.channelcategory,scid:e.scid,populateid:"channels",successcallback:function(t,i,a){SearchAgent.successCallback(t,i,a,e.replacecontentonsuccesscallback)},emptycallback:function(e,t,i){SearchAgent.emptyCallback(e,t,i)}})},getCustomSearchResults:function(){function e(e,t,i,a,s){var n=Users.getName(e.ZUID,e.DNAME),r=Users.getImgUrlById(e.ZUID),i=i.replace(/{USERID}/g,e.ZUID).replace(/{IMGURL}/g,r).replace(/{ID}/g,$WC.Matcher.replace("containerid",""+e.ZUID)).replace(/{DNAME}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{STATUSCLASS}/g,Contacts.isMutual(e.ZUID)?Contacts.getStatusStyle(e.ZUID):"");if(a){var o=n.toLowerCase().indexOf(t),l=new RegExp($WC.Matcher.replace("escaperegexp",t),"i");0===o&&(n=n.replace(l,"<b>$&</b>"))}e.zuid=e.ZUID,e.dname=e.DNAME,e.emailid=e.EMAILID;var c=Users.getUserDetailsForHtml({contact:Users.getInfo(e.ZUID)||e,val:t,ispeopledata:s,highlight:a});return i=i.replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{EMAILID}/g,c.departmentinfo||e.EMAILID)}function t(e,t){return!(-1!==e.ignorelist.indexOf(t.ZUID)||t.ZUID===WmsImpl.getZuid())}return function(i){var a=i.customobject,s=i.val.toLowerCase(),n=i.highlight,r=i.limit,o=(i.ignorelist,"undefined"!=typeof i.contactshtml?i.contactshtml:Contacts.searchhtml),l=[],c=[],d="",u=[];for(var m in a){var p=a[m],h=-1;t(i,p)&&("*"===s||(h=p.DNAME.toLowerCase().indexOf(s),0!==h)?(-1!==h||"*"===s)&&c.push([m,p.DNAME]):l.push([m,p.DNAME]))}var g=$Util.sort(l,1),f=g.length;r>f&&(g=g.concat($Util.sort(c,1))),g=g.slice(0,r),f=g.length;for(var v=0;f>v;v++){var C=i.ignorelist.indexOf(g[v][0]);if(-1===C){u.push(g[v][0]);var y=a[g[v][0]];d+=e(y,s,o,n,i.peopledata)}}return{content:d,searchedlist:u}}}(),successCallback:function(e,t,i,a,s,n){var r=$("#"+t);n>0&&(r=$("#"+s));var o=r.find("#"+i),l=this.hasResult(r);r.find("#loading").remove(),o.removeAttr("furtherreq"),a?this.populateInDom(o,e,n):this.appendInDom(o,e,n),n>0&&$Util.initializeStickyTitle(r.parent()),l||(r.find('[purpose="search"]').first().addClass("srchbn sel"),ZCScroll.scrollTop($("#"+this.destid),0)),"function"==typeof this.successcallback&&this.successcallback()},populateInDom:function(e,t,i){i==this.GROUPING_CHATS||i==this.GROUPING_CHANNELS?(e.html(""),this.appendInDom(e,t,i)):e.html(t)},appendInDom:function(e,t,i){e.find("[zc_running_title]").show();var a=function(t,i){var a=e.find('[categorygroup="'+t+'"]');a.find("[zc_grouping_title]").attr("zc_running_title",""),a.show().append(i)},s=$(t),n=s.attr("id");if(i==this.GROUPING_CHATS||i==this.GROUPING_CHANNELS)if(0==e.find("[categorygroup]").length&&this.populateCategoryTitles(e,i),"specialmentions"==n&&a("specialmentions",s),"participants"==n)a("participant",s);else if("contacts"==n){var r=s.children(),o=s.clone();if(o.children().remove(),r.length){for(var l=!1,c=!1,d=0;d<r.length;d++){var u=r[d].getAttribute("uid");Users.isSameOrg(u,!0)?(l=!0,o.append(r[d])):c=!0}l&&a("orgUser",o),c&&a("externalcontacts",s)}}else"orgcontacts"==n?s.children().length>0&&a("orgUser",s):"custom"==n?s.children().length>0&&a("teammember",s):"orggroupshtml"==n?s.children().length>0&&a("orgGroups",s):"botcontacts"==n?s.children().length>0&&a("botcontacts",s):"channels"==n?s.children().length>0&&a("channels",s):("chats"==n||"chathistory"==n)&&s.children().length>0&&a("chats",s);else e.append(t)},populateCategoryTitles:function(e){var t='<div class="srchlstctgrp" categorygroup="specialmentions" ><div class="mtnsugtit" mentiontitle="specialmentions" zc_grouping_title ></div></div><div class="srchlstctgrp" categorygroup="participant" ><div class="mtnsugtit" mentiontitle="participant" zc_grouping_title >'+Resource.getRealValue("common.participants")+'<span></span></div></div><div class="srchlstctgrp" categorygroup="teammember" ><div class="mtnsugtit" mentiontitle="teamMember" zc_grouping_title >'+Resource.getRealValue("common.team.members")+'<span></span></div></div><div class="srchlstctgrp" categorygroup="orgUser" ><div class="mtnsugtit" mentiontitle="orgUser" zc_grouping_title >'+Resource.getRealValue("common.org.users")+'<span></span></div></div><div class="srchlstctgrp" categorygroup="orgGroups" ><div class="mtnsugtit" mentiontitle="orgGroups" zc_grouping_title >'+Resource.getRealValue("common.groups")+"<span>( "+Resource.getRealValue("common.groups.members.notified")+' )</span></div></div><div class="srchlstctgrp" categorygroup="externalcontacts" ><div class="mtnsugtit" mentiontitle="external" zc_grouping_title >'+Resource.getRealValue("common.external.users")+"<span> ("+Resource.getRealValue("common.user.will.not.notified")+')</span></div></div><div class="srchlstctgrp" categorygroup="botcontacts" ><div class="mtnsugtit" mentiontitle="bot" zc_grouping_title >'+Resource.getRealValue("bots.title")+'<span> </span></div></div><div class="srchlstctgrp" categorygroup="channels"><div class="mtnsugtit" mentiontitle="channel" zc_grouping_title>'+Resource.getRealValue("menuname.channelsandgroups")+'<span></span></div></div><div class="srchlstctgrp" categorygroup="chats"><div class="mtnsugtit" mentiontitle="chat" zc_grouping_title>'+Resource.getRealValue("menuname.chats")+"<span></span></div></div>";e.html(t)},emptyCallback:function(e,t,i){var a=$("#"+t);populateDOM=a.find("#"+i),hasresult=this.hasResult(a),loadingDOM=a.find("#loading"),populateDOM.removeAttr("furtherreq");var s=a.find('[furtherreq="true"]');"function"!=typeof this.clearcallback||hasresult||0!==s.length||(loadingDOM.remove(),this.clearcallback())},hasResult:function(e){for(var t=e.find("[searchcatagory]"),i=!1,a=0,s=t.length;s>a;a++)if(t[a].children.length>0){i=!0;break}return i},isPreviouslySearched:function(e,t){var i=0,a=e.length;for(isPreviouslySearched=!1;a>i;i++)if(0===t.indexOf(e[i])){isPreviouslySearched=!0;break}return e.length>5&&e.splice(0,e.length),isPreviouslySearched},updateParticipants:function(e,t,i){if(t.content){var a='<div id="participants" searchcatagory="participants" >'+t.content+"</div>";SearchAgent.appendInDom(e,a,i.groupingmode),ChatUI.loadVisibleImages(e[0])}var s=t.searchedlist.length;return i.totalsearchedlength=s,i.furtherrequestmade=t.furtherreqmade,i.peopledata&&Users.updateUserDetails(t.searchedlist,e,!0),s>=25&&(i.addscroll=!0),i},updateResultsContainer:function(e,t){var i=e.totalsearchedlength,a=e.furtherrequestmade;if(0===i&&a){var s='<div class="zcuserstatus" id="loading"><div class="imgview-loadng"></div></div>';t.append(s)}var n=a||0!==i||MentionsUI.hasMentionSearch(e);if(null!==this.clearcallback&&null!==this.srcid)if(n){{"block"===$("#"+this.destid).css("display"),MainUI.currentchat}t.find('[purpose="search"]').first().addClass("srchbn sel"),Clickoutside.clear(this.destid),Clickoutside.bind({srcid:this.srcid,destid:this.destid,callback:function(e){"function"==typeof SearchAgent.clearcallback&&SearchAgent.clearcallback(e)}});var r=t.parent();if(r.length){t.attr("zc_sticky_title_list","");var o=$('<div><div class="mtnsugautotitle mtnsugtit" zc_sticky_title ></div></div>');r.html(o),o.append(t),$Util.initializeStickyTitle(r)}ZCScroll.scrollTop($("#"+this.destid),0)}else Composer.clearAutoComplete(e.chid),this.clearcallback();return e.addscroll&&(e.domfinder={key:"searchcatagory",value:"participants"},ZCScroll.customScroll($("#"+e.listid)),$Scroll.handleScroll($("#"+e.listid),e,SearchAgent.getParticipants)),n},getResultsWithParticipants:function(e){var t=$("#"+e.listid),i=1;t.attr("pgno",i),e.successCallback=function(i,a){i===SearchAgent.val&&(SearchAgent.populateCategoryTitles($("#"+e.listid),e.groupingmode),t.html(""),e=SearchAgent.updateParticipants(t,a,e),e.addscroll||(e.ignoreparticipants=!0),SearchAgent.getResultsWithoutParticipants(e))};var a=this.getParticipants(e);a.furtherreq||e.successCallback(a)},getResultsWithoutParticipants:function(e){var t=e.val;return e.ignoreparticipants&&ChatUI.isExist(e.chid)?(Participants.getIDs(e.chid,function(i){t===e.val&&(e.ignorelist=e.ignorelist.concat(i),SearchAgent.getResults(e))}),!0):SearchAgent.getResults(e)}};var MediaPlayer={supported_audio_formats:[],supported_video_formats:[],cache:{},init:function(){MediaPlayer.initSupportedAudioFormats(),MediaPlayer.initSupportedVideoFormats()},handleClick:function(e,t){var i=(t.attr("id"),e.target.getAttribute("action")),a=MediaPlayer.getmediaobject(t);"play"===i?MediaPlayer.toggleplaypause(t,a):"speaker"===i?MediaPlayer.mute(t,a):/^volume/.test(i)?MediaPlayer.volume(t,a,i):"seek"===i?MediaPlayer.seek(t,a):"fullscreen"===i&&MediaPlayer.fullscreen(t)},handleFullscreen:function(e){if(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)$zcg.CANCELEVENT=!1;else if($zcg.CANCELEVENT=!0,e=$zcg.videoelement){e.removeAttr("style"),$(e).find("#playarea").removeAttr("style"),$(e).find("#comment").removeAttr("style"),$(e).find("#videorightbtns").removeAttr("style");var t=e.parents("#chatbody");t.length&&ZCScroll.resetScroll(t),delete $zcg.videoelement}},initSupportedAudioFormats:function(){if(!Sound.IS_AUDIO_TAG_SUPPORTED)return!1;for(var e=new Audio,t=["mp3","mpeg","wav","aac","amr","flac","gsm","tta","wv","x-wav","x-m4a"],i=0,a=t.length;a>i;i++)""!==e.canPlayType("audio/"+t[i])&&"no"!==e.canPlayType("audio/"+t[i])&&this.supported_audio_formats.push("audio/"+t[i])},initSupportedVideoFormats:function(){if(!Sound.IS_VIDEO_TAG_SUPPORTED)return!1;var e=document.createElement("video");this.IS_VIDEO_TAG_SUPPORTED=!!e.canPlayType;for(var t=["webm","mkv","flv","ogg","avi","mov","qt","wmv","asf","mp4","3gp","quicktime"],i=0,a=t.length;a>i;i++)""!==e.canPlayType("video/"+t[i])&&"no"!==e.canPlayType("video/"+t[i])&&this.supported_video_formats.push("video/"+t[i])},isSupportedAudioFormat:function(e){return this.supported_audio_formats.indexOf(e)>-1?!0:!1},isSupportedVideoFormat:function(e){return this.supported_video_formats.indexOf(e)>-1?!0:!1},getmediaobject:function(e){var t=e.attr("fileid"),i=e.attr("source"),a=e.parents("[chid]").attr("chid"),s=e.parents("[opener]").attr("opener");if(MediaPlayer.cache[s]||(MediaPlayer.cache[s]={}),MediaPlayer.cache[s][a]||(MediaPlayer.cache[s][a]={}),MediaPlayer.cache[s][a][t])return MediaPlayer.cache[s][a][t];if("audioplayer"===e.attr("id"))var n=new Audio(i);else{var n=e.find("#video")[0];n.setAttribute("src",i)}return MediaPlayer.bindevents(e,n),MediaPlayer.cache[s][a][t]=n,n},bindevents:function(e,t){var i=e.parents("[chid]").attr("chid"),a=e.attr("id");$(t).on("ended",function(){e.find('[purpose="toggleclass"]').removeClass("zcf-pause").addClass("zcf-play"),e.find(".zcvdopmn").addClass("zcvdo-showcntrl"),e.find('[purpose="toggleclass"]').attr("operation","play"),e.find("#currenttime").html("0:00"),e.find("#scroll").css("left","0"),e.find("#scrollcrcl").css("left","0"),e.find("#played").css("width","0"),ChatsList.updateMediaPlayingStatus(i,a,!1)}),$(t).on("loadedmetadata",function(){var i=$Util.formatsecondstotime(t.duration);e.find("#duration").html(i)}),$(t).on("timeupdate",function(){var i=Math.floor(100/t.duration*t.currentTime);e.find("#scroll").css("left",i+"%"),e.find("#scrollcrcl").css("left",i+"%"),e.find("#played").css("width",i+"%"),e.find("#currenttime").html($Util.formatsecondstotime(t.currentTime))})},toggleplaypause:function(e,t){var i=e.attr("id"),a=e.parents("[chid]").attr("chid"),s=e.find('[purpose="toggleclass"]');if(e.find("#VideoControl").removeClass("dN"),e.find("#fileforwardicon").addClass("dN"),t.paused){ChatsList.updateMediaPlayingStatus(a,i,!0);var n=$('[purpose="toggleclass"]');Chat.pauseAllMedia(),n.attr("operation","play"),n.addClass("zcf-play").removeClass("zcf-pause"),t.play(),s.addClass("zcf-pause").removeClass("zcf-play"),s.attr("operation","pause"),e.find("#screenplay").attr("operation","play"),e.find("#screenplay").addClass("zcf-play").removeClass("zcf-pause"),e.find(".zcvdopmn").removeClass("zcvdo-showcntrl"),e.find("#screenplay").show(),e.find("#screenplay").fadeOut(500)}else ChatsList.updateMediaPlayingStatus(a,i,!1),t.pause(),s.addClass("zcf-play"),s.removeClass("zcf-pause"),s.attr("operation","play"),e.find("#screenplay").addClass("zcf-pause").removeClass("zcf-play"),e.find(".zcvdopmn").addClass("zcvdo-showcntrl"),e.find("#screenplay").attr("operation","pause"),e.find("#screenplay").show()},seek:function(e,t){t.pause();var i=event.clientX,a=e.find("#seek").offset().left,s=Math.floor(100*(i-a)/e.find("#seek").width()),n=t.duration*s/100,r=(e.parents("[chid]").attr("chid"),e.attr("id"),e.find('[purpose="toggleclass"]'));isNaN(t.duration)||(t.src=t.getAttribute("src"),t.currentTime=n,e.find("#scroll").css("left",s+"%"),e.find("#scrollcrcl").css("left",s+"%"),t.play(),r.addClass("zcf-pause").removeClass("zcf-play"),r.attr("operation","pause"),e.find("#screenplay").attr("operation","play"),e.find("#screenplay").addClass("zcf-play").removeClass("zcf-pause"),e.find("#screenplay").fadeOut(500))},volume:function(e,t,i){var a=e.find('[action="speaker"]'),s=i.slice(-1);if(t.volume=.2*s,"off"===e.find("#volume"+s).attr("operation")){for(var n=1;s>=n;n++)e.find("#volume"+n).attr("class","zcvol"+n+" zvlmsel"),e.find("#volume"+n).attr("operation","on");a.attr("class","msi-spkon floatl"),a.attr("operation","mute")}else for(var n=5;n>s;n--)e.find("#volume"+n).attr("class","zcvol"+n),e.find("#volume"+n).attr("operation","off")},mute:function(e,t){var i=e.find('[action="speaker"]');if("mute"===i.attr("operation")){t.volume=0,i.removeClass("zcf-sound").addClass("zcf-soundmute"),i.attr("operation","unmute");for(var a=1;5>=a;a++)e.find("#volume"+a).attr("class","zcvol"+a)}else{t.volume=1,i.removeClass("zcf-soundmute").addClass("zcf-sound"),i.attr("operation","mute");for(var a=5;a>=1;a--)"on"===e.find("#volume"+a).attr("operation")&&e.find("#volume"+a).attr("class","zcvol"+a+" zvlmsel")}},fullscreen:function(e){$Dom.openFullScreen(e[0]),$zcg.videoelement=e,e.height($(document).height()-40),e.find("#playarea").height($(document).height()-40),e.find("#playarea").css("background-color","black"),e.find("#comment").attr("style","display:none"),e.find("#videorightbtns").attr("style","display:none")}},LeftPannel={};LeftPannel={container:"",detailstimer:"",components:{},init:function(){this.container=UI.container.find("#leftpannel"),this.container.find("#userimage").find("img").attr("src",$zcg._PHOTOSERVER+"/file?fs=thumb&nocache="+Date.now()),this.bindEvents()},hasComponent:function(e){return this.components.hasOwnProperty(e)},updateCallback:function(e){this.components[e.type]=e},bindEvents:function(){var e=this.container.find("#list");e.on("click","[elemtype]",function(e){LeftPannel.delegate(e,this)}),e.on("mouseenter mouseleave","[elemname]",function(e){"mouseleave"===e.type&&clearTimeout(LeftPannel.detailstimer),LeftPannel.delegate(e,this)}),e.on("click",'[purpose="emptymsg"]',function(e){"contaddatempty"===this.id&&ContactsUI.inviteContactUI.create(e,this.id)}),e.on("scroll",function(){LeftPannel.hidePopups(),$Util.debounce(ChatsList.updateUnreadNotifier())}),e.on("click",'[purpose="notifyunread"]',function(){var t,i=$Util.cloneArray(ChatsList.unreadelements.top),a=$Util.cloneArray(ChatsList.unreadelements.bottom);if(i.length>0){var s=ChatsList.sortUnreadChatsByPosition(i);t=$("#"+s[0][0])}else{if(!(a.length>0))return;var n=ChatsList.sortUnreadChatsByPosition(a,!0);t=$("#"+n[0][0])}$Util.scrollToView(t,e,400)})},hidePopups:function(){var e=$("[closeonscroll]");if(e.length){$("#outercontainer").find('[operation="createorjoin"].show').removeClass("show");var t=e[0].getAttribute("id");e[0].remove(),Clickoutside.clear(t)}},delegate:function(e,t){"click"===e.type&&(LeftPannel.hidePopups(),this.handleClick(t,e)),"mouseenter"===e.type&&this.mouseover(t,e),"mouseleave"===e.type&&this.mouseout(e,t)},mouseover:function(e,t){if(clearTimeout(LeftPannel.detailstimer),!$Util.isSameorHoverElement(e,t.relatedTarget)){var i=$(e).parent(),a=i.attr("elemtype");if("triggerhome"===a)return void HoverDetails.hide();if(LeftPannel.components.hasOwnProperty(a)){var s=i.find('[purpose="status"]'),n=!1;$WC.$CUtil.isEmpty(s)||(n=[s.attr("typing"),s.attr("nname")]),this.detailstimer=setTimeout(function(){clearTimeout(LeftPannel.detailshidetimer),LeftPannel.container.find(".sel").removeClass("sel"),i.addClass("sel"),LeftPannel.hidePopups(),HoverDetails.show(i,!0,n)},800)}}},mouseout:function(e,t){return $Util.isSameorHoverElement(t,e.relatedTarget,"hover")?void clearTimeout(LeftPannel.detailstimer):(clearTimeout(this.detailshidetimer),void(this.detailshidetimer=setTimeout(function(){return LeftPannel.ishovered?void clearTimeout(LeftPannel.detailstimer):(LeftPannel.container.find(".sel").removeClass("sel"),void HoverDetails.hide())},300)))},handleClick:function(e,t){var i,a=e.getAttribute("elemtype");this.hideDetails(),"create"===a?(i=LeftPannel.components[e.getAttribute("workfor")],i&&i.hasOwnProperty("create")&&i.create(t,e),t.stopPropagation()):"header"===a?(i=LeftPannel.components[e.getAttribute("workfor")],i&&i.hasOwnProperty("headeraction")&&i.headeraction(t,e)):"markallread"===a?(i=LeftPannel.components[e.getAttribute("workfor")],i&&i.hasOwnProperty("markallread")&&i.markallread(t,e),t.stopPropagation()):"more"===a?(i=LeftPannel.components[e.getAttribute("workfor")],i&&i.hasOwnProperty("more")&&i.more(t,e)):LeftPannel.components.hasOwnProperty(a)&&(i=LeftPannel.components[a],i.hasOwnProperty("action")&&i.action(t,e))},toggleHeader:function(e){var t,i,a=$("#leftpannel #list"),s=LeftPannel.container.find("#"+e+"list");switch(s.length&&(t=$Util.getSpeedForSliding(s),i="none"===s.css("display")),e){case"chats":case"mutedchats":showmoreDOM=$("#"+e+"listholder").find("[expand]"),i?showmoreDOM.show():showmoreDOM.hide();break;case"generalcontacts":s=LeftPannel.container.find("#generalcontactslistholder"),t=$Util.getSpeedForSliding($("#topcontactslist")),i="none"===s.css("display");break;case"botcontacts":s=LeftPannel.container.find("#botcontactslistholder"),t=$Util.getSpeedForSliding($("#topbotcontactslist")),i="none"===s.css("display");break;case"channels":t=ChannelsUI.List.LHS.slideSlow(s)?"slow":$Util.getSpeedForSliding(s),i?$("#channelspendinglist").fadeIn():$("#channelspendinglist").fadeOut()}i?s.slideDown(t,function(){ZCScroll.updateScroll(a),ChatsList.updateUnreadNotifier()}):s.slideUp(t,function(){ZCScroll.updateScroll(a),ChatsList.updateUnreadNotifier()})},hideDetails:function(){clearTimeout(this.detailstimer),HoverDetails.hide()},setHeight:function(e){this.container.height(e),e-=this.container.find("#userdetail").outerHeight(),this.container.find("#list").height(e)},clearHoverTimeOut:function(){clearTimeout(LeftPannel.detailshidetimer),clearTimeout(LeftPannel.detailstimer),LeftPannel.container.find(".sel").removeClass("sel"),LeftPannel.ishovered=!1},LHSList:{limit:{chats:10,mutedchats:5},fetchConversations:function(){var e=[Chat.getPinnedChats,Chat.getRecentChatsFromServer],t=0,i=setInterval(function(){e[t++%e.length](),t==e.length&&clearInterval(i)},500)},populateChats:function(e){e="undefined"==typeof e?"chats":e;var t,i=LeftPannel.container.find("#"+e),a=ChatsList.getAll(e),s=[],n=[];for(t in a)if(a.hasOwnProperty(t)){switch(e){case"mutedchats":if(!ChatUI.isMuted(t)||ChatUI.isPinned(a[t]))continue;break;case"pinnedchats":if(!ChatUI.isPinned(a[t]))continue;break;case"chats":if(ChatUI.isPinned(a[t])||ChatUI.isMuted(t))continue}var r=a[t].lastmsginfo,o=-1;"undefined"!=typeof r&&r.time&&(o=parseInt(r.time));var l=ChatUI.hasUnreadOrUnseenMsgs(t);l?n.push([t,o]):s.push([t,o])}var c=$Util.sort(n,1,!0);c=c[c.length-1],s=n.concat(s),s=$Util.sort(s,1,!0);var d="",u=s.length,m=-1,p=0;if("chats"===e||"mutedchats"===e){var h=LeftPannel.LHSList.limit[e];m=n.length>h?n.length:u>h?s.indexOf(c)>=h?s.indexOf(c)+1:h:u}for(var g=0;u>g;g++){t=s[g][0];var f=$Util.cloneObject(a[t]);if(f.chid=t,f.deleted||f.removed)ChatsList.delete(f.chid);else{var v=ChatsList.parseDetails(f);if(v&&(this.removeDuplicatesFromOtherCategory(t,e),d+=ChatsList.getHtml(e,t,f,v),++p==m))break}}if($.trim(d).length>0){i.html(ChatsList.getHolderHTML(e,p>ChatsList.uilimit)),this.hideLHSCategory(i,e);var C=i.find("#"+e+"list");C.html(d),"chats"!==e&&"mutedchats"!==e||0!==i.find("#chatsshowmore").length||this.removeOrAddShowMore(e,C.children().length>ChatsList.uilimit)}else if("chats"===e||"pinnedchats"===e){i.html(ChatsList.getHolderHTML(e,p>ChatsList.uilimit)),this.hideLHSCategory(i,e);var y="pinnedchats"===e?'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("pinnedchat.none")+"</div>":'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("chat.none")+"</div>";i.find("#"+e+"list").html(y)}LeftPannel.LHSList.rearrangeLHSList(e),ChatsList.updateChatsHeaderHtml(e),_doChangesIfInitialised(e)},hideLHSCategory:function(e,t){var i=Settings.getFromObj("hp"+t);i||($("#"+t+"list").hide(),"chats"===t?e.find("#chatsshowmore").hide():"mutedchats"===t&&e.find('[elemtype="more"]').hide())},rearrangeLHSList:function(e,t){if("pinnedchats"!==e){if("undefined"==typeof e){e="chats";var i=t.chid,a=ChatUI.isChannel(t.ctype),s=a?Channels.getChatObjFormat(Channels.getByChid(i)):ChatsList.get(i);e=ChatUI.isMuted(i)?"mutedchats":s.ispinned?"pinnedchats":e}ChatsList.rearrangeChats(e),a&&ChannelsUI.List.LHS.rearrangeChannelsList()}},removeDuplicatesFromOtherCategory:function(e,t){LeftPannel.container.find('[id = "tab'+e+'"][catagory != "'+t+'"]').remove()},removeOrAddShowMore:function(e,t){var i,a=LeftPannel.container.find("#"+e),s=a.find("#"+e+"list");i=a.find(t?"#chatsshowall":"#chatsshowmore"),i.length&&i.remove(),"chats"===e?t&&0===a.find("#chatsshowmore").length?s.after('<div id="chatsshowmore" class="zcuserstatus zcmorechl"  style="display:'+(Settings.getFromObj("hp"+e)?"block":"none")+'" expand="false" category="'+e+'" ><span class="showmore" workfor="chat" elemtype="more">'+Resource.getRealValue("app.show.more")+'</span><span id="unreadcount" class="msgnotify unreadchts dN"></span></div>'):t||0!==a.find("#chatsshowall").length||s.after('<div id="chatsshowall" class="zcuserstatus zcmorechl" style="display:'+(Settings.getFromObj("hp"+e)?"block":"none")+'" expand="false" category="'+e+'"><span class="showmore" workfor="chat" elemtype="more" purpose="gotohistory">'+Resource.getRealValue("common.showall")+"</span></div>"):"mutedchats"===e&&t&&0===a.find("[elemtype='more']").length&&s.after('<div class="zcuserstatus zcmorechl"  style="display:'+(Settings.getFromObj("hp"+e)?"block":"none")+'" expand="false" category="'+e+'" ><span class="showmore" workfor="chat" elemtype="more">'+Resource.getRealValue("app.show.more")+"</span></div>")},removeFromAllCategories:function(e,t){if(0!==LeftPannel.container.find("#tab"+e).length)for(var i=["chats","mutedchats","pinnedchats"],a=0;a<i.length;a++)i[a]!==t&&ChatsList.removeFromUI(e,i[a])},addNewInUI:function(e,t,i){if(0!==t.length){var a="",s=LeftPannel.container.find("#"+e),n=s.find('[emptymsg="true"]');n.length>0&&n.remove();for(var r=0,o=t.length;o>r;r++){var l=t[r],c=ChatsList.get(l);if("undefined"==typeof c||Chat.isChannelChid(l)){var d=Channels.getByChid(l);$WC.$CUtil.isEmptyObject(d)||(c=Channels.getChatObjFormat(d))}if("undefined"==typeof c||!("pinnedchats"==e&&!c.ispinned||"chats"==e&&(c.ispinned||ChatUI.isMuted(l)))){c.chid=l;var u=ChatsList.parseDetails(c);u&&("channel"!==u.profile||Channels.getObject(u.profileid)||c?(this.removeDuplicatesFromOtherCategory(l,e),0!==s.find("#tab"+l).length||i?ChatsList.updateElement(l,null,!0):a+=ChatsList.getHtml(e,l,c,u)):ChatsList.delete(c.chid))}}var m=s.find("#"+e+"list");if($.trim(a).length>0)0===m.length&&(s.html(ChatsList.getHolderHTML(e,!1)),m=s.find("#"+e+"list")),m.prepend(a),("chats"===e||"mutedchats"===e)&&this.removeOrAddShowMore(e,m.children().length>ChatsList.uilimit);else if(0===m.children().length&&("chats"===e||"pinnedchats"===e)){var p="pinnedchats"===e?'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("pinnedchat.none")+"</div>":'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("chat.none")+"</div>";s.find("#"+e+"list").html(p)}LeftPannel.LHSList.rearrangeLHSList(e),ChatsList.updateChatsHeaderHtml(e)}}}};var StatusController={},StatusUI={},MySelf={};StatusController={STATUS_LIST_FETCH_TIME:-1,updateDefault:function(e,t){if($DB.sessionstoragesupport){var i=$DB.get("status");i.Default[0]=t,i.Default[1]=e,$DB.update("status",i)}else $DB.get("status").Default[0]=t,$DB.get("status").Default[1]=e;MySelf.setScode()},getScode:function(){return $DB.get("status").Default[1]},updateStatusfromOthertab:function(e,t){parseInt(e)!==$zcg.CON_IDLE&&StatusController.updateDefault(e,t),StatusUI.update(e,t),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateCustomStatus([e,t])},get:function(e){if(e||$DB.isEmpty("status")){if(StatusController.STATUS_LIST_FETCH_TIME>$zcg.WMS_DISCONNECT_TIME)return;$ZCAjx.ajax({url:"/getstatus.do",success:function(e){for(var t=e.User.length,i=0;t>i;i++)e.User[i]=$WC.$CUtil.decodeHTMLEntities(e.User[i]);e.Default[0]=$WC.$CUtil.decodeHTMLEntities(e.Default[0]),$DB.update("status",e),StatusController.STATUS_LIST_FETCH_TIME=(new Date).getTime(),e.Default.length>0&&StatusUI.update(e.Default[1],e.Default[0]),MySelf.setScode(),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateCustomStatus([e.Default[1],e.Default[0]]),"block"===$("#ztb-customstatus").css("display")&&StatusUI.showCustomOptions()}})}else StatusUI.update($DB.get("status").Default[1],$DB.get("status").Default[0])},set:function(e,t,i){if(parseInt(e)===parseInt($DB.get("status").Default[1])&&t===$DB.get("status").Default[0])return void StatusUI.update(e,t);var a=$("#showcstmoptns");a.removeClass("msi-dwnarw").addClass("reqprocess_anim"),$ZCAjx.ajax({url:"/setstatus.do",type:"POST",data:{scode:e,smsg:t},success:function(){if(setTimeout(function(){a.removeClass("reqprocess_anim").addClass("msi-ticktwo")},500),-1===$.inArray(t,$DB.get("status").System)&&-1===$.inArray(t,$DB.get("status").User))if($DB.sessionstoragesupport){var s=$DB.get("status");s.User.push(t),$DB.update("status",s)}else $DB.get("status").User.push(t);StatusController.updateDefault(e,t),StatusUI.update(e,t),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateCustomStatus([e,t]),"function"==typeof i&&i(),setTimeout(function(){a.removeClass("msi-ticktwo").addClass("msi-dwnarw")},1500)},error:function(){UI.updateBanner(Resource.getRealValue("status.update.error"),2e3,!0),StatusUI.update($DB.get("status").Default[1],$DB.get("status").Default[0]),a.removeClass("reqprocess_anim").addClass("msi-dwnarw")}})},clear:function(e){$ZCAjx.ajax({url:"/clearcstatus.do",type:"POST",success:function(){$DB.update("status",{Default:["Available","1"],User:[],System:["Available","Busy","Invisible"]}),"function"==typeof e&&e()}})}},StatusUI={blurTimeOut:"",init:function(){var e=$("#userstatusdetails"),t=e.find("#currentscode"),i=e.find("#stmsgeditor");e.find("[showstatusoptions]").on("click",function(e){Clickoutside.bind({srcid:"statusoptionscont",destid:"statusoptions",event:e,customShow:function(e){var t=$("#"+e.srcid);t.addClass("showactive")},customHide:function(e){var t=$("#"+e.srcid);t.removeClass("showactive")}})}),e.find('[purpose="setscode"]').on("click",function(e){var a=$DB.get("status"),s=(a.Default[1],a.Default[0]),n=this.getAttribute("scode"),r=this.getAttribute("smsg"),o='<span class="status zcstatus-'+n+' dsinblk"></span>';t.html(o),t.attr("scode",n);var l=r;"2"!==n&&-1===a.System.indexOf(s)&&(l=$WC.$CUtil.isEmpty(s)?r:s),i.val(l),StatusController.set(n,$WC.$CUtil.decodeHTMLEntities(l)),Clickoutside.handleClickOnChild(e)}),e.find("#statusmsg").on("click","[data-target]",function(e){e.stopPropagation();var a=this.getAttribute("data-target"),s=this.getAttribute("scode"),n=$DB.get("status").Default[1];if(s){n=s;var r='<span class="status zcstatus-'+n+' dsinblk"></span>';t.html(r),t.attr("scode",n)}i.val(a),StatusController.set(n,$WC.$CUtil.decodeHTMLEntities(a)),Clickoutside.handleClickOnChild(e)}),i.on("click",function(){$(this).select()}),e.find("#showcstmoptns").on("click",function(e){clearTimeout(StatusUI.blurTimeOut),i.select();var a=t.attr("scode");StatusUI.populateStatusMsgDropdown(e,a)}),i.on("blur",function(){StatusUI.blurTimeOut=setTimeout(function(){var e=i.attr("scode"),a=t.attr("scode");if(e){a=e;var s='<span class="status zcstatus-'+a+' dsinblk"></span>';t.html(s),t.attr("scode",a)}var n=i.val();""===n&&(n=$DB.get("status").Default[0],i.val(n)),StatusController.set(a,$WC.$CUtil.decodeHTMLEntities(n))},500)}),i.on("keyup",function(e){e.stopImmediatePropagation();var a=e.which,s=t.attr("scode");if(e.shiftKey&&13===a)return!0;if(a===$zcg.ESCAPE_KEYCODE)return void i.blur();if(a===$zcg.UP_KEYCODE||a===$zcg.DOWN_KEYCODE){var n=$("#statusmsgsugg");DropdownUtil.handleListNavigation(e,n,"[data-target]");var r=n.find(".sel"),o=r.attr("data-target"),s=r.attr("scode");return"undefined"!=typeof s?i.attr("scode",s):i.removeAttr("scode"),void i.val(o)}if(13===a)return StatusUI.clearDropdown(),e.preventDefault(),void i.blur();var s=t.attr("scode"),l=i.val();$WC.$CUtil.isEmpty(l)?StatusUI.clearDropdown():StatusUI.populateStatusMsgDropdown(e,s,l),"2"===s&&e.preventDefault()}),i.on("keydown",function(e){e.stopImmediatePropagation();var i=t.attr("scode");"2"===i&&e.preventDefault()})},clearDropdown:function(){$("#custstatusmsg").removeClass("showactive"),$("#statusmsgsugg").find("ul").html(""),Clickoutside.clear("statusmsgsugg")},populateStatusMsgDropdown:function(e,t,i){var a=$DB.get("status"),s="";if("2"!==t){var n=[Resource.getRealValue("status.default.option1"),Resource.getRealValue("status.default.option2"),Resource.getRealValue("status.default.option3")],r=a.Default[0],o=(a.System,a.User),l=i?new RegExp(i,"gi"):"",c=$Util.removeDuplicateEntries(n.concat(o));$WC.$CUtil.isEmpty(i)?(s+='<li scode="1" data-target="'+Resource.getRealValue("common."+a.System[0].toLowerCase())+'" class="ellips cur '+(r===a.System[0]?"sel_status":"")+'"><span class="status zcstatus-1 dsinblk mrgR10"></span>'+Resource.getRealValue("common."+a.System[0].toLowerCase())+" ("+Resource.getRealValue("profileview.status.default")+")</li>",s+='<li scode="3" data-target="'+Resource.getRealValue("common."+a.System[1].toLowerCase())+'" class="ellips cur '+(r===a.System[1]?"sel_status":"")+'"><span class="status zcstatus-3 dsinblk mrgR10"></span>'+Resource.getRealValue("common."+a.System[1].toLowerCase())+" ("+Resource.getRealValue("profileview.status.default")+")</li>"):"1"===t&&a.System[0].toLowerCase().indexOf(i.trim().toLowerCase())>=0?s+='<li scode="1" data-target="'+Resource.getRealValue("common."+a.System[0].toLowerCase())+'" class="ellips cur '+(r===a.System[0]?"sel_status":"")+'"><span class="status zcstatus-1 dsinblk mrgR10"></span>'+Resource.getRealValue("common."+a.System[0].toLowerCase()).replace(l,'<b class="clr0">$&</b>')+" ("+Resource.getRealValue("profileview.status.default")+")</li>":a.System[1].toLowerCase().indexOf(i.trim().toLowerCase())>=0&&(s+='<li scode="3" data-target="'+Resource.getRealValue("common."+a.System[1].toLowerCase())+'" class="ellips cur '+(r===a.System[0]?"sel_status":"")+'"><span class="status zcstatus-3 dsinblk mrgR10"></span>'+Resource.getRealValue("common."+a.System[1].toLowerCase()).replace(l,'<b class="clr0">$&</b>')+" ("+Resource.getRealValue("profileview.status.default")+")</li>");for(var d=0;d<c.length;d++)c[d]=$WC.$CUtil.processXSS(c[d]),i?c[d].toLowerCase().indexOf(i.trim().toLowerCase())>=0&&(s+='<li title="'+c[d]+'" data-target="'+c[d]+'" class="ellips cur '+(r===c[d]?"sel_status":"")+'">'+c[d].replace(l,'<b class="clr0">$&</b>')+"</li>"):s+='<li title="'+c[d]+'"  data-target="'+c[d]+'" class="ellips cur  '+(r===c[d]?"sel_status":"")+'">'+c[d]+"</li>"}else s+='<li scode="1"  title="'+Resource.getRealValue("common."+a.System[0].toLowerCase())+'"  data-target="'+Resource.getRealValue("common."+a.System[0].toLowerCase())+'" class="ellips cur"><span class="status zcstatus-1 dsinblk mrgR10"></span>'+Resource.getRealValue("common."+a.System[0].toLowerCase())+" ("+Resource.getRealValue("profileview.status.default")+")</li>",s+='<li scode="3"  title="'+Resource.getRealValue("common."+a.System[1].toLowerCase())+'"  data-target="'+Resource.getRealValue("common."+a.System[1].toLowerCase())+'" class="ellips cur"><span class="status zcstatus-3 dsinblk mrgR10"></span>'+Resource.getRealValue("common."+a.System[1].toLowerCase())+" ("+Resource.getRealValue("profileview.status.default")+")</li>";var u=$("#statusmsgsugg ul");u.html(s),-1===Clickoutside.currentchain.indexOf("statusmsgsugg")?Clickoutside.bind({srcid:"showcstmoptns",destid:"statusmsgsugg",event:e,customShow:function(){$("#custstatusmsg").addClass("showactive")},customHide:function(){StatusUI.clearDropdown()}}):$WC.$CUtil.isEmpty(s)&&StatusUI.clearDropdown(),ZCScroll.resetScroll($("#statusmsgsugg"))},updateDefaultStatus:function(){var e=$DB.get("status"),t=e.Default[1],i=Resource.getRealValue(e.Default[0]),a=$("#userstatusdetails"),s=a.find("#currentscode"),n='<span class="status zcstatus-'+t+' dsinblk"></span>';s.html(n),s.attr("scode",""+t);var r=a.find("#stmsgeditor");r.val(i)},update:function(e,t){t=$WC.$CUtil.decodeHTMLEntities(t);var i=$("#ztb-topband").find('div[purpose="userimage"]');i.find(".usrstatus").removeClass().addClass("usrstatus zcstatus-"+e)}},MySelf={idletimer:"",scode:"",sessionidle:!1,activerequest:!1,busyState:!1,setScode:function(){this.scode=parseInt($DB.get("status").Default[1]),this.busyState="3"==this.scode},idle:function(){if(!this.sessionidle&&this.scode!==$zcg.CON_INVISIBLE){var e={};e.sid=WmsImpl.getSid();var t=$DB.get("status").Default[0];e.smsg=t===Resource.getRealValue("common.available")||t===Resource.getRealValue("common.busy")?Resource.getRealValue("common.idle"):t,$ZCAjx.ajax({url:"/useridle.do",type:"POST",data:e,success:function(t){MySelf.scode=$zcg.CON_IDLE,MySelf.sessionidle=!0,MySelf.activerequest=!1,AutoUpdater.handleLatestClientVersion(t.latestclientversion),"true"==t.updateClient&&AutoUpdater.handleIdleState(),WmsLite.setIdleStatusInClient(!0),MySelf.busyState||StatusUI.update(MySelf.scode,e.smsg)},error:function(){MySelf.runIdletimer(5e3)}})}},active:function(){if(!this.activerequest&&this.sessionidle&&this.scode!==$zcg.CON_INVISIBLE){this.activerequest=!0;var e={sid:WmsImpl.getSid(),scode:parseInt($DB.get("status").Default[1])};$ZCAjx.ajax({url:"/useractive.do",type:"POST",data:e,success:function(e){MySelf.scode=parseInt($DB.get("status").Default[1]),MySelf.sessionidle=!1,StatusUI.update(MySelf.scode,$DB.get("status").Default[0]),WmsLite.setIdleStatusInClient(!1),_isDesktopApp()&&e&&e.seasonal_icon&&($zcg._SEASONALICONS=e.seasonal_icon,DesktopApp.IPC.send("update-seasonal-icon",$zcg._SEASONALICONS))},error:function(){MySelf.activerequest=!1}})}this.scode===$zcg.ONLINE&&this.runIdletimer()},runIdletimer:function(e){void 0===e&&(e=$zcg._USERIDLETIME),clearTimeout(this.idletimer),this.idletimer=setTimeout(function(){MySelf.idle()},e)}};var Contacts={},ContactsHandle={},Users={},OrgInvitees={};Contacts={INVITED:-1,statuscodes:{ADD_TO_CONTACTS:-7},statusobj:{"-7":"contact.add.user","-6":"contact.accept.invite","-4":"contact.add.user","-3":"contact.accept.invite","-2":"common.declined","-1":"contact.invited",0:"common.offline",1:"common.available",2:"common.offline",3:"common.busy",4:"common.idle"},searchhtml:'<div uid="{USERID}" data-val="{DNAME}" elemtype="contact" purpose="search"><span class="usrimgsts"><img width="24" height="24" src="{IMGURL}"><span class="{STATUSCLASS}"></span></span><span id="contactdname{USERID}" class="usrname ellips">{DNAMEVAL}<em id="contactmailid{USERID}">{EMAILID}</em></span></div>',update:function(e){var t=$DB.get("contacts");for(var i in e){var a,s,n,r,o,l,c,d=e[i],u=d.s;if("undefined"!=typeof u){var m=u.split(":",5),p=m.join(":").length+1,h=u.substring(p);h=JSON.parse(h),a=parseInt(m[0]),s=m[1],n=parseInt(m[2]),r=parseInt(m[3]),o=h[0],l=$WC.$CUtil.isEmpty(h[1])?s:$WC.$CUtil.processXSS(h[1])}else a=parseInt(d.scode),s=$WC.$CUtil.isEmpty(d.email)?"":d.email,n="undefined"!=typeof d.st?parseInt(d.st):1,r="undefined"!=typeof d.uc?parseInt(d.uc):0,o=d.smsg,l=$WC.$CUtil.isEmpty(d.dname)?s:$WC.$CUtil.processXSS(d.dname),c=d.photo;a!==$zcg.CON_REMOVE&&(t[i]=t[i]||{},t[i].status=a,t[i].st=n,t[i].uc=r,t[i].smsg=o,t[i].zuid=i,t[i].dname=l,t[i].ownerid=WmsImpl.getZuid(),t[i].emailid=s,t[i].photo="",d.isbot&&(t[i].chid=d.chid,t[i].photo=d.photo,t[i].isbot=!0,t[i].uniquename=d.uniquename,t[i].desc=d.desc,t[i].permission=d.permission,d.app&&(t[i].app=d.app),ChatBot.storeIfSystemBot(t[i])))}},getWmsBotId:function(e){return e.startsWith("b-")?e:"b-"+e},storeBotsAsContacts:function(e){var t={};for(var i in e){var a={isbot:!0,email:Resource.getRealValue("chatbot.smsg"),smsg:Resource.getRealValue("chatbot.smsg"),type:"",scode:1,uc:0,zuid:""};a.dname=e[i].name,a.photo=e[i].photo||e[i].photoid,a.chid=e[i].chid,MyBots.chidVsBotId[a.chid]=i;var s=e[i].status;if(!$WC.$CUtil.isEmpty(s)){var n=Math.round(Math.random()*(s.length-1));a.smsg=s[n],a.email=s[n]}e[i].info?(e[i].info.store_appid&&(a.app={id:e[i].info.store_appid,name:e[i].info.name,photoid:e[i].info.photo_id,issandbox:e[i].info.issandbox}),e[i].info.desc&&(a.desc=e[i].info.desc),e[i].info.uniquename&&(a.uniquename=e[i].info.uniquename),e[i].info.uc&&(a.uc=e[i].info.uc),e[i].info.permission&&(a.permission=e[i].info.permission)):(a.desc=e[i].desc,a.uniquename=e[i].uniquename),i=this.getWmsBotId(i),t[i]=a}this.update(t)},updateBotActions:function(e,t){var i=$DB.get("contacts"),a=i[e];$WC.$CUtil.isEmpty(a)||(a.actionhandles=t,$DB.update("contacts",i))},getAll:function(){return $DB.get("contacts")},getAllUserContacts:function(e){var t={},i=this.getAll();for(var a in i)if(!this.isBot(a)){if(e&&this.isPending(a))continue;t[a]=i[a]}return t},getNonMutualOrgContacts:function(){var e={},t=$Util.cloneObject(Users.getAll(),!0);for(var i in t)if(!Contacts.isExist(i)&&!WmsImpl.isLocalUser(i)){var a=t[i];if(a.orguser===!0){var s={};s.dname=a.dname,s.emailid=a.emailid,s.zuid=i,s.photo="",s.photo="",s.status=-7,s.uc=-1,s.ownerid=WmsImpl.getZuid(),e[i]=s}}return e},getNonMutualOrgContact:function(e){return this.getNonMutualOrgContacts()[e]},getAllContactsforLHS:function(e){var t=this.getAllUserContacts(e),i=Object.keys(t).length;if(100>i){var a=this.getNonMutualOrgContacts(),s=$Util.getFirstNelemfromObj(a,100-i);return $.extend({},s,t)}return t},getAllBotContactsIds:function(){var e=[],t=this.getAll();for(var i in t)this.isBot(i)&&e.push(i);return e},getAllBotContacts:function(){var e={},t=this.getAll();for(var i in t)this.isBot(i)&&(e[i]=t[i]);return e},getPendingContactsList:function(e){var t=[],i=this.getAll();for(var a in i){var s=parseInt(i[a].status);s===$zcg.CON_REQACC?t.push(a):e||s!==$zcg.CON_REMIND_ME_LATER||t.push(a)}return t},getNonMutualContacts:function(){$ZCAjx.ajax({url:"/getnonmutualcontacts.do",success:function(e){Users.update(e)}})},updateStatus:function(e,t,i,a){this.isExist(e)&&($DB.get("contacts")[e].status=t,$DB.get("contacts")[e].smsg=i,$DB.get("contacts")[e].st=a)},deleteInObject:function(e){delete $DB.get("contacts")[e],ContactsList.removeInvitation(e),ContactsList.remove(e)},isExist:function(e){return"undefined"!=typeof $DB.get("contacts")[e]},isMutual:function(e){return this.isExist(e)?parseInt($DB.get("contacts")[e].status)>=0:!1},isPending:function(e){if(this.isExist(e)){var t=parseInt($DB.get("contacts")[e].status);return t===$zcg.CON_REMIND_ME_LATER||t===$zcg.CON_REQACC}return!1},isBot:function(e){var t=this.get(e);return!$WC.$CUtil.isEmpty(t)&&t.isbot},isBotId:function(e){return $WC.$CUtil.isEmpty(e)?!1:e.startsWith("b-")},isEmpty:function(){return $DB.isEmpty("contacts")},get:function(e){return this.isExist(e)?$DB.get("contacts")[e]:null},getBot:function(e){return this.isExist(e)?$DB.get("contacts")[e]:null},getDisplayName:function(e){var t;return $DB.get("contacts")[e]?t=$DB.get("contacts")[e].dname:$DB.get("users")[e]&&(t=$DB.get("users")[e].dname),t?$Util.getTitleString(t):null},getOwnerId:function(e){return $DB.get("contacts")[e].ownerid},getStatus:function(e){if(WmsImpl.isLocalUser(e))return StatusController.getScode();var t=-1;return this.isExist(e)&&(t=parseInt($DB.get("contacts")[e].status)),t},getStatusStyle:function(e,t,i,a){if(WmsImpl.isLocalUser(e))return"usrstatus zcstatus-"+StatusController.getScode();var s="undefined"!=typeof t?"status zcstatus-"+t:"status zcstatus--7",n="string"==typeof e?this.get(e):e;if(n){if(n.isbot)return"msi-boticon";var r=parseInt(n.status);if((!a||r>$zcg.OFFLINE)&&(s="status zcstatus-"+r,r>$zcg.OFFLINE||r===$zcg.CON_UNAPRD)){var o=n.st;s="status zcstatus-"+r,"undefined"!=typeof o&&o===$zcg.PEX_MOBILE&&(s="status msi-mobico-"+r+" msts")}}else if("undefined"==typeof t){var l=LeftPannel.container.find("[profileid='"+e+"']");if(l&&"contact"===l.attr("profile")){var c=l.find('[purpose="status"]').attr("class");s=c?c:s}}return i||(s="usr"+s),s},getContactSmsg:function(e){if(Contacts.isBotId(e))return this.getBotStatusMsg(e);if(this.isExist(e)){var t=this.get(e);return this.getStatusMsg(t.smsg,t.status)}return""},getStatusMsg:function(e,t){return parseInt(t)>0&&2!==parseInt(t)&&!$WC.$CUtil.isEmpty(e)?$WC.$CUtil.processXSS(e.substring(0,400)):Resource.getRealValue(this.statusobj[""+t])},getBotStatusMsg:function(e){var t=Resource.getRealValue("chatbot.smsg");if(this.isExist(e)){var i=this.get(e);$WC.$CUtil.isEmpty(i.smsg)||(t=i.smsg)}return t},getEmailId:function(e){var t="";return this.isExist(e)&&(this.getStatus(e)!=this.INVITED?t=$DB.get("contacts")[e].emailid:Users.isUserExist(e)&&(t=$DB.get("users")[e].emailid)),$WC.$CUtil.isEmpty(t)?"":t},getUsageCount:function(e){return Contacts.isExist(e)?parseInt($DB.get("contacts")[e].uc):0},sortByUsage:function(e){var t=[];for(var i in e)t.push([e[i].uc,i]);return $Util.sort(t,0,!0)},sortByDName:function(e){var t=[];for(var i in e)t.push([e[i].dname,i]);return $Util.sortString(t,0)},sortByStatus:function(e){var t=this.sortByDName(e),i={};for(var a in t){var s=e[t[a][1]],n=s.status?parseInt(s.status):0,r=s.zuid;"undefined"==typeof i[n]&&(i[n]=[]),i[n].push([n,r])}for(var o=[],l=[$zcg.ONLINE,$zcg.CON_BUSY,$zcg.CON_IDLE,$zcg.OFFLINE,$zcg.CON_UNAPRD,$zcg.CON_TO_BE_INVITED],c=0;c<l.length;c++){var d=i[l[c]];"undefined"!=typeof d&&(o=o.concat(d))}return o},getSearchResults:function(){function e(e,t,i,a,s,n){var r=e.zuid,o=Contacts.getDisplayName(r),l=Contacts.getEmailId(r),c=parseInt(e.status),d=Users.getImgUrlById(r),o=$WC.Matcher.replace("escapeReplacementString",o);if(a=a.replace(/{ID}/g,$WC.Matcher.replace("containerid",""+r)).replace(/{USERID}/g,r).replace(/{DNAME}/g,o).replace(/{STATUSCLASS}/g,Contacts.getStatusStyle(r)).replace(/{SCODE}/g,c).replace(/{SMSG}/g,Contacts.getStatusMsg(e.smsg,c)).replace(/{EMAILIDTITLE}/g,""!==l?"["+l+"]":"").replace(/{IMGURL}/g,d),Contacts.isBot(r)){var u=ChatBot.isBot(e.chid)?Resource.getRealValue("chat.bot.searchdesc"):e.desc;a=a.replace(/{DESC}/g,u).replace(/{NAME}/g,$WC.Matcher.replace("escapeReplacementString",o)).replace(/{BOTID}/g,r).replace(/{CHID}/,e.chid)}var m=Users.getUserDetailsForHtml({contact:e,val:t,searchemailid:i,ispeopledata:n,highlight:s}),p="";return e.isbot||(p='<div id="info" title='+Resource.getRealValue("common.info")+' class="msi-zinfo"></div>'),a=a.replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",m.dname)).replace(/{EMAILID}/g,m.departmentinfo||m.emailid).replace(/{PROFILELINK}/g,p)}function t(e,t){var i=parseInt(e.status);return t.restricttosameorg&&!Users.isSameOrg(e.zuid)?!1:$zcg.NO_CHAT===i||$zcg.CON_REMOVE===i||$zcg.CON_REMIND_ME_LATER===i?!1:!t.allstatus&&0>i?!1:t.ignorelist.length>0&&-1!==t.ignorelist.indexOf(e.zuid)?!1:t.getbotsonly?e.isbot:!0}return function(i){var a={ignorelist:[],html:this.searchhtml,allstatus:!0,emailid:!0,highlight:!0,limit:5};i=$.extend({},a,i),i.getbots||(i.ignorelist=i.ignorelist.concat(Contacts.getAllBotContactsIds()));var s,n=this.getAll(),r={},o={},l={},c=[],d="";i.val=i.val.toLowerCase();for(var u in n){var s=n[u],m=$WC.$CUtil.decodeHTMLEntities(s.dname);if(dnameindex=-1,emailidindex=-1,t(s,i)){if("*"!==i.val){if(dnameindex=$Util.searchWithSpecialChars(m,i.val),0===dnameindex){r[u]=s;continue}if(i.emailid&&(emailidindex=s.emailid.indexOf(i.val),0===emailidindex)){o[u]=s;continue}}-1===dnameindex&&-1===emailidindex&&"*"!==i.val?i.peopledata&&Users.isMatchWithOtherInfo(i.val,Users.getInfo(u))&&(l[u]=s):l[u]=s}}for(var p=$Util.getObjBasedonCriteria({startswithobj:Contacts.sortByUsage(r).concat(Contacts.sortByUsage(o)),containsobj:Contacts.sortByUsage(l),limit:i.limit,startswithsearch:i.startswithsearch,containssearch:i.containssearch}),h=0,g=p.length;g>h;h++){c.push(p[h][1]);var s=n[p[h][1]];d+=e(s,i.val,i.emailid,i.html,i.highlight,i.peopledata)}var f={content:d,searchedlist:c,furtherreq:!1,val:i.val};return f}}(),add:function(e,t,i,a,s,n){var r={ulist:t};"undefined"!=typeof a&&(r.welcomemsg=a);$ZCAjx.ajax({url:"/addcontact.do",type:"POST",data:r,success:function(e,i,a){n&&($Util.Button.removeLoadAndAddTickMark($("#contaddbtn")),setTimeout(function(){$WC.$Win.destroy("invitecontactwin")},1e3)),ContactsHandle.add(e,a),"function"==typeof s&&s(t,"addcontact")},error:function(e){var t=Resource.getRealValue("contact.add.error");null!=e&&"object"==typeof e&&9e3===parseInt(e.ERRCODE)&&e.hasOwnProperty("I18N.ERRORPARAMS")&&"ulist"===e["I18N.ERRORPARAMS"]&&(t=Resource.getRealValue("contact.add.error")),UI.updateBanner(t,2e3,!0)},status:{loading:"common.loading"}})},acceptorreject:function(e,t,i,a){if(0!==$.trim(e).length){var s={status:t,userid:e};$ZCAjx.ajax({url:"/approvecontact.do",type:"POST",data:s,success:function(s){var n={accept:"contact.approve.success",reject:"contact.reject.success",mutualcontact:"contact.already.mutual",invitationdeleted:"contact.invite.deleted"};if("true"===s.status&&n[s.operation]){var r=n[s.operation];ContactsList.removeInvitation(e),a||("contact.already.mutual"===r?UI.updateBanner(Resource.getRealValue(r,[Users.getName(e)]),2e3,!1):UI.updateBanner(Resource.getRealValue(r),2e3,!1))}"function"==typeof i&&i(e,t)}})}},"delete":function(e){if(0!==$.trim(e)){var t={userid:e,emailid:this.getEmailId(e)};$ZCAjx.ajax({url:"/deletecontact.do",type:"POST",data:t,success:function(){UI.updateBanner(Resource.getRealValue("contact.delete.success",[Users.getName(e)]),3e3,!1),Contacts.deleteInObject(e),UserProfile.close(e),UserInfo.destroyView()}})}},rename:function(e,t){var i={dname:t};$ZCAjx.ajax({url:"/v1/buddies/"+e+"/rename",type:"POST",data:i,success:function(){Contacts.updateContactName(e,t)},status:{error:"contact.rename.error"}})},updateContactName:function(e,t){UI.updateBanner(Resource.getRealValue("contact.rename.success"),2e3,!1),$DB.get("contacts")[e].dname=$WC.$CUtil.processXSS(t),ContactsList.updateDname(e)},addAndRenameUser:function(e,t,i){var a={dname:t};$ZCAjx.ajax({url:"/v1/buddies/"+e+"/rename",type:"POST",data:a,success:function(){Users.updateUserName(e,t,i)},status:{error:"user.rename.error"}})},getProfileDetails:function(e){WmsImpl.isLocalUser(e)||$ZCAjx.ajax({url:"/getprofiledetailsandchats.do",data:{userid:e},status:{loading:"common.loading"},success:function(t){var i={};for(var a in t)"recentchats"!==a&&(i[a]=t[a]);Users.updateProfileInfo(e,i),UI.hideBanner(),UserProfile.createWithRecentChats(e,t)},error:function(){UI.hideBanner();var t=Users.getName(e),i=Contacts.get(e),a=null!==i&&i.status===$zcg.CON_UNAPRD;$WC.$Dlg.create({id:"contactprofilenotexists",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-red"></div>'}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue(a?"contact.userprofile.pending.error":"contact.userprofile.notmutual.error",[t])]}),buttons:[{text:Resource.getRealValue(a?"contact.reinvite.username":"contact.invite.username",[t]),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){Contacts.add("zoho",e)}},{text:Resource.getRealValue("common.cancel")}]})}})}},ContactsHandle={presence:function(e){ContactsList.update(e),ChatUI.updateParticipantStatusInUI(e)},bulkUpdate:function(){ContactsList.populate(),ChatsList.repopulate()},add:function(e,t){var i=[],a=[],s=[],n=[];for(var r in e)"Same user"===e[r]?i.push(r):"Contact already exists"===e[r]?a.push(r):"Non-Org Not allowed"===e[r]?n.push(r):s.push(r);if("errorList"===t){var o="";if(i.length>0&&(o+=Resource.getRealValue("contact.thyself.error",[i])+"<br>"),a.length>0){for(var l=[],c=0;c<a.length;c++){var d=a[c],u=Users.getName(d);l.push($WC.$CUtil.isEmpty(u)?d:u)}o+=Resource.getRealValue("contact.exists.error",[l.join(", ")])+"<br>"}if(n.length>0){for(var m=[],c=0;c<n.length;c++){var d=n[c],u=Users.getName(d);m.push($WC.$CUtil.isEmpty(u)?d:u)}o+=m.join(", ")+"&nbsp"+Resource.getRealValue("appaccountpolicy.invite.nonorg.notallowed")+"<br>"}if(s.length>0){for(var p=[],c=0;c<s.length;c++){var d=s[c],u=Users.getName(d);p.push($WC.$CUtil.isEmpty(u)?d:u)}o+=s.length>1?Resource.getRealValue("contact.invalid.zohoids",[p.join(",")]):Resource.getRealValue("contact.invalid.zohoid",[p.join(",")])}$WC.$Dlg.alert({id:"contactalreadyexists",bodyhtml:o,imagehtml:'<div class="msi-alrt"></div>'})}else UI.updateBanner(Resource.getRealValue("contact.added.success"),3e3,!1)},notification:function(e){var t={},i=e.zuid;t[i]=e;var a=parseInt(e.status);t[i].scode=1===a||10===a?e.scode:e.status,a===$zcg.CON_REMOVE?(Contacts.deleteInObject(i),ChatUI.handleOnContactDelete(i,!0)):Contacts.update(t),1===a||10===a?(1===a&&ContactsList.removeInvitation(i),ContactsList.addNew(i)):a===$zcg.CON_DELETE?(ContactsList.remove(i),ContactsList.removeInvitation(i),ChatUI.handleOnContactDelete(i)):a===$zcg.CON_REQACC?(ContactsList.addInvitation(i),Users.getProfileInfoFromServer(i)):a===$zcg.CON_REMIND_ME_LATER&&(ContactsList.removeInvitation(i),Users.getProfileInfoFromServer(i)),ParticipantsWin.handleStatusChange(i),ChatUI.updateParticipantStatusInUI(i)}},Users={ORGUSERS_SEARCH_LIMIT:100,USERINFO_REQ_USERLIST_LIMIT:100,ALL_ORG_CONTACTS_LOADED:!1,CLOSED_STATUS:2,fetchtimer:null,getrequesttimer:"",previoussearches:[],invalidUserIds:[],currentsearchcriteria:{val:null},cleanSearchCriteria:function(){this.currentsearchcriteria={val:null}},isEmpty:function(){return $DB.isEmpty("users")},getAll:function(){return $DB.get("users")},getDetail:function(e){return{uid:e,name:Users.getName(e),type:"contact",image:Users.getImgUrlById(e)}},getSearchResults:function(e){if(!WmsImpl.isOrgUser())return{content:"",searchedlist:[],furtherreq:!1};var t={ignorelist:[],html:Contacts.searchhtml,successcallback:$.noop,emailid:!0,highlight:!0,limit:5},i=this.currentsearchcriteria.val;this.currentsearchcriteria=$.extend({},t,e),this.currentsearchcriteria.val=this.currentsearchcriteria.val.toLowerCase();var a=this.search(),s=a.searchedlist.length;return SearchAgent.isPreviouslySearched(this.previoussearches,this.currentsearchcriteria.val)||this.currentsearchcriteria.containssearch?(this.cleanSearchCriteria(),a.furtherreq=!1,a):(i!==this.currentsearchcriteria.val&&(this.currentsearchcriteria.ignorelist=this.currentsearchcriteria.ignorelist.concat(a.searchedlist),this.currentsearchcriteria.limit-=s,null!==Users.currentsearchcriteria.val&&(clearTimeout(this.getrequesttimer),this.getrequesttimer=setTimeout(function(){Users.currentsearchcriteria.peopledata?PeopleServerData.getUserinfofromPeopleServer({val:Users.currentsearchcriteria.val,successcallback:function(e,t){if(t===Users.currentsearchcriteria.val){var i=Users.search(Users.getResultsObj(e));Users.handleFetchResponse(Users.currentsearchcriteria.val,i.content)}},errorcallback:function(e,t){t===Users.currentsearchcriteria.val&&Users.handleFetchResponse(Users.currentsearchcriteria.val,"")}}):Users.get(Users.currentsearchcriteria.val,e.debugsource)},500))),{content:a.content,searchedlist:a.searchedlist,furtherreq:!0})},getResultsObj:function(e){for(var t={},i=0;i<e.length;i++){var a=e[i].zuid;t[a]=Users.getInfo(a)}return t},search:function(){function e(e,t,i,a,s){{var n=Users.currentsearchcriteria.peopledata,r=Contacts.isExist(e.zuid)?Contacts.getDisplayName(e.zuid):e.dname,o=(e.emailid,""+e.zuid),l=Users.getImgUrlById(o);$WC.$CUtil.processXSS(e.departmentname)||"",$WC.$CUtil.processXSS(e.designation)||""}r=$WC.Matcher.replace("escapeReplacementString",r),a=a.replace(/{USERID}/g,o).replace(/{IMGURL}/g,l).replace(/{ID}/g,$WC.Matcher.replace("containerid",o)).replace(/{DNAME}/g,r).replace(/{SCODE}/g,"").replace(/{STATUSCLASS}/g,Contacts.isMutual(o)?Contacts.getStatusStyle(o):"").replace(/{SMSG}/g,"").replace(/{PROFILELINK}/g,'<div id="info" title='+Resource.getRealValue("common.info")+' class="msi-zinfo"></div>').replace(/{EMAILIDTITLE}/g,"");var c=Users.getUserDetailsForHtml({contact:e,val:t,searchemailid:i,ispeopledata:n,highlight:s});return a=a.replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",c.dname)).replace(/{EMAILID}/g,c.departmentinfo||c.emailid)}function t(e,t){if(t.length>0){var i=t.indexOf(e);if(-1!==i)return!1}return!0}return function(i){var a,s=i||$DB.get("users"),n=[],r=[],o=[],l=[],c="";for(var d in s){var a=s[d],u=-1,m=$WC.$CUtil.decodeHTMLEntities(a.dname);if(emailidindex=-1,a.orguser&&t(d,this.currentsearchcriteria.ignorelist)){if("*"!==this.currentsearchcriteria.val){if(u=$Util.searchWithSpecialChars(m,this.currentsearchcriteria.val),0===u){n.push([a.zuid,m,a.emailid]);continue}if(this.currentsearchcriteria.emailid&&(emailidindex=a.emailid.indexOf(this.currentsearchcriteria.val),0===emailidindex)){r.push([a.zuid,m,a.emailid]);continue}}-1===u&&-1===emailidindex&&"*"!==this.currentsearchcriteria.val?this.currentsearchcriteria.peopledata&&this.isMatchWithOtherInfo(this.currentsearchcriteria.val,a)&&o.push([a.zuid,m,a.emailid]):o.push([a.zuid,m,a.emailid])}}for(var p=$Util.getObjBasedonCriteria({startswithobj:$Util.sort(n,1).concat($Util.sort(r,2)),containsobj:$Util.sort(o,1),limit:this.currentsearchcriteria.limit,startswithsearch:this.currentsearchcriteria.startswithsearch,containssearch:this.currentsearchcriteria.containssearch}),h=0,g=p.length;g>h;h++){l.push(p[h][0]);var a=s[p[h][0]];c+=e(a,this.currentsearchcriteria.val,this.currentsearchcriteria.emailid,this.currentsearchcriteria.html,this.currentsearchcriteria.highlight)}return{content:c,searchedlist:l}}}(),isMatchWithOtherInfo:function(e,t){for(var i=e.split(" "),a=i.length,s=[],n=["departmentname","dname","empid","extension","mobile"],r=!1,o=0;a>o;o++){for(var l in t)if(n.includes(l)&&(r=""+t[l].toLowerCase().indexOf(i[o])>-1)){s.indexOf(l)<0?s.push(l):"";break}if(!r)return!1}return s.length>1||-1===s.indexOf("departmentname")},get:function(e,t,i){if(null!==e){t=t.replace(/[^A-Za-z0-9]/g,"");var a=$ZCAjx.ajax({url:"/getorgusers.do",data:{search:"*"===e?"":e,limit:this.ORGUSERS_SEARCH_LIMIT,cliqusersonly:!0,debugsource:t},success:function(t){var s=Users.currentsearchcriteria.val,n=Users.update(t,!0);if("false"==a.getResponseHeader("hasmoreresults")&&$Util.updateArrayWithLimit(Users.previoussearches,s,50),e===s){var r=Users.search().content;Users.handleFetchResponse(e,r)}"*"===e&&n<Users.ORGUSERS_SEARCH_LIMIT-1&&(Users.ALL_ORG_CONTACTS_LOADED=!0),"function"==typeof i&&i()},error:function(){Users.handleFetchResponse(e,"")}})}},getOrgUsersforLHS:function(){Object.keys(Contacts.getAll()).length<100&&Users.get("*","LHS",function(){ContactsList.populate()})},handleFetchResponse:function(e,t){var i=Users.currentsearchcriteria;t||"function"!=typeof i.emptycallback?"function"==typeof i.successcallback&&i.successcallback(t,i.listid,i.populateid,i.destid,e):i.emptycallback(e,i.listid,i.populateid),Users.cleanSearchCriteria()},getName:function(e,t,i){var a;return WmsImpl.isLocalUser(e)?(a=Resource.getRealValue("common.you"),1===i?a=Resource.getRealValue("common.you"):-1===i?a=$WC.$CUtil.processXSS(WmsImpl.getNickName()):100===i&&(a=Resource.getRealValue("common.me")),a):(Contacts.isExist(e)?a=Contacts.getDisplayName(e):Users.isUserExist(e)&&(a=$DB.get("users")[e].dname),a||(a=WmsContacts.getDisplayName(e)),a=a?a:t,$WC.$CUtil.processXSS($Util.getTitleString(a)))},getEmailId:function(e){var t="";return WmsImpl.isLocalUser(e)?t=$zcg._EMAILID:Contacts.isExist(e)?t=Contacts.getEmailId(e):Users.isUserExist(e)&&(t=$DB.get("users")[e].emailid),$WC.$CUtil.isEmpty(t)?"":t},isInvalidZuid:function(e){return Users.invalidUserIds.includes(e)},isExist:function(e){return Contacts.isExist(e)||Users.isUserExist(e)},isUserExist:function(e){return $DB.get("users").hasOwnProperty(e)},isSameOrg:function(e,t){if("undefined"!=typeof $DB.get("users")[e])return JSON.parse($DB.get("users")[e].orguser)===!0;if(!Users.ALL_ORG_CONTACTS_LOADED&&t){var i=$zcg._APPACCOUNTDOMAIN;if(""!=i){var a=$DB.get("contacts")[e];if("undefined"!=typeof a){var s=a.emailid,n=s.split("@");if(n.length){var r=n[n.length-1];return n=$zcg._EMAILID.split("@"),i==r}}}}return!1},isUserPeopleInfoExist:function(e){return"undefined"!=typeof $DB.get("users")[e]&&"undefined"!=typeof $DB.get("users")[e].moreinfo?JSON.parse($DB.get("users")[e].moreinfo)===!0:!1},isAdditionalInfoExist:function(e){return"undefined"!=typeof $DB.get("users")[e]&&"undefined"!=typeof $DB.get("users")[e].moreinfo},getDefaultImgUrl:function(){return $Util.getImgStaticUrl()+"/cnt-avtr.png"},getImgUrlById:function(e,t,i){var a=this.getDefaultImgUrl();if("undefined"==typeof e||"null"==e)return a;if(Contacts.isBotId(e))return MyBots.getImgById(e);var i="undefined"!=typeof i?i:!0,t=$WC.Matcher.check("imagesize",t)?t:"thumb";return i&&!WmsImpl.isAnnonUser(e)?$zcg._PHOTOSERVER+"/file?ID="+e+"&exp=6000&t=user&fs="+t:a},getCheckinStatus:function(e){if(!Users.isSameOrg(e))return"";var t=Users.getInfo(e).checkin_status;return"undefined"!=typeof t?t?"in":"out":""},getUserDetailsForHtml:function(e){var t=e.contact,i=e.val;Users.isSameOrg(t.zuid)&&Users.isUserExist(t.zuid)&&(t=Users.getInfo(t.zuid));var a=Users.getName(t.zuid,t.dname),s=Users.getEmailId(t.zuid),n=$WC.$CUtil.processXSS(t.departmentname)||"",r=$WC.$CUtil.processXSS(t.designation)||"",o="";if(e.highlight){var l=a?a.toLowerCase().indexOf(i):-1,c=s?s.toLowerCase().indexOf(i):-1,d=new RegExp($WC.Matcher.replace("escaperegexp",i),"i");0===l||-1!==l&&(!e.searchemailid||e.searchemailid&&0!==c)?a=a.replace(d,"<b>$&</b>"):e.ispeopledata?(n=n?n.replace(d,"<b>$&</b>"):"",r=r?r.replace(d,"<b>$&</b>"):""):s=s?s.replace(d,"<b>$&</b>"):"",t.app&&(a+='<span class="clr6 fntnrml"> - '+Resource.getRealValue("common.via")+' <span class="clr5 bold"> '+t.app.name+" </span>"+Resource.getRealValue("app.app")+(t.app.issandbox?" ("+Resource.getRealValue("app.sandbox")+")":"")+"</span>")}if(e.ispeopledata){var a='<span class="ellips">'+a+"</span>";o=Users.getDepartmentInfo(n,r)}return{dname:a,emailid:s,departmentinfo:o}},getDepartmentInfo:function(e,t){return e||t?e&&t?e+" - "+t:e||t:""},update:function(e,t){var i=($DB.get("users")||{},0);for(var a in e){var s=e[a],n=Users.getInfo(a)||{};n.zuid=a,n.dname=$WC.$CUtil.processXSS(s[4]?s[4]:s[0]),n.orguser=t?t:parseInt($zcg._ORGID)===parseInt(s[2]),n.orgid=s[2],n.orguser&&(n.emailid=s[1]),n.isclosed=parseInt(s[3])===Users.CLOSED_STATUS;var r=s[5];r?(r.moreinfo=!1,n=$.extend(n,r),PeopleServerData.updateProfileInfoInObj(n)):Users.updateProfileInfo(a,n),i++}return i},updateProfileInfo:function(e,t){var i=$DB.get("users")||{},a=i[e]||{},s={};for(var n in t)s[n]=t[n];s.dname=Users.isUserExist(e)?i[e].dname:t.fullname||t.dname,s.emailid=t.emailid?t.emailid:"",s.zuid=e,s.orguser=parseInt($zcg._ORGID)===parseInt(t.orgid),Users.isCheckinStatusEnabled(e)&&"undefined"!=typeof t.checkin_status&&(s.lastsynctime=(new Date).getTime()),t.timezone&&(s.timezone=t.timezone),t.timeoffset&&(s.timeoffset=t.timeoffset),t.country&&(s.country=t.country),"undefined"!=typeof t.moreinfo&&(s.moreinfo=t.moreinfo),i[e]=$.extend({},a,s),$DB.update("users",i)},getProfileInfoFromServer:function(e,t,i,a){if(!$WC.$CUtil.isEmpty(e)){var s=[];if(Array.isArray(e)||(e=e.split(",")),t)s=$Util.cloneArray(e);else for(var n=0;n<e.length;n++){var r=e[n];Users.isAdditionalInfoExist(r)||Contacts.isBotId(r)||s.push(r)}if(!$.isEmptyObject(s))return this.isInvalidZuid(e[0])&&"function"==typeof a?void a():void $ZCAjx.ajax({url:"/getusersinfo.do",type:"POST",data:{ulist:s.join()},success:function(e){for(var t in e)Users.updateProfileInfo(t,e[t]),"function"==typeof i&&i(t)},error:function(){"function"==typeof a&&a()}})}},getProfileInfoforBulkList:function(e,t){for(var e=$Util.removeDuplicateEntries(e),i=[],a=0;a<e.length;a++){var s=e[a];Users.isAdditionalInfoExist(s)||i.push(s)}for(;i.length>0;){var n=Math.min(Users.USERINFO_REQ_USERLIST_LIMIT,i.length);Users.getProfileInfoFromServer(i.splice(0,n),!0,t)}},getInfo:function(e){return Users.isExist(e)?$DB.get("users")[e]:void 0},updateUserName:function(e,t,i){UI.updateBanner(Resource.getRealValue("user.rename.success"),2e3,!1),$DB.get("users")[e].dname=$WC.$CUtil.processXSS(t),ChatUI.exist[i].updateTitle(t)},updateUserDetails:function(e,t){var i=Users.getPeopleInfoNeededUIDs(e);i.length&&(clearTimeout(this.usertimer),this.usertimer=setTimeout(function(){PeopleServerData.getUserinfofromPeopleServer({uid:i.join(","),successcallback:function(e){Users.updateUserDetailsInGivenContainer(t,e)}})},500))},updateUserDetailsInGivenContainer:function(e,t){for(var i=0;i<t.length;i++){var a=t[i],s=a.zuid,n=$(e).find("#contactmailid"+s);if(n[0]){var r=$WC.$CUtil.processXSS(a.department)||"",o=$WC.$CUtil.processXSS(a.designation)||"",l=Users.getDepartmentInfo(r,o)||a.emailid;n.html(l),Users.updateAvailabilityStatus(s,e)}}},checkAndUpdateAvailabilityStatus:function(e,t){Users.isCheckinStatusEnabled(e)&&this.isAvailabilityStatusExpired(e)&&PeopleServerData.getProfileInfoFromServer(e,function(){Users.updateAvailabilityStatus(e,t)})},updateAvailabilityStatus:function(e,t){if(Users.isCheckinStatusEnabled(e)){var i=$(t).find("#checkin_status[uid='"+e+"']");if(i[0]){var a=Users.getCheckinStatus(e);i.html(a);var s="in"===a?"out":"in";i.addClass(a),i.removeClass(s)}}},isCheckinStatusEnabled:function(e){return!$zcg._ISVALIDPEOPLEUSER||Users.isUserExist(e)&&!Users.isSameOrg(e)?!1:!0},isAvailabilityStatusExpired:function(e){var t=18e4,i=Users.getInfo(e)||{},a=i.lastsynctime;return!a||(new Date).getTime()-a>t?!0:!1},getPeopleInfoNeededUIDs:function(e){for(var t=[],i=e.length,a=0;i>a;a++){var s=e[a];if(!Users.isAdditionalInfoExist(s)){if(Users.isUserExist(s)&&!Users.isSameOrg(s))continue;t.push(s)}}return t},getAndUpdateUserInfoFromServer:function(e){var t=[];e.uid&&(t=Users.getPeopleInfoNeededUIDs(e.uid)),clearTimeout(this.usertimer),this.usertimer=setTimeout(function(){(t.length||e.val)&&(e.uid=!e.val&&t.length?t.splice(0,25).join(","):"",PeopleServerData.getUserinfofromPeopleServer(e))},500)}},OrgInvitees={fetchtimer:null,MAX_PENDING_USER_ALLOWED:5,getAll:function(){return $DB.get("orginvitees")},isEmpty:function(){return $DB.isEmpty("orginvitees")},update:function(e){$DB.update("orginvitees",e)},getOrgInviteesForLHS:function(){$zcg._ACTIVE_APPACC_MEMBERS_COUNT<OrgInvitees.MAX_PENDING_USER_ALLOWED&&$ZCAjx.ajax({url:"/v2/organisations/"+$zcg._APPACCOUNTID+"/users",data:{status:"pending",limit:OrgInvitees.MAX_PENDING_USER_ALLOWED-$zcg._ACTIVE_APPACC_MEMBERS_COUNT},success:function(e){OrgInvitees.update(e.data),ContactsList.populate()}})}},PeopleServerData={getUserinfofromPeopleServer:function(e){if(e.val||e.uid){var t={fields:"people_details,account_details"};e.uid&&(t.userids=e.uid),e.val&&(t.search=e.val),e.initial_token&&(t.initial_token=e.initial_token),$ZCAjx.ajax({url:"/v2/organisations/"+$zcg._APPACCOUNTID+"/users",type:"GET",data:t,success:function(t){var i=t.data;PeopleServerData.updateProfileInfoOfUsersArr(i),!t.has_more&&e.val&&$Util.updateArrayWithLimit(Users.previoussearches,e.val,50),"function"==typeof e.successcallback&&e.successcallback(i,e.val)},error:function(){"function"==typeof e.errorcallback&&e.errorcallback([],e.val)}})}},getProfileInfoFromServer:function(e,t){function i(e){"function"==typeof t&&t(e)}if(e){var a={fields:"checkin_status,old_impl"};$ZCAjx.ajax({url:"/v2/users/"+e,type:"GET",data:a,success:function(t){PeopleServerData.updateProfileInfoInObj(t),i(e)},error:function(){i(e)}})}},getDepartments:function(e){$ZCAjx.ajax({url:"/v2/organisations/"+$zcg._APPACCOUNTID+"/departments",type:"GET",data:{search:e.val,initial_token:e.initial_token},success:function(t){PeopleServerData.updateDepartmentDataInObj(t),"function"==typeof e.successcallback&&e.successcallback(t,e.val)},error:function(t){"peopleorg_not_exist"===t.code&&(Department.ispeopleorg=!1),"function"==typeof e.emptycallback&&e.emptycallback(e.val,t,"departments")}})},getDepartmentLeadName:function(e,t){$ZCAjx.ajax({url:"/v2/organisations/"+$zcg._APPACCOUNTID+"/departments/"+e,type:"GET",success:function(i){PeopleServerData.updateDepartmentDataInObj(i,e),"function"==typeof t&&t(i)}})},getDepartmentUsers:function(e,t,i){function a(e){"function"==typeof i&&i(t,e.data)}var s=Department.getDepartmentInfo(t);return s&&!s.members_count?void a([]):void $ZCAjx.ajax({url:"/v2/organisations/"+$zcg._APPACCOUNTID+"/departments/"+t+"/members",type:"GET",success:function(e){PeopleServerData.updateProfileInfoOfUsersArr(e.data,!0,!0),a(e)},error:function(){a([])}})},updateProfileInfoOfUsersArr:function(e,t,i){for(var a=e.length,s=0;a>s;s++)PeopleServerData.updateProfileInfoInObj(e[s],t,i)},updateProfileInfoInObj:function(e,t,i){var a;t&&(a=$zcg._ORGID);var s={departmentname:e.department,department_id:e.department_id,designation:e.designation,emailid:e.email_id,empid:e.employee_id,fullname:e.full_name||e.dname,moreinfo:"undefined"!=typeof e.moreinfo?e.moreinfo||void 0:!0,zuid:e.zuid,orgid:a||e.organization_id||e.orgid};i||"undefined"==typeof e.checkin_status||(s.checkin_status=e.checkin_status),e.country&&(s.country=e.country),e.extension&&(s.extension=e.extension),e.mobile&&(s.mobile=e.mobile),e.timeoffset&&(s.timeoffset=e.timeoffset),e.timezone&&(s.timezone=e.timezone),e.work_location&&(s.work_location=e.work_location),e.timeoffset&&e.timezone&&e.country||delete s.moreinfo,e.reportingto&&(s.reportingto=e.reportingto.zuid,s.reportingto_fullname=Users.getName(e.reportingto.zuid,e.reportingto.first_name+" "+e.reportingto.last_name)),Users.updateProfileInfo(e.zuid,s)},updateDepartmentDataInObj:function(e,t){var i=e.data,a=i.length,s=$DB.get("department")||{};if(t){var n=Department.getDepartmentInfo(t)||{},r={name:i.name,lead_info:{name:i.lead_name,zuid:i.lead_zuid,mailid:i.lead_mailid},parent_department_info:{id:i.parent_department_id,name:i.parent_department_name}};n=$.extend(n,r),s[t]=n}else for(var o=0;a>o;o++){var n=i[o];s[n.id]=n}$DB.update("department",s)}},Department={ispeopleorg:!0,previoussearches:[],ignorelist:[],isExist:function(e){return $DB.get("department").hasOwnProperty(e)},getDepartmentInfo:function(e){return this.isExist(e)?$DB.get("department")[e]:void 0},getSearchResults:function(e){var t=e.successcallback;if(!this.ispeopleorg)return void t("",!1,e.populateid);var i=this.search(e);return $(i).length>=e.limit||SearchAgent.isPreviouslySearched(this.previoussearches,e.val)||e.containssearch?void t(i,"",e.populateid,!1,e.val):(clearTimeout(Department.requesttimer),void(Department.requesttimer=setTimeout(function(){e.successcallback=function(i,a){var s=Department.search(e);i.has_more||$Util.updateArrayWithLimit(Department.previoussearches,a,50),t(s,"",e.populateid,!1,a)},PeopleServerData.getDepartments(e)},300)))},search:function(e){var t=$DB.get("department")||{},i=[],a=[],s="";for(var n in t){var r=t[n],o=$WC.$CUtil.decodeHTMLEntities(r.name||""),l=$Util.searchWithSpecialChars(o,e.val);0===l?i.push(r):-1!==l?a.push(r):""}for(var c=$Util.getObjBasedonCriteria({startswithobj:$Util.sort(i,1),containsobj:$Util.sort(a,1),limit:e.limit,startswithsearch:e.startswithsearch,containssearch:e.containssearch}),d=c.length,u=0;d>u;u++)s+=this.getDepartmentsHtml(c[u],e);return s},getDepartmentsHtml:function(e,t){var i=new RegExp($WC.Matcher.replace("escaperegexp",t.val),"i"),a=$WC.$CUtil.processXSS(e.name);Department.ignorelist.push(e.id);var s=Department.getImgString(a),n=a.replace(i,"<b>$&</b>"),r=e.members_count?e.members_count+" "+Resource.getRealValue("channel.role.4"):"";return t.html.replace(/{NAME}/g,n).replace(/{TITLE}/g,$WC.$CUtil.processXSS(a)).replace(/{ID}/g,e.id).replace(/{MEMBERS-COUNT}/g,r).replace(/{IMG}/g,'<div title="'+$WC.$CUtil.processXSS(a)+'" class="usrimgsts floatl"><div class="zcunrdrds rds4">'+s+"</div></div>")},getImgString:function(e){var e=$WC.Matcher.replace("removespecialchars",e," ");return e.substr(0,1)+(e.split(" ")[1]?e.split(" ")[1].substr(0,1):"")},getDepartmentUsers:function(e,t,i){PeopleServerData.getDepartmentUsers(e,t,function(e,a){e===t&&i(Department.getUsersHtml(t,a))})},getUsersHtml:function(e,t){var i="";if(!t||!t.length)return'<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("globalsearch.department.nomembers")+"</div></div>";for(var a=t.length,s=0;a>s;s++){var n=t[s].zuid,r=Users.getInfo(n),o=Contacts.get(n),l="";"undefined"!=typeof t[s].checkin_status&&(l=t[s].checkin_status?"in":"out");var c=o?parseInt(o.status):"";i+=SearchHTML.contactsearchhtml.replace(/{DNAMEVAL}/g,Users.getName(n,r.dname)+'<span id="checkin_status" uid="'+n+'" class="font14 checkin_status zcpredot '+l+'">'+l+"</span>").replace(/{ID}/g,"").replace(/{USERID}/g,n).replace(/{STATUSCLASS}/g,o?Contacts.getStatusStyle(n):"").replace(/{SCODE}/g,c).replace(/{IMGURL}/g,Users.getImgUrlById(n)).replace(/{STATUS}/g,"").replace(/{SMSG}/g,o?Contacts.getStatusMsg(o.smsg,c):"").replace(/{PROFILELINK}/g,"").replace(/{EMAILID}/g,$WC.$CUtil.processXSS(r.designation)||"")}return i}};var OrgDirectory=function(){"use strict";var e={autoImageChangeTimeout:"",timercounter:5e3,autoIndex:1,imagesElems:"",dotsElems:""},t={popup_html:'<div class="people-popup-hdr ellips mrgLR15">{{popup_hdr}}</div><div class="mrgT15 clr0 font16 txtcent">{{popup_subhdr}}</div><div class="people-popup-imgholder mrgT25">{{images_html}}</div><div class="mrgT30 people-popup-imgselector dflxjustcent">{{imagesdot_html}}</div><div class="mrgT40 dflxjustcent posrel"><div id="take_todirectory" purpose="take_todirectory" class="btn">{{popup_btntxt}}</div></div>',image_html:'<div purpose="sliderimage" class="h100 posrel {{image_class}} {{hide_class}}"><img  class="people-popup-img" src="officechat/images/default/{{image_name}}">{{image_info}}</div>',imageinfo_html:'<div class="mrgL30"><img src="officechat/images/default/arrow.svg"><img class="dB mrgT10 mrgL25" src="officechat/images/default/{{image_icon}}"><div class="people-popup-infotxt">{{img_txt}}</div></div>',imagedot_html:'<span purpose="imgselector" img-cnt="{{img_cnt}}" class="{{active_cls}}" ></span>'},i=[{imgname:"peopleinteg_struct.png"},{imgname:"peopleinteg_searchcard.png",icon:"search_icon.svg",text:"peopleinteg.popup.searchtxt"},{imgname:"peopleinteg_popcard.png",icon:"user_icon.svg",text:"peopleinteg.popup.usertxt"},{imgname:"peopleinteg_mention.png",icon:"mentions_icon.svg",text:"peopleinteg.popup.mentiontxt"}],a=function(){var e,a="",s="";for(e in i){var n=i[e],r=parseInt(e),o=$WC.template.replace(t.image_html,{image_info:n.text?t.imageinfo_html:""},"InSecureHTML");a+=$WC.template.replace(o,{image_name:n.imgname,image_icon:n.icon,$img_txt:n.text,image_class:n.text?"dflxcent fjustifyE pR25":"dflxjustcent",hide_class:r?"hide":""}),s+=$WC.template.replace(t.imagedot_html,{img_cnt:r+1,active_cls:r?"":"active"})}var l=$WC.template.replace(t.popup_html,{$popup_hdr:["peopleinteg.popup.hdr",$zcg._APPACCOUNTNAME],$popup_subhdr:"peopleinteg.popup.subhdr",$popup_btntxt:"peopleinteg.popup.btntxt"});return l=$WC.template.replace(l,{images_html:a,imagesdot_html:s},"InSecureHTML")},s=function(t){var i=e.imagesElems,a=e.dotsElems;$(i).addClass("hide"),$(a).removeClass("active"),$(i[t-1]).removeClass("hide"),$(a[t-1]).addClass("active")},n=function(t){t=parseInt(t),s(t),clearTimeout(e.autoImageChangeTimeOut),e.autoIndex=t+1,e.autoImageChangeTimeOut=setTimeout(r,e.timercounter)},r=function(){var t=e.imagesElems.length;e.autoIndex=e.autoIndex>t?1:e.autoIndex,s(e.autoIndex),e.autoIndex++,e.autoImageChangeTimeOut=setTimeout(r,e.timercounter)},o=function(){var t=$("#take_todirectory");$Util.Button.addLoadIcon(t),$ZCAjx.ajax({url:"/v2/integrations/people/syncEmployees",type:"POST",success:function(){$Util.Button.removeLoadAndAddTickMark(t),e.autoIndex=1,window.open($zcg._PEOPLEURL+"/hr#organization/tree/employee","_blank"),$WC.$Win.destroy("people_integ_popup"),$zcg._ISVALIDPEOPLEUSER=!0}})},l=function(t){e.imagesElems=document.querySelectorAll('[purpose="sliderimage"]'),e.dotsElems=document.querySelectorAll('[purpose="imgselector"]'),r(),t.on("click","[purpose]",function(){var t={imgselector:function(){var e=event.target.getAttribute("img-cnt");n(e)},take_todirectory:function(){clearTimeout(e.autoImageChangeTimeOut),o()}},i=$(this).attr("purpose");"function"==typeof t[i]&&t[i]()})},c=function(){var t=$WC.$Win.create({id:"people_integ_popup","class":"people-popup adchtwin",html:a(),closebeforefn:function(){e.autoIndex=1,clearTimeout(e.autoImageChangeTimeOut)}});l(t)};return{createUI:c,syncUsers:o}}(),Channels={},ChannelsUI={},ChannelsUI={iconinfo:{1:"channel.tip.org",2:"channel.tip.group",3:"channel.tip.private",4:"channel.tip.shared",inviteonly:"channel.lock.tip",multiteam:"channel.multiteam.icon.tip"},iconclasses:{inviteonly:'class="msi-chnlck"',multiteam:'class="msi-multiteamchannel"'},init:function(){SecurityManager.hasPermission(Modules.Channels)&&ChannelsUI.initLHS(),SecurityManager.register(Modules.Channels,ChannelsUI.handleModuleStatusChange)},initLHS:function(){LeftPannel.hasComponent("component")||(LeftPannel.updateCallback({type:"channel",create:function(){ChannelsUI.clearNewChannelNotification(),ChannelsPermission.hasPermission(MActions.Join)?ChannelsUI.List.loadAllowedChannelsView(!0):ChannelsUI.create()},action:function(e,t){t=$(t);var i=t.attr("catagory"),a=t.attr("elemtype"),s=t.attr("chid");if(e.target.id==="tabpin"+s)"channels"===i||"chats"===i?Channels.markUnmarkPinnedChannel(s,!0):"pinnedchats"===i&&Channels.markUnmarkPinnedChannel(s,!1);else if(e.target.id==="tabunmute"+s)Chat.muteChat(s,!1);else if(e.target.id==="tabdelete"+s)LeftPannel.LHSList.removeFromAllCategories(s),ChatsList.markRead(s),Chat.propagateMsgSeen(s),ChatsList.delete(s),Chat.removefromRC(s);else if(e.target.hasAttribute("operation")&&"createorjoin"===t.attr("operation"))ChannelsUI.handleClickOnCreateOrJoin(e,t);else if(e.target.hasAttribute("operation")||"channel"!==a){var n=e.target.getAttribute("operation");null!==n&&ChannelsUI.doOperation(n,t.attr("uid"))}else ChannelsUI.trackChannelClick(i),ChannelsUI.getChat(t.attr("chid"),Channels.getChannelId(t.attr("chid")))},more:function(){ZCTrack.track("LHS_MORE_CHANNEL"),ChannelsUI.List.LHS.showAllChannels.create()},headeraction:function(e,t){"channelssubheader"==t.getAttribute("catagory")?ChannelsUI.List.LHS.toggleSubHeader(t.getAttribute("shId")):(ChannelsUI.List.LHS.toggle(),LeftPannel.toggleHeader("channels"))}}),UI.container.find("#channelslhs").prepend('<div id="channelsheader" class="zclftitmn cur" workfor="channel" elemtype="header"><span id="createorjointip">'+(SecurityManager.hasPermission(Modules.Channels)?ChannelsUI.getChannelsHeader():"")+'</span><div title="'+Resource.getRealValue("common.lhs.headertip")+'" class="zcbdytitle">'+Resource.getRealValue("menuname.channelsandgroups")+'<div class="zccunt posl dIB"><span id="totalunreadcount" style="display:none" title=""></span></div></div></div><div id="channelslistholder" class="channelslist"><div id="channelspendinglist"></div><div id="channelslist" class="width100 floatl zclefch"></div><div class="zclin"></div></div>'))},getChannelsHeader:function(){var e=ChannelsPermission.hasPermission(MActions.Create)?Resource.getRealValue("common.create"):"";e+=ChannelsPermission.hasPermission(MActions.Join)?($WC.$CUtil.isEmpty(e)?"":"/")+Resource.getRealValue("common.join"):"";var t="en"!==$zcg._LANG?'<span  workfor="channel" elemtype="create" title="'+e+'" class="msi-add cur" ><span id="newcount" elemtype="morecount" class="msgnotify dN" title=""></span></span>':'<span workfor="channel" elemtype="create" class="cur '+($WC.$CUtil.isEmpty(e)?"":"joinchnl")+'" >+ '+e+'<span id="newcount" elemtype="morecount" class="msgnotify dN"></span></span>';return t},updateChannelsHeader:function(){var e=ChannelsUI.getChannelsHeader();$("#createorjointip").html(e)},handleModuleStatusChange:function(){ChannelsUI.updateChannelsHeader(),ChannelsUI.List.LHS.updateNewCount(),QuickAction.updateIcon()},trackChannelClick:function(e){switch(e){case"channels":ZCTrack.track("CHANNELS_CLICKED",{TRIGGER:"Channels LHS"});break;case"pinnedchats":ZCTrack.track("CHANNELS_CLICKED",{TRIGGER:"Pinned LHS"});break;case"chats":case"mutedchats":ZCTrack.track("CHANNELS_CLICKED",{TRIGGER:"Conversations LHS"});break;case"globalsearch":ZCTrack.track("CHANNELS_CLICKED",{TRIGGER:"Global Search"});break;case"spotlight":ZCTrack.track("CHANNELS_CLICKED",{TRIGGER:"Smart Search"})}},action:function(e,t){var i=t.attr("chid");e.target.id==="tabdelete"+i?(Chat.quit(i,!1,!0),ChannelsUI.removeFromUI(i)):ChannelsUI.getChat(t.attr("chid"),t.attr("uid"))},handleClickOnCreateOrJoin:function(e,t){var i=parseInt(t.attr("scope")),a=t.attr("shId"),s=t.attr("shname"),n=i===Channels.Org?Resource.getRealValue("common.org"):i===Channels.OrgGroup?'<span class="txtgrn">'+s+"</span>":Resource.getRealValue("integration.scope"+i),r='<div id="createorjoin{SHID}" closeonscroll purpose="createorjoinchnl" class="subcategorychnl posa">'+(ChannelsPermission.hasPermission(MActions.Join,i)&&i!==Channels.Private?'<span class="msi-joinicon cur" purpose="list" scope="{SCOPE}" shId="{SHID}" shName="{SHANAME}">'+Resource.getRealValue("common.join")+"&nbsp;"+n+"&nbsp;"+Resource.getRealValue("channel.head")+"</span>":"")+(ChannelsPermission.hasPermission(MActions.Create,i)?'<span class="msi-plus cur" purpose="create" scope="{SCOPE}" shId="{SHID}" shName="{SHANAME}" >'+Resource.getRealValue("common.create")+"&nbsp;"+n+"&nbsp;"+Resource.getRealValue("channel.head")+"</span>":"")+"</div>";r=r.replace(/{SCOPE}/g,i).replace(/{SHID}/g,a).replace(/{SHANAME}/g,s);var o=$("#outercontainer");o.find("#createorjoin"+a).remove(),o.find('[operation="createorjoin"].show').removeClass("show"),o.append(r);var l=$("#createorjoin"+a),c=t.offset().top,d=$(window).scrollTop(),u=$(window).height(),m=l.height(),p=c+28;c-d>m&&c-d+m>u&&(p=c-m-10),l.css({top:p}),Clickoutside.bind({srcid:"createorjoinicon"+a,destid:"createorjoin"+a,event:e,customShow:function(e){$("#"+e.srcid).addClass("show")},customHide:function(e){$("#"+e.srcid).removeClass("show"),LeftPannel.hidePopups()}}),l.on("click","[purpose]",function(e){var t=$(this);Clickoutside.handleClickOnChild(e);var a={hidelevel:!0,scope:parseInt(t.attr("scope")),teamid:t.attr("shId"),teamname:t.attr("shname")};"create"===t.attr("purpose")?ChannelsUI.create("",i,a):ChannelsUI.List.loadAllowedChannelsView(!0,a)})},htmls:{joinedlhs:'<div id="tab{OC_ID}" catagory="channels" elemtype="channel" chid="{CHID}" uid="{OC_ID}" class="zcuserstatus {UNREADCOUNTCLASS}" profile="channel" {ISUNREAD}><div id="chnmultiicn" class="floatl userdetails {CHN_ICONS} " elemname><span  id="channeldname_{OC_ID}" class="ellips usrdtl-txt">{CNAME}</span><span id="lhschnicon{CHID}" class="usrdtl-icns">{CHN_TYPE_ICON} {CHN_LCK} </span></div><div id="otherinfo{CHID}"><div id="tabpin{CHID}" title="'+Resource.getRealValue("common.channel.pin")+'" class="msi-pin"></div><div id="tabscode{CHID}" purpose="status" class="msi-sc{CHANNELSLEVEL} msci"></div></div></div>',pendinglhs:'<div id="channelpending{ID}" catagory="pending" elemtype="channel" uid="{ID}" class="zcuserstatus zcpending"><div class="floatl userdetails" elemname><span operation="preview" id="channeldname_{ID}" class="ellips">{NAME}</span></div><div operation="approve" title="'+Resource.getRealValue("common.approve")+'" class="msi-tick"></div><div operation="reject" title="'+Resource.getRealValue("common.decline")+'" class="msi-close"></div></div>',channelslistview:'<div chid="{CHID}" uid="{OC_ID}"  elemtype="channel" purpose="search" class="zcuserstatus zcrtchtcontct diag_listview"><div class="elem-img dflxjustcent usrimgsts zcssimg" >{IMG}</div><div id="details" class="elem-details mrgL10 ellips"><span chid="{CHID}" uid="{OC_ID}" class="font16 ellips lin22">{CNAME}</span><span>{CHN_TYPE_ICON} {CHN_LCK} </span><div class="font14 clr6 ellips lin22 {CDESCRIPTION_CLS}">{CDESCRIPTION}</div></div><div class="elem-optns joinbtn {JOINBTN_CLS}" purpose="joinchannel" uid="{OC_ID}">'+Resource.getRealValue("common.join")+"</div></div>"},groupsuggestion:{search:function(e){var t=$("#channels-groupsuggest-results");t.html('<div id="channels-groupsuggest-list"  class="drpdwn srchglt"></div>');var i=SearchField.getSelectedList("channels-groupsuggest-search-field"),a=i.length,s=SearchAgent.search({searchin:SearchAgent.ORGGROUPS,val:e,ignorelist:i,listid:"channels-groupsuggest-list"});return s&&a<Channels.OrgGroupLimitInChannel&&this.displayResultDOM(t),a===Channels.OrgGroupLimitInChannel&&UI.updateBanner(Resource.getRealValue("channel.sel.group.limit"),2e3,!0),s},handleAction:function(e,t,i){i&&(SearchField.insertNodeinField("channels-groupsuggest",void 0,this.getTeamNode(t.attr("uid"),t.attr("elemtype"))),Clickoutside.handleClickOnChild(e)),ChannelsUI.enableOrDisableEditButton()},getTeamNode:function(e,t,i,a){var s=SearchField.getNodeforSelection({uid:e,type:$WC.$CUtil.isEmpty(t)?"group":t,name:$WC.$CUtil.isEmpty(a)?Groups.getDisplayName(e):a},!0,i);return Groups.get(e).members||Groups.getMembers(e),s},clear:function(){$("#channels-groupsuggest-results").hide().find("#channels-groupsuggest-list").empty(),Clickoutside.clear("channels-groupsuggest-results"),ChannelsUI.enableOrDisableEditButton()},displayResultDOM:function(e){e.find("[purpose='search']").first().addClass("srchbn sel");var t="block"===e.css("display");t||Clickoutside.bind({srcid:"channels-groupsuggest-search-field",destid:"channels-groupsuggest-results"}),ZCScroll.scrollTop($("#channels-groupsuggest-results"),0)},displayNoResultFound:function(){this.clear();var e=$("#channels-groupsuggest-results"),t=$("#channels-groupsuggest-list");t.append('<div id="orggroupshtml" searchcatagory="orggroups"></div>'),t.find("#orggroupshtml").append("<div class='zcuserstatus chatinvt'>"+Resource.getRealValue("channel.groupsuggest.empty")+"</div>"),this.displayResultDOM(e)},handleDeleteNode:function(e,t){var i=e.attr("uid"),a=e.text(),s=$("#channeldetailscont").attr("channelid");if($("#editchannelwin").length&&Channels.isExistingGrp(s,i)){var n=[Resource.getRealValue("channel.removegroup.info1",[$WC.$CUtil.processXSS(a)]),Resource.getRealValue("channel.removegroup.info2",[$WC.$CUtil.processXSS(a)])];return $WC.$Dlg.confirm({id:"changechannelgrps",version:2,"class":"zcdalogbx zcbg_mask alert_dialog chlvblty",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:n}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn clr-red"></div>',header:Resource.getRealValue("channel.removegroup.header",[$WC.$CUtil.processXSS(a)])}),closefn:function(){ChannelsUI.enableOrDisableEditButton()},buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.RED_BUTTON,action:function(){e.remove(),SearchField.clear(t),SearchField.populateDefaultResult(t),$WC.DivEditor.focus(t+"-search-field"),ChannelsUI.enableOrDisableEditButton()}},{text:Resource.getRealValue("common.cancel"),colour:$WC.$Dlg.GREY_BUTTON,action:function(){ChannelsUI.enableOrDisableEditButton()}}]}),!0}return!1}},usersuggestion:{search:function(e){var t=$("#channels-usersuggest-results"),i={},a=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,s=$("#createchannelwin"),n=s.find("[name='channelscope']:checked").val();if(Channels.isOrgScope(n)||Channels.isPrivateScope(n))a=SearchAgent.ORGCONTACTS;else if(Channels.isOrgGroupScope(n)){a=SearchAgent.CUSTOMSEARCH;var r=SearchField.getSelectedList("channels-groupsuggest-search-field").join(",");if($WC.$CUtil.isEmpty(r))return void UI.updateBanner(Resource.getRealValue("channel.sel.group"),2e3,!0);i=Groups.getMembersFromObj(r)}t.html('<div id="channels-usersuggest-list"  class="drpdwn srchglt"></div>');var o=SearchField.getSelectedList("channels-usersuggest-search-field"),l=SearchAgent.search({searchin:a,val:e,ignorelist:o,listid:"channels-usersuggest-list",debugsource:"ChannelsUserSuggestion",clearcallback:function(){var t=SearchField.checkAndAddEmailInAutocomplete("channels-usersuggest",e);t||ChannelsUI.usersuggestion.displayNoResultFound(e)},customobject:i});return l&&this.displayResultDOM(t),l},handleAction:function(e,t,i){if(i){var a=SearchField.getNodeforSelection({uid:t.attr("uid"),type:t.attr("elemtype"),name:t.attr("data-val")},!0);SearchField.insertNodeinField("channels-usersuggest",void 0,a),Clickoutside.handleClickOnChild(e,t);var s=$("#createchannelwin").find("[name='channelscope']:checked").val();Channels.isOrgGroupScope(s)&&ZCScroll.resetScroll($("#channeldetailscont"))}},clear:function(){$("#channels-usersuggest-results").hide().find("#channels-usersuggest-list").empty(),Clickoutside.clear("channels-usersuggest-results")},handleKeyUp:function(){var e=$("#createchannelwin").find("[name='channelscope']:checked").val();Channels.isOrgGroupScope(e)&&ZCScroll.resetScroll($("#channeldetailscont"))},displayResultDOM:function(e){e.find("[purpose='search']").first().addClass("srchbn sel");var t="block"===e.css("display");t||Clickoutside.bind({srcid:"channels-usersuggest-search-field",destid:"channels-usersuggest-results"}),ZCScroll.resetScroll(e.find("#channels-usersuggest-list")),ZCScroll.scrollTop($("#channels-usersuggest-results"),0),ZCScroll.getScrollDown($("#channeldetailscont")[0],300)},displayNoResultFound:function(e){this.clear();var t=$("#channels-usersuggest-results"),i=!0,a="channel.usersuggest.org.empty",s=$("#createchannelwin"),n=s.find("[name='channelscope']:checked").val();if(Channels.isSharedScope(n)?(i=SearchField.checkAndAddEmailInAutocomplete("channels-usersuggest",e),a="channel.usersuggest.empty"):Channels.isOrgGroupScope(n)&&(a="channel.usersuggest.orggroup.empty"),i){var r=$("#channels-usersuggest-list");r.append('<div id="contactshtml" searchcatagory="contacts"></div>'),r.find("#contactshtml").append("<div class='zcuserstatus chatinvt'>"+Resource.getRealValue(a)+"</div>"),this.displayResultDOM(t)}}},getLevelRadioButton:function(e,t){var i=[];return ChannelsPermission.hasPermission(MActions.Create,Channels.Org)&&i.push({id:"channelscope1",value:1,label:Resource.getRealValue("integration.scope1"),checked:Channels.isOrgScope(e)||Channels.isOrgGroupScope(e)&&$.isEmptyObject(t)?!0:!1}),!$.isEmptyObject(t)&&ChannelsPermission.hasPermission(MActions.Create,Channels.OrgGroup)&&i.push({id:"channelscope2",value:2,checked:!$WC.$CUtil.isEmpty(e)&&Channels.isOrgGroupScope(e)?!0:!1,label:Resource.getRealValue("channel.group")}),ChannelsPermission.hasPermission(MActions.Create,Channels.Private)&&i.push({id:"channelscope3",value:3,checked:!$WC.$CUtil.isEmpty(e)&&Channels.isPrivateScope(e)?!0:!1,label:Resource.getRealValue("integration.scope3")}),ChannelsPermission.hasPermission(MActions.Create,Channels.External)&&i.push({id:"channelscope4",value:4,checked:!$WC.$CUtil.isEmpty(e)&&Channels.isSharedScope(e)?!0:!1,label:Resource.getRealValue("integration.scope4")}),i},addVisibilityHtml:function(e){e.find("#channels-visibility").append('<div class="zchlselect zchcnt posl mrgT5"><div id="channelvisibilitytitle" class="zchlcrtpopmn dIB font13 bold mrgT10">'+Resource.getRealValue("common.visibility")+'</div><div id="channelvisibilityradio" class="zcradiobtns dIB floatr"><label id="visiblityaccess" class="visiblityaccess"><input id="visiblityaccessbtn" type="checkbox" class="dN"/><div class="visiblityaccess-btn dIB"><span class="opentoall ellips" title="'+Resource.getRealValue("common.open.to.all")+'">'+Resource.getRealValue("common.open.to.all")+'</span><span class="inviteonly ellips" title="'+Resource.getRealValue("common.invite.only")+'">'+Resource.getRealValue("common.invite.only")+'</span></div></label><div id="channelvisibility-info" class="mrgT10 clr6 font13">'+Resource.getRealValue("channels.opentoall.info")+"</div></div></div>")},addGroupSuggestionHtml:function(e,t){(e.find("#channelscope2").length||t)&&(e.find("#channelscopes-group").append('<div class="zchcnt mrgT15"><div class="zchintt dIB font13 bold">'+Resource.getRealValue("channel.group.title")+'</div><div class="zcaddcnt zcrtdrpd dIB floatr"><div id="channels-groupsuggest"><div id="channels-groupsuggest-selnodes"></div><div id="channels-groupsuggest-search-field" contenteditable="true" listen="keyup" placeholder="'+Resource.getRealValue("channel.team.placeholder")+'" class="crtin" placeholder="search group"></div><div id="channels-groupsuggest-results" class="chdropdwn" style="display:none"></div></div></div></div>'),SearchField.init("channels-groupsuggest"))},addUserSuggestHtml:function(e){e.find("#channelscopes-private").append('<div class="zchcnt"><div id="channel-invite-title" class="zchintt dIB font13 bold">'+Resource.getRealValue("channel.invite.title")+'</div><div id="channels-usersuggest"  class="zcaddcnt zcrtdrpd floatr"><div id="channels-usersuggest-selnodes"></div><div id="channels-usersuggest-search-field" contenteditable="true" placeholder="'+Resource.getRealValue("channel.org.user.placeholder")+'" class="crtin" placeholder="search group"></div><div id="channels-usersuggest-results" class="chdropdwn" style="display:none"></div></div></div></div>'),SearchField.init("channels-usersuggest"),e.find("#channelscopes-private").show()},populateDefaultValue:function(e,t,i,a,s,n,r){if("undefined"!=typeof t&&e.find("#channelnameval").val(t),"undefined"!=typeof s&&e.find("#channeldescval").val(s),!$WC.$CUtil.isEmpty(i)&&(Channels.isOrgScope(i)||Channels.isPrivateScope(i)||Channels.isOrgGroupScope(i)||Channels.isSharedScope(i))&&ChannelsUI.handleScopeRadioChange(i),$WC.$CUtil.isEmpty(a)||(document.getElementById("visiblityaccessbtn").checked="false"===a,ChannelsUI.handleVisibilityChange(i)),!$WC.$CUtil.isEmptyObject(r)&&!$WC.$CUtil.isEmpty(r)){var o=r.scid;if(o.length>0&&Channels.isTeamChannel(r)){$("#channels-groupsuggest-search-field").focus();for(var l=0;l<o.length;l++)Groups.isMyGroup(o[l])?SearchField.insertNodeinField("channels-groupsuggest",void 0,ChannelsUI.groupsuggestion.getTeamNode(o[l],"group")):SearchField.insertNodeinField("channels-groupsuggest",void 0,ChannelsUI.groupsuggestion.getTeamNode(o[l],"group",!1,r.scid_name[o[l]]));$("#channels-groupsuggest-search-field").blur()}}},createEditWin:function(e){var t=Channels.getLevel(e),i=e.scid,a=$WC.template.replace(Template.EditChannel,{CHANNELSCOPERADIOBUTTONS:$Dom.radio.construct("channelscope",this.getLevelRadioButton(t,i)),CHANNELDEFIMAGE:Channels.getImgUrl(e),DESCEXPANDECLASSS:"tatxt",CHANNELID:e.oc_id},"InSecureHTML"),s=ChannelsUI.addHtmlToRHS({id:"editchannelwin",classname:"zchannel",body:a,nav:!0,header:Resource.getRealValue("common.edit")+" "+Resource.getRealValue("channel.head")});if(this.addVisibilityHtml(s),this.addGroupSuggestionHtml(s,Channels.isTeamChannel(e)),this.populateDefaultValue(s,Channels.getNameWithoutHash(Channels.getName(e)),t,e.open_to_all,e.cd,null,e),e.photoid){var n=ChannelsUI.getImage(e.oc_id);s.find("#channeldefimg").hide(),s.find('[type="imgpreview"]').html(n)}Channels.isPending(e.oc_id)&&s.find("#channels-visibility").hide(),ChannelsUI.bindEventsForCreateOrEdit(s),ChannelsUI.enableOrDisableEditButton()},updateChannelList:function(){$("#channelslistview").length>0&&(ChannelsUI.List.makefurtherreqfor_moreallowedchannels=!0,ChannelsUI.List.loadAllowedChannelsView(!1))},create:function(e,t,i){if(_isOrgUser()&&ChannelsPermission.hasPermission(MActions.Create,t)){var a=Groups.getAllOrgGroups(),s=Resource.getRealValue($WC.$CUtil.isEmpty(i)||$WC.$CUtil.isEmpty(i.hidelevel)||!i.hidelevel?"channel.tip.info":"channel.tip.info."+t),n=$WC.$CUtil.isEmpty(i)||$WC.$CUtil.isEmpty(i.hidelevel)||!i.hidelevel?Resource.getRealValue("channel.create.header",""):t!=Channels.OrgGroup?Resource.getRealValue("channel.create.header."+t):Resource.getRealValue("channel.create.header."+t)+'&nbsp;<span class="txtgrn">'+i.teamname+"</span>&nbsp;"+Resource.getRealValue("integration.scope"+t),r=Template.CreateChannel;r=r.replace(/{CHANNELSCOPERADIOBUTTONS}/g,$Dom.radio.construct("channelscope",this.getLevelRadioButton(t,a))).replace(/{CHANNELIMAGE}/g,ChannelsUI.getImage(null,1)).replace(/{CREATECHANNELHINT}/g,s).replace(/{DESCEXPANDECLASSS}/g,"tatxt");var o=$WC.$CUtil.isEmpty(i)||$WC.$CUtil.isEmpty(i.hidelevel)?"zchannel":"sccreate zchannel sc"+t,l=ChannelsUI.addHtmlToRHS({id:"createchannelwin",nav:$WC.$CUtil.isEmpty(i)||$WC.$CUtil.isEmpty(i.hidelevel)||!i.hidelevel,classname:"createchl "+o,header:n,body:r});(l.find("#channelscope2").length||l.find("#channelscope1").length)&&this.addVisibilityHtml(l),this.addGroupSuggestionHtml(l,!1),this.addUserSuggestHtml(l),this.populateDefaultValue(l,e,t),$WC.$CUtil.isEmpty(i)||$WC.$CUtil.isEmpty(i.hidelevel)||!i.hidelevel||($("#createchannelwin").find("#channelscopediv").hide(),i.scope!==Channels.OrgGroup||$WC.$CUtil.isEmpty(i.teamid)||$("#createchannelwin").find("#channels-groupsuggest-search-field").append(ChannelsUI.groupsuggestion.getTeamNode(i.teamid)),$("#createchannelwin").find("#channelscopes-group").hide()),ChannelsAdvRulesUI.checkAndAddRules(),ChannelsUI.bindEventsForCreateOrEdit(l)}},handleEscape:function(){var e=$("#rhssection");return e.find('[data-purpose="chlwindow"]').length?(e.removeClass("zc-profilemenushow zc-chnview").empty(),!0):void 0},addHtmlToRHS:function(e){"channelpreview"===e.id&&delete Clickoutside.data.editchannelwin;var t=($("#rhssection"),e.headerid?'id="'+e.headerid+'"':""),i=e.header,a=$WC.$Win.create({id:e.id,"class":e.classname+" rhsoverly",nav:e.nav,aligncenter:!1,header:"<div "+t+' class="zcchnhdr">'+i+"</div>",sigleton:e.nav,closeoutside:!0,html:e.body,closefn:function(){ChannelsUI.destroyView()}}),s=e.nav&&$WC.$Win.persists()?"chlnav":"";return a.addClass("zc-profilemenushow "+s),a},bindEventsForCreateOrEdit:function(e){function t(e){var t=e.find("#channelnameval"),i=e.find("#channeldescval"),a=e.find("#channels-groupsuggest-search-field"),s=$.trim(t.val()),n=$.trim(i.val()),r=SearchField.getSelectedList("channels-groupsuggest-search-field").join(",");return 0===s.length?(t.focus(),t.addClass("error"),!1):new RegExp(/^[0-9a-zA-Z_\-\&\,\.';\$\?\,\:\+\%\^\*\(\)\`\|\\\=\/\!\[\]~\{\}\u0080-\u9fff\s]+$/).test(s)?n.length>300?(i.addClass("error"),!1):""===n||$WC.Matcher.check("textpattern",n)?0==r.length&&$("#editchannelwin").length&&a.length?(a.addClass("error"),!1):!0:(e.find("#channeldescerrormsg").html(Resource.getRealValue("common.char.error",[$zcg.INVALIDNAMECHARS])),i.addClass("error"),!1):(e.find("#channelnameerrormsg").html(Resource.getRealValue("common.char.error",[$zcg.INVALIDNAMECHARS])),t.addClass("error"),!1)}e.find("#channelscoperadio").on("change","[type='radio']",function(){ChannelsUI.handleScopeRadioChange(this.value)}),e.find("#visiblityaccessbtn").change(function(){var e,t=$("#editchannelwin");if(t.length>0){var i=t.find("#channeldetailscont").attr("channelid"),a=Channels.getObject(i);return e=Channels.getLevel(a),void ChannelsUI.confirmVisibilityChange(a)}ChannelsUI.handleVisibilityChange(e)}),e.find("#channelphoto").on("change",function(){var e=$(this),t=e.siblings("#channeldefimg"),i=$(this).siblings("[type='imgpreview']"),a=this.files[0],s=2;if("undefined"!=typeof a){if(!$Util.isValidImage(e,this.files,s))return;t.hide(),$Util.imgPrview(i,a)}ChannelsUI.enableOrDisableEditButton()}),e.find("#saveeditchannel").on("click",function(){var e=$("#editchannelwin"),i=e.find("#channeldetailscont").attr("channelid"),a=(e.find("#visiblityaccessbtn").prop("checked")?2:1,Channels.getObject(i),$.trim(e.find("#channelnameval").val())),s=$.trim(e.find("#channeldescval").val()),n=(e.find("#channelphoto")[0].files[0],!e.find("#visiblityaccessbtn").get(0).checked),r=SearchField.getSelectedList("channels-groupsuggest-search-field").join(",");t(e)&&($Util.Button.addLoadIcon($("#saveeditchannel")),Channels.edit(i,a,s,e.find("#channelphoto")[0].files[0],n,r))}),e.find("#createchannel").on("click",function(){var e=$("#createchannelwin"),i=e.find("[name='channelscope']:checked").val(),a=e.find("#visiblityaccessbtn").prop("checked")?2:1,s="";if(t(e)){if($WC.$CUtil.isEmpty(i))return $("#channelscope-info").removeClass("clr6").css("color","red"),void $("#channelscopetitle").css("color","red");if(s=SearchField.getSelectedList("channels-groupsuggest-search-field").join(","),Channels.isOrgGroupScope(i)&&$WC.$CUtil.isEmpty(s))return void UI.updateBanner(Resource.getRealValue("channel.sel.group"),2e3,!0);var n=[],r=[];if(e.find("#channels-usersuggest-search-field").length){var o=SearchField.getMultiTypeSelectedList("channels-usersuggest-search-field");r=o.emailids||[],n=o.contact||[]}if(Channels.isSharedScope(i)||Channels.isPrivateScope(i)){if(0===n.length&&0===r.length)return void UI.updateBanner(Resource.getRealValue("channel.sel.atleastuser"),3e3,!0)}else if(r.length>0)return void UI.updateBanner(Resource.getRealValue("channel.sel.emailidnotallowed"),2e3,!0);$Util.Button.addLoadIcon(e.find("#createchannel")),Channels.create(i,$.trim(e.find("#channelnameval").val()),$.trim(e.find("#channeldescval").val()),s,n,r,e.find("#channelphoto")[0].files[0],a)}}),e.on("focusin keyup mouseup focus keydown","[listen='keyup']",function(){var e=$(this);("channelnameval"===this.id||"channeldescval"===this.id||"channels-groupsuggest-search-field"===this.id)&&$Dom.limitInput(e),e.siblings("[category='errormsg']").empty(),e.removeClass("error");var t=$(this).parent();t.find("#channelnamecount, #channeldesccount").removeClass("dN").addClass("dB"),ChannelsUI.enableOrDisableEditButton()}),e.on("focusout blur","[listen='keyup']",function(){var e=$(0===$("#createchannelwin").length?"#editchannelwin":"#createchannelwin");e.find("#channelnamecount, #channeldesccount").removeClass("dB").addClass("dN"),ChannelsUI.enableOrDisableEditButton()})},handleVisibilityChange:function(e){var t=$(0==$("#createchannelwin").length?"#editchannelwin":"#createchannelwin");e="undefined"!=typeof e?e:t.find("[name='channelscope']:checked").val();var i=t.find("#visiblityaccessbtn").prop("checked"),a="";"1"==e?a=Resource.getRealValue(i?"channels.inviteonly.orginfo":"channels.opentoall.orginfo"):"2"==e&&(a=Resource.getRealValue(i?"channels.inviteonly.teaminfo":"channels.opentoall.teaminfo")),$("#channelvisibility-info").html(a)},enableOrDisableEditButton:function(){var e=$("#editchannelwin");if(e.length){var t=e.find("#channeldetailscont").attr("channelid"),i=Channels.getObject(t),a=$.trim(e.find("#channelnameval").val()),s=$.trim(e.find("#channeldescval").val()),n=e.find("#channelphoto")[0].files[0],r=!e.find("#visiblityaccessbtn").get(0).checked,o=SearchField.getSelectedList("channels-groupsuggest-search-field").join(",");e.find("#saveeditchannel").get(0).disabled=a==Channels.getNameWithoutHash(Channels.getName(i))&&s==i.cd&&i.open_to_all==""+r&&$WC.$CUtil.isEmpty(n)&&o==i.scid.join()?!0:!1}},confirmVisibilityChange:function(e){var t=[],i=$("#visiblityaccessbtn"),a=i.prop("checked");if(e.open_to_all===""+!a)return void ChannelsUI.enableOrDisableEditButton();var s=a?"channel.changevisibility.closed.info":"channel.changevisibility.open.info";t=[Resource.getRealValue(s+"."+Channels.getLevel(e)),Resource.getRealValue(s+"1")],i.removeAttr("confirmed"),$WC.$Dlg.confirm({id:"changechannelvisibility",version:2,"class":"zcdalogbx zcbg_mask alert_dialog chlvblty",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:t}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn '+(a?"msi-chnlck":"msi-chnunlck")+' clr-red"></div>',header:Resource.getRealValue(a?"channel.changevisibility.closed.header":"channel.changevisibility.open.header",[$WC.$CUtil.processXSS(e.cn)])}),closefn:function(){"true"!=i.attr("confirmed")&&(i.removeAttr("checked"),document.getElementById("visiblityaccessbtn").checked=!Channels.isOpenToAll(e)),ChannelsUI.handleVisibilityChange(Channels.getLevel(e)),ChannelsUI.enableOrDisableEditButton()},buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.RED_BUTTON,action:function(){i.attr("confirmed","true"),ChannelsUI.handleVisibilityChange(Channels.getLevel(e)),ChannelsUI.enableOrDisableEditButton()}},{text:Resource.getRealValue("common.cancel"),colour:$WC.$Dlg.GREY_BUTTON,action:function(){i.removeAttr("checked"),document.getElementById("visiblityaccessbtn").checked=!Channels.isOpenToAll(e),ChannelsUI.handleVisibilityChange(Channels.getLevel(e)),ChannelsUI.enableOrDisableEditButton()}}]})},handleScopeRadioChange:function(e){$('[purpose="addadvancerules"]').hide(),Channels.isOrgScope(e)?($("#channels-usersuggest-search-field").attr("placeholder",Resource.getRealValue("channel.org.user.placeholder")),$("#channelscopes-group").hide(),$("#channels-visibility").show(),ChannelsUI.handleVisibilityChange(e),$("#channel-invite-title").html(Resource.getRealValue("channel.invite.title")),$("#channelscope-info").html(Resource.getRealValue("channel.org.info")),$("#channeldefimg").html(ChannelsUI.getImage(null,Channels.Org)),$('[purpose="addadvancerules"]').show(),ZCScroll.removeScroll($("#channeldetailscont"))):Channels.isOrgGroupScope(e)&&($("#channels-usersuggest-search-field").attr("placeholder",Resource.getRealValue("channel.team.user.placeholder")),$("#channelscopes-group").show(),$("#channels-visibility").show(),ChannelsUI.handleVisibilityChange(e),$("#channel-invite-title").html(Resource.getRealValue("channel.invite.title")),$("#channelscope-info").html(Resource.getRealValue("channel.group.info")),$("#channeldefimg").html(ChannelsUI.getImage(null,Channels.OrgGroup)),$('[purpose="addadvancerules"]').show(),ZCScroll.customScroll($("#channeldetailscont"),!0)),Channels.isPrivateScope(e)?($("#channels-usersuggest-search-field").attr("placeholder",Resource.getRealValue("channel.private.user.placeholder")),$("#channelscopes-group").hide(),$("#channels-visibility").hide(),$("#channel-invite-title").html(Resource.getRealValue("channel.invite.title")),$("#channelscope-info").html(Resource.getRealValue("channel.private.info")),$("#channeldefimg").html(ChannelsUI.getImage(null,Channels.Private)),$('[purpose="addadvancerules"]').show(),ZCScroll.removeScroll($("#channeldetailscont"))):Channels.isSharedScope(e)&&($("#channels-usersuggest-search-field").attr("placeholder",Resource.getRealValue("channel.shared.user.placeholder")),$("#channelscopes-group").hide(),$("#channels-visibility").hide(),$("#channel-invite-title").html(Resource.getRealValue("channel.invite.title.4")),$("#channelscope-info").html(Resource.getRealValue("channel.shared.info")),$("#channeldefimg").html(ChannelsUI.getImage(null,Channels.Shared)),$('[purpose="addadvancerules"]').show(),ZCScroll.removeScroll($("#channeldetailscont"))),$("#channelnameval").attr("placeholder",Resource.getRealValue("channel.name.ph."+e)),$("#channeldescval").attr("placeholder",Resource.getRealValue("channel.purpose."+e)),$("#channelscope-info").hasClass("clr6")||$("#channelscope-info").addClass("clr6"),$("#channelscopetitle").css("color",""),SearchField.clearSearchField("channels-usersuggest");var t=$("#channelphoto")[0].files.length>0},handleApproval:function(e,t){t?this.List.LHS.populateApproval(!1,[Channels.getApproval(e)]):this.List.LHS.removeApproval(e)},handleEdit:function(e,t,i){var a=Channels.getObject(e),s=a.chid;if("undefined"!=typeof t.name)if(Channels.isPending(a.oc_id))$("#pendingchlname").html(Channels.getDisplayNameForChannel(a));else{var n=a.cn;$("#prevchname"+a.oc_id).html(Channels.getDisplayNameForChannel(a)+'<span class="zcpredot mrgLR5"></span><div id="channelpermalink" chid="'+Channels.getObject(e).chid+'" class="msi-link-line dIB chlpermlink cur" purpose="copypermalink">'+Resource.getRealValue("channel.permalink")+"</div>"),LeftPannel.container.find("#channeldname_"+e).text(n),$("#channelrowslist #cnlistname"+e).text(n),$("#channelheader").filter('[channelid="'+e+'"]').text(Channels.getNameWithoutHash(n)),$("#title"+a.chid).text(Channels.getDisplayNameForChannel(a)),$("#tabtitle"+a.chid).text(Channels.getDisplayNameForChannel(a))}if("undefined"!=typeof t.description){var r=Channels.getObject(e).cd,o=$("#channelrowslist").find("#cnlistdesc"+e);o.length?o.text("#"+r):$("#channelrowslist #"+e).find("#creatorelem").after('<div id="desc'+e+'" class="zchcrt mrgT5 font14 dIB ellips width100">'+$WC.$CUtil.processXSS(r)+"</div>"),$("#channeldesc").text($WC.$CUtil.processXSS(r))}"undefined"!=typeof t.photoid&&(ChatUI.isExist(s)||i||$("#channelpreview").length>0)&&($("#channelpreview #channelimg_preview").html(ChannelsUI.getImage(e)),$("#channelrowslist #cnlistimage"+e).html(ChannelsUI.getImage(e)),ChatUI.updateChannelImage(s)),"undefined"!=typeof t.scid&&(ChatUI.isExist(s)&&ChatUI.getWin(s).updateOrgGroups(t.scid),ChannelsUI.List.LHS.populate(Channels.getJoinedFromLocalStorage())),ChannelsUI.updateIcon(a),i&&($Util.Button.removeLoadAndAddTickMark($("#saveeditchannel")),setTimeout(function(){$WC.$Win.destroy("editchannelwin"),$WC.$Win.destroy("channelpreview"),ChannelsUI.triggerPreview(e)},500))},updateIcon:function(e){function t(e,t,i){n=$("#tab"+i.chid).find('[class="usrdtl-icns"]'),a.html(a.html()+'<em title="'+Resource.getRealValue(e)+'"'+t+"></em>"),s.html(s.html()+'<em title="'+Resource.getRealValue(e)+'"'+t+"></em>"),n.html(n.html()+'<em title="'+Resource.getRealValue(e)+'"'+t+"></em>")}function i(e){$("#tabtile"+e.chid).removeClass("usrdtl-txt"),a.empty(),s.empty(),n.find('[class="usrdtl-icns"]').empty()}if(!$WC.$CUtil.isEmptyObject(e)){e=Channels.checkAndGetObject(e);var a=$("#lhschnicon"+e.chid),s=$("#cwinchnicon"+e.chid),n=$("#tab"+e.chid);i(e),$("#tabtitle"+e.chid).addClass("usrdtl-txt"),Channels.isMultiTeamChannel(e)&&t(ChannelsUI.iconinfo.multiteam,ChannelsUI.iconclasses.multiteam,e),Channels.islockNeeded(e.oc_id)&&t(ChannelsUI.iconinfo.inviteonly,ChannelsUI.iconclasses.inviteonly,e)}},getChat:function(e){if(ChatUI.isExist(e)){this.destroyView();var t=ChatUI.exist[e];t.createdbyme=!0,MainUI.getMefront(e,!0),t.updateWinHeader(),t.addChatInformation()}else Channels.handlejoin(e,!0)},details:function(e){var t=Channels.getByChid(e);if($.isEmptyObject(t))return"";var i='<div class="zchaddmemhead" >{NAME} <span class="zchcrt font14" >'+Resource.getRealValue("group.created.by")+'&nbsp<span class="chusrname">{CREATORNAME}</span></div><div  class="chinvtdes">{DESC}</div>';return i=i.replace(/{NAME}/g,$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(t.cn))).replace(/{CREATORNAME}/g,$WC.Matcher.replace("escapeReplacementString",Users.getName(t.cr,t.cr_n))).replace(/{DESC}/g,$WC.$CUtil.isEmpty(t.cd)?"":$WC.Matcher.replace("escapeReplacementString",t.cd))},clearNewChannelNotification:function(){ChannelsUI.List.LHS.updateNewCount()},handleCreateChatWindow:function(e,t){t&&(e.createfrom="chat",ChannelsUI.destroyView()),$WC.$CUtil.isEmpty(e.users)||"object"==typeof e.users||(e.users=JSON.parse(e.users)),ChatUI.create(e);var i=ChatUI.getWin(e.chid),a=ChatUI.getUnreadOrUnseenMsgCount(e.chid),s=Channels.getByChid(e.chid);$WC.$CUtil.isEmpty(i)||(a>0&&i.initUnreadMsgCount(a),ChannelsPermission.hasPermission(Channels.ACTIONS.SEND_MESSAGE,s)||i.disableComposer(i.chid,Resource.getRealValue("channel.sendmessage.notallowed.message"))),ChannelsUI.List.LHS.update(e.chid)},remove:function(e,t){ChannelsUI.destroyView();var i=!1;if($WC.$CUtil.isEmpty(e))return i;var a=Channels.getObject(e);if(!$.isEmptyObject(a)){var s=a.chid;if(!$WC.$CUtil.isEmpty(s)){{$("#channelslist")}if(i=$("#channelslist").find("#tab"+a.oc_id).length,t)ChatUI.removeWindow(s);else{var n='<div class="zcedtrinfo">'+Resource.getRealValue("channel.delete.deletedinfo")+"</div>";ChatUI.retainWindowOnDelete(s,n)}ChannelsUI.List.LHS.remove(s),LeftPannel.LHSList.removeFromAllCategories(s),ChatsList.markRead(s)}ChannelsUI.List.remove(e)}return ChannelsUI.List.LHS.checkAndRepopulateChannels(),i},List:{RETRIVE_ALL:0,RETRIVE_JOINED:1,RETRIVE_ALLOWED:2,RETRIVE_ORG:6,RETRIVE_ORG_GROUP:7,RETRIVE_PRIVATE:8,RETRIVE_SHARED:9,limit:20,makefurtherreqfor_moreallowedchannels:!0,perv_req_scope_specific:!1,moreallowedchannels_requestmade:!1,allowedfromtime:-1,allowedtotime:-1,allowedtotime_for_scope_specific:-1,joinedsynctime:-1,fragment:null,load:function(){var e={limit:this.limit,pageload:!0,sync:!0};Channels.get(e,this.RETRIVE_ALL,function(e,t){if(ChannelsUI.List.makefurtherreqfor_moreallowedchannels=!0,Channels.SEGMENT=e.joined.length>0?ChannelsUI.List.LHS.isChannelGroupingUIneeded(e.joined):!0,ChannelsUI.List.LHS.populate(e.joined),ChannelsUI.List.LHS.populateApproval(!0),e.joined.length>0){var i=e.joined[0];ChannelsUI.List.joinedsynctime=parseInt(Channels.getObject(i).lmtime)+1}if(e.allowed.length>0){var a=e.allowed[e.allowed.length-1],s=e.allowed[0];ChannelsUI.List.allowedfromtime=parseInt(Channels.getObject(s).lmtime)+1,ChannelsUI.List.allowedtotime=parseInt(Channels.getObject(a).lmtime)-1,ChannelsUI.List.allowedtotime_for_scope_specific=parseInt(Channels.getObject(a).lmtime)-1}t&&t.hasOwnProperty("newchannelscount")&&ChannelsUI.List.LHS.updateNewCount(),LeftPannel.LHSList.fetchConversations()},void 0,function(){LeftPannel.LHSList.fetchConversations()})},LHS:{maximumlimitinLHS:20,minimumlimitforsearch:5,showAllChannels:{create:function(){if(!$WC.$Win.isExist("showallchannelswin")){var e=$WC.template.replace(Template.viewChannelsListPopUp,{$header:"menuname.channelsandgroups",win_id:"morejoinedchannels",sort_dropdown:"",$searchplaceholder:"smartsearch.search.channels"}),t=$WC.$Win.create({id:"showallchannelswin","class":" quickactin adchtwin",html:e,closefn:function(){Clickoutside.clear("category_filter")}});this.bindEvents(t)}},bindEvents:function(e){SearchField.init("morejoinedchannels"),this.populateDefaultResult(),e.on("click","[purpose]",function(e){e.stopPropagation();var t=$(this).attr("purpose");if("apply_filter"===t){var i=$("#morejoinedchannels-list"),a=i.find('[shtype="'+$(this).attr("shtype")+'"][shid="'+$(this).attr("shid")+'"]');$Util.removeHighlighterClass(i.find(".zcmsg_blink")),$Util.scrollToViewportTop(a,i,200,!0),$Util.addHighlighterClass(a),Clickoutside.handleClickOnChild(e)}}),e.find("[showfilter_options]").on("click",function(e){Clickoutside.bind({srcid:"channel_categories",destid:"category_filter",event:e,customShow:function(e){$("#"+e.srcid).addClass("show")},customHide:function(e){$("#"+e.srcid).removeClass("show")}})}),ZCScroll.customScroll($("#morejoinedchannels-list"),!0)},search:function(e){e=$WC.$CUtil.isEmpty(e)?"*":e;var t={searchin:SearchAgent.CHANNELS,val:e,ignorehtml:!0,isjoinedonly:!0,containssearch:!0,startswithsearch:!0},i=Channels.getSearchResults(t);this.populateJoinedChannelsHtml(i.content,t),"*"!==e&&this.populateAllowedChannels(e)},populateAllowedChannels:function(e){var t=$("#morejoinedchannels").find("#morejoinedchannels-results"),i=t.find("#morejoinedchannels-list"),a={searchin:SearchAgent.CHANNELS,val:e,ignorehtml:!0,category:ChannelsUI.List.RETRIVE_ALLOWED,limit:50,successcallback:function(e){$WC.$CUtil.isEmpty(e)||ChannelsUI.List.LHS.showAllChannels.appendAllowedChannelsHtml(e.split(","),a,!0)}},s=Channels.getSearchResults(a);$WC.$CUtil.isEmpty(s.content)||ChannelsUI.List.LHS.showAllChannels.appendAllowedChannelsHtml(s.content,a),$WC.$CUtil.isEmpty(i.html())&&this.populateEmptyResult(t)},appendAllowedChannelsHtml:function(e,t,i){var a="",s=$("#morejoinedchannels-list"),n='<div id="allowedchannels" class="subheader"><span>'+Resource.getRealValue("channel.allowed.header")+"</span></div>",r=[];if(i)for(var o=s[0].querySelectorAll("[elemtype]"),l=0;l<o.length;l++)r.push(o[l].getAttribute("uid"));var c={listhtml:ChannelsUI.htmls.channelslistview,highlight:!0,showDN:!0,val:t.val},d=Channels.getAll();for(var l in e)-1===r.indexOf(e[l])&&(a+=ChannelsUI.List.LHS.getHTML(d[e[l]],c));""!==a&&(0===s.find("#allowedchannels").length&&(a=n+a),s.append(a))},populateJoinedChannelsHtml:function(e,t){var i=$("#morejoinedchannels"),a=i.find("#morejoinedchannels-results"),s=a.find("#morejoinedchannels-list"),n="",r={categoryhtml:'<div purpose="header" zc_running_title shtype="{SHTYPE}"  shid="{ID}" shName="{SHNAME}" class="subheader"><span>{NAME}</span></div>',listhtml:ChannelsUI.htmls.channelslistview,limit:200,highlight:!0,showall:!0,sort:!1,val:t.val};e.length&&(n=ChannelsUI.List.LHS.getCategorySegregatedHtml(e,r)),s.html(n),""!==n&&(s.find("[zc_running_title]").css("display","inline-block"),$Util.initializeStickyTitle(i)),this.updateFilterOptions(i,t)},updateFilterOptions:function(e){var t=e[0].querySelectorAll("[zc_running_title]"),i=e[0].querySelector("[category_filter]"),a=e[0].querySelector("[zc_sticky_title]"),s="";if($(a).removeClass("msi-optns"),t.length>1){for(var n=0;n<t.length;n++){var r=t[n];s+='<div purpose="apply_filter" class="cur ellips" shtype="'+r.getAttribute("shtype")+'" shid="'+r.getAttribute("shid")+'"shname="'+r.getAttribute("shname")+'">'+r.innerHTML+"</div>"}$(a).addClass("msi-optns")}else 0===t.length&&$(a).empty();$(i).html(s)},populateEmptyResult:function(e){var t=$("#channel_categories").attr("filter_type");$WC.$CUtil.isEmpty(t)&&$(e[0].querySelector("[zc_sticky_title]")).removeClass("msi-optns").empty(),$("#morejoinedchannels-list").html('<div class="empty_sugg dflxjustcent w100 h100"><div class="textcent">'+Resource.getRealValue("common.search.none")+"</div></div>")},populateDefaultResult:function(){var e=$("#morejoinedchannels-search-field"),t=$WC.DivEditor.removeBufferCharacters(e.text());$WC.$Win.isExist("showallchannelswin")&&$WC.$CUtil.isEmpty(t)&&(this.search("*"),e.focus())},handleKeyUp:function(e,t){var i=e.which;e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&($WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes("morejoinedchannels-search-field")?$WC.$Win.destroy("showallchannelswin"):(SearchField.clearSearchField("morejoinedchannels"),this.populateDefaultResult()))},handleAction:function(e,t){var i=t.attr("elemtype");if("channel"===i){var a=t.attr("uid");if(!Channels.isJoined(a)||Channels.isArchived(a)||Channels.isPending(a)){var s=e.target?e.target.getAttribute("purpose"):"";"joinchannel"===s?(ChannelsUI.doOperation("join",a),$WC.$Win.destroy("showallchannelswin")):ChannelsUI.triggerPreview(a)}else{var n=t.attr("chid");Channels.handlejoin(n,!0),$WC.$Win.destroy("showallchannelswin")}}}},html:function(e,t,i){var a=i&&i.listhtml?i.listhtml:ChannelsUI.htmls.joinedlhs,s=i&&i.showDN?e.dn:t.name,n=e.oc_id,r=e.chid;if(i&&i.highlight){var o=s.toLowerCase().indexOf(i.val),l=new RegExp($WC.Matcher.replace("escaperegexp",i.val),"i");-1!==o&&(s=s.replace(l,"<b>$&</b>"))}return a=a.replace(/{CHID}/g,r).replace(/{OC_ID}/g,"undefined"!==n?n:"").replace(/{CNAME}/g,$WC.Matcher.replace("escapeReplacementString",s)).replace(/{TITLEVAL}/,Resource.getRealValue(ChannelsUI.iconinfo[t.level])).replace(/{CHN_LCK}/,Channels.islockNeeded(e)?'<em title="'+Resource.getRealValue("channel.lock.tip")+'" class="msi-chnlck"></em>':"").replace(/{CHN_TYPE_ICON}/,Channels.isMultiTeamChannel(e)?'<em title="'+Resource.getRealValue("channel.multiteam.icon.tip")+'" class="msi-multiteamchannel"></em>':"").replace(/{CHN_ICONS}/,Channels.islockNeeded(e)&&Channels.isMultiTeamChannel(e)?"chnmultiicns":"").replace(/{IMG}/g,ChannelsUI.getImage(e.oc_id,e.sc,24,!0)).replace(/{JOINBTN_CLS}/,e.joined?"dN":"").replace(/{CDESCRIPTION_CLS}/,$WC.$CUtil.isEmpty(e.cd)?"dN":"").replace(/{CDESCRIPTION}/g,$WC.$CUtil.isEmpty(e.cd)?"":e.cd),ChatUI.hasUnreadOrUnseenMsgs(r)?(a=a.replace(/{MUTECSS}/g,ChatUI.isMuted(r)?"mute":""),a=a.replace(/{UNREADCOUNT}/g,ChatUI.getUnreadOrUnseenMsgCount(r)),a=a.replace(/{UNREADCOUNTCLASS}/g,"actunrdmg"),a=a.replace(/{ISUNREAD}/g,'unread="true"')):(a=a.replace(/{MUTECSS}/g,""),a=a.replace(/{UNREADCOUNT}/g,""),a=a.replace(/{UNREADCOUNTCLASS}/g,""),a=a.replace(/{ISUNREAD}/g,""),a=a.replace(/{CHANNELSLEVEL}/g,Channels.SEGMENT?"":Channels.getLevel(e))),a},getHTML:function(e,t){var i={name:e.cn,channelid:e.oc_id,level:Channels.getLevel(e)};ChatUI.hasUnreadOrUnseenMsgs(e.chid)&&(i.unread=ChatUI.getUnreadOrUnseenMsgCount(e.chid));var a=this.html(e,i,t);return a},headHTML:function(e,t){var i=ChannelsPermission.hasPermission(MActions.Join,e.subheaderLevel)||ChannelsPermission.hasPermission(MActions.Create,e.subheaderLevel),a=t&&t.categoryhtml?t.categoryhtml:'<div id="tab{ID}"  class="zcuserstatus zclefch " profile="channelssubheader" shtype="{SHTYPE}" shId="{ID}" shName={SHNAME}><div id="{ID}header" class="floatl userdetails zclefchhd" shId="{ID}" catagory="channelssubheader"  elemtype="header" workfor="channel" ><span id="tabscode{ID}" title="{TITLEVAL}" class="{ICON_CLASS} msci" shId="{ID}" ></span><span id="channeldname" class="ellips zchdnm" title="'+Resource.getRealValue("common.lhs.headertip")+'">{NAME}</span>'+(i?'<span id="createorjoinicon{ID}" operation="createorjoin" elemtype="channel" class="msi-optmore cur" scope={SCOPE} shId="{ID}" shName="{SHNAME}"></span>':"")+'</div><div id="channelssublist" class="width100 floatl zclefchsb">',s=a.replace(/{ID}/g,e.subheaderId).replace(/{SHNAME}/g,e.subheaderName).replace(/{NAME}/g,e.subheadertitle).replace(/{SHTYPE}/g,e.subheaderType).replace(/{SCOPE}/g,e.subheaderLevel).replace(/{ICON_CLASS}/g,"msi-sc"+e.subheaderLevel).replace(/{TITLEVAL}/g,Resource.getRealValue(ChannelsUI.iconinfo[e.subheaderLevel]));return s},getInfoforhtml:function(e,t,i){var a={};if(i){a.name=$WC.$CUtil.isEmpty(e)||$WC.$CUtil.isEmpty(e.cn)?t.title:e.cn;var s=Chat.parseAddinfo(t.addinfo);a.level=$.isEmptyObject(s)?$WC.$CUtil.isEmpty(t.orggroups)?Channels.Org:Channels.OrgGroup:parseInt(s.CHANNEL_SCOPE)}else a.name=t.cn,a.level=Channels.getLevel(t),a.channelid=t.oc_id,ChatUI.hasUnreadOrUnseenMsgs(t.chid)&&(a.unread=ChatUI.getUnreadOrUnseenMsgCount(t.chid));return a},add:function(e,t,i){var a=Channels.getByChid(t.chid);if(!$WC.$CUtil.isEmpty(a)&&!$WC.$CUtil.isEmpty(a.cn)){var s=($(ChatUI.isMuted(e)?"#mutedchatslist":"#chatslist"),""),n=$("#channelslist"),r="",o=Channels.getSubHeaderId(a);if(n.has("#tab"+o)&&(r=$("#tab"+o)),a.pinned||(ChatUI.isMuted(e)?LeftPannel.LHSList.addNewInUI("mutedchats",[e]):LeftPannel.LHSList.addNewInUI("chats",[e])),0===n.find("#tab"+a.oc_id).length){if(s+=this.html(a,this.getInfoforhtml(a,t,i)),$WC.$CUtil.isEmpty(r)||0==r.length){var l=Channels.getsubheaderInfo(a),c=this.headHTML(l);c+=s+"</div></div>",this.appendSubHeaderHtml(c,l)}else{var d=r.find("#channelssublist");this.removeInactiveChannels(d),d.prepend(s)}var u=n.find('[emptymsg="true"]');u.length>0&&u.remove(),$("#tab"+e).addClass(ChatUI.isCurrent(e)?"chatsel":"")}ChannelsUI.List.LHS.checkAndRepopulateChannels()}},appendSubHeaderHtml:function(e,t){var i=$("#channelslist"),a=t.subheaderName,s=t.subheaderType,n=i.children('[profile="channelssubheader"]'),r="";if(s==Channels.SUBHEADER_SHARED)for(var o=0;o<n.length;o++){var l=n[o].getAttribute("shtype");{if(l!=Channels.SUBHEADER_PRIVATE&&l!=Channels.SUBHEADER_ORG_SCOPE&&l!=Channels.SUBHEADER_ORG_GROUP_SCOPE)break;r=n[o].getAttribute("id")}}if(s==Channels.SUBHEADER_PRIVATE)for(var o=0;o<n.length;o++){var l=n[o].getAttribute("shtype");{if(l!=Channels.SUBHEADER_ORG_SCOPE&&l!=Channels.SUBHEADER_ORG_GROUP_SCOPE)break;r=n[o].getAttribute("id")}}if(s==Channels.SUBHEADER_ORG_SCOPE)for(var o=0;o<n.length;o++){var l=n[o].getAttribute("shtype");{if(l!=Channels.SUBHEADER_ORG_GROUP_SCOPE)break;r=n[o].getAttribute("id")}}if(s==Channels.SUBHEADER_ORG_GROUP_SCOPE)for(var o=0;o<n.length;o++){var c=n[o].getAttribute("shname");{if(!(a>c))break;r=n[o].getAttribute("id")}}$WC.$CUtil.isEmpty(r)?i.prepend(e):$("#"+r).after(e),$("#"+Channels.SUBHEADER_NONE+"header").css("display","none")},removeInactiveChannels:function(e){var t=e.children('[elemType="channel"]'),i=$("#channelslist").has("#channelsmore");if(i.length>0&&t.length>=5){for(var a,s=0,n=0;n<t.length;n++){var r=t[n].getAttribute("chid");if(!ChatUI.isExist(r)&&!ChatUI.hasUnreadOrUnseenMsgs(r)){var o=Channels.getByChid(r),l=Channels.getLastMsgTimeForChannel(o);(0===s||s>l)&&(s=l,a=o.oc_id)}}$WC.$CUtil.isEmpty(a)||e.find("#tab"+a).remove()}},slideSlow:function(e){for(var t=e.children('[profile="channelssubheader"]'),i=0;i<t.length;i++){var a=t[i].getAttribute("shId"),s=$("#tab"+a).find("#channelssublist");if("none"!=s.css("display"))return!0}return!1},toggle:function(){var e=LeftPannel.container.find("#channelslist"),t="none"===e.css("display"),i={hpchannels:t?1:0};Settings.update(i)},toggleSubHeader:function(e){var t=$("#tab"+e).find("#channelssublist"),i=$Util.getSpeedForSliding(t),a="none"===t.css("display");a?t.slideDown(i,function(){ZCScroll.updateScroll($("#leftpannel #list")),ChatsList.updateUnreadNotifier()}):t.slideUp(i,function(){ZCScroll.updateScroll($("#leftpannel #list")),ChatsList.updateUnreadNotifier()});var s={shId:"shid"+e,shState:a?1:0};Settings.update(s),ChannelsUI.List.LHS.updateChannelsSubHeaderHtml(e,!1,!a)},updateChannelsSubHeaderHtml:function(e,t,i){if(t){e=Channels.getSubHeaderId(Channels.getByChid(e));var a=$("#tab"+e).find("#channelssublist");i="none"===a.css("display")}for(var s=$("#tab"+e),n=s.find("#channelssublist"),r=n.find("[unread]"),o=s.find("#msgcount"+e),l=0,c=0;c<r.length;c++){{var d=r[c].getAttribute("chid");Channels.getByChid(d)}ChatUI.hasUnreadOrUnseenMsgs(d)&&!ChatUI.isMuted(d)&&l++}i?o.show():o.hide(),l>0?o.html(l):o.html("").hide()},rearrangeChannelsList:function(){var e=$("#channelslist"),t=e.children('[profile="channelssubheader"]');i=0;for(var a=Channels.getAll();i<t.length;){var s=$(t[i]).find("#channelssublist"),n=s.children('[elemType="channel"]');channels=[];for(var r=0;r<n.length;r++){var o=n[r].getAttribute("uid");channels.push(o)}var l=this.sortChannels(channels,a);channels=l.channelswithunread,channels=channels.concat(l.channelsarr);for(var r=0;r<channels.length;r++){var c=a[channels[r]];s.find("#tab"+c.oc_id).detach().appendTo(s)}i++}},sortChannels:function(e,t){var i=[],a=[];o=[],t=t?t:Channels.getAll();for(var s=0,n=e.length;n>s;s++){var r=t[e[s]];Channels.isPinned(r)||Channels.isArchived(r)||(ChatUI.hasUnreadOrUnseenMsgs(r.chid)?i.push(e[s]):a.push(e[s]))}i=Channels.sortChannelsByLMsgTime(i,t),a=Channels.sortChannelsByLMsgTime(a,t);var o={channelswithunread:i,channelsarr:a};return o},groupChannels:function(e,t){var i=[],a=[],s=[],n=[],r=[],o=[];t=t?t:Channels.getAll();for(var l=0,c=e.length;c>l;l++){var d=t[e[l]],u=Channels.getSubHeaderId(d);if(u==Channels.SUBHEADER_ORG_SCOPE)a.push(e[l]);else if(u==Channels.SUBHEADER_PRIVATE)s.push(e[l]);else if(u==Channels.SUBHEADER_SHARED)n.push(e[l]);else if(u==Channels.SUBHEADER_NONE)r.push(e[l]);else{var m=d.scid_name[u];"undefined"==typeof i[m]&&(i[m]=[],o.push(m)),i[m].push(e[l])}}var i=this.sortTeamNames(i,o),p={teamVsChannels:i,publicChannels:a,privateChannels:s,sharedChannels:n,nonsegmentedChannels:r};return p},sortTeamNames:function(e,t){var i=[];t.sort();for(var a=0;a<t.length;a++){var s=t[a];"undefined"==typeof i[s]&&(i[s]=[]);for(var n=e[s],r=0;r<n.length;r++){var o=n[r];i[s].push(o)}}return i},populateSubHeader:function(e,t,i,a,s){var n="",r="";if(a=a?a:Channels.getAll(),e.length>0){for(var r=this.headHTML(Channels.getsubheaderInfo(a[e[0]]),s),o=0;o<e.length;o++)n+=this.getHTML(a[e[o]],s);r+=n+"</div></div>"}return r},checkAndCollapseSubHeader:function(){for(var e=$("#channelslist").children('[profile="channelssubheader"]'),t=0;t<e.length;t++){var i=e[t].getAttribute("shid"),a=Settings.getFromObj("shid"+i);if("0"==a){var s=$("#tab"+i).find("#channelssublist");s.hide(),ChannelsUI.List.LHS.updateChannelsSubHeaderHtml(i,!1,!0)}}},getCategorySegregatedHtml:function(e,t){var i=Channels.getAll();if(t.sort){{var a=this.sortChannels(e,i,t.showall);a.channelswithunread.length+a.channelsarr.length}e=a.channelswithunread;for(var s=0;s<a.channelsarr.length&&e.length<t.limit;)e.push(a.channelsarr[s]),s++}var n="",r=this.groupChannels(e,i),o=r.teamVsChannels;for(var l in o){var c=o[l],d=i[c[0]].scid[0];n+=this.populateSubHeader(c,d,Channels.OrgGroup,i,t)}return n+=this.populateSubHeader(r.publicChannels,Channels.SUBHEADER_ORG_SCOPE,Channels.Org,i,t),n+=this.populateSubHeader(r.privateChannels,Channels.SUBHEADER_PRIVATE,Channels.Private,i,t),n+=this.populateSubHeader(r.sharedChannels,Channels.SUBHEADER_SHARED,Channels.Shared,i,t),n+=this.populateSubHeader(r.nonsegmentedChannels,Channels.SUBHEADER_NONE,-1,i,t)},checkAndRepopulateChannels:function(){var e=Channels.getJoinedFromLocalStorage(),t=Channels.SEGMENT;Channels.SEGMENT=ChannelsUI.List.LHS.isChannelGroupingUIneeded(e),Channels.SEGMENT!=t&&ChannelsUI.List.LHS.populate(e)},populate:function(e){var t=Channels.getAll(),i=this.sortChannels(e,t),a=i.channelswithunread.length+i.channelsarr.length,s={limit:ChannelsUI.List.LHS.maximumlimitinLHS,sort:!0},n=this.getCategorySegregatedHtml(e,s),r=Settings.getFromObj("hpchannels");if(r||$("#channelslist,#channelspendinglist").hide(),Channels.hasChannels()&&!LeftPannel.hasComponent("channel")&&ChannelsUI.initLHS(),n.length>0){LeftPannel.hasComponent("channel")||ChannelsUI.initLHS();var o=$("#channelslist");o.empty(),o.prepend(n),uilimit=o.find('[elemType="channel"]').length,a>uilimit&&0===o.find("[elemtype='more']").length&&o.append('<div id="channelsmore" class="zcuserstatus zcmorechl" catagory="channels" workfor="channel" elemtype="more"><span class="showmore">'+Resource.getRealValue("common.showall")+"</span></div>")}else if(n.length<=0){var l='<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("channel.initial.none")+"</div>";$("#channelslist").html(l)}$("#"+Channels.SUBHEADER_NONE+"header").css("display","none"),$("#channelslhs").addClass(Channels.SEGMENT?"segment":""),_doChangesIfInitialised("channels"),this.checkAndCollapseSubHeader()},isChannelGroupingUIneeded:function(e){for(var t=Channels.getObject(e[0]),i=Channels.getLevel(t),a=1;a<e.length;a++)if(t=Channels.getObject(e[a]),i!=Channels.getLevel(t)&&!Channels.isArchived(t))return!0;return!1},populateApproval:function(e,t){var i=function(e){var t=ChannelsUI.htmls.pendinglhs;return t=t.replace(/{ID}/g,e.oc_id).replace(/{NAME}/g,$WC.Matcher.replace("escapeReplacementString",e.cn))},a=$("#channelspendinglist"),s="";if(e){a.children('[elemType="channel"]').remove();var n=Channels.getApproval(),r=0;for(var o in n)s+=i(n[o]),r++;r>0&&a.html(s)}else if(t.length>0){for(var s="",o=0,l=t.length;l>o;o++)0==$("#channelpending"+t[o].oc_id).length&&(s+=i(t[o]));a.prepend(s)}},updateNewCount:function(){var e=$("#channelsheader").find("#newcount"),t=$Util.getObjectKeysLength(Channels.NewAllowed);t>0?e.html(t).show():e.hide()},remove:function(e){var t=Channels.getByChid(e);if(!t||!t.pinned){var i=$("#channelslist");i.find("#tab"+t.oc_id).remove();var a=Channels.getSubHeaderId(t),s=$("#tab"+a),n=s.find("#channelssublist"),r=0==n.children('[elemType="channel"]').length?!0:!1;r&&i.find("#tab"+a).remove();var o=i.find("[uid]");if(0===o.length){var l='<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("channel.initial.none")+"</div>";$("#channelslist").html(l)}}},updateListFromMoreJoined:function(e){var t=5,i=$("#channelslist"),a=Channels.getRemainingJoinedChannels(),s=$("#channelslist").html(),n=$("#channelslist").has("#channelsmore");if(0===n.length&&a.length>0&&(s=s+'<div id="channelsmore" class="zcuserstatus zcmorechl" catagory="channels" workfor="channel" elemtype="more"><span class="showmore">'+Resource.getRealValue("common.showall")+"</span></div>",i.html(s)),0===a.length&&0===i.children().length){var r='<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("channel.initial.none")+"</div>";$("#channelslist").html(r)}if(e&&a.length>0&&$("channelslist").children().length<t){var o=Channels.getObject(a[0]);ChannelsUI.List.LHS.add(o.chid,o,!1)}(e&&a.length<=1||0==a.length)&&$("#channelslist").find("#channelsmore").remove()},removeApproval:function(e){var t=$("#channelspendinglist");t.find("#channelpending"+e).remove()},removeNewChannelsUnseenNoti:function(e){var t=$("#channelslistview").find("#channelrowslist");t.find($("#"+e)).removeClass("unseen")},update:function(e){$("#channelslist #tab"+e).attr("uid",Channels.getByChid(e).oc_id)}},addScopeCriteria:function(e){var t=$("#channelslistview");if(t.length<=0||!t.hasClass("sclist"))return e;var i=t.find("#chnlist"),a=i.attr("scope"),s=i.attr("shid");return $WC.$CUtil.isEmpty(a)||(e.scope=parseInt(a)),$WC.$CUtil.isEmpty(a)||parseInt(a)!==Channels.OrgGroup||$WC.$CUtil.isEmpty(s)||(e.team_ids=s),e},loadAllowedChannelsView:function(e,t){if(e){ChannelsUI.List.fragment=null,Groups.loadMyOrgGroups();var i=$.extend({},{initialtime:!0},t),a=Channels.getAllowedFromLocalStorage(!0,i.scope,i.teamid);ChannelsUI.List.view(a,i),this.moreallowedchannels_requestmade=!0,this.allowedtotime_for_scope_specific=this.allowedtotime,this.makefurtherreqfor_moreallowedchannels=this.makefurtherreqfor_moreallowedchannels||this.perv_req_scope_specific;var s={limit:ChannelsUI.List.limit,allowedfromtime:$WC.$CUtil.isEmpty(i.scope)?this.allowedfromtime:-1,sync:!0};this.addScopeCriteria(s),Channels.get(s,this.RETRIVE_ALLOWED,function(e){if(ChannelsUI.List.moreallowedchannels_requestmade=!1,e.allowed.length>0&&$WC.$CUtil.isEmpty(s.scope)){var i=e.allowed[0];ChannelsUI.List.allowedfromtime=parseInt(Channels.getObject(i).lmtime)+1}if(e.joined.length>0&&$WC.$CUtil.isEmpty(s.scope)){var a=e.joined[0];ChannelsUI.List.joinedsynctime=parseInt(Channels.getObject(a).lmtime)+1}var n=$.extend({},{repopulate:!0},t),r=Channels.getAllowedFromLocalStorage(!0,n.scope,n.teamid);ChannelsUI.List.view(r,n),Channels.hasNewAllowedChannel()&&(HomeUI.markComponentAsSeen(-1,2),Channels.removeNewAllowedChannels(-1))})}else if(this.makefurtherreqfor_moreallowedchannels&&!this.moreallowedchannels_requestmade){this.moreallowedchannels_requestmade=!0,ChannelsUI.List.showLoading();var s={limit:ChannelsUI.List.limit,allowedtotime:ChannelsUI.List.perv_req_scope_specific?this.allowedtotime_for_scope_specific:this.allowedtotime};this.addScopeCriteria(s),Channels.get(s,this.RETRIVE_ALLOWED,function(e,i){if(ChannelsUI.List.perv_req_scope_specific=!$WC.$CUtil.isEmpty(s.scope),e.allowed.length>0){var a=e.allowed[e.allowed.length-1];$WC.$CUtil.isEmpty(s.scope)?ChannelsUI.List.allowedtotime=parseInt(Channels.getObject(a).lmtime)-1:ChannelsUI.List.allowedtotime_for_scope_specific=parseInt(Channels.getObject(a).lmtime)-1}ChannelsUI.List.makefurtherreqfor_moreallowedchannels=i.moreallowed,ChannelsUI.List.moreallowedchannels_requestmade=!1;var n=$.extend({},{repopulate:!0},t),r=Channels.getAllowedFromLocalStorage(!0,n.scope,n.teamid);ChannelsUI.List.view(r,n),Channels.hasNewAllowedChannel()&&(HomeUI.markComponentAsSeen(-1,2),Channels.removeNewAllowedChannels(-1))})}},showLoading:function(e,t){var i=($("#channelslistview"),t?t:$("#channelrowslist"));0===i.find("#channellistloading").length&&(e?i.html('<div id="channellistloading" class="zcldng"></div>'):i.append('<div id="channellistloading" class="chlmore-loading"></div>'))},view:function(e,t){var i=function(e){var t=$("#channelslistview");if(!t.hasClass("sclist"))return!0;var i=t.find("#chnlist"),a=i.attr("scope"),s=parseInt(a);if(s===Channels.Org)return Channels.getLevel(e)===Channels.Org;if(s===Channels.OrgGroup&&Channels.getLevel(e)===Channels.OrgGroup){var n=i.attr("shid");return!$WC.$CUtil.isEmpty(n)&&Channels.isBelongstoTeam(e,n)}return s===Channels.Private||s===Channels.Shared?s===Channels.getLevel(e):!1},a=function(e,t){var a=parseInt(e.st),s=(Channels.getLevel(e),Groups.getGroupNames(e.scid,e.scid_name),Channels.isJoined(e));if(!i(e,t))return"";e.pc=$WC.$CUtil.isEmpty(e.pc)?0:e.pc;var n='<div id="{ID}" channelid="{CHANNELID}" purpose="view" chid="{CHID}" {NEWCHANNEL} class="zchnsrcmg {CURPOIN}{NEWCHANNELCLASS}"><div id="cnlistimage'+e.oc_id+'" class="zchlistimg mrgR10 mrgL50">{IMAGE}</div><div class="zclstcnt"><div class="zchnsrclft"><div class="zchlsrctit"><div id="cnlistname'+e.oc_id+'" class="zchlstcn floatl ellips">{CHANNELNAME}&nbsp;</div>'+("undefined"!=typeof e.cd?'<div id="cnlistdesc'+e.oc_id+'" class="zchcrt mrgT5 font14 dIB ellips width100">'+$WC.$CUtil.processXSS(e.cd)+"</div>":"")+'</div></div><div class="zchnsrcrht"><span class="clrboth zchactime">Active {LMTIME}</span>'+(a===Channels.CREATED||a===Channels.ARCHIVED?(s||a!==Channels.CREATED?"":'<input class="zcrtch ellips bold" purpose="join" type="button" value="'+Resource.getRealValue("common.join")+'">')+'<div class="zcmemsts dIB"><div class="dIB" title="'+(e.pc>1?Resource.getRealValue("chat.participants.count",[e.pc]):Resource.getRealValue("channel.tip.joinedparticip",[e.pc]))+'"><span class="msi-guest"></span><span class="clr6">'+e.pc+"</span></div></div>":Channels.isMyPendingChannel(e)?Channels.isEditVisibility(e)?'<div class="ital clr8 dIB mrgLR5">'+Resource.getRealValue("channel.editchannelaccess")+"</div>":'<div class="ital clr8 dIB mrgLR5">'+Resource.getRealValue("channel.mypending.header")+"</div>":'<input class="zcrtch ellips bold" purpose="approve" type="button" title="'+Resource.getRealValue("common.approve")+'" value="'+Resource.getRealValue("common.approve")+'">')+"</div></div></div>",r=!s&&Channels.isNewAllowedChannel(e.oc_id),o=Channels.getDisplayNameForChannel(e),l=$WC.$CUtil.processXSS(o),c=t.searchvalue;if(!$WC.$CUtil.isEmpty(c)){var d=l.toLowerCase().indexOf(c),u=new RegExp($WC.Matcher.replace("escaperegexp",c),"i");-1!==d&&(l=l.replace(u,"<b>$&</b>"))}return n=n.replace(/{CURPOIN}/g,"cur").replace(/{CHANNELNAME}/,$WC.Matcher.replace("escapeReplacementString",l)).replace(/{CHANNELID}/,e.oc_id).replace(/{NEWCHANNELCLASS}/,r?" unseen":"").replace(/{NEWCHANNEL}/,r?"newchannel":"").replace(/{CHID}/g,"undefined"!=typeof e.chid?e.chid:"").replace(/{IMAGE}/g,ChannelsUI.getImage(e.oc_id,e.sc)).replace(/{LMTIME}/g,$Date.relative(e.lmtime)).replace(/{ID}/g,e.oc_id)},s=function(e,t){t.fromsearch=!$WC.$CUtil.isEmpty(t.searchvalue);var i,s={initialtime:!1,repopulate:!1,fromsearch:!1,searchvalue:""},t=$.extend({},s,t);if(t.initialtime){var n='<input id="contaddbtn" purpose="create"  type="button" class="buttn_pos zchlstcrt mrgR30 mrgL30" title="'+Resource.getRealValue("channel.create.header","")+'" value="'+Resource.getRealValue("channel.create.header","")+'"/>',r=Template.ListChannel;r=r.replace(/{CREATE_CHANNEL_BTN}/g,ChannelsPermission.hasPermission(MActions.Create)?n:"").replace(/{CHANNELFOOTER}/g,ChannelsPermission.hasPermission(MActions.Create)?'<div id="chnlistfooter" class="txtcent dflxcent footr">'+Resource.getRealValue("channel.allowed.footer")+'<span scope="{SCOPE}" shId="{ID}" shName="{SHNAME}" purpose="create">{FOOTERLINK}</span></div>':"").replace(/{ID}/g,$WC.$CUtil.isEmpty(t.teamid)?"":t.teamid).replace(/{SHNAME}/g,$WC.$CUtil.isEmpty(t.teamname)?"":t.teamname).replace(/{SCOPE}/g,$WC.$CUtil.isEmpty(t.scope)?"":t.scope).replace(/{FOOTERLINK}/g,$WC.$CUtil.isEmpty(t.scope)?"":Resource.getRealValue("channel.allowed.footer.link."+t.scope));var o=$WC.$CUtil.isEmpty(t.scope)?Resource.getRealValue("menuname.channelsandgroups"):t.scope!=Channels.OrgGroup?Resource.getRealValue("channel.join.header."+t.scope):'<span class="txtgrn">'+t.teamname+"</span>&nbsp;"+Resource.getRealValue("channel.join.header."+t.scope);i=ChannelsUI.addHtmlToRHS({id:"channelslistview",classname:$WC.$CUtil.isEmpty(t.scope)?"zchannel":"sclist zchannel sc"+t.scope,header:o,body:r}),ChannelsUI.List.bindEvents(i)}else{if(!$("#channelslistview")[0])return;i=$("#channelslistview")}i.hasClass("sclist")?i.find("#chnlistheader").remove():i.find("#chnlistfooter").remove();for(var l="",c="",d="",u="",m="",p="",h=i.find("#channelrowslist"),g=0,f=e.length;f>g;g++){var v=Channels.getObject(e[g]);t.fromsearch||0===h.find("#"+v.oc_id).length||h.find("#"+v.oc_id).replaceWith(""),v.st==Channels.ARCHIVED?p+=a(v,t):!Channels.isJoined(v)&&Channels.isNewAllowedChannel(v.oc_id)?m+=a(v,t):Channels.isJoined(v)?l+=a(v,t):c+=a(v,t)}if(i.find("#channellistloading").remove(),!t.fromsearch&&(t.initialtime||t.repopulate)){var C=Channels.getApproval();for(var g in C)d+=a(C[g],t);$.trim(d).length>0&&(t.initialtime||t.repopulate||0===i.find("#channelpendingheader").length)&&(d='<div id="channelpendingheader" class="zcmorechtxt font15">'+Resource.getRealValue("channel.pending.header")+"</div>"+d);var y=Channels.getMyPending();for(var g in y)u+=a(y[g],t);$.trim(u).length>0&&(t.initialtime||t.repopulate||0===i.find("#channelmypendingheader").length)&&(u='<div id="channelmypendingheader" class="zcmorechtxt font15">'+Resource.getRealValue("channel.mypending.header")+"</div>"+u)}$.trim(l).length>0&&(t.initialtime||t.repopulate||0===i.find("#channelmineheader").length)&&(l='<div id="channelmineheader" class="zcmorechtxt font16">'+Resource.getRealValue("channel.mejoined.header")+"</div>"+l),$.trim(c).length>0&&(t.initialtime||t.repopulate||0===i.find("#channelnotmineheader").length)&&(c='<div id="channelnotmineheader" class="zcmorechtxt font16">'+Resource.getRealValue("channel.allowed.header")+"</div>"+c),$.trim(p).length>0&&(t.initialtime||t.repopulate||0===i.find("#channelarchivedheader").length)&&(p='<div id="channelarchivedheader" class="zcmorechtxt font16">'+Resource.getRealValue("channel.archived.header")+"</div>"+p),$.trim(m).length>0&&(t.initialtime||t.repopulate||0===i.find("#channelnewheader").length)&&(m='<div id="channelnewheader" class="zcmorechtxt font16">'+Resource.getRealValue("channels.newly.created")+"</div>"+m);var b=$.trim(m+u+d+c+l+p);return b},n=s(e,t),r=$("#channelslistview"),o=r.find("#channelrowslist");if($("#channellistsearchholder").removeClass("dN"),t.fromsearch)o.html(n&&0!==n.length?n:'<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("channel.none.search")+"</div></div>");else if(n&&0!==n.length)o.html(n);else if(t.initialtime)this.showLoading(!0,o);else if(t.repopulate){var l=Channels.getJoinedFromLocalStorage({lmtime:!0}),n=s(l,t);n&&0!==n.length?o.html(n):($("#channellistsearchholder").addClass("dN"),o.html('<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("channel.none",$WC.$CUtil.isEmpty(t.scope)?"":Resource.getRealValue("integration.scope"+t.scope))+"</div></div>"))}r.find("#channelslistsearch").focus(),ZCScroll.resetScroll($("#channelrowslist"))},removeApproval:function(e){this.remove(e),0==$Util.size(Channels.Approval)&&$("#channelpendingheader").remove()},remove:function(e){$("#channelrowslist #"+e).remove(),$zcg._ISAPPACCOUNTADMIN||$("#channelpending"+e).remove()},bindEvents:function(e){e.on("click","[purpose]",function(e){e.stopPropagation();var t=$(this),i=t.attr("purpose"),a=t;"view"!==i&&(a=t.parents("[purpose='view']"));var s=a.attr("channelid"),n=a.attr("chid");if("view"===i)ChannelsUI.triggerPreview(s),t.is("[newchannel]")&&ChannelsUI.List.LHS.removeNewChannelsUnseenNoti(this.getAttribute("channelid"));else if("create"===i){var r=t.attr("scope"),o=$WC.$CUtil.isEmpty(r)?{}:{hidelevel:!0,scope:parseInt(r),teamid:t.attr("shId"),teamname:t.attr("shname")};ChannelsUI.create($("#channelslistsearch").val(),parseInt(r),o)}else ChannelsUI.doOperation(i,s,n)}),e.find("#channelrowslist").on("scroll",function(){$("#channelslistview");if(ZCScroll.isScrollDown(this)){var e=$("#channelslistsearch").val();""===$.trim(e)&&ChannelsUI.List.loadAllowedChannelsView()}}),e.find("#channelslistsearch").on("keyup",function(e){Channels.handleSearch($(this).val(),e)})}},triggerPreview:function(e,t){var i="channelpreview";if($WC.$Win.isExist(i)&&$("#"+i).attr("currchannelprev")===e)return void(i!==$WC.$Win.current&&$WC.$Win.getFront("channelpreview"));var a=Channels.getObject(e);return"undefined"==typeof a?void Channels.preview(e,void 0,void 0,!0):(Channels.isCreated(a)||Channels.isArchived(a)||Channels.isEditVisibility(a)?(ChannelsUI.Preview.construct(parseInt(a.st),e),Channels.preview(e)):Channels.isPending(e)&&ChannelsUI.Preview.construct(Channels.PENDING,e),void(t&&ChannelsUI.Preview.showConnectors(e,!0)))},Preview:{bindEvents:function(e,t,i){e===Channels.CREATED||e===Channels.PENDING||e===Channels.EDIT_VISIBILITY?(i&&t.find("#editchannel").on("click",function(){ChannelsUI.createEditWin(Channels.getObject($(this).attr("channelid")))}),t.on("click","[purpose]",function(e){var t=$(this),i=t.attr("purpose");ChannelsUI.doOperation(i,t.attr("channelid"),t.attr("chid"),e)})):e===Channels.ARCHIVED&&t.on("click","[purpose]",function(e){var t=$(this),i=t.attr("purpose");ChannelsUI.doOperation(i,t.attr("channelid"),t.attr("chid"),e)})},inviteusersuggest:{search:function(e){var t=$("#preview-usersuggest-results");t.html('<div id="preview-usersuggest-list"  class="drpdwn srchglt"></div>');var i=SearchField.getSelectedList("preview-usersuggest-search-field"),a=Channels.getObject(t.attr("channelid"));"undefined"!=typeof a.joineduserids&&(i=i.concat(a.joineduserids)),Participants.get(a.chid)&&(i=i.concat(Participants.get(a.chid).recipants));var s=SearchAgent.search({searchin:SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,val:e,ignorelist:i,srcid:"preview-usersuggest-search-field",destid:"preview-usersuggest-results",listid:"preview-usersuggest-list",debugsource:"InviteToChannelSuggestion",ignoreparticipants:!0,chid:a.chid,clearcallback:function(){ChannelsUI.Preview.inviteusersuggest.displayNoResultFound(e)}});return s&&this.displayResultDOM(t),s},handleAction:function(e,t,i){if(i){var a=SearchField.getNodeforSelection({uid:t.attr("uid"),type:t.attr("elemtype"),name:t.attr("data-val")},!0);SearchField.insertNodeinField("preview-usersuggest",void 0,a),Clickoutside.handleClickOnChild(e,t)}},clear:function(){$("#preview-usersuggest-results").hide().find("#preview-usersuggest-list").empty(),Clickoutside.clear("preview-usersuggest-results")},displayResultDOM:function(e){e.find("[purpose='search']").first().addClass("srchbn sel");var t="block"===e.css("display");t||Clickoutside.bind({srcid:"preview-usersuggest-search-field",destid:"preview-usersuggest-results"}),ZCScroll.customScroll(e.find("#preview-usersuggest-list"),!0),ZCScroll.scrollTop($("#preview-usersuggest-results"),0)},displayNoResultFound:function(e){this.clear(),SearchField.checkAndAddEmailInAutocomplete("preview-usersuggest",e),Clickoutside.bind({srcid:"preview-usersuggest-search-field",destid:"preview-usersuggest-results"})}},construct:function(e,t){var i=Channels.getObject(t),a=this.getPreviewHtml(i,i.joined||Channels.isPending(t)||i.cr==$zcg._ZUID),s=this.getPreviewHeaderHtml(i),n="";parseInt(i.st)===Channels.PENDING?(s=Resource.getRealValue(Channels.isMyPendingChannel(i)?"channel.mypending.header":"contact.waiting.for.approve"),n="chlpendcon"):s+='<span class="zcpredot mrgLR5"></span><div id="channelpermalink" chid="'+Channels.getObject(t).chid+'" class="msi-link-line dIB chlpermlink cur" purpose="copypermalink">'+Resource.getRealValue("channel.permalink")+"</div>";var r=ChannelsUI.addHtmlToRHS({id:"channelpreview",classname:"zchannel "+n,headerid:"prevchname"+t,header:s,nav:!0,body:a});r.attr("currchannelprev",t),!i.appid||Channels.isFromSandBox(i)?r.find("#channelmessagebody").removeClass("zchapprecentcht"):r.find("#channelmessagebody").addClass("zchapprecentcht"),Channels.isSharedScope(Channels.getLevel(i))&&this.addinvthtml(i,r),this.doChangesAfterVisible(i,r),this.bindEvents(e,r,this.haseditPermission(t))},haseditPermission:function(e){var t=Channels.getObject(e);return haseditPermission=parseInt(t.st)!=Channels.ARCHIVED&&ChannelsPermission.hasPermission(Channels.ACTIONS.EDIT,t),haseditPermission=haseditPermission&!Channels.isCrossProductChannel(t)&&(!t.appid||Channels.isFromSandBox(t))},getPreviewHtml:function(e,t){var i=this.haseditPermission(e.oc_id),a=parseInt(e.st)==Channels.PENDING?Template.PreviewPendingChannel:Template.PreviewCreatedChannel,s=$WC.$CUtil.isEmpty(e.cd)?"":$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(e.cd));return a=a.replace(/{ACTIONS}/g,parseInt(e.st)===Channels.PENDING?this.getActionsHtml(e):"").replace(/{TEAMNAME}/g,this.getTeamNameHtml(e)).replace(/{CREATORHTML}/g,Resource.getRealValue("group.created.by")+this.getCreatorHtml(e)).replace(/{EDITHTML}/g,this.getEditHtml(e,i&&t)).replace(/{CREATORNAME}/g,$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(Users.getName(e.cr,e.cr_n)))).replace(/{CREATORUID}/g,e.cr).replace(/{CHANNELIMG}/g,ChannelsUI.getImage(e.oc_id)).replace(/{CHANNELNAME}/g,$WC.$CUtil.processXSS(Channels.getDisplayNameForChannel(e))).replace(/{CREATEDTIME}/g,$Date.relative(e.ctime)).replace(/{DESC}/g,$Util.trim(s)).replace(/{CHANNELID}/g,e.oc_id).replace(/{CHATID}/g,e.chid)},getTeamNameHtml:function(e){var t="";if(Channels.getLevel(e)===Channels.OrgGroup){var i=Groups.getGroupNames(e.scid,e.scid_name);t="&nbsp;"+Resource.getRealValue("channel.created.for")+'&nbsp;<span class="clr5 bold">'+$WC.$CUtil.processXSS(i)+"</span>"}return t},getEditHtml:function(e,t){return t?'<span class="zcpredot"></span><span id="editchannel" channelid="{CHANNELID}" class="hvrinfo">'+Resource.getRealValue("common.edit")+"</span>":""},getCreatorHtml:function(e){var t="";if(e.appid){if(e.appdetails){var i=$WC.$CUtil.processXSS(e.appdetails.name);e.appdetails.issandbox&&(i+=" ("+Resource.getRealValue("app.sandbox")+")"),t='&nbsp;<span class="zcretname bold">'+$WC.Matcher.replace("escapeReplacementString",i)+"</span> "+Resource.getRealValue("app.app")}}else t='&nbsp;<span uid="{CREATORUID}" elemtype="user" hover="true" class="zcretname bold hvrinfo">{CREATORNAME}</span>';return t},getPreviewHeaderHtml:function(e){var t=$WC.$CUtil.processXSS(Channels.getDisplayNameForChannel(e));return t},addinvthtml:function(e,t){if(Channels.isCreated(e)&&Channels.isSharedScope(Channels.getLevel(e))&&ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,e)&&!Channels.isCrossProductChannel(e)){var i='<div id="preview-usersuggest" class="zcpraddcnt posl"><div class="chnlusersuggst dIB"><div id="channelinvite" class="zcadchmem"><span class="msi-grpmbradd floatl" ></span><div id="preview-usersuggest-search-field" contenteditable="true" placeholder="'+Resource.getRealValue("channel.shared.info")+'" class="crtin" placeholder="search group"></div></div><div id="preview-usersuggest-results" channelid="'+e.oc_id+'" class="zchaddd chdropdwn" style="display:none"></div></div><input id="contaddbtn" type="button" purpose="invite" channelid="'+e.oc_id+'" chid="'+e.chid+'" class="buttn_pos posa" value="Invite"></div>';t.find("#viewoption").before(i),SearchField.init("preview-usersuggest")}},doChangesAfterVisible:function(e,t){(Channels.isCreated(e)||Channels.isEditVisibility(e))&&t.find("#channelmessagebody").html("<div id='channelpreviewloading' class='zcldng'></div>"),Channels.isArchived(e)&&t.find("#"+e.oc_id).addClass("arcvdchl"),(Channels.isArchived(e)||e.currole==Channels.ROLES.ALLOWED_USER||e.currole==Channels.ROLES.NONE)&&$("#permission").remove(),(Channels.isArchived(e)||e.currole==Channels.ROLES.ALLOWED_USER||e.currole==Channels.ROLES.NONE||1!=e.joined)&&$("#connectors").remove();var i=t.find("#channelheader");i.removeAttr("contenteditable")},update:function(e,t){if(e===Channels.CREATED||e==Channels.ARCHIVED||e===Channels.EDIT_VISIBILITY){if(document.getElementById("channelpreview")){var i=$("#channelpreview #"+t.oc_id);if(0===i.length)return;i.find("#channelpreviewloading").remove();var a=t.moredetails;if("undefined"!=typeof a){var s=Channels.getObject(a.oc_id);i.attr("chid",s.chid),i.find("#channelactionholder").html(this.getActionsHtml(s)),this.addActiveParticipantsHtml(a,i)}if(this.addPreviewTranscript(s,t,i),!Channels.isArchived(s)){var n=$("#channelheader");n.attr("contenteditable","true")}}}else if(e===Channels.PENDING&&document.getElementById("channelpreview")){var i=$("#channelpreview");i.find("[purpose='reject']").remove(),t.joined?i.find("[purpose='approve']").remove():(i.find("#prevchnameO"+t.channeluid).text(Resource.getRealValue("channel.join.header",[""])),i.find("[purpose='approve']").attr("purpose","join").val(Resource.getRealValue("common.join")).attr("chid",t.chid))}},addPreviewTranscript:function(e,t,i){0===i.find("#channelmsgarea").length&&i.find("#channelmessagebody").append('<div id="channelmsgarea" class="zchlmsgarea posl" purpose="transcriptholder"></div>');var a=i.find("#channelmsgarea"),s=i.find("#channelmsgarea")[0];this.updatePreviewTranscript(e,t,a,s)},addActiveParticipantsHtml:function(e,t){var i=this.getActiveParticipantsHtml(e);$WC.$CUtil.isEmpty(i)||(t.find("#channelapholder").html(i),t.find("#channelmessagebody").addClass("zchrecentcht"),t.find("#channelinvite").length>0&&t.find("#channelmessagebody").addClass("zchrechtshr"))},updatePreviewTranscript:function(e,t,i,a){var s=t.trans,n=ChatUI.hasUnreadOrUnseenMsgs(e.chid)?ChatsList.unreadchatarr[e.chid]:"-1";if(s.length>0)MsgUtil.updateTranscript(i,MsgUtil.formatTranscript(s,{ctype:$zcg.ORGCHANNEL,chid:e.chid,unreadmarkertime:n,origin:"channelsPreview"})),ZCScroll.customScroll(a,!0),ZCScroll.getScrollDown(a),i.find("img[originalsrc]").each(function(){ChatUI.loadOriginalSource(this)});else{var r=Channels.isJoined(e)?"channel.conv.none.chat":"channel.conv.none.join";i.html('<div class="emcht-inftxt" ><span>'+Resource.getRealValue("channel.conv.none")+"</span>"+Resource.getRealValue(r)+'<em code=":smile:" title=":smile:" class="zcslymsg-smile"></em></div>')}},getActiveParticipantsHtml:function(e){var t="";if(!Channels.isArchived(e)&&e.hasOwnProperty("ap")){for(var i=e.ap,a=i.length,s=0;a>s;s++){var n=i[s],r=Resource.getRealValue("channel.tip.ap.user.msg",[Users.getName(n[0],n[1],1),n[2],Resource.getRealValue(parseInt(n[2])>1?"common.messages":"common.message")]);t+='<div title="'+r+'" class="zchactvusr"><img hover="true" elemtype="user" uid="'+n[0]+'" src="'+Users.getImgUrlById(n[0])+'" height="40" width="40" class="floatl rds4 cur"/><div class="msi-chacunt chcount"><div>'+n[2]+"</div></div></div>"}$.trim(t).length&&(t='<div title="" class="zcactit floatl">'+Resource.getRealValue("common.activeusers")+'</div><div id="channelap" class="zchlactusr dflx floatl">'+t+"</div>")}return t},getActionsHtml:function(e){var t="",i=ChannelsPermission.hasPermission(Channels.ACTIONS.CLEAR_MSG,e),a=ChannelsPermission.hasPermission(Channels.ACTIONS.DELETE,e),s=ChannelsPermission.hasPermission(Channels.ACTIONS.ARCHIVE,e),n=ChannelsPermission.hasPermission(Channels.ACTIONS.LEAVE_ALLOWED,e);if(Channels.isCreated(e)||Channels.isEditVisibility(e))Channels.isJoined(e)?(t='<div purpose="continue" chid="'+e.chid+'" class="buttn_pos adbtn dIB" chid="'+e.chid+'" >'+Resource.getRealValue("common.continue")+"</div>",t=i||a||s?'<div  id="previewoptionscont"><div class="opt_more zchmrbtn cur" purpose="showoptions"><div class="zchmreac floatr posa" type="button"></div><div id = "previewoptions" class="zcbtndd font13 textcent posa cur">'+(s?'<div  channelid="'+e.oc_id+'" purpose="archivechannel" type="button" >'+Resource.getRealValue("common.archive")+"</div>":"")+(i?'<div channelid="'+e.oc_id+'"  purpose="clearmessages" type="button">'+Resource.getRealValue("common.clear")+"</div>":"")+(a?'<div channelid="'+e.oc_id+'" purpose="delete" type="button">'+Resource.getRealValue("common.delete")+"</div>":"")+(Channels.isApproval(e)?'<div channelid="'+e.oc_id+'" purpose="approve" type="button">'+Resource.getRealValue("common.approve")+'</div><div channelid="'+e.oc_id+'" purpose="reject" type="button">'+Resource.getRealValue("common.reject")+"</div>":"")+"</div></div>"+(n?'<div  channelid="'+e.oc_id+'" purpose="leave" type="button" class="buttn_neg btn evbtn floatr posl zchbtn dIB">'+Resource.getRealValue("common.leave")+"</div>":"")+"</div>"+t:(n?'<input purpose="leave" channelid="'+e.oc_id+'" chid="'+e.chid+'" type="button" class="buttn_neg btn evbtn floatr dIB" value="'+Resource.getRealValue("common.leave")+'" >':"")+t):Channels.isApproval(e)?(t='<input purpose="approve" channelid="'+e.oc_id+'" chid="'+e.chid+'" type="button" class="buttn_pos btn adbtn" value="'+Resource.getRealValue("common.approve")+'" >',t='<input purpose="reject" channelid="'+e.oc_id+'" chid="'+e.chid+'" type="button" class="buttn_neg btn evbtn floatr " value="'+Resource.getRealValue("common.reject")+'" >'+t):(t='<div purpose="join" chid="'+e.chid+'" class="buttn_pos adbtn dIB" >'+Resource.getRealValue("common.join")+"</div>",a||s?t='<div  id="previewoptionscont" class="dIB posl floatr font13 zclin30"><div class="opt_more zchmrbtn cur" purpose="showoptions"><div class="zchmreac floatr posa" type="button"></div><div id = "previewoptions" class="zcbtndd font13 textcent posa cur">'+(s?'<div  channelid="'+e.oc_id+'" purpose="archivechannel" type="button" >'+Resource.getRealValue("common.archive")+"</div>":"")+(a?'<div channelid="'+e.oc_id+'" purpose="delete" type="button">'+Resource.getRealValue("common.delete")+"</div>":"")+"</div></div>"+(i?'<div channelid="'+e.oc_id+'"  purpose="clearmessages" type="button"  class="buttn_neg btn evbtn floatr posl zchbtn">'+Resource.getRealValue("common.clear")+"</div>":"")+"</div>"+t:i&&(t='<input purpose="clearmessages" channelid="'+e.oc_id+'" chid="'+e.chid+'" type="button" class="buttn_neg btn evbtn floatr " value="'+Resource.getRealValue("common.clear")+'" >'+t));else if(Channels.isArchived(e)){ChannelsPermission.hasPermission(Channels.ACTIONS.DELETE,e)&&(t='<input purpose="delete" channelid="'+e.oc_id+'" chid="'+e.chid+'" type="button" class="buttn_pos adbtn" value="'+Resource.getRealValue("common.delete")+'" />');var r=ChannelsPermission.hasPermission(Channels.ACTIONS.UNARCHIVE,e);r&&(t=t+'<input purpose="unarchivechannel" channelid="'+e.oc_id+'" chid="'+e.chid+'" type="button" class="buttn_neg evbtn mrgR10 floatr" value="'+Resource.getRealValue("common.unarchive")+'" />')}else parseInt(e.st)===Channels.PENDING&&(t=Channels.isMyPendingChannel(e)?'<input channelid="{CHANNELID}" purpose="cancelapprovalrequest" class="buttn_neg btn evbtn floatr posl zchbtn" type="button" value="'+Resource.getRealValue("channel.cancelapprovalrequest")+'"> <input channelid="{CHANNELID}" purpose="resendmail" class="buttn_pos adbtn btn" type="button" value="'+Resource.getRealValue("channel.resendmail")+'">':'<input channelid="{CHANNELID}" chid="" purpose="approve" class="buttn_pos adbtn btn" type="button" value="'+Resource.getRealValue("common.approve")+'"><input channelid="{CHANNELID}" purpose="reject" class="buttn_neg btn evbtn" type="button" value="'+Resource.getRealValue("common.decline")+'">');return t},showRecentConv:function(){var e=$('[purpose="recentconv"]');$("#channelpermission").hide(),$("#channelconnectors").hide(),$("#channelmessagebody").show(),e.siblings().removeClass("sel"),e.addClass("sel")},showConnectors:function(e,t){var i=Channels.getObject(e),a=$('[purpose="connectors"]');$("#channelmessagebody").hide(),$("#channelpermission").hide(),a.siblings().removeClass("sel"),a.addClass("sel");var s=$("#channelconnectors");if(0===s.children().length){var n=$WC.template.replace(Template.ChannelConnectorsHtml,{$restapi_endpoint:"channel.restapi.endpoint",$deluge_task:"channel.deluge.task",$deluge_samplemessage:"channel.deluge.samplemessage",$note:"channel.deluge.note",$user_task_note:"channel.deluge.desc",$admin_task_note:"channel.deluge.postasadmin.desc",$webhook:"channel.webhook",$edit_code:"commands.editcode",base_url:window.location.origin,unique_name:i.un,channel_id:i.oc_id});s.html(n)}s.show(),ZCScroll.customScroll(s,!0),ChannelWebhooks.fetchAndPopulate(i,t)},constructPermaLinkUI:function(e,t){ChannelsUI.destroyView();var i=$WC.$Win.create({id:"channelpermalinkwin","class":"joinchnlwin fullwin mntnoverlay",html:this.getPermaLinkHtml(Channels.getObject(e.oc_id)),aligncenter:!1,closefn:function(){window.history.pushState({},null,window.location.origin+"/index.do"),$("#zcwindows").removeClass("permadiv")}});$("#zcwindows").addClass("permadiv"),$("#loadingniceurl").remove(),this.addPreviewTranscript(e,t,i),this.bindEvents(parseInt(e.st),i)},getPermaLinkHtml:function(e){var t=Template.ChannelPermaLinkUI,i=$WC.$CUtil.isEmpty(e.cd)?"":$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(e.cd));return t=t.replace(/{CHANNELNAME}/g,$WC.$CUtil.processXSS(Channels.getDisplayNameForChannel(e))).replace(/{CHANNELTYPE}/g,Channels.isExternalChannel(e)&&!Channels.isBelongstomyOrg(e)?Resource.getRealValue("channel.of")+" "+e.appdn:Resource.getRealValue(ChannelsUI.iconinfo[Channels.getLevel(e)])).replace(/{CHANNEL_NAME_FOOTER}/g,Channels.isJoined(e)?'<div class="channelnamefooter" > '+Resource.getRealValue("channel.permalink.name.footer")+" </div>":"").replace(/{PARTICIPANTCOUNT}/g,e.pc).replace(/{PARTICIPANTTEXTBASEDONCOUNT}/g,Resource.getRealValue(e.pc>1?"common.participants":"common.participant")).replace(/{CHANNELIMG}/g,ChannelsUI.getImage(e.oc_id,e.sc,void 0,!0)).replace(/{CHANNELDESC}/g,$WC.$CUtil.isEmpty(i)?Resource.getRealValue("channel.no.description"):i).replace(/{CREATORHTML}/g,this.getCreatorHtml(e)).replace(/{CREATORNAME}/g,$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(Users.getName(e.cr,e.cr_n)))).replace(/{CREATORUID}/g,e.cr).replace(/{TEAMNAME}/g,this.getTeamNameHtml(e)).replace(/{CHANNELSCOPE}/g,Channels.getLevel(e)).replace(/{CREATEDTIME}/g,$Date.relative(e.ctime)).replace(/{CHANNEL_LAST_ACTIVE}/g,$Date.relative(e.lmtime)).replace(/{CHATID}/g,e.chid).replace(/{CHANNELID}/g,e.oc_id).replace(/{GOTOCLIQLINK}/g,Channels.isJoined(e)?"":'<span id="winclose" class="floatr cliqlink cur">'+Resource.getRealValue("common.gotocliq")+"</span>").replace(/{BUTTON_PURPOSE}/g,Channels.isJoined(e)?"continue":"join").replace(/{BUTTON_TEXT}/g,Resource.getRealValue(Channels.isJoined(e)?"common.continue":"channel.join"))}},handleReject:function(e){{var t=Channels.getObject(e),i='<textarea id="rejectchannelreason" class="tatext chrejt" placeholder="'+Resource.getRealValue("common.enter.comments")+'"></textarea><div category="charcount" limit="300" class="zcchlcount chrejcnt zchdc">300</div>';$WC.$Dlg.create({id:"rejectchannel",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-red"></div>',header:Resource.getRealValue("channel.rejectdlg.header",[$WC.$CUtil.processXSS(t.cn)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[i]}),buttons:[{text:Resource.getRealValue("common.decline.ok"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){var t=this.find("#rejectchannelreason").val();t.length>300||Channels.reject(e,t)}}]})}$("#rejectchannelreason").focus(),$("#rejectchannel").find("#rejectchannelreason").on("keyup",function(){$Dom.limitInput(this)})},doOperation:function(e,t,i,a){if("preview"===e)ChannelsUI.triggerPreview(t);else if("resendmail"===e)Channels.resendmail(t);else if("cancelapprovalrequest"===e)Channels.cancelapprovalrequest(t);else if("approve"===e)Channels.approve(t);else if("reject"===e)this.handleReject(t);else if("showoptions"===e){var s=$("#previewoptions"),n=$("#previewoptionscont");"hidden"===s.css("visibility")||"none"===s.css("display")?(n.addClass("zcbtnddani"),n.show(),Clickoutside.bind({srcid:"previewoptionscont",destid:"previewoptions",event:a})):(Clickoutside.clear("previewoptions"),n.removeClass("zcbtnddani"))}else if("delete"===e)Channels.delete(t);else if("continue"===e)ChannelsUI.getChat(i);else if("join"===e)if("undefined"!=typeof a&&$Util.Button.addLoadIcon($(a.currentTarget)),$WC.$CUtil.isEmpty(t))Channels.join(i,!0);else{var r=Channels.getObject(t);Channels.join(r.chid,!0)}else if("leave"===e)if($WC.$CUtil.isEmpty(t))Channels.leave(i);else{var r=Channels.getObject(t);Channels.leave(r.chid)}else if("clearmessages"===e)Channels.clearMessages(t);else if("invite"===e){if(!SearchField.hasNodes("preview-usersuggest-search-field")){var o=$("#channelinvite");return o.addClass("error"),void setTimeout(function(){o.removeClass("error")},2e3)}var l=SearchField.getMultiTypeSelectedList("preview-usersuggest-search-field");Channels.invite(i,l.contact,l.emailids),SearchField.clear("preview-usersuggest"),SearchField.clearSearchField("preview-usersuggest")}else if("archivechannel"===e)Channels.archive(t);else if("unarchivechannel"===e)Channels.unarchive(t);else if("recentconv"===e)ChannelsUI.Preview.showRecentConv();else if("permission"===e)ChannelsPermissionUI.showPermissions(t);else if("connectors"===e)ChannelsUI.Preview.showConnectors(t);else if("copypermalink"===e)ChannelsUI.handleCopyPermaLink(i,$("#channelpreview"),!0);else if("view_webhook_code"===e)ChannelWebhooks.viewCode(t);else if("create_webhook"===e)ChannelWebhooks.create(t);else if("delete_webhook"===e)ChannelWebhooks.deleteHook(t,ChannelWebhooks.HANDLERS.OUTGOING);else if("enable_webhook"===e)ChannelWebhooks.enable(t,ChannelWebhooks.HANDLERS.OUTGOING);else{var s=$("#previewoptions"),n=$("#previewoptionscont");("hidden"!=s.css("visibility")||"none"!=s.css("display"))&&n.removeClass("zcbtnddani")}},destroyView:function(){$WC.$Win.destroy("channelslistview"),$WC.$Win.destroy("channelpreview"),$WC.$Win.destroy("createchannelwin"),$WC.$Win.destroy("channelpermalinkwin"),$WC.$Win.destroy("editchannelwin")},getImage:function(e,t,i,a,s){if(e){var n=Channels.getObject(e);if(!$.isEmptyObject(n)){var r=Channels.getLevel(n);return i=$WC.$CUtil.isEmpty(i)?50:i,this.getImageByPhotoId(n.photoid,r,i,a,s)}}return t?'<div title="'+Resource.getRealValue(ChannelsUI.iconinfo[t])+'" class="msi-sc'+t+'"></div>':void 0},getImageByPhotoId:function(e,t,i,a,s){if("undefined"!=typeof e){var n,r="undefined"!=typeof s?"/channel/"+e+"/photo.do?fs="+s:"/channel/"+e+"/photo.do";return"undefined"!=typeof a?n='<img width="'+i+'px;" height="'+i+'px;" src="'+r+'"/>':(n='<img width="'+i+'px;" height="'+i+'px;" src="'+r+'"/>',n+='<div title="'+Resource.getRealValue(ChannelsUI.iconinfo[t])+'" class="zchlistsc"><div class="msi-sc'+t+' sci"></div></div>'),n}return'<div title="'+Resource.getRealValue(ChannelsUI.iconinfo[t])+'" class="msi-sc'+t+' padd8 msci"></div>'},getImageByChid:function(e){var t=Channels.getByChid(e);return $.isEmptyObject(t)?"":this.getImage(t.oc_id)},getHTML:function(e,t,i,a,s){var n=s?Channels.getDisplayNameForChannel(e):e.cn,r=n;if(a){var o=r.toLowerCase().indexOf(i),l=new RegExp($WC.Matcher.replace("escaperegexp",i),"i");-1!==o&&(r=r.replace(l,"<b>$&</b>"))}r=$WC.Matcher.replace("escapeReplacementString",r),t=t.replace(/{CHANNELID}/g,e.oc_id).replace(/{CNAME}/g,r).replace(/{CHID}/g,e.chid).replace(/{ID}/g,e.oc_id).replace(/{IMGHTML}/g,ChannelsUI.getImage(e.oc_id,e.sc,24)).replace(/{IMG}/g,ChannelsUI.getImage(e.oc_id,e.sc,24,!0)).replace(/{CDESCRIPTION}/g,$WC.$CUtil.isEmpty(e.cd)?Resource.getRealValue("channel.no.description"):$WC.Matcher.replace("escapeReplacementString",e.cd)).replace(/{ICON_CLASS}/,"msi-sc"+e.sc).replace(/{PCTITLE}/,e.pc&&e.pc>1?Resource.getRealValue("chat.participants.count",[e.pc]):Resource.getRealValue("channel.tip.joinedparticip",[e.pc?e.pc:0])).replace(/{PC}/,e.pc).replace(/{TITLEVAL}/,Resource.getRealValue(ChannelsUI.iconinfo[e.sc]));var c=n;return a&&(c=c.replace(new RegExp($WC.Matcher.replace("escaperegexp",i),"i"),"<b>$&</b>")),t.replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",c))},removeFromUI:function(e){var t=Channels.getByChid(e);LeftPannel.LHSList.removeFromAllCategories(e);var i=$("#channelslist");removed=i.find("#tab"+t.oc_id).remove();var a=$("#channelslist").has('[elemType="channel"]'),s=i.html(),n=$(channelslist).has("#channelsmore");return 0===n.length&&(s=s+'<div id="channelsmore" class="zcuserstatus zcmorechl" catagory="channels" workfor="channel" elemtype="more"><span class="showmore">'+Resource.getRealValue("common.showall")+"</span></div>",i.html(s)),0===a.length&&(s='<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("channel.recent.none")+"</div>"+s,i.html(s)),i.children().length===this.uilimit&&chats.find("[elemtype='more']").remove(),removed},handleCopyPermaLink:function(e,t,i){var a=Channels.getByChid(e),s=window.location.origin+"/channels/"+a.un,n=t.find("#channelpermalink");if(i||(n.css("width",n[0].getBoundingClientRect().width+"px"),n[0].innerText=Resource.getRealValue("channel.link.copied"),n[0].style.color="#09AD79",n.removeClass("msi-link-line").addClass("msi-hissel chpl")),UI.updateBanner(Resource.getRealValue("channel.permalink.banner")),window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",s);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var r=document.createElement("textarea");r.textContent=s,document.body.appendChild(r),r.select();try{return document.execCommand("copy")}catch(o){return!1}finally{document.body.removeChild(r)}}}};Channels={Org:1,OrgGroup:2,Private:3,Shared:4,External:4,SUBHEADER_ORG_SCOPE:"Public",SUBHEADER_SHARED:"External",SUBHEADER_ORG_GROUP_SCOPE:"Group",SUBHEADER_PRIVATE:"Private",SUBHEADER_NONE:"nosubheader",SEGMENT:SecurityManager.hasPermission(Channels.OrgGroup),SameOrgUser:1,NonSameOrgUser:2,CREATED:1,EDIT_VISIBILITY:2,PENDING:-1,ARCHIVED:-2,CATAGORIZEANDSORT:1,ONLYSORT:2,ACTIONS:{EDIT:1,DELETE:2,CLEAR_MSG:3,ARCHIVE:4,UNARCHIVE:5,ADD_MEMBER:6,REMOVE_MEMBER:7,SEND_MESSAGE:8,MENTION_USERS:9,SPECIAL_MENTIONS:10,LEAVE_ALLOWED:11,PRIMETIME:12,EDIT_MY_MSG:13,EDIT_MSG_BASED_ON_ROLES:14,EDIT_MSG_BASED_ON_SUBORDINATE:15,DELETE_MY_MSG:16,DELETE_MSG_BASED_ON_ROLES:17,DELETE_MSG_BASED_ON_SUBORDINATE:18,JOIN:100,JOIN_SHARED:101,LEAVE:102,APPROVE:103,REJECT:104,CANCEL_APPROVAL:105,CHANGE_ROLE:106,CREATE:107,PREVIEW:108,CHANGE_PERMISSION:109},ROLES:{SUPER_ADMIN:0,ADMIN:1,MODERATOR:3,PARTICIPANT:4,ALLOWED_USER:5,NONE:-1},OrgGroupLimitInChannel:4,searchhtml:'<div id="channel{ID}" uid="{CHANNELID}" elemtype="channel" purpose="search"><span class="usrimgsts">{IMG}</span><span id="channelname{ID}" class="usrname ellips">{DNAMEVAL} <em>{CDESCRIPTION}</em></span></div>',SEARCHLIMIT:25,prevsearchval:"",searchagentsearchval:"",searchtimer:"",getrequesttimer:"",issearching:!1,chidmap:{},Storage:{},Approval:{},MyPending:{},NewAllowed:{},AllowedUsers:{},previoussearches:[],currentsearchcriteria:{val:null},cleanSearchCriteria:function(){this.currentsearchcriteria={val:null}},isOrgScope:function(e){return parseInt(e)==this.Org},isOrgGroupScope:function(e){return parseInt(e)==this.OrgGroup},isPrivateScope:function(e){return parseInt(e)==this.Private},isSharedScope:function(e){return parseInt(e)==this.Shared},isPublicChannel:function(e){return this.getLevel(e)==this.Org},isTeamChannel:function(e){return this.getLevel(e)==this.OrgGroup},isMultiTeamChannel:function(e){return this.isTeamChannel(e)&&!$.isEmptyObject(e.scid)&&e.scid.length>1},isPrivateChannel:function(e){return this.getLevel(e)==this.Private},isExternalChannel:function(e){return this.getLevel(e)==this.Shared},isOpenToAll:function(e){return"true"===e.open_to_all},getLevel:function(e){return parseInt(e.sc)},getCurrUserRole:function(e){return parseInt(e.currole)},isSuperAdmin:function(e){return this.getCurrUserRole(e)==this.ROLES.SUPER_ADMIN},isAdmin:function(e){return this.getCurrUserRole(e)==this.ROLES.ADMIN},isModerator:function(e){return this.getCurrUserRole(e)==this.MODERATOR},isParticipant:function(e){return this.getCurrUserRole(e)==this.PARTICIPANT},isSameOrgGroupChannel:function(e,t){return $WC.$CUtil.isEmpty(e)||$.isEmptyObject(e)||$WC.$CUtil.isEmpty(t)||$.isEmptyObject(t)?!1:1==e.scid.length&&1==t.scid.length&&e.scid[0]==t.scid[0]},getDisplayNameForChannel:function(e,t,i){return $WC.$CUtil.isEmpty(e)||$.isEmptyObject(e)?void 0:t&&i?this.getNameWithoutHash(e.cn):t?e.cn:e.dn},getsubheaderInfo:function(e){var t=this.getSubHeaderId(e);if(t==Channels.SUBHEADER_NONE){var i={subheaderId:t,subheaderName:t,subheaderType:t};return i}if(t==Channels.SUBHEADER_SHARED){var i={subheaderId:t,subheaderLevel:Channels.Shared,subheaderName:t,subheaderType:t,subheadertitle:Resource.getRealValue("integration.scope4")};return i}if(t==Channels.SUBHEADER_PRIVATE){var i={subheaderId:t,subheaderLevel:Channels.Private,subheaderName:t,subheaderType:t,subheadertitle:Resource.getRealValue("integration.scope3")};return i}if(t==Channels.SUBHEADER_ORG_SCOPE){var i={subheaderId:t,subheaderLevel:Channels.Org,subheaderName:t,subheaderType:t,subheadertitle:Resource.getRealValue("integration.scope1")};return i}var a=e.scid_name[t],i={subheaderId:t,subheaderLevel:Channels.OrgGroup,subheaderName:"@"+a,subheaderType:Channels.SUBHEADER_ORG_GROUP_SCOPE,subheadertitle:"@"+a};return i},getSubHeaderId:function(e){if(!Channels.SEGMENT)return Channels.SUBHEADER_NONE;var t=this.getLevel(e);if(t==Channels.Shared)return Channels.SUBHEADER_SHARED;if(t==Channels.Private)return Channels.SUBHEADER_PRIVATE;if(t==Channels.Org)return Channels.SUBHEADER_ORG_SCOPE;if(t==Channels.OrgGroup){for(var i=e.scid,a=e.my_groupids,s=0;s<i.length;s++)if(!$.isEmptyObject(a)&&a.indexOf(i[s])>=0)return i[s];return e.scid[0]}},checkAndGetObject:function(e){return"string"==typeof e?this.getObject(e):e instanceof $CliqChatId?this.getByChid(e.chid):e},getNameWithoutHash:function(e){return 0==e.indexOf("#")?e.substring(1):e},isExist:function(e){return this.Storage.hasOwnProperty(e)},isCrossProductChannel:function(e){var t=this.checkAndGetObject(e);return!$WC.$CUtil.isEmpty(t)&&!$WC.$CUtil.isEmpty(t.service)},isSharedChannelbelongstomyOrg:function(e){var t=this.checkAndGetObject(e);return!$.isEmptyObject(t)&&t.channelorgid===_getAppAccountId()},isBelongstomyOrg:function(e){var t=this.checkAndGetObject(e);return $.isEmptyObject(t)||parseInt(t.sc)!==Channels.Shared?!0:this.isSharedChannelbelongstomyOrg(t)},isBelongstoTeam:function(e,t){for(var i=e.scid,a=0;a<i.length;a++)if(!$.isEmptyObject(t)&&""+i[a]==""+t)return!0;return!1},isJoined:function(e){if(e){var t=this.checkAndGetObject(e);return t&&"undefined"!==t.joined&&1===parseInt(t.joined)}},isCreated:function(e){return"undefined"!=typeof e?parseInt(e.st)===Channels.CREATED:!1},isPending:function(e){var t=this.checkAndGetObject(e);return"undefined"!=typeof t?parseInt(t.st)===Channels.PENDING:!1},isArchived:function(e){var t=this.checkAndGetObject(e);return"undefined"!=typeof t?parseInt(t.st)===Channels.ARCHIVED:!1},isPinned:function(e){var t=this.checkAndGetObject(e);return"undefined"!=typeof t?t.pinned:!1},isMuted:function(e){var t=this.checkAndGetObject(e);return"undefined"!=typeof t?"-1"!==t.muted_interval:!1},getObject:function(e){var t=this.Storage;return"undefined"!=typeof t[e]?$Util.cloneObject(t[e],!0):"undefined"!=typeof this.Approval[e]?this.getApproval(e):"undefined"!=typeof this.MyPending[e]?this.getMyPending(e):void 0},getChannelId:function(e){return this.getByChid(e).oc_id},getByChid:function(e){return $Util.cloneObject(Channels.Storage[Channels.chidmap[e]],!0)},getAll:function(){return $Util.cloneObject(this.Storage,!0)},getImgUrlByChid:function(e,t){return this.getImgUrl(new $CliqChatId(e),void 0,t)},getImgUrl:function(e,t,i){var a,e=e?Channels.checkAndGetObject(e):void 0;if("undefined"!=typeof e&&!$.isEmptyObject(e)){var t=Channels.getLevel(e);a="undefined"!=typeof e.photoid?"undefined"!=typeof i?$zcg._SERVERURL+"/channel/"+e.photoid+"/photo.do?fs="+i:$zcg._SERVERURL+"/channel/"+e.photoid+"/photo.do":$Util.getImgStaticUrl()+("/channel_icon_"+t+".png")}return t&&$WC.$CUtil.isEmpty(a)&&(a=$Util.getImgStaticUrl()+("/channel_icon_"+t+".png")),a},getAppChannelIds:function(e){var t=this.getAll(),i=[];for(var a in t)t[a].appid==e&&1==t[a].st&&i.push(a);return i},validateChannelScope:function(e,t,i){return $WC.$CUtil.isEmpty(t)?!0:t===Channels.Org?Channels.getLevel(e)===Channels.Org:t===Channels.OrgGroup&&Channels.getLevel(e)===Channels.OrgGroup&&Channels.isBelongstoTeam(e,i)?!0:t===Channels.Private||t===Channels.Shared?t===Channels.getLevel(e):!1},seperateJoinedAndAllowedChannels:function(e,t,i,a,s){var n=[],r=[],o=[];t=t?t:Channels.getAll();for(var l=0;l<e.length;l++){var c=i?e[l][i]:e[l];if(t[c]){var d=t[c];d.st!=Channels.CREATED&&d.st!=Channels.ARCHIVED||!this.validateChannelScope(d,a,s)||(Channels.isJoined(d)?n.push(e[l]):r.push(e[l]))}}return o.joined=n,o.allowed=r,o},getJoinedFromLocalStorage:function(e,t){var t=t?t:Channels.getAll(),i=Object.keys(t),a=this.seperateJoinedAndAllowedChannels(i,t).joined;return e&&(e.lmtime?a=this.sortChannelsByLMTime(a,t):e.lmsgtime&&(a=this.sortChannelsByLMsgTime(a,t))),a},seperateCreatedAndArchivedChannels:function(e){for(var t=[],i=[],a=[],s=0;s<e.length;s++){var n=e[s],r=Channels.getObject(n);r.st==Channels.CREATED?t.push(n):r.st==Channels.ARCHIVED&&i.push(n)}return a.created=t,a.archived=i,a},getRemainingJoinedChannels:function(){var e=this.getJoinedFromLocalStorage(),t=$("#channelslist").find('[elemType="channel"]'),i=$("#pinnedchatslist").children(),a=this.seperateCreatedAndArchivedChannels(e);e=a.created;for(var s=0;s<t.length;s++){var n=t[s].getAttribute("uid");if(null!==n){var r=e.indexOf(n);e.splice(r,1)}}for(var s=0;s<i.length;s++){var o=i[s].getAttribute("elemtype");if("channel"===o){var r=e.indexOf(this.getChannelId(i[s].getAttribute("chid")));e.splice(r,1)}}return e},getAllowedFromLocalStorage:function(e,t,i){var a=Channels.getAll(),s=Object.keys(a),n=this.seperateJoinedAndAllowedChannels(s,a,void 0,t,i).allowed;return e&&(n=this.sortChannelsByLMTime(n,a)),n},sortChannelsByLMsgTime:function(e,t){var i=[];t=t?t:Channels.getAll();for(var a=0;a<e.length;a++){var s=t[e[a]];if(!$WC.$CUtil.isEmpty(s)){var n=[];n.push(e[a]),n.push(Channels.getLastMsgTimeForChannel(s)),i.push(n)}}i=$Util.sort(i,1,!0);for(var r=[],o=0;o<i.length;o++)r.push(i[o][0]);return r},sortChannelsByLMTime:function(e,t){var i=[];t=t?t:Channels.getAll();for(var a=0;a<e.length;a++){var s=t[e[a]];if(!$WC.$CUtil.isEmpty(s)){var n=[];n.push(e[a]),n.push(parseInt(s.lmtime)),i.push(n)}}i=$Util.sort(i,1,!0);for(var r=[],o=0;o<i.length;o++)r.push(i[o][0]);return r},getApproval:function(e){return e?$Util.cloneObject(this.Approval[e],!0):$Util.cloneObject(this.Approval,!0)},getMyPending:function(e){return e?$Util.cloneObject(this.MyPending[e],!0):$Util.cloneObject(this.MyPending,!0)},hasChannels:function(){var e=Channels.getAll();return Object.keys(e).length>0},isMyPendingChannel:function(e){return(Channels.isPending(e.oc_id)||Channels.isEditVisibility(e))&&WmsImpl.isLocalUser(e.cr)},isEditVisibility:function(e){return parseInt(e.st)===this.EDIT_VISIBILITY},isApproval:function(e){return"undefined"!=typeof Channels.Approval[e.oc_id]},hasNewAllowedChannel:function(){return Object.keys(this.NewAllowed).length>0},isNewAllowedChannel:function(e){return this.NewAllowed[e]},removeNewAllowedChannels:function(e){-1!=parseInt(e)?delete this.NewAllowed[e]:this.NewAllowed={},ChannelsUI.List.LHS.updateNewCount()},isAppChannel:function(e){return!$WC.$CUtil.isEmpty(e.appid)},isFromIntegration:function(e){return!$.isEmptyObject(e)&&!$WC.$CUtil.isEmpty(e.appid)&&e.appdetails&&!e.appdetails.issandbox},isFromSandBox:function(e){return!$.isEmptyObject(e)&&!$WC.$CUtil.isEmpty(e.appid)&&e.appdetails&&e.appdetails.issandbox},deleteApproval:function(e){delete this.Approval[e],ChannelsUI.handleApproval(e,!1)},handleApproval:function(e){this.updateData({approval:[e]}),ChannelsUI.handleApproval(e.oc_id,!0)},handleAdminRejected:function(e){ChannelsUI.destroyView(),Channels.deleteApproval(e.oc_id),ChannelsUI.List.removeApproval(e.oc_id),"undefined"!=typeof Channels.Storage[e.oc_id]?Channels.Storage[e.oc_id].st="1":""},handleAdminApproved:function(e){Channels.deleteApproval(e.oc_id),Channels.updateData({allowed:[e]}),ChannelsUI.List.removeApproval(e.oc_id),Channels.isExternalChannel(e)?ChannelsUI.destroyView():ChannelsUI.Preview.update(Channels.PENDING,e),Channels.hasAnyAdvancedRules(e)&&(ChannelsUI.List.remove(e.oc_id),Channels.handleDelete(e.oc_id))},handleMyChannelsApproved:function(e){Channels.updateData({joined:[e]}),ChannelsUI.List.LHS.add(e.chid,e,!1),ChannelsUI.List.remove(e.oc_id)},handleNotifyCreate:function(e){Channels.updateData({joined:[e]}),ChannelsUI.List.LHS.add(e.chid,e,!1),ChannelsUI.List.remove(e.oc_id)},handleMyChannelsRejected:function(e){delete this.MyPending[e.oc_id]},updateLastMsgInfo:function(e,t){var i=this.chidmap[e];if(!$WC.$CUtil.isEmpty(i)&&Channels.isExist(i))if(t){var a=this.Storage[this.chidmap[e]];a.lminfo=JSON.stringify(t),a.lmtime=t.time}else delete this.Storage[this.chidmap[e]].lminfo},updateParticipantCount:function(e,t){var i=this.chidmap[e];!$WC.$CUtil.isEmpty(i)&&Channels.isExist(i)&&(this.Storage[i].pc=t)},updateChidMap:function(e,t){this.chidmap[e]=t},clearAllowedFromLocalDb:function(){for(var e=this.getAllowedFromLocalStorage(),t=0;t<e.length;t++)Channels.remove(e[t])},updateTitle:function(e,t,i,a){var s=Channels.getObject(e);if("undefined"!=typeof s){s.cn=$WC.$CUtil.decodeHTMLEntities(t),s.dn=$WC.$CUtil.decodeHTMLEntities($WC.$CUtil.isEmpty(i)?s.dn:i),s.cn="#"+Channels.getDisplayNameForChannel(s,!0,!0);var n={};parseInt(s.st)===Channels.CREATED?n={allowed:[s]}:parseInt(s.st)===Channels.PENDING&&(n=_isAppAccountAdmin()?{approval:[s]}:{mypending:[s]}),Channels.updateData(n),ChannelsUI.handleEdit(e,{name:t}),a&&ChatUI.isExist(s.chid)&&ChatUI.exist[s.chid].updateTitle(t)}},updateData:function(e,t){var i=function(e,t){if("undefined"==typeof e)return t;for(var i in t)e[i]=t[i];return e};t&&(this.Storage={},this.Approval={},this.MyPending={},this.NewAllowed={});var a=this.Storage,s={joined:[],allowed:[],newallowed:[]};for(var n in e)if("joined"===n||"allowed"===n||"newallowed"===n)for(var r=e[n],o=0,l=r.length;l>o;o++){var c=r[o];(Channels.isCreated(c)||Channels.isArchived(c)||Channels.isEditVisibility(c))&&(a[c.oc_id]=i(a[c.oc_id],c),this.Approval.hasOwnProperty(c.oc_id)&&!Channels.isEditVisibility(c)&&delete this.Approval[c.oc_id],this.MyPending.hasOwnProperty(c.oc_id)&&delete this.MyPending[c.oc_id],this.updateChidMap(c.chid,c.oc_id),"undefined"!=typeof c.joined&&1===parseInt(c.joined)?s.joined.push(c.oc_id):"newallowed"===n?s.newallowed.push(c.oc_id):s.allowed.push(c.oc_id))}if(!$.isEmptyObject(e)&&e.hasOwnProperty("approval"))for(var r=e.approval,o=0,l=r.length;l>o;o++){var c=r[o];(Channels.isPending(c)||Channels.isEditVisibility(c))&&(c.joined=0,this.Approval[c.oc_id]=i(this.Approval[c.oc_id],c))}if(!$.isEmptyObject(e)&&e.hasOwnProperty("newallowed"))for(var r=e.newallowed,o=0,l=r.length;l>o;o++){var c=r[o];parseInt(c.st)===this.CREATED&&(this.NewAllowed[c.oc_id]=i(this.NewAllowed[c.oc_id],c))}if(!$.isEmptyObject(e)&&e.hasOwnProperty("mypending"))for(var r=e.mypending,o=0,l=r.length;l>o;o++){var c=r[o];this.MyPending[c.oc_id]=i(this.MyPending[c.oc_id],c)}return s},getMentionName:function(e,t,i){var a=Channels.getObject(e),s=Channels.getByChid(t);return $.isEmptyObject(a)||(i=$.isEmptyObject(s)||Channels.isSameOrgGroupChannel(a,s)?a.cn:Channels.getDisplayNameForChannel(a)),$WC.$CUtil.processXSS(i)},getName:function(e,t){var i=this.checkAndGetObject(e);return $WC.$CUtil.processXSS($.isEmptyObject(i)?t:i.cn)},isCreator:function(e){return WmsImpl.isLocalUser(e)},isUserAllowedtoChangeRole:function(e,t,i,a,s){if($.isEmptyObject(e))return!1;if(Channels.isArchived(e))return UI.updateBanner(Resource.getRealValue("channel.action.not.allowed.for.archived"),3e3,!0),!1;var n=e.currole,r=""+a!="false";if(t!=i){if(t==Channels.ROLES.SUPER_ADMIN)return r&&n==Channels.ROLES.SUPER_ADMIN&&(Channels.isPrivateChannel(e)||Channels.isExternalChannel(e));if(t===Channels.ROLES.ADMIN)return r&&t>n&&i>n;if(t===Channels.ROLES.MODERATOR)return r&&t>n&&i>n;if(t===Channels.ROLES.PARTICIPANT)return r&&t>n&&i>n&&ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,e);if(t==Channels.ROLES.ALLOWED_USER)return n===Channels.ROLES.PARTICIPANT&&i==Channels.ROLES.PARTICIPANT?ChannelsPermission.hasPermission(Channels.ACTIONS.REMOVE_MEMBER,e):i>n&&ChannelsPermission.hasPermission(Channels.ACTIONS.REMOVE_MEMBER,e)}return s&&(role!=Channels.ROLES.SUPER_ADMIN&&role!=Channels.ROLES.ADMIN&&role!=Channels.ROLES.MODERATOR&&role!=Channels.ROLES.PARTICIPANT?UI.updateBanner(Resource.getRealValue("channel.role.not.defined"),3e3,!0):UI.updateBanner(Resource.getRealValue("operation.not.allowed"),3e3,!0)),!1},removeByChid:function(e){delete this.Storage[this.chidmap[e]]},remove:function(e){delete this.Storage[e],delete this.MyPending[e],delete this.Approval[e]},deleteAppEntities:function(e){for(var t=this.getAppChannelIds(e),i=0;i<t.length;i++)this.remove(t[i])},handleDelete:function(e,t){var i=ChannelsUI.remove(e,t);Channels.remove(e),ChannelsUI.List.LHS.updateListFromMoreJoined(i)},handleLeave:function(e){var t=ChannelsUI.remove(e,!0),i=Channels.getObject(e);return"undefined"!=typeof i&&(delete Channels.Storage[e],Channels.isSharedScope(Channels.getLevel(i))||Channels.isPrivateScope(Channels.getLevel(i))||!Channels.isOpenToAll(i))?void($zcg._ISAPPACCOUNTADMIN&&(Channels.isApproval(i)?Channels.Approval[e].joined=0:"")):void ChannelsUI.List.LHS.updateListFromMoreJoined(t)},handleSync:function(e){for(var t=0,i=e.length;i>t;t++){var a=e[t],s=Channels.getObject(a);$.isEmptyObject(s)||Channels.handleDelete(a,!0)}},handleArchive:function(e){for(var t=0,i=e.length;i>t;t++){var a=e[t],s=Channels.getObject(a);if(!$.isEmptyObject(s)){var n=ChannelsUI.remove(a,!0),r=Channels.getObject(a);"undefined"!=typeof r&&(Channels.Storage[a].st=Channels.ARCHIVED),ChannelsUI.List.LHS.updateListFromMoreJoined(n)}}},handleUnArchive:function(e){for(var t=0,i=e.length;i>t;t++){var a=e[t],s=Channels.getObject(a);if(!$.isEmptyObject(s)){var n=(ChannelsUI.remove(a,!0),Channels.getObject(a));"undefined"!=typeof n&&(Channels.Storage[a].st=Channels.CREATED),!$.isEmptyObject(s)&&Channels.isJoined(s)&&ChannelsUI.List.LHS.add(n.chid,n,!1)}}},handleRoleChange:function(e){this.handlePermissionChange(e),ParticipantsWin.updateChannelParticipantsUI(!0)},handlePermissionChange:function(e){if(!$.isEmptyObject(e)&&!$.isEmptyObject(e.oc_id)){var t=e.oc_id;channel=void 0!=Channels.Storage[t]?Channels.Storage[t]:Channels.Approval[t],channel.permissions=e.permissions,channel.currole=e.currole,e.currole==Channels.ROLES.SUPER_ADMIN?channel.curperm=e.permissions.supadminp:e.currole==Channels.ROLES.ADMIN?channel.curperm=e.permissions.adminp:e.currole==Channels.ROLES.MODERATOR?channel.curperm=e.permissions.modp:e.currole==Channels.ROLES.PARTICIPANT&&(channel.curperm=e.permissions.partp);var i=channel.chid;if(ChatUI.isExist(i)){var a=ChatUI.exist[i];ChannelsPermission.hasPermission(Channels.ACTIONS.SEND_MESSAGE,channel)||a.disableComposer(a.chid,Resource.getRealValue("channel.sendmessage.notallowed.message")),a.updateTriggers()}}},create:function(e,t,i,a,s,n,r,o){var l={};l.name=t,l.scope=e,$WC.$CUtil.isEmpty(i)||(l.description=i),$WC.$CUtil.isEmpty(a)||(l.scopeids=a),l.sid=WmsImpl.getSid();var c;$WC.$CUtil.isEmpty(r)||(c=[[r]]),$WC.$CUtil.isEmpty(o)||(l.open_to_all=1===parseInt(o)),s.length>0&&(l.userids=s.join(",")),n.length>0&&(l.emailids=n.join(",")),1!=Settings.getFromObj("do_channel_action")&&(l.onboardingstepkey="do_channel_action",CheckList.markAsCompleted("do_channel_action"));var d=ChannelsAdvRulesUI.getAdvRules();!$WC.$CUtil.isEmptyObject(d)&&Channels.isOrgScope(e)&&(l.advanced_rules=JSON.stringify(d)),l=ChannelsPermission.setPermissions(l);var u=ChannelsAdvRulesUI.getReportingToValue();"undefined"!=typeof u&&(l.reporting_to_me=u);var m=$ZCAjx.formData(l,"cphoto",c,!0);$ZCAjx.ajax({url:"/v1/channels",type:"POST",processData:!1,contentType:!1,data:m,status:{loading:"common.loading"},success:function(e){$Util.Button.removeLoadAndAddTickMark($("#createchannel")),ChannelsUI.destroyView();var i=e.data.CHANNEL;if(parseInt(i.st)===Channels.CREATED){Channels.updateData({joined:[i]});var a=e.data.CHAT;a.createfrom="chat",ChatUI.create(a),ChannelsUI.List.LHS.update(i.chid),Channels.handlejoin(i.chid,!0),ChatUI.isExist(i.chid)&&ChatUI.getWin(i.chid).addChatInformation(),UI.updateBanner(Resource.getRealValue("channel.create.success",[t]),5e3)}else Channels.updateData({mypending:[i]}),UI.updateBanner(Resource.getRealValue("channel.approvemsg",[t]),5e3)},error:function(){$Util.Button.removeLoadAndAddHtml($("#createchannel"),Resource.getRealValue("common.create"))},paramdesc:{name:"channel.name",desc:"channel.desc"}})},get:function(e,t,i,a,s){var n={0:"all",1:"joined",2:"allowed",3:"approval",4:"mypending",5:"latest"},r={};"object"==typeof e&&(r=e),$WC.$CUtil.isEmpty(t)||(r.mode=n[t]),$WC.$CUtil.isEmpty(a)||(r.search=a),WmsImpl.getSid()||(r.sid=WmsImpl.getSid()),$ZCAjx.ajax({url:"/getchannels.do",data:r,success:function(t){if(t.hasOwnProperty("data")){var a=Channels.updateData(t.data,!$WC.$CUtil.isEmpty(e.pageload)&&e.pageload);i(a,t.meta)}},error:function(){"function"==typeof s&&s(a,"","channels")}})},handlejoin:function(e,t){$WC.$CUtil.isEmpty(e)||(Channels.isArchived(new $CliqChatId(e))&&UI.updateBanner(Resource.getRealValue("channel.action.not.allowed.for.archived"),3e3,!0),t?Chat.attachSession(e,t):Chat.makejoinchatrequest(e,$zcg.ORGCHANNEL,!1,!0,!0))},handleJoinChannelSuccess:function(e,t,i){$Util.Button.removeLoadAndAddTickMark($("#channelpreview").find('[purpose="join"]')),ChatUI.isChannel(t.ctype)&&(Channels.updateData({joined:[e]}),ChannelsUI.handleCreateChatWindow(t,i),Channels.isNewAllowedChannel(e.oc_id)&&(HomeUI.markComponentAsSeen(e.oc_id,2),Channels.removeNewAllowedChannels(e.oc_id)))},join:function(e,t){if(!$WC.$CUtil.isEmpty(e)){var i=Channels.getByChid(e);if(!$.isEmptyObject(i)&&this.isJoined(i))return void this.handlejoin(e,t);var a={chid:e,sid:WmsImpl.getSid(),attach:t?!0:!1};1!=Settings.getFromObj("do_channel_action")&&(a.onboardingstepkey="do_channel_action",CheckList.markAsCompleted("do_channel_action")),$ZCAjx.ajax({url:"/joinchannel.do",type:"POST",data:a,success:function(e){Channels.handleJoinChannelSuccess(e.CHANNEL,e.CHAT,t)},error:function(t){$Util.Button.removeLoadAndAddHtml($("#channelpreview").find('[purpose="join"]'),Resource.getRealValue("common.join"));var i=Channels.getByChid(e);$.isEmptyObject(i)||Channels.handleErrorCode(i.oc_id,t.ERRCODE,Channels.ACTIONS.JOIN)}})}},leave:function(e){var t=this.getByChid(e),i=function(t){$ZCAjx.ajax({url:"/v1/channels/"+t.oc_id+"/leave",type:"POST",success:function(e){e.data.deleted&&($WC.$CUtil.isEmpty(e.data.oc_id)||(Channels.handleLeave(e.data.oc_id),Channels.sync(t)))},error:function(t){var i=Channels.getByChid(e);$.isEmptyObject(i)||Channels.handleErrorCode(i.oc_id,t.error_code)}})},a=parseInt(t.sc),s=[Resource.getRealValue("channel.leave.info1")];a===Channels.Private?s.push(Resource.getRealValue("channel.leave.info2.private")):a===Channels.Shared&&s.push(Resource.getRealValue("channel.leave.info2.external")),s.push(Resource.getRealValue("chat.leave.info2")),$WC.$Dlg.create({id:"leavechannel",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-exit clr-red"></div>',header:Resource.getRealValue("channel.leave.header",[$WC.$CUtil.processXSS(t.cn)]),subheader:Resource.getRealValue("channel.leave.subheader")}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:s}),buttons:[{text:Resource.getRealValue("chat.leave.yes"),colour:$WC.$Dlg.RED_BUTTON,action:function(){i(t)}},{text:Resource.getRealValue("chat.leave.mute"),colour:$WC.$Dlg.GREY_BUTTON,action:function(){Chat.muteChat(e,!0,-1)}}]})},sync:function(e){$.isEmptyObject(e)||$ZCAjx.ajax({url:"/syncparticipants.do",type:"POST",data:{chid:e.chid,scopeids:e.scid.join(",")}})},changeRoles:function(e,t,i,a){var s,n=this.getObject(e);s=a?{role:i,members:t}:{role:i,admins:t},$ZCAjx.ajax({url:"/v1/channels/"+n.oc_id+"/changeroles",type:"POST",data:s,success:function(){UI.updateBanner(Resource.getRealValue("channel.rolechange.updated"),3e3)}})},approve:function(e){$ZCAjx.ajax({url:"/v1/channels/"+e+"/approve",type:"POST",success:function(e){Channels.handleAdminApproved(e.data),UI.updateBanner(Resource.getRealValue("channel.approved",[e.data.cn]),3e3,!1)},error:function(t){Channels.handleErrorCode(e,t.error_code)}})},resendmail:function(e){$ZCAjx.ajax({url:"/resendmail.do",type:"POST",data:{id:e},success:function(){UI.updateBanner(Resource.getRealValue("channel.resendmail.success"),2e3,!1)},error:function(){UI.updateBanner(Resource.getRealValue("channel.resendmail.error"),2e3,!1)}})},cancelapprovalrequest:function(e){$ZCAjx.ajax({url:"/cancelapprovalrequest.do",type:"POST",data:{id:e},success:function(e){UI.updateBanner(Resource.getRealValue("channel.cancelapprovalrequest.success"),2e3,!1),$WC.$Win.destroy("channelpreview"),delete Channels.MyPending[e.id],ChannelsUI.List.remove(e.id)},error:function(t){var i=Channels.getObject(e);$.isEmptyObject(i)||Channels.handleErrorCode(i.oc_id,t.ERRCODE)}})},edit:function(e,t,i,a,s,n){var r={};$WC.$CUtil.isEmpty(t)||(r.name=t),"string"==typeof i&&(r.description=i),"undefined"!=typeof s&&(r.open_to_all=s);var o;$WC.$CUtil.isEmpty(a)||(o=[[a]]),$WC.$CUtil.isEmpty(n)||(r.gids=n);var l=$ZCAjx.formData(r,"cphoto",o,!0);$ZCAjx.ajax({url:"/v1/channels/"+e,type:"PUT",data:l,processData:!1,contentType:!1,status:{loading:"common.loading"},success:function(t){Channels.handleEdit(e,t.data,!0)},error:function(t){var i={name:null,description:null,photoid:null};ChannelsUI.handleEdit(e,i);var a=Channels.getObject(e);$.isEmptyObject(a)||Channels.handleErrorCode(a.oc_id,t.ERRCODE)}})},handleEdit:function(e,t,i){var a=$WC.$CUtil.isEmpty(Channels.Storage[e])?$WC.$CUtil.isEmpty(Channels.Approval[e])?Channels.MyPending[e]:Channels.Approval[e]:Channels.Storage[e];"undefined"!=typeof t.name&&(a.cn=t.name,WmsBarImpl.updateChannelName(a.chid,t.name)),"undefined"!=typeof t.dn&&(a.dn=t.dn),"undefined"!=typeof t.description&&(a.cd=t.description),"undefined"!=typeof t.photoid&&(a.photoid=t.photoid),"undefined"!=typeof t.open_to_all&&(a.open_to_all=t.open_to_all),"undefined"!=typeof t.status&&(a.st=t.status),"undefined"!=typeof t.scid&&(a.scid=t.scid,a.scid_name=t.scid_name),"undefined"!=typeof t.my_groupids&&(a.my_groupids=t.my_groupids);var s={};parseInt(a.st)===Channels.CREATED?s={allowed:[a]}:parseInt(a.st)===Channels.PENDING&&(s=_isAppAccountAdmin()?{approval:[a]}:{mypending:[a]}),Channels.updateData(s),ChannelsUI.handleEdit(e,t,i),Channels.isEditVisibility(a)?i?UI.updateBanner(Resource.getRealValue("channel.approvemsg.accesschange",[a.cn]),5e3,!1):"":i?UI.updateBanner(Resource.getRealValue("channel.edit.success"),2e3,!1):""},reject:function(e,t){var i={};t.length>0&&(i.reason=t),$ZCAjx.ajax({url:"/v1/channels/"+e+"/reject",type:"POST",data:i,success:function(e){Channels.handleAdminRejected(e.data),UI.updateBanner(Resource.getRealValue("channel.rejected",[e.data.cn]),3e3,!1)},error:function(t){Channels.handleErrorCode(e,t.error_code)}})},handleChannelPermaLink:function(e,t){({sid:WmsImpl.getSid(),attach:!1});$ZCAjx.ajax({url:"/v1/channelsbyname/"+e,data:{tzoffset:$zcg._TZOFFSET,getrecentconv:!0},success:function(e){if(t)return void Channels.handlePreviewSuccessResponse(e.data.oc_id,e,!0,void 0,!0);$("#loadingniceurl").find('[class="pgloader"]').addClass("loaded");var i=e;setTimeout(function(){var e=i.data,t={};t.trans=JSON.parse("["+e.re_conv.substring(0,e.re_conv.length-1)+"]"),delete e.re_conv,t.moredetails=e;var a=e,s="undefined"!==a.joined&&1===parseInt(a.joined)?{joined:[a]}:{allowed:[a]};Channels.updateData(s),ChannelsUI.Preview.constructPermaLinkUI(a,t),Channels.isNewAllowedChannel(a.oc_id)&&(HomeUI.markComponentAsSeen(a.oc_id,2),Channels.removeNewAllowedChannels(a.oc_id))},300)},error:function(){$("#loadingniceurl").remove(),window.history.pushState({},null,window.location.origin+"/index.do"),$("body").removeClass("chnlpermalink")}})},handlePreviewSuccessResponse:function(e,t,i,a,s){if(t=t.data,s){if("undefined"==typeof t)return;Channels.updateData({allowed:[t]}),ChannelsUI.Preview.construct(parseInt(Channels.getObject(e).st),e)}var n={};n.trans=JSON.parse("["+t.re_conv.substring(0,t.re_conv.length-1)+"]"),delete t.re_conv,n.moredetails=t;var r=$("#channelpreview").attr("currchannelprev");(i||r==e)&&(Channels.handlePermissionChange(n.moredetails),n.oc_id=e,ChannelsUI.Preview.update(parseInt(n.moredetails.st),n)),"function"==typeof a&&a(n),Channels.isNewAllowedChannel(e)&&(HomeUI.markComponentAsSeen(e,2),Channels.removeNewAllowedChannels(e))},preview:function(e,t,i,a){$ZCAjx.ajax({url:"/v1/channels/"+e,data:{tzoffset:$zcg._TZOFFSET,getrecentconv:!0},success:function(s){Channels.handlePreviewSuccessResponse(e,s,t,i,a)},error:function(t){setTimeout(function(){ChannelsUI.destroyView()},2e3),Channels.handleErrorCode(e,t.error_code)}})},invite:function(e,t,i,a){var s=[];a=a||{},!$WC.$CUtil.isEmpty(t)&&t.length>0&&(s=s.concat(t)),!$WC.$CUtil.isEmpty(i)&&i.length>0&&(s=s.concat(i));var n=Channels.getByChid(e),r=n.oc_id;!$WC.$CUtil.isEmpty(r)&&s.length>0&&$ZCAjx.ajax({url:"/v1/channels/"+r+"/invite",type:"POST",data:{ulist:s.join()},success:function(){ZCTrack.track("ADDMEMBER",{TYPE:"Channel",MODE:"Same Chat"}),(!ChatUI.isExist(e)||Channels.isSharedScope(Channels.getLevel(n)))&&UI.updateBanner(Resource.getRealValue("channel.invited.success"),2e3,!1),"function"==typeof a.success&&a.success();ChatUI.exist[e];delete Channels.AllowedUsers[e]},error:function(){ChatUI.isExist(e)||UI.updateBanner(Resource.getRealValue("channel.invited.fail"),2e3,!0),"function"==typeof a.error&&a.error()}})},deleteMember:function(e,t){var i=Channels.getByChid(e).oc_id;!$WC.$CUtil.isEmpty(i)&&t.length>0&&$ZCAjx.ajax({url:"/v1/channels/"+i+"/deletemember",type:"POST",data:{ulist:t.join()}})},"delete":function(e){var t=Channels.getObject(e),i=function(e){$ZCAjx.ajax({url:"/v1/channels/"+e,type:"DELETE",success:function(e){e.data.status&&Channels.handleDelete(e.data.id,!0)}})};$WC.$Dlg.create({id:"deletechannel",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-delete clr-red"></div>',header:Resource.getRealValue("channel.delete.header",[$WC.$CUtil.processXSS(t.cn)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("channel.delete.info1"),Resource.getRealValue("channel.delete.info2"),Resource.getRealValue("channel.delete.info3")]}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){i(e)}},{text:Resource.getRealValue("channel.delete.archive"),action:function(){Channels.archive_execute(e)}}]})},archive_execute:function(e){$ZCAjx.ajax({url:"/v1/channels/"+e+"/archive",type:"POST",success:function(e){e.data.status&&Channels.handleArchive([e.data.id])}})},archive:function(e){var t=Channels.getObject(e);$WC.$Dlg.create({id:"archivechannel",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-archive clr-red f40"></div>',header:Resource.getRealValue("channel.archivedlg.header",[$WC.$CUtil.processXSS(t.cn)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("channel.archive.info1"),Resource.getRealValue("channel.archive.info2"),Resource.getRealValue("channel.archive.info3")]}),buttons:[{text:Resource.getRealValue("channel.archive.yes"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){Channels.archive_execute(e)}}]})},unarchive:function(e){var t=Channels.getObject(e),i=function(e){$ZCAjx.ajax({url:"/v1/channels/"+e+"/unarchive",type:"POST",success:function(e){e.data.status&&(Channels.handleUnArchive([e.data.id]),Channels.isJoined(t)&&Channels.handlejoin(t.chid,!0))}})};$WC.$Dlg.create({id:"unarchivechannel",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-unarchive clr-red f40"></div>',header:Resource.getRealValue("channel.unarchivedlg.header",[$WC.$CUtil.processXSS(t.cn)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("channel.unarchive.confirm")]}),buttons:[{text:Resource.getRealValue("channel.unarchive.yes"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){i(e)}}]})},clearMessages:function(e){var t=Channels.getObject(e),i=function(e){$ZCAjx.ajax({url:"/v1/channels/"+e+"/clearmessages",type:"POST",success:function(){ChatUI.removeWindow(t.chid),ChannelsUI.destroyView(),Channels.updateLastMsgInfo(t.chid),Channels.join(t.chid,!0)}})};$WC.$Dlg.confirm({id:"clearchannelmessages",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("channel.clearmsgdlg.info1"),Resource.getRealValue("info.history.delete.info2")]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-history clr-red"></div>',header:Resource.getRealValue("channel.clearmsgdlg.header",[$WC.$CUtil.processXSS(t.cn)])}),buttons:[{text:Resource.getRealValue("channel.clearmessages.yes"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){i(e)}}]})},handleSearch:function(e,t){var i,a=t.which,e=$.trim(e).toLowerCase(),s=$("#channelslistview"),n=s.find("#chnlist"),r=n.attr("scope");$WC.$CUtil.isEmpty(r)||(i=$.extend({},{hidelevel:!0,scope:parseInt(n.attr("scope")),teamid:n.attr("shId"),teamname:n.attr("shname")},i));var o=function(){$("#channelslistsearch").val(""),Channels.issearching=!1,Channels.prevsearchval="",null!=ChannelsUI.List.fragment&&(s.find("#channelrowslist").html(ChannelsUI.List.fragment.children()),ZCScroll.scrollTop($("#channelrowslist"),0),ChannelsUI.List.fragment=null)};if(ChannelsUI.List.issearching||38!==a&&40!==a||DropdownUtil.handleListNavigation(t,s.find("#channelrowslist"),"[purpose='view']"),0===e.length)o();else if(27===a)e.length>0&&t.stopPropagation(),o();else if(this.prevsearchval!==e&&e.length>0){null===ChannelsUI.List.fragment&&(ChannelsUI.List.fragment=$("<div>"),ChannelsUI.List.fragment.html($("#channelrowslist").children())),clearTimeout(this.searchtimer),Channels.prevsearchval=e,this.issearching=!0;var l=this.getSearchResultsFromLocalDB({val:e,ignorelist:[],category:ChannelsUI.List.RETRIVE_ALL}),c=l.searchresults;if(c.length>0){for(var d=[],u=0;u<c.length;u++)d.push(c[u][1]);d=Channels.sortChannelsByLMTime(d);var m=$.extend({},{repopulate:!0,searchvalue:e},i);ChannelsUI.List.view(d,m),ZCScroll.scrollTop($("#channelrowslist"),0)}else{if(!SecurityManager.hasPermission(Modules.Channels))return void ChannelsUI.List.view([],{repopulate:!0,searchvalue:e});ChannelsUI.List.showLoading(!0)}this.searchtimer=setTimeout(function(){var t={limit:Channels.SEARCHLIMIT};ChannelsUI.List.addScopeCriteria(t),Channels.get(t,ChannelsUI.List.RETRIVE_ALL,function(t,a){if(Channels.prevsearchval===a.searchedvalue){var s=Channels.getSearchResultsFromLocalDB({val:e,ignorelist:[],category:ChannelsUI.List.RETRIVE_ALL}),n=s.searchresults,r=$.extend({},{repopulate:!0,searchvalue:e},i);if(n.length>0){for(var o=[],l=0;l<n.length;l++)o.push(n[l][1]);o=Channels.sortChannelsByLMTime(o),ChannelsUI.List.view(o,r)}else ChannelsUI.List.view([],r)}},e)},500)}},getJoinedChannels:function(e){for(var e=e?e:Channels.getAll(),t=Channels.sortChannelsByLMsgTime(Channels.getJoinedFromLocalStorage(void 0,e),e),i={},a=0;a<t.length;a++)i[t[a]]=e[t[a]];return i},getSearchResultsFromLocalDB:function(e,t){var t=t?t:this.getAll(),i=e.isjoinedonly?this.getJoinedChannels(t):t,a=[],s=[],n=[];for(var r in i){var o=i[r];if(!(-1!==e.ignorelist.indexOf(r)||o.chid&&-1!==e.ignorelist.indexOf(o.chid))){var o=i[r],l=Channels.getDisplayNameForChannel(o);if(l=Channels.getNameWithoutHash(l),e.ignorespecialchar)var c=l.toLowerCase().indexOf(e.val);else var c=$Util.searchWithSpecialChars(l,e.val);0===c?s.push([l,r,o.lmtime]):("*"===e.val||-1!==c)&&n.push([l,r,o.lmtime])}}var a=$Util.getObjBasedonCriteria({startswithobj:$Util.sort(s,2,!0),containsobj:$Util.sort(n,2,!0),limit:e.limit,startswithsearch:e.startswithsearch,containssearch:e.containssearch});if("*"===e.val){var d=i.length<e.limit;return{makerequest:d,searchresults:a}}return a.length<e.limit&&!e.isjoinedonly?{makerequest:!0,searchresults:a}:{makerequest:!1,searchresults:a}},getSearchResults:function(e){if(!WmsImpl.isOrgUser())return{content:"",searchedlist:[],furtherreq:!1};var t=e.val.toLowerCase();e.val="undefined"!=typeof e.val?e.val.toLowerCase():"*",e.highlight="undefined"!=typeof e.highlight?e.highlight:!0,e.ignorelist="undefined"!=typeof e.ignorelist?e.ignorelist:[],e.htmlstr="undefined"!=typeof e.channelshtml?e.channelshtml:Channels.searchhtml,e.limit="undefined"!=typeof e.limit?e.limit:Channels.SEARCHLIMIT,e.sortorder="undefined"!=typeof e.sortorder?e.sortorder:1,e.category="undefined"!=typeof e.category?e.category:ChannelsUI.List.RETRIVE_ALL;var i=[],a=Channels.getAll(),s=this.getSearchResultsFromLocalDB(e,a);i=s.searchresults;for(var n=[],r=0;r<i.length;r++)n.push(i[r][1]);this.currentsearchcriteria.val;this.currentsearchcriteria=$.extend({},e),this.currentsearchcriteria.val=this.currentsearchcriteria.val.toLowerCase();var o=s.searchresults.length;if(o>=this.currentsearchcriteria.limit||SearchAgent.isPreviouslySearched(this.previoussearches,this.currentsearchcriteria.val)||this.currentsearchcriteria.containssearch)return this.cleanSearchCriteria(),s.makerequest=!1,Channels.processResultsBasedOnCriteria(e,i,s.makerequest,a);clearTimeout(this.getrequesttimer),s.makerequest&&(this.searchagentsearchval=t,this.getrequesttimer=setTimeout(function(){var i={limit:e.limit,totime:(new Date).getTime()};ChannelsUI.List.addScopeCriteria(i),Channels.get(i,ChannelsUI.List.RETRIVE_ALLOWED,function(i,a){if(Channels.searchagentsearchval===a.searchedvalue){var s=Channels.currentsearchcriteria.val;$Util.updateArrayWithLimit(Channels.previoussearches,s,50);for(var r=$Util.removeDuplicateEntries(i.joined.concat(i.allowed,n)),o=[],l=Channels.getAll(),c=0;c<r.length;c++){var d=l[r[c]],u=Channels.getDisplayNameForChannel(d);o.push([u,d.oc_id])}var m=Channels.processResultsBasedOnCriteria(e,o,!0,l),p=$.trim(m.content);$WC.$CUtil.isEmpty(p)?"function"==typeof e.emptycallback&&e.emptycallback(e.val,e.listid,e.populateid,"",t):"function"==typeof e.successcallback&&e.successcallback(p,e.listid,e.populateid,"",t)}},t,e.emptycallback)},300));var l=Channels.processResultsBasedOnCriteria(e,i,s.makerequest);return e.ignorelist=e.ignorelist.concat(n),l},filterBasedOnCategory:function(e,t,i){for(var a=[],s=0;s<t.length;s++){var n=t[s][1],r=i[n];e.category!==ChannelsUI.List.RETRIVE_JOINED?e.category!==ChannelsUI.List.RETRIVE_ORG?e.category!==ChannelsUI.List.RETRIVE_ORG_GROUP?e.category!==ChannelsUI.List.RETRIVE_PRIVATE?e.category!==ChannelsUI.List.RETRIVE_SHARED?r.st!=this.CREATED||e.category===ChannelsUI.List.RETRIVE_ALLOWED&&Channels.isJoined(n)||a.push(t[s]):parseInt(r.sc)===Channels.Shared&&a.push(t[s]):parseInt(r.sc)===Channels.Private&&a.push(t[s]):parseInt(r.sc)===Channels.OrgGroup&&(Channels.isJoined(n)||Channels.isOpenToAll(r))&&($WC.$CUtil.isEmpty(e.scid)?a.push(t[s]):1===e.scid.length?(1==r.scid.length&&e.scid[0]===r.scid[0]||-1!==r.scid.indexOf(e.scid[0]))&&(t[s]=[r.cn,n],a.push(t[s])):e.scid.length>1&&$.merge(e.scid,r.scid).length<r.scid.length+e.scid.length&&a.push(t[s])):parseInt(r.sc)===Channels.Org&&Channels.isOpenToAll(r)&&!Channels.hasAnyAdvancedRules(r)&&a.push(t[s]):Channels.isJoined(r)&&a.push(t[s])}return a},filterSearchForIgnoreHtmlCriteria:function(e,t,i,a){if(e.category){var s=[];t=this.filterBasedOnCategory(e,t,a);for(var n=0;n<t.length;n++){{t[n][1]}t[n][2]=Channels.getNameWithoutHash(t[n][0]),s.push(t[n])}t=this.sortBasedOnCriteria(s,Channels.CATAGORIZEANDSORT,e.val,void 0,a)}var r=[];for(var n in t)r.push(t[n][1]);return r},processResultsBasedOnCriteria:function(e,t,i,a){var s=[],n=[],r=[],a=a?a:Channels.getAll();if(e.ignorehtml)return searchedChannelIds=this.filterSearchForIgnoreHtmlCriteria(e,t,i,a),{content:searchedChannelIds};t=this.filterBasedOnCategory(e,t,a);for(var o=0;o<t.length;o++)if(!(e.ignorelist.length&&e.ignorelist.indexOf(t[o][1])>-1)){var l=Channels.getNameWithoutHash(t[o][0]);if(e.ignorespecialchar)var c=l.toLowerCase().indexOf(e.val);else var c=$Util.searchWithSpecialChars(l,e.val);{t[o][1]}t[o][2]=Channels.getNameWithoutHash(t[o][0]),0===c?s.push(t[o]):n.push(t[o])}r=$Util.getObjBasedonCriteria({startswithobj:s,containsobj:n,limit:e.limit,startswithsearch:e.startswithsearch,containssearch:e.containssearch}),"*"!==e.val&&(r=this.sortBasedOnCriteria(r,e.sortorder,e.val,e.separationheaders,a));var d=[],u=[],m="",p=r.length;p=e.limit&&p>=e.limit?e.limit:r.length;for(var o=0;p>o;o++){var h=r[o][1];if(Channels.isExist(h)){var g=a[h],f=1!=g.scid.length||e.scid!=g.scid[0];d.push(h),u.push(g.chid),m+=ChannelsUI.getHTML(g,e.htmlstr,e.val,e.highlight,f)}else if(e.separationheaders){var v="undefined"!=typeof e.separationheaders[h]?e.separationheaders[h]:"";m+=v}}return{content:m,searchedlist:d,searchedchids:u,furtherreq:i}},sortBasedOnCriteria:function(e,t,i,a,s){if(t===Channels.CATAGORIZEANDSORT){var n=[],r=this.seperateJoinedAndAllowedChannels(e,s,1);r.joined.length&&("undefined"!=typeof a&&"undefined"!=typeof a.joined&&n.push(["joined","joined"]),n=n.concat($Util.sortByPriority(r.joined,2,i,!0))),r.allowed.length&&("undefined"!=typeof a&&"undefined"!=typeof a.allowed&&n.push(["allowed","allowed"]),n=n.concat($Util.sortByPriority(r.allowed,2,i,!0)))}else t===Channels.ONLYSORT&&(n=$Util.sortByPriority(e,0,i,!0));return n},getMutedChannels:function(){var e={};return $.each(Channels.getAll(),function(t,i){!Channels.isPinned(i)&&Channels.isMuted(i)&&(e[i.chid]=Channels.getChatObjFormat(i))}),e},getPinnedChannels:function(){var e={};return $.each(Channels.getAll(),function(t,i){1==i.pinned&&(e[i.chid]=Channels.getChatObjFormat(i))}),e},getChatObjFormat:function(e){var t={};return t.recipants=e.recipants||[],t.lastmsginfo=ChatsList.parseLastMsgInfo(e.chid,e.lminfo),t.addinfo=Chat.parseAddinfo(e.addinfo),t.title=$WC.$CUtil.processXSS(e.cn),t.pcount=parseInt(e.pc),t.isrecent=!0,t.ctype=$zcg.ORGCHANNEL,t.oc_id=e.oc_id,t.level=e.sc,t.ispinned=1==e.pinned,t.ismuted="-1"===e.muted_interval,t},markUnmarkPinnedChannel:function(e,t){var i=Channels.getByChid(e);$ZCAjx.ajax({url:"/markchannelaspinned.do",type:"POST",data:{pin:t,channelid:i.oc_id},success:function(i){var a=i.status,s=i.purpose;"true"===a?(LeftPannel.LHSList.removeFromAllCategories(e,t?"pinnedchats":ChatUI.isMuted(e)?"mutedchats":"chats"),Channels.pinUnpinChannel(e,t)):UI.updateBanner(Resource.getRealValue("pin"===s?"chat.mark.pin.error":"chat.mark.unpin.error"),2e3,!0)}})},pinUnpinChannel:function(e,t){var i=Channels.getByChid(e),a=$("#channelslist"),s=a.find("#tab"+i.oc_id).length;ChannelsUI.List.LHS.remove(e),Channels.Storage[Channels.chidmap[e]].pinned=t?1:0,t?LeftPannel.LHSList.addNewInUI("pinnedchats",[e]):ChannelsUI.List.LHS.add(e,i,!1),ChannelsUI.List.LHS.updateListFromMoreJoined(s),ChatUI.isExist(e)&&(ChatUI.exist[e].updateAdditionalOptionsUI(),ChatsList.updateMsgCount(e,ChatUI.exist[e].unreadmsgcount)),ChatsList.handlePinForHeaderCount(e),ChatsList.updateUnreadNotifier()},handleErrorCode:function(e,t,i){if(!$WC.$CUtil.isEmpty(e)){var a=Channels.getObject(e);if(!$.isEmptyObject(a))switch(parseInt(t)){case $EC.CHANNEL_NOT_MEMBER:Channels.handleLeave(e);break;case $EC.CHANNEL_NOT_EXIST:Channels.handleDelete(e,!0);break;case $EC.GROUP_DOESNOT_CONTAIN_MEMBER:Channels.handleDelete(e,!0);break;case $EC.OPERATION_NOT_ALLOWED:$WC.$CUtil.isEmpty(i)||i!=Channels.ACTIONS.JOIN?"":Channels.handleDelete(e,!0);break;case $EC.CHANNEL_ALREADY_APPROVED:Channels.deleteApproval(e);break;case $EC.CHANNEL_ALREADY_REJECTED:Channels.deleteApproval(e);break;case $EC.CHANNEL_SEND_MESSAGE_NOT_ALLOWED:if(!$WC.$CUtil.isEmpty(i)&&i==Channels.ACTIONS.SEND_MESSAGE&&ChatUI.isExist(a.chid)){var s=ChatUI.exist[a.chid];s.disableComposer(s.chid,Resource.getRealValue("channel.sendmessage.notallowed.message"))}break;case $EC.CHANNEL_COUNT_PLANLIMIT_REACHED:Channels.deleteApproval(e)}}},getLastMsgTimeForChannel:function(e){var t=-1;if("undefined"==typeof e||$.isEmptyObject(e))return t;var i=e.lminfo;return"undefined"!=typeof i&&(i=ChatsList.parseLastMsgInfo(e.chid,e.lminfo),i.time&&(t=parseInt(i.time))),t},islockNeeded:function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)?!1:!this.isOpenToAll(t)&&(Channels.isPublicChannel(t)||Channels.isTeamChannel(t))},getAllowedUsers:function(e,t){var i=Channels.checkAndGetObject(e);$ZCAjx.ajax({url:"/v1/channels/"+i.oc_id+"/allowedusers",success:function(e){Channels.AllowedUsers[i.chid]=e.data.allowedusers,t(e.data.allowedusers)},error:function(){t([])}})},removeAllowedChannels:function(e){e.open_to_all||"undefined"!=typeof Channels.Approval[e.oc_id]||Channels.remove(e.oc_id),ChannelsUI.updateChannelList()},hasAnyAdvancedRules:function(e){var t=Channels.checkAndGetObject(e);return!$.isEmptyObject(t)&&!$WC.$CUtil.isEmpty(t.role_vs_rules)},isExistingGrp:function(e,t){var i=Channels.getObject(e);if(Channels.getLevel(i)==Channels.OrgGroup){var a=i.scid;return-1!=a.indexOf(t)}return!1},isAllowedUser:function(e,t){function i(e,t,i){var a=!1;if(void 0!=i){for(var s=i,n=0;n<s.length;n++)if(parseInt(s[n].zuid)===parseInt(t)){a=!0;break}}else a=void 0;return a}var a=Participants.get(e).recipants,s=Channels.getByChid(e),n=!$WC.$CUtil.isEmpty(a)&&a.length>0,r=!1;return n?a.indexOf(t)<0&&ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,s)&&(r=Channels.hasAnyAdvancedRules(s)?i(e,t,Channels.AllowedUsers[e]):Channels.isTeamChannel(s)?Groups.isUserGrpMember(t,s.scid):Channels.isPrivateChannel(s)||Channels.isPublicChannel(s)?Users.isUserExist(t)?Users.isSameOrg(t):void 0:!0):r=void 0,r}};var ChannelsAdvRulesUI={},ChannelsAdvRules={},ChannelsAdvRulesUI={checkAndAddRules:function(){ChannelsAdvRules.getAdvancedRules(function(e){var t=$("#createchannelwin").find('[purpose="addadvancerules"]');t.on("click",function(t){ChannelsAdvRulesUI.addRulesandPermission(t,e),t.stopImmediatePropagation()})})},addRulesandPermission:function(e,t){Clickoutside.handleClickOnChild(e);var i=$("#createchannelwin"),a=i.find("#chnadvrules");if(a.length)a.slideToggle("slow",function(){$(this).addClass("chlovrly")});else{i.append(Template.ChannelAdvanceRules),i.find("#chnadvrules").hide().slideToggle("1000",function(){$(this).addClass("chlovrly")});var s=i.find("#advrulescontainer");ChannelsPermissionUI.showPermissions(),ZCScroll.customScroll(s,!0)}ChannelsAdvRulesUI.checkandShowTabs(t),this.bindEvents(i)},checkandShowTabs:function(e){var t=$("#createchannelwin"),i=t.find("[name='channelscope']:checked").val();Channels.isOrgScope(i)&&!$WC.$CUtil.isEmptyObject(e)?$("#advcriteria").show():($("#advcriteria").hide(),$("#advrules").hide()),ChannelsAdvRulesUI.handleAdvRulesheaderChange($("#advpermission"))},bindEvents:function(e){e.find("[purpose]").on("click",function(e){var t=$(this);ChannelsAdvRulesUI["handle"+t.attr("purpose")](t,e),e.stopImmediatePropagation()}),ChannelsPermissionUI.bindEvents()},handleAdvRulesheaderChange:function(e){e.parent().find(".sel").removeClass("sel"),e.addClass("sel");var t=$("#createchannelwin"),i=t.find("#advrulescontainer");if(i.children().hide(),"preference"===e.attr("data-header")){var a=i.find("#advrules"),s=$WC.template.replace(Template.ParticipantsPreference,{$radiobutton:$Dom.radio.construct("matchcriteria",this.getCriteriaMatchRadioButton([{id:"matchany",val:"channel.matchany"},{id:"matchall",val:"channel.matchall"}]))});t.find("#saveadvrules").attr("disabled","disabled")}else if("permission"===e.attr("data-header"))var a=i.find("#editperms");a.children().length?a.show():a.append(s).show(),ChannelsAdvRulesUI.bindEvents(a)},handleAddCriteria:function(e){e=e.parent();{var t=$("#advrulescontainer");t.find('[data-purpose="row"]')}ChannelsAdvRulesUI.addDrpdwnContainer(e),e.prev().hide().slideDown("100",function(){ZCScroll.getScrollDown(t[0])}),ChannelsAdvRulesUI.handleMatchCriteria(e),ChannelsAdvRulesUI.checkAndHideAddElem(),ChannelsAdvRulesUI.bindEvents($("#advrulescontainer").find('[data-purpose="row"]'))},checkAndHideAddElem:function(){var e=$("#advrulescontainer");return $WC.$CUtil.isEmptyObject(ChannelsAdvRulesUI.getRulesObj())?void e.find("#addchlcri").hide():void e.find("#addchlcri").show()},addDrpdwnContainer:function(e,t){var i=Channels.ADVANCED_RULES;t=t||Object.keys(i)[0];for(var a=["quesdrpdwn","comparator","rsltdrpdwn"],s=$('<div id="criteriarow" data-purpose="row" class="dflxcent chl-adrul"><em class="msi-minus cur" purpose="RemoveCriteria"></em></div>'),n=0;n<a.length;n++){var r=ChannelsAdvRulesUI.getInitialKey(t,a[n],i),o=$('<div id="drpdwncon" data-purpose="'+a[n]+'" class="dIB zcdrpdwn cur" val="'+r+'">');o.dropdown({type:"dropdown",selected:r,data:ChannelsAdvRulesUI.getDrpDwnOptions(a[n],t),searchinoptions:!0,clickcallback:ChannelsAdvRulesUI.handleSelectOptions}),s.append(o)}e.before(s)},handleSelectOptions:function(e){var t=this._elem;t.find(".sel_status").removeClass("sel_status"),t.find('[data-list="'+e.key+'"]').addClass("sel_status"),t.attr("val",e.key);var i=t.parent();"quesdrpdwn"===t.attr("data-purpose")&&(ChannelsAdvRulesUI.addDrpdwnContainer(i,e.key),ChannelsAdvRulesUI.bindEvents($("#advrulescontainer").find('[data-purpose="row"]')),i.remove())},handleRemoveCriteria:function(e){e.parent().slideUp("100",function(){$(this).remove(),ChannelsAdvRulesUI.handleMatchCriteria(e),ChannelsAdvRulesUI.checkAndHideAddElem()})},handleCheckBox:function(e,t){var i=e.parent().find("input[type='checkbox']")[0];i.checked=!i.checked,t.stopImmediatePropagation()},handleMatchCriteria:function(){var e=$("#chnadvrules"),t=e.find('[data-purpose="row"]'),i=e.find("#matchcriteria"),a=e.find("#reportngtme").removeAttr("disabled"),s=e.find('[data-purpose="reporting_to_me"]').removeAttr("disabled"),n=e.find("#saveadvrules").removeAttr("disabled"),r=e.find("#selectallcheckbox").removeClass("msi-dsble").addClass("msi-chkbxsel"),o=e.find("#addchlcri");o.removeAttr("nocriteria"),1===t.length?(i.show(),i.find('[type="radio"]').attr("disabled","true")):t.length>1?i.find('[type="radio"]').removeAttr("disabled"):(a.attr("disabled",""),s.attr("disabled",""),r.addClass("msi-dsble").removeClass("msi-chkbxsel"),o.attr("nocriteria",!0),i.hide(),n.get(0).disabled=!0)},handleClose:function(){$("#chnadvrules").removeClass("chlovrly").slideToggle()},getRulesObj:function(){var e=ChannelsAdvRulesUI.getIgnoredkeys(),t=$Util.cloneObject(Channels.ADVANCED_RULES,!0);for(var i in e){for(var a=e[i],s=0;s<a.length;s++)delete t[i].options[a[s]];$WC.$CUtil.isEmptyObject(t[i].options)&&delete t[i]}return t},getIgnoredkeys:function(){var e=ChannelsAdvRulesUI.getAdvRules()[5];if(!e)return{};for(var e=e.rules,t=e.length,i={},a=0;t>a;a++){var s=e[a];"undefined"==typeof i[s.label_id]?i[s.label_id]=[s.option_id]:i[s.label_id].push(s.option_id)}return i},getInitialKey:function(e,t,i){var a=ChannelsAdvRulesUI.getDrpDwnOptions(t,e,i);return a.hasOwnProperty(e)?e:Object.keys(a)[0]},getDrpDwnOptions:function(e,t,i){var i=i||Channels.ADVANCED_RULES;return"quesdrpdwn"===e?ChannelsAdvRulesUI.getIdVsDisplayNameObj(i):"comparator"===e?ChannelsAdvRulesUI.getComparatorObj(Channels.ADVANCED_RULES[t].type):i[t]?i[t].options:{}},getIdVsDisplayNameObj:function(e){var t=e||Channels.ADVANCED_RULES,i={};for(var a in t)i[a]=t[a].display_name;return i},getComparatorObj:function(e){var t={};switch(e){case"picklist":t={1:Resource.getRealValue("common.is"),2:Resource.getRealValue("common.is.not")};break;case"lookup":t={3:Resource.getRealValue("common.is.equal.to"),4:Resource.getRealValue("common.is.not.equal.to")}}return t},getOptionIdVsDisplayName:function(e){var t=Channels.ADVANCED_RULES[e];return $WC.$CUtil.isEmptyObject(t)?void 0:t.options},getAdvRules:function(){for(var e=$("#advrulescontainer"),t=e.find('[data-purpose="row"]'),i=[],a=0;a<t.length;a++){var s=$(t[a]),n=s.find('[data-purpose="quesdrpdwn"]'),r=s.find('[data-purpose="comparator"]'),o=s.find('[data-purpose="rsltdrpdwn"]'),l={label_id:n.attr("val"),comparator:r.attr("val"),option_id:o.attr("val")};i.push(l)}var c={};return i.length&&(c={5:{rules:i,matchall:1===parseInt(e.find("[name='matchcriteria']:checked").val())}}),c},getReportingToValue:function(){var e=$("#advrulescontainer"),t=e.find("[data-purpose='reporting_to_me']")[0];return e.length&&void 0!=t?t.checked:void 0},getCriteriaMatchRadioButton:function(e){return radiobuttonsarr=[{id:e[0].id,value:0,label:Resource.getRealValue(""+e[0].val),checked:!0},{id:e[1].id,value:1,label:Resource.getRealValue(""+e[1].val),checked:!1}]}},ChannelsAdvRules={getAdvancedRules:function(e,t){var i=function(e,t){"function"==typeof e&&e(t)};if(this.getAdvRulesFromServer())return void i(e,Channels.ADVANCED_RULES);$ZCAjx.ajax({url:"/v2/integrations/people/channelrules",success:function(t){Channels.ADVANCED_RULES=t,i(e,Channels.ADVANCED_RULES)},error:function(e){i(t,e)}})},getAdvRulesFromServer:function(){return $zcg._ADVANCED_RULE_ENABLED&&Channels.ADVANCED_RULES&&!$WC.$CUtil.isEmptyObject(Channels.ADVANCED_RULES)?!0:!1}},ChannelsPermission=function(){var e=[Channels.ACTIONS.EDIT,Channels.ACTIONS.ADD_MEMBER,Channels.ACTIONS.REMOVE_MEMBER,Channels.ACTIONS.CLEAR_MSG,Channels.ACTIONS.ARCHIVE,Channels.ACTIONS.DELETE,Channels.ACTIONS.SEND_MESSAGE,Channels.ACTIONS.MENTION_USERS,Channels.ACTIONS.LEAVE_ALLOWED,Channels.ACTIONS.PRIMETIME,Channels.ACTIONS.DELETE_MY_MSG,Channels.ACTIONS.EDIT_MY_MSG];$zcg._ISSPECIALMENTION_ENABLED&&e.push(Channels.ACTIONS.SPECIAL_MENTIONS);var t=[Channels.ROLES.ADMIN,Channels.ROLES.MODERATOR,Channels.ROLES.PARTICIPANT],i=function(){for(var i,a={},s=0;s<t.length;s++){i=0;for(var n=0;n<e.length;n++)$Util.CustomCheckbox.isChecked("role_"+t[s]+"_action_"+e[n])?i|=1<<e[n]:"";i>0&&($zcg._ISSPECIALMENTION_ENABLED||(i|=1<<Channels.ACTIONS.SPECIAL_MENTIONS),a[t[s]]=i)}return a[Channels.ROLES.ADMIN]>0&&(a[Channels.ROLES.ADMIN]|=1<<Channels.ACTIONS.UNARCHIVE),a},a=function(e){var t=i();return $WC.$CUtil.isEmptyObject(t)||(e.admin_permission=t[Channels.ROLES.ADMIN],e.moderator_permission=t[Channels.ROLES.MODERATOR],e.member_permission=t[Channels.ROLES.PARTICIPANT]),e},s=function(e,t,i,a){var s=Channels.getObject(e);if(!n(s,t,i)){var r=Resource.getRealValue("channel.permissionchange.not.allowed",Resource.getRealValue("channel.action."+i),Resource.getRealValue("channel.role."+t));UI.updateBanner(r,3e3,!0)}$ZCAjx.ajax({url:"/v1/channels/"+s.oc_id+"/changepermission",type:"POST",data:{role:t,action:i,value:a},success:function(){var s=$("#channelid_"+e+"_role_"+t+"_action_"+i);$Util.CustomCheckbox.setStatus(s,a),i==Channels.ACTIONS.SEND_MESSAGE&&($Util.CustomCheckbox.setStatus($("#channelid_"+e+"_role_"+t+"_action_"+Channels.ACTIONS.MENTION_USERS),!1,null,!a),$Util.CustomCheckbox.setStatus($("#channelid_"+e+"_role_"+t+"_action_"+Channels.ACTIONS.SPECIAL_MENTIONS),!1,null,!a),$Util.CustomCheckbox.setStatus($("#channelid_"+e+"_role_"+t+"_action_"+Channels.ACTIONS.EDIT_MY_MSG),!1,null,!a),$Util.CustomCheckbox.setStatus($("#channelid_"+e+"_role_"+t+"_action_"+Channels.ACTIONS.DELETE_MY_MSG),!1,null,!a)),i==Channels.ACTIONS.MENTION_USERS&&$Util.CustomCheckbox.setStatus($("#channelid_"+e+"_role_"+t+"_action_"+Channels.ACTIONS.SPECIAL_MENTIONS),!1,null,!a),UI.updateBanner(Resource.getRealValue("channel.permissionchange.updated"),3e3)}})},n=function(e,t,i){if($zcg._PLANDETAILS.isChannelPermissonAllowed){if(Channels.isArchived(e))return!1;if(t===Channels.ROLES.SUPER_ADMIN)return!1;var a=e.currole;if(t>a&&r(e,a,i)){if(i==Channels.ACTIONS.MENTION_USERS||i==Channels.ACTIONS.SPECIAL_MENTIONS){var s=r(e,t,Channels.ACTIONS.SEND_MESSAGE),n=r(e,t,Channels.ACTIONS.MENTION_USERS);return i==Channels.ACTIONS.MENTION_USERS?s:s&&n}return!0}}return!1},r=function(e,t,i){var a=e.permissions;return t==Channels.ROLES.SUPER_ADMIN?!0:t==Channels.ROLES.ADMIN?o(a.adminp,i):t==Channels.ROLES.MODERATOR?o(a.modp,i):t==Channels.ROLES.PARTICIPANT?o(a.partp,i):void 0},o=function(e,t){var i=0!=(e&1<<t);return t==Channels.ACTIONS.MENTION_USERS&&(i=i&&0!=(e&1<<Channels.ACTIONS.SEND_MESSAGE)),t==Channels.ACTIONS.SPECIAL_MENTIONS&&(i=i&&0!=(e&1<<Channels.ACTIONS.SEND_MESSAGE)&&e&1<<Channels.ACTIONS.MENTION_USERS),i},l=function(e,t){var i=Channels.checkAndGetObject(e);if(!$.isEmptyObject(i)){var a=i.currole,s=i.permissions;if(a==Channels.ROLES.SUPER_ADMIN)return!0;if(a==Channels.ROLES.ADMIN&&0!=(s.adminp&1<<t))return!0;if(a==Channels.ROLES.MODERATOR&&0!=(s.modp&1<<t))return!0;if(1==i.joined&&0!=(s.partp&1<<t))return!0}return!1},c=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||l(t,Channels.ACTIONS.SEND_MESSAGE)||E(t)},d=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||I(MActions.ViewParticipants,Channels.getLevel(t))?$.isEmptyObject(t)||l(t,Channels.ACTIONS.MENTION_USERS)||E(t):!1},u=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||l(t,Channels.ACTIONS.SPECIAL_MENTIONS)||E(t)},m=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||I(MActions.Edit,Channels.getLevel(t))?$.isEmptyObject(t)||l(t,Channels.ACTIONS.EDIT)&&!E(t):!1},p=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||l(t,Channels.ACTIONS.CLEAR_MSG)},h=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||I(MActions.ViewParticipants,Channels.getLevel(t))?l(t,Channels.ACTIONS.ADD_MEMBER):!1},g=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||I(MActions.ViewParticipants,Channels.getLevel(t))?l(t,Channels.ACTIONS.REMOVE_MEMBER):!1},f=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||I(MActions.Delete,Channels.getLevel(t))?$.isEmptyObject(t)||l(t,Channels.ACTIONS.DELETE)&&!E(t):!1},v=function(e){var t=Channels.checkAndGetObject(e);return l(t,Channels.ACTIONS.PRIMETIME)},C=function(e){var t=Channels.checkAndGetObject(e);if(Channels.isPrivateChannel(t)||Channels.isExternalChannel(t)){if(Channels.isSuperAdmin(t)){if(Participants.isAlreadyPopulated(t.chid)){for(var i=Participants.get(t.chid),a=i.recipants,s=a.length,n=0;s>n;n++){var r=a[n];if(!WmsImpl.isLocalUser(r)&&i.role[r]==Channels.ROLES.SUPER_ADMIN)return!0}return!1}return t.leave_allowed}}else if(!Channels.isOpenToAll(t)){var a=Participants.get(t.chid).recipants,o=!$WC.$CUtil.isEmpty(a)&&a.length>0;if(o)return a.length>1&&l(e,Channels.ACTIONS.LEAVE_ALLOWED)}return l(e,Channels.ACTIONS.LEAVE_ALLOWED)},y=function(e){var t=Channels.checkAndGetObject(e);return $.isEmptyObject(t)||l(t,Channels.ACTIONS.ARCHIVE)&&!E(t)},b=function(e){var t=Channels.checkAndGetObject(e);return Channels.isSharedScope(Channels.getLevel(t))&&!S(Channels.External)?!1:Channels.isOrgGroupScope(Channels.getLevel(t))&&!S(Channels.OrgGroup)?!1:l(t,Channels.ACTIONS.UNARCHIVE)&&!Channels.isAppChannel(t)},E=function(e){return!$.isEmptyObject(e)&&!$WC.$CUtil.isEmpty(e.appid)&&e.appdetails&&!e.appdetails.issandbox},I=function(e,t){var i=T(t);return R(i,e,t)?SecurityManager.hasPermission(i,e):!1},T=function(e){switch(e){case Channels.Org:return Modules.OrgChannels;case Channels.OrgGroup:return Modules.TeamChannels;case Channels.Private:return Modules.PrivateChannels;case Channels.Shared:return Modules.ExternalChannels;default:return Modules.Channels}},S=function(e){var t=T(e);return t!=Modules.Channels?SecurityManager.hasPermission(t):SecurityManager.hasPermission(t)||S(Channels.Org)||S(Channels.OrgGroup)||S(Channels.Private)||S(Channels.Shared)},R=function(e,t,i){return t===MActions.Join&&i===Channels.Private?!1:t===MActions.Create&&i===Channels.OrgGroup?!$.isEmptyObject(Groups.getAllOrgGroups()):e==Modules.Channels?I(t,Channels.Org)||I(t,Channels.OrgGroup)||I(t,Channels.Private)||I(t,Channels.Shared):!0},A=function(e,t){var i=Channels.checkAndGetObject(t);return c(t)&&l(i,e)},M=function(e,t){var i=!0;switch(e){case Channels.ACTIONS.SEND_MESSAGE:i=c(t);break;case Channels.ACTIONS.MENTION_USERS:i=d(t);break;case Channels.ACTIONS.SPECIAL_MENTIONS:i=u(t);break;case Channels.ACTIONS.EDIT:i=m(t);break;case Channels.ACTIONS.CLEAR_MSG:i=p(t);break;case Channels.ACTIONS.ADD_MEMBER:i=h(t);break;case Channels.ACTIONS.REMOVE_MEMBER:i=g(t);break;case Channels.ACTIONS.UNARCHIVE:i=b(t);break;case Channels.ACTIONS.ARCHIVE:i=y(t);break;case Channels.ACTIONS.LEAVE_ALLOWED:i=C(t);break;case Channels.ACTIONS.DELETE:i=f(t);break;case Channels.ACTIONS.PRIMETIME:i=v(t);break;case Channels.ACTIONS.EDIT_MY_MSG:case Channels.ACTIONS.DELETE_MY_MSG:i=A(e,t);break;case MActions.Create:case MActions.Join:case MActions.ViewParticipants:i=I(e,t)}return i};return{roles:t,actions:e,setPermissions:a,changePermission:s,checkPermissionForaction:o,isUserAllowedtoChangePermission:n,isRoleHasPermissionforAction:r,hasPermission:M}}(),ChannelsPermissionUI=function(){var e={1:$zcg._ADMIN_PERMISSION,3:$zcg._MODERATOR_PERMISSION,4:$zcg._PARTICIPANT_PERMISSION},t={default_permission_checkbox:'<input id=role_{ROLENAME}_action_{ACTION}  type="checkbox" {DISABLED} class="zcunrdchkbx" role="{ROLENAME}" action="{ACTION}" >',channel_permission_checkbox:'<input id=channelid_{CHANNELID}_role_{ROLENAME}_action_{ACTION}  type="checkbox" {DISABLED} class="zcunrdchkbx" role="{ROLENAME}" action="{ACTION}" channelid={CHANNELID}>'},i=function(e){var t=$Util.CustomCheckbox.isChecked(e.currentTarget.id);$Util.CustomCheckbox.setStatus($("#"+e.currentTarget.id),!t,null,!1)},a=function(){$("input[type='checkbox']").change(function(e){var t=e.currentTarget.id;-1!=t.search("channelid")?s(e):i(e),e.stopImmediatePropagation()})},s=function(e){var t=e.target,i=t.getAttribute("channelid"),a=Number(t.getAttribute("role")),s=Number(t.getAttribute("action")),n=Channels.getObject(i);if(ChannelsPermission.isUserAllowedtoChangePermission(n,a,s)){var r=$Util.CustomCheckbox.isChecked("channelid_"+i+"_role_"+a+"_action_"+s);ChannelsPermission.changePermission(n.oc_id,a,s,!r)}else n.currole>=a?UI.updateBanner(Resource.getRealValue("channel.permission.change.notallowed.action",[Resource.getRealValue("channel.role."+a)]),3e3,!0):UI.updateBanner(Resource.getRealValue("channel.permission.change.notallowed.action",[Resource.getRealValue("channel.action."+s)]),3e3,!0);e.preventDefault(),e.stopPropagation()},n=function(e){for(var t=ChannelsPermission.actions,i=ChannelsPermission.roles,a=Channels.getObject(e)||{},s=Template.ChannelPermissionOptionHtml,n="",l="<div><span>{ACTIONNAME}</span></div>",c=0;c<t.length;c++){var d="";d+=l.replace(/{ACTIONNAME}/g,Resource.getRealValue("channel.action."+t[c]));for(var u=0;u<i.length;u++)d+=$WC.$CUtil.isEmptyObject(a)?r(i[u],t[c]):o(a,i[u],t[c]);d=d.replace(/{ACTION}/g,t[c]),n+="<div>"+d+"</div>"}return s=s.replace(/{PERMISSIONHTML}/g,n).replace(/{CHANNELID}/g,a.oc_id)},r=function(i,a){var s=ChannelsPermission.checkPermissionForaction(e[i],a);return l(t.default_permission_checkbox,i,!1,s)},o=function(e,i,a){var s=ChannelsPermission.isRoleHasPermissionforAction(e,i,a),n=!ChannelsPermission.isUserAllowedtoChangePermission(e,i,a);return l(t.channel_permission_checkbox,i,n,s)},l=function(e,t,i,a){var s=$Util.CustomCheckbox.construct("<div>{CHANNEL_PERMISSION}</div>",[{html:e,key:"{CHANNEL_PERMISSION}",checked:a,disabled:i}]);return s=s.replace(/{ROLENAME}/g,t)},c=function(e){if("undefined"!=typeof e){var t=$('[purpose="permission"]');$("#channelmessagebody").hide(),$("#channelconnectors").hide(),t.siblings().removeClass("sel"),t.addClass("sel"),$("#channelpermission").html(n(e)),$("#channelpermission").show(),ZCScroll.customScroll($("#permissioncontainer"),!0),ChannelsPermissionUI.bindEvents()}else{var i=$("#createchannelwin"),a=i.find("#advrulescontainer"),s=a.find("#editperms"),r=n();s.html(r).show(),i.find("#saveadvrules").removeAttr("disabled")}};return{showPermissions:c,bindEvents:a}}(),ChannelWebhooks;ChannelWebhooks={HANDLERS:{OUTGOING:6e3},HANDLER_NAMES:{OUTGOING:"outgoing_webhook"},HANDLER_STATUS:{LIVE:"live",DISABLED:"disabled"},fetchAndPopulate:function(e,t){SecurityManager.hasPermission(Modules.ChannelWebhooks)&&0===$("#channelwebhooks").children().length&&(Channels.isExternalChannel(e)||ChannelWebhooks.get(e.oc_id,t))},get:function(e,t){$ZCAjx.ajax({url:"/v2/channels/"+e+"/webhooks",success:function(i){ChannelWebhooks.populate(e,i,t)}})},create:function(e){$ZCAjx.ajax({url:"/v2/channels/"+e+"/webhooks",type:"POST",status:{loading:"common.loading"},success:function(t){var i={};i[ChannelWebhooks.HANDLER_NAMES.OUTGOING]=t,ChannelWebhooks.populate(e,i),ChannelWebhooks.viewCode(e)}})},deleteHook:function(e,t){$ZCAjx.ajax({url:"/v2/channels/"+e+"/webhooks/"+t,type:"DELETE",status:{loading:"common.loading"},success:function(){ChannelWebhooks.populate(e,[])}})},enable:function(e,t){$ZCAjx.ajax({url:"/v2/channels/"+e+"/webhooks/"+t+"/enable",type:"POST",status:{loading:"common.loading"},success:function(){ChannelWebhooks.get(e)}})},viewCode:function(e){var t="integrationwin";if($WC.$Win.isExist(t)){if($("#"+t).addClass("integ-lhs-hide"),$WC.$Win.getFront(t),e===$("#delugeeditorcontainer").attr("componentid"))return}else IntegrationUI.init(Integration.Modules.Channels);var i=Channels.getObject(e);DREImpl.handleEditCode({module:Integration.Modules.Channels,name:i.cn},e,this.HANDLERS.OUTGOING)},populate:function(e,t,i){var a="",s="",n="",r={$webhook:"channel.webhook",$webhook_info:"channel.webhook.note",$edit_code:"commands.editcode",$delete_code:"common.delete",$created_by:"channel.webhook.configured",$enable_text:"common.enable",$permission_hint:"channel.webhook.permission",channel_id:e};if(!$WC.$CUtil.isEmptyObject(t)&&t[this.HANDLER_NAMES.OUTGOING]){var o=t[this.HANDLER_NAMES.OUTGOING];s=""+o.creator_id,WmsImpl.isLocalUser(s)&&(a=o.status===this.HANDLER_STATUS.LIVE?'<span channelid="{{channel_id}}" purpose="view_webhook_code" class="zcclr mrgR15 cur"><em class="msi-editicn mrgR5"></em>{{edit_code}}</span>':'<span channelid="{{channel_id}}" purpose="enable_webhook" class="zcclr mrgR15 cur"><em class="msi-editicn mrgR5"></em>{{enable_text}}</span>'),n='<span class="clr8">{{created_by}} <span elemtype="user" hover="true" uid="{{creator_id}}" class="zctxthgh zcclr cur">{{creator_name}}</span> ({{status}})</span>',o.status===this.HANDLER_STATUS.LIVE?r.$status="channel.webhook.live":o.status===this.HANDLER_STATUS.DISABLED&&(r.$status="channel.webhook.disabled"),a+='<span channelid="{{channel_id}}" purpose="delete_webhook" class="zcclr cur"><em class="msi-delete mrgR5"></em>{{delete_code}}</span>',r.creator_id=s,r.creator_name=Users.getName(s,o.creator_name)}else a='<span channelid="{{channel_id}}" purpose="create_webhook" class="zcclr mrgR15 cur"><em class="msi-editicn mrgR5"></em>{{edit_code}}</span>';var l=Channels.getObject(e).currole;l!==Channels.ROLES.SUPER_ADMIN&&l!==Channels.ROLES.ADMIN&&(a="({{permission_hint}})");var c=$WC.template.replace(Template.ChannelWebhooksHtml,{add_html:a,config_html:n},"InSecureHTML");c=$WC.template.replace(c,r);var d=$("#channelwebhooks");d.html(c),i&&$Util.addHighlighterClass(d)}};var ContactsUI={},ContactsList={},BotContactsList={};ContactsList={uilimit:10,init:function(){LeftPannel.updateCallback({type:"contact",create:function(e,t){$(t).parents("[category=botcontacts]").length?BotContactsList.showAllBots.create(!0):ContactsUI.inviteContactUI.create()},action:function(e,t){t=$(t);var i=t.attr("catagory");if("contact"===i)ContactsList.reqForChat(t.attr("uid"),!1);else if("invitation"===i){var a=e.target.getAttribute("operation");null!==a?ContactsList.doOperation(a,t.attr("uid")):HoverDetails.show(t,!0)}},details:function(){return""},headeraction:function(e,t){var i=$(t).parent().attr("category");ContactsList.toggle(i),LeftPannel.toggleHeader(i)},more:function(e,t){"botcontacts"===$(t).parents("[category]").attr("category")?(ZCTrack.track("LHS_MORE_BOTS"),BotContactsList.showAllBots.create()):(ZCTrack.track("LHS_MORE_CONTACTS"),ContactsUI.showAllContacts.create())}}),BotContactsList.populateBotContacts()},getEmptyMessage:function(){return'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("contact.initial.none")+'</div><div id="topcontactslist"></div>'},html:{withphoto:'<div id="contact{USERID}" uid="{ID}" catagory="contact" elemtype="contact" class="zcuserstatus withimg"><div class="usrimgsts floatl zc-1"><img id="contactuserimg{USERID}" class="floatl rds4" style="width:25px;height:25px" src="{IMGURL}"></div><div class="floatl userdetails" elemname><span id="contactdname{USERID}" class="ellips">{DNAMEVAL}</span></div><div id="contactscode{USERID}" scode ="{SCODE}" class="{STATUSCLASS}"></div></div>',withoutphoto:'<div id="contact{USERID}" uid="{ID}" catagory="contact" elemtype="contact" class="zcuserstatus"><div class="floatl userdetails" elemname><span id="contactdname{USERID}" class="ellips">{DNAMEVAL}</span></div><div id="contactscode{USERID}" scode ="{SCODE}" class="{STATUSCLASS}"></div></div>',invitation:'<li id="contact{USERID}" catagory="invitation" elemtype="contact" upid="{ID}" uid="{ID}"><div class="msi-lsrmv mrgLR5" operation="remindmelater" title="'+Resource.getRealValue("remind.later")+'"></div><div class="msi-aprvl" operation="accept" title="'+Resource.getRealValue("common.accept")+'"></div><div class="floatl rds4"><img class="floatl rds4" style="width:35px; height:35px" src="{IMGURL}"/></div><div class="floatl zfrtname ellips" elemname >{DNAMEVAL}</div></li>',pendinginvitation:'<div id="pending{USERID}" class="contcts" elemtype="pending" uid="{ID}"><div class="contctimg"><img elemtype="user" uid="{ID}" class="floatl rds4 cur" style="width:40px; height:40px" src="{IMGURL}"/></div><div id="details" class="contctdetails mrgL10 ellips"><div elemtype="user" uid="{ID}" hover="true" class="font16 ellips lin22">{DNAMEVAL}</div><div id="additionalinfo" class="font14 clr6 ellips lin22">{ADDITIONALINFO}</div></div><div id="cntoperations" class="cntoperations dispflex"><span purpose="acceptinvite" uid="{ID}" class="pdbtn msi-ticktwo mrgL10" title="'+Resource.getRealValue("common.accept")+'"></span><span purpose="declineinvite" uid="{ID}" class="pdbtn msi-lsrmv mrgL10" title="'+Resource.getRealValue("common.decline")+'"></span></div></div>',invitees:'<div id="contact{{ID}}" uid="{{EMAILID}}" catagory="contact" elemtype="contact" class="zcuserstatus withimg"><div class="usrimgsts floatl zc-1"><img id="contactuserimg{{ID}}" class="floatl rds4" style="width:25px;height:25px" src="/officechat/images/cnt-avtr.png"></div><div class="floatl userdetails" elemname><span id="contactdname{{ID}}" class="ellips">{{EMAILID}}</span></div><div id="contactscode{{ID}}" class="{{STATUSCLASS}}"></div></div>'},populate:function(){var e="",t=!1,i=0;if(!Contacts.isEmpty()||!Users.isEmpty()||!OrgInvitees.isEmpty()){for(var a=Contacts.getAllContactsforLHS(),s=Contacts.sortByUsage(a),n=0,r=0,i=s.length;i>r;r++){var o=s[r][1],l=a[o],c=parseInt(l.status?l.status:0);if(c!==$zcg.CON_REQACC&&!(c!==$zcg.CON_UNAPRD&&c!==$zcg.CON_TO_BE_INVITED&&0>c||ChatsList.persistforuser(o))){if(!(n<this.uilimit)){t=!0;break}e+=this.getHTML(l,!1,"withphoto"),n++}}if($zcg._ACTIVE_APPACC_MEMBERS_COUNT<=10){var d=OrgInvitees.getAll();if(i=d.length,i>0)for(r=0;i>r;r++)ChatsList.persistforuser(d[r])||n<this.uilimit&&(e+=this.getInviteesHTML(d[r]))}$zcg._ISFIRSTLOGIN&&n&&Settings.update({hpcontacts:1,hpmostcontacted:1});var u=Contacts.getPendingContactsList(!0),m=LeftPannel.container.find("#contactinvitations");if(0===u.length)m.empty();else{var p="";for(r=0;r<u.length;r++){var l=Contacts.get(u[r]);p+=ContactsList.getHTML(l,!1,"invitation")}0===m.find("#contactinvitationsheader").length?(p='<div id="contactinvitationsheader" opencontainer="contactinvitationslist" elemtype="header" workfor="contact" class="zcuserstatus zchomests"><div class="zcbdytitle ellips" title="'+Resource.getRealValue("contact.invitations")+'">'+Resource.getRealValue("contact.invitations")+'<div class="zccunt posl dIB"><span id="totalinvitationcount" style="display: inline;">'+Contacts.getPendingContactsList(!0).length+'</span></div></div><div class="msi-guest"></div></div><ul id="contactinvitationslist" class="zccinvits zcfrntrgstmn" style="display:block">'+p+"</ul>",m.html(p)):m.find("#contactinvitationslist").html(p),1===u.length&&m.find("#contactinvitationslist").children().first().addClass("bdrB0")}}var h=Settings.getFromObj("hpmostcontacted"),g=LeftPannel.container.find("#generalcontacts"),f='<div id="generalcontactsheader" class="zclftitmn cur" workfor="contact" elemtype="header"><div title="'+Resource.getRealValue("common.lhs.headertip")+'" class="zcbdytitle">'+Resource.getRealValue("Contacts")+'</div><span id="addcontact" title="'+Resource.getRealValue("tooltip.addcontact")+'"  workfor="contact" elemtype="create" class="msi-add"></span></div><div id="generalcontactslistholder" class="width100" '+(h?"":'style="display:none"')+'><div id="generalcontactslist" class="favlstmn">';f+=0===$.trim(e).length?this.getEmptyMessage():'<div id="topcontactslist">'+e+"</div>",f+="</div>",t&&(f+='<div id="contlistmore" class="zcuserstatus zcmorechl" workfor="contact" elemtype="more"><span class="showmore">'+Resource.getRealValue("common.showall")+"</span></div>"),f+='</div><div class="zclin"></div>',g.html(f),ZCScroll.updateScroll($("#leftpannel #list")),_doChangesIfInitialised("contacts")},addNew:function(e){var t=OrgInvitees.getAll(),i=t.length?t[t.indexOf(e)]:!1;if(Contacts.isExist(e)||i||!($Util.getObjectKeysLength(Contacts.getAllUserContacts())>100)&&Users.isExist(e)){if(Contacts.isBotId(e)&&Contacts.isExist(e))return void BotContactsList.addNewBotInList(e);var a=$("#generalcontactslist"),s=a.find('[emptymsg="true"]');s.length>0&&s.remove(),0===a.find("#contact"+$WC.Matcher.replace("containerid",e)).length?ContactsList.populate():ContactsList.update(e)}},remove:function(e){if(!$WC.$CUtil.isEmpty(e)){if(Contacts.isBotId(e))return void BotContactsList.removeBotFromList(e);var t=$WC.Matcher.replace("containerid",e),i=LeftPannel.container.find("#generalcontactslist"),a=i.find("#contact"+t);a.length>0&&ContactsList.populate()}},update:function(e){if(Contacts.isExist(e)){var t=Contacts.get(e),i=LeftPannel.container.find("#generalcontacts"),a=$WC.Matcher.replace("containerid",e),s=i.find("#contact"+a);s.length>0&&t.status!==s.find("#contactscode"+a).attr("scode")&&i.find("#topcontactslist #contact"+a).length&&s.find("#contactscode"+a).removeClass().addClass(Contacts.getStatusStyle(t,void 0,!0))}},updateDname:function(e,t){t||(t=Contacts.getDisplayName(e)),LeftPannel.container.find("#generalcontacts #contactdname"+$WC.Matcher.replace("containerid",e)).html(t)},updateImage:function(e){var t=Users.getImgUrlById(e);LeftPannel.container.find("#generalcontacts #contactuserimg"+$WC.Matcher.replace("containerid",e)).attr("src",t)},toggle:function(e){var t=LeftPannel.container.find("#"+e+"listholder"),i="none"===t.css("display");settingsupdobj="botcontacts"===e?{hpbots:i?1:0}:{hpmostcontacted:i?1:0},Settings.update(settingsupdobj)},doOperation:function(e,t){if("hdelete"===e){var i=Resource.getRealValue("info.contact.delete",[Contacts.getDisplayName(t)]),a='<div class="mheader_icn"><img src="'+Users.getImgUrlById(t)+'" width="38" height="38"/></div>',s="deletecontact"+$WC.Matcher.replace("containerid",t),n=Users.isSameOrg(t)?[Resource.getRealValue("info.contact.delete.info2.org"),Resource.getRealValue("info.contact.delete.info1"),Resource.getRealValue("info.contact.delete.info3")]:[Resource.getRealValue("info.contact.delete.info1"),Resource.getRealValue("info.contact.delete.info2.external")],r={text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Contacts.delete(t)}};$WC.$Dlg.confirm({id:s,version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:a,header:i}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:n}),buttons:[r]})}else"inviteuser"===e?Contacts.add("zoho",t):"deleteinvite"===e?Contacts.delete(t):"accept"===e||"remindmelater"===e?Contacts.acceptorreject(t,e):"hchat"===e?(this.reqForChat(t),WebMessanger.hideOnesearch()):"hviewinfo"===e&&(Contacts.getProfileDetails(t),this.clearUI(),WebMessanger.hideOnesearch())},clearUI:function(){GSUI.isNewSearchEnabled()&&GSUI.clearAndHideResults()},addInvitation:function(e){var t=LeftPannel.container.find("#contactinvitationslist");if(!t.find("#contact"+e).length){var i=t.children(),a=i.length,s=Contacts.getPendingContactsList(!0).length;1===a?i.first().removeClass("bdrB0"):0===a&&(t=LeftPannel.container.find("#contactinvitations").html('<div id="contactinvitationsheader" opencontainer="contactinvitationslist" elemtype="header" workfor="contact" class="zcuserstatus zchomests"><div class="zcbdytitle">'+Resource.getRealValue("contact.invitations")+'<div class="zccunt posl dIB"><span id="totalinvitationcount" style="display: inline;">'+s+'</span></div></div> <div class="msi-guest"></div></div><ul id="contactinvitationslist" class="dropdwncnt zcfrntrgstmn" style="display:block"></ul> </div>').find("#contactinvitationslist")),t.append(this.getHTML(Contacts.get(e),!1,"invitation")),$("#contactinvitationsheader #totalinvitationcount").html(s),ChatsList.updateUnreadNotifier(),0===a&&t.children().first().addClass("bdrB0")}},removeInvitation:function(e){if(LeftPannel.container.find("#contactinvitationslist").find("#contact"+e).slideUp(function(){$(this).remove(),$("#contactinvitationsheader #totalinvitationcount").html(Contacts.getPendingContactsList(!0).length),ChatsList.updateUnreadNotifier();var e=LeftPannel.container.find("#contactinvitations"),t=e.find("#contactinvitationslist").children(),i=t.length;1===i?t.first().addClass("bdrB0"):0===i&&e.empty()}),$WC.$Win.isExist("pendinginvitations")){var t=$WC.$Win.get("pendinginvitations"),i=t.find("#pending"+e);i.length>0&&i.slideUp(function(){$(this).remove(),0===$.trim($("#allpendinginvitations").html()).length&&$WC.$Win.destroy("pendinginvitations")})}},reqForChat:function(e,t){var i=0;if(Contacts.isExist(e)&&(i=Contacts.getStatus(e)),Contacts.isMutual(e)||Users.isSameOrg(e)){var a=t?"nim":"im";Chat.create(e,a)}else if($WC.Matcher.check("emailid",e))Chat.create(e,"inv_chat");else{var s="";i===$zcg.CON_UNAPRD?s=Resource.getRealValue("info.contact.requested",[Contacts.getDisplayName(e)]):i===$zcg.CON_REQACC?s=Resource.getRealValue("info.request.not.accepted",[Contacts.getDisplayName(e)]):i===$zcg.CON_DELETE&&(s=Resource.getRealValue("info.contact.deleted.by.opposite",[Contacts.getDisplayName(e)])),$WC.$Dlg.confirm({id:"createchaterror",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[s]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn"><img src='+Users.getImgUrlById(e)+' width="46" height="46" /></div>',header:Resource.getRealValue("info.unable.to.create.chat")}),buttons:[{text:Resource.getRealValue("common.okgotit"),colour:$WC.$Dlg.GREEN_BUTTON}]})}this.clearUI()},getHTML:function(e,t,i){var a=this.html[i],s=e.zuid,n=parseInt(e.status),r=Users.getName(s),o=Users.getEmailId(s),l=Contacts.getStatusStyle(e,void 0,!0),a=a.replace(/{USERID}/g,$WC.Matcher.replace("containerid",""+s)).replace(/{ID}/g,s).replace(/{SCODE}/g,n).replace(/{IMGURL}/g,Users.getImgUrlById(s)).replace(/{STATUSCLASS}/,l);if("pendinginvitation"===i){a=a.replace(/{EMAILID}/g,$WC.$CUtil.isEmpty(o)?"":o);var c,d,u,m,p;Users.isUserExist(s)&&(c=Users.getInfo(s),d=c.orguser,u=c.country,m=c.designation,p=c.departmentname),d&&Users.isUserPeopleInfoExist(s)?$WC.$CUtil.isEmpty(m)||$WC.$CUtil.isEmpty(p)?$WC.$CUtil.isEmpty(m)&&$WC.$CUtil.isEmpty(p)||(a=a.replace(/{ADDITIONALINFO}/g,$WC.$CUtil.isEmpty(p)?'<span id="designation" class="clr6">'+$WC.Matcher.replace("escapeReplacementString",m)+"</span>":'<span id="department" class="clr6">'+$WC.Matcher.replace("escapeReplacementString",p)+"</span>")):a=a.replace(/{ADDITIONALINFO}/g,'<span id="designation" class="clr6">'+$WC.Matcher.replace("escapeReplacementString",m)+'</span><span id="department" class="clr6">&nbsp;-&nbsp;'+$WC.Matcher.replace("escapeReplacementString",p)+"</span>"):a=a.replace(/{ADDITIONALINFO}/g,o)}return t||(a=a.replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",r))),a},getInviteesHTML:function(e){var t="";return $WC.template.replace(this.html.invitees,{ID:$WC.Matcher.replace("containerid",e),EMAILID:e,STATUSCLASS:t})}},ContactsUI={sortorder:{FREQUENT_USAGE:0,ALPHABETIC:1,AVAILABILITY_STATUS:2},inviteContactUI:{inviteconfirmhtml:'<div  class="zccrhd font16 bold mrgL20">{{header}}</div><div class="invited-selected-list">{{selected_list}}</div><div class="invite-details"><span class="invite-text font14 bold">{{invite_boxtitle}}</span><span id="welcomemsgcount" category="charcount" limit="150" class="font13 cl6 floatr">150</span><textarea id="invite-welcomemsg" class="invite-msgbx mrgT10 mrgB10 w100" placeholder="{{welcomemsg_ph}}">{{welcome_msg}}</textarea><div class="clr6 font14 mrgB20">{{invite_note}}</div><div id="contaddbtn" purpose="invite" class="windwbtn dIB cur floatr posl">{{send_invite}}</div></div>',create:function(){if(!$WC.$Win.isExist("invitecontactwin")){var e=$WC.template.replace(Template.InviteContactWindow,{$header:"contact.add.header",$invite_desc:"true"===$zcg._ISNONORGMEMBERINVITEALLOWED?"contact.invite.help.ext":"contact.invite.help.int",$tip_tool:"settings.tip",$invite_tip:"contact.invite.helptip",$contact_sugg:"contact.sugg",$quickchtnode:"contact.invite.search",$next_btn:"common.next"}),t=$WC.$Win.create({id:"invitecontactwin","class":"quickactin adchtwin invitecntwin",html:e});this.bindEvent(t)}},bindEvent:function(e){SearchField.init("invitecontact"),this.populateDefaultResult(),e.on("click","[purpose]",function(){var e=this.getAttribute("purpose");if("invite"===e)ContactsUI.inviteContactUI.sendinvite();else if("deleteimgnode"===e)$(this).parents("[nodetype]").remove(),$WC.DivEditor.focus("invitecontact-search-field"),ContactsUI.inviteContactUI.populateDefaultResult(),$WC.$CUtil.isEmpty($("#invitecontact-select-field").html())&&$("#invitecontact").addClass("zcrchmcnt");else if("invite_next"===e){var t=$("#invitecontact"),i=$("#invitecontact-select-field").children().length>1,a=ContactsUI.inviteContactUI.inviteconfirmhtml;a=$WC.template.replace(a,{selected_list:$("#usernodecnt").html()},"InSecureHTML"),a=$WC.template.replace(a,{$header:"contact.add.header",$invite_boxtitle:"contact.inviteconfirm.welcometitle",$welcomemsg_ph:"contact.invite.welcomemsg.ph",$welcome_msg:"contact.invite.welcomemsg",$invite_note:i?"contact.inviteconfirm.note":"",$send_invite:"checklist.sendinvites"}),t.html(a),$("#invite-welcomemsg").select(),$Dom.limitInput($("#invite-welcomemsg"));var s=t.find("#invite-welcomemsg");s.on("keyup",function(){$Dom.limitInput($("#invite-welcomemsg"))}),s.on("focus focusout",function(e){"focus"===e.type?($("#welcomemsgcount").removeClass("dN"),$Dom.limitInput($("#invite-welcomemsg"))):$("#welcomemsgcount").addClass("dN")})}})},handleAction:function(e,t){var i=t.attr("uid");if(!$WC.$CUtil.isEmpty(i)){t.remove();var a=Users.getName(i),s=Users.getImgUrlById(i),n=t.attr("elemtype"),r="";"emailids"===n&&(a=i,s=Users.getDefaultImgUrl(),r='<div class="usrstatus msi-addicon"></div>');var o='<div uid="'+i+'" title="'+a+'" elemtype="contact" nodetype="@" class="dIB zcricnt posl"><img src="'+s+'"/>'+r+'<div class="msi-close posa dN cur" purpose="deleteimgnode"></div></div>';$("#invitecontact-select-field").append(o),$("#invitecontact").removeClass("zcrchmcnt"),SearchField.clearSearchField("invitecontact")}},search:function(e){ContactsUI.inviteContactUI.populateSuggestion(e)},populateSuggestion:function(e){var t=$("#invitecontact-results"),i=SearchField.getSelectedList("invitecontact-select-field"),a=Contacts.getAll();t.html("<div id='invitecontact-list' class='zccsggcnt'></div>");for(var s in a)(a[s].status>=0||a[s].status==$zcg.CON_REQACC||a[s].status==$zcg.CON_REMIND_ME_LATER)&&i.push(a[s].zuid);var n=SearchAgent.search({val:e,searchin:SearchAgent.ORGCONTACTS,ignorelist:i,allstatuscontacts:!0,contactshtml:QuickAction.quickchatcontacthtml,orgcontactshtml:QuickAction.quickchatcontacthtml,listid:"invitecontact-list",debugsource:"InviteContactSuggestion",clearcallback:function(){var t=SearchField.checkAndAddEmailInAutocomplete("invitecontact",e,!0);t&&ContactsUI.inviteContactUI.populateEmptyResult(e)}});if(n)ZCScroll.customScroll(t.find("#invitecontact-list"),!0),$("#sugg_header").show(),t.show(),t.find("#invitecontact-list").find("[purpose='search']").first().addClass("srchbn sel");else{var r=SearchField.checkAndAddEmailInAutocomplete("invitecontact",e,!0);r&&this.populateEmptyResult(e)}},populateEmptyResult:function(e){var t="";"*"!==e&&e.length>0?($("#sugg_header").hide(),t='<div class="err_sugg">'+Resource.getRealValue("contact.invite.nosugg")+"<br>"+Resource.getRealValue("contact.invite.nosugg.example")+"</div>"):($("#sugg_header").show(),t='<div class="empty_sugg dflxcent">'+Resource.getRealValue("contact.invite.nosugg")+"</div>"),$("#invitecontact-list").html(t)},populateDefaultResult:function(){var e=$("#invitecontact-search-field"),t=$WC.DivEditor.removeBufferCharacters(e.text());$WC.$Win.isExist("invitecontactwin")&&!$.trim(t).length&&(this.populateSuggestion("*"),e.focus())},handleKeyUp:function(e,t){var i=e.which;e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&($WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes("invitecontact-search-field")?$WC.$Win.destroy("invitecontactwin"):(SearchField.clearSearchField("invitecontact"),this.populateDefaultResult()))},sendinvite:function(){for(var e=SearchField.getSelectedList("invitecontact-select-field"),t=[],i=0;i<e.length;i++){var a=e[i];t.push(Users.isExist(a)?Users.getEmailId(a):a)}if(t.length>0){$Util.Button.addLoadIcon($("#contaddbtn"));var s=$("#invite-welcomemsg").val();Contacts.add("zoho",t.join(),void 0,$.trim(s),void 0,!0)}}},showPendingRequests:function(){function e(e,t){var i=document.getElementById("pendinglist");if(i)i.querySelector("#pending"+t)||$(i).append(e);else{var a='<div pendinginvitesUI overlay class="zc-pendinginvites"><div id="pendingheader" class="header"><span purpose="closeoverlay" class="msi-bckarw cur"></span>'+Resource.getRealValue("profileview.mycliq.pendinginvites")+'</div><div id="pendinglist" class="contctlist">'+e+"</div></div>",s=$("#accountmenu");s.find("#usermenu").after(a),s.find("[pendinginvitesUI]").addClass("show")}}var t=Contacts.getPendingContactsList(),i=[],a="",s=Contacts.getAll();if(0===t.length)a+=ProfileMenuUI.htmls.pendinginvitesempty;else{for(var n=0;n<t.length;n++){var r=t[n];Users.isAdditionalInfoExist(r)?e(ContactsList.getHTML(s[r],!1,"pendinginvitation"),r):i.push(r)}i.length>0&&Users.getProfileInfoforBulkList(i,function(t){e(ContactsList.getHTML(s[t],!1,"pendinginvitation"),t)})}},showAllContacts:{sortinghtml:'<div id="showorderoptions" class="c-orderdrpdwn posl"><div id="contactorder" class="cur c-drpdwn-opts"  showorderoptions><em class="msi-sorticon"></em><span id="selctdorder"></span></div><div id="orderoptions" class="order-optns posa"><div order="1" purpose="setorder" class="cur ellips"><span class="alphabet-order">ABC</span><span class="font14 ">'+Resource.getRealValue("contact.order.alphabet")+'</span></div><div order="0" purpose="setorder" class="cur ellips"><span class="frequent-cnt"></span><span class="font14">'+Resource.getRealValue("contact.order.frequent")+'</span></div><div order="2" purpose="setorder" class="cur ellips"><span class="status-order"></span><span class="font14">'+Resource.getRealValue("contact.order.status")+"</span></div></div></div>",create:function(){var e="showallcontacts";if(!$WC.$Win.isExist("showallcontactswin")){var t=$WC.template.replace(Template.viewContactsListHtml,{sort_dropdown:this.sortinghtml},"InSecureHTML");t=$WC.template.replace(t,{$header:"Contacts",win_id:e,$searchplaceholder:"smartsearch.search.contacts"});var i=$WC.$Win.create({id:"showallcontactswin","class":"adchtwin directmessagewin quickactin allcontact",html:t,closefn:function(){Clickoutside.clear("orderoptions")}});SearchField.init(e),this.bindEvents(e,i)}},bindEvents:function(e,t){var i=t.find("#"+e+"-list"),a='<div class="zcuserstatus" id="loading"><div class="imgview-loadng"></div></div>';i.append(a);var s=Settings.getFromObj("contact_sortingorder"),n=t.find("#showorderoptions");s=s?s:ContactsUI.sortorder.FREQUENT_USAGE;var r=s==ContactsUI.sortorder.ALPHABETIC?"ABC":"",o=s==ContactsUI.sortorder.ALPHABETIC?"alphabet-order":s==ContactsUI.sortorder.AVAILABILITY_STATUS?"status-order":"frequent-cnt";n.find("#selctdorder").addClass(o).html(r),n.find('[order="'+s+'"]').addClass("selctd"),this.populateDefaultResult(),t.on("click","[purpose]",function(e){e.stopPropagation();var t=$(this).attr("purpose");if("setorder"===t){var i=$(this).attr("order"),a=$("#showallcontacts-search-field").html(),s=i==ContactsUI.sortorder.ALPHABETIC?"ABC":"",r=i==ContactsUI.sortorder.ALPHABETIC?"alphabet-order":i==ContactsUI.sortorder.AVAILABILITY_STATUS?"status-order":"frequent-cnt";n.find("#selctdorder").removeClass().addClass(r).html(s),n.find('[purpose="setorder"]').removeClass("selctd"),n.find('[order="'+i+'"]').addClass("selctd"),ContactsUI.showAllContacts.search(a,i),Settings.update({contact_sortingorder:parseInt(i)}),Clickoutside.handleClickOnChild(e)}}),t.find("[showorderoptions]").on("click",function(e){Clickoutside.bind({srcid:"showorderoptions",destid:"orderoptions",event:e,customShow:function(e){$("#"+e.srcid).addClass("show")},customHide:function(e){$("#"+e.srcid).removeClass("show")}})}),ZCScroll.customScroll($("#"+e+"-list"),!0)},handleKeyUp:function(e,t){var i=e.which;e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&($WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes("showallcontacts-search-field")?$WC.$Win.destroy("showallcontactswin"):(SearchField.clearSearchField("showallcontacts"),this.populateDefaultResult()))},handleAction:function(e,t){var i=t.attr("elemtype");if("contact"===i){$WC.$Win.destroy("showallcontactswin");var a=t.attr("uid");Chat.create(a,"im")}},populateDefaultResult:function(){var e=Settings.getFromObj("contact_sortingorder"),t=$("#showallcontacts-search-field"),i=$WC.DivEditor.removeBufferCharacters(t.text());$WC.$Win.isExist("showallcontactswin")&&$WC.$CUtil.isEmpty(i)&&(this.search("*",e),t.focus())},search:function(e,t){e="undefined"==typeof e?"*":e.trim().toLowerCase();var i="showallcontacts",a="",s=[],n=Contacts.getAllContactsforLHS();if(s=t==ContactsUI.sortorder.ALPHABETIC?Contacts.sortByDName(n):t==ContactsUI.sortorder.AVAILABILITY_STATUS?Contacts.sortByStatus(n):Contacts.sortByUsage(n),a=ContactsUI.showAllContacts.getHtmlForResponse(s,n,e),""!==a)$("#"+i+"-list").html(a);else{var r='<div class="textcent clr6 h100 dflxjustcent"><span>'+Resource.getRealValue("common.search.none")+"</span></div>";$("#"+i+"-list").html(r)}},getHtmlForResponse:function(e,t,i){var a="";for(var s in e){var n=t[e[s][1]];if(Contacts.isMutual(n.zuid)){var r=QuickAction.quickdirectmsgcontacthtml.replace(/{PURPOSE}/,"search"),o=Contacts.isExist(n.zuid)?Contacts.getDisplayName(n.zuid):n.dname,l=n.emailid,c=Users.getImgUrlById(n.zuid);if(o=$WC.Matcher.replace("escapeReplacementString",n.dname),"*"!==i){var d=$Util.searchWithSpecialChars(o,i);if(0>d){if(!l)continue;var u=l.indexOf(i);if(0>u)continue}}r=r.replace(/{USERID}/g,n.zuid).replace(/{IMGURL}/g,c).replace(/{DNAME}/g,o).replace(/{DNAMEVAL}/g,o).replace(/{EMAILID}/g,l).replace(/{ADDCONTACTORROLEHTML}/g,"").replace(/{DELETEMEMBER}/g,"").replace(/{STATUSCLASS}/g,Contacts.isMutual(n.zuid)?Contacts.getStatusStyle(n.zuid):""),a+=r}}return a}}},BotContactsList={uilimit:10,populateBotContacts:function(){if(SecurityManager.hasPermission(Modules.Bots)){var e="",t=!1;if(!Contacts.isEmpty())for(var i=Contacts.getAllBotContacts(),a=Contacts.sortByUsage(i),s=0,n=0,r=a.length;r>n;n++){var o=a[n][1],l=i[o];if(!ChatsList.persistforuser(o)){if(!(s<this.uilimit)){t=!0;break}e+=ContactsList.getHTML(l,!1,"withphoto"),s++}}var c=Settings.getFromObj("hpbots"),d=LeftPannel.container.find("#botcontacts"),u='<div id="botcontactsheader" class="zclftitmn cur" workfor="contact" elemtype="header"><div title="'+Resource.getRealValue("common.lhs.headertip")+'" class="zcbdytitle">'+Resource.getRealValue("bots.title")+'</div><span id="addcontact" title="'+Resource.getRealValue("bots.addbot")+'"  workfor="contact" elemtype="create" class="msi-add"></span></div><div id="botcontactslistholder" class="width100" '+(c?"":'style="display:none"')+'><div id="botcontactslist" class="favlstmn">';u+=0===$.trim(e).length?this.getEmptyMessage():'<div id="topbotcontactslist">'+e+"</div>",u+="</div>",t&&(u+='<div id="botcontlistmore" class="zcuserstatus zcmorechl" workfor="contact" elemtype="more"><span class="showmore">'+Resource.getRealValue("common.showall")+"</span></div>"),u+='</div><div class="zclin"></div>',d.html(u),ZCScroll.updateScroll($("#leftpannel #list"))}},showAllBots:{unsubscribedbothtml:'<div id="bot{{bot_id}}" botid="{{bot_id}}" class="zcuserstatus zcrtchtcontct diag_listview"><div class="elem-img dflxjustcent" ><img id="contactuserimg{{bot_id}}" class="floatl rds4" style="width:40px;height:40px" src="{{img_url}}"></div><div id="details" class="elem-details mrgL10 ellips"><div id="contactdname{{bot_id}}" class="font16 ellips">{{bot_name}}</div><div class="font14 clr6 ellips">{{bot_desc}}</div></div><div  class="elem-optns subscribebtn"><span purpose="subscribebot" botid="{{bot_id}}">{{subscribe_text}}</span></div></div>',subsribedbotHtml:'<div id="bot{{bot_id}}" botid="{{bot_id}}" elemtype="bot" purpose="search" class="zcuserstatus zcrtchtcontct diag_listview"><div class="elem-img dflxjustcent" ><img id="contactuserimg{{bot_id}}" class="floatl rds4" style="width:40px;height:40px" src="{{img_url}}"></div><div id="details" class="elem-details mrgL10 ellips"><div id="contactdname{{bot_id}}" class="font16 ellips">{{bot_name}}</div><div class="font14 clr6 ellips">{{bot_desc}}</div></div></div>',viewbotwindowHtml:'<div id="{{win_id}}" ignoresubscribed="{{ignore_subscribed}}" class="mcontent zcinhds zcrchmcnt"><div  class="zccrhd font16 bold mrgL20">{{header}}</div><div id="{{win_id}}-search-field" contenteditable="true" type="text" name="" class="zccrin" placeholder="{{searchplaceholder}}"></div><div class="stickytitle" zc_sticky_title zc_stick_init></div><div id="{{win_id}}-results" class="zcrchtlt"><div id="{{win_id}}-list" zc_sticky_title_list class="posl zcht100"></div></div><div class="txtcent footr dflxcent">'+Resource.getRealValue("bots.listfooter.text")+'<span purpose="createbot">'+Resource.getRealValue("bots.listfooter.create")+"</span></div></div>",create:function(e){var t="showallbots";if(!$WC.$Win.isExist("showallbotswin")){var i=e?"bots.yettosubscribe":"bots.title",a=$WC.template.replace(this.viewbotwindowHtml,{$header:i,win_id:t,ignore_subscribed:e?!0:!1,$searchplaceholder:"bots.search.name"}),s=$WC.$Win.create({id:"showallbotswin","class":"adchtwin directmessagewin quickactin allbotswin",html:a});this.bindEvents(t,s)}},bindEvents:function(e,t){SearchField.init(e),this.populateDefaultResult(),t.on("click","[purpose]",function(){var e=this.getAttribute("purpose");if("createbot"===e)IntegrationUI.init(Integration.Modules.Bots),$WC.$Win.destroy("showallbotswin");else if("subscribebot"===e){var t=$(this).attr("botid");Bots.subscribe(t),$WC.$Win.destroy("showallbotswin")}}),ZCScroll.customScroll($("#"+e+"-list"),!0)},handleKeyUp:function(e,t){var i=e.which;e.stopPropagation(),i===$zcg.ESCAPE_KEYCODE&&($WC.$CUtil.isEmpty(t)&&!SearchField.hasNodes("showallbots-search-field")?$WC.$Win.destroy("showallbotswin"):(SearchField.clearSearchField("showallbots"),this.populateDefaultResult()))},handleAction:function(e,t){var i=t.attr("elemtype");if("bot"===i){var a=t.attr("botid");$WC.$Win.destroy("showallbotswin"),ContactsList.reqForChat(a,!1)}},populateDefaultResult:function(){var e=$("#showallbots-search-field"),t=$WC.DivEditor.removeBufferCharacters(e.text());$WC.$Win.isExist("showallbotswin")&&$WC.$CUtil.isEmpty(t)&&(this.search("*"),e.focus())},search:function(e){e="undefined"==typeof e?"*":e.trim().toLowerCase();var t=Bots.search({val:e,getashtml:!1,limit:-1,successcallback:function(t){BotContactsList.showAllBots.appendHtml(t.searchedlist,e)}}).searchedlist;BotContactsList.showAllBots.appendHtml(t,e)},appendHtml:function(e,t){var i="true"===$("#showallbots").attr("ignoresubscribed"),a="",s="",n="",r=$("#showallbots-results"),o=r.find("#showallbots-list");e=e||Bots.getAll(!0);for(var l=0;l<e.length;l++){var c=e[l],d=Bots.getObject(c),u=$WC.$CUtil.processXSS(d.name);if("undefined"!=typeof t){var m=new RegExp($WC.Matcher.replace("escaperegexp",t),"i");u=u.replace(m,"<b>$&</b>")}var p=Contacts.isBot(c)?!0:!1,h=p?this.subsribedbotHtml:this.unsubscribedbothtml;h=$WC.template.replace(h,{bot_name:u},"InSecureHTML"),h=$WC.template.replace(h,{bot_id:c,img_url:Bots.getImgUrl(c),bot_desc:d.desc,$subscribe_text:"bots.subscribe"}),p?s+=h:n+=h}if(i?($WC.$CUtil.isEmpty(n)||(a+=n),$WC.$CUtil.isEmpty(s)||"*"===t||(a+='<div id="subscribedbotsheader" class="subheader">'+Resource.getRealValue("bots.subscribed")+"</div>"+s)):($WC.$CUtil.isEmpty(s)||(a+='<div id="subscribedbotsheader" zc_running_title class="subheader">'+Resource.getRealValue("bots.subscribed")+"</div>"+s),$WC.$CUtil.isEmpty(n)||(a+='<div id="allbotsheader" zc_running_title class="subheader">'+Resource.getRealValue("bots.yettosubscribe")+"</div>"+n)),a.length)o.html(a),o.find("[zc_running_title]").css("display","inline-block"),$Util.initializeStickyTitle($("#showallbots"));else{var g=Resource.getRealValue("*"===t?"bots.yettosubscribe.none":"common.search.none");a='<div class="textcent clr6 h100 dflxjustcent"><span>'+g+"</span></div>",o.html(a)}}},addNewBotInList:function(e){var t=$("#botcontactslist"),i=t.find('[emptymsg="true"]');i.length>0&&i.remove(),0===t.find("#contact"+$WC.Matcher.replace("containerid",e)).length?BotContactsList.populateBotContacts():ContactsList.update(e)},removeBotFromList:function(e){var t=$WC.Matcher.replace("containerid",e),i=LeftPannel.container.find("#botcontactslist"),a=i.find("#contact"+t);a.length>0?BotContactsList.populateBotContacts():0===i.find('[catagory="contact"]').length&&i.html(this.getEmptyMessage()).show()},getEmptyMessage:function(){return'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("bots.initial.none")+'</div><div id="topbotcontactslist"></div>'}};var Groups={},GroupDetails={};Groups={SEARCH_LIMT:25,ORG_GROUPS_FETCH_TIME:-1,MY_ORG_GROUPS_FETCH_TIME:-1,Role:{OWNER:0,MODERATOR:1,MEMBER:2},Roleresources:{0:"group.administrator",1:"channel.role.3",2:"group.member"},searchhtml:'<div  id="group{ID}" uid="{GROUPID}" elemtype="group" purpose="search"><span class="usrimgsts"><img width="24" height="24" src="{IMGURL}"></span><span id="groupdname{ID}" class="usrname ellips">{DNAMEVAL} <em>{PARTICIPANTSDETAIL}</em></span></div>',isExist:function(e){var t=$DB.get("groups");return t&&t.list?t.list.hasOwnProperty(e):!1},isMyGroup:function(e){var t="string"==typeof e?this.get(e):e;return"object"==typeof t?1==t.ismember:!1},get:function(e){return this.isOrgGroupExist(e)?$DB.get("orggroups")[e]:void 0},isOrgGroupExist:function(e){return $DB.get("orggroups").hasOwnProperty(e)},getAllOrgGroups:function(e){var t=$Util.cloneObject($DB.get("orggroups"),!0);if(e)return t;var i={};for(var a in t)t[a].ismember&&(i[a]=t[a]);return i},getImgUrlById:function(e){var t=Groups.get(e);return"undefined"!=typeof t&&t.imgchangedtime?$zcg._PHOTOSERVER+"/file?ID="+e+"&exp=600&t=group&height=50&width=50&nocache="+t.imgchangedtime:$zcg._PHOTOSERVER+"/file?ID="+e+"&exp=600&t=group&height=50&width=50"},getImgUrl:function(e){return this.getImgUrlById(e.id)},getDisplayName:function(e,t){return this.isOrgGroupExist(e)?this.get(e).name:t},getMyRole:function(e){var t=this.get(e),i=this.Role.MEMBER;return"undefined"!=typeof t&&(t.isadmin?i=this.Role.MODERATOR:t.hasOwnProperty("ismember")&&(i=t.ismember?this.Role.MEMBER:"")),i},getMyRoleName:function(e){return Resource.getRealValue(this.Roleresources[this.getMyRole(e)])},getMembersFromObj:function(e){var t={};e=e.split(",");for(var i=0,a=e.length;a>i;i++){var s=this.get(e[i]);if("undefined"!=typeof s){var n=$Util.cloneObject(this.get(e[i]).members,!0);t=$.extend(!0,{},t,n)}}return t},getGroupNames:function(e,t){var i=[];if("undefined"!=typeof t)for(var a=0,s=e.length;s>a;a++)i.push($WC.$CUtil.processXSS(t[e[a]]));return i.join(", ")},updateMembersInObj:function(e,t){var i=this.get(e);"undefined"==typeof i&&($DB.get("orggroups")[e]={},i=this.get(e)),i.members=t},updateOrgGroups:function(e){var t=$DB.get("orggroups");for(var i in e){var a=e[i],s=a.id,n=t[s]||{};n.id=s,n.name=a.name,n.desc=a.desc,n.ismember=parseInt(a.ismember),n.isadmin=parseInt(a.isadmin),t[s]=n}},sort:function(e){var t=[];for(var i in e){var a=Groups.getDisplayName(i);t.push([a.toLowerCase(),i])}return $Util.sort(t,0)},getDataForSearch:function(e){var t=this.get(e);return t.members&&t.members.length>0?Resource.getRealValue("group.members.count",[t.members.length]):t.hasOwnProperty("ismember")?t.ismember?this.getMyRoleName(e):"":void 0},deleteDetails:function(e){GroupDetails.hasOwnProperty(e)&&delete GroupDetails[e]},getSearchResults:function(){function e(e,t,i,a){if(t)t=t.replace(/{ID}/g,$WC.Matcher.replace("containerid",""+e.id)).replace(/{GROUPID}/g,e.id).replace(/{IMGURL}/g,Groups.getImgUrl(e)).replace(/{ROLE}/g,Groups.getMyRole(e.id)).replace(/{PARTICIPANTSDETAIL}/g,$WC.Matcher.replace("escapeReplacementString",Groups.getDataForSearch(e.id)));else{var s=e.id,n=$WC.Matcher.replace("containerid",""+s),r="undefined"!=typeof r?r:Groups.getMyRole(s);t='<div id="group'+n+'" uid="'+s+'" elemtype="group" class="zcuserstatus withimg"><div class="usrimgsts floatl zc-1"><img class="floatl rds4" style="width:30px;height:30px" src="'+Groups.getImgUrl(e)+'"></div><div class="floatl userdetails"><span id="groupdname'+n+'" class="ellips">{DNAMEVAL}</span></div><div class="msi-grpstatus-'+r+'"></div></div>'}var o=$WC.$CUtil.processXSS(e.name);return a&&(o=o.replace(new RegExp($WC.Matcher.replace("escaperegexp",i),"i"),"<b>$&</b>")),t.replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",o))}function t(e,t){if(t.length>0){var i=t.indexOf(e);if(-1!==i)return!1}return!0}return function(i){Groups.loadAllOrgGroups();var a=("undefined"!=typeof i.orggroups?i.orggroups:!1,"undefined"!=typeof i.allorggroups?i.allorggroups:!1),s=i.val.toLowerCase(),n="undefined"!=typeof i.html?i.html:this.searchhtml,r="undefined"==typeof i.ignorelist?[]:i.ignorelist,o="undefined"==typeof i.highlight?!0:i.highlight,l="undefined"==typeof i.limit?this.SEARCH_LIMT:i.limit,c="undefined"==typeof i.validorggroups?[]:i.validorggroups,d=[],u=[],m=[],p={},h="",g=0,f=this.getAllOrgGroups(a);for(var v in f){var C=f[v];if(t(v,r)&&($.isEmptyObject(c)||!t(v,c)))if("*"===s)d.push([C.name,v]);else{var y=-1;if(C.name&&(y=C.name.toLowerCase().indexOf(s)),-1===y)continue;0===y?d.push([C.name,v]):u.push([C.name,v])}}m=$Util.sort(d,0),g=m.length,l>g&&(m=m.concat($Util.sort(u,0))),m=m.slice(0,l),g=m.length;for(var b=[],E=0;g>E;E++){var v=m[E][1],C=f[v];b.push(v),h+=e(C,n,s,o),p["groupdname"+v]=[[],C.name,!1]}return{content:$Util.createSafeElement(h,p),searchedlist:b}}}(),loadAllOrgGroups:function(){_isOrgUser()&&(Groups.ORG_GROUPS_FETCH_TIME>$zcg.WMS_DISCONNECT_TIME||$ZCAjx.ajax({url:"/v1/orggroups",success:function(e){$WC.$CUtil.isEmpty(e.data)||Groups.updateOrgGroups(e.data.orggroups),Groups.ORG_GROUPS_FETCH_TIME=(new Date).getTime()}}))},isUserGrpMember:function(e,t){var i=!0;for(var a in t)if($WC.$CUtil.isEmptyObject(Groups.getMembersFromObj(a))){i=!1;break}return i?Groups.getMembersFromObj(t.join(",")).hasOwnProperty(e):void 0},loadMyOrgGroups:function(){_isOrgUser()&&(Groups.MY_ORG_GROUPS_FETCH_TIME>$zcg.WMS_DISCONNECT_TIME||$ZCAjx.ajax({url:"/v1/orggroups",data:{mine:!0},success:function(e){$WC.$CUtil.isEmpty(e.data)||Groups.updateOrgGroups(e.data.orggroups),Groups.MY_ORG_GROUPS_FETCH_TIME=(new Date).getTime(),ChannelsUI.handleModuleStatusChange()}}))},getMembers:function(e){$ZCAjx.ajax({url:"/getgroupmembers.do",data:{groupid:e},success:function(e){for(var t in e)Groups.updateMembersInObj(t,e[t])}})}};var LiveSupport={};LiveSupport={init:function(){$("#livesupport").on("click","[purpose]",function(e){LiveSupport.handleEvents(e,this)})},create:function(e){var t=Template.LiveSupportHTML;t=t.replace(/{CHID}/g,e.chid).replace(/{GUID}/g,e.guid).replace(/{ATTR_A}/g,e.a).replace(/{ATTR_G}/g,e.g).replace(/{TIME}/g,$Date.time()).replace(/{SUPPORTTITLE}/g,e.title).replace(/{GUESTNAME}/g,e.guname);var i=$("#livesupport");i.append(t),Sound.play("livesupport",{duration:1e4})},handleEvents:function(e,t){var i=e.target.id,a=t.id;if("close"===i||"skip"===i)this.remove(a);else if("accept"===i){var s=t.getAttribute("guid"),n=t.getAttribute("a"),r=t.getAttribute("g");this.accept(a,s,n,r);var o={chid:a,sender:"",nname:t.getAttribute("guname"),addinfo:"CT_TYPE:4",title:t.getAttribute("suptitle"),createfrom:"chat"};ChatUI.create(o)}},accept:function(e,t,i,a){$ZCAjx.ajax({url:"/acccsupport.do",type:"POST",data:{chid:e,guid:t,a:i,g:a,sid:WmsImpl.getSid()}})},missed:function(e){var t=$("#livesupport");t.find("#"+e).addClass("missed").attr("status","missed"),0===t.find('[status="active"]').length&&Sound.stop("livesupport")},remove:function(e){var t=$("#livesupport");t.find("#"+e).remove(),0===t.find('[status="active"]').length&&Sound.stop("livesupport")},end:function(e){var t='<div class="bold pdbm">'+Resource.getRealValue("info.livesupport.end")+"</div><div>"+Resource.getRealValue("confirm.livesupport.end")+"</div>";$WC.$Dlg.confirm({id:"endlivesupport"+e,bodyhtml:t,imagehtml:'<div class="msi-history"></div>',buttons:[{text:Resource.getRealValue("common.end"),action:function(){Chat.sendStatus(e,$zcg.NFY_ENDLIVESUPPORT)}}]})}};var Integration={},IntegrationUI={},IntegrationsCwin={},IntegrationsUtil={};Integration=function(){var e=[["Commands","CommandsUI"],["MessageActions","MessageActionsUI"],["Functions","FunctionsUI"],["Schedulers","SchedulersUI"],["PlatformStorages","PlatformDatabasesUI"],["Bots","BotsUI"],["Applications","ApplicationsUI"]],t=e[0][0],i={},a=[],s="",n=0;for(e.length;n<e.length;n++){var r=e[n];i[r[0]]=r[1]}return{Modules:{Commands:e[0][0],MessageActions:e[1][0],Functions:e[2][0],Schedulers:e[3][0],PlatformStorages:e[4][0],Bots:e[5][0],Applications:e[6][0],Channels:"Channels"},Components:{Command:"command",Bot:"bot",Function:"function",MessageAction:"messageaction",Scheduler:"scheduler",Extension:"application",Channel:"channel"},getEntityInterface:function(e){var t=i[e];if("undefined"!=typeof t){if(-1!==t.indexOf(".")){for(var a=t.split("."),s=window,n=0,r=a.length;r>n;n++)s=s[a[n]];return s}return window[t]}},isAnyPlatformComponentEnabled:function(){for(var t=0;t<e.length;t++){var i=e[t][0];if(SecurityManager.hasPermission(Modules[i]))return!0}return!1},getDefaultEntity:function(){for(var i=0;i<e.length;i++){var a=e[i][0];if(SecurityManager.hasPermission(Modules[a]))return a}return t},updateLoaded:function(e){this.checkAlreadyLoaded(e)||a.push(e)},checkAlreadyLoaded:function(e){return-1!=a.indexOf(e)},resetLoaded:function(){a=[],s=""},getCurrentEntity:function(){return s},setCurrentEntity:function(e){s=e},setIntegrationLHS:function(){for(var t=$("#integrationwin"),i=0;i<e.length;i++){var a=e[i][0];SecurityManager.hasPermission(Modules[a])&&t.find('[entity="'+a+'"]').show()}}}}(),IntegrationUI={isLHSHidden:!1,componentsInitialised:!1,hasPrevWin:!1,select:function(e,t,i){DREImpl.checkAndCloseEditor(function(){var a=$WC.$Win.get("integrationwin");Integration.getCurrentEntity()!=e&&IntegrationsCwin.hide(),a.find("[integlhsmenu]").removeClass("sel"),a.find("[integlhsmenu][entity='"+e+"']").addClass("sel"),Clickoutside.clear("Integrationspreviewcontainer"),IntegrationUI.show(e,i,t)})},init:function(e,t){if(!$WC.$Win.isExist("integrationwin")){var i=this.construct(e===Integration.Modules.Channels);this.bindEvents(i),$WC.$CUtil.isEmpty(e)&&(e=Integration.getDefaultEntity()),$WC.$CUtil.isEmpty(e)||this.select(e,t,!0),this.checkAndInitialize(),WebMessanger.disableOneSearchShortcut(!0)}},checkAndInitialize:function(){this.componentsInitialised||(this.componentsInitialised=!0,Bots.get(),Functions.getAllFromServer(),Schedulers.getAllFromServer(),PlatformDatabases.getAllFromServer(),MessageActions.get())},construct:function(e){var t=Template.Integrationwin,i=this.isLHSHidden?" zcletmin":"";e&&(i+=" integ-lhs-hide");var a=$WC.$Win.create({id:"integrationwin","class":"itgrtwin"+i,closehtml:'<span id="integclose" title="'+Resource.getRealValue("common.close")+'" integbuttons purpose="closeWindow" class="msi-close cclose"></span>',aligncenter:!1,html:t,closebeforefn:function(){IntegrationsCwin.close(),WebMessanger.disableOneSearchShortcut(!1)},closefn:function(){Integration.resetLoaded(),Clickoutside.clear("Integrationspreviewcontainer")}});return Integration.setIntegrationLHS(),a},bindEvents:function(e){e.on("click","[integlhsmenu]",function(e){e.stopPropagation();var t=this.getAttribute("entity");IntegrationUI.select(t,e)}),e.on("click","[integbuttons]",function(){var e=this.getAttribute("purpose");IntegrationUI.handle[e]()}),e.on("transitionend","[transitionelem]",function(e){var t=e.target.hasAttribute("transitionelem");t&&DREImpl.isEditorInitialised()&&DREImpl.resize()}),e.on("keyup focus","[listen=keyup]",function(){$(this).removeClass("error")}),DREImpl.bindSizeChangerEvents()},show:function(e,t,i){var a=Integration.getCurrentEntity(),s=$("#IntegrationsRHS").find("[integrationlistview]");if(!(a===e&&s.length>0&&s.attr("integrationlistview")===e)){IntegrationUI.handle.showSavedLHSState(),IntegrationUI.hasPrevWin=!1,IntegrationsCwin.hide(),Integration.setCurrentEntity(e);var n=Integration.checkAlreadyLoaded(e),r=Integration.getEntityInterface(e);"undefined"!=typeof r&&(t||s.length>0?Integration.getEntityInterface(e).show(!n,i):$("#IntegrationsRHS").fadeOut(300,function(){Integration.getEntityInterface(e).show(!n,i),$("#IntegrationsRHS").hide().fadeIn(100)})),Integration.updateLoaded(e)}},handle:{toggleLHS:function(){$("#integrationwin").hasClass("zcletmin")?this.changeLHSState(!1,!0):this.changeLHSState(!0,!0)},changeLHSState:function(e,t){e?$("#integrationwin").addClass("zcletmin"):$("#integrationwin").removeClass("zcletmin"),t&&(IntegrationUI.isLHSHidden=e)},showSavedLHSState:function(){this.changeLHSState(IntegrationUI.isLHSHidden?!0:!1)},hidePreview:function(){IntegrationUI.hidePreview()},closeWindow:function(){DREImpl.checkAndCloseEditor(function(){$WC.$Win.destroy("integrationwin")})},escape:function(){return $WC.$Win.isExist("integrationwin")&&0===$("#integrationwin").next().length&&DREImpl.isDelugeEditorScriptChanged()?(this.closeWindow(),!0):void 0}},preview:function(e,t,i,a,s){var n=$("#Integrationspreview");n.attr(e,t).attr("component_id",t),IntegrationUI.hasPrevWin?(n.fadeOut(300,function(){n.html(i).fadeIn(100,s)}),IntegrationUI.hasPrevWin=!0):Clickoutside.bind({srcid:"Integrationspreviewcontainer",destid:"Integrationspreviewcontainer",event:a,customShow:function(){n.html(i),n.show().animate({left:"50%"},500,s),$("#Integrationspreviewcontainer").show().animate({left:"50%"},500),IntegrationUI.hasPrevWin=!0},customHide:function(){IntegrationUI.hidePreview()}})},hidePreview:function(){Clickoutside.clear("Integrationspreviewcontainer");var e=$("#Integrationspreview");e.animate({left:"100%"},500),$("#Integrationspreviewcontainer").animate({left:"100%"},500,function(){e.empty(),IntegrationUI.hasPrevWin=!1})},listView:{previousSearches:{},modules:{Commands:{initialTemplate:"CommandInitialPage",emptyStateParams:{$btn_text:"integration.add.commands",$content:"integration.commands.info",attributes:"commandbuttons purpose=add"},emptyResult:"commands.search.none",searchElement:"commandsearch"},Bots:{initialTemplate:"BotsInitialPage",emptyStateParams:{$btn_text:"bots.create",$content:"bots.brief.info",attributes:"botbuttons purpose=createUI"},emptyResult:"bots.search.none",searchElement:"botsearch"},Functions:{initialTemplate:"FunctionsInitialPage",emptyStateParams:{$btn_text:"functions.create",$content:"functions.listheaderinfo",attributes:"functionbuttons purpose=getaddui"},emptyResult:"function.search.none",searchElement:"functionssearch"},Schedulers:{initialTemplate:"SchedulersInitialPage",emptyStateParams:{$btn_text:"schedulers.create",$content:"schedulers.listheaderinfo",attributes:"schedulerbuttons purpose=getaddui"},emptyResult:"scheduler.search.none",searchElement:"schedulerssearch"},PlatformStorages:{initialTemplate:"PlatformDatabasesInitialPage",emptyStateParams:{$btn_text:"platformdatabases.create",$content:"platformdatabases.listheaderinfo",attributes:"platformdatabasebuttons purpose=getaddui"},emptyResult:"platformdatabase.search.none",searchElement:"platformdatabasessearch"},MessageActions:{initialTemplate:"MessageActionInitialPage",emptyStateParams:{$btn_text:"integration.actions.create",$content:"integration.actions.info",attributes:"messageactionbuttons purpose=add"},emptyResult:"messageactions.search.none",searchElement:"messageactionsearch"},Applications:{initialTemplate:"AppsInitialPage",emptyStateParams:{$btn_text:"integration.add.applications",$content:"integration.apps.info",attributes:"appbuttons purpose=createUI"},emptyResult:"apps.search.none",searchElement:"appsearch"}},isCurrent:function(e,t){if(!$WC.$Win.isExist("integrationwin"))return!1;if("undefined"!=typeof t&&"undefined"!=typeof t.currentTarget){var i=t.currentTarget.getAttribute("entity");if(e===i)return!0}var a=$("#IntegrationsRHS").children();return(0==a.length||$("#IntegrationsRHS").find('[list-view="true"]').length>0)&&Integration.getCurrentEntity()===e},initialize:function(e,t,i){if(0==t){var a=$WC.template.replace(Template.IntegrationsEmptyState,{create_btn:i?'<div {{attributes}} class="zcinab dbtn adbtn mrgT20">{{btn_text}}</div>':""},"InSecureHTML"),s=$.extend(!0,this.modules[e].emptyStateParams,{parent_attribute:"integrationlistview="+e});a=$WC.template.replace(a,s),$("#IntegrationsRHS").html(a)}else{var n=$("#IntegrationsRHS").find("[integrationlistview]");if(0===n.length||n.attr("integrationlistview")!==e){var r=this.modules[e].initialTemplate;$("#IntegrationsRHS").html($WC.template.replace(Template[r],{class_name:i?"wid80":"",hide_create_class:i?"":"dN"}));var o=IntegrationUI.listView.previousSearches[e];t>=10&&!$WC.$CUtil.isEmpty(o)&&$("#"+this.modules[e].searchElement).val(o)}var l=this.modules[e].searchElement;t>=10?($("#"+l+"container").removeClass("zcvsbhid"),$("#"+l).focus()):$("#"+l+"container").addClass("zcvsbhid")}$("#IntegrationsRHS")[0].firstChild.setAttribute("list-view",!0)},populate:function(e,t,i,a,s){var n=IntegrationUI.listView.previousSearches[e],r=$("#"+t);if(0===r.length){var o=this.modules[e].initialTemplate;$("#IntegrationsRHS").html($WC.template.replace(Template[o],{class_name:s?"wid80":""})),$("#IntegrationsRHS")[0].firstChild.setAttribute("list-view",!0),r=$("#"+t)}i=$.trim(i),$WC.$CUtil.isEmpty(i)&&(i='<div class="zcemptyste">'+Resource.getRealValue(this.modules[e].emptyResult,[$WC.$CUtil.processXSS(a)])+"</div>"),r.html(i),ZCScroll.resetScroll(r,!0),n!=a&&ZCScroll.scrollTop(r,0),$Util.initializeStickyTitle($("#IntegrationsRHS")),IntegrationUI.listView.previousSearches[e]=a},populateEmptyResult:function(e,t){var i=IntegrationUI.listView.previousSearches[e],a=$("#"+t);if(!a.children().length)if($WC.$CUtil.isEmpty(i))IntegrationUI.listView.initialize(e,0,SecurityManager.hasPermission(Modules[e],MActions.Create));else{var s='<div class="zcemptyste">'+Resource.getRealValue(this.modules[e].emptyResult,[$WC.$CUtil.processXSS(i)])+"</div>";a.html(s)}$Util.initializeStickyTitle($("#IntegrationsRHS"))}},handleModuleStatusChange:function(){Integration.isAnyPlatformComponentEnabled()?$("#ztb-setintegration").show():$("#ztb-setintegration").hide()}},IntegrationsCwin={chat:{},cwinImgDefaultPosition:{right:"339px",top:"89px"},cwinImgPositionInMinimize:{right:"70px",top:"20px"},html:'<div id="integrationscwin" class="zccmdcwincont zcmulticht zcchatwindow"><div id="tryanother" purpose="tryAnotherChat" integrationcwinbuttons class="posa font14 zcmdcht cur zcclr ellips" title="'+Resource.getRealValue("integration.cwin.tryanother")+'">'+Resource.getRealValue("integration.cwin.tryanother")+'</div><div id="integrations-chatsuggest" class="posa zcitsrcnt"><div class="msi-sp0 floatl"></div><div id="integrations-chatsuggest-search-field" tabindex="-1" contenteditable="true" placeholder="'+Resource.getRealValue("integration.try.search")+'" class="zcitsrch floatl font15"></div><div id="integrations-chatsuggest-results" class="zccmtsrc posa" style="display:none"></div></div><div id="integrationscwincont" class="height100"></div></div>',bindEvents:function(){$(document).on("click","[integrationcwinbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof IntegrationsCwin.handle[t]&&IntegrationsCwin.handle[t](this,e)}),SecurityManager.register(Modules.Integrations,IntegrationUI.handleModuleStatusChange)},isCurrent:function(e){if($WC.$Win.isExist("integrationwin")){if("chat"===this.chat.type)return this.chat.id==e;if("channel"===this.chat.type)return!$WC.$CUtil.isEmpty(Channels.getByChid(e))&&this.chat.id==e}return!1},init:function(e,t){if($("#integrationscwinimg").animate(this.cwinImgDefaultPosition,300,function(){$(this).hide().removeClass("zcbounceanim")}),$("#minimizebtn").attr("purpose","minimizeEditCode"),$("#integrationwin").addClass("zcmlwcmd"),$("#integrationscwin").show().removeClass("zccmdcwinhide"),"undefined"!=typeof t)return this.chat.id=t,this.chat.type="chat",void(ChatUI.isExist(t)?this.handleShow(t):MyBots.join(t));var i,a,s=$("#integrationscwincont").children()[0];if("undefined"==typeof e){if(!$WC.$CUtil.isEmpty(s))return void($("#addcommandui").length&&this.initAutoComplete.commands());i=MainUI.getAllOngoingChats()[0],i=$WC.$CUtil.isEmpty(i)?Object.keys(ChatsList.getAll())[0]:i,i=$WC.$CUtil.isEmpty(i)?ChatBot.getChid():i,a="chat"}else a=e.attr("elemtype"),i=e.attr("chid");$WC.$CUtil.isEmpty(s)||s.id==i||this.revertCwin(s.id),this.chat.id=i,this.chat.type=a,ChatUI.isExist(i)?this.handleShow(i):($("#integrationscwin").remove(),$("#IntegrationsRHS").after(this.html),$("#integrationscwincont").append('<div class="zcldng"></div>'),"channel"===a?Channels.handlejoin(i,!0):Chat.attachSession(i))},showLoading:function(e){if(0===$("#"+e).find("#loadingline").length){var t='<div id="loadingline" class="zcsugldprg"><div class="zcsugldlbrk"></div></div>';$("#"+e).find("#chatwindropdown").before(t)}},handle:{tryAnotherChat:function(e,t){Clickoutside.bind({srcid:"tryanother",destid:"integrations-chatsuggest",event:t,customShow:function(){$("#integrations-chatsuggest").animate({left:"0px"},300,function(){$("#integrations-chatsuggest-search-field").focus()})},customHide:function(){$("#integrations-chatsuggest").animate({left:"450px"},300),$("#integrations-chatsuggest-search-field").text("")}})},minimizeEditCode:function(){if(!$("#integrationscwinimg").length){var e=$("#integrationscwin").find("#userimage").html(),t=$('<div id="integrationscwinimg" integrationcwinbuttons class="cur zcmchimg zcmchtani"></div>');t.append(e),$("#IntegrationsRHS").after(t)}$("#integrationscwinimg").show().attr("purpose","maximizeEditCode").animate(IntegrationsCwin.cwinImgPositionInMinimize,300,function(){$(this).addClass("zcbounceanim")}),$("#minimizebtn").attr("purpose","maximizeEditCode"),$("#integrationwin").removeClass("zcmlwcmd"),$("#integrationscwin").addClass("zccmdcwinhide")},maximizeEditCode:function(){$("#integrationscwinimg").attr("purpose","minimizeEditCode").animate(IntegrationsCwin.cwinImgDefaultPosition,300,function(){$(this).hide().removeClass("zcbounceanim")}),$("#minimizebtn").attr("purpose","minimizeEditCode"),$("#integrationwin").addClass("zcmlwcmd"),$("#integrationscwin").removeClass("zccmdcwinhide")}},hide:function(){$("#integrationwin").removeClass("zcmlwcmd"),$("#integrationscwin").addClass("zccmdcwinhide").hide(),this.clearAutoComplete(this.chat.id)},close:function(){var e=this.chat.id;$WC.$CUtil.isEmpty(e)||(this.revertCwin(e),$("#integrationwin").removeClass("zcmlwcmd"),$("#integrationscwinimg").remove(),$("#integrationscwin").remove()),IntegrationUI.listView.previousSearches={}},revertCwin:function(e){this.chat={},this.clearAutoComplete(e),!$WC.$CUtil.isEmpty(e)&&$("#integrationscwincont").find("#"+e).length&&MainUI.revertToViewPort(e)},handleShow:function(e){var t=$("#integrationscwincont").children()[0];($WC.$CUtil.isEmpty(t)||t.id!=e)&&($("#"+e).show().find("#chatbody").css("height",""),$("#integrationscwin").remove(),$("#IntegrationsRHS").after(this.html),$("#integrationwin").addClass("zcmlwcmd"),MainUI.handleIframes(e),$("#integrationscwincont").append($("#"+e)),ChatUI.exist[e].getScrollDown(),ZCScroll.updateScroll($("#"+e).find("#chatbody")),SearchField.init("integrations-chatsuggest"));var i=$("#delugeeditorcontainer").attr("handlertype");"bots"===Integration.getCurrentEntity()&&i!=BotConstants.MESSAGEHANDLERS.MENTION?$("#tryanother").hide():$("#tryanother").show(),$("#addcommandui").length?this.initAutoComplete.commands():this.clearAutoComplete(e)},initAutoComplete:{commands:function(){var e="compautocomplete"+IntegrationsCwin.chat.id;if(!$("#"+e+"list").length){var t=$("#"+e);t.parents("#chatwindropdown").css("height",""),t.removeClass().addClass("chtedtrdrpdwn zcshortcut zchdcnt").html('<div id="'+e+'list" class="drpdwn srchglt"></div>');var i={listid:e+"list",srcid:"composer"+IntegrationsCwin.chat.id,destid:e,searchin:SearchAgent.COMMANDS,val:"*",limit:2};SearchAgent.search(i),t.find("#shortcut").append('<div purpose="search" elemtype="shortcut"><div class="zccmdeftxt zccmdblink">'+Resource.getRealValue("command.def.entry")+"</div></div>"),"none"===t.css("display")&&Clickoutside.bind({destid:e,customShow:function(){$("#"+e).slideDown()},customHide:function(){$("#"+e).slideUp(function(){$("#"+e).children().remove()})}})}},messageactions:function(e){var t=$($("#"+IntegrationsCwin.chat.id).find('[purpose="messageoperations"]')),i=t.length-2;if(!(0>i)){i=0>i?0:i;var a=$(t[i]),s=a.attr("id"),n=$("#optnslist"+s.substr(8));if("block"==n.css("display"))$(a.find("#msgactionautocompname")).html(e);else{var r={chid:IntegrationsCwin.chat.id,mtype:20,msginfo:"haslink:true",time:s.substring(s.lastIndexOf("_")+1),messageactionslimit:2,isviewonly:!0},o=MessageOperations.getOptionsHtml(r);if(t.length>0){var l=$(o);$(l.find(".zcapopt")).addClass("zcapoptfhover");var c=$(l.find("#msg-actions-results")).html();c=e,$(l.find("#msg-actions-results")).html(c),$($("#integrationscwin").find("#"+s)).html(l);var d=$("#"+IntegrationsCwin.chat.id).find("#chatbody"),u=$("#"+s),m=u.offset().top,p=d.offset().top,d=d.height(),h=n.height()/2;m-p>h&&d>m-p+h?n.parent().addClass("zcdrptop").removeClass("zcdrpbtm"):m-p>h&&m-p+h>d?n.parent().removeClass("zcdrptop").addClass("zcdrpbtm"):n.parent().removeClass("zcdrptop zcdrpbtm"),a.parent().addClass("zcopsel"),a.children().addClass("zcmsgopani"),Clickoutside.bind({srcid:s,destid:"optnslist"+s.substr(8),event:void 0,doNotClose:function(e,t,i){return t?void 0:"undefined"!=typeof i?$(i.target).attr("id")===s:!1},callback:function(){var e=$("#"+s);e.parent().removeClass("zcopsel"),e.children().removeClass("zcmsgopani")}})}}}}},clearAutoComplete:function(e){if("undefined"!=typeof e){var t=$("#compautocomplete"+e);t.hide().children().remove(),Composer.updateHelpTip(e,"msg","")}},handleKeyUp:{commands:function(e){0===$("#compautocomplete"+IntegrationsCwin.chat.id+"list").length&&IntegrationsCwin.initAutoComplete.commands(),$("#integrationwin").find(".zcfdk_tmbzoom").removeClass("zcfdk_tmbzoom");var t=e.target,i=$WC.$CUtil.processXSS($.trim($("#commandname").val())),a=$WC.$CUtil.processXSS($.trim($("#commandhint").val()));if(i.startsWith("/")&&(i=i.substring(1)),i.length>20||!$WC.Matcher.check("commandpattern",i))return void $("#commandname").addClass("zcfdk_tmbzoom");var s=$("#selectionlimit").val();if(!$WC.$CUtil.isEmpty(s)&&!/(^[1-9]|10)$/.test(s))return void $("#selectionlimit").addClass("zcfdk_tmbzoom");$WC.$CUtil.isEmpty(i)||(i=i.length>15?i.substring(0,14)+"...":i),$WC.$CUtil.isEmpty(a)||(a=a.length>15?a.substring(0,14)+"...":a);var n;n=$WC.$CUtil.isEmpty(i)&&$WC.$CUtil.isEmpty(a)?'<div purpose="search" elemtype="shortcut"><div class="zccmdeftxt zccmdblink">'+Resource.getRealValue("command.def.entry")+"</div></div>":CommandsUtil.searchhtml.replace(/{DISPNAME}/g,"/"+$Util.escapeReplacementString(i)).replace(/{IMGURL}/,Commands.getDefaultImgUrl()).replace(/{HINT}/g,$Util.escapeReplacementString(a)),$("#compautocomplete"+IntegrationsCwin.chat.id+"list").find('[elemtype="shortcut"]').last().replaceWith(n);var r=$("#compautocomplete"+IntegrationsCwin.chat.id+"list").find('[elemtype="shortcut"]').last();"commandhint"===document.activeElement.id?r.children().first().addClass("zccmdblink"):r.children().first().removeClass("zccmdblink"),"commandname"===document.activeElement.id?r.children().last().addClass("zccmdblink"):r.children().last().removeClass("zccmdblink");var o,l,c="",d=$(t),u=d.siblings("input");"key"===t.id?(o=d.val(),l=u.val()):(o=u.val(),l=d.val()),o=$WC.$CUtil.processXSS($.trim(o)),l=$WC.$CUtil.processXSS($.trim(l)),o=o.startsWith("-")?o.substring(1):o,"key"!==t.id||$WC.Matcher.check("commandpattern",o)?$WC.$CUtil.isEmpty(o)||$WC.$CUtil.isEmpty(l)?$WC.$CUtil.isEmpty(o)||(c="<strong>-"+o+"</strong> : "):c="<strong>-"+o+"</strong> : "+l:d.addClass("zcfdk_tmbzoom"),$WC.$CUtil.isEmpty(c)||$("#"+IntegrationsCwin.chat.id).find("#helptip").html(c)},messageactions:function(e){$("#integrationwin").find(".zcfdk_tmbzoom").removeClass("zcfdk_tmbzoom");var t=e.target,i=$.trim($("#messageactionname").val());if(i.length>20||!$WC.Matcher.check("textpattern",i))return void $("#messageactionname").addClass("zcfdk_tmbzoom");$WC.$CUtil.isEmpty(i)||(i=i.length>15?i.substring(0,14)+"...":i);var a,s,n=$(t),r=n.siblings("input");"key"===t.id?(a=n.val(),s=r.val()):(a=r.val(),s=n.val()),a=$.trim(a),s=$.trim(s),a=a.startsWith("-")?a.substring(1):a}},chatSuggestion:{chathistorysearchhtml:'<div id="GS{CHID}" elemtype="chat" purpose="search" chid="{CHID}" class="zcuserstatus withimg">{CHATIMAGE}<div class="userdetails zcunrdlt-txt floatl ellips"><span class="floatl ellips bold zcunrdtit" title="{TITLE}">{TITLENAME}<span></div></div>',channelsearchhtml:'<div id="channel{ID}" uid="{CHANNELID}" chid="{CHID}" elemtype="channel" purpose="search" class="zcsschlist"><span class="usrimgsts zcssimg floatl">{IMG}</span><div class="userdetails floatl"><span id="channelname{ID}" class="ellips zcunrdtit">{DNAMEVAL} </span></div></div>',search:function(e){var t=$("#integrations-chatsuggest-results");t.html('<div id="integrations-chatsuggest-list" class="hdrglobsrc"></div>');var i=[];if("chat"===IntegrationsCwin.chat.type)i.push(IntegrationsCwin.chat.id);else if("channel"===IntegrationsCwin.chat.type){var a=Channels.getByChid(IntegrationsCwin.chat.id);$WC.$CUtil.isEmpty(a)||i.push(a.oc_id)}var s=SearchAgent.search({searchin:SearchAgent.CHATS+SearchAgent.CHANNELS,val:e,chatshtml:this.chathistorysearchhtml,channelshtml:this.channelsearchhtml,channelcategory:ChannelsUI.List.RETRIVE_JOINED,replacecontentonsuccesscallback:!0,ignorelist:i,listid:"integrations-chatsuggest-list",successcallback:function(){0===t.find(".sel").length&&(t.find("[purpose='search']").first().addClass("sel"),ZCScroll.resetScroll($("#integrations-chatsuggest-list")))},clearcallback:function(){t.hide().find("#integrations-chatsuggest-list").empty()}});if(s){t.find("[purpose='search']").first().addClass("srchbn sel");var n="block"===t.css("display");n||Clickoutside.bind({srcid:"integrations-chatsuggest-search-field",destid:"integrations-chatsuggest-results"}),ZCScroll.scrollTop($("#integrations-chatsuggest-results"),0)}else this.clear(),t.empty().hide();ZCScroll.resetScroll($("#integrations-chatsuggest-list"))},handleAction:function(e,t,i){i&&t.length&&(Clickoutside.handleClickOnChild(e),IntegrationsCwin.init(t))},clear:function(){$("#integrations-chatsuggest-results").hide().find("#integrations-chatsuggest-list").empty(),Clickoutside.clear("integrations-chatsuggest-results")}}},IntegrationsUtil={handlerNameKeys:{0:"text",1:"link",2:"file",3:"event",4:"status",5:"welcome",8:"mention",9:"incomingwebhook",10:"context",1000:"execution",1001:"suggestion",2000:"function",2001:"form",2002:"form-onchange",2003:"form-values",3000:"install",3001:"incomingwebhook",3002:"installvalidator",3003:"uninstall",4000:"execution",5000:"scheduler",6000:"channel_outgoing"},getHandlerName:function(e,t){if("undefined"!=typeof this.handlerNameKeys[e])return Resource.getRealValue("integration.handler."+this.handlerNameKeys[e]);if(BotConstants.isActionType(e)){t.startsWith("b-")||(t="b-"+t);var i=BotExecutors.getByType(t,e);if("undefined"!=typeof i)return $Util.xssAndEscapeReplacementString(i.display_props.name)}}};var Applications={},ApplicationsUI={},ApplicationConstants={};Applications={previewData:{},init:function(){ApplicationsUI.bindEvents()},getAll:function(){return $DB.get("applications").list},getCount:function(){var e=this.getAll();return"undefined"==typeof e?0:Object.keys(e).length},getObject:function(e){return this.getAll()[e]},getImgUrlByStoreId:function(e){var t=this.getObjectByStoreId(e);return t&&t.photo_id?this.getImgUrlById(t.photo_id):this.getDefaultImgUrl()},getImgUrlById:function(e){return $WC.$CUtil.isEmpty(e)?this.getDefaultImgUrl():"/appimg/"+e+"/photo.do"},getDefaultImgUrl:function(){return Settings.isDarkModeChoosed()?$Util.getImgStaticUrl()+"/dark_cliqapp.svg":$Util.getImgStaticUrl()+"/cliqapp.png"},getDefaultChannelImgUrl:function(){return Settings.isDarkModeChoosed()?$Util.getImgStaticUrl()+"/dark_def_channelimage.svg":$Util.getImgStaticUrl()+"/def_channelimage.png"},getObjectByStoreId:function(e){var t=this.getAll();for(var i in t)if(t[i].store_appid==e)return t[i];return{}},getAppKey:function(e){var t=this.getObjectByStoreId(e);return $WC.$CUtil.isEmpty(t)?void 0:t.appsecretkey1||t.appsecretkey2||t.appsecretkey3},hasPermission:function(e){var t=this.getObjectByStoreId(e);return _isAppAccountAdmin()||WmsImpl.isLocalUser(""+t.installed_by)},hasAppInstallPermission:function(e){var t=this.getObjectByStoreId(e);return t.installpermission&ApplicationConstants.INSTALL_FROM_CLIQ},isInternalApp:function(e){var t=this.getObjectByStoreId(e);return t.installpermission&ApplicationConstants.INSTALL_FROM_INTERNAL},isExternalApp:function(e){var t=this.getObjectByStoreId(e);return t.installpermission&ApplicationConstants.INSTALL_FROM_EXTERNAL},deleteInObj:function(e){"undefined"!=typeof $DB.get("applications").list&&delete $DB.get("applications").list[e]},deleteAppEntities:function(e){Commands.deleteAppEntities(e),Bots.deleteAppEntities(e),Functions.deleteAppEntities(e),Schedulers.deleteAppEntities(e),PlatformDatabases.deleteAppEntities(e),MessageActions.deleteAppEntities(e),Channels.deleteAppEntities(e)},getByType:function(e,t){var i=this.getObject(e).handlers;if(!$WC.$CUtil.isEmpty(i))for(var a=0;a<i.length;a++){var s=i[a];if(s.type==t)return s}},store:function(e,t){t&&$DB.clear("applications");for(var i=$DB.get("applications"),a=i.list||{},s=function(e,t){for(var i in t)e[i]=t[i];return e},n=e.installedapplications,r=0,o=n.length;o>r;r++){var l=n[r],c=l.id;a[c]=a[c]||{},a[c]=s(a[c],l)}i.list=a,$DB.update("applications",i)},changeStatus:function(e,t){var i=$DB.get("applications"),a=i.list||{};for(var s in a)if(a[s].store_appid==e){a[s].status=t;break}i.list=a,$DB.update("applications",i);var n=Applications.previewData[e];"undefined"!=typeof n&&(n.status=t)},updateTime:function(e,t,i){var a=$DB.get("applications"),s=a.list||{};for(var n in s)if(s[n].store_appid==e){t&&(s[n].lmtime=t),i&&(s[n].published_time=i);break}a.list=s,$DB.update("applications",a)},storeComponents:function(e){Bots.store(e),Commands.store(e),MessageActions.store(e),Functions.updateStorage(e.functions),Schedulers.updateStorage(e.schedulers),PlatformDatabases.updateStorage(e.platformdatabases),Channels.updateData({joined:e.channels})},get:function(e){$ZCAjx.ajax({url:"/v1/applications",success:function(t){Applications.store(t.data,!0),ApplicationsUI.populate(),"function"==typeof e&&e()}})},removedComponentsFromClientDB:function(e,t){for(var i=Commands.getAppCommandIds(e),a=0;a<i.length;a++){var s=i[a];t.commands&&-1!==t.commands.indexOf(s)||Commands.deleteInObj(s)}for(var n=MessageActions.getAppMessageActionIds(e),a=0;a<n.length;a++){var r=n[a];t.messageactions&&-1!==t.messageactions.indexOf(r)||MessageActions.deleteInObj(r)}for(var o=Bots.getAppBotIds(e),a=0;a<o.length;a++){var l=o[a];t.bots&&-1!==t.bots.indexOf(l)||Bots.deleteInObj(l)}for(var c=Functions.getAppFunctionIds(e),a=0;a<c.length;a++){var d=c[a];t.functions&&-1!==t.functions.indexOf(d)||Functions.deleteInStorage(d)}for(var u=Schedulers.getAppSchedulerIds(e),a=0;a<u.length;a++){var m=u[a];t.schedulers&&-1!==t.schedulers.indexOf(m)||Schedulers.deleteInStorage(m)}for(var p=PlatformDatabases.getAppPlatformDatabaseIds(e),a=0;a<p.length;a++){var h=p[a];t.platformdatabases&&-1!==t.platformdatabases.indexOf(h)||PlatformDatabases.deleteInStorage(h)}for(var g=Channels.getAppChannelIds(e),a=0;a<g.length;a++){var f=g[a];t.channelslist&&-1!==t.channelslist.indexOf(f)||Channels.remove(f)}},edit:function(e,t){$ZCAjx.ajax({url:"/v1/applications/"+e,type:"PUT",contentType:"application/json",data:t,status:{loading:$("#IntegrationsRHS").find('[purpose="createOrEdit"]')},success:function(i){delete Applications.previewData[e],Applications.store({installedapplications:[i.data]});var a=Applications.getObjectByStoreId(e);a&&a.id&&UI.updateBanner(Resource.getRealValue("app.edited",[a.name])),Applications.removedComponentsFromClientDB(e,t),Applications.storeComponents(i.data),ApplicationsUI.show(!1,function(){Applications.preview(e)})}})},preview:function(e,t){var i=Applications.previewData[e];ApplicationsUI.myAppsPreview(e),$ZCAjx.ajax({url:"/v1/applications/"+e,success:function(a){var s=a.data.installedapplication;Applications.previewData[s.store_appid]=s,"function"==typeof t?t():("undefined"==typeof i||i.version!=s.version||i.status!=s.status)&&ApplicationsUI.myAppsPreview(e)}})},create:function(e){$ZCAjx.ajax({url:"/v1/applications",type:"POST",data:e,contentType:"application/json",status:{loading:$("#IntegrationsRHS").find('[purpose="createOrEdit"]')},success:function(e){Applications.store({installedapplications:[e.data]}),Applications.storeComponents(e.data),ApplicationsUI.show(!0),Applications.preview(e.data.store_appid),UI.updateBanner(Resource.getRealValue("app.created",[e.data.name]))}})},"delete":function(e){$ZCAjx.ajax({url:"/v1/applications/"+e,type:"DELETE",status:{loading:"common.loading",success:"app.deleted"},success:function(t){Applications.deleteInObj(t.data.id),ApplicationsUI.populate(),Applications.deleteAppEntities(e),Clickoutside.clear("myapppreview"+e),$("#myapppreview"+e).animate({left:"100%"},500,function(){$(this).remove()}),Clickoutside.clear("apppreview"+e),$("#apppreview"+e).animate({left:"100%"},500,function(){$(this).remove()})}})},unInstall:function(e){$ZCAjx.ajax({url:"/v1/applications/"+e+"/uninstall",type:"POST",status:{loading:"common.loading"},success:function(){var t=Applications.getObjectByStoreId(e);t&&t.id&&(UI.updateBanner(Resource.getRealValue("app.uninstalled",[t.name])),Applications.deleteInObj(t.id)),ApplicationsUI.populate(),Clickoutside.clear("myapppreview"+e),$("#myapppreview"+e).animate({left:"100%"},500,function(){$(this).remove()}),Clickoutside.clear("apppreview"+e),$("#apppreview"+e).animate({left:"100%"},500,function(){$(this).remove()})}})},enable:function(e){$ZCAjx.ajax({url:"/v1/applications/"+e+"/adminenable",type:"POST",status:{loading:"common.loading"},success:function(){var t=Applications.getObjectByStoreId(e);t&&t.id&&UI.updateBanner(Resource.getRealValue("app.enabled",[t.name])),Applications.changeStatus(e,ApplicationConstants.InstalledStatus.ACTIVATED),ApplicationsUI.repopulateAppInList(e),ApplicationsUI.repopulateInstalledAppActions(t)}})},disable:function(e){$ZCAjx.ajax({url:"/v1/applications/"+e+"/admindisable",type:"POST",status:{loading:"common.loading"},success:function(){var t=Applications.getObjectByStoreId(e);t&&t.id&&UI.updateBanner(Resource.getRealValue("app.disabled",[t.name])),Applications.changeStatus(e,ApplicationConstants.InstalledStatus.ADMIN_DISABLED),ApplicationsUI.repopulateAppInList(e),ApplicationsUI.repopulateInstalledAppActions(t)}})}};var AppChannels={installedAppPreviewhtml:'<div channelid="{ID}" appbuttons purpose="toggleSelection" class="zcappintl dsp_tble floatl sel"><div class="zchlistimg mrgT3"><div title="Select" class="msi-hissel posa"></div><img src="{IMGURL}"/></div><div class="dIB w70 mrgT5 zcapchvw"><div class="ellips">{NAME}</div><div class="ellips clr8">{DESC}</div></div></div>',getHTML:function(e,t){t=t.replace(/{NAME}/g,$Util.xssAndEscapeReplacementString(e.cn)).replace(/{DESC}/g,e.cd?$Util.xssAndEscapeReplacementString(e.cd):"").replace(/{ID}/g,e.channeluid?e.channeluid:"");var i=e.photoid?$zcg._SERVERURL+"/channel/"+e.photoid+"/photo.do":Applications.getDefaultChannelImgUrl();t=t.replace(/{IMGURL}/g,i);var a=e.appdetails&&e.appdetails.issandbox,s="";return(!e.appid||a)&&(s="/api/v2/channelsbyname/"+e.un+"/message"),t=t.replace(/{MESSAGEURL}/g,s)}};ApplicationsUI={sandboxAppListViewHtml:'<div id="{{store_appid}}" appbuttons purpose="myAppsPreview" appid="{{store_appid}}" class="tblerow"><div class="app_del"><img src="{{img_url}}"/></div><div class="txtleft">{{name}}</div><div>{{version}}</div><div class="txtleft ellips">{{desc}}</div><div class="appspublish ellips" title="{{edit_btn}}"><em appbuttons purpose="editUI" class="zcappsedit">{{edit_btn}}</em></div><div class="appspublish ellips">{{publish}}</div></div>',installedAppListViewHtml:'<div id="{{store_appid}}" appbuttons purpose="myAppsPreview" appid="{{store_appid}}" class="tblerow {{class_name}}"><div class="app_del"><img src="{{img_url}}"/></div><div class="txtleft">{{name}}</div><div>{{installed_for}}</div><div><span elemtype="user" hover="true" uid="{{installed_by}}" class="zctxthgh cur">{{installer_name}}</span></div><div>{{version}}</div><div class="appspublish ellips">{{version_updates}}</div><div class="appspublish ellips">{{button_actions}}</div></div>',show:function(e,t){e&&0==Applications.getCount()?$("#IntegrationsRHS").html('<span list-view="true" class="zcldng">'):this.populate(),e&&Applications.get(),"function"==typeof t&&t()},getIdFromElem:function(e){return e=$(e),$WC.$CUtil.isEmpty(e.attr("appid"))?e.parents("[appid]").attr("appid"):e.attr("appid")},searchTimer:void 0,bindEvents:function(){$(document).on("click","[appbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof ApplicationsUI.handle[t]&&ApplicationsUI.handle[t](ApplicationsUI.getIdFromElem(this),this,e)}),$(document).on("focus","[appinput]",function(e){$(e.target).removeClass("zcfdk_tmbzoom")}),$(document).on("keyup","[appsinput]",function(){clearTimeout(ApplicationsUI.searchTimer),ApplicationsUI.searchTimer=setTimeout(function(){ApplicationsUI.populate()},50)})},bindCreateEvents:function(e){e.find("#appphoto").on("change",function(){var e=$(this),t=e.siblings("#appdefimg"),i=$(this).siblings("[type='imgpreview']"),a=this.files[0],s=2;if("undefined"!=typeof a){if(!$Util.isValidImage(e,this.files,s))return;t.hide(),$Util.imgPrview(i,a)}}),e.find('[appchannelinput="photo"]').on("change",function(){var e=$(this),t=e.siblings('[appchannelinput="defimg"]'),i=$(this).siblings('[appchannelinput="preview"]'),a=this.files[0],s=2;if("undefined"!=typeof a){if(!$Util.isValidImage(e,this.files,s))return;t.hide(),$Util.imgPrview(i,a)}})},switchView:function(e,t,i){var a=$("#IntegrationsRHS");a.fadeOut(300,function(){a.html(e).fadeIn(300,function(){"function"==typeof i&&i(),$WC.$CUtil.isEmpty(t)||ZCScroll.customScroll($("#"+t),!0)})})},handle:{createUI:function(){var e=Template.EditApps.replace(/{HEADER}/,Resource.getRealValue("integration.add.applications")).replace(/{APPID}/g,"").replace(/{BUTTONTEXT}/g,Resource.getRealValue("common.create")).replace(/{NAME}/g,"").replace(/{DESC}/g,"").replace(/{PHOTO}/,"").replace(/{APPIMG}/g,Applications.getDefaultImgUrl()).replace(/{COMMANDS}/,SecurityManager.hasPermission(Modules.Commands)?$Util.escapeReplacementString(ApplicationsUI.getMyCommandsHTML()):"").replace(/{MESSAGEACTIONS}/,SecurityManager.hasPermission(Modules.MessageActions)?$Util.escapeReplacementString(ApplicationsUI.getMyMessageActionsHTML()):"").replace(/{BOTS}/,SecurityManager.hasPermission(Modules.Bots)?$Util.escapeReplacementString(ApplicationsUI.getMyBotsHTML()):"").replace(/{FUNCTIONS}/,SecurityManager.hasPermission(Modules.Functions)?$Util.escapeReplacementString(ApplicationsUI.getMyFunctionsHTML()):"").replace(/{SCHEDULERS}/,SecurityManager.hasPermission(Modules.Schedulers)?$Util.escapeReplacementString(ApplicationsUI.getMySchedulersHTML()):"").replace(/{PLATFORMDATABASES}/,SecurityManager.hasPermission(Modules.PlatformStorages)?$Util.escapeReplacementString(ApplicationsUI.getMyPlatformDatabasesHTML()):"").replace(/{CHANNELS}/,$Util.escapeReplacementString(ApplicationsUI.getChannelsHTML(4)));ApplicationsUI.switchView(e,"editappui",function(){ApplicationsUI.bindCreateEvents($("#editappui")),$("#appname").focus()})},editUI:function(e,t,i){Clickoutside.handleClickOnChild(i);var a=Applications.getObjectByStoreId(e),s=Template.EditApps.replace(/{HEADER}/,Resource.getRealValue("integration.edit.applications")).replace(/{APPID}/g,e).replace(/{BUTTONTEXT}/g,Resource.getRealValue("common.save")).replace(/{NAME}/g,$Util.xssAndEscapeReplacementString(a.name)).replace(/{DESC}/g,$Util.xssAndEscapeReplacementString(a.description)).replace(/{APPIMG}/g,Applications.getDefaultImgUrl()).replace(/{PHOTO}/,a.photo_id?'<img src="'+Applications.getImgUrlById(a.photo_id)+'"/>':"").replace(/{COMMANDS}/,$Util.escapeReplacementString(ApplicationsUI.getMyCommandsHTML(e))).replace(/{MESSAGEACTIONS}/,$Util.escapeReplacementString(ApplicationsUI.getMyMessageActionsHTML(e))).replace(/{BOTS}/,$Util.escapeReplacementString(ApplicationsUI.getMyBotsHTML(e))).replace(/{FUNCTIONS}/,$Util.escapeReplacementString(ApplicationsUI.getMyFunctionsHTML(e))).replace(/{SCHEDULERS}/,$Util.escapeReplacementString(ApplicationsUI.getMySchedulersHTML(e))).replace(/{PLATFORMDATABASES}/,$Util.escapeReplacementString(ApplicationsUI.getMyPlatformDatabasesHTML(e))).replace(/{CHANNELS}/,$Util.escapeReplacementString(ApplicationsUI.getChannelsHTML(4,e)));ApplicationsUI.switchView(s,"editappui",function(){var t=$("#editappui");ApplicationsUI.bindCreateEvents(t),$("#appname").attr("readonly","").focus();for(var i=Commands.getAppCommandIds(e),a=0;a<i.length;a++)t.find('[commandid="'+i[a]+'"]').addClass("sel").find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld");for(var s=MessageActions.getAppMessageActionIds(e),a=0;a<s.length;a++)t.find('[messageactionid="'+s[a]+'"]').addClass("sel").find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld");for(var n=Bots.getAppBotIds(e),r=0;r<n.length;r++)t.find('[botid="'+n[r]+'"]').addClass("sel").find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld");for(var o=Functions.getAppFunctionIds(e),l=0;l<o.length;l++)t.find('[functionid="'+o[l]+'"]').addClass("sel").find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld");for(var c=Schedulers.getAppSchedulerIds(e),l=0;l<c.length;l++)t.find('[schedulerid="'+c[l]+'"]').addClass("sel").find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld");for(var d=PlatformDatabases.getAppPlatformDatabaseIds(e),l=0;l<d.length;l++)t.find('[platformdatabaseid="'+d[l]+'"]').addClass("sel").find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld");t.find("#installedappchannels").find("[channelid]").addClass("sel").find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld")})},toggleSelection:function(e,t){$(t).hasClass("sel")?($(t).removeClass("sel"),$(t).find(".msi-hisseld").removeClass("msi-hisseld").addClass("msi-hissel")):($(t).addClass("sel"),$(t).find(".msi-hissel").removeClass("msi-hissel").addClass("msi-hisseld"))},createOrEdit:function(e,t,i){$WC.$CUtil.isEmpty(e)?this.create():this.edit(e,t,i)},create:function(){var e=ApplicationsUI.validateAndGetParams();$WC.$CUtil.isEmpty(e)||Applications.create(e)},edit:function(e){var t=ApplicationsUI.validateAndGetParams(e);$WC.$CUtil.isEmpty(t)||Applications.edit(e,t)},savePublisherDetails:function(e){var t=ApplicationsUI.validateAndGetPublisherDetails(e);t.name=Applications.previewData[e].name,$WC.$CUtil.isEmpty(t)||Applications.edit(e,t)},saveInstallationDetails:function(e){var t={};t.installpermission=ApplicationsUI.getInstallationDetails(),t.infoedit=!0,t.name=Applications.getObjectByStoreId(e).name,$WC.$CUtil.isEmpty(t)||(Applications.edit(e,t),$("#appinstlbtn").remove())},"delete":function(e,t,i){var a=Applications.getObjectByStoreId(e).name;$WC.$Dlg.create({id:"disableapp",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="msi-zohoaps clr-red"></div>',header:Resource.getRealValue("apps.delete.confirm",[$WC.$CUtil.processXSS(a)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("app.delete.info1"),Resource.getRealValue("app.delete.info2")]}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Applications.delete(e),Clickoutside.handleClickOnChild(i)}}]})},unInstall:function(e,t,i){var a=Applications.getObjectByStoreId(e),s=[{text:Resource.getRealValue("app.uninstall.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Applications.unInstall(e),Clickoutside.handleClickOnChild(i)}}];a.status!==ApplicationConstants.InstalledStatus.ADMIN_DISABLED&&s.push({text:Resource.getRealValue("app.disable.instead"),colour:$WC.$Dlg.GREY_BUTTON,action:function(){Applications.disable(e),Clickoutside.handleClickOnChild(i)}}),$WC.$Dlg.create({id:"uninstallapp",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="msi-zohoaps clr-red"></div>',header:Resource.getRealValue("app.uninstall.header",[$WC.$CUtil.processXSS(a.name)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("app.uninstall.info1"),Resource.getRealValue("app.uninstall.info2")]}),buttons:s})},disable:function(e){var t=Applications.getObjectByStoreId(e).name;$WC.$Dlg.create({id:"disableapp",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="msi-zohoaps clr-red"></div>',header:Resource.getRealValue("app.disable.header",[$WC.$CUtil.processXSS(t)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("app.disable.info1"),Resource.getRealValue("app.disable.info2"),Resource.getRealValue("app.disable.info3")]}),buttons:[{text:Resource.getRealValue("app.disable.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Applications.disable(e)}}]})},enable:function(e){Applications.enable(e)},previewFromChat:function(e){IntegrationUI.init(Integration.Modules.Applications);var t=Applications.getObjectByStoreId(e);$WC.$CUtil.isEmptyObject(t)?ApplicationsUI.show(!1,function(){Applications.preview(e)}):Applications.preview(e)},myAppsPreview:function(e,t,i){"user"===$(i.target).attr("elemtype")||"A"==i.target.tagName||$(i.target).parents("a").length>0||IntegrationUI.hasPrevWin&&e===$("#Integrationspreview").attr("appid")||Applications.preview(e)},createAppkey:function(e,t){$(t).attr("keyindex");$ZCAjx.ajax({url:"/v1/applications/"+e+"/generateappkey",type:"POST",status:{loading:"common.loading",success:"apps.appkey.generated"},success:function(t){t&&t.data&&t.data.success&&(Applications.previewData[e]["appsecretkey"+t.data.appkeyindex]=t.data.appkey,ApplicationsUI.repopulateSandboxAppKeys(Applications.previewData[e]))}})},deleteAppkey:function(e,t){var i=$(t).attr("keyindex");$WC.$Dlg.confirm({id:"deleteappkey",bodyhtml:Resource.getRealValue("apps.deleteappkey.confirm",[Resource.getRealValue("app.appkey")]),imagehtml:'<div class="msi-zohoaps clr6 textcent"></div>',buttons:[{text:Resource.getRealValue("apps.deleteappkey.goahead"),action:function(){var t={appkeyindex:i};$ZCAjx.ajax({url:"/v1/applications/"+e+"/deleteappkey",type:"POST",data:t,status:{loading:"common.loading",success:"apps.appkey.deleted"},contentType:"application/json",success:function(t){t&&t.data&&t.data.success&&(delete Applications.previewData[e]["appsecretkey"+t.data.appkeyindex],ApplicationsUI.repopulateSandboxAppKeys(Applications.previewData[e]))}})}}]})},createHandler:function(e,t,i,a){"undefined"==typeof a&&(a=$(t).parent().attr("type"));var s={componentid:e,type:a};Executions.create(s,function(t){var i=Applications.getObjectByStoreId(e);i.module=Integration.Modules.Applications,DREImpl.handleEditCode(i,i.id,a),"undefined"==typeof i.handlers&&(i.handlers=[]),i.handlers.push(t.data);var s=Applications.previewData[e];"undefined"!=typeof s&&(s.handlers=i.handlers)})},editHandler:function(e,t,i){Clickoutside.handleClickOnChild(i);var a=$(t).parent().attr("type"),s=Applications.getObjectByStoreId(e);s.module=Integration.Modules.Applications,DREImpl.handleEditCode(s,s.id,a)},deleteHandler:function(e,t){var i=$(t).parent().attr("type");$WC.$Dlg.confirm({id:"deleteapphandler",bodyhtml:Resource.getRealValue("apps.deletehandler.confirm",[IntegrationsUtil.getHandlerName(i)]),imagehtml:'<div class="msi-zohoaps clr6 textcent"></div>',buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),action:function(){var t=Applications.getObjectByStoreId(e);Executions.delete(t.id,i,function(i){for(var a=i.data.type,s=0;s<t.handlers.length;s++)if(a==t.handlers[s].type){t.handlers.splice(s,1);break}var n=Applications.previewData[e];if("undefined"!=typeof n&&"undefined"!=typeof n.handlers)for(var s=0;s<n.handlers.length;s++)if(a==n.handlers[s].type){n.handlers.splice(s,1);break}ApplicationsUI.repopulateSandboxAppHandlers(n)})}}]})},hideComponentsPreview:function(e,t,i){i.stopPropagation(),$(i.target).attr("purpose","showComponentsPreview").text(Resource.getRealValue("app.show.more")),$("#installedcomponents").slideUp()},showComponentsPreview:function(e,t,i){i.stopPropagation(),$(i.target).attr("purpose","hideComponentsPreview").text(Resource.getRealValue("app.show.less")),$("#installedcomponents").slideDown()}},repopulateAppInList:function(e){if(0!=$("#appsearch").length){var t,i=$("#appsearch").val().toLowerCase(),a=Applications.getObjectByStoreId(e);t=a.scope===ApplicationConstants.PRIVATESCOPE?this.getSandboxAppListHtml(a,i):this.getInstalledAppListHtml(a,i),$('[purpose="myAppsPreview"][appid="'+e+'"]').replaceWith(t)}},populate:function(){if($WC.$Win.isExist("integrationwin")&&Integration.getCurrentEntity()===Integration.Modules.Applications){var e=Applications.getCount();if(IntegrationUI.listView.initialize(Integration.Modules.Applications,e,SecurityManager.hasPermission(Modules.Applications,MActions.Create)),0===e)return;var t=Applications.getAll(),i=$("#appsearch").val();"undefined"!=typeof i&&(i=i.trim().toLowerCase());var a=[];for(var s in t){var n=t[s];("undefined"==typeof i||-1!=n.name.toLowerCase().indexOf(i))&&a.push([s,n.name])}a=$Util.sortString(a,1,!1);for(var r="",o="",l=0;l<a.length;l++){var c=a[l][0],n=t[c];n.scope===ApplicationConstants.PRIVATESCOPE?o+=this.getSandboxAppListHtml(n,i):r+=this.getInstalledAppListHtml(n,i)}var d="";if(!$WC.$CUtil.isEmpty(o)){var u='<div id="mybetaappsheader" zc_running_title class="zcinhds font16 bold paddT10 floatl posl">{{header}}</div><div id="mybetaapps" class="zcinchls mrgB20"><div class="dsp_tble"><div class="tblerow zappsheader fntbld"><div></div><div class="txtleft">{{name}}</div><div>{{published_version}}</div><div>{{desc}}</div><div></div><div></div></div>{{appslist}}</div></div>';u=$WC.template.replace(u,{$header:"app.myapps",$name:"common.name",$desc:"common.desc",$published_version:"app.pub.version"}),d+=$WC.template.replace(u,{appslist:o},"InSecureHTML")}if(!$WC.$CUtil.isEmpty(r)){var m='<div id="orgappsheader" zc_running_title class="zcinhds font16 bold paddT10 floatl posl mrgB20">{{header}}</div><div id="allapps" class="zcinchls"><div class="dsp_tble zcinstlapps"><div class="tblerow zappsheader fntbld"><div></div><div class="txtleft">{{name}}</div><div>{{inst_to}}</div><div>{{inst_by}}</div><div>{{version}}</div><div>{{new_updates}}</div><div></div></div>{{appslist}}</div></div>';m=$WC.template.replace(m,{$header:"app.installedapps",$name:"common.name",$inst_to:"app.install.to",$inst_by:"app.install.by",$version:"app.version",$new_updates:"app.updates"}),d+=$WC.template.replace(m,{appslist:r},"InSecureHTML")}$WC.$CUtil.isEmpty(d)&&(d='<div class="zcemptyste">'+Resource.getRealValue("apps.search.none",$Util.xssAndEscapeReplacementString(i))+"</div>"),IntegrationUI.listView.populate(Integration.Modules.Applications,"myappslist",d,i,SecurityManager.hasPermission(Modules.Applications,MActions.Create))}},getSandboxAppListHtml:function(e,t){var i=this.sandboxAppListViewHtml,a={};if(e.published_time<e.lmtime&&(a.publish='<a target="_blank" href="/publishapp.do?id={{store_appid}}"><em title="{{push_store}}">{{push_store}}</em></a>'),!$WC.$CUtil.isEmpty(t)){var s=new RegExp($WC.Matcher.replace("escaperegexp",t),"i");a.name=$WC.$CUtil.processXSS(e.name).replace(s,'<b class="zcclr">$&</b>')}i=$WC.template.replace(i,a,"InSecureHTML");var n={name:e.name,desc:e.description,img_url:Applications.getImgUrlById(e.photo_id),store_appid:""+e.store_appid,$edit_btn:"common.edit",$push_store:"app.push.store",$publish:"app.nochanges"};return e.version>=1?n.version=""+$Util.toFixedDecimalPoints(e.version,1,2):n.$version="app.yetto.publish",$WC.template.replace(i,n)},getInstalledAppListHtml:function(e,t){var i=this.installedAppListViewHtml,a={},s={name:e.name,desc:e.description,img_url:Applications.getImgUrlById(e.photo_id),store_appid:""+e.store_appid,version:""+$Util.toFixedDecimalPoints(e.version,1,2),installed_by:e.installed_by,installer_name:Users.getName(""+e.installed_by,e.installer_name),class_name:e.status!=ApplicationConstants.InstalledStatus.ACTIVATED?"zcapps-disable":"",$edit_btn:"common.edit",$push_store:"app.push.store",$publish:"app.nochanges",$btn_text:"common.view",$latest_version:["app.available",""+$Util.toFixedDecimalPoints(e.latest_version,1,2)],$installed_for:e.scope==ApplicationConstants.ORGSCOPE?"app.installed.public":["app.installed.team",e.team_names[e.teamids[0]]]};if(!$WC.$CUtil.isEmpty(t)){var n=new RegExp($WC.Matcher.replace("escaperegexp",t),"i");a.name=$WC.$CUtil.processXSS(e.name).replace(n,'<b class="zcclr">$&</b>')}var r="";return Applications.hasPermission(e.store_appid)&&!Applications.isInternalApp(e.store_appid)&&SecurityManager.hasPermission(Modules.Applications,MActions.Install)&&(e.status==ApplicationConstants.InstalledStatus.ACTIVATED?(r='<em appbuttons purpose="disable" class="zcappsdisable" title="{{btn_text}}">{{btn_text}}</em>',s.$btn_text="common.disable"):e.status==ApplicationConstants.InstalledStatus.ADMIN_DISABLED?(r='<em appbuttons purpose="enable" title="{{btn_text}}">{{btn_text}}</em>',s.$btn_text="common.enable"):e.status==ApplicationConstants.InstalledStatus.INSTALLED&&(r='<a target="_blank" href="/installapp.do?id={{store_appid}}" class="zcclr cur"><em title="{{btn_text}}">{{btn_text}}</em></a>',s.$btn_text="app.activate")),a.button_actions=r,SecurityManager.hasPermission(Modules.Applications,MActions.Install)?e.latest_version>e.version?a.version_updates='<a target="_blank" href="/installapp.do?id={{store_appid}}" class="zcclr cur"><em title="{{latest_version}}">{{latest_version}}</em></a>':s.$version_updates="app.uptodate":s.$version_updates="-",Contacts.isExist(e.installed_by)&&(s.installer_name=Contacts.getDisplayName(e.installed_by)),i=$WC.template.replace(i,a,"InSecureHTML"),$WC.template.replace(i,s)},validateAndGetPublisherDetails:function(){var e=$("#Integrationspreview"),t=e.attr("appid"),i={},a=e.find('[data-val="dev_name"]').val();if(!a)return void e.find('[data-val="dev_name"]').addClass("zcfdk_tmbzoom");i.developed_by=a;var s=e.find('[data-val="dev_email"]').val();if(!s)return void e.find('[data-val="dev_email"]').addClass("zcfdk_tmbzoom");i.emailid=s;var n=e.find('[data-val="terms"]').val();n&&(i.terms_of_service_link=n);var r=e.find('[data-val="privacy_policy"]').val();r&&(i.privacy_policy_link=r);var o=e.find('[data-val="support_center"]').val();o&&(i.website=o);Applications.previewData[t];return i.infoedit=!0,$Util.checkAndRemoveUndefinedKeys(i)},validateAndGetParams:function(e){var t=$("#editappui"),i=$("#appname").val();if(i=$.trim(i),$WC.$CUtil.isEmpty(i)||i.length>20)return $("#appname").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#appname-header"),t,200);var a=$("#appdesc").val();if(a=$.trim(a),$WC.$CUtil.isEmpty(a))return $("#appdesc").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#appdesc-header"),t,200);"undefined"!=typeof e&&(i=e.name!=i?i:void 0,a=e.desc!=a?a:void 0);var s=$("#appphoto").siblings("[type='imgpreview']").find("img").attr("src");s=!$WC.$CUtil.isEmpty(s)&&s.startsWith("data:")?s:void 0;for(var n=$("#appcommands").find("[commandid].sel"),r=[],o=0;o<n.length;o++)if(r.push($(n[o]).attr("commandid")),r.length>4)return UI.updateBanner(Resource.getRealValue("apps.commands.limit"),2e3,!0),void $Util.scrollToViewportTop($("#appcommands"),t,200);for(var l=$("#appmessageactions").find("[messageactionid].sel"),c=[],o=0;o<l.length;o++)if(c.push($(l[o]).attr("messageactionid")),c.length>4)return UI.updateBanner(Resource.getRealValue("apps.messageactions.limit"),2e3,!0),void $Util.scrollToViewportTop($("#appmessageactions"),t,200);for(var d=$("#appbots").find("[botid].sel"),u=[],o=0;o<d.length;o++)if(u.push($(d[o]).attr("botid")),u.length>4)return UI.updateBanner(Resource.getRealValue("apps.bots.limit"),2e3,!0),void $Util.scrollToViewportTop($("#appbots"),t,200);for(var m=$("#appfunctions").find("[functionid].sel"),p=[],o=0;o<m.length;o++)if(p.push($(m[o]).attr("functionid")),p.length>20)return UI.updateBanner(Resource.getRealValue("apps.functions.limit"),2e3,!0),void $Util.scrollToViewportTop($("#appfunctions"),t,200);for(var h=$("#appschedulers").find("[schedulerid].sel"),g=[],o=0;o<h.length;o++)if(g.push($(h[o]).attr("schedulerid")),g.length>4)return UI.updateBanner(Resource.getRealValue("apps.schedulers.limit"),2e3,!0),void $Util.scrollToViewportTop($("#appschedulers"),t,200);for(var f=$("#appplatformdatabases").find("[platformdatabaseid].sel"),v=[],o=0;o<f.length;o++)if(v.push($(f[o]).attr("platformdatabaseid")),v.length>6)return UI.updateBanner(Resource.getRealValue("apps.platformdatabases.limit"),2e3,!0),void $Util.scrollToViewportTop($("#appplatformdatabases"),t,200);for(var C=$("#installedappchannels").find("[channelid].sel"),y=[],o=0;o<C.length;o++)y.push($(C[o]).attr("channelid"));var b={name:i,description:a,image:s},E=this.validateAndGetChannels();return E.isValid?0==r.length&&0==c.length&&0==u.length&&0==p.length&&0==g.length&&0==v.length&&0==y.length&&$WC.$CUtil.isEmpty(E.channels)?void UI.updateBanner(Resource.getRealValue("app.invalid.components"),3e3,!0):(r.length>0&&(b.commands=JSON.stringify(r)),c.length>0&&(b.messageactions=JSON.stringify(c)),u.length>0&&(b.bots=JSON.stringify(u)),p.length>0&&(b.functions=JSON.stringify(p)),g.length>0&&(b.schedulers=JSON.stringify(g)),v.length>0&&(b.platformdatabases=JSON.stringify(v)),y.length>0&&(b.channelslist=JSON.stringify(y)),$WC.$CUtil.isEmpty(E.channels)||(b.channels=E.channels),$Util.checkAndRemoveUndefinedKeys(b)):void $Util.scrollToViewportTop($("#appchannels"),t,200)},validateAndGetChannels:function(){for(var e=$("#appchannels"),t=e.children("[appchannel]"),i=[],a=!1,s=0;s<t.length;s++){var n=$.trim($(t[s]).find('[appchannelinput="name"]').val()),r=$.trim($(t[s]).find('[appchannelinput="desc"]').val());if(!$WC.$CUtil.isEmpty(n)){if(n.length>30){a=!0,$(t[s]).find('[appchannelinput="name"]').addClass("zcfdk_tmbzoom");continue}$WC.$CUtil.isEmpty(r)&&(a=!0,$(t[s]).find('[appchannelinput="desc"]').addClass("zcfdk_tmbzoom"));var o={name:n,description:r},l=$(t[s]).find('[appchannelinput="preview"]').find("img").attr("src");!$WC.$CUtil.isEmpty(l)&&l.startsWith("data:")&&(o.image=l),i.push(o)}}return{isValid:!a,channels:i.length>0?JSON.stringify(i):void 0}},getInstallationDetails:function(){var e=document.getElementById("Integrationspreview"),t=0,i=e.querySelector('[purpose="install_from_external"]');i&&i.checked&&(t+=ApplicationConstants.INSTALL_FROM_EXTERNAL);var a=e.querySelector('[purpose="install_from_cliq"]');return a&&a.checked&&(t+=ApplicationConstants.INSTALL_FROM_CLIQ),t},getMyCommandsHTML:function(e){for(var t="",i=Commands.getAll(),a=CommandsUtil.sortByName(i),s=0;s<a.length;s++){var n=a[s];if(n>0&&Commands.isMyCommand(n)){if(i[n].appid&&i[n].appid!=e)continue;t+=CommandsUI.getHTML(Commands.getObject(n),CommandsUI.appviewhtml)}}return $WC.$CUtil.isEmpty(t)||(t='<div class="zcincmli mrgT25"><div class="bold font16 mrgT25">'+Resource.getRealValue("integration.commands")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("apps.commands.select")+'</div><div id="appcommands" class="zcincmt font15 zcbotin zcbtmnuin mrgT15">'+t+"</div></div>"),t},getMyMessageActionsHTML:function(e){for(var t="",i=MessageActions.getAll(),a=MessageActionsUtil.sortByName(i),s=0;s<a.length;s++){var n=a[s];if(MessageActions.isMyMessageAction(n)){if(i[n].appid&&i[n].appid!=e)continue;t+=MessageActionsUI.getHTML(i[n],MessageActionsUI.appviewhtml)}}return $WC.$CUtil.isEmpty(t)||(t='<div class="zcincmli mrgT25"><div class="bold font16 mrgT25">'+Resource.getRealValue("integration.messageaction.title")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("apps.messageactions.select")+'</div><div id="appmessageactions" class="zcincmt font15 zcbotin zcbtmnuin mrgT15">'+t+"</div></div>"),t},getMyBotsHTML:function(e){for(var t="",i=Bots.getAll(!0),a=0;a<i.length;a++){var s=i[a];if(Bots.isCreatedByMe(s)){var n=Bots.getObject(s);if(n.appid&&n.appid!=e)continue;t+=BotsUI.getHTML(s,BotsUI.appviewhtml)}}return $WC.$CUtil.isEmpty(t)||(t='<div class="zcincmli mrgT25"><div class="bold font16 mrgT25">'+Resource.getRealValue("bots.title")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("apps.bots.select")+'</div><div id="appbots" class="zcincmt font15 zcbotin zcbtmnuin mrgT15">'+t+"</div></div>"),t},getMyFunctionsHTML:function(e){for(var t="",i=Functions.getAllIds(),a=0;a<i.length;a++){var s=Functions.getObject(i[a]),n=s.id;if(sandboxhtml=Functions.isFromSandBox(n)?'<span class="clr6"> ('+Resource.getRealValue("app.sandbox")+")</span>":"",Functions.isCreatedByMe(n)){if(s.appid&&s.appid!=e)continue;t+=$WC.template.replace($WC.template.replace(FunctionsUI.appViewHTML,{SANDBOXTEXT:sandboxhtml},"InSecureHTML"),{NAME:s.name,DESC:s.description,FUNCTIONID:n})}}return $WC.$CUtil.isEmpty(t)||(t='<div class="zcincmli mrgT25"><div class="bold font16 mrgT25">'+Resource.getRealValue("functions.title")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("apps.functions.select")+'</div><div id="appfunctions" class="zcincmt font15 zcbotin zcbtmnuin mrgT15">'+t+"</div></div>"),t},getMySchedulersHTML:function(e){for(var t="",i=Schedulers.getAllIds(),a=0;a<i.length;a++){var s=Schedulers.getObject(i[a]),n=s.id;if(sandboxhtml=Schedulers.isFromSandBox(n)?'<span class="clr6"> ('+Resource.getRealValue("app.sandbox")+")</span>":"",Schedulers.isCreatedByMe(n)){if(s.appid&&s.appid!=e)continue;t+=$WC.template.replace($WC.template.replace(SchedulersUI.appViewHTML,{SANDBOXTEXT:sandboxhtml},"InSecureHTML"),{NAME:s.name,DESC:s.description,SCHEDULERID:n})}}return $WC.$CUtil.isEmpty(t)||(t='<div class="zcincmli mrgT25"><div class="bold font16 mrgT25">'+Resource.getRealValue("schedulers.title")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("apps.schedulers.select")+'</div><div id="appschedulers" class="zcincmt font15 zcbotin zcbtmnuin mrgT15">'+t+"</div></div>"),t},getMyPlatformDatabasesHTML:function(e){for(var t="",i=PlatformDatabases.getAllIds(),a=0;a<i.length;a++){var s=PlatformDatabases.getObject(i[a]),n=s.id;if(sandboxhtml=PlatformDatabases.isFromSandBox(n)?'<span class="clr6"> ('+Resource.getRealValue("app.sandbox")+")</span>":"",PlatformDatabases.isCreatedByMe(n)){if(s.appid&&s.appid!=e)continue;t+=$WC.template.replace($WC.template.replace(PlatformDatabasesUI.appViewHTML,{SANDBOXTEXT:sandboxhtml},"InSecureHTML"),{NAME:s.display_name,DESC:s.description,PLATFORMDATABASEID:n})}}return $WC.$CUtil.isEmpty(t)||(t='<div class="zcincmli mrgT25"><div class="bold font16 mrgT25">'+Resource.getRealValue("platformdatabases.title")+'</div><div class="lin22 mrgT5">'+Resource.getRealValue("apps.platformdatabases.select")+'</div><div id="appplatformdatabases" class="zcincmt font15 zcbotin zcbtmnuin mrgT15">'+t+"</div></div>"),t},getChannelsHTML:function(e,t){var i=[],a="";if(!$WC.$CUtil.isEmpty(t)){i=Channels.getAppChannelIds(t);for(var s=0;s<i.length;s++)a+=AppChannels.getHTML(Channels.getObject(i[s]),AppChannels.installedAppPreviewhtml);a='<div id="installedappchannels" class="zcinsappchls">'+a+"</div>"}for(var n="",s=0;s<e-i.length;s++){var r='<div appchannel class="zcappchls"><div class="zcgpimgcnt posrel zvtam"><div width="50px" height="50px" type="imgpreview" appchannelinput="preview" class="zchimg"></div><div appchannelinput="defimg" class="zcrtgrpimg"><img src="'+Applications.getDefaultChannelImgUrl()+'"></div><input appchannelinput="photo" type="file" class="sendfile" accept="image/*"/><div class="zchangeimg zcbotimg font10 dN posa">'+Resource.getRealValue("common.change")+'</div></div><input appchannelinput="name" appinput type="text" class="mtext padd5 mrgL10 mrgR20" maxlength="30" placeholder="'+Resource.getRealValue("app.channel.name")+'"><input appchannelinput="desc" appinput type="text" maxlength="100" class="mtext zcmtxt padd5 mrgL10 mrgR20" placeholder="'+Resource.getRealValue("app.channel.desc")+'"></div>';n+=r}return a+n},myAppsPreview:function(e){if(0!=$("#myappslist").length){var t,i=Applications.previewData[e];"undefined"==typeof i?(i=Applications.getObjectByStoreId(e),t=i.issandbox?this.getSandboxAppPreviewLoadingHTML(i):this.getInstalledAppPreviewLoadingHTML(i)):t=i.issandbox?this.getSandboxAppPreviewHTML(i):this.getInstalledAppPreviewHTML(i),IntegrationUI.preview("appid",e,t,void 0,function(){if(i.issandbox){var e=$("#Integrationspreview");e.on("click","[appsubheaders]",function(t){var a=t.target,s=$("#Integrationspreview");s.find(".curpage").removeClass("curpage"),$(a).addClass("curpage");var n=s.find("#appcontainer");s.find("#appinstlbtn").remove(),n.html(ApplicationsUI[a.getAttribute("purpose")+"Html"](s.attr("appid"))),"getPublisherDetails"===a.getAttribute("purpose")?ApplicationsUI.updatePublisherDetails(s):"getOverview"===a.getAttribute("purpose")&&(ApplicationsUI.updateInstallPermission(i.store_appid),ApplicationsUI.bindInstallationBtnEvnt(e)),ZCScroll.resetScroll($("#appcontainer"),!0)}),i.published_time&&-1!==i.published_time?(ApplicationsUI.updateInstallPermission(i.store_appid),ApplicationsUI.bindInstallationBtnEvnt(e)):e.find('[purpose="getPublisherDetails"]').hide()}ZCScroll.customScroll($("#appcontainer"),!0)})}},bindInstallationBtnEvnt:function(e){e.find("input[type='checkbox']").change(function(){var t=e.attr("appid");e.find("#appinstlbtn").remove(),Applications.previewData[t].installpermission!==ApplicationsUI.getInstallationDetails()&&e.prepend('<div id="appinstlbtn" class="appinstlbtn"><input purpose="saveInstallationDetails" appbuttons type="button" class="buttn_pos" value="'+Resource.getRealValue("common.savechanges")+'" title="'+Resource.getRealValue("common.savechanges")+'"></div>')})},getSandboxAppPreviewLoadingHTML:function(e){var t={name:e.name,description:e.description,image_url:Applications.getImgUrlById(e.photo_id)};return $WC.template.replace(Template.SandboxAppsPreviewLoading,t)},getInstalledAppPreviewLoadingHTML:function(e){var t={$version:"app.version",$view_store:"app.viewstore",$scope:e.scope===ApplicationConstants.ORGSCOPE?"app.installed.public":["app.installed.team",e.team_names[e.teamids[0]]],$installed_by:"app.install.by",$installed_to:"app.install.to",version_update_button_html:"",name:e.name,description:e.description,installed_version:e.version,image_url:Applications.getImgUrlById(e.photo_id),store_appid:e.store_appid,installer_zuid:e.installed_by,installer_name:Users.getName(""+e.installed_by,e.installer_name)},i=Template.InstallAppsPreviewLoading;return e.latest_version>e.version&&(i=$WC.template.replace(i,{version_update_button_html:'<a target="_blank" href="/installapp.do?id={{store_appid}}"><div class="dbtn textcent mrgT20 msi-ex-update">{{latest_version}}</div></a>'},"InSecureHTML"),t.$latest_version=["app.update",""+e.latest_version]),$WC.template.replace(i,t)},componentHTML:'<div class="appstble mrgT10"><span class="{{classname}} ellips">{{name}}</span><span>{{hint}}</span></div>',getComponentsHTML:function(e){var t="";if(!$WC.$CUtil.isEmpty(e.commands)&&e.commands.length>0)for(var i=0;i<e.commands.length;i++){var a=e.commands[i];t+=$WC.template.replace(this.componentHTML,{name:a.name,hint:a.hint,classname:"msi-slash",image:Commands.getDefaultImgUrl()})}var s="";if(!$WC.$CUtil.isEmpty(e.messageactions)&&e.messageactions.length>0)for(var i=0;i<e.messageactions.length;i++){var n=e.messageactions[i];s+=$WC.template.replace(this.componentHTML,{name:n.name,hint:n.hint,classname:"msi-action",image:MessageActions.getDefaultImgUrl()})}var r="";if(!$WC.$CUtil.isEmpty(e.bots)&&e.bots.length>0)for(var i=0;i<e.bots.length;i++){var o=e.bots[i];r+=$WC.template.replace(this.componentHTML,{name:o.name,hint:o.desc,classname:"msi-boticon",image:Bots.getDefaultImgUrl()})}var l="";if(!$WC.$CUtil.isEmpty(e.functions)&&e.functions.length>0)for(var i=0;i<e.functions.length;i++){var c=e.functions[i];l+=$WC.template.replace(this.componentHTML,{name:c.name,hint:c.description,classname:c.type===Functions.BUTTON_HANDLER_TYPE?"zcf-button-fx":"zcf-form-fx",image:Functions.getDefaultImgUrl()})}var d="";if(!$WC.$CUtil.isEmpty(e.schedulers)&&e.schedulers.length>0)for(var i=0;i<e.schedulers.length;i++){var u=e.schedulers[i];d+=$WC.template.replace(this.componentHTML,{name:u.name,hint:u.description,classname:"msi-schedlr",image:Schedulers.getDefaultImgUrl()})}var m="";if(!$WC.$CUtil.isEmpty(e.platformdatabases)&&e.platformdatabases.length>0)for(var i=0;i<e.platformdatabases.length;i++){var p=e.platformdatabases[i];m+=$WC.template.replace(this.componentHTML,{name:p.display_name,hint:p.description,classname:"msi-platfrmdb"})}var h="";if(!$WC.$CUtil.isEmpty(e.channels)&&e.channels.length>0)for(var i=0;i<e.channels.length;i++){var g=e.channels[i];h+=$WC.template.replace(this.componentHTML,{name:g.cn,hint:g.cd,classname:"msi-sc1",image:Applications.getDefaultChannelImgUrl()})}return{commands:t,bots:r,messageactions:s,functions:l,schedulers:d,platformdatabases:m,channels:h}},getSandboxAppPreviewHTML:function(e){var t=Template.SandboxAppsPreview,i={$close:"common.close",name:e.name,description:e.description,image_url:Applications.getImgUrlById(e.photo_id),$overview:this.getOverviewHtml(e.store_appid)};return $WC.template.replace(t,i)},getOverviewHtml:function(e){var t=Template.AppOverView,i=Applications.previewData[e],a="";i.published_time&&-1!=i.published_time&&(a='<div class="zappsline mrgT25 appstble"><span class="bold mrgB10">{{link}}</span><div class="mrgB25 appinstlink"><span clipboardarea><a href="/installapp.do?id={{install_store_appid}}" target="_blank" class="cur">{{server_url}}/installapp.do?id={{install_store_appid}}</a></span><span documentclick="copyclipboard" class="zcprvwcpylnk">'+Resource.getRealValue("common.copy")+'</span></div><div class="appsprevcnt"><span class="bold">'+Resource.getRealValue("app.installationdetail")+'</span><div id="install_from_external" class="mrgT10"><input type="checkbox" purpose="install_from_external" class="mrgR10">'+Resource.getRealValue("app.install_from_external")+'</div><div id="install_from_cliq" class="mrgT20"><input type="checkbox" purpose="install_from_cliq" class="mrgR10">'+Resource.getRealValue("app.install_from_cliq")+"</div></div></div>",a=$WC.template.replace(a,{install_store_appid:i.install_store_appid,server_url:$zcg._SERVERURL,$link:"app.installation.link"}));var s={installation_link:a,$about:"app.components",$delete:"app.delete",$app_actions:"common.actions"};return s=$.extend(!0,s,this.getComponentsHTML(i)),t=$WC.template.replace(t,s,"InSecureHTML")},getConnectorHtml:function(e){var t=Applications.previewData[e],i=Template.AppConnector,a=this.getAppKeysHTML(t),s=window.location.origin+"/api/v2/applications/"+t.store_appid+"/incoming?appkey=sbx-"+Applications.getAppKey(t.store_appid),n=window.location.origin+"/api/v2/applications/"+t.install_store_appid+"/incoming?appkey="+Applications.getAppKey(t.store_appid),r={$app_key:"app.key",$app_key_info:"app.key.info",$copy:"common.copy",$sandbox:"app.sandbox",$webhook_endpoints:"app.incoming.webhooks",$webhook_endpoints_info:"app.incoming.webhooks.info",$marketplace:"app.marketplace",app_keys:a,sandboxendpoint:s,storeendpoint:n};return i=$WC.template.replace(i,r,"InSecureHTML")},getHandlersHtml:function(e){var t=Applications.previewData[e],i='<div id="apphandlers">{{handlers}}</div>',a={handlers:this.getAppHandlersHTML(t.handlers)};return i=$WC.template.replace(i,a,"InSecureHTML")},getPublisherDetailsHtml:function(){return Template.AppPublisherDetails},updateInstallPermission:function(e){var t=document.getElementById("Integrationspreview");if(t.querySelector("#appcontainer")){var i=t.querySelector('[purpose="install_from_external"]');Applications.isExternalApp(e)&&i&&(i.checked=!0);var a=t.querySelector('[purpose="install_from_cliq"]');Applications.hasAppInstallPermission(e)&&a&&(a.checked=!0)}},updatePublisherDetails:function(e){var t=Applications.previewData[e.attr("appid")];e=e[0],t.developer_name&&(e.querySelector('[data-val="dev_name"]').value=t.developer_name),t.developer_emailid&&(e.querySelector('[data-val="dev_email"]').value=t.developer_emailid),t.developer_website&&(e.querySelector('[data-val="support_center"]').value=t.developer_website),t.privacy_policy_link&&(e.querySelector('[data-val="privacy_policy"]').value=t.privacy_policy_link),t.terms_of_service_link&&(e.querySelector('[data-val="terms"]').value=t.terms_of_service_link)},repopulateSandboxAppKeys:function(e){var t=this.getAppKeysHTML(e);$("#appkeys").html(t)},getAppKeysHTML:function(e){for(var t="",i=[],a=[e.appsecretkey1,e.appsecretkey2,e.appsecretkey3],s=1;s<=a.length;s++)if("undefined"!=typeof a[s-1]){var n='<div class="mrgT20"><div class="bold font16">{{appkey_title}}<span appbuttons purpose="deleteAppkey" keyindex="{{index}}" class="msi-delete cur" title="{{invalidate}}"></span></div><div class="appstble mrgT15 zcendpnt"><span>{{sandbox}}</span><span clipboardarea class="ellips">{{appkey}}</span><span documentclick="copyclipboard" class="zcprvwcpylnk">{{copy}}</span></div><div class="appstble mrgT15 zcendpnt"><span>{{marketplace}}</span><span clipboardarea class="ellips">{{gaappkey}}</span><span documentclick="copyclipboard" class="zcprvwcpylnk">{{copy}}</span></div></div>';t+=$WC.template.replace(n,{index:s,$appkey_title:"app.sandbox.appkey"+(s-i.length),appkey:"sbx-"+e["appsecretkey"+s],gaappkey:e["appsecretkey"+s]})}else i.push(s);if(i.length>0){var r='<div class="zccrapp bold"><span appbuttons purpose="createAppkey" keyindex="{{index}}" class="zcclr cur" title="{{create_new}}">{{create}}</span></div>';t+=$WC.template.replace(r,{index:i[0]})}return $WC.template.replace(t,{$create_new:"app.appkey.createnew",$create:"app.appkey.create",$sandbox:"app.sandbox",$copy:"common.copy",$marketplace:"app.marketplace",$invalidate:"app.appkey.invalidate"})},repopulateSandboxAppHandlers:function(e){var t=this.getAppHandlersHTML(e.handlers);$("#apphandlers").html(t)},getAppHandlersHTML:function(e){for(var t={},i=3e3;3003>=i;i++){var a='<div type="{{type}}" apphandler><span appbuttons purpose="createHandler" type="{{type}}" class="zcclr cur font16">{{edit_code}}</span></div>';t["type_"+i]=$WC.template.replace(a,{type:i})}if(!$WC.$CUtil.isEmpty(e))for(var i=0;i<e.length;i++){var s=e[i],a='<div exec_id="{{exec_id}}" apphandler type="{{type}}"><span appbuttons purpose="editHandler" class="zcclr cur">{{edit_code}}</span><span appbuttons purpose="deleteHandler" class="mrgL20 zcclr cur">{{delete}}</span></div>';t["type_"+s.type]=$WC.template.replace(a,{exec_id:s.id,type:s.type})}var n=$WC.template.replace(Template.AppHandlers,t,"InSecureHTML");return $WC.template.replace(n,{$edit_code:"commands.editcode",$delete:"common.delete"})},repopulateInstalledAppActions:function(e){var t=this.getInstalledAppActionsHTML(e);$("#appactions").replaceWith(t)},getInstalledAppActionsHTML:function(e){if(Applications.hasPermission(e.store_appid)&&!Applications.isInternalApp(e.store_appid)&&Applications.hasAppInstallPermission(e.store_appid)&&SecurityManager.hasPermission(Modules.Applications,MActions.Install)){var t="";e.status==ApplicationConstants.InstalledStatus.ADMIN_DISABLED?t+='<a appbuttons purpose="enable" class="msi-ex-activate zctext mrgR10 cur"><span>{{enable}}</span></a>':e.status==ApplicationConstants.InstalledStatus.ACTIVATED?t+='<a appbuttons purpose="disable" class="msi-ex-deactivate mrgR10 cur"><span>{{disable}}</span></a>':e.status==ApplicationConstants.InstalledStatus.INSTALLED&&(t+='<a target="_blank" href="/installapp.do?id={{store_appid}}" class="msi-ex-popout zctext mrgR10 cur"><span>{{activate}}</span></a>'),t+='<a appbuttons purpose="unInstall" class="msi-delete mrgR10 cur"><span>{{uninstall}}</span></a>';var i='<div id="appactions" class="zappsline appstble posl"><span>{{app_actions}}</span><span class="appactivate">'+t+"</span></div>";return $WC.template.replace(i,{$app_actions:"common.actions",$disable:"common.disable",$enable:"common.enable",$activate:"app.activate",$uninstall:"app.uninstall",store_appid:e.store_appid})}return""},getInstalledAppPreviewHTML:function(e){var t="",i={},a="";e.developer_emailid&&(a+='<a href="mailto:{{dev_email}}" title="{{dev_email}}" class="msi-email cur mrgL10"></a>',i.dev_email=e.developer_emailid),e.developer_website&&(a+='<a target="_blank" href="{{dev_website}}" title="{{dev_website}}" class="msi-link cur mrgL10"></a>',i.dev_website=e.developer_website);var s={dev_details:a,payments_details:t,version_update_button_html:"",appactions_html:this.getInstalledAppActionsHTML(e)};s=$.extend(!0,s,this.getComponentsHTML(e)),SecurityManager.hasPermission(Modules.Applications,MActions.Install)&&e.latest_version>e.version&&(s.version_update_button_html='<a target="_blank" href="/installapp.do?id={{store_appid}}"><div class="dbtn textcent mrgT20 msi-ex-update">{{latest_version}}</div></a>',i.$latest_version=["app.update",""+e.latest_version]);var n=$WC.template.replace(Template.InstalledAppsPreview,s,"InSecureHTML");return i=$.extend(!0,i,{$version:"app.version",$about:"app.about",$show_less:"app.show.less",$developer:"app.developer",$view_store:"app.viewstore",$installed_by:"app.install.by",$installed_to:"app.install.to",$scope:e.scope===ApplicationConstants.ORGSCOPE?"app.installed.public":["app.installed.team",e.team_names[e.teamids[0]]],name:e.name,description:e.description,image_url:Applications.getImgUrlById(e.photo_id),store_appid:e.store_appid,installed_version:e.version,developer_name:e.developer_name||e.developer_emailid||"",installer_zuid:e.installed_by,installer_name:Users.getName(""+e.installed_by,e.installer_name)}),$WC.template.replace(n,i)}},ApplicationConstants={Handlers:[3e3,3001,3002,3003],InstalledStatus:{INSTALLED:3,ACTIVATED:4,ADMIN_DISABLED:-1,PAYMENT_DEACTIVATED:-2,UNINSTALLED:-3,OWNER_DISABLED:-4},INSTALL_FROM_INTERNAL:1,INSTALL_FROM_EXTERNAL:2,INSTALL_FROM_CLIQ:4,INSTALLATION_HANDLER:3e3,INCOMING_WEBHOOK:3001,INSTALLATION_VALIDATOR:3002,UNINSTALLATION_HANDLER:3003,ORGSCOPE:1,TEAMSCOPE:2,PRIVATESCOPE:3,isAppHandler:function(e){return e>=3e3&&3003>=e}};var Events={},EventsUI={},ShowTime={};EventsUI={optionsDropdownHTML:'<div class="floatl zcrmdrpdwn"><div class="selectmlmn floatl"><div class="dIB zcevrem"><div id="{{ID}}head" class="zcrmtm" eventbuttons purpose="showOptions"><div id="{{ID}}sel" class="mailids ellips" val="{{DEFAULTVALUE}}">{{DEFAULTNAME}}</div><span class="msi-darrw floatr"></span></div><ul id="{{ID}}" eventbuttons purpose="selectOption" style="display:none" class="dropdwncnt">{{DROPDOWN}}</ul></div></div></div>',calendarHTML:'<div calendarcontent class="addevdt dIB"><div id="{{NAME}}calendar" eventbuttons purpose="openCalendar" class="zcevnt-clndrmn{{CLASSNAME}} cur"><div id="{{PURPOSE}}date" class="zcdtcnt ellips" timeval="true" type="text"><span id="{{NAME}}date"></span> &#44; <span id="{{NAME}}time"></span></div><div class="posl zcdtpic"><span class="msi-calndr floatr zcclr"></span></div></div><div id="{{NAME}}calendarcnt" class="datepickermn posa"><div id="{{NAME}}cal" class="zcevcal"></div><div class="zcalbb"></div><div class="zcevntdt{{CLASSNAME}}"><div class="posl floatl mrgL10"><input id="{{NAME}}hours" eventtimeinput hours class="zcevtms" maxlength="2" timeval="true" type="input"/><span class="msi-arwdwn"></span><ul id="hour{{NAME}}dropdown" style="display: none;" datedropdown class="zcevhur dropdwncnt zcddbtr">{{HOURSDROPDOWN}}</ul></div><div class="posl floatl"><input id="{{NAME}}minutes"  class="zcevtms" minutes eventtimeinput maxlength="2" timeval="true" type="input"/><span class="msi-arwdwn"></span><ul id="{{NAME}}minutesdropdown" style="display: none;" datedropdown class="zcevhur dropdwncnt zcddbtr">{{MINUTESDROPDOWN}}</ul></div><div class="posl floatl"><input id="{{NAME}}period" class="zcevtms cur" period eventtimeinput timeval="true" type="input" readonly tabindex="-1"/><ul id="{{NAME}}perioddropdown" style="display: none;" datedropdown class="zcevhpd dropdwncnt zcddbtr"><li purpose="selectTime" timeddlist eventbuttons val="AM">AM</li><li purpose="selectTime" timeddlist eventbuttons val="PM">PM</li></ul><span class="msi-arwdwn"></span></div><div id="{{NAME}}datesubmit" purpose="setTime" eventbuttons class="zccalb floatr font11 mrgR10 cur">'+Resource.getRealValue("event.set")+"</div></div></div></div>",statusHTML:'<div id="eventstatuscnt" class="zch40"><div id="eventstatus" eventbuttons purpose ="showStatus" class="zcevsts textright zcepbtn dN"><span id="currentstatustick" class="msi-tick ststick"></span><div id="eventcurrentstatus" class="zccurbtn ellips"></div><span class="msi-darrw"></span><div id="eventstatuscontainer" eventbuttons purpose="changeAttendanceStatus" class="zcevstddcnt dN"><input type="button" status="ACCEPTED" class="btn adbtn" value="'+Resource.getRealValue("common.accept")+'"><input type="button" status="DECLINED" class="btn evbtn" value="'+Resource.getRealValue("common.decline")+'"><input type="button" status="TENTATIVE" class="btn evbtn zcevmbe" value="'+Resource.getRealValue("event.maybe")+'"></div></div></div>',eventStatusButtonHTML:'<div id="statusbuttons" class="zch40"><div id="eventstatusbuttoncontainer" eventbuttons purpose="changeAttendanceStatus" class="evntstsbtn textright"><input type="button" status="ACCEPTED" class="dbtn adbtn" value="'+Resource.getRealValue("common.accept")+'"><input type="button" status="DECLINED" class="buttn_neg evbtn" value="'+Resource.getRealValue("common.decline")+'"><input type="button" status="TENTATIVE" class="buttn_pos evbtn" value="'+Resource.getRealValue("event.maybe")+'"></div></div>',eventHTML:'<div id="{{EID}}" ckey="{{CKEY}}" eventbuttons purpose="preview" class="zcevnt-msgmn cur clr0">{{DELETEHTML}}<div class="zcevtlst"><div class="ellips font15 bold">{{TITLE}}</div>{{TIMELEFT}}</div><div class="ellips font14 clr0">{{STARTTIME}} <span class="clr8 zcto">'+Resource.getRealValue("common.to.small")+'</span> {{ENDTIME}}</div>{{LOCATION}}<div class="ellips font14 clr0"><span class="clr8">'+Resource.getRealValue("event.organizedby")+'&nbsp;</span><span uid="{{ORGANISERID}}" class="zulin" elemtype="user" hover="true">{{CREATORNAME}}</span></div><div class="ellips font14 clr0 zcalevnt"><span class="clr8">'+Resource.getRealValue("event.createdin")+'&nbsp;</span><span class="zulin" ckey="{{CKEY}}">{{CALENDARNAME}}</span></div></div>',reminderOptionHTML:'<div id="reminderscnt" class="mrgT15 clboth zcadd-invitbtm clr0"><div class="floatl ellips mrgT15">'+Resource.getRealValue("common.remindbefore")+'</div><div id="evgroupremind" class="dN zcdatecont floatr mrgT10"><span id="evgroupreminddesc" class="evt-alrtdesc"></span></div><div id="eventalert">{{REMINDERCONTENTS}}</div></div>',eventManagementOptionHTML:'<div class="dIB clr0 mrgT5">'+Resource.getRealValue("event.alert")+'</div><div id="evgroupremind" class="dN zcdatecont floatr"><span id="evgroupreminddesc" class="evt-alrtdesc"></span></div><div id="eventalert"  class="posrel clr0 dIB floatr zcdatecont"><div class="posl dIB"><input id="eventreminderradio" eventalertradio class="evt-alrtinput cur" name="eventalerttype" type="radio" checked="true"><span class="evt-alrttype"></span><label class="cur" for="eventreminderradio">'+Resource.getRealValue("event.reminder")+'</label></div><div class="posl dIB mrgL30"><input id="eventmanagementradio" eventalertradio class="evt-alrtinput cur" name="eventalerttype" type="radio"><span class="evt-alrttype"></span><label class="cur" for="eventmanagementradio">'+Resource.getRealValue("event.management")+'</label></div><div class="evt-alrtcnt"><div id="reminderscnt" class="clr0">{{REMINDERCONTENTS}}</div><div id="eventalertdesc" class="evt-alrtdesc">'+Resource.getRealValue("event.reminder.hint")+"</div></div></div>",show:function(e){var t=$("#eventcontainer");Clickoutside.bind({event:e,srcid:"ztb-events",destid:"eventcontainer",customShow:function(){t.addClass("effect-scale"),EventsUI.populate("topbarevlist")},customHide:function(){t.removeClass("effect-scale")}})},getTimeToPopulate:function(e){var t=18e5,i=$Util.getSyncedCurrentTime();return parseInt(e)>0?e:i+t-i%t},bindEvents:function(){var e=$(document);e.on("click","[eventbuttons]",function(e){var t=$(this).attr("purpose");e.stopPropagation(),EventsUI.handle[t](e,this)}),e.on("focus keydown","[eventinput]",function(){$Dom.limitInput("#"+this.id),$(this).removeClass("error").attr("timeval","true").siblings('[category ="charcount"]').removeClass("dN")}),e.on("blur","[eventinput]",function(){$(this).siblings('[category="charcount"]').addClass("dN")}),e.on("click","[eventtimeinput]",function(e){$("[eventtimeinput]").removeClass("zcddtpr");var t=$(this).addClass("zcddtpr").siblings("[datedropdown]").attr("id"),i=$("#"+t);ZCScroll.customScroll(i,!0),i.is(":visible")||Clickoutside.bind({event:e,srcid:this.id,destid:t,callback:function(e){$("#"+e).removeClass("zcddtpr")}});var a=e.target.value;!$WC.$CUtil.isEmpty(a)&&a.length>1&&$Util.scrollToViewportTop(i.find("[val="+a+"]").addClass("sel"),t,300)}),e.on("keydown","[eventtimeinput]",function(e){var t=e.which,i=$(this).siblings("[datedropdown]").attr("id"),a=$("#addeventwin").find("#"+i);a.is(":visible")&&(t===$zcg.UP_KEYCODE||t===$zcg.DOWN_KEYCODE?DropdownUtil.handleListNavigation(e,a,"[timeddlist]"):t===$zcg.TAB_KEYCODE?Clickoutside.handleClickOnChild(e,i):t===$zcg.ENTER_KEYCODE&&a.find(".sel").length&&EventsUI.showSelectedTime(a.find(".sel"),e))}),e.on("keyup","[eventtimeinput]",function(){function e(e,a){$Util.isValidNumber(i,a,e)||t.addClass("zcfdk_tmbzoom error").attr("timeval","false")}var t=$(this),i=t.val();t.removeClass("zcfdk_tmbzoom error").attr("timeval","true"),t.is("[hours]")&&e(Events.MAX_HOURS,Events.MIN_HOURS),t.is("[minutes]")&&e(Events.MAX_MINUTES,Events.MIN_MINUTES)}),e.on("change","[eventalertradio]",function(){var e,t;t=$("#addeventwin"),"eventreminderradio"===this.id?(e=Resource.getRealValue("event.reminder.hint"),t.find("#reminderscnt").slideDown()):(e=Resource.getRealValue("event.management.hint"),t.find("#reminderscnt").slideUp()),t.find("#eventalertdesc").text(e)})},handle:{open:function(e){Clickoutside.handleClickOnChild(e),EventsUI.add(),EventsUI.populate("evlist"),this.showCreateWin()},preview:function(e,t){var t=$(t),i=t.attr("id");"evlist"!==t.parent().attr("id")&&(Clickoutside.handleClickOnChild(e),EventsUI.add(),EventsUI.populate("evlist")),$("#eventshowcontainer").attr("eid")===i&&$("#eventview").is(":visible")||EventsUI.preview(i)},openPreview:function(){EventsUI.preview($("#evsubmit").attr("eid"))},"delete":function(e,t){var i=t.id,a=Events.getObject(i).SUM;$WC.$Dlg.create({id:"deleteevent",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-calndr clr-red f40"></div>',header:Resource.getRealValue("event.delete.info",[$WC.$CUtil.processXSS(a)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("event.delete.info1")]}),buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Events.delete(t)}}]})},showCreateWin:function(e){var t,i,a,s,n,r=$("#addeventwin"),o=Events.reminderval,l=Events.getAllCalendars(),c=0,d=Settings.getFromObj("oreminder",!0).substring(2),u=d>-1?d:"0",m="",p="",h=_isEventManagementEnabled()?EventsUI.eventManagementOptionHTML:EventsUI.reminderOptionHTML;r.attr("mode","create").find("#eventview").hide(),$("#createevcontainer").empty(),r.find(".sel").removeClass("sel"),r.find("#eventcreateshortcut").fadeOut(),Clickoutside.clear("addeventwin");for(var g=0,f=o.length;f>g;g++)m+='<li val="'+o[g]+'">'+EventsUI.getReminderString(o[g])+"</li>";for(var v in l)("own"===l[v].category||"group"===l[v].category&&"ogroup"===l[v].entity_type)&&(l[v].isdefault===!0&&(t=l[v]),c++,p+=$WC.template.replace('<li val="{{UID}}">{{CALENDARNAME}}</li>',{UID:v,CALENDARNAME:l[v].name}));if(i=$WC.template.replace(EventsUI.optionsDropdownHTML,{ID:"reminders",DEFAULTVALUE:u,DEFAULTNAME:EventsUI.getReminderString(parseInt(u))}),calendarlistcontent=$WC.template.replace(EventsUI.optionsDropdownHTML,{ID:"calendars",DEFAULTVALUE:t.CKEY,DEFAULTNAME:t.name}),i=i.replace(/{{DROPDOWN}}/,m),calendarlistcontent=calendarlistcontent.replace(/{{DROPDOWN}}/,p),h=h.replace(/{{REMINDERCONTENTS}}/,i),a=EventsUI.calendarHTML.replace(/{{NAME}}/g,"start").replace(/{{PURPOSE}}/,"from").replace(/{{CLASSNAME}}/g,"1").replace(/{{HOURSDROPDOWN}}/,EventsUI.getTimeDropdownHtml(Events.MAX_HOURS)).replace(/{{MINUTESDROPDOWN}}/,EventsUI.getTimeDropdownHtml(Events.MAX_MINUTES)),s=EventsUI.calendarHTML.replace(/{{NAME}}/g,"end").replace(/{{PURPOSE}}/,"to").replace(/{{CLASSNAME}}/g,"2").replace(/{{HOURSDROPDOWN}}/,EventsUI.getTimeDropdownHtml(Events.MAX_HOURS)).replace(/{{MINUTESDROPDOWN}}/,EventsUI.getTimeDropdownHtml(Events.MAX_MINUTES)),n=$WC.template.replace(Template.CreateEvent,{EVENTMANGEMENTCNT:h,CALENDARCONTENTS:calendarlistcontent,STARTCALENDARCONTENTS:a,ENDCALENDARCONTENTS:s},"InSecureHTML"),$("#createevcontainer").append(n).show(),SearchField.init("Events-usersuggest"),e&&$(e.target).attr("eid")){$("#addeventwin").attr("mode","edit");var C=Events.getObject($(e.target).attr("eid"));C.EVENTMANAGEMENT&&_isEventManagementEnabled()&&(r.find("#reminderscnt").hide(),r.find("#eventalertdesc").text(Resource.getRealValue("event.management.hint")),r.find("#eventmanagementradio").attr("checked",!0)),r.find('[id="'+$(e.target).attr("eid")+'"]').addClass("sel"),r.find("#evsubmit").attr({eid:C.EUID,ckey:C.CKEY,etag:C.ETAG}).html(Resource.getRealValue("common.save")),r.find("#evcancel").attr({purpose:"openPreview"}),r.find("#eventype").text(Resource.getRealValue("event.edit")),r.find("#calendarshead").removeAttr("eventbuttons").find("span").remove(),r.find("#calendarssel").text(l[C.CKEY].name).attr("val",C.CKEY),"group"===l[C.CKEY].category&&($("#eventalert").hide(),$("#evgroupreminddesc").html(Resource.getRealValue("event.group.reminder",'<a class="calenlink" href="'+$zcg._CALENDARSERVER+'" target="_blank">'+Resource.getRealValue("common.small.calendar")+"</a>")),$("#evgroupremind").removeClass("dN")),EventsUI.fillCreateWin(C)}else{var y=EventsUI.getTimeToPopulate(),b=y+60*Events.TIMEDIFFINMINS*1e3;2>c?r.find("#calendarshead").removeAttr("eventbuttons").find("span").remove():r.find("#calendartitle").text(Resource.getRealValue("event.calendar.choose")),r.find("#startcalendar").attr("val",y),r.find("#endcalendar").attr("val",b),r.find("#starttime").text($Date.time(y)),r.find("#endtime").text($Date.time(b)),r.find("#startdate").html($Date.date(y)),r.find("#enddate").html($Date.date(b)),Events.TIMESTAMPDIFF=b-y,r.find("#evtitle").focus()}ZCScroll.customScroll($("#eventrightcontainer"),!0),ZCScroll.customScroll($("#reminders"),!0),ZCScroll.customScroll($("#calendars"),!0)},create:function(){var e=$("#addeventwin"),t=e.find("#evadd"),i=t.find("#evtitle").val().trim(),a=t.find("#evelocation").val().trim(),s=e.find("#eventmanagementradio").is(":checked");if($WC.$CUtil.isEmpty(i))return void t.find("#evtitle").addClass("error").attr("timeval","false");if(0==e.find("[timeval='false']").length){var n=$("#startcalendar").attr("val"),r=e.find("#calendarssel").attr("val"),o=Events.getCalendar(r);if(!Events.isProperReminder(e.find("#reminderssel").attr("val"),n)&&!s&&"own"===o.category)return UI.updateBanner(Resource.getRealValue("event.reminder.error"),2e3,!0),void $("#remindershead").addClass("zcfdk_tmbzoom error");{var l,c=$("#endcalendar").attr("val"),d=e.find("#reminderssel").attr("val");t.find("#evsubmit").attr("eid"),t.find("#evsubmit").attr("etag")}Settings.update({oreminder:"1:"+d});var u={title:i,starttime:n,endtime:c,calendaruid:r,timezone:Events.getGMTTimeOffset()};if($WC.$CUtil.isEmpty(a)||(u.location=a),"own"===o.category?$WC.$CUtil.isEmpty(d)||s||(u.reminder=d):s=!1,"edit"===e.attr("mode")){var m=e.find("#evsubmit").attr("eid"),p=Events.getObject(m),l=EventsUI.getParticipantsList(p.ATTENDEES,!0);if(l.length&&(u.attendees=l),l.length>1)u.eventmanagement=s;else if(s)return void UI.updateBanner(Resource.getRealValue("event.management.error"),2e3,!0);u.etag=p.ETAG,u.organizer=p.ORGANIZER,$WC.$CUtil.isEmpty(p.DESC)||(u.description=p.DESC),$Util.Button.addLoadIcon(t.find("#evsubmit")),Events.edit(u,m)}else{if(l=EventsUI.getParticipantsList(),l.length&&(u.participants=l),l.length>1)u.eventmanagement=s;else if(s)return void UI.updateBanner(Resource.getRealValue("event.management.error"),2e3,!0);1!=Settings.getFromObj("create_event")&&(u.onboardingstepkey="create_event",CheckList.markAsCompleted("create_event")),$Util.Button.addLoadIcon(t.find("#evsubmit")),Events.create(u)}}},openCalendar:function(e,t){var i,a,s,n,r=$("#addeventwin"),o=$(t).attr("id"),l="startcalendar"===o?"start":"end";r.find("[eventtimeinput]").removeClass("zcfdk_tmbzoom error zcddtpr").attr("timeval","true"),i=r.find("#"+l+"cal"),a=parseInt($("#"+o).attr("val")),s=i.parent().attr("id"),n=new Date(a),n=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear(),r.find("#"+l+"calendar").parents("[calendarcontent]").addClass("addevdtdd");var c=r.find("#"+l+"time").text(),d=c.split(":"),u=d[1].split(" ");r.find("#"+l+"hours").val(d[0]),r.find("#"+l+"minutes").val(u[0]),r.find("#"+l+"period").val(u[1]);var m=r.find("#"+s);m.is(":visible")||($WC.$CUtil.isEmpty(i.html())?i.DatePicker({flat:!0,format:"m/d/Y",date:n,current:n,starts:0,onChange:function(e){var t,i,a=$("#addeventwin"),s=a.find("#startcalendarcnt"),n="start";s.is(":visible")||(n="end",s=a.find("#endcalendarcnt")),t=a.find("#"+n+"time").text(),i=new Date(e+" "+t).getTime(),a.find("#"+n+"date").html($Date.date(i)),a.find("#"+n+"calendar").attr("val",i),"start"===n&&EventsUI.checkStartTime(a),EventsUI.handleTimeChangeInCalendar(a,n+"date"),s.find("[datedropdown]").is(":visible")&&Clickoutside.clear(s.find("[datedropdown]:visible").attr("id").hide())}}):m.DatePickerSetDate(n,!0),Clickoutside.bind({event:e,srcid:o,destid:s,doNotClose:function(e,t){return t?("startcalendar"===o?($("#startdate").html($Date.date(a)),$("#startcalendar").attr("val",a)):($("#enddate").html($Date.date(a)),$("#endcalendar").attr("val",a)),!1):void 0},callback:function(e){$("#"+e).parents("[calendarcontent]").removeClass("addevdtdd")}}))},selectTime:function(e,t){var t=$(t);t.parent().find(".sel").removeClass("sel"),t.addClass("sel"),EventsUI.showSelectedTime(t,e)},selectOption:function(e,t){var i=$(e.target).attr("val");if($("#"+t.id+"cnt").find("#"+t.id+"sel").html($(e.target).text()).attr("val",i),"calendars"===t.id){var a=Events.getCalendar(i);"group"===a.category?("undefined"==typeof Groups.get(a.entity_id).members&&Groups.getMembers(a.entity_id),$("#evgroupreminddesc").html(Resource.getRealValue("event.group.reminder",'<a class="calenlink" href="'+$zcg._CALENDARSERVER+'" target="_blank">'+Resource.getRealValue("common.small.calendar")+"</a>")),$("#eventalert").slideUp(function(){$("#evgroupremind").removeClass("dN")}),SearchField.clearSearchField("Events-usersuggest")):($("#evgroupremind").addClass("dN"),$("#eventalert").slideDown())}Clickoutside.handleClickOnChild(e)},showOptions:function(e,t){var t=$(t),i=t.siblings('[purpose="selectOption"]');t.removeClass("zcfdk_tmbzoom error"),$(e.target).addClass("sel"),t.addClass("zcddsw"),Clickoutside.bind({event:e,srcid:e.currentTarget.id,destid:i[0].id,callback:function(e){var t=$("#"+e);t.removeClass("sel").removeClass("zcddsw").parent().removeClass("zcdrptop")}});var a=$("#"+i[0].id);$(window).height()<a.offset().top+a.height()+t.height()?t.parent().addClass("zcdrptop"):t.parent().removeClass("zcdrptop")},close:function(){$WC.$Win.destroy("addeventwin"),Clickoutside.clear("addeventwin")},setTime:function(e,t){var i=$(t).attr("id"),a=$("#addeventwin"),s="startdatesubmit"===i?"start":"end",n=$("#"+s+"calendarcnt");if($("[datedropdown]").hide(),0===n.find("[timeval='false']").length){var r=a.find("#"+s+"minutes").val(),o=a.find("#"+s+"calendar"),l=a.find("#"+s+"hours").val(),c=$Util.getDateWithoutTime(o.attr("val")),d=(1===l.length?"0"+l:l)+":"+(1===r.length?"0"+r:r)+" "+a.find("#"+s+"period").val(),u=new Date(c+" "+d).getTime();a.find("#"+s+"time").text(d),o.attr("val",u),EventsUI.handleTimeChangeInCalendar(a,s+"date"),Clickoutside.handleClickOnChild(e)}EventsUI.checkStartTime(a)},actionsOnReminderBox:function(e,t){"reminderclose"!==e.target.id&&this.preview(e,t),t.remove(),$("#eventreminder").find("[ckey]").length||$("#eventreminder").hide()},changeAttendanceStatus:function(e,t){var t=$(t),i={calendaruid:t.attr("ckey"),status:$(e.target).attr("status"),etag:t.attr("etag")};"eventstatuscontainer"===t.attr("id")?Clickoutside.handleClickOnChild(e):($("#statusbuttons").find("input").css("left","calc(100% - 110px)"),$(e.target).addClass("zcevsts")),Events.updateStatus(t.attr("eid"),i)},showStatus:function(e,t){var i=$("#addeventwin");i.find("#eventstatus").addClass("zcevstssel"),i.find("#eventstatuscontainer").find("[status="+$(t).attr("status")+"]").hide(),Clickoutside.bind({event:e,srcid:"eventstatus",destid:"eventstatuscontainer",callback:function(){i.find("#eventstatus").removeClass("zcevstssel")}})},reschedule:function(e){this.showCreateWin(e);var t=Events.getCalendar($("#calendarssel").attr("val"));"group"===t.category&&"undefined"==typeof Groups.get(t.entity_id).members&&Groups.getMembers(t.entity_id),"attendees"===$(e.target).attr("usagetype")?$WC.DivEditor.focus("Events-usersuggest-search-field"):EventsUI.handle.openCalendar(e,$("#startcalendar"))}},add:function(){if(!$WC.$Win.isExist("addeventwin")){$WC.$Win.create({id:"addeventwin","class":"addeventwin",html:Template.AddEvent,closefn:function(){Events.currentsearch="",Clickoutside.clear("evpartautocomplete")}})}},preview:function(e){var t=$("#eventview"),i=$("#addeventwin");i.find(".sel").removeClass("sel"),i.find("#eventcreateshortcut").fadeIn(),i.attr("mode","preview").find("#createevcontainer").hide();var a,s,n,r,o,l,c=i.attr("mode","preview").find('#evlist div[id="'+e+'"]').addClass("sel"),d=Events.getObject(e),u=d.ST,m=d.ET,p=d.ORGANIZERZUID===$zcg._ZUID||d.ORGANIZERZUID===$zcg._EMAILID,h=!$WC.$CUtil.isEmpty(d.ATTENDEES),g=d.CKEY,f=Events.getCalendar(g),v="own"===f.category||"group"===f.category&&"ogroup"===f.entity_type;$Date.date(u)===$Date.date(m)?(a=Events.getShortTime($Date.time(u)),s=Events.getShortTime($Date.time(m)),n="&#8722;",r=!0,o="font24 ftw100"):(a=$Date.date(u)+'&nbsp;<span class="zcevtup">'+$Date.time(u).replace(" ","&nbsp;")+"</span>",s=$Date.date(m)+'&nbsp;<span class="zcevtup">'+$Date.time(m).replace(" ","&nbsp;")+"</span>",n="<div>"+Resource.getRealValue("common.to.small")+"</div>",o="font15 clr6 lin22",r=!1),html=$WC.template.replace(Template.EventPreview,{TITLE:d.SUM,ORGANIZERZUID:d.ORGANIZERZUID,CALENDARNAME:f.name,EID:e,CLASSNAME:o,STARTTIMEINMS:u}),html=$WC.template.replace(html,{ATTENDEESTITLE:h||p&&v?'<div id="eventattendees" class="zcevatt"><div class="font18 posl">'+Resource.getRealValue("event.attendees.header")+'</div><div id="eventattendeesimg"></div></div>':"",EVENTDATE:r?'<div class="clr6">'+$Date.date(u)+"</div>":"",LOCATION:$WC.$CUtil.isEmpty(d.LOC)?" ":$WC.template.replace('<div class="zcplinbt"><div id="title" class="font18 posl">'+Resource.getRealValue("common.location")+'</div><div id="location" class="mrgT5 clr6">{{LOCATION}}</div></div>',{LOCATION:d.LOC}),ORGANIZERNAME:Users.getName(d.ORGANIZERZUID,d.ORGANIZER),TIMESPACE:n,STARTTIME:a,ENDTIME:s},"InSecureHTML"),t.show().html(html),p&&v?t.find("#evpreviewrighttime").hide():(t.find("#evpreviewleft").remove(),t.find("#evpreviewright").addClass("zcevlcnt"));var C="";if(h)for(var y=d.ATTENDEES,b=0,E=y.length;E>b;b++){var I,T,S,R="true",A=y[b].status,M=y[b].zuid,U=y[b].email;($WC.$CUtil.isEmpty(M)||$WC.$CUtil.isEmpty(Users.getEmailId(M)))&&M!=$zcg._ZUID?(R="false",I=U,T=Users.getDefaultImgUrl()):(I=M,T=Users.getImgUrlById(I)),U!==$zcg._EMAILID||p||(I=$zcg._ZUID,A!==Events.pending?EventsUI.addStatusDropDown(d,A):(i.find("#evpreviewright").append(EventsUI.eventStatusButtonHTML),t.find("#eventstatusbuttoncontainer").attr({eid:e,ckey:g,etag:d.ETAG}))),S=U,C+='<div class="dIB posl mrgR5 mrgT3"><img uid="'+I+'" elemtype="user" hover="'+R+'" title="'+Users.getName(I,S)+'" src="'+T+'"/><span purpose="userStatus" title="'+Resource.getRealValue("common.status")+"&nbsp;&nbsp;-&nbsp;&#34;"+Events.statusText[A]+'&#34;" class="msi-'+A.toLowerCase()+'"></span></div>'}l=p&&v?'<div id="attendcnt" class="mrgT5 zcattcnt posl">'+C+'<div eventbuttons eid ="'+e+'" purpose="reschedule" usagetype="attendees" class="msi-add zcatadd dIB cur"></div></div>':'<div id="attendcnt" class="mrgT5 zcattcnt posl">'+C+"</div>",$("#eventattendeesimg").html(l),ZCScroll.customScroll($("#previewscrollcontainer"),!0),c.attr("loaded")||(c.attr("loaded",!0),Events.getDetails(e,g,Events.updatePreview)),$Date.isSameDay(u)&&Events.markEventAsSeen(e),Clickoutside.bind({srcid:"addeventwin",destid:"addeventwin",closeOnClickSrc:!1,customHide:function(){EventsUI.handle.close()}})},addStatusDropDown:function(e,t){var i=$("#addeventwin");i.find("#evpreviewright").append(EventsUI.statusHTML);var a=t.toLowerCase();i.find("#eventstatus").show().addClass(a).attr("status",t).find("#currentstatustick").addClass(a),i.find("#eventstatuscontainer").attr({eid:e.EUID,ckey:e.CKEY,etag:e.ETAG}),i.find("#eventcurrentstatus").text(Events.statusText[t]).attr("status",t)},populate:function(e){function t(e,t){return $WC.$CUtil.isEmpty(e)?"":'<div class="zcelsthd clr0 mrgT15">'+Resource.getRealValue(t)+"</div>"+e}var i=Events.getAll(),a=$("#"+e),s="",n="",r="",o="",l=0,c=0,d="",u=[];for(var m in i){var p=[];p.push(m),p.push(i[m].ST),u.push(p)}u=$Util.sort(u,1,!1);for(var h=0;h<u.length;h++){var g=i[u[h][0]],d=EventsUI.getHtml(g,e);if(!$WC.$CUtil.isEmpty(d)){var f=g.ST,v=g.ET,C=$Util.getSyncedCurrentTime();Events.isEndedEvent(v)?(s+=d,l++):C>f&&v>C?(n+=d,c++):$Date.isSameDay(f)?r+=d:o+=d}}s=l>1?t(s,"event.pastevents"):t(s,"event.pastevent"),n=c>1?t(n,"event.ongoingevents"):t(n,"event.ongoingevent"),r=t(r,"date.today"),o=t(o,"event.nextevents"),d=s+n+r+o,$WC.$CUtil.isEmpty(d)&&(d="evlist"===e?'<div id="evnoevent" class="evntnone posa textcent"><div class="zccalpic posl"></div><div class="mrg10 evnotxt">'+Resource.getRealValue("event.none")+"</div></div>":'<div id="evnoevent" class="evntnone posa textcent">'+Resource.getRealValue("event.top.none")+"</div>"),a.html(d),ZCScroll.customScroll($("#"+a.parent().attr("id")),!0)},getHtml:function(e,t){var i=e.ST,a=e.ET,s=e.EUID,n="",r=e.ORGANIZERZUID,o=$("#eventreminder"),l=Events.getShortTime($Date.date(i,{withtime:!0,withday:!0,shortmonth:!0,shorten:!0,shortday:!0})),c=Events.getShortTime($Date.date(a,{withtime:!0,withday:!0,shortmonth:!0,shorten:!0,shortday:!0})),d=Events.getCalendar(e.CKEY),u=r!==$zcg._ZUID&&r!==$zcg._EMAILID||"evlist"!==t||"own"!==d.category&&("group"!==d.category||"ogroup"!==d.entity_type)?"":'<span id="'+s+'" ckey="'+e.CKEY+'" etag="'+e.ETAG+'" eventbuttons purpose="delete" class="msi-ppdel font13 posa cur clr8"></span>';if(Events.isEndedEvent(a)&&!o.is(":visible")&&!o.find('[id="'+s+'"]').length>0)return delete Events.getObject(s),void Home.handleCurrentEvents();if($Date.isSameDay(i)){if(i>$Util.getSyncedCurrentTime()){var m=$Date.relativetimeleft(i).replace(" left","");n=$WC.$CUtil.isEmpty(m)?"":'<div class="clr8 dIB">&nbsp;'+Resource.getRealValue("common.in")+'&nbsp;</div><div class="dIB font14 clr0" data-event-stime="'+a+'" data-event-etime="'+i+'">'+m+"</div>"}l=Events.getShortTime($Date.time(i))}else $Date.day(i)===Resource.getRealValue("date.tomorrow")&&(l=$Date.day(i)+"&nbsp;"+Events.getShortTime($Date.time(i)));$Date.date(i)===$Date.date(a)&&(c=Events.getShortTime($Date.time(a)));var p=$WC.template.replace(EventsUI.eventHTML,{EID:s,CKEY:e.CKEY,CALENDARNAME:$DB.get("calendars")[e.CKEY].name,ORGANISERID:r,TITLE:e.SUM});return $WC.template.replace(p,{DELETEHTML:u,LOCATION:e.LOC?$WC.template.replace('<div class="ellips font14 clr0">@&nbsp;{{LOCATION}}</div>',{LOCATION:e.LOC}):"",CREATORNAME:Users.getName(r,e.ORGANIZER),TIMELEFT:n,STARTTIME:l,ENDTIME:c},"InSecureHTML")},getReminderString:function(e){var t="";return 0===e?t=Resource.getRealValue("event.reminder.no"):60>e?t=e+" "+Resource.getRealValue("event.mins"):e>=60&&1440>e?t=60===e?Resource.getRealValue("event.reminder.1hour"):e/60+" "+Resource.getRealValue("event.hours"):e>=1440&&21600>=e&&(t=1440===e?Resource.getRealValue("event.reminder.1day"):e/1440+" "+Resource.getRealValue("event.days")),t},participantsSuggestion:{search:function(e){var t=$("#Events-usersuggest-results"),i=SearchField.getSelectedList("Events-usersuggest-search-field");t.html('<div id="Events-usersuggest-list"  class="drpdwn srchglt"></div>');var a={},s=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,n=Events.getCalendar($("#calendarssel").attr("val"));"group"===n.category&&(s=SearchAgent.CUSTOMSEARCH,a=Groups.getMembersFromObj(n.entity_id));var r=SearchAgent.search({searchin:s,ignorelist:i,listid:"Events-usersuggest-list",val:e,allstatuscontacts:!1,clearcallback:function(){var i=SearchField.checkAndAddEmailInAutocomplete("Events-usersuggest",e);i&&(t.find("#Events-usersuggest-list").empty(),t.hide())},customobject:a});if(r){t.find("[purpose='search']").first().addClass("srchbn sel");var o="block"===t.css("display");o||Clickoutside.bind({srcid:"Events-usersuggest-search-field",destid:"Events-usersuggest-results"}),ZCScroll.customScroll(t.find("#Events-usersuggest-list"),!0),ZCScroll.scrollTop($("#Events-usersuggest-results"),0)}else{this.clear();var l=SearchField.checkAndAddEmailInAutocomplete("Events-usersuggest",e);l&&(t.find("#Events-usersuggest-list").empty(),t.hide())}},handleAction:function(e,t,i){if(i){var a=SearchField.getNodeforSelection({uid:t.attr("uid"),type:t.attr("elemtype"),name:t.attr("data-val")},!0);SearchField.insertNodeinField("Events-usersuggest",void 0,a),Clickoutside.handleClickOnChild(e,t)}},clear:function(){$("#Events-usersuggest-results").hide().find("#Events-usersuggest-list").empty(),Clickoutside.clear("Events-usersuggest-results")}},getTimeDropdownHtml:function(e){for(var t,i="",a=12===e?1:0,s=a;e>=s;s++)t=10>s?"0"+s:s,i+='<li val="'+t+'" eventbuttons purpose="selectTime" timeddlist>'+t+"</li>";return i},checkStartTime:function(e){var t=$Util.getSyncedCurrentTime(),i=e.find("#startcalendar").attr("val");this.isInvalidEventTime(i,t)?e.find("#fromdate").addClass("error").attr("timeval","false"):e.find("#fromdate").removeClass("error").attr("timeval","true")},isInvalidEventTime:function(e,t){return t>=e||e>Events.MAX_YEAR_TIMESTAMP||e<Events.MIN_YEAR_TIMESTAMP},getParticipantsList:function(e,t){var i=SearchField.getMultiTypeSelectedList("Events-usersuggest-search-field");if(!$WC.$CUtil.isEmpty(i)){var a=[],s=i.emailids?i.emailids:[],n=i.contact?i.contact:[],r=s.concat(n),o=Events.getCalendar($("#calendarssel").attr("val"))||{},l="group"===o.category,c={};if(l&&(c=Groups.getMembersFromObj(o.entity_id)||{}),t)for(var d=0;d<r.length;d++){var u="NEEDS-ACTION",m=Users.getEmailId(r[d]);for(var p in e)if(e[p].zuid===r[d]||e[p].email===r[d]){u=e[p].status,m=e[p].email;break}$WC.$CUtil.isEmpty(m)&&(m=l&&c[r[d]]?c[r[d]].EMAILID:r[d]),a.push({status:u,email:m})}else for(var d=0;d<r.length;d++){var h=Users.getEmailId(r[d]);$WC.$CUtil.isEmpty(h)&&(l&&c[r[d]]?m=c[r[d]].EMAILID:h=r[d]),a.push(h)}return a}},showSelectedTime:function(e,t){var i=e.attr("val"),a=e.parent().attr("id");$("#"+a).siblings("input").val(i).removeClass("zcfdk_tmbzoom error").attr("timeval","true"),Clickoutside.handleClickOnChild(t,a)},showReminder:function(e){var t=Events.getObject(e);if(!$WC.$CUtil.isEmpty(t)&&Settings.getFromObj("vcalendar")){var i=Events.getShortTime($Date.time(t.ST)),a=Events.getShortTime($Date.time(t.ET)),s=t.CKEY;ZCScroll.customScroll($("#eventreminder"),!0),html=$WC.template.replace(Template.ReminderHtml,{EUID:e,CKEY:s,TITLE:t.SUM}),html=$WC.template.replace(html,{TIME:i+"&nbsp;&#45;&nbsp;"+a,LOCATION:$WC.$CUtil.isEmpty(t.LOC)?"":$WC.template.replace('<div class="clr0 font15 mrgT10 ellips"><div class="msi-location dIB"></div>{{LOCATION}}</div>',{LOCATION:t.LOC})},"InSecureHTML"),$("#eventreminder").append(html).show()}},fillCreateWin:function(e){var t,i,a="",s=$("#addeventwin"),n=e.ATTENDEES;if($WC.$CUtil.isEmpty(e.REMINDERS)||(i=-parseInt(e.REMINDERS[0].minutes),t=this.getReminderString(i)),s.find("#evtitle").val(e.SUM).removeClass("error").attr("timeval","true"),s.find("#fromdate, #todate").removeClass("error").attr("timeval","true"),s.find("#evelocation").val($WC.$CUtil.isEmpty(e.LOC)?"":e.LOC),s.find("#starttime").text($Date.time(e.ST)),s.find("#endtime").text($Date.time(e.ET)),s.find("#startdate").html($Date.date(e.ST,{shortmonth:!0})).attr("date",$Date.date(e.ST)),s.find("#enddate").html($Date.date(e.ET,{shortmonth:!0})).attr("date",$Date.date(e.ET)),s.find("#startcalendar").attr("val",e.ST),s.find("#endcalendar").attr("val",e.ET),$WC.$CUtil.isEmpty(i)||s.find("#reminderssel").html(t).attr("val",i),n)for(var r=$("#Events-usersuggest-search-field"),o=0;o<n.length;o++){var l;if($zcg._EMAILID!=n[o].email){var c=n[o].email,d=n[o].zuid;$WC.$CUtil.isEmpty(d)?(l=c,d=c):l=Users.getName(d,c);var a=SearchField.getNodeforSelection({uid:d,type:"contact",name:l},!0);$WC.DivEditor.insertObject("Events-usersuggest-search-field",r[0],a)}}},handleTimeChangeInCalendar:function(e,t){e.find("#enddate, #todate, #endtime, #endhours, #endminutes, #endperiod").removeClass("error").attr("timeval","true");var i=parseInt($("#startcalendar").attr("val")),a=parseInt($("#endcalendar").attr("val"));("startdate"===t||"starttime"===t)&&(a=i+Events.TIMESTAMPDIFF),this.isInvalidEventTime(a,i)?e.find("#enddate, #todate, #endtime, #endhours, #endminutes, #endperiod").addClass("error").attr("timeval","false"):Events.TIMESTAMPDIFF=a-i,e.find("#starttime").text($Date.time(i)),e.find("#endtime").text($Date.time(a)),e.find("#startdate").html($Date.date(i)),e.find("#enddate").html($Date.date(a)),e.find("#startcalendar").attr("val",i),e.find("#endcalendar").attr("val",a)},handleModuleStatusChange:function(){SecurityManager.hasPermission(Modules.Events)?$("#ztb-events").show():$("#ztb-events").hide()}},Events={statusText:{"NEEDS-ACTION":Resource.getRealValue("event.pending"),ACCEPTED:Resource.getRealValue("event.accepted"),DECLINED:Resource.getRealValue("common.declined"),TENTATIVE:Resource.getRealValue("event.maybe")},pending:"NEEDS-ACTION",reminderval:[0,5,10,15,20,25,30,45,60,120,240,360,480,720,1440,2880,4320,5760,7200,8640,10080,11520,12960,14400,15840,17280,18720,20160,21600],MAX_HOURS:12,MAX_MINUTES:59,MIN_MINUTES:0,MIN_HOURS:1,TIMESTAMPDIFF:36e5,TIMEDIFFINMINS:60,TIMEMULTIPLEINMINS:30,MIN_YEAR_TIMESTAMP:-22090086e5,MAX_YEAR_TIMESTAMP:410242494e4,EVENTBOT:$zcg._EVENTBOT,init:function(){EventsUI.bindEvents(),SecurityManager.register(Modules.Events,EventsUI.handleModuleStatusChange)},getCalendars:function(e){$ZCAjx.ajax({url:"/v1/calendars",type:"GET",success:function(t){var i=t.data.calendars;$DB.clear("calendars");for(var a=0,s=i.length;s>a;a++)Events.updateCalendars(i[a]);e||Events.get()}})},getWithDelay:function(){Events.getTimer&&clearTimeout(Events.getTimer),Events.getTimer=setTimeout(function(){Events.get()},2e3)},get:function(){$ZCAjx.ajax({url:"/v1/events",type:"GET",success:function(e){var t=e.data.events,i=$WC.$CUtil.isEmpty(e.data.seenevents)?[]:e.data.seenevents;Events.updateSeenEvents(i),$DB.clear("events");for(var a=0;a<t.length;a++)Events.update(t[a]);Home.handleCurrentEvents();var s=$("#addeventwin");if($("#eventcontainer").hasClass("effect-scale"))EventsUI.populate("topbarevlist");else if(s.length)if(EventsUI.populate("evlist"),"preview"===s.attr("mode")){var n=$("#eventshowcontainer"),r=n.attr("eid");if($("#evlist").find('div[id="'+r+'"]').length)EventsUI.preview(r);else{var o=$Util.getSyncedCurrentTime()>n.attr("starttime")?"event.ended.preview":"event.future.preview";UI.updateBanner(Resource.getRealValue(o),2e3,!0),EventsUI.handle.showCreateWin()}}else if("edit"===s.attr("mode")){var l=$("#evsubmit"),r=l.attr("eid"),c=$("#evlist").find('div[id="'+r+'"]');c.length?(c.addClass("sel"),Events.getDetails(r,l.attr("ckey"),Events.updatePreview)):(UI.updateBanner(Resource.getRealValue("event.ended.edit"),2e3,!0),EventsUI.handle.showCreateWin())}}})},getDetails:function(e,t,i){$ZCAjx.ajax({url:"/v1/events/"+e+"/",type:"GET",headers:{calendaruid:t},success:function(e){"function"==typeof i&&i(e)}})},updatePreview:function(e){var t=e.data.uid;$WC.$CUtil.isEmpty(t)||(Events.update(e.data),"preview"===$("#addeventwin").attr("mode")&&EventsUI.preview(t))},create:function(e){$ZCAjx.ajax({url:"/v1/events",type:"POST",data:e,contentType:"application/json",success:function(e){var t=e.data;$WC.$CUtil.isEmpty(t.uid)?($("#eventview").hide(),this.error(e)):(Events.update(t),$("#createevcontainer").length&&(EventsUI.populate("evlist"),$("#evlist").find('div[id="'+t.uid+'"]').attr("loaded",!0),EventsUI.preview(t.uid)))},error:function(e){"undefined"!=typeof e.error_key?"undefined"!=typeof e.error_params&&UI.updateBanner(Resource.getRealValue(e.error_key,[e.error_params]),2e3,!0):UI.updateBanner(Resource.getRealValue("event.added.error"),2e3,!0),$Util.Button.removeLoadAndAddHtml($("#evsubmit"),Resource.getRealValue("common.create"))},status:{loading:$("#evsubmit"),success:"event.created"}})},edit:function(e,t){$ZCAjx.ajax({url:"/v1/events/"+t+"/",type:"PUT",data:e,contentType:"application/json",success:function(e){var i=e.data;if($WC.$CUtil.isEmpty(i.uid)||$WC.$CUtil.isEmpty(i.organizer))$Util.Button.removeLoadAndAddHtml($("#createevcontainer").find("#evsubmit"),Resource.getRealValue("common.create")),UI.updateBanner(Resource.getRealValue("event.edit.nochange"),2e3,!0);else{$Util.Button.removeLoadAndAddTickMark($("#createevcontainer").find("#evsubmit")),i.uid=t;var a=Events.getObject(t),s=a.ATTENDEES?a.ATTENDEES.length:0,n=i.attendees?i.attendees.length:0;if(s!=n)ZCTrack.track("EVENT_USEREDIT");else if(s==n&&n>0){var r=[];i.attendees.forEach(function(e){r.push(e.zuid)});for(var o=0;s>o;o++)if(!r.includes(a.ATTENDEES[o].zuid)){ZCTrack.track("EVENT_USEREDIT");break}}var l=i.dateandtime;(a.ST!=l.start||a.ET!=l.end)&&ZCTrack.track("EVENT_RESCHEDULE"),Events.update(i),EventsUI.populate("evlist"),$("#evlist").find('div[id="'+t+'"]').attr("loaded",!0),EventsUI.preview(t)}},error:function(e){"undefined"!=typeof e.error_key?"undefined"!=typeof e.error_params&&UI.updateBanner(Resource.getRealValue(e.error_key,[e.error_params]),2e3,!0):UI.updateBanner(Resource.getRealValue("event.edit.error"),2e3,!0),$Util.Button.removeLoadAndAddHtml($("#createevcontainer").find("#evsubmit"),Resource.getRealValue("common.create"))}})},updateStatus:function(e,t){var i=$("#statusbuttons");$ZCAjx.ajax({url:"/v1/events/"+e+"/updatestatus",type:"PUT",contentType:"application/json",data:t,success:function(t){for(var a=Events.getObject(e),s=a.ATTENDEES,n=t.data.attendees[0],r=n.email,o=n.status,l=0;l<s.length;l++)if(s[l].email===r){n.zuid=$zcg._ZUID,s[l]=n;break}i.length?i.remove():$("#evpreviewright").find("#eventstatuscnt").remove(),EventsUI.addStatusDropDown(a,o);var c=$("#eventattendeesimg").find('img[uid="'+$zcg._ZUID+'"]');c.siblings('span[purpose="userStatus"]').remove(),c.after('<span purpose="userStatus" title="'+Resource.getRealValue("common.status")+"&nbsp;&nbsp;-&nbsp;&#34;"+Events.statusText[o]+'&#34;" class="msi-'+o.toLowerCase()+'"></span>')},error:function(){i.length&&i.find("input").attr("style","").removeClass("zcevsts"),UI.updateBanner(Resource.getRealValue("event.status.update.failed"),2e3,!0)}})},"delete":function(e){$ZCAjx.ajax({url:"/v1/events/"+e.id+"/",type:"DELETE",headers:{calendaruid:$(e).attr("ckey"),etag:$(e).attr("etag")},success:function(){delete $DB.get("events")[e.id];var t=$("#evlist").find("div.sel[eventbuttons]").attr("id");EventsUI.populate("evlist"),t===e.id?EventsUI.handle.showCreateWin():$("#evlist").find("div[id='"+t+"']").addClass("sel"),Home.handleCurrentEvents(),UI.updateBanner(Resource.getRealValue("event.delete.success"))},error:function(){UI.updateBanner(Resource.getRealValue("event.delete.error"),2e3,!0)}})},markEventAsSeen:function(e){var t=Events.getAllSeenEvents(),i=$("#zceventsnotify");i.find('div[id="'+e+'"]').slideUp(function(){HomeUI.handleRemoveCallBack(i)}),t[e]||$ZCAjx.ajax({url:"/v1/events/"+e+"/markasseen",type:"POST",data:{endtime:Events.getObject(e).ET},success:function(){t[e]=!0,$DB.update("seenevents",t)}})},updateCalendars:function(e){var t=$DB.get("calendars"),i=e.uid;if(t[i]={CKEY:i,name:e.name,isdefault:e.isdefault,category:e.category,ctag:e.ctag,color:e.color},"group"===e.category){var a=e.entityid.split("-");t[i].entity_type=a[0],t[i].entity_id=a[1]}},update:function(e){var t=$DB.get("events"),i=e.uid;t[i]={EUID:i,CKEY:e.caluid,SUM:e.title,ST:e.dateandtime.start,ET:e.dateandtime.end,ETAG:e.etag,ORGANIZER:e.organizer},t[i].ORGANIZERZUID=e.organizerzuid?e.organizerzuid:e.organizer,"undefined"!=typeof e.location&&(t[i].LOC=e.location),"undefined"!=typeof e.description&&(t[i].DESC=e.description),"undefined"!=typeof e.attendees&&(t[i].ATTENDEES=e.attendees),"undefined"!=typeof e.reminders&&(t[i].REMINDERS=e.reminders),t[i].EVENTMANAGEMENT=e.enable_eventmanagement===!0;var a=this.getAllCalendars();"undefined"==typeof a[e.caluid]&&this.getCalendars(!0)},updateSeenEvents:function(e){for(var t={},i=0;i<e.length;i++)t[e[i]]=!0;$DB.update("seenevents",t)},getAll:function(){return $DB.get("events")},getObject:function(e){return $DB.get("events")[e]},getCalendar:function(e){return $DB.get("calendars")[e]},getAllCalendars:function(){return $DB.get("calendars")},getAllSeenEvents:function(){return $DB.get("seenevents")},isEndedEvent:function(e){return e<$Util.getSyncedCurrentTime()},isExist:function(e){return this.getObject(e)},isAnyEventToday:function(){var e=Events.getAll();if($Util.getObjectKeysLength(e))for(var t in e)if($Date.isSameDay(e[t].ST))return!0;return!1},removeEndedEvent:function(e){var t=$("#eventreminder");!t.is(":visible")&&!t.find('[id="'+e+'"]').length>0&&delete $DB.get("events")[e],Home.handleCurrentEvents()},getGMTTimeOffset:function(){var e=new Date($Util.getSyncedCurrentTime()).toString();return e.substring(e.indexOf("GMT"),e.indexOf("GMT")+8)},getShortTime:function(e){var t=e.indexOf(":");return 0===parseInt(e.substring(t+1,t+3))&&(e=e.replace(":00"," ")),e=e.replace(e.substring(t-2,t),parseInt(e.substring(t-2,t)))},isProperReminder:function(e,t){var i=$Util.getSyncedCurrentTime()-6e4,a=t-60*e*1e3;return!(i>a&&"0"!=e)},isEventBot:function(e){return e===this.EVENTBOT.id},getEventBotName:function(){return this.EVENTBOT.name},getEventBotImageURL:function(){return this.EVENTBOT.imageurl}},ShowTime={errorCodes:{PORTAL_NOT_MAPPED:25001,INTEGRATION_DISABLED:25002},scheduleShowTimeSession:function(e,t){function i(e,t,i){$WC.$Dlg.alert({id:"showtimealertwin",bodyhtml:$WC.template.replace("<div>{{content}}</div>",{$content:e}),imagehtml:'<div class="msi-showtime f40"></div>',buttons:[{text:Resource.getRealValue(t),action:i}]})}$ZCAjx.ajax({url:"/v1/showtime/"+e+"/schedulesession",type:"POST",ignorableerrorcodes:[ShowTime.errorCodes.PORTAL_NOT_MAPPED,ShowTime.errorCodes.INTEGRATION_DISABLED],data:{title:t},success:function(e){e.data.error?UI.updateBanner(Resource.getRealValue("showtime.schedule.session.error"),2e3,!0):i("showtime.start.info","common.start",function(){window.open(e.data.presenterurl)})},error:function(e){if(e.error_code==ShowTime.errorCodes.PORTAL_NOT_MAPPED||e.error_code==ShowTime.errorCodes.INTEGRATION_DISABLED){var t=e.error_code==ShowTime.errorCodes.INTEGRATION_DISABLED?"showtime.integration.disabled":"showtime.portal.map";_isAppAccountAdmin()?i(t+".hint","common.proceed",function(){window.open($zcg._SERVERURL+"/setup/zohoshowtime")}):i(t+".admin","common.okgotit")}}})}};var Feeds={},FeedsUI={};Feeds={getUnreadFeeds:function(){$ZCAjx.ajax({url:"/unreadzmsg.do",success:function(e){if("undefined"!=typeof e.tableToRowList){var t=e.tableToRowList.ZohoMessages;if("undefined"!=typeof t)return void FeedsUI.populate(t)}$("#feedlist").html('<div id="feedempty" class="nomail-info">'+Resource.getRealValue("feed.none")+"</div>")},error:function(){UI.updateBanner(void 0,2e3,!0),$("#feedslist").html('<div id="feedempty" class="nomail-info">'+Resource.getRealValue("feed.get.error")+"</div>")}})},getNotificationCount:function(e){$ZCAjx.ajax({url:"/getallnoti.do",data:{all:e},success:function(e){FeedsUI.updateUnreadCount($("#ztb-feedcount"),parseInt(e.zmsgcount))}})}},FeedsUI={init:function(){$("#ztb-feed").append('<div id="ztb-feedcount" class="msgnotify" style="display:none">0</div>'),this.bindEvents()},updateUnreadCount:function(e,t){t=$Util.trimNotificationCount(t),$Util.updateNotificationCount(e,t)},bindEvents:function(){$("#ztb-feed").on("click",function(e){FeedsUI.updateUnreadCount($("#ztb-feedcount"),0),Clickoutside.bind({event:e,srcid:"ztb-feed",destid:"feedcontainer"})}),$("#feedcontainer").on("click","[purpose]",function(){var e=$(this),t=e.attr("purpose");if("open"===t){e.removeClass("zcfdunrd");var i=e.attr("url");i&&window.open(i,"_blank")}else if("clear"===t){var a=$("#feedcontainer");a.find("#feedlist").html('<div id="feedempty" class="nomail-info">'+Resource.getRealValue("feed.none")+"</div>"),a.find("#feedclearbtn").hide()}})},populate:function(e){for(var t=e.length,i=$("#feedcontainer"),a="",s=0;t>s;s++)a+=this.getFeedHTML(e[s]);i.find("#feedlist").html(a),i.find("#feedclearbtn").show()},addNewFeed:function(e){var t=$("#feedcontainer"),i=this.getFeedHTML(e);if(t.find("#feedempty").length?(t.find("#feedlist").html(i),t.find("#feedclearbtn").show()):t.find("#feedlist").prepend(i),"none"===t.css("display")){var a=$("#ztb-feedcount");this.updateUnreadCount(a,parseInt(a.html())+1)}},getFeedHTML:function(e){var t='<div {FEEDURL} purpose="open" class="zcfdcntmn {FEEDLINK} zcfdunrd"><div class="zcfdtime ellips">'+$Date.daytime(e.TIME,{withtime:!0})+'</div><div class="zcfdcnt_lft"><div title="{FEEDTITLE}" class="zcfdtit ellips">{FEEDTITLE}</div><div title="{FEEDBODYTITLE}" class="zcfdmsg ellips">{FEEDBODY}</div></div></div>',i="",a="";return e.MSG=$WC.$CUtil.processXSS(e.MSG),e.MSG=e.MSG.replace(/_/g," "),e.PARAMS&&(e.PARAMS=$WC.$CUtil.processXSS(e.PARAMS),e.MSG=Resource.replaceParams(e.MSG,e.PARAMS.split(","))),""===e.URL?(t=t.replace(/{FEEDURL}/g,"").replace(/{FEEDLINK}/g,"").replace(/{FEEDBODY}/g,e.MSG),i=e.SENDER||e.DNAME?Resource.getRealValue("common.says.extended",[Users.getName(e.SENDER,e.DNAME)]):Resource.getRealValue(e.URLSTRING),a=e.MSG):(t=t.replace(/{FEEDURL}/g,'url="'+e.URL+'"').replace(/{FEEDLINK}/g,"cur").replace(/{FEEDBODY}/g,"<span>"+e.URLSTRING+"</span>"),i=e.MSG,a=e.URLSTRING),t.replace(/{FEEDTITLE}/g,i).replace(/{FEEDBODYTITLE}/g,a)}};var BaseComponent=function(e){this.module=e.type,this.id=e.id,this.name=e.name,this.photo_id=e.photo_id,e.store_appid&&(this.store_appid=e.store_appid,this.store_appname=e.store_appname)};BaseComponent.prototype={getModule:function(){return this.module},getID:function(){return this.id},getObject:function(){switch(this.module){case Integration.Components.Command:return Commands.getObject(this.id);case Integration.Components.Bot:return Bots.getObject(this.id);case Integration.Components.MessageAction:return MessageActions.getObject(this.id);case Integration.Components.Scheduler:return Schedulers.getObject(this.id);case Integration.Components.Function:return Functions.getObject(this.id)}},getName:function(){var e=this.getObject(),t=this.name;return"undefined"!=typeof e&&(t=e.name),this.module!==Integration.Components.Command||t.startsWith("/")||(t="/"+t),t},getImageURL:function(){switch(this.module){case Integration.Components.Command:return Commands.getImgUrl(this.id);case Integration.Components.Bot:var e=Contacts.getWmsBotId(this.id);return Bots.getImgUrl(e);case Integration.Components.MessageAction:return MessageActions.getDefaultImgUrl()}return Functions.getDefaultImgUrl()},getCreatorName:function(){var e=this.getObject();return"undefined"!=typeof e?Users.getName(e.creator,e.creator_name):void 0},getStoreAppId:function(){var e=this.getObject();return e&&e.appid?e.appid:this.store_appid},getStoreAppName:function(){var e=this.getObject();return e&&e.appdetails?e.appdetails.name:this.store_appname}};var IntegrationsResponse={},IntegrationConsents={};IntegrationsResponse={htmls:{ephemeralMessage:'<div integresponseelem {{parent_attributes}}><div purpose="sender" sender="integration_response" class="sender me ellips floatl"><div class="chtimg floatl"><img {{attributes}} src="{{image_src}}" class="cur"></div><span {{attributes}} class="zctxtseln cur">{{name}}</span></div><div class="msgtxt me cmdresp w100 dIB"><pre class="zcmsgcnt zccmdwrp"><div msgcontent class="zcbddtd {{custom_class}}">{{message_content}}</div><div class="cmdophnt flexC"><div class="flexG font13 ellips mR10"><span title="{{visibility_hint}}" class="msi-msgvisbl font13"></span>{{visibility_hint}}</div><div class="fshrink flexC">{{share_response_button}}<span drebuttons purpose="removeTempResponse" class="zc-link dot-sprtr font12">{{close}}</span></div></div></pre></div></div>'},populateOutput:function(e,t,i){if($("#"+i).find("#loadingline").remove(),"undefined"!=typeof t){var a="",s={};if("Consent"!==t.status){if("undefined"!=typeof t.output){var n=t.output.type;if("form_error"!==n&&"form_modification"!==n&&"form_values"!==n&&FormDialogsUI.destroy(),"form"===n)FormDialogs.show(t);else if("form_error"===n)FormDialogs.handleError(t);else if("form_modification"===n)FormDialogs.handleModifications(t.output.actions);else if("form_values"===n)FormDialogs.updateInputValues(t.output.target,t.output.options);else if("undefined"!=typeof t.output.widget){var r=JSON.parse(output.widget);$WC.Widgets.construct(r)}else"undefined"!=typeof t.output.msg&&(e.module===Integration.Components.Command&&"Failure"===t.status&&(a=CommandsUI.getErrorResponseHTMLForCustomCommands(e.id)),$WC.$CUtil.isEmpty(a)&&(a=MsgTemplate.getMessageText(t.output)))}else if(e.module===Integration.Components.Command){"undefined"==typeof t.output&&(t.output={}),t.output.chid=i;var o=CommandsUI.getResponseDataForCustomCommands(e.id,t);a=o.html,s.customClass=o.customClass}if(!$WC.$CUtil.isEmpty(a)){s.hideShareButton="Success"!==t.status||e.module===Integration.Components.Command&&Commands.isDefaultCommand(e.id);var l=this.getDREResponseHTML(e,t.output,a,s);$("#"+i).find("#msgarea").append(l),ChatUI.isExist(i)&&ChatUI.exist[i].getScrollDown(200)}}this.showPromptAndDebugMessages(e,t,i)}},showPromptAndDebugMessages:function(e,t,i){"Failure"!==t.status||$WC.$CUtil.isEmpty(t.resumeUrl)?"Consent"===t.status&&IntegrationConsents.populate(e,t,i):this.showOAuthPrompt(e.name,t),IntegrationsCwin.isCurrent(i)&&this.showInfoInDelugeEditor(t)},getDREResponseHTML:function(e,t,i,a){var s="";"undefined"!=typeof t.chid&&(s='chid="{{chid}}" '),"undefined"!=typeof t.time&&(s+=' time="{{time}}"');var n="",r='<div class="zc-link font12" drebuttons purpose="shareTempResponse">{{share_hint}}</div>';a.hideShareButton&&(r="");var o=e.name,l=e.imageUrl,c=e.module,d=e.id;if("undefined"!=typeof t.meta){var u=t.meta.message_source;"undefined"!=typeof u&&"undefined"!=typeof u.type&&(o=u.name,c=u.type,d=u.id,u.store_appname&&c!==Integration.Components.Command&&c!==Integration.Components.Bot&&c!==Integration.Components.MessageAction&&(o=u.store_appname))}switch(c){case Integration.Components.Command:Commands.isDefaultCommand(d)||(n='uid="'+d+'" hover="true" elemtype="commandinfo"',"undefined"!=typeof d&&(l=Commands.getImgUrl(d)));break;case Integration.Components.Bot:d=Contacts.getWmsBotId(d),n='botid="'+d+'" hover="true" elemtype="user" uid="'+d+'"',"undefined"!=typeof d&&(l=Bots.getImgUrl(d));break;case Integration.Components.MessageAction:l=MessageActions.getDefaultImgUrl()}if(!$WC.$CUtil.isEmpty(t.meta)&&!$WC.$CUtil.isEmpty(t.meta.usermessagedetails)&&!$WC.$CUtil.isEmpty(t.meta.usermessagedetails.custom_sender_name)){var m=t.meta.usermessagedetails;o=m.custom_sender_name,$WC.$CUtil.isEmpty(t.meta.usermessagedetails.custom_sender_imageurl)||(l=t.meta.usermessagedetails.custom_sender_imageurl)}return"undefined"==typeof l&&(l=Functions.getDefaultImgUrl()),html=$WC.template.replace(this.htmls.ephemeralMessage,{custom_class:$WC.$CUtil.isEmpty(a.customClass)?"msgcontent":a.customClass,message_content:i,share_response_button:r,attributes:n,parent_attributes:s},"InSecureHTML"),html=$WC.template.replace(html,{$visibility_hint:"commands.visible",$share_hint:"commands.response.share",$close:"common.close",chid:t.chid,time:t.time,name:o,image_src:l})},showInfoInDelugeEditor:function(e){DREImpl.handle.closeoutput();var t="";if($WC.$CUtil.isEmpty(e.errorMessage)||(t+='<div class="bold font14 erclr">'+Resource.getRealValue("commands.error")+"</div><div>"+$WC.$CUtil.processXSS(e.errorMessage)+(e.lineNumber>0?" ("+Resource.getRealValue("commands.error.lineno",""+e.lineNumber)+")":"")+"</div>"),!$WC.$CUtil.isEmpty(e.debugLogs)){var i=e.debugLogs;t+='<div class="zcdrelogs"><div class="bold font14">'+Resource.getRealValue("commands.debuginfo")+"</div>";for(var a=0;a<i.length;a++){var s="";s+=$Util.isValidJSON(i[a],!0)?'<div class="zcdebugsub"><span drebuttons purpose="jsonView" json="{{debug}}"><span title="{{title}}" class="msi-external mrgR5 cur"></span></span>{{debug}}</div>':"{{debug}}<br>",s=$WC.template.replace(s,{debug:i[a],$title:"drelogs.view_debug_info"}),t+=s}t+="</div>"}$WC.$CUtil.isEmpty(t)||DREImpl.showDebugInfo(t)},showOAuthPrompt:function(e,t){if(t.resumeUrl){t.connectionDetails.name&&(e=t.connectionDetails.name);var i=[];if("undefined"!=typeof t.connectionDetails.scope)for(var a in t.connectionDetails.scope){var s=t.connectionDetails.scope[a],n=s["Scope Name"];s["Scope Value"]&&n&&n.indexOf("/")>0&&(0==n.indexOf("Zoho")||0==n.indexOf("DRE/"))&&i.push($WC.$CUtil.processXSS(s["Scope Value"]))}$WC.$Dlg.confirm({id:"oauthprompt",version:2,"class":"zcdalogbx zcdalogbxgrn zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<img style="object-fit:contain; width:80px; height:80px; margin-bottom:10px;" src="'+t.connectionDetails.imageUrl+'">',ispositive:!0,header:Resource.getRealValue("app.req.permission",[$WC.$CUtil.processXSS(e),$WC.$CUtil.processXSS(t.connectionDetails.serviceName)])}),bodyhtml:0==i.length?"":$WC.$Dlg.frameBodyInfoHTML({info:i,infoheader:Resource.getRealValue("app.req.scopes",[$WC.$CUtil.processXSS(e)])}),buttons:[{text:Resource.getRealValue("common.authenticate"),colour:1,action:function(){window.open(t.resumeUrl)}}]})}}},IntegrationConsents={htmls:{header:'<span class="cir-38 mrgR10"><img src="{{img_src}}"></span><span class="font22 fontb bot-dlg-clr">{{component_name}}</span>',latest:'<div id="new-consents" class="flex-col h100"><div class="botdialog-title ellips">{{brief}}</div><div consents_container class="flexG ovrflwH posrel"><div class="flex-col">{{consents}}</div></div></div>',granted:'<div id="granted-consents" class="flex-col h100 granted-consents"><div class="botdialog-title ellips">{{brief}}</div><div consents_container class="flexG ovrflwH posrel"><div class="flex-col">{{consents}}</div></div></div>',wholeExtension:'<div id="extension-consents" class="flex-col h100 extension-consents"><div class="botdialog-title ellips">{{brief}}</div><div consents_container class="flexG ovrflwH posrel"><div class="flex-col">{{consents}}</div></div></div>',body:'<div consent_key="{{key}}" chid="{{chid}}" store_appid="{{store_appid}}" class="mcontent"><div id="consents-loading" class="w100 h100 dN mrgB25 posabs"><div class="zcldng"></div></div><div class="flex-col h100 botDialog-body"><div id="consents-container" class="posrel ovrflwH">{{new_consents}}{{granted_consents}}</div><div class="fshrink mrgTB25 textC">{{toggle_granted_consents}}{{extension_consents}}<button drebuttons purpose="executeWithConsent" class="dbtn botdialog-btn">{{proceed}}</button><p class="textL mrgT15 mrgL30 font11"><strong>*</strong> {{remember_note}}</p></div></div></div>',grantedConsentsView:'<div class="mcontent"><div style="max-height: 500px;" class="flex-col h100">{{granted_consents}}<div class="fshrink mrgTB25 textC"><button drebuttons purpose="revokeConsents" component_id="{{component_id}}" type="{{type}}" class="dbtn botdialog-btn">{{revoke}}</button></div></div></div>',variables:'<div drebuttons purpose="showDetailedConsents" class="botDtl-item flex"><span class="botDtl-icn msi-guest"></span><div class="flexG ellips paddR10"><div class="fontb ellips font18">{{user_info}}</div><div class="ellips consent-hint">{{variables_brief}}</div><div drebuttons purpose="detailedConsents" class="botDtl-list-desc"><div class="dashed-box">{{variable_explanations}}</div></div></div><span class="msi-darw bot-dlg-clr"></span></div>',delugeTask:'<div class="botDtl-field flex"><span>{{task}}</span>{{components}}</div>',delugeTasks:'<div drebuttons purpose="showDetailedConsents" class="botDtl-item flex"><span class="botDtl-icn msi-deluge"></span><div class="flexG paddR10 ellips"><div class="fontb ellips font18">{{deluge_tasks}}</div><div class="ellips consent-hint">{{deluge_tasks_brief}}</div><div drebuttons purpose="detailedConsents" style="display:none;" class="botDtl-list-desc"><div class="dashed-box">{{tasks}}</div></div></div><span class="msi-darw bot-dlg-clr"></span></div>',externalAPI:'<div class="botDtl-field flex"><span>{{api}}</span>{{components}}</div>',externalAPIs:'<div drebuttons purpose="showDetailedConsents" class="botDtl-item flex"><span class="botDtl-icn msi-embdimg"></span><div class="flexG paddR10 ellips"><div class="fontb ellips font18">{{external_api}}</div><div class="ellips consent-hint">{{external_api_brief}}</div><div drebuttons purpose="detailedConsents" style="display:none;" class="botDtl-list-desc"><div class="dashed-box">{{apis}}</div></div></div><span class="msi-darw bot-dlg-clr"></span></div>'},populate:function(e,t,i){if(!$WC.$Win.isExist("platformconsentprompt")){var a=t.message_source,s=new BaseComponent(a),n=$WC.template.replace(IntegrationConsents.htmls.header,{component_name:s.getName(),img_src:s.getImageURL()}),r=$WC.$Win.create({id:"platformconsentprompt","class":"botDialog",header:n,html:IntegrationConsents.getConsentsWindowHTML(t,s,i)});r.find("button").focus()}},getGrantedConsentView:function(e){var t=$WC.template.replace(this.htmls.granted,{consents:this.getConsentsHTML(e)},"InSecureHTML");t=$WC.template.replace(t,{$brief:"platformconsents.granted.brief",$hide:"common.hide"});var i=$WC.template.replace(this.htmls.grantedConsentsView,{granted_consents:t},"InSecureHTML");return i=$WC.template.replace(i,{$revoke:"common.revoke",$granted_access:"platformconsents.granted.brief"})},getConsentsWindowHTML:function(e,t,i){var a=this.getConsentsHTML(e.consents),s="",n="";if(!$WC.$CUtil.isEmptyObject(e.granted_consents)&&!t.store_appid){var r=this.getConsentsHTML(e.granted_consents);s=$WC.template.replace(this.htmls.granted,{consents:r},"InSecureHTML"),s=$WC.template.replace(s,{$brief:"platformconsents.granted.brief"}),n='<p class="textC mrgB15">{{granted_note}}<span class="consent-view-link mrgL5" drebuttons purpose="toggleGrantedConsents"><span>{{view}}</span><span class="dN">{{hide}}</span></span></p>',n=$WC.template.replace(n,{$granted_note:"platformconsents.grantednote"})}var o=$WC.template.replace(this.htmls.latest,{consents:a},"InSecureHTML");o=$WC.template.replace(o,{$brief:["platformconsents.brief",[t.name]],$proceed:"platformconsents.proceed"});var l="";t.store_appid&&(l='<div class="textC mrgB15"><span>{{checkbox}}<span>{{extension_consent_text}}</span></span><span class="consent-view-link mrgL5" drebuttons purpose="toggleExtensionConsents"><span>{{view}}</span><span class="dN">{{hide}}</span></span></div>',l=$Util.CustomCheckbox.construct(l,[{html:'<input id="allow_for_extension" type="checkbox" class="zcunrdchkbx"/>',key:"{{checkbox}}",checked:!1}]),l=$WC.template.replace(l,{$extension_consent_text:["platformconsents.extension.brief",[t.store_appname]]}));var c=$WC.template.replace(this.htmls.body,{new_consents:o,granted_consents:s,toggle_granted_consents:n,extension_consents:l},"InSecureHTML");return c=$WC.template.replace(c,{$proceed:"platformconsents.proceed",$note:"channel.deluge.note",$remember_note:"platformconsents.remembernote",$granted_access:"platformconsents.granted.brief",$view:"common.view",$hide:"common.hide",key:e.consent_key,store_appid:t.store_appid?t.store_appid:"",chid:i})},addExtensionConsentsInView:function(e,t){var i=this.getExtensionConsentsHTML(e,t);$("#consents-container").append(i)},getExtensionConsentsHTML:function(e,t){var i=this.getConsentsHTML(e),a=$WC.template.replace(this.htmls.wholeExtension,{consents:i},"InSecureHTML");return a=$WC.template.replace(a,{$brief:["platformconsents.extension.title",[t]]})},getConsentsHTML:function(e){function t(e){var t="";if(!$WC.$CUtil.isEmpty(e))for(var i=0;i<e.length;i++)t+=$WC.template.replace('<span class="zcmsgsrc">{{component_type}}</span>',{component_type:e[i]});return t}function i(e){return Markdown.apply($Util.xssAndEscapeReplacementString(e))}var a="";if(e.variables&&!$WC.$CUtil.isEmptyObject(e.variables)){for(var s=e.variables.details,n="",r=0;r<s.length;r++)n+=$WC.template.replace('<div class="botDtl-field flex"><span class="flexG">{{text}}{{components}}</span></div>',{text:i(s[r].text),components:t(s[r].components)},"InSecureHTML");a+=$WC.template.replace(this.htmls.variables,{user_info:i(e.variables.title),variables_brief:i(e.variables.description),variable_explanations:n},"InSecureHTML")}if(e.deluge_tasks&&!$WC.$CUtil.isEmptyObject(e.deluge_tasks)){for(var o=e.deluge_tasks.details,l="",r=0;r<o.length;r++)l+=$WC.template.replace(this.htmls.delugeTask,{task:i(o[r].text),components:t(o[r].components)},"InSecureHTML");a+=$WC.template.replace(this.htmls.delugeTasks,{deluge_tasks:i(e.deluge_tasks.title),deluge_tasks_brief:i(e.deluge_tasks.description),tasks:l},"InSecureHTML")}if(e.api_calls&&!$WC.$CUtil.isEmptyObject(e.api_calls)){for(var c=e.api_calls.details,d="",r=0;r<c.length;r++)d+=$WC.template.replace(this.htmls.externalAPI,{api:i(c[r].text),components:t(c[r].components)},"InSecureHTML");a+=$WC.template.replace(this.htmls.externalAPIs,{external_api:i(e.api_calls.title),external_api_brief:i(e.api_calls.description),apis:d},"InSecureHTML")}return a},handle:{showDetailedConsents:function(e){var t=$(e.currentTarget);t.attr("purpose","hideDetailedConsents").addClass("active"),t.find('[drebuttons][purpose="detailedConsents"]').slideDown(function(){var e=t.closest("[consents_container]");ZCScroll.customScroll(e,!0),$Util.scrollToViewportTop(t,e,100)})},hideDetailedConsents:function(e){var t=$(e.currentTarget);t.attr("purpose","showDetailedConsents").removeClass("active"),t.find('[drebuttons][purpose="detailedConsents"]').slideUp(function(){var e=t.closest("[consents_container]");ZCScroll.customScroll(e,!0)})},executeWithConsent:function(e){var t=$("#platformconsentprompt").find("[consent_key]");Executions.executeWithConsent(t.attr("consent_key"),t.attr("chid"),$(e.currentTarget))}}},FormDialogsUI=function(){var e={base:'<section form-id="{{form_id}}" class="zc-form-body"><div class="font14 clr8 lin21">{{hint}}</div><div inputs>{{inputs_html}}</div></section><footer class="zc-form-footer"><div class="w100 h100 dflx fjustifySB"><div class="flexC"><span class="zc-component"><img src="{{component_img_src}}"></span><p>{{component_name}}</p></div><div class="flexC flx-rowR"><button form_buttons purpose="submit" tab-index="-1" class="buttn_pos">{{submit_btn_txt}}</button><button form_buttons purpose="cancel" tab-index="-2" class="buttn_neg btn evbtn mrgR20">{{cancel_btn_txt}}</button></div></div><div class="zc-form-errcntr"><span form-attr="global-error"></span><span form_buttons purpose="closeFormError" class="msi-close cur"></span></div></footer>',input:'<div form-attr="input-container" class="font14 mrgT20 posrel {{disabled_class}}"><div class="zc-form-input-hdr"><span class="fontb">{{display_label}}</span>{{mandatory_input_html}}<span class="clr9 mrgL5 fntnrml zc-form-hint">{{hint}}</span></div>{{input_html}}<div form-attr="error" class="zc-form-error-cntr"></div></div>',number:'<div class="posrel"><input id="form-dialog-{{name}}" type="text" {{size_attributes}} form-attr="input" form-input-name="{{name}}" class="zc-form-input" tab-index="{{index}}" placeholder="{{placeholder}}" value="{{default_value}}"/><span class="zc-form-icons zc-form-border-none"><span title="{{input_type_tooltip}}" class="fontb">123</span></span></div>',singleLineInput:'<div class="posrel"><input id="form-dialog-{{name}}" type="{{text_input_type}}" {{size_attributes}} form-attr="input" form-input-name="{{name}}" class="zc-form-input" tab-index="{{index}}" placeholder="{{placeholder}}" value="{{default_value}}"/><span class="zc-form-icons zc-form-border-none"><span title="{{input_type_tooltip}}" class={{format_class}}></span></span></div>',multiLineInput:'<textarea id="form-dialog-{{name}}" form-attr="input" form-input-name="{{name}}" class="h100 w100" tab-index="{{index}}" placeholder="{{placeholder}}">{{default_value}}</textarea>',datePicker:'<div form_buttons purpose="showDatePicker" class="posrel cur"><input form-input-name="{{name}}" form-attr="input" input_buttons="datePicker" tab-index="{{index}}" input_value value="{{default_value}}" placeholder="{{placeholder}}" class="zc-form-input zc-form-date-prvw textL cur"/><span class="zc-form-icons"><div loading class="form-input-loader dN"><span></span><span></span><span></span></div><span class="msi-calndr zcclr font15"></span><span form_buttons purpose="clearDatePicker" class="msi-close zcclr"></span></span><div id="form-dialog-{{name}}" form_scroll class="date-picker-wrp" style="display: none;"><div element="calendar" class="date-picker"></div></div></div>',singleSelectDropDown:'<div class="zcdrpdwn cur drpdwn-wrp"><input id="form-dialog-{{name}}" input_buttons="dropdown" class="zc-form-input textL cur" tab-index="{{index}}" form-input-name="{{name}}" form-attr="input" value input_value="{{default_value}}" placeholder="{{placeholder}}"><div form_scroll dropdown_container class="drpdwn-option" style="display:none;"><div class="option-list" data-auto-result></div></div><span class="zc-form-icons"><div loading class="form-input-loader dN"><span></span><span></span><span></span></div><span class="msi-darrw zcclr"></span><span form_buttons purpose="clearDropdown" class="msi-close zcclr cur"></span>{{refresh_button}}</span></div>',multiSelectDropDown:'<div class="cur zc-form-multi-sel"><span class="zc-form-icons"><div loading class="form-input-loader dN"><span></span><span></span><span></span></div><span class="msi-darrw zcclr"></span>{{refresh_button}}</span><div id="form-dialog-{{name}}" form-input-name="{{name}}" form-attr="input" value="{{default_value}}" class="zc-form-input"><span data-selections></span><input data-auto-input tab-index="{{index}}" placeholder="{{placeholder}}"/></div><div dropdown_container form_scroll class="drpdwn-option" style="display:none;"><div class="option-list" data-auto-result></div></div></div>',nativeSingleSelectDropDown:'<div id="forminput-{{name}}" form_buttons purpose="focusInput" class="cur"><input id="form-dialog-{{name}}" input_buttons="dropdown" form_buttons purpose="showNativeDropdown" class="zc-form-input textL cur" tab-index="{{index}}" form-input-name="{{name}}" form-attr="input" placeholder="{{placeholder}}"><span class="zc-form-icons"><div loading class="form-input-loader dN"><span></span><span></span><span></span></div><span class="msi-darrw zcclr"></span><span form_buttons purpose="clearDropdown" class="msi-close zcclr cur"></span></span><div id="forminput-{{name}}-results" form_scroll class="zc-native-sel-cntr"><div class="ellips drsrchholder"><div class="srchin"><span class="msi-srchicon"></span><input id="forminput-{{name}}-search-field" class="bornone w100" placeholder="{{search}}"/></div></div><div id="forminput-{{name}}-list" class="zc-native-sel-list macscroll"></div></div></div>',nativeMultiSelectDropDown:'<div id="forminput-{{name}}" form_buttons purpose="focusInput" class="cur zc-form-multi-sel"><span class="zc-form-icons"><div loading class="form-input-loader dN"><span></span><span></span><span></span></div><span class="msi-darrw zcclr"></span></span><div id="form-dialog-{{name}}" form-input-name="{{name}}" form-attr="input" class="zc-form-input"><span data-selections></span><input id="forminput-{{name}}-search-field" tab-index="{{index}}" placeholder="{{placeholder}}"/></div><div id="forminput-{{name}}-results" form_scroll class="zc-native-sel-cntr"><div id="forminput-{{name}}-list" class="zc-native-sel-list macscroll"></div></div></div>'},t=function(e){for(var t="",i=0;i<e.length;i++)t+=a(e[i]);return t},a=function(e){var t;switch(e.type){case"number":t=n(e);break;case"text":t=r(e);break;case"textarea":t=o(e);break;case"select":t=l(e);break;case"date":t=d(e);break;case"native_select":t=u(e);break;case"dynamic_select":t=c(e)}return $WC.template.replace(t,{index:i,disabled_class:e.disabled?"zc-input-disable":""})},s=function(e,t){var i="";return t.min_length&&(i+=' minlength="'+t.min_length+'" '),t.max_length&&(i+=' maxlength="'+t.max_length+'" '),e=$WC.template.replace(e,{mandatory_input_html:t.mandatory?'<span class="zc-mntry bold">*</span>':"",size_attributes:i.trim()},"InSecureHTML"),$WC.template.replace(e,{name:t.name,hint:t.hint?t.hint:"",display_label:t.label,placeholder:t.placeholder,default_value:t.value?t.value:""})},n=function(t){var i=$WC.template.replace(e.input,{input_html:e.number},"InSecureHTML");i=s(i,t);var a="";return t.min&&(a+=' min="'+t.min+'" '),t.max&&(a+=' max="'+t.max+'" '),i=$WC.template.replace(i,{size_attributes:a.trim()},"InSecureHTML"),i=$WC.template.replace(i,{$input_type_tooltip:"formdialog.format.tooltip.number"})},r=function(t){var i=$WC.template.replace(e.input,{input_html:e.singleLineInput},"InSecureHTML");i=s(i,t);var a="",n="";if(t.format)switch(n="formdialog.format.tooltip."+t.format,t.format){case"email":a="msi-at";break;case"url":a="msi-guesturl";break;case"tel":a="msi-call";break;case"password":a="msi-scrtecht"}return i=$WC.template.replace(i,{text_input_type:t.format&&"password"===t.format?t.format:"text",format_class:a,$input_type_tooltip:n})},o=function(t){var i=$WC.template.replace(e.input,{input_html:e.multiLineInput},"InSecureHTML");return i=s(i,t)},l=function(t){var i=$WC.template.replace(e.input,{input_html:t.multiple?e.multiSelectDropDown:e.singleSelectDropDown},"InSecureHTML");return i=$WC.template.replace(i,{refresh_button:""}),i=s(i,t)},c=function(t){var i=$WC.template.replace(e.input,{input_html:t.multiple?e.multiSelectDropDown:e.singleSelectDropDown},"InSecureHTML");return i=$WC.template.replace(i,{refresh_button:$WC.template.replace('<span form_buttons purpose="refreshDropdown" title="{{title}}" class="zcf-history zcclr posa"></span>',{$title:"formdialog.refresh"})},"InSecureHTML"),i=s(i,t)},d=function(t){var i=$WC.template.replace(e.input,{input_html:e.datePicker},"InSecureHTML");return i=s(i,t)},u=function(t){var i=$WC.template.replace(e.input,{input_html:t.multiple?e.nativeMultiSelectDropDown:e.nativeSingleSelectDropDown},"InSecureHTML");return i=s(i,t),i=$WC.template.replace(i,{$search:"smiley.search"})},m=function(i){var a=i.output,s=i.message_source,n=new BaseComponent(s),r={component_img_src:n.getImageURL(),component_name:n.getName(),form_id:a.id,hint:a.hint?a.hint:"",$cancel_btn_txt:"common.cancel"};s.store_appid&&(r.component_img_src=Applications.getImgUrlById(s.store_app_photoid),r.component_name=s.store_appname),a.button_label?r.submit_btn_txt=a.button_label:r.$submit_btn_txt="common.submit";var o=$WC.template.replace(e.base,r);return o=$WC.template.replace(o,{inputs_html:t(a.inputs)},"InSecureHTML")};return{getHTML:m,getInputHTML:a,destroy:function(){FormDialogs.clearData(),$WC.$Win.destroy("form_dialog")}}}(),FormDialogs=function(){var e,t={},i={},a={},s=function(t){t.on("click","[form_buttons]",function(e){e.stopPropagation();var t=$(e.currentTarget).attr("purpose");S[t](e)}),t.on("keydown","[input_buttons]",function(e){r(e,this)}),t.on("keyup","[input_buttons]",function(e){o(e,$(this))}),t.on("change",'input[form-attr="input"],textarea',function(e){y($(e.target))}),t.on("focusout","[tab-index]",function(e){var t=$(e.target);"undefined"==typeof t.attr("purpose")&&y(t,e)});for(var i=e.output.inputs,a=0;a<i.length;a++)l(i[a]);t.find("section[form-id]").on("scroll",function(){n()})},n=function(){var e=$("#form_dialog"),t=e.find("[form_scroll]:visible");if(t.length>0)for(var i=e[0].getBoundingClientRect().top,a=0;a<t.length;a++){var s=$(t[a]),n=s.parents('[form-attr="input-container"]'),r=n[0].getBoundingClientRect().bottom-i,o=e.find("footer")[0].getBoundingClientRect().top-i,l=o-s.height();r>l&&o>r?s.addClass("zc-form-fixedinp").css("top",r):(s.removeClass("zc-form-fixedinp").css("top","auto"),r>o&&(s.hide(),Clickoutside.clear(s[0].id)))}},r=function(e,t){var i=e.keyCode;i===$zcg.TAB_KEYCODE?Clickoutside.handleClickOnChild(e,t):i!==$zcg.ESCAPE_KEYCODE&&e.preventDefault()},o=function(e,t){var i=e.keyCode;if(i!==$zcg.ESCAPE_KEYCODE&&e.stopPropagation(),i===$zcg.ENTER_KEYCODE)t.click();else if(i===$zcg.BACKSPACE_KEYCODE||i===$zcg.DELETE_KEYCODE){var a=t.attr("input_buttons");"dropdown"===a?S.clearDropdown(e):"datePicker"===a&&S.clearDatePicker(e)}},l=function(e){"native_select"===e.type?p(e):"date"===e.type?h(e):("select"===e.type||"dynamic_select"===e.type)&&f(e)},c={user:'<div uid="{USERID}" elemtype="contact" purpose="search" class="sugg-item"><div class="sugg-item-img-det"><img class="sugg-item-img" src="{IMGURL}"><div class="{STATUSCLASS}"></div></div><div class="sugg-item-info ellips"><div class="ellips sugg-main-text">{DNAMEVAL}</div><div class="ellips sugg-sub-text"><a class="cur" href="javascript:void(0)">{EMAILID}</a></div></div></div>',team:'<div uid="{GROUPID}" elemtype="group" purpose="search" class="sugg-item"><div class="sugg-item-img-det"><img class="sugg-item-img" src="{IMGURL}"></div><div class="sugg-item-info ellips"><div class="ellips sugg-main-text">{DNAMEVAL}</div><div class="ellips sugg-sub-text">{PARTICIPANTSDETAIL}</div></div></div>',chat:'<div uid="{CHID}" elemtype="chat" purpose="search" class="sugg-item"><div class="sugg-item-img-det">{CHATIMAGE}</div><div class="sugg-item-info ellips"><div class="ellips sugg-main-text">{TITLENAME}</div></div></div>',channel:'<div uid="{CHANNELID}" elemtype="channel" purpose="search" class="sugg-item"><div class="sugg-item-img-det">{IMG}</div><div class="sugg-item-info ellips"><div class="ellips sugg-main-text">{DNAMEVAL}</div></div></div>'},d=function(e){var t;switch(e){case"contacts":t={searchin:SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,peopledata:!0,contactshtml:c.user,orgcontactshtml:c.user};break;case"channels":t={searchin:SearchAgent.CHANNELS,ignorehtml:!0,isjoinedonly:!0,channelcategory:1,replacecontentonsuccesscallback:!0,channelshtml:c.channel};break;case"teams":t={searchin:SearchAgent.ORGGROUPS,groupshtml:c.team};break;case"conversations":t={searchin:SearchAgent.CHATHISTORY,chathistoryhtml:c.chat,channelshtml:c.channel,channelcategory:1}}return t},u=function(e,t,i,a){var s=($("#forminput-"+e.name),"");if("undefined"!=typeof i){var n=SearchField.getImageUrlByType(t,i);if(s=SearchField.getRecipientName(t,i),"channel"===t){s=Channels.getName(i);var r=Channels.getObject(i);r&&r.photoid&&(n=Channels.getImgUrl(r))}}$WC.$CUtil.isEmpty(s)&&(s=a),"undefined"==typeof i&&(i="",s="");var o=$("#forminput-"+e.name).find('[form-attr="input"]');o.val(s).attr("input_value",i).focus();var l="forminput-"+e.name+"-results";$("#"+l).hide(),Clickoutside.clear(l)},m={channels:"channel",conversations:"chat",teams:"group",contacts:"contact"},p=function(e){var t="forminput-"+e.name,i=$("#"+t);if(SearchField.init(t),e.value){var a=m[e.data_source];if(e.multiple)for(var s=0;s<e.value.length;s++)SearchField.insertSelection(inputParentContainer[0].id,a,e.value[s].value,e.value[s].label);else u(e,a,e.value.value,e.value.label)}var r=$("#"+t+"-results"),o=$("#"+t+"-list"),l=$("#"+t+"-search-field"),c=d(e.data_source);SearchEntities[t]={search:function(t){o.empty();var a=[];if(e.multiple)for(var s=i.find("[data-selections]").children(),d=0;d<s.length;d++){var u=s[d];u.hasAttribute("key")&&a.push(u.getAttribute("key"))}c.val=t,c.listid=o[0].id,c.emptycallback=this.populateEmptyResult,c.clearcallback=this.clear,c.ignorelist=a;var m=SearchAgent.search(c);return m?(r.find("[purpose='search']").first().addClass("sel"),r.is(":visible")||(Clickoutside.bind({srcid:l[0].id,destid:r[0].id}),n()),ZCScroll.scrollTop(r,0)):this.clear(),m},handleKeyDown:function(e,t){var a=$(e.target);$Util.scrollToViewportTop(a,a.parent(),50);var s=e.keyCode||e.which;if(s===$zcg.ESCAPE_KEYCODE)if(r.is(":visible"))r.hide(),Clickoutside.clear(r[0].id),e.preventDefault();else if(0!==t.length)l.val("").focus(),e.stopImmediatePropagation(),e.preventDefault();else{var n=i.find("[data-selections]");n.children().length>0?n.empty():$WC.$Win.destroy("form_dialog")}else if(s===$zcg.TAB_KEYCODE){r.is(":visible")&&(r.hide(),Clickoutside.clear(r[0].id));var o=i.parents('[form-attr="input-container"]'),c=e.shiftKey?o.prev():o.next();if(0===c.length)$('[form_buttons][purpose="submit"]').focus();else{var d=c.find("[tab-index]");d.focus(),"text"===d.attr("type")&&d[0].select()}}},handleAction:function(t,i,a){!e.multiple&&a&&"undefined"!=typeof i&&(t.stopPropagation(),l.val(""),u(e,i.attr("elemtype"),i.attr("uid")),b(e.name,e,$("#form-dialog-"+e.name)[0]),l.focus())},populateDefaultResult:function(){!e.multiple||l.hasClass("hide-caret")||this.search("*")||this.populateEmptyResult()},populateEmptyResult:function(){o.html('<div class="padd10 textcent">'+Resource.getRealValue("common.search.result.none")+"</div>")},clear:function(){r.hide(),Clickoutside.clear(r[0].id)}}},h=function(e){function t(e){var t=$Date.append0(e.getDate())+"/"+$Date.append0(e.getMonth()+1)+"/"+$Date.append0(e.getFullYear());n.attr("input_value",e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()),n.val(t).focus()}var i,a="form-dialog-"+e.name,s=$("#"+a),n=s.parents('[form-attr="input-container"]').find('[form-attr="input"]'),r=new DateTimeWidget(a,{setButtonNeeded:!1,useDefaultHtml:!1});if(e.value){var o=e.value.split("-");i=new Date(o[0],o[1]-1,o[2]),isNaN(i.getTime())||t(i)}r.initialize(i),r.handleModify=function(){t(this.getSelection()),s.hide(),Clickoutside.clear(a),y(n)}},g=function(e,t){var i=[],a=[],s=!1;if(!$WC.$CUtil.isEmpty(e))for(var n=0;n<e.length;n++){var r=e[n];if(r.value){var o={key:r.value,title:r.label};i.push(o),t.length>0&&-1!==t.indexOf(r.value)&&a.push(o)}else{for(var l=[],c=0;c<r.options.length;c++){var d=r.options[c],o={key:d.value,title:d.label};l.push(o),t.length>0&&-1!==t.indexOf(d.value)&&a.push(o)}i.push({label:r.label,options:l}),s=!0}}return{data:i,selected:a,hasOptionGroups:s}},f=function(e){var t={type:"dropdown",maxItems:5,searchinoptions:!0,ignoreheader:!0},i=[],s=e.multiple;s?(t.type="autocomplete",t.clickcallback=C,e.value&&(i=e.value.split(","))):(t.clickcallback=v,e.value&&(i=[e.value])),t.dropdownCallbacks={show:function(t){if(n(),"dynamic_select"===e.type){var i=t.parents('[form-attr="input-container"]');i.find('[purpose="refreshDropdown"]').addClass("zc-form-refresh")}}},"dynamic_select"===e.type&&(t.maxItems=0,t.dropdownCallbacks.hide=function(e){e.parents('[form-attr="input-container"]').find('[purpose="refreshDropdown"]').removeClass("zc-form-refresh")},t.fetchMore={minResultsCount:5,previousSearches:[],noMatchesText:Resource.getRealValue("common.search.result.none"),loadingText:$Util.getRandomQuotes(),triggerRequest:function(e){S.onSearch(e)}});var r=g(e.options,i),o=I([],r.data),l=r.selected;i.length>0&&(t.selected=s?l:e.value),t.option_groups=r.hasOptionGroups,t.data=o;var c=$('[form-input-name="'+e.name+'"][form-attr="input"]').parent(),d=c.dropdown(t)[0];"dynamic_select"===e.type&&(a[e.name]=d);var u=c.find('[form-attr="input"]');if(!s){var m=l[0];m?u.val(m.title).attr("input_value",m.key):u.val("").attr("input_value","")}c.find("[form_buttons][purpose]").on("click",function(e){var t=$(this).attr("purpose");("clearDropdown"===t||"refreshDropdown"===t)&&(e.stopPropagation(),S[t](e))})},v=function(e,t){var i=t.parents('[form-attr="input-container"]'),a=i.find('[form-attr="input"]');a.val(e.title).attr("input_value",e.key),y(a),a[0].focus()},C=function(e,t){"undefined"!=typeof t&&y(t)},y=function(t,a){S.closeFormError(),"input-container"!==t.attr("form-attr")&&(t=t.parents('[form-attr="input-container"]'));for(var s,n=t.find('[form-attr="input"]'),r=n.attr("form-input-name"),o=e.output.inputs,l=0;l<o.length;l++)if(o[l].name===r){s=o[l];break}if(b(r,s,n[0]),s.trigger_on_change){if(("select"===s.type||"native_select"===s.type)&&s.multiple&&("undefined"==typeof a||"focusout"!==a.type))return;clearTimeout(i.inputName),i.inputName=setTimeout(function(){if(("select"===s.type||"native_select"===s.type||"dynamic_select"===s.type)&&s.multiple){var e=$(document.activeElement).parents('[form-attr="input"]');if(e.length>0&&r===e.attr("form-input-name"))return}S.onChange(r)},100)}},b=function(e,t,i,a,s){var n=null;if("text"===t.type||"textarea"===t.type)n=i.value;else if("date"===t.type)n=i.getAttribute("input_value");else if("number"===t.type)n=i.value,n=$WC.$CUtil.isEmpty(n)?void 0:Number(i.value),$WC.$CUtil.isEmpty(n)||n==i.value||(c=Resource.getRealValue("formdialog.format.number"));else if("select"===t.type||"native_select"===t.type||"dynamic_select"===t.type){if(n=[],t.multiple)for(var r=$(i).find("[data-selections]").children(),o=0;o<r.length;o++){var l=r[o];l.hasAttribute("key")&&n.push(l.getAttribute("key"))}else n.push(i.getAttribute("input_value"));n=n.join(",")}var c,d=$(i).parents('[form-attr="input-container"]').find('[form-attr="error"]');if(a&&t.mandatory&&("number"===t.type&&"undefined"==typeof n||"number"!==t.type&&0===n.length)&&(c=Resource.getRealValue("formdialog.error.mandatory")),!$WC.$CUtil.isEmpty(n))if("number"===t.type)t.min&&n<t.min&&(c=Resource.getRealValue("formdialog.error.minvalue",""+t.min)),t.max&&n>t.max&&(c=Resource.getRealValue("formdialog.error.maxvalue",""+t.max));else if("text"===t.type||"textarea"===t.type){if(t.min_length&&n.length<t.min_length&&(c=Resource.getRealValue("formdialog.error.minlength",""+t.min_length)),t.max_length&&n.length>t.max_length&&(c=Resource.getRealValue("formdialog.error.maxlength",""+t.max_length)),"text"===t.type&&t.format&&("email"!==t.format||$WC.Matcher.check("emailid",n)||(c=Resource.getRealValue("formdialog.format.email")),"url"!==t.format||$WC.Matcher.check("linkRegExp",n)||(c=Resource.getRealValue("formdialog.format.url")),"tel"===t.format)){var u=new RegExp(/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/,"g");n.match(u)||(c=Resource.getRealValue("formdialog.format.tel"))}}else("select"===t.type||"native_select"===t.type||"dynamic_select"===t.type)&&t.max_selections&&n.split(",").length>t.max_selections&&(c=Resource.getRealValue("formdialog.error.maxentries",""+t.max_selections));if(!s&&c)return $(i).addClass("zc-form-error"),d.text(c).show(),null;if($(i).removeClass("zc-form-error"),d.empty().hide(),"native_select"===t.type){var m={};return m[t.data_source]=0===n.length?[]:n.split(","),m}return n},E=function(e,t,i){for(var a=!1,s=e.length-1;s>=0;s--){var n=e[s];if(n.key)t.key===n.key&&("undefined"==typeof i?(a=!0,e[s]=t):e.splice(s,1));else{for(var r=n.options,o=r.length-1;o>=0;o--){var l=r[o];t.key===l.key&&(i===n.label?(a=!0,r[o]=t):r.splice(o,1))}a||i!==n.label||(a=!0,r.push(t))}}return a||e.push("undefined"==typeof i?t:{label:i,options:[t]}),e},I=function(e,t){for(var i=0;i<t.length;i++){var a=t[i].key;if("undefined"!=typeof a)e=E(e,t[i]);else for(var s=t[i].options,n=0;n<s.length;n++)e=E(e,s[n],t[i].label)}return e},T=function(e,t,i){var s=a[e],n=g(t,[]);s.config.option_groups=s.config.option_groups||n.hasOptionGroups;var r=I(s.config.data,n.data);s.setData(r),s._curvalue===i&&s.populateList(void 0,{from_callback:!0})},S={onSearch:function(t){for(var i={},a=$("#form_dialog"),s=a.find('[form-attr="input"]'),n=0;n<s.length;n++){var r=s[n],o=r.getAttribute("form-input-name"),l=e.output.inputs[n],c=b(o,l,r,!1,!0);$WC.$CUtil.isEmpty(c)||(i[o]=c)}var d=a.find("[form-id]").attr("form-id");R.onSearch(d,i,t)},onChange:function(i){for(var a={},s=$("#form_dialog"),n=s.find('[form-attr="input"]'),r=0;r<n.length;r++){var o=n[r],l=o.getAttribute("form-input-name"),c=e.output.inputs[r],d=b(l,c,o,!1,!0);$WC.$CUtil.isEmpty(d)||(a[l]=d)}if("object"==typeof a[i]){if(JSON.stringify(t[i])==JSON.stringify(a[i]))return}else if(t[i]==a[i])return;var u=s.find("[form-id]").attr("form-id");R.onChange(u,a,i),t[i]=a[i]},submit:function(){for(var t=$("#form_dialog"),i=t.find('[form-attr="input"]'),a={},s=!1,n=0;n<i.length;n++){var r=i[n],o=r.getAttribute("form-input-name"),l=e.output.inputs[n],c=b(o,l,r,!0);null===c&&(s||($Util.scrollToViewportTop($(r).parents('[form-attr="input-container"]'),$("[form-id]"),100),r.focus()),s=!0),$WC.$CUtil.isEmpty(c)||(a[o]=c)}if(!s){var d=t.find("[form-id]").attr("form-id");R.submitForm(d,a,t.find('[form_buttons][purpose="submit"]'))}},cancel:function(){$WC.$Win.destroy("form_dialog")},showDatePicker:function(e){var t=$(e.currentTarget).parents('[form-attr="input-container"]'),i=t.find('[form-attr="input"]'),a=i.attr("form-input-name");Clickoutside.bind({destid:"form-dialog-"+a,event:e}),n()},clearDatePicker:function(e){var t=$(e.target).parents('[form-attr="input-container"]').find('[form-attr="input"]');t.attr("input_value","").val("").focus(),y(t)},showNativeDropdown:function(e){var t=$(e.currentTarget).attr("form-input-name"),i="forminput-"+t+"-results",a=$("#"+i);if(a.is(":visible"))a.hide(),Clickoutside.clear(i);else{Clickoutside.bind({destid:i,event:e}),n();var s=$("#forminput-"+t+"-search-field");s.focus(),SearchEntities["forminput-"+t].search("*")}},clearDropdown:function(e){var t=$(e.target).parents('[form-attr="input-container"]').find('[form-attr="input"]');t.attr("input_value","").val(""),y(t)},refreshDropdown:function(e){var t=$(e.target).parents('[form-attr="input-container"]').find('[form-attr="input"]'),i=t.attr("form-input-name"),s=a[i];s.config.fetchMore.triggerRequest(s)},closeFormError:function(){$("#form_dialog").find("footer").removeClass("zc-form-err")},focusInput:function(e,t){if("undefined"==typeof t){var i=$(e.currentTarget);"input"!==i.attr("form-attr")&&(i=i.parents('[form-attr="input-container"]').find('[form-attr="input"]')),t=i.attr("form-input-name")}var a=$("#forminput-"+t+"-search-field");a.focus();var s=a.val();0===s.length&&(s="*"),SearchEntities["forminput-"+t].search(s)}},R={submitForm:function(e,t,i){$ZCAjx.ajax({url:"/v2/forms/"+e+"/actions/submit",type:"POST",contentType:"application/json",status:{loading:i},data:{values:t},success:function(e){IntegrationsResponse.populateOutput({},e,e.chid)}})},submitFormOnCancel:function(e){$ZCAjx.ajax({url:"/v2/forms/"+e+"/actions/cancel",type:"POST",success:function(e){IntegrationsResponse.populateOutput({},e,e.chid)}})},onChange:function(e,t,i){var a=$("#form_dialog");a.addClass("zc-input-loading");var s=$("#form-dialog-"+i).parents('[form-attr="input-container"]');s.addClass("form-input-loading"),$ZCAjx.ajax({url:"/v2/forms/"+e+"/actions/change",type:"POST",contentType:"application/json",data:{values:t,target:{name:i}},success:function(e){a.removeClass("zc-input-loading"),s.removeClass("form-input-loading"),IntegrationsResponse.populateOutput({},e,e.chid)},error:function(){a.removeClass("zc-input-loading"),s.removeClass("form-input-loading")}})},onSearch:function(e,t,i){var a=$(i._elem).parents('[form-attr="input-container"]').find("[form-input-name]").attr("form-input-name"),s=i._curvalue,n=$("#form-dialog-"+a).parents('[form-attr="input-container"]');n.addClass("form-input-loading"),$ZCAjx.ajax({url:"/v2/forms/"+e+"/actions/input",type:"POST",contentType:"application/json",data:{values:t,target:{name:a,query:s}},success:function(e){n.removeClass("form-input-loading"),e.output&&"form_values"===e.output.type?T(a,e.output.options,s):IntegrationsResponse.populateOutput({},e,e.chid)},error:function(){n.removeClass("form-input-loading")}})}};return{clearData:function(){e=void 0,t={},i={},a={}},clearInputData:function(e){delete t[e],clearTimeout(i[e]),delete i[e],a[e]&&(a[e].setData([]),a[e].config.fetchMore.previousSearches=[])},updateInputVsLastValue:function(){t={};for(var i=$("#form_dialog").find('[form-attr="input"]'),a=0;a<i.length;a++){var s=i[a],n=s.getAttribute("form-input-name"),r=e.output.inputs[a],o=b(n,r,s,!1,!0);$WC.$CUtil.isEmpty(o)||(t[n]=o)}},show:function(t){if(!$WC.$Win.isExist("form_dialog")){e=t;var i=$WC.$Win.create({id:"form_dialog","class":"zc-form",header:$WC.template.replace('<header class="zc-form-head">{{title}}</header>',{title:t.output.title}),html:FormDialogsUI.getHTML(t),closefn:function(){if("undefined"!=typeof e){for(var t=i.find('[form-attr="input"]'),a=0;a<t.length;a++){var s=t[a].getAttribute("form-input-name");Clickoutside.clear(s)}var n=e.output.actions.cancel;"undefined"!=typeof n&&R.submitFormOnCancel(e.output.id),e=void 0}}});s(i);var a=i.find("[tab-index]");a[0].focus(),"text"===a.attr("type")&&a[0].select(),ZCScroll.scrollTop(i.find("[form-id]"),0),FormDialogs.updateInputVsLastValue()}},handleError:function(e){var t=e.output,i=t.text;if("undefined"!=typeof i&&($('[form-attr="global-error"]').text(i),$("#form_dialog").find("footer").addClass("zc-form-err")),t.inputs)for(var a in t.inputs){var s=$('[form-input-name="'+a+'"]');$(s).addClass("zc-form-error");var n=s.parents('[form-attr="input-container"]'),r=n.find('[form-attr="error"]'),o=t.inputs[a];r.text(o).show()}},handleModifications:function(t){for(var i=e.output.inputs,a=0;a<t.length;a++){for(var s,n=t[a].name,r=0;r<i.length;r++){var o=i[r];if(n==o.name){s=o;break}}if("undefined"!=typeof s){var c=$("#form-dialog-"+n).parents('[form-attr="input-container"]'),d=t[a].input;"clear"===t[a].type?(delete s.value,"dynamic_select"===s.type&&(s.options=[]),d=s):("enable"===t[a].type||"disable"===t[a].type)&&(s.disabled="disable"===t[a].type);var u;switch("undefined"!=typeof d&&(u=FormDialogsUI.getInputHTML(d)),t[a].type){case"remove":c.remove(),i.splice(r,1);break;case"add_after":c.after(u),i.splice(r+1,0,d);break;case"add_before":c.before(u),i.splice(r,0,d);break;case"clear":case"update":FormDialogs.clearInputData(d.name),c.replaceWith(u),i.splice(r,1,d);break;case"enable":c.removeClass("zc-input-disable");break;case"disable":c.addClass("zc-input-disable")}"undefined"!=typeof d&&l(d)}}FormDialogs.updateInputVsLastValue()},updateInputValues:T}}();var CommandsUI={};CommandsUI={currentExample:2,listviewhtml:'<div id="{COMMANDID}" commandbuttons purpose="preview" commandid="{COMMANDID}" class="indivcom cur"><div class="zchlistimg mrgR10 mrgT3 floatl">{DELETEBUTTON}{PHOTO}</div><div class="dIB mrgL10 w70"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips">{NAME} &nbsp;</div><div class="dIB floatl"><div class="dIB">{CREATOR}{TEAMNAME}</div></div><div class="clr6 font14 dN zcinddics">{EDITOPTIONS}</div></div></div><div class="dIB mrgT5 mrgB5">{HINT}</div></div></div>',appviewhtml:'<div appbuttons purpose="toggleSelection" commandid="{COMMANDID}" class="cur zcappintl zctext"><div class="zchlistimg mrgT3 floatl"><div title="Select" class="msi-hissel posa"></div>{PHOTO}</div><div class="dIB w70 mrgT5 mrgL10"><div title="{NAME}" class="ellips">{NAME}{SANDBOXTEXT}</div><div title="{HINT}" class="ellips mrgT5 clr8">{HINT}</div></div></div>',show:function(e,t){e&&0==Commands.getCommandsCount()?$("#IntegrationsRHS").html('<span list-view="true" class="zcldng"></span>'):this.populate(t),e&&Commands.sync()},bindEvents:function(){$(document).on("click","[commandbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof CommandsUI.handle[t]&&CommandsUI.handle[t](this,e)}),$(document).on("keyup","[commandsinput]",function(e){var t=this.getAttribute("purpose");"limit"===t?$Dom.limitInput(this):CommandsUI.populate(e)})},handle:{add:function(){$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this),t=Template.IntegrationAddCommand.replace(/{COMMANDSCOPERADIOBUTTONS}/g,CommandsUI.getScopeBtnsHtml(CommandConstants.PRIVATESCOPE));t=$Util.CustomCheckbox.construct(t,[{html:'<input id="codevisibilitycheckbox" catagory="notify" type="checkbox" class="zcunrdchkbx"/>',key:"{COMMANDSVISIBILITY}",checked:!1}]),t=CommandsUI.replacePlaceHolders(t),e.html(t).fadeIn(300,function(){$("#commandname").focus()}),IntegrationsCwin.init(),ZCScroll.customScroll(e.find("#addcommandui"),!0),CommandsUI.bindCreateEvents(e)})},create:function(){var e=CommandsUI.validateAndGetParams($("#addcommandui"));$WC.$CUtil.isEmpty(e)||Commands.create(e)},editCode:function(e,t,i,a){var s=a?CommandConstants.SUGGESTION_HANDLER_TYPE:CommandConstants.EXECUTION_HANDLER_TYPE,n=$("#toggleeditcodeoptions");if(Clickoutside.clear("toggleeditcodeoptions"),n.hide(),"undefined"==typeof i&&(i=$(e).parents("[commandid]").attr("commandid")),Clickoutside.clear("Integrationspreviewcontainer"),0===$("#commandseditcode").length){var r=Commands.getObject(i);r.module=Integration.Modules.Commands,r.isSuggestion=a,DREImpl.handleEditCode(r,i,s)}},editSuggestionCode:function(e,t,i){"undefined"==typeof i&&(i=$(e).parents("[commandid]").attr("commandid")),Commands.hasSuggestionsFunc(i)?this.editCode(e,t,i,!0):this.createSuggestionCode(i)},createSuggestionCode:function(e){var t={componentid:e,type:CommandConstants.SUGGESTION_HANDLER_TYPE};Executions.create(t,function(t){Commands.store(t.data);var i=Commands.getObject(e);i.module=Integration.Modules.Commands,i.isSuggestion=!0,DREImpl.handleEditCode(i,e,CommandConstants.SUGGESTION_HANDLER_TYPE)})},deleteSuggestion:function(e){var t=$(e).parents("[commandid]").attr("commandid"),i=Commands.getObject(t),a=IntegrationsUtil.getHandlerName(CommandConstants.SUGGESTION_HANDLER_TYPE,t);$WC.$Dlg.confirm({id:"deletehandler",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("executor.delete.confirm.info",[a])]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-cmdicn"></div>',header:Resource.getRealValue("executor.delete.confirm",[$Util.xssAndEscapeReplacementString(i.name),a])}),buttons:[{text:Resource.getRealValue("commands.delete.yes"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Executions.delete(t,CommandConstants.SUGGESTION_HANDLER_TYPE,function(){$(e).remove()})}}]})},editConfig:function(e){var t=$(e).parents("[commandid]").attr("commandid"),i=Commands.getObject(t);Commands.isAwaitingOrgApproval(t)&&!Commands.isFromIntegration(t)&&(i.scope=CommandConstants.ORGSCOPE),Clickoutside.clear("Integrationspreviewcontainer"),$("#IntegrationsRHS").fadeOut(300,function(){IntegrationsCwin.init();var e=$(this),a=Template.IntegrationEditCommand;a=CommandsUI.replacePlaceHolders(a),a=a.replace(/{NAME}/,$Util.xssAndEscapeReplacementString(i.name)).replace(/{HINT}/,$Util.xssAndEscapeReplacementString(i.hint)).replace(/{DESC}/,i.description?$Util.xssAndEscapeReplacementString(i.description):"").replace(/{COMMANDSCOPERADIOBUTTONS}/g,CommandsUI.getScopeBtnsHtml(i.scope)).replace(/{SCOPEHINT}/,'<span class="clr6">'+Resource.getRealValue("integration.scope.info"+i.scope)+"</span>").replace(/{COMMANDID}/g,i.id);var s=Commands.hasCodeViewPermission(t);a=$Util.CustomCheckbox.construct(a,[{html:'<input id="codevisibilitycheckbox" catagory="notify" type="checkbox" '+(s?"checked ":"")+'class="zcunrdchkbx"/>',key:"{COMMANDSVISIBILITY}",checked:s}]),e.html(a).find('[type="imgpreview"]').html('<img width="50px" height="50px" src="'+Commands.getImgUrl(t,i.scope)+'"/>'),!$WC.$CUtil.isEmpty(i.display_props)&&i.display_props.selectionlimit&&e.find("#selectionlimit").val(i.display_props.selectionlimit),e.fadeIn(300,function(){if(ZCScroll.customScroll($("#editcommandcontainer"),!0),i.scope===CommandConstants.TEAMSCOPE){$("#commandscopes-group").show(),$WC.DivEditor.focus("commands-groupsuggest-search-field");for(var e=i.teamids,t=0;t<e.length;t++){var a=SearchField.getNodeforSelection({uid:e[t],type:"group",name:i.team_names[e[t]]},!0);SearchField.insertNodeinField("commands-groupsuggest",void 0,a)}}});var n=$("#commandoptionscont").children("[commandoptions]"),r=0;for(var o in i.options){var l=$(n[r]);l.find("#key").val(o),l.find("#value").val(i.options[o]),r++}CommandsUI.bindCreateEvents(e)})},saveEdit:function(e){var t=$(e).parents("[commandid]").attr("commandid"),i=CommandsUI.validateAndGetParams($("#editcommandui"),Commands.getObject(t));$WC.$CUtil.isEmptyObject(i)?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):Commands.edit(t,i)},"delete":function(e){var t=$(e).parents("[commandid]").attr("commandid"),i=Commands.getObject(t).name;$WC.$Dlg.confirm({id:"deletecommand",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("commands.confirm.delete.info1"),Resource.getRealValue("commands.confirm.delete.info2")],infoheader:Resource.getRealValue("integ.delete.info")}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-cmdicn"></div>',header:Resource.getRealValue("commands.confirm.delete",[$WC.$CUtil.processXSS(i)])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Commands.delete(t)}}]})},approve:function(e){var t=$(e).parents("[commandid]").attr("commandid");Commands.approve(t)},reject:function(e){{var t=$(e).parents("[commandid]").attr("commandid"),i=Commands.getObject(t),a=$WC.template.replace('<textarea id="rejectcommandreason" commandsinput purpose="limit" class="tatext chrejt" placeholder="{{PLACEHOLDER}}"></textarea><div category="charcount" limit="500" class="zcchlcount chrejcnt zchdc">500</div>',{$PLACEHOLDER:"common.enter.comments"});$WC.$Dlg.create({id:"rejectcommand",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-red"></div>',header:Resource.getRealValue("command.rejectdlg.header",[$WC.$CUtil.processXSS(i.name)])}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[a]}),buttons:[{text:Resource.getRealValue("common.decline.ok"),action:function(){Commands.reject(t,this.find("#rejectcommandreason").val())},colour:$WC.$Dlg.GREEN_BUTTON}]})}$("#rejectcommandreason").focus()},preview:function(e,t,i){"user"!==$(t.target).attr("elemtype")&&(IntegrationsCwin.hide(),"undefined"==typeof i&&(i=$(e).attr("commandid")),IntegrationUI.hasPrevWin&&i===$("#Integrationspreview").attr("commandid")||CommandsUI.showPreview(i,t))},showCodePreview:function(e){e=$(e),commandid=e.parents("[commandid]").attr("commandid");var t="true"===e.attr("suggestion"),i=$(t?"#suggcodepreview":"#execcodepreview"),a=$("#commandpreviewcont");if(i.text().length>0)i.slideDown(function(){ZCScroll.customScroll(a,!0),$Util.scrollToViewportTop(i,a,200)}),e.attr("purpose","hideCodePreview").text(Resource.getRealValue("commands.hidecode"));else{var s=t?CommandConstants.SUGGESTION_HANDLER_TYPE:CommandConstants.EXECUTION_HANDLER_TYPE;Executions.getDetails(commandid,s,i,a,e)}},hideCodePreview:function(e){e=$(e);var t="true"===$(e).attr("suggestion"),i=$(t?"#suggcodepreview":"#execcodepreview"),a=$("#commandpreviewcont");i.slideUp(function(){ZCScroll.customScroll(a,!0),$Util.scrollToViewportTop(i,a,200)}),e.attr("purpose","showCodePreview").text(Resource.getRealValue("commands.viewcode"))}},replacePlaceHolders:function(e){var t=this.currentExample%3;this.currentExample++,e=e.replace(/{EX-NAME}/g,Resource.getRealValue("commands.ex.name"+t)).replace(/{EX-HINT}/g,Resource.getRealValue("commands.ex.hint"+t)).replace(/{EX-DESC}/g,Resource.getRealValue("commands.ex.desc"+t));for(var i=1;5>=i;i++)e=e.replace(new RegExp("{KEY"+i+"}"),Resource.getRealValue("commands.ex.key"+t+i)),e=e.replace(new RegExp("{VALUE"+i+"}"),Resource.getRealValue("commands.ex.value"+t+i));return e},showPreview:function(e,t){var i=Commands.getObject(e),a=CommandsUI.getHTML(i,Template.CommandsPreview);a=CommandsUI.getPreviewBtnAndOptHtml(i,a),IntegrationUI.preview("commandid",e,a,t,function(){HomeUI.markseenAndRemoveComponentDiv("homeui_"+e,"commands")})},getPreviewBtnAndOptHtml:function(e,t){var i="",a="",s="",n=e.id,r=0;Commands.isMyCommand(n)&&SecurityManager.hasPermission(Modules.Commands,MActions.Edit)?i='<div commandbuttons purpose="editConfig" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("commands.editconfig")+"</div>":Commands.isAwaitingOrgApproval(n)&&_isAppAccountAdmin()&&(i+='<div commandbuttons purpose="approve" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("common.approve")+'</div><div commandbuttons purpose="reject" class="posl dbtn buttn_neg floatr zcdedbtn">'+Resource.getRealValue("common.reject")+"</div>"),i+='<span drebuttons type="command" purpose="showGrantedConsents" class="zcclr zc-consents">'+Resource.getRealValue("platformconsents.viewgranted")+"</span>",Commands.isMyCommand(n)&&SecurityManager.hasPermission(Modules.Commands,MActions.Edit)?a='<div class="zcincmli mrgT25"><div class="bold">'+Resource.getRealValue("integration.handler.execution")+"</div><div>"+Resource.getRealValue("commands.execution.info")+'<div><span commandbuttons purpose="editCode" class="zcclr cur">'+Resource.getRealValue("commands.editcode")+'</span></div></div></div><div class="mrgT25"><div class="bold">'+Resource.getRealValue("integration.handler.suggestion")+"</div><div>"+Resource.getRealValue("commands.suggestion.info")+'<div><span commandbuttons purpose="editSuggestionCode" class="zcclr cur">'+Resource.getRealValue("commands.editcode")+"</span>"+(e.has_suggestions?'<span commandbuttons purpose="deleteSuggestion" class="mrgL20 zcclr cur">'+Resource.getRealValue("common.delete")+"</span>":"")+"</div></div></div>":Commands.hasCodeViewPermission(n)&&(a='<div class="bold mrgT25">'+Resource.getRealValue("commands.codes")+'</div><div class="mrgT15">'+Resource.getRealValue("commands.exec.code")+'<div commandbuttons purpose="showCodePreview" class="dIB mrgL10 cur zccmdbtnlink">'+Resource.getRealValue("commands.viewcode")+'</div></div><div id="execcodepreview" style="display:none" class="zcprvwcont mrgT25 posrel"></div>',Commands.hasSuggestionsFunc(n)&&(a+='<div class="mrgT25">'+Resource.getRealValue("commands.sugg.code")+'<div commandbuttons purpose="showCodePreview" suggestion="true" class="dIB mrgL10 cur zccmdbtnlink">'+Resource.getRealValue("commands.viewcode")+'</div></div><div id="suggcodepreview" style="display:none" class="zcprvwcont mrgT25 posrel"></div>'));for(var o in e.options)r++,s+='<div class="font15 mrgT10">'+r+') <span class="clr6">'+o+'</span><span class="mrgLR15">-></span><span class="clr6">'+e.options[o]+"</span></div>";return $WC.$CUtil.isEmpty(s)||(s='<div class="zcincmli paddT10"><div class="bold mrgT15">'+Resource.getRealValue("common.options")+'</div><div class="zccmdoptnpr">'+s+"</div></div>"),t=t.replace(/{EDITBUTTONS}/,i).replace(/{CODEHTML}/g,a).replace(/{OPTIONS}/g,s)},getScopeBtnsHtml:function(e){var t=Groups.getAllOrgGroups(),i=[{id:"commandscope1",value:CommandConstants.ORGSCOPE,label:Resource.getRealValue("integration.scope1"),checked:e===CommandConstants.ORGSCOPE}];return $.isEmptyObject(t)||i.push({id:"commandscope2",value:CommandConstants.TEAMSCOPE,label:Resource.getRealValue("channel.group"),checked:e===CommandConstants.TEAMSCOPE}),i.push({id:"commandscope4",value:CommandConstants.PRIVATESCOPE,label:Resource.getRealValue("integration.scope3"),checked:e===CommandConstants.PRIVATESCOPE}),$Dom.radio.construct("commandscope",i)},validateAndGetParams:function(e,t){var i,a=$.trim($("#commandname").val().toLowerCase()),s=$.trim($("#commandhint").val()),n=parseInt($("#commandscoperadio").find("[name='commandscope']:checked").val()),r=$.trim($("#commanddesc").val()),o=SearchField.getSelectedList("commands-groupsuggest-search-field");if(a.startsWith("/")&&(a=a.substring(1)),$WC.$CUtil.isEmpty(a)||a.length>20||!$WC.Matcher.check("commandpattern",a))return $("#commandname").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#commandname-info"),e,200);if($WC.$CUtil.isEmpty(s)||s.length>100)return $("#commandhint").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#commandhint-info"),e,200);if(!$WC.$CUtil.isEmpty(r)&&!$WC.Matcher.check("textpattern",r))return $("#commanddesc").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#commanddesc-info"),e,200);if(n===CommandConstants.TEAMSCOPE&&0===o.length)return $("#commands-groupsuggest-search-field").addClass("error"),void $Util.scrollToViewportTop($("#addcommandscope"),e,200);var l=CommandsUI.validateAndGetCommandOptions();if(!l.isValid)return void $Util.scrollToViewportTop($("#commandoptionscont"),e,200);i=l.options;var c={codevisibility:$("#codevisibilitycheckbox")[0].checked},d=$("#selectionlimit").val();$WC.$CUtil.isEmpty(d)||(c.selectionlimit=d),c=JSON.stringify(c),"undefined"!=typeof t&&(a=t.name!=a?a:void 0,s=t.hint!=s?s:void 0,r=$WC.$CUtil.isEmpty(t.description)&&$WC.$CUtil.isEmpty(r)||t.description==r?void 0:r,n=t.scope!=n||n===CommandConstants.TEAMSCOPE?n:void 0,i=JSON.stringify(t.options)!=i?$WC.$CUtil.isEmpty(i)?"{}":i:void 0,c=JSON.stringify(t.display_props)!=c?c:void 0);var u=$("#commandphoto").siblings("[type='imgpreview']").find("img").attr("src");u=!$WC.$CUtil.isEmpty(u)&&u.startsWith("data:")?u:void 0,o=n!==CommandConstants.TEAMSCOPE||$WC.$CUtil.isEmpty(o)?void 0:JSON.stringify(o);var m={name:a,hint:s,scope:n,description:r,teamids:o,options:i,image:u,display_props:c};return $Util.checkAndRemoveUndefinedKeys(m)},validateAndGetCommandOptions:function(){for(var e=$("#commandoptionscont"),t=e.children("[commandoptions]"),i={},a=!1,s=0;s<t.length;s++){var n=$(t[s]).find("#key").val(),r=$(t[s]).find("#value").val();n=$.trim(n),r=$.trim(r),$WC.$CUtil.isEmpty(n)||$WC.$CUtil.isEmpty(r)||(n=n.startsWith("-")?n.substring(1):n,n.length>5||!$WC.Matcher.check("commandpattern",n)?(a=!0,$(t[s]).find("#key").addClass("zcfdk_tmbzoom")):i[n]=r)}return{isValid:!a,options:Object.keys(i).length>0?JSON.stringify(i):void 0}},getOptionsHtml:function(e){var t="",i=0;for(var a in e)i++,t+='<div class="font14  mrgT10">'+i+') <span class="clr6">'+a+'</span><span class="mrgLR15">-></span><span class="clr6">'+e[a]+"</span></div>"},bindCreateEvents:function(e){e.find("#commandscope2").length&&(e.find("#commandscopes-group").append('<div class="zchcnt dinflxC"><div class="zchintt dIB font14 floatl bold">'+Resource.getRealValue("channel.group.title")+'</div><div class="zcaddcnt zcrtdrpd dIB floatl"><div id="commands-groupsuggest"><div id="commands-groupsuggest-selnodes"></div><div id="commands-groupsuggest-search-field" contenteditable="true" placeholder="'+Resource.getRealValue("channel.team.placeholder")+'" class="crtin mrgT25" placeholder="'+Resource.getRealValue("smartsearch.search.groups")+'"></div><div id="commands-groupsuggest-results" class="chdropdwn" style="display:none"></div></div></div></div>'),SearchField.init("commands-groupsuggest")),e.find("#commandscoperadio").on("change","[type='radio']",function(){parseInt(this.value)===CommandConstants.ORGSCOPE?($("#commandscopes-group").slideUp(),$("#commandscope-info").html(Resource.getRealValue("integration.scope.info1"))):parseInt(this.value)===CommandConstants.TEAMSCOPE?($("#commandscopes-group").slideDown(),$("#commandscope-info").html(Resource.getRealValue("integration.scope.info2"))):parseInt(this.value)===CommandConstants.PRIVATESCOPE&&($("#commandscopes-group").slideUp(),$("#commandscope-info").html(Resource.getRealValue("integration.scope.info3")))}),e.find("#commandphoto").on("change",function(){var e=$(this),t=e.siblings("#commanddefimg"),i=$(this).siblings("[type='imgpreview']"),a=this.files[0],s=2;if("undefined"!=typeof a){if(!$Util.isValidImage(e,this.files,s))return;t.hide(),$Util.imgPrview(i,a)}}),e.on("input keyup","[commandinputs]",function(e){e.which!==$zcg.ESCAPE_KEYCODE&&e.stopPropagation(),IntegrationsCwin.handleKeyUp.commands(e,"add")})},getCommandsHomeViewHtml:function(e){if("undefined"==typeof e)return"";var t=e.id,i="/"+$WC.$CUtil.processXSS(e.name),a=$WC.$CUtil.processXSS(e.hint),s=e.creator,n=Users.getName(s,e.creator_name);a=a.length>70?$.trim(a.substr(0,70))+"...":a;var r='<div id="homeui_'+t+'" documentclick="view_component" compid="'+t+'"  elementcat= "commands" purpose="componentview" class="zchmbtbx posl dIB cur"><div class="zchmcmdcnt posl"><span id="'+t+'" documentclick="component_markseen" type="commands" class="msi-close cur"></span><div class="zhmhd imgurl"><img class="mrgR10 floatl" src="'+Commands.getImgUrl(t)+'"/><div class="floatl	"><div class="bold">'+i+'</div><div>{CREATOR}</div></div></div><div class="clr6 mrgT10">'+a+"</div></div></div>";return r=Commands.isFromIntegration(t)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>"+(e.scope==CommandConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="'+s+'" class="zctxthgh cur">'+$Util.escapeReplacementString(n)+"</span>")},getHTML:function(e,t,i){t="undefined"!=typeof t?t:this.listviewhtml;var a="/"+$WC.$CUtil.processXSS(e.name);if("undefined"!=typeof i){var s=(a.toLowerCase().indexOf(i),new RegExp($WC.Matcher.replace("escaperegexp",i),"i"));a=a.replace(s,"<b>$&</b>")}var n=a;e.appid&&(n+='<span class="clr6 fntnrml"> - '+Resource.getRealValue("common.via")+' <span class="clr5 bold"> '+$WC.$CUtil.processXSS(e.appdetails.name)+" </span>"+Resource.getRealValue("app.app")+(e.appdetails.issandbox?" ("+Resource.getRealValue("app.sandbox")+")":"")+"</span>");var r=t.replace(/{NAME}/g,$Util.escapeReplacementString(a)).replace(/{DISPNAME}/g,$Util.escapeReplacementString(n)).replace(/{SANDBOXTEXT}/g,Commands.isFromSandBox(e.id)?'<span class="clr6"> ('+Resource.getRealValue("app.sandbox")+")</span>":"").replace(/{HINT}/g,$Util.xssAndEscapeReplacementString(CommandsUtil.getHint(e,MainUI.currentchat)));if(e.isdefault)r=r.replace(/{IMGURL}/,Commands.getImgUrl(e.id)).replace(/{COMMANDID}/g,"").replace(/{APP}/,"");else{var o="integration.scope.info"+e.scope,l="";!Commands.isAwaitingOrgApproval(e.id)||Commands.isFromIntegration(e.id)||$zcg._ZUID!=e.creator&&!_isAppAccountAdmin()?e.scope==CommandConstants.TEAMSCOPE&&(o="integration.scope.team",l=$Util.xssAndEscapeReplacementString(Groups.getGroupNames(e.teamids,e.team_names))):(e.scope=CommandConstants.ORGSCOPE,o="integration.scope.pending."+($zcg._ZUID==e.creator?"creator":"admin")),r=r.replace(/{COMMANDID}/g,e.id).replace(/{SCOPE}/,e.scope).replace(/{DESC}/,$WC.$CUtil.isEmpty(e.description)?"":'<div class="mrgT5 clr6">'+$Util.xssAndEscapeReplacementString(e.description)+"</div>").replace(/{SCOPEHINT}/,Resource.getRealValue("integration.scope"+e.scope)+'<span class="clr6"> - '+Resource.getRealValue(o,l)+"</span>").replace(/{IMGURL}/,Commands.getImgUrl(e.id,e.scope)).replace(/{PHOTO}/,'<img height="48px" width="48px" src="'+Commands.getImgUrl(e.id,e.scope)+'" class="'+(Commands.hasDeletePermission(e.id)?"zccmdimgcr":"")+'">'),r=Commands.isFromIntegration(e.id)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>"+(e.scope==CommandConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):Commands.isFromSandBox(e.id)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+" ("+Resource.getRealValue("app.sandbox")+")</span></span>"+(e.scope==CommandConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")).replace(/{SANDBOXTEXT}/g," ("+Resource.getRealValue("app.sandbox")+")"):r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="'+e.creator+'" class="zctxthgh cur">'+$Util.escapeReplacementString(Users.getName(""+e.creator,e.creator_name))+"</span>");var c=e.scope==CommandConstants.TEAMSCOPE?"&nbsp;"+Resource.getRealValue("channel.created.for")+'&nbsp;<span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(Groups.getGroupNames(e.teamids,e.team_names))+"</span>":"";r=r.replace(/{TEAMNAME}/g,c);var d=Commands.hasDeletePermission(e.id)?'<div commandbuttons purpose="delete" title="Delete" class="msi-cmddel posa"></div>':"";r=r.replace(/{DELETEBUTTON}/g,d);var u="";Commands.isMyCommand(e.id)&&SecurityManager.hasPermission(Modules.Commands,MActions.Edit)&&(u='<div commandbuttons purpose="editCode" class="cmdediticn zcclr"><span class="msi-editicn zcclr mrgR5"></span>'+Resource.getRealValue("commands.editcode")+"</div>"),Commands.isAwaitingOrgApproval(e.id)&&_isAppAccountAdmin()&&(u+='<div commandbuttons purpose="approve" class="cmdediticn grclr bold"><span class="msi-aprvl mrgR5"></span>'+Resource.getRealValue("common.approve")+'</div><div commandbuttons purpose="reject" class="cmdediticn bold clrred"><span class="msi-reject mrgR5"></span>'+Resource.getRealValue("common.reject")+"</div>"),r=r.replace(/{EDITOPTIONS}/,u)}return r},handleSystemCommandResponse:function(e,t,i){if(i.dreResponse&&"Success"===i.dreResponse.status&&i.dreResponse.StatusCode&&i.dreResponse.StatusCode.indexOf("common.shortcut.success")>=0)if(t==CommandsUtil.MUTE_COMMAND||t==CommandsUtil.UNMUTE_COMMAND){var a=i.dreResponse.time,s=a&&-1!==parseInt(a)?$Util.getSyncedCurrentTime()+a:-1;ChatUI.updateMuteStatus(e,t==CommandsUtil.MUTE_COMMAND?1:0,t==CommandsUtil.MUTE_COMMAND?s:-1)}else if(t==CommandsUtil.PIN_COMMAND||t==CommandsUtil.UNPIN_COMMAND)Chat.isChannelChid(e)?Channels.pinUnpinChannel(e,t==CommandsUtil.PIN_COMMAND):ChatsList.get(e)&&ChatsList.pinUnpinChat(t==CommandsUtil.PIN_COMMAND?"pin":"unpin",e);else if(t==CommandsUtil.LEAVE_COMMAND&&i.dreResponse.deleted&&!$WC.$CUtil.isEmpty(i.dreResponse.oc_id)){var n=Channels.getByChid(e);Channels.handleLeave(i.dreResponse.oc_id),Channels.sync(n)}IntegrationsResponse.populateOutput({module:Integration.Components.Command,id:t,name:"/"+Commands.getObject(t).name,imageUrl:Commands.getImgUrl(t)},i.dreResponse,e)},getResponseDataForCustomCommands:function(e,t){var i="",a="";return e==CommandsUtil.REMIND_COMMAND?i=RemindersUI.getCardHTML(t.reminders):e==CommandsUtil.REMINDERS_COMMAND&&(i=RemindersUI.getListCardHTML(t.reminders),a="remlstcnt"),{html:i,customClass:a}},getErrorResponseHTMLForCustomCommands:function(e){var t="";return e==CommandsUtil.REMIND_COMMAND&&(t=RemindersUI.getErrorCardHTML()),t},populate:function(e){if(IntegrationUI.listView.isCurrent(Integration.Modules.Commands,e)){var t=Commands.getCommandsCount();if(IntegrationUI.listView.initialize(Integration.Modules.Commands,t,SecurityManager.hasPermission(Modules.Commands,MActions.Create)),0===t)return;var i,a;if(("undefined"==typeof e||e.which!==$zcg.ESCAPE_KEYCODE)&&(a=$("#commandsearch").val()),$WC.$CUtil.isEmpty(a))i=Commands.getAll();else{var s=a.trim().toLowerCase();s=s.startsWith("/")?s:"/"+s,i=CommandsUtil.search({searchin:SearchAgent.COMMANDS,val:s,getashtml:!1,limit:100,ignoredefaultcommands:!0})}for(var n="",r="",o="",l="",c="",d=CommandsUtil.sortByName(i),u=0;u<d.length;u++){var m=d[u];if(!Commands.isDefaultCommand(m)){var p=this.getHTML(i[m],CommandsUI.listviewhtml,a);Commands.isMyCommand(m)?Commands.isAwaitingOrgApproval(m)?l+=p:r+=p:Commands.isAwaitingOrgApproval(m)&&_isAppAccountAdmin()?o+=p:c+=p}}$WC.$CUtil.isEmpty(l)||(n+='<div id="mypendingcommandsheader" zc_running_title class="zcinhds font15 bold mrgT20 paddT10 floatl posl">'+Resource.getRealValue("integration.my.command.pending")+'</div><div id="mypendingcommands" class="zcinchls">'+l+"</div>"),$WC.$CUtil.isEmpty(o)||(n+='<div id="pendingcommandsheader" zc_running_title class="zcinhds font15 bold mrgT20 paddT10 floatl posl">'+Resource.getRealValue("integration.pending.command")+'</div><div id="pendingcommands" class="zcinchls">'+o+"</div>"),$WC.$CUtil.isEmpty(r)||(n+='<div id="mycommandsheader" zc_running_title class="zcinhds font15 bold paddT10 floatl posl">'+Resource.getRealValue("integration.my.command")+'</div><div id="mycommands" class="zcinchls">'+r+"</div>"),$WC.$CUtil.isEmpty(c)||(n+='<div id="allcommandsheader" zc_running_title class="zcinhds font15 bold mrgT20 paddT10 floatl posl">'+Resource.getRealValue("integration.all.command")+'</div><div id="allcommands" class="zcinchls">'+c+"</div>"),IntegrationUI.listView.populate(Integration.Modules.Commands,"commandslist",n,a,SecurityManager.hasPermission(Modules.Commands,MActions.Create))}},groupsuggestion:{search:function(e){var t=$("#commands-groupsuggest-results");t.html('<div id="commands-groupsuggest-list"  class="drpdwn srchglt"></div>');var i=SearchField.getSelectedList("commands-groupsuggest-search-field");if(i.length>=4)return void UI.updateBanner(Resource.getRealValue("channel.sel.group.limit"),3e3,!0);var a=SearchAgent.search({searchin:SearchAgent.ORGGROUPS,val:e,ignorelist:i,listid:"commands-groupsuggest-list"});if(a){t.find("[purpose='search']").first().addClass("srchbn sel");var s="block"===t.css("display");s||Clickoutside.bind({srcid:"commands-groupsuggest-search-field",destid:"commands-groupsuggest-results"}),ZCScroll.scrollTop($("#commands-groupsuggest-results"),0)}else this.clear(),t.empty().hide()},handleAction:function(e,t,i){if(i){var a=SearchField.getNodeforSelection({uid:t.attr("uid"),type:t.attr("elemtype"),name:Groups.getDisplayName(t.attr("uid"))},!0);SearchField.insertNodeinField("commands-groupsuggest",void 0,a),Clickoutside.handleClickOnChild(e)}},clear:function(){$("#commands-groupsuggest-results").hide().find("#commands-groupsuggest-list").empty(),Clickoutside.clear("commands-groupsuggest-results")}},showLoading:function(e){IntegrationsCwin.showLoading(e)},reset:function(){IntegrationsCwin.close()}};var CommandConstants={};CommandConstants={Handlers:[1e3,1001],ALL:1,MINE:2,MYTEAM:3,ORGSCOPE:1,TEAMSCOPE:2,PRIVATESCOPE:3,ACTIVE:1,AWAITING_ORG_APPROVAL:5,ORG_APPROVED:10,DRE:0,ALLOWEDTRIGGERS:["@","-",":"],NOTHING_CHANGED:0,DETAILS_CHANGED:1,LIST_CHANGED:2,SPECIFIED_COMMANDS_DETAILS:3,EXECUTION_HANDLER_TYPE:1e3,SUGGESTION_HANDLER_TYPE:1001};var Commands={};Commands={FETCH_TIME:-1,recentCommands:[],init:function(){CommandsUI.bindEvents()},updateRecentCommands:function(e){this.recentCommands.length>=20&&this.recentCommands.slice(1),this.recentCommands.push(e)},getAll:function(){return $DB.get("commands").list},getAppCommandIds:function(e){var t=this.getAll(),i=[];for(var a in t){var s=t[a];s.appid==e&&i.push(a)}return i},getCommandsCount:function(){var e=Commands.getAll();return $WC.$CUtil.isEmpty(e)?0:Object.keys(e).length-this.getSystemCommandsCount()},getSystemCommandsCount:function(e){var t=e||Commands.getAll(),i=[];for(var a in t){var s=t[a];s.isdefault&&i.push(s)}return i.length},isExist:function(e){return this.getAll().hasOwnProperty(e)},isExistByName:function(e){e=e.toLowerCase();var t=this.getAll();for(var i in t){var a="/"+t[i].name.toLowerCase();if(e==a)return!0}return!1},isMyCommand:function(e){var t=this.getObject(e);return $WC.$CUtil.isEmpty(t)?void 0:$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator):t.appdetails.issandbox&&WmsImpl.isLocalUser(""+t.appdetails.developer)},hasDeletePermission:function(e){var t=this.getObject(e);if(!$WC.$CUtil.isEmpty(t)&&$WC.$CUtil.isEmpty(t.appid))if(SecurityManager.hasPermission(Modules.Commands,MActions.Delete)){if(WmsImpl.isLocalUser(""+t.creator))return!0;if(_isAppAccountAdmin()){if(t.scope===CommandConstants.ORGSCOPE)return!0;if(t.scope===CommandConstants.TEAMSCOPE)for(var i=t.teamids||[],a=0;a<i.length;a++)if(Groups.isMyGroup(""+i[a]))return!0}}else if(WmsImpl.isLocalUser(""+t.creator)&&t.scope===CommandConstants.PRIVATESCOPE)return!0;return!1},isFromIntegration:function(e){if(this.isExist(e)){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&!t.appdetails.issandbox}return!1},isFromSandBox:function(e){if(this.isExist(e)){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&t.appdetails.issandbox}return!1},isAwaitingOrgApproval:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&t.status==CommandConstants.AWAITING_ORG_APPROVAL},needsLocationForExecution:function(e){return(1&this.getObject(e).permission)>0},needsLocationForSuggestion:function(e){return(2&this.getObject(e).permission)>0},isDefaultCommand:function(e){var t=this.getObject(e);return t.isdefault?!0:!1},getObject:function(e){return $DB.get("commands").list[e]},getRuleCategory:function(e){var t=Composer.getPlainTextFromComposer(e).replace(/^\s+/g,"");if(-1!==t.indexOf(" ")){var i=e.substring("composer".length),a=ChatUI.exist[i],s=[];a.isChannel()?(s.push("/mail"),s.push("/title")):a.isSystemChat()&&s.push("/title"),t=t.split(" ");{var n=CommandsUtil.search({val:t[0],ignorelist:s,getashtml:!1});Object.keys(n)}for(var r in n){var o="/"+n[r].name;if(o===t[0])return o}}},getCommandId:function(e,t){e=$.trim($WC.DivEditor.removeBufferCharacters(e));var i=e.split(" ")[0];i=$.trim($WC.DivEditor.removeBufferCharacters(i));var a=$("#composer"+t).attr("commandid");if(!$WC.$CUtil.isEmpty(a)){var s=Commands.getObject(a);if(!$WC.$CUtil.isEmpty(s)&&i==="/"+s.name.toLowerCase())return a}if(Commands.isExistByName(i)){var n=Commands.getObjectByName(i),r=CommandsUtil.getCommandAccesType(t),o=n.commandaccessvalue||CommandsUtil.CMD_ALLOWED_IN_ALL;if(o&r)return n.id}},getObjectByName:function(e){e=e.toLowerCase();var t=this.getAll();for(var i in t){var a="/"+t[i].name.toLowerCase();if(e==a)return this.getObject(i)}},hasSuggestionsFunc:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&t.has_suggestions},hasCodeViewPermission:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.display_props)&&t.display_props.codevisibility},isSelectionLimitReached:function(e,t){var i=this.getObject(e),a=i.display_props;return!$WC.$CUtil.isEmpty(a)&&!$WC.$CUtil.isEmpty(a.selectionlimit)&&a.selectionlimit==t},getImgUrl:function(e){if(0>e)return $zcg._IMGDEFAULTSTATICURL+"/c"+e+".png";var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&t.photoid?"/commandimg/"+t.photoid+"/photo.do":this.getDefaultImgUrl()},getDefaultImgUrl:function(){return Settings.isDarkModeChoosed()?$Util.getImgStaticUrl()+"/dark_slash.svg":$zcg._IMGDEFAULTSTATICURL+"/slash.png"},deleteInObj:function(e){delete $DB.get("commands").list[e]},deleteAppEntities:function(e){for(var t=this.getAppCommandIds(e),i=0;i<t.length;i++)this.deleteInObj(t[i])},store:function(e){for(var t=$DB.get("commands"),i=t.list||{},a=function(e,t){for(var i in t)e[i]=t[i];return e},s=e.commands,n=0,r=s.length;r>n;n++){var o=s[n],l=o.id;i[l]=i[l]||{},i[l]=a(i[l],o)}t.list=i,$DB.update("commands",t)},create:function(e){$ZCAjx.ajax({url:"/v1/commands",type:"POST",data:e,contentType:"application/json",status:{loading:$("#IntegrationsRHS").find('[commandbuttons][purpose="create"]'),success:e.scope!==CommandConstants.ALL||_isAppAccountAdmin()?"command.added":"command.added.pending"},success:function(e){Commands.store(e.data);var t=e.data.commands[0].id;$("#addcommandui").attr("commandid",t),CommandsUI.handle.editCode(void 0,void 0,t)}})},edit:function(e,t){$ZCAjx.ajax({url:"/v1/commands/"+e,type:"PUT",data:t,contentType:"application/json",status:{loading:$("#IntegrationsRHS").find('[commandbuttons][purpose="saveEdit"]'),success:t.scope!==CommandConstants.ALL||_isAppAccountAdmin()||Commands.getObject(e).status==CommandConstants.ORG_APPROVED?"command.edited":"command.edited.pending"},success:function(e){Commands.store(e.data)}})},sync:function(){if(SecurityManager.hasPermission(Modules.Commands)){if("undefined"==typeof Commands._crcHandler){var e={api:"/v1/commands"},t={afterSync:function(){CommandsUI.populate()}};Commands._crcHandler=new CRCHandler("commands",e,t)}Commands._crcHandler.sync()}},"delete":function(e){$ZCAjx.ajax({url:"/v1/commands/"+e,type:"DELETE",status:{success:"command.deleted"},success:function(){var t=$("#"+e),i=t.siblings();if(0===i.length){var a=t.parent()[0].id;$("#"+a).remove(),$("#"+a+"header").remove(),IntegrationUI.listView.populateEmptyResult(Integration.Modules.Commands,"commandslist")}t.slideUp(300,function(){$(this).remove(),IntegrationUI.hidePreview()}),Commands.deleteInObj(e)}})},approve:function(e){$ZCAjx.ajax({url:"/v2/commands/"+e+"/approve",type:"POST",success:function(){UI.updateBanner(Resource.getRealValue("command.approved",[$zcg._APPACCOUNTNAME]),2e3);var t=Commands.getObject(e);t.status=CommandConstants.ORG_APPROVED,t.teamids=[],t.team_names={},IntegrationUI.hasPrevWin&&e===$("#Integrationspreview").attr("commandid")&&CommandsUI.showPreview(e),CommandsUI.populate()},error:function(e){UI.updateBanner(e.message,2e3,!0)}})},reject:function(e,t){var i={};t.length&&(i.reason=t),$ZCAjx.ajax({url:"/v2/commands/"+e+"/reject",type:"POST",contentType:"application/json",data:i,status:{success:"command.rejected"},success:function(){IntegrationUI.hasPrevWin&&e===$("#Integrationspreview").attr("commandid")&&IntegrationUI.hidePreview(),CommandsUI.populate()},error:function(e){UI.updateBanner(e.message,2e3,!0)}})}};var CommandsUtil={};CommandsUtil={prevsearchval:"",searchhtml:'<div purpose="search" commandid="{COMMANDID}" elemtype="shortcut" shortcut="{NAME}" class="flexC justifySB"><img width="24" height="24" class="fshrink mrgR10" src="{IMGURL}"><span class="listitem-title ellips fshrink">{DISPNAME}</span><span class="font13 clr8 ellips flxG">{HINT}</span></div>',CMD_ALLOWED_IN_CHAT:1,CMD_ALLOWED_IN_CHANNEL:2,CMD_ALLOWED_IN_BOT:4,CMD_ALLOWED_IN_TAZ:8,CMD_ALLOWED_IN_ALL:15,MAIL_COMMAND:-1,TITLE_COMMAND:-2,PIN_COMMAND:-3,UNPIN_COMMAND:-4,MUTE_COMMAND:-5,UNMUTE_COMMAND:-6,LEAVE_COMMAND:-7,FEEDBACK_COMMAND:-8,REMIND_COMMAND:-9,REMINDERS_COMMAND:-10,getCommandAccesType:function(e){var t=this.CMD_ALLOWED_IN_ALL;if($WC.$CUtil.isEmpty(e))return t;var i=new $CliqChatId(e);switch(i.chatType){case i.RestoreTypes.CHANNEL:t=this.CMD_ALLOWED_IN_CHANNEL;break;case i.RestoreTypes.CUSTOM_BOT:t=this.CMD_ALLOWED_IN_BOT;break;case i.RestoreTypes.TAZ:t=this.CMD_ALLOWED_IN_BOT;break;default:t=this.CMD_ALLOWED_IN_CHAT}return t},search:function(e){var t={html:this.searchhtml,getashtml:!0,limit:10,ignorelist:[],ignoredefaultcommands:!1};e=$.extend(t,e);var i="",a={},s=0,n=e.srcid?e.srcid.substr("composer".length):MainUI.currentchat,r=this.getCommandAccesType(n),o=Commands.getAll();e.val=e.val.toLowerCase(),e.val.startsWith("/")&&(e.val=e.val.substring(1));for(var l=this.sortByName(o),c=0;c<l.length;c++){var d=l[c];if(!(e.ignoredefaultcommands&&Commands.isDefaultCommand(d)||-1!==e.ignorelist.indexOf(d))){if(s===e.limit)break;var u=Commands.getObject(d),m=u.commandaccessvalue||this.CMD_ALLOWED_IN_ALL;if(m&r){var p=u.name.toLowerCase().indexOf(e.val);("*"===e.val||0===p)&&(e.getashtml?i+=CommandsUI.getHTML(u,e.html):a[d]=u,s++)}}}return e.getashtml?i:a},sortByName:function(e){var t=[];for(var i in e){var a=[];a.push(i),a.push(Commands.getObject(i).name),t.push(a)}t=$Util.sortString(t,1,!1);for(var s=[],n=0;n<t.length;n++)s.push(t[n][0]);return s},handleCommand:function(e,t,i){var a=!1;return a=Composer.sendMessage.call(t,i)},getAllowedTriggers:function(){return CommandConstants.ALLOWEDTRIGGERS},getSearchOptions:function(e,t,i){var a=Commands.getObjectByName(e).options,s="";for(var n in a)"*"!==t&&0!==n.indexOf(t)||-1!==i.indexOf(n)||(s+='<div elemtype="options" purpose="search" optionname="-'+n+'"><span class="zccmdoptlft">-'+n+'</span><span class="ellips" title="'+a[n]+'"> '+a[n]+"</span></div>");return s},getInsertedOptions:function(e){for(var t=Composer.getPlainTextFromComposer(e),i=t.split(" "),a=[],s=0;s<i.length;s++){var n=$.trim(i[s]);n.startsWith("-")&&a.push(n.substring(1))}return a},showOptionsTip:function(e,t,i){var a=this.getInsertedOptions(e);if(a.length>0){var s=a.indexOf(i);-1!==s&&a.splice(s,1)}var n=e.substring("composer".length),r="compautocomplete"+n,o=this.getSearchOptions(t,i,a),l=$("#"+r);if($WC.$CUtil.isEmpty(o))return l.html("").hide(),!1;o='<div id="'+r+'list" class="zchtdopp cur">'+o+"</div>",l.html(o).removeClass().addClass("zcoptnsdrp").css({top:"0px",left:"0px"});var c="block"===l.css("display");c||Clickoutside.bind({srcid:e,destid:r});var d=$Util.getCaretPosition(e),u=$(window).width()-l.width()-30;return d.left=Math.min(d.left+5,u),d.top=d.top-l.height()-5,l.css({top:d.top+"px",left:d.left+"px"}),l.find('[purpose="search"]').first().addClass("sel"),!0},getHelpTip:function(e,t){var i,a=this.getInsertedOptions("composer"+e),s=Commands.getObjectByName(t).options;if(!$WC.$CUtil.isEmpty(s)){if(a.length>0){var n=a[a.length-1];"undefined"!=typeof s[n]&&(i=s[n]+"<em>"+Resource.getRealValue("commands.option.doublequote")+"</em>")}if("undefined"==typeof i){i="";for(var r in s)i+='<span class="mrgR5">-'+r+"</span>"}}return $WC.$CUtil.isEmpty(i)||(i='<div class="zccmdopthnt">'+i+"</div>"),i},isCommandHistoryAvailable:function(e,t,i){var a=Commands.recentCommands;if(a.length>0){var s=e.getAttribute("currcommand");if($WC.$CUtil.isEmpty(s)){if(!i)return!1;var n=$(e).text();if(n=$WC.DivEditor.removeBufferCharacters(n),n=$.trim(n),!$WC.$CUtil.isEmpty(n))return!1}return!0}return!1},handleCommandHistory:function(e,t,i){var a=Commands.recentCommands;if(a.length>0){var s,n=e.getAttribute("currcommand");if($WC.$CUtil.isEmpty(n)){if(!i)return!1;var r=$(e).text();if(r=$WC.DivEditor.removeBufferCharacters(r),r=$.trim(r),!$WC.$CUtil.isEmpty(r))return!1;s=a.length-1}else n=$WC.$CUtil.isEmpty(n)?a.length-1:parseInt(n),s=i?n-1:n+1,s=0>s?0:s;var o="",l=e.getAttribute("commandid");if(s>a.length-1?s=a.length-1:(o=a[s].html,l=a[s].commandid),$WC.DivEditor.clear(e.id),e.innerHTML=o,$(e).find("[nodetype='att']").remove(),e.setAttribute("commandid",l),e.setAttribute("currcommand",s),!$WC.$CUtil.isEmpty(o)){$WC.DivEditor._setCaretPositionRelative(e.id,e.lastChild,"end");var c=Commands.getObject(l);if(c.has_suggestions){var d=$WC.DivEditor.removeBufferCharacters(e.innerText);CommandSuggestions.prevSugg=d,CommandSuggestions.show(t,'<div id="commandsdropdownhtml" commandsugg class="zcuserstatus"><div class="imgview-loadng"></div></div>'),CommandSuggestions.execute(l,t,d)}}return!0}return!1},getHint:function(e,t){var i=ChatUI.exist[t],a="";if($WC.$CUtil.isEmpty(e)||(a=e.hint),!$WC.$CUtil.isEmpty(i)){var s=i.isBot(),n=i.isChannel(),r=parseInt(e.id);if(e.isdefault&&(s||n))switch(r){case CommandsUtil.PIN_COMMAND:a=Resource.getRealValue(s?"common.bot.pin":"common.channel.pin");break;case CommandsUtil.UNPIN_COMMAND:a=Resource.getRealValue(s?"common.bot.unpin":"common.channel.unpin");break;case CommandsUtil.UNMUTE_COMMAND:a=Resource.getRealValue(s?"common.bot.unmute":"common.channel.unmute")}}return a}};var CommandSuggestions={};CommandSuggestions={suggestionTimer:"",prevSugg:null,html:'<div elemtype="commandsdropdown" purpose="search" elemtitle="{TITLE}" elemid="{ID}" desc="{DESCRIPTION}" imgurl="{IMGURL}" class="zcmdchdcnt">{IMG}<div class="zcmddtxt"><div class="zcmddtxt"><span class="ellips" title="{TITLE}">{TITLE}</span>{DESC}</div></div></div>',imgonlyhtml:'<div elemtype="commandsimagedropdown" purpose="search" elemid="{ID}" thumburl="{THUMBURL}" imgurl="{IMGURL}" class=""><img src="{URL}"/></div>',getSelectedForExecution:function(e){for(var t=$WC.DivEditor.getNodes("composer"+e),i=[],a=0;a<t.length;a++)if(t[a].nodeType!==Node.TEXT_NODE){var s=t[a];if("%"===s.getAttribute("nodetype")){var n={},r=s.getAttribute("elemid"),o=s.getAttribute("elemtitle"),l=s.getAttribute("desc"),c=s.getAttribute("thumburl"),d=s.getAttribute("imgurl");$WC.$CUtil.isEmpty(o)||(n.title=o),$WC.$CUtil.isEmpty(l)||(n.description=l),$WC.$CUtil.isEmpty(d)||(n.imageurl=d),$WC.$CUtil.isEmpty(c)||(n.thumburl=c),$WC.$CUtil.isEmpty(r)||(n.id=r),i.push(n)}}return i},getNodeForSelection:function(e,t,i,a,s){var n=document.createElement("SPAN");return $WC.$CUtil.isEmpty(i)||n.setAttribute("elemtitle",i),$WC.$CUtil.isEmpty(s)||n.setAttribute("desc",s),$WC.$CUtil.isEmpty(a)||n.setAttribute("imgurl",a),$WC.$CUtil.isEmpty(t)||n.setAttribute("elemid",t),n.setAttribute("contenteditable",!1),n.setAttribute("class","selusr"),n.setAttribute("nodetype","%"),n.innerHTML=$WC.$CUtil.processXSS($WC.$CUtil.isEmpty(i)?a:i),n},handleEnter:function(e,t){var i,a,s=$("#composer"+e)[0],n=t.getAttribute("elemid"),r=t.getAttribute("elemtitle"),o=t.getAttribute("desc"),l=t.getAttribute("imgurl"),c=$("#composer"+e).text(),d=Commands.getCommandId(c,e);if($WC.$CUtil.isEmpty(r))i=c.substring(c.indexOf(" ")+1||c.indexOf("\xa0")+1),a=CommandSuggestions.getNodeForSelection(i,n,void 0,l);else{var u=[];if(u=u.concat($Util.getAllIndexes(c," ")),u=u.concat($Util.getAllIndexes(c,"\xa0")),u=u.concat($Util.getAllIndexes(c,"\u200b")),u=$Util.removeDuplicateEntries(u),u=u.sort(function(e,t){return e-t}),u.length>0){i=$.trim(c.substring(u[u.length-1]));for(var m=u.length-1;m>=0;m--){var p=$.trim(c.substring(u[m]));if(0===r.toLowerCase().indexOf(p.toLowerCase())){i=p;break}}}else i=c;a=CommandSuggestions.getNodeForSelection(r,n,r,l,o)}$WC.$CUtil.isEmpty(i)?$WC.DivEditor.insertObject(s.id,s,a):$WC.DivEditor.insertSelection(s,i,a),$WC.DivEditor.insertText(s.id,"\xa0");var h=CommandSuggestions.getSelectedForExecution(e);Commands.isSelectionLimitReached(d,h.length)&&Composer.handleEnterKey.call(ChatUI.exist[e],s)},handleKeyUp:function(e,t,i,a,s,n,r){var o=a.which,l=Composer.getPlainTextFromComposer("composer"+t);if(l=$.trim(l),!e.startsWith("/")||"@"===s||"-"===s&&-1===n.indexOf(" "))return this.prevSugg=l,void this.clearDropDown(t);if(r||o!==$zcg.UP_KEYCODE&&o!==$zcg.DOWN_KEYCODE&&o!==$zcg.ENTER_KEYCODE){var c=Commands.getObject(Commands.getCommandId(l,t));$("#composer"+t).attr("commandid",c.id),$WC.$CUtil.isEmpty(c)||c.isdefault||!c.has_suggestions?(this.prevSugg=null,this.clearDropDown(t)):this.prevSugg!==l&&(this.prevSugg=l,r?(this.show(t,'<div id="commandsdropdownhtml" commandsugg class="zcuserstatus"><div class="imgview-loadng"></div></div>'),CommandSuggestions.execute(c.id,t,l),a.stopPropagation()):l!==e&&(clearTimeout(this.suggestionTimer),this.clearDropDown(t),this.show(t,'<div id="commandsdropdownhtml" commandsugg class="zcuserstatus"><div class="imgview-loadng"></div></div>'),this.suggestionTimer=setTimeout(function(){CommandSuggestions.execute(c.id,t,l)},1e3)))}},execute:function(e,t,i){var a={chid:t,message:i},s=this.getSelectedForExecution(t);$WC.$CUtil.isEmpty(s)||(a.selections=JSON.stringify(s)),$ZCAjx.ajax({url:"/v1/commands/"+e+"/suggestions",type:"POST",data:a,setLocation:Commands.needsLocationForSuggestion(e),success:function(a){a=a.data,"Success"===a.status&&CommandSuggestions.prevSugg===i&&(CommandSuggestions.clearDropDown(t),a.result.output.length>0&&CommandSuggestions.populate(t,a.result.output));var s=Commands.getObject(e);IntegrationsResponse.showPromptAndDebugMessages({module:Integration.Components.Command,id:e,name:"/"+s.name,imageUrl:Commands.getImgUrl(e,s.scope)},a,t)},error:function(){CommandSuggestions.clearDropDown(t)}})},populate:function(e,t){for(var i="",a=t[0],s=a.imageurl&&!a.title&&!a.description,n=0;n<t.length;n++){var r=t[n];$WC.$CUtil.isEmpty(r.id)||(r.id=$Util.xssAndEscapeReplacementString(""+r.id)),r.title?($WC.$CUtil.isEmpty(r.title)||(r.title=$Util.xssAndEscapeReplacementString(r.title)),$WC.$CUtil.isEmpty(r.description)||(r.description=$Util.xssAndEscapeReplacementString(r.description)),i+=this.html.replace(/{TITLE}/g,r.title).replace(/{IMGURL}/g,r.imageurl?r.imageurl:"").replace(/{ID}/g,r.id?r.id:"").replace(/{DESCRIPTION}/g,r.description?r.description:"").replace(/{IMG}/,r.imageurl?'<img src="'+r.imageurl+'" class="floatl mrgR10">':"").replace(/{DESC}/g,r.description?'<span title="'+r.description+'" class="dB ellips">'+r.description+"</span>":"")):s&&(i+=this.imgonlyhtml.replace(/{IMGURL}/g,r.imageurl).replace(/{THUMBURL}/g,r.thumburl?r.thumburl:"").replace(/{URL}/g,r.thumburl?r.thumburl:r.imageurl).replace(/{ID}/g,r.id?r.id:""))}if(!$WC.$CUtil.isEmpty(i)){i=s?'<div id="imgsuggcont" class="zcimgprvcont"><div id="imgsuggpreview" elemtype="commandsimagedropdownpreview" style="" class="zcimgsuggpreview"><img src="'+a.imageurl+'"/></div><div id="commandsdropdownhtml" searchcatagory="commandsdropdown" class="zcimgsug">'+i+"</div></div>":!a.title||a.imageurl||a.description?'<div id="commandsdropdownhtml" searchcatagory="commandsdropdown">'+i+"</div>":'<div id="commandsdropdownhtml" searchcatagory="commandsdropdown" class="zctxtly">'+i+"</div>",this.show(e,i,s,t.length)}},show:function(e,t,i,a){var s="compautocomplete"+e,n=$("#"+s);n.removeClass().addClass("chtedtrdrpdwn zccmdsug").css("height","").html('<div id="'+s+'list" class="drpdwn srchglt">'+t+"</div>"),"none"===n.css("display")&&Clickoutside.bind({srcid:"composer"+e,destid:s,callback:function(){CommandSuggestions.prevSugg=null}}),n.find("[purpose='search']").first().addClass("sel"),i?(this.images.adjust(e,a),ZCScroll.customScroll($("#"+s+"list").find("#commandsdropdownhtml"),!0)):ZCScroll.customScroll($("#"+s+"list"),!0)},clear:function(){this.prevSugg=null,clearTimeout(this.suggestionTimer)},clearDropDown:function(e){var t=$("#compautocomplete"+e);t.find("#commandsdropdownhtml").length>0&&(t.hide().children().remove(),Clickoutside.clear("compautocomplete"+e))},images:{getColumnsCount:function(e){var t,i=e.find('[elemtype="commandsimagedropdown"]').first(),a=i.outerWidth(),s=2*parseFloat(i.css("margin"));return s=isNaN(s)?0:s,t=(e.find("#commandsdropdownhtml").width()-s)/(a+s),t=Math.round(t)},initconstants:function(e){this.steps=5,this.containerMaxHeight=260;var t=$("#"+e).find("#chatwindropdown").width();t>1e3?(this.minWidth=80,this.maxWidth=100,this.minMargin=20,this.maxColumns=10,this.maxRows=2,this.minRows=2):400>t?(this.minWidth=40,this.maxWidth=60,this.minMargin=10,this.maxColumns=4,this.maxRows=3,this.minRows=2):(this.minWidth=60,this.maxWidth=80,this.minMargin=15,this.maxColumns=7,this.maxRows=3,this.minRows=2)},adjust:function(e,t){this.initconstants(e);var i,a=$("#"+e),s=a.find("#chatwindropdown").innerWidth(),n=(this.maxWidth-this.minWidth)/this.steps+1,r=(2+t)*(this.maxWidth+this.minMargin)+this.minMargin;if(s>r)l=t,c=n-1,i=0;else for(var o=!1,l=1;l<=this.maxColumns;l++){for(var c=0;n>c;c++){var d=s-l*(this.minWidth+c*this.steps+this.minMargin)-this.minMargin;if(0>d){o=!0;break}i=d/(l+1)}if(o)break}var u=this.minMargin+i;c=0==c?n-1:c;var m=this.minWidth+(c-1)*this.steps,p=Math.ceil(t/l);p=Math.max(this.minRows,Math.min(this.maxRows,p));for(var h=1;p>=h;h++){var g=h*(m+u)+u;if(this.containerMaxHeight-g<0)break}var f=(h-1)*(m+u)+u;a.find("#compautocomplete"+e).css({height:f+"px"}),a.find("#compautocomplete"+e+"list").css("height","calc(100% + 1px)");var v=a.find("#commandsdropdownhtml").children();v.css({width:m+"px",height:m+"px",margin:u/2+"px"});var C=(h-2)*u+(h-1)*m;a.find("#imgsuggpreview").css({width:C+"px",height:C+"px",margin:u/2+"px"}),a.find("#imgsuggcont").css("padding",u/2+"px"),a.find("#commandsdropdownhtml").css("width","calc(100% - "+(C+u)+"px)"),a.find("#imgsuggpreview").find("img").on("click load",function(t){"click"===t.type?(CommandSuggestions.handleEnter(e,$("#"+e).find("#commandsdropdownhtml").find(".sel")[0]),Composer.clearSearchResults(e)):$(this).css("opacity","1")})},changePreviewImage:function(e,t){$("#"+e).find("#imgsuggpreview").find("img").attr("src",t).css("opacity","0.05")}}};var MessageActionsUI={};MessageActionsUI={currentExample:2,listviewhtml:'<div class="zcinchls" id="{ACTIONID}" messageactionbuttons purpose="preview" messageactionid="{ACTIONID}"><div class="indivcom cur"><div class="zchlistimg mrgR10 mrgT3 floatl">{DELETEBUTTON}{PHOTO}</div><div class="dIB mrgL10 w70"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips">{NAME} &nbsp;<span class="clr8">({HINT})</span></div><div class="clr6 font14 dN zcinddics mrgL20"><div class="cur dIB zcclr">{EDITOPTIONS}</div></div></div></div><div class="dIB mrgT5 mrgB5"><span class="cur">{CREATOR}&nbsp;</span><span class="clr6">{TEAMNAME}&nbsp;</span></div></div></div></div>',appviewhtml:'<div appbuttons purpose="toggleSelection" messageactionid="{ACTIONID}" class="cur zcappintl zctext"><div class="zchlistimg mrgT3 floatl"><div title="Select" class="msi-hissel posa"></div>{PHOTO}</div><div class="dIB w70 mrgT5 mrgL10"><div title="{NAME}" class="ellips">{NAME}{SANDBOXTEXT}</div><div title="{HINT}" class="ellips mrgT5 clr8">{HINT}</div></div></div>',show:function(e,t){e&&0==MessageActions.getMessageActionsCount()?$("#IntegrationsRHS").html('<span list-view="true" class="zcldng"></span>'):this.populate(t),e&&MessageActions.get()},bindEvents:function(){$(document).on("click","[messageactionbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof MessageActionsUI.handle[t]&&MessageActionsUI.handle[t](this,e)}),$(document).on("keyup","[messageactionsinput]",function(e){MessageActionsUI.populate(e)}),$(document).on("mouseenter",'div[purpose="msg_app_options"]',function(){$("#msg-actions-search-field").focus()})},handleMsgActionCallback:function(){var e=$("#msg-actions-list");e.find("div:last-child").css("border","none"),$("#msg-actions-search-field").length&&SearchField.init("msg-actions"),ZCScroll.customScroll(e,!0)},cwin:{search:function(e){var t=$("#msg-actions-search-field"),i=t.parents('div[purpose="messageoperations"]'),a=MessageActionsUI.getOptionsHTML(t.attr("chid"),i,"",e).submenu;a=a||'<span class="absmiddle">'+Resource.getRealValue("common.search.result.none")+"</span>",i.find("#msg-actions-list").html(a).find("div:last-child").css("border","none")},handleAction:function(e,t){if(t.length){var i=t.attr("actionid");t=t.parents('div[purpose="msgoption"]'),t.after('<div id="msgactionsloading" class="zcmsgactnsldng"></div>');{var a=t.parents("[msgtime]").attr("uid"),s=t.parents('div[purpose="chatview"]').attr("id");MessageActions.getObject(i)}MessageActions.execute(i,s,a),MessageOperations.hideMsgOperation(t.find('div[purpose="messageoperations"]'))}},populateDefaultResult:function(){MessageActionsUI.cwin.search("")},handleKeyUp:function(e,t){var i=e.which;if(i===$zcg.ESCAPE_KEYCODE){var a=$("#msg-actions-search-field");$WC.$CUtil.isEmpty(t)?MessageOperations.hideMsgOperation(a.parents('div[purpose="messageoperations"]')):(a.empty().focus(),MessageActionsUI.cwin.search(""))}}},handle:{add:function(){$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this),t=Template.MessageActionCreateUI.replace(/{MESSAGEACTIONSCOPERADIOBUTTONS}/g,MessageActionsUI.getScopeBtnsHtml(MessageActionConstants.PRIVATESCOPE)).replace(/{MESSAGETYPESCHECKBOXES}/g,MessageActionsUI.getMsgTypesHtml());t=$Util.CustomCheckbox.construct(t,[{html:'<input id="codevisibilitycheckbox" catagory="notify" type="checkbox" class="zcunrdchkbx"/>',key:"{MESSAGEACTIONSVISIBILITY}",checked:!1}]),t=MessageActionsUI.replacePlaceHolders(t),e.html(t).fadeIn(300,function(){$("#messageactionname").focus()}),IntegrationsCwin.init(),ZCScroll.customScroll(e.find("#addmessageactionui"),!0),MessageActionsUI.bindCreateEvents(e)})},create:function(){var e=MessageActionsUI.validateAndGetParams($("#addmessageactionui"));$WC.$CUtil.isEmpty(e)||MessageActions.create(e)},editCode:function(e,t,i){"undefined"==typeof i&&(i=$(e).parents("[messageactionid]").attr("messageactionid"));var a=MessageActions.getObject(i);a.module=Integration.Modules.MessageActions,DREImpl.handleEditCode(a,i,MessageActionConstants.EXECUTION_HANDLER_TYPE)},editConfig:function(e){var t=$(e).parents("[messageactionid]").attr("messageactionid"),i=MessageActions.getObject(t);Clickoutside.clear("Integrationspreviewcontainer"),$("#IntegrationsRHS").fadeOut(300,function(){IntegrationsCwin.init();var e=$(this),a=Template.MessageActionEditUI;a=MessageActionsUI.replacePlaceHolders(a),a=a.replace(/{NAME}/,$Util.xssAndEscapeReplacementString(i.name)).replace(/{HINT}/,$Util.xssAndEscapeReplacementString(i.hint)).replace(/{MESSAGEACTIONSCOPERADIOBUTTONS}/g,MessageActionsUI.getScopeBtnsHtml(i.scope)).replace(/{MESSAGETYPESCHECKBOXES}/g,MessageActionsUI.getMsgTypesHtml(i.msgprops)).replace(/{SCOPEHINT}/,'<span class="clr6">'+Resource.getRealValue("integration.scope.info"+i.scope)+"</span>").replace(/{ACTIONID}/g,i.id);var s=MessageActions.hasCodeViewPermission(t);a=$Util.CustomCheckbox.construct(a,[{html:'<input id="codevisibilitycheckbox" catagory="notify" type="checkbox" '+(s?"checked ":"")+'class="zcunrdchkbx"/>',key:"{MESSAGEACTIONSVISIBILITY}",checked:s}]),e.html(a).find('[type="imgpreview"]').html('<img width="50px" height="50px" src="'+MessageActions.getImgUrl(t,i.scope)+'"/>'),e.fadeIn(300,function(){if(ZCScroll.customScroll($("#editmessageactioncontainer"),!0),i.scope===MessageActionConstants.TEAMSCOPE){$("#messageactionscopes-group").show(),$WC.DivEditor.focus("messageactions-groupsuggest-search-field");for(var e=i.teamids,t=0;t<e.length;t++){var a=SearchField.getNodeforSelection({uid:e[t],type:"group",name:i.team_names[e[t]]},!0);SearchField.insertNodeinField("messageactions-groupsuggest",void 0,a)}}});var n=$("#messageactionoptionscont").children("[messageactionoptions]"),r=0;for(var o in i.options){var l=$(n[r]);l.find("#key").val(o),l.find("#value").val(i.options[o]),r++}MessageActionsUI.bindCreateEvents(e)})},saveEdit:function(e){var t=$(e).parents("[messageactionid]").attr("messageactionid"),i=MessageActionsUI.validateAndGetParams($("#editmessageactionui"),MessageActions.getObject(t));$WC.$CUtil.isEmptyObject(i)?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):MessageActions.edit(t,i)},deleteMessageAction:function(e){var t=$(e).parents("[messageactionid]").attr("messageactionid"),i=MessageActions.getObject(t).name;$WC.$Dlg.confirm({id:"deletemessageaction",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("messageactions.confirm.delete.info1"),Resource.getRealValue("messageactions.confirm.delete.info2")],infoheader:Resource.getRealValue("integ.delete.info")}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-action"></div>',header:Resource.getRealValue("messageactions.confirm.delete",[i])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){MessageActions.deleteMessageAction(t)}}]})},preview:function(e,t,i){if("user"!==$(t.target).attr("elemtype")&&(IntegrationsCwin.hide(),"undefined"==typeof i&&(i=$(e).attr("messageactionid")),!IntegrationUI.hasPrevWin||i!==$("#Integrationspreview").attr("messageactionid"))){var a=MessageActions.getObject(i),s=MessageActionsUI.getHTML(a,Template.MessageActionsPreview),n="",r="",o="";MessageActions.isMyMessageAction(i)&&SecurityManager.hasPermission(Modules.MessageActions,MActions.Edit)&&(n='<div messageactionbuttons purpose="editConfig" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("commands.editconfig")+'</div><div messageactionbuttons purpose="editCode" class="posl dbtn adbtn floatr zcdedbtn">'+Resource.getRealValue("commands.editcode")+"</div>"),n+='<span drebuttons type="messageaction" purpose="showGrantedConsents" class="zcclr zc-consents">'+Resource.getRealValue("platformconsents.viewgranted")+"</span>",MessageActions.hasCodeViewPermission(i)&&(r='<div class="bold mrgT25">'+Resource.getRealValue("messageactions.codes")+'</div><div class="mrgT15">'+Resource.getRealValue("messageactions.exec.code")+'<div messageactionbuttons purpose="showCodePreview" class="dIB mrgL10 cur zccmdbtnlink">'+Resource.getRealValue("messageactions.viewcode")+'</div></div><div id="execcodepreview" style="display:none" class="zcprvwcont mrgT25 posrel"></div>');var l=a.msgprops.msgtypes.split(","),c="";for(k=0;k<l.length;k++)c+=MessageActionConstants.MSGTYPESVSVALUES[l[k]]+", ";c=l.length>0?c.substring(0,c.length-2):c,o=Resource.getRealValue("integration.messageactions.msgtypes")+'<span class="clr6"> - '+c+"</span>",s=s.replace(/{EDITBUTTONS}/,n).replace(/{CODEHTML}/g,r).replace(/{MSGPROPSHTML}/g,o),IntegrationUI.preview("messageactionid",i,s,t,function(){HomeUI.markseenAndRemoveComponentDiv("homeui_"+i,"messageactions")})}},search:function(e,t){MessageActionsUI.cwin.handleAction(t,$(e))}},replacePlaceHolders:function(e){var t=this.currentExample%3;this.currentExample++,e=e.replace(/{EX-NAME}/g,Resource.getRealValue("messageactions.ex")+Resource.getRealValue("messageactions.ex.name"+t)).replace(/{EX-HINT}/g,Resource.getRealValue("messageactions.ex")+Resource.getRealValue("messageactions.ex.hint"+t)).replace(/{EX-DESC}/g,Resource.getRealValue("messageactions.ex")+Resource.getRealValue("messageactions.ex.desc"+t));for(var i=1;5>=i;i++)e=e.replace(new RegExp("{KEY"+i+"}"),Resource.getRealValue("messageactions.ex")+" "+Resource.getRealValue("messageactions.ex.key"+t+i)),e=e.replace(new RegExp("{VALUE"+i+"}"),Resource.getRealValue("messageactions.ex")+" "+Resource.getRealValue("messageactions.ex.value"+t+i));return e},getMsgTypesHtml:function(e){var t='<div class="dIB mrgT15">{MESSAGETYPETEXT} <div class="floatl mrgL10">'+Resource.getRealValue("integration.actions.kind.text")+'</div></div><div class="dIB mrgT15 mrgL20">{MESSAGETYPEATT} <div class="floatl mrgL10">'+Resource.getRealValue("integration.actions.kind.att")+'</div></div><div class="dIB mrgT15 mrgL20">{MESSAGETYPELINKS} <div class="floatl mrgL10">'+Resource.getRealValue("integration.actions.kind.links")+"</div></div>",i=e&&e.msgtypes&&e.msgtypes.indexOf(MessageActionConstants.MSG_TYPE_TEXT)>=0,a=e&&e.msgtypes&&e.msgtypes.indexOf(MessageActionConstants.MSG_TYPE_ATT)>=0,s=e&&e.msgtypes&&e.msgtypes.indexOf(MessageActionConstants.MSG_TYPE_LINKS)>=0,n="undefined"==typeof e,r=[{html:'<input type="checkbox" class="zcunrdchkbx" '+(i||n?"checked":"")+' value="'+MessageActionConstants.MSG_TYPE_TEXT+'">',key:"{MESSAGETYPETEXT}",checked:i||n},{html:'<input type="checkbox" class="zcunrdchkbx" '+(a||n?"checked":"")+' value="'+MessageActionConstants.MSG_TYPE_ATT+'">',key:"{MESSAGETYPEATT}",checked:a||n},{html:'<input type="checkbox" class="zcunrdchkbx" '+(s||n?"checked":"")+' value="'+MessageActionConstants.MSG_TYPE_LINKS+'">',key:"{MESSAGETYPELINKS}",checked:s||n}];return t=$Util.CustomCheckbox.construct(t,r)},getScopeBtnsHtml:function(e){var t=Groups.getAllOrgGroups(),i=[{id:"messageactionscope1",value:MessageActionConstants.ORGSCOPE,label:Resource.getRealValue("integration.scope1"),checked:e===MessageActionConstants.ORGSCOPE}];return $.isEmptyObject(t)||i.push({id:"messageactionscope2",value:MessageActionConstants.TEAMSCOPE,label:Resource.getRealValue("channel.group"),checked:e===MessageActionConstants.TEAMSCOPE}),i.push({id:"messageactionscope4",value:MessageActionConstants.PRIVATESCOPE,label:Resource.getRealValue("integration.scope3"),checked:e===MessageActionConstants.PRIVATESCOPE}),$Dom.radio.construct("messageactionscope",i)},validateAndGetParams:function(e,t){var i=$.trim($("#messageactionname").val()),a=$.trim($("#messageactionhint").val()),s=parseInt($("#messageactionscoperadio").find("[name='messageactionscope']:checked").val()),n=($.trim($("#messageactiondesc").val()),$("#codevisibilitycheckbox").length>0?$("#codevisibilitycheckbox")[0].checked:!1),r=SearchField.getSelectedList("messageactions-groupsuggest-search-field"),o=$("#messageactionkinds").find("input[type='checkbox']:checked");if($WC.$CUtil.isEmpty(i)||i.length>20||!$WC.Matcher.check("textpattern",i))return $("#messageactionname").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#messageactionname-info"),e,200);if($WC.$CUtil.isEmpty(a)||a.length>100)return $("#messageactionhint").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#messageactionhint-info"),e,200);if(s===MessageActionConstants.TEAMSCOPE&&0===r.length)return $("#messageactions-groupsuggest-search-field").addClass("error"),void $Util.scrollToViewportTop($("#addmessageactionscope"),e,200);if(0==o.length)return $("#messageactionkinds").addClass("error"),void $Util.scrollToViewportTop($("#messageactionmsgprops-info"),e,200);var l="";for(k=0;k<o.length;k++)l+=o[k].value+",";l=l.substring(0,l.length-1);var c=JSON.stringify({msgtypes:l}),d=JSON.stringify({codevisibility:n});"undefined"!=typeof t&&(i=t.name!=i?i:void 0,a=t.hint!=a?a:void 0,s=t.scope!=s||s===MessageActionConstants.TEAMSCOPE?s:void 0,d=JSON.stringify(t.display_props)!=d?d:void 0,c=JSON.stringify(t.msgprops)!=c?c:void 0);var u=$("#messageactionphoto").siblings("[type='imgpreview']").find("img").attr("src");u=!$WC.$CUtil.isEmpty(u)&&u.startsWith("data:")?u:void 0,r=s!==MessageActionConstants.TEAMSCOPE||$WC.$CUtil.isEmpty(r)?void 0:JSON.stringify(r);var m={name:i,hint:a,scope:s,teamids:r,msgprops:c,image:u,display_props:d};return $Util.checkAndRemoveUndefinedKeys(m)},bindCreateEvents:function(e){e.find("#messageactionscope2").length&&(e.find("#messageactionscopes-group").append('<div class="zchcnt dIB"><div class="zchintt dIB font14 floatl bold">'+Resource.getRealValue("channel.group.title")+'</div><div class="zcaddcnt zcrtdrpd dIB floatl"><div id="messageactions-groupsuggest"><div id="messageactions-groupsuggest-selnodes"></div><div id="messageactions-groupsuggest-search-field" contenteditable="true" placeholder="'+Resource.getRealValue("channel.team.placeholder")+'" class="crtin mrgT25" placeholder="'+Resource.getRealValue("smartsearch.search.groups")+'"></div><div id="messageactions-groupsuggest-results" class="chdropdwn" style="display:none"></div></div></div></div>'),SearchField.init("messageactions-groupsuggest")),e.find("#messageactionscoperadio").on("change","[type='radio']",function(){parseInt(this.value)===MessageActionConstants.ORGSCOPE?($("#messageactionscopes-group").hide(),$("#messageactionscope-info").html(Resource.getRealValue("integration.scope.info1"))):parseInt(this.value)===MessageActionConstants.TEAMSCOPE?($("#messageactionscopes-group").show(),$("#messageactionscope-info").html(Resource.getRealValue("integration.scope.info2"))):parseInt(this.value)===MessageActionConstants.PRIVATESCOPE&&($("#messageactionscopes-group").hide(),$("#messageactionscope-info").html(Resource.getRealValue("integration.scope.info3")))}),e.find("#messageactionkinds").on("change","[type='checkbox']",function(e){e.currentTarget.checked&&$("#messageactionkinds").removeClass("error")}),e.find("#messageactionphoto").on("change",function(){var e=$(this),t=e.siblings("#messageactiondefimg"),i=$(this).siblings("[type='imgpreview']"),a=this.files[0],s=2;if("undefined"!=typeof a){if(!$Util.isValidImage(e,this.files,s))return;t.hide(),$Util.imgPrview(i,a)}}),e.on("input keyup","[messageactioninputs]",function(e){e.which!==$zcg.ESCAPE_KEYCODE&&e.stopPropagation(),IntegrationsCwin.handleKeyUp.messageactions(e,"add")})},getMessageActionsHomeViewHtml:function(e){if("undefined"==typeof e)return"";var t=e.id,i=$WC.$CUtil.processXSS(e.name),a=$WC.$CUtil.processXSS(e.hint),s=e.creator,n=Users.getName(s,e.creator_name);a=a.length>70?$.trim(a.substr(0,70))+"...":a;var r='<div id="homeui_'+t+'" documentclick="view_component" compid="'+t+'"  elementcat= "messageactions" purpose="componentview" class="zchmbtbx posl dIB cur"><div class="zchmcmdcnt posl"><span id="'+t+'" documentclick="component_markseen" type="messageactions" class="msi-close cur"></span><div class="zhmhd imgurl"><img class="mrgR10 floatl" src="'+MessageActions.getImgUrl(t)+'"/><div class="floatl	"><div class="bold">'+i+'</div><div>{CREATOR}</div></div></div><div class="clr6 mrgT10">'+a+"</div></div></div>";return r=MessageActions.isFromIntegration(t)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>"+(e.scope==MessageActionConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="'+s+'" class="cur">'+$Util.escapeReplacementString(n)+"</span>")},getHTML:function(e,t,i){t="undefined"!=typeof t?t:this.listviewhtml;var a=$WC.$CUtil.processXSS(e.name);if("undefined"!=typeof i){var s=(a.toLowerCase().indexOf(i),new RegExp($WC.Matcher.replace("escaperegexp",i),"i"));a=a.replace(s,"<b>$&</b>")}var n=a;e.appid&&(n+='<span class="clr6 fntnrml"> - '+Resource.getRealValue("common.via")+' <span class="clr5 bold"> '+$Util.xssAndEscapeReplacementString(e.appdetails.name)+" </span>"+Resource.getRealValue("app.app")+(e.appdetails.issandbox?" ("+Resource.getRealValue("app.sandbox")+")":"")+"</span>");var r=t.replace(/{NAME}/g,$Util.escapeReplacementString(a)).replace(/{DISPNAME}/g,$Util.escapeReplacementString(n)).replace(/{SANDBOXTEXT}/g,MessageActions.isFromSandBox(e.id)?'<span class="clr6"> ('+Resource.getRealValue("app.sandbox")+")</span>":"").replace(/{HINT}/g,$Util.xssAndEscapeReplacementString(e.hint));r=r.replace(/{ACTIONID}/g,e.id).replace(/{SCOPE}/,e.scope).replace(/{SCOPEHINT}/,Resource.getRealValue("integration.scope"+e.scope)+'<span class="clr6"> - '+Resource.getRealValue("integration.scope.info"+e.scope)+"</span>").replace(/{IMGURL}/,MessageActions.getImgUrl(e.id,e.scope)).replace(/{PHOTO}/,'<img height="48px" width="48px" src="'+MessageActions.getImgUrl(e.id,e.scope)+'" class="'+(MessageActions.hasDeletePermission(e.id)?"zccmdimgcr":"")+'">'),r=MessageActions.isFromIntegration(e.id)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>"+(e.scope==MessageActionConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):MessageActions.isFromSandBox(e.id)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+" ("+Resource.getRealValue("app.sandbox")+")</span></span>"+(e.scope==MessageActionConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")).replace(/{SANDBOXTEXT}/g," ("+Resource.getRealValue("app.sandbox")+")"):r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="'+e.creator+'" class="cur">'+$Util.escapeReplacementString(Users.getName(""+e.creator,e.creator_name))+"</span>");var o=e.scope==MessageActionConstants.TEAMSCOPE?"&nbsp;"+Resource.getRealValue("channel.created.for")+'&nbsp;<span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(Groups.getGroupNames(e.teamids,e.team_names))+"</span>":"";r=r.replace(/{TEAMNAME}/g,o);var l=MessageActions.hasDeletePermission(e.id)?'<div messageactionbuttons purpose="deleteMessageAction" title="Delete" class="msi-cmddel posa"></div>':"";r=r.replace(/{DELETEBUTTON}/g,l);var c=MessageActions.isMyMessageAction(e.id)&&SecurityManager.hasPermission(Modules.MessageActions,MActions.Edit)?'<div messageactionbuttons purpose="editCode" class="cur dIB zcclr"><span class="msi-editicn zcclr">&nbsp;&nbsp;</span>'+Resource.getRealValue("commands.editcode")+"</div>":"";return r=r.replace(/{EDITOPTIONS}/,c)},getOptionsHTML:function(e,t,i,a){var e=e;if(!i){e=e||t.parents('div[purpose="chatview"]').attr("chid");var t=$(t),s=t.parents().eq(1);i={chid:e,time:s.attr("msgtime"),mtype:s.attr("mtype"),mod:s.attr("mode"),iscustom:"custommsg"===s.find("[msgtype]").attr("msgtype"),msginfo:t.attr("msginfo")}}var n="",r="";if(SecurityManager.hasPermission(Modules.MessageActions)&&!$ZCVideoBroadcast.isVideoBroadcastPage){n='<div purpose="msg_app_options" title="'+Resource.getRealValue("message.option.appoptions")+'" class="zcf-moreaction zcapopt '+(i.isviewonly?" zcapoptfhover":"")+'"><span class="ellips zcapopttxt">'+Resource.getRealValue("message.option.appoptions")+'</span><span class="msi-rightarr bold posa"></span><div class="zchmorhov" id="msg-actions">{SEARCH}<div><div class="drpdwn srchglt" id="msg-actions-results"><div class="posrel height100" id="msg-actions-list">{SUBMENUS}</div></div></div></div></div>';var o='<div purpose="search" messageactionbuttons class="ellips zctext {SEL_CLASS}" title=\'{APPMATITLE}\' actionid={ACTIONID}>{SUBTITLE}</div>',l=i.msginfo?i.msginfo.split(":"):void 0,c="20"===i.mtype&&"att"===i.mod?MessageActionConstants.MSG_TYPE_ATT:MessageActionConstants.MSG_TYPE_TEXT,d=[{prop:"msgprops",isjsonvalue:!0,searchkey:"msgtypes"}],u=[c];a&&(d.push({prop:"name"}),u.push(a)),l&&"haslink"==l[0]&&"true"===l[1]&&(u=[MessageActionConstants.MSG_TYPE_LINKS],d=[{prop:"msgprops",isjsonvalue:!0,searchkey:"msgtypes"}]);var m=MessageActionsUtil.search({searchin:SearchAgent.MESSAGEACTIONS,val:u,searchwithproperties:d,getashtml:!1,limit:i.messageactionslimit?i.messageactionslimit:1e3}),p="";if(m){var h=0;for(actionid in m){var g=m[actionid],f=$WC.$CUtil.processXSS(g.name);g.appid&&(f+=" - "+Resource.getRealValue("common.via")+" "+$WC.$CUtil.processXSS(g.appdetails.name)+" "+Resource.getRealValue("app.app")+(g.appdetails.issandbox?" ("+Resource.getRealValue("app.sandbox")+")":"")),p+=o.replace(/{SUBTITLE}/g,$Util.xssAndEscapeReplacementString(g.name)).replace(/{ACTIONID}/g,actionid).replace(/{SEL_CLASS}/g,a&&0===h?"sel":"").replace(/{APPMATITLE}/g,$Util.getCustomTooltip(f.replace(/\s/g,"&nbsp;"),"","","east")),h++}var v=h>10?Template.MsgActionsSearch:"";n=p.length>0||i.isviewonly?n.replace(/{SUBMENUS}/g,$Util.escapeReplacementString(p)).replace(/{SEARCH}/g,v):"",r=p.length>0||i.isviewonly?"zcmsgacop":""}else n=""}return{html:n,classname:r,submenu:p}},populate:function(e){if(IntegrationUI.listView.isCurrent(Integration.Modules.MessageActions,e)){var t=MessageActions.getMessageActionsCount();if(IntegrationUI.listView.initialize(Integration.Modules.MessageActions,t,SecurityManager.hasPermission(Modules.MessageActions,MActions.Create)),0===t)return;var i;("undefined"==typeof e||e.which!==$zcg.ESCAPE_KEYCODE)&&(i=$("#messageactionsearch").val());var a;$WC.$CUtil.isEmpty(i)?a=MessageActions.getAll():(i=i.trim().toLowerCase(),a=MessageActionsUtil.search({searchin:SearchAgent.MESSAGEACTIONS,val:i,getashtml:!1,limit:100}));for(var s="",n="",r="",o=MessageActionsUtil.sortByName(a),l=0;l<o.length;l++){var c=o[l],d=this.getHTML(a[c],MessageActionsUI.listviewhtml,i);MessageActions.isMyMessageAction(c)?n+=d:r+=d}$WC.$CUtil.isEmpty(n)||(s='<div id="mymessageactionsheader" zc_running_title class="zcinhds font15 bold paddT10 posl">'+Resource.getRealValue("integration.my.messageaction")+'</div><div id="mymessageactions" class="zcinchls">'+n+"</div>"),$WC.$CUtil.isEmpty(r)||(s+='<div id="allmessageactionsheader" zc_running_title class="zcinhds font15 bold mrgT20 paddT10 floatl posl">'+Resource.getRealValue("integration.all.messageaction")+'</div><div id="allmessageactions" class="zcinchls">'+r+"</div>"),IntegrationUI.listView.populate(Integration.Modules.MessageActions,"messageactionslist",s,i,SecurityManager.hasPermission(Modules.MessageActions,MActions.Create))}},groupsuggestion:{search:function(e){var t=$("#messageactions-groupsuggest-results");t.html('<div id="messageactions-groupsuggest-list"  class="drpdwn srchglt"></div>');var i=SearchField.getSelectedList("messageactions-groupsuggest-search-field");if(i.length>=4)return void UI.updateBanner(Resource.getRealValue("messageactions.max.groups"),3e3,!0);var a=SearchAgent.search({searchin:SearchAgent.ORGGROUPS,val:e,ignorelist:i,listid:"messageactions-groupsuggest-list"});if(a){t.find("[purpose='search']").first().addClass("srchbn sel");var s="block"===t.css("display");s||Clickoutside.bind({srcid:"messageactions-groupsuggest-search-field",destid:"messageactions-groupsuggest-results"}),ZCScroll.scrollTop($("#messageactions-groupsuggest-results"),0)}else this.clear(),t.empty().hide()},handleAction:function(e,t,i){if(i){var a=SearchField.getNodeforSelection({uid:t.attr("uid"),type:t.attr("elemtype"),name:Groups.getDisplayName(t.attr("uid"))},!0);SearchField.insertNodeinField("messageactions-groupsuggest",void 0,a),Clickoutside.handleClickOnChild(e)}},clear:function(){$("#messageactions-groupsuggest-results").hide().find("#messageactions-groupsuggest-list").empty(),Clickoutside.clear("messageactions-groupsuggest-results")}},showLoading:function(e){IntegrationsCwin.showLoading(e)},reset:function(){IntegrationsCwin.close()}};var MessageActionConstants={};MessageActionConstants={ALL:1,MINE:2,MYTEAM:3,ORGSCOPE:1,TEAMSCOPE:2,PRIVATESCOPE:3,DRE:0,ALLOWEDTRIGGERS:["@","-",":"],NOTHING_CHANGED:0,DETAILS_CHANGED:1,LIST_CHANGED:2,SPECIFIED_ACTIONS_DETAILS:3,EXECUTION_HANDLER_TYPE:4e3,MSG_TYPE_TEXT:"TEXT",MSG_TYPE_LINKS:"LINKS",MSG_TYPE_ATT:"ATT",MSGTYPESVSVALUES:{TEXT:Resource.getRealValue("integration.actions.kind.text"),LINKS:Resource.getRealValue("integration.actions.kind.links"),ATT:Resource.getRealValue("integration.actions.kind.att")}};var MessageActions={};MessageActions={FETCH_TIME:-1,init:function(){MessageActionsUI.bindEvents()},getAll:function(){return $DB.get("messageactions").list},getAppMessageActionIds:function(e){var t=this.getAll(),i=[];for(var a in t){var s=t[a];s.appid==e&&i.push(a)}return i},getMessageActionsCount:function(){var e=MessageActions.getAll();return Object.keys(e).length},isExist:function(e){return this.getAll().hasOwnProperty(e)},isExistByName:function(e){e=e.toLowerCase();var t=this.getAll();for(var i in t){var a=t[i].name.toLowerCase();if(e==a)return!0}return!1},isMyMessageAction:function(e){var t=this.getObject(e);return $WC.$CUtil.isEmpty(t)?void 0:$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator):t.appdetails.issandbox&&WmsImpl.isLocalUser(""+t.appdetails.developer)},hasDeletePermission:function(e){var t=this.getObject(e);if(!$WC.$CUtil.isEmpty(t)&&$WC.$CUtil.isEmpty(t.appid)){if(SecurityManager.hasPermission(Modules.MessageActions,MActions.Delete))return WmsImpl.isLocalUser(""+t.creator)||_isAppAccountAdmin();if(WmsImpl.isLocalUser(""+t.creator)&&t.scope==MessageActionConstants.PRIVATESCOPE)return!0}return!1},isFromIntegration:function(e){if(this.isExist(e)){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&!t.appdetails.issandbox}return!1},isFromSandBox:function(e){if(this.isExist(e)){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&t.appdetails.issandbox}return!1},getObject:function(e){return $Util.cloneObject($DB.get("messageactions").list[e])},needsLocationForExecution:function(e){return(1&this.getObject(e).permission)>0},execute:function(e,t,i){var a={chid:t,msguid:i};$ZCAjx.ajax({url:"/v1/messageactions/"+e+"/executeaction",type:"POST",data:a,setLocation:this.needsLocationForExecution(e),trialExecutionChid:t,sendSID:!0,contentType:"application/json",success:function(i){$("#"+t).find("#msgactionsloading").remove(),IntegrationsResponse.populateOutput({module:Integration.Components.MessageAction,name:MessageActions.getObject(e).name,imageUrl:MessageActions.getDefaultImgUrl()},i.data.dreResponse,t),HomeUI.markseenAndRemoveComponentDiv("homeui_"+e,"messageactions")}})},getMessageActionId:function(e,t){e=$.trim($WC.DivEditor.removeBufferCharacters(e));var i=e.split(" ")[0];i=$.trim($WC.DivEditor.removeBufferCharacters(i));var a=$("#composer"+t).attr("messageactionid");if(!$WC.$CUtil.isEmpty(a)){var s=MessageActions.getObject(a);if(i===s.name.toLowerCase())return a}if(MessageActions.isExistByName(i)){var n=MessageActions.getObjectByName(i),r=MessageActionsUtil.getMessageActionAccesType(t),o=n.messageactionaccessvalue||MessageActionsUtil.CMD_ALLOWED_IN_ALL;if(o&r)return n.id}},getObjectByName:function(e){e=e.toLowerCase();var t=this.getAll();for(var i in t){var a=t[i].name.toLowerCase();if(e==a)return this.getObject(i)}},hasCodeViewPermission:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.display_props)&&t.display_props.codevisibility},getImgUrl:function(e){{var t=this.getObject(e);!$WC.$CUtil.isEmpty(t)&&t.photoid?t.photoid:e}return this.getDefaultImgUrl()},getDefaultImgUrl:function(){return Settings.isDarkModeChoosed()?$Util.getImgStaticUrl()+"/dark_msgaction.svg":$Util.getImgStaticUrl()+"/msgaction.png"},deleteInObj:function(e){delete $DB.get("messageactions").list[e]},deleteAppEntities:function(e){for(var t=this.getAppMessageActionIds(e),i=0;i<t.length;i++)this.deleteInObj(t[i])},store:function(e,t){$WC.$CUtil.isEmpty(t)||parseInt(t.updatetype)!==MessageActionConstants.LIST_CHANGED||$DB.clear("messageactions");for(var i=$DB.get("messageactions"),a=i.list||{},s=function(e,t){for(var i in t)e[i]=t[i];return e},n=e.messageactions,r=0,o=n.length;o>r;r++){var l=n[r],c=l.id;a[c]=a[c]||{},a[c]=s(a[c],l)}i.list=a,i.listchecksum=$WC.$CUtil.isEmpty(t)?i.listchecksum:t.listchecksum,i.detailschecksum=$WC.$CUtil.isEmpty(t)?i.detailschecksum:t.detailschecksum,$DB.update("messageactions",i)},create:function(e){$ZCAjx.ajax({url:"/v1/messageactions",type:"POST",data:e,contentType:"application/json",status:{loading:$("#IntegrationsRHS").find('[messageactionbuttons][purpose="create"]'),success:"messageaction.added"},success:function(e){MessageActions.store(e.data);var t=e.data.messageactions[0].id;$("#addmessageactionui").attr("messageactionid",t),MessageActionsUI.handle.editCode(void 0,void 0,t)}})},edit:function(e,t){$ZCAjx.ajax({url:"/v1/messageactions/"+e,type:"PUT",data:t,contentType:"application/json",status:{loading:$("#IntegrationsRHS").find('[messageactionbuttons][purpose="saveEdit"]'),success:"messageaction.edited"},success:function(e){MessageActions.store(e.data)}})},get:function(e,t){if(SecurityManager.hasPermission(Modules.MessageActions)){var i=$DB.get("messageactions")||{};$WC.$CUtil.isEmpty(i.listchecksum)&&(i.listchecksum=-1,i.detailschecksum=-1,$DB.update("messageactions",i));var a={listchecksum:i.listchecksum,detailschecksum:i.detailschecksum};e&&(a.mode=e),t&&(a.search=t),$ZCAjx.ajax({url:"/v1/messageactions",data:a,success:function(e){$WC.$CUtil.isEmpty(e.meta)||(parseInt(e.meta.updatetype)===MessageActionConstants.LIST_CHANGED?MessageActions.store(e.data,e.meta):parseInt(e.meta.updatetype)===MessageActionConstants.DETAILS_CHANGED&&MessageActions.getSpecifiedMessageActions(e.data.messageactions),MessageActions.FETCH_TIME=(new Date).getTime()),MessageActionsUI.populate()}})}},getSpecifiedMessageActions:function(e){var t=$DB.get("messageactions"),i=[];for(var a in t.list)e[a]!=t.list[a].detailschecksum&&i.push(t.list[a].id);i.length>0&&$ZCAjx.ajax({url:"/v1/messageactions",data:{messageactionids:i.join(",")},success:function(e){MessageActions.store(e.data),MessageActionsUI.populate()}})},deleteMessageAction:function(e){$ZCAjx.ajax({url:"/v1/messageactions/"+e,type:"DELETE",status:{success:"messageaction.deleted"},success:function(){var t=$("#"+e),i=t.siblings();if(0===i.length){var a=t.parent()[0].id;$("#"+a).remove(),$("#"+a+"header").remove(),IntegrationUI.listView.populateEmptyResult(Integration.Modules.MessageActions,"messageactionslist")}t.slideUp(300,function(){$(this).remove()}),MessageActions.deleteInObj(e)}})}};var MessageActionsUtil={};MessageActionsUtil={prevsearchval:"",searchhtml:'<div purpose="search" messageactionid="{ACTIOMID}" elemtype="shortcut" shortcut="{NAME}"><img width="24" height="24" style="float: left; margin: 8px 20px 0 0;" src="{IMGURL}"><div class="zdrpdwnrtmsg ellips">{HINT}</div><div class="zdrpdwnltmsg ellips">{DISPNAME}</div></div>',CMD_ALLOWED_IN_CHAT:1,CMD_ALLOWED_IN_CHANNEL:2,CMD_ALLOWED_IN_BOT:4,CMD_ALLOWED_IN_TAZ:8,CMD_ALLOWED_IN_ALL:15,getMessageActionAccesType:function(e){var t=this.CMD_ALLOWED_IN_ALL;if($WC.$CUtil.isEmpty(e))return t;var i=new $CliqChatId(e);switch(i.chatType){case i.RestoreTypes.CHANNEL:t=this.CMD_ALLOWED_IN_CHANNEL;break;case i.RestoreTypes.CUSTOM_BOT:t=this.CMD_ALLOWED_IN_BOT;break;case i.RestoreTypes.TAZ:t=this.CMD_ALLOWED_IN_BOT;break;default:t=this.CMD_ALLOWED_IN_CHAT}return t},search:function(e){var t={html:this.searchhtml,getashtml:!0,limit:10,ignorelist:[]};e=$.extend(t,e);for(var i="",a={},s=0,n=e.srcid?e.srcid.substr("composer".length):MainUI.currentchat,r=this.getMessageActionAccesType(n),o=MessageActions.getAll(),l=this.sortByName(o),c=0;c<l.length;c++){var d=l[c];if(-1===e.ignorelist.indexOf(d)){if(s===e.limit)break;var u=MessageActions.getObject(d),m=u.messageactionaccessvalue||this.CMD_ALLOWED_IN_ALL;if(m&r){for(var p=e.searchwithproperties?e.searchwithproperties:[{prop:"name"}],h=e.searchwithproperties?e.val:[e.val],g=!1,f=0;f<p.length;f++){var v=p[f].prop,C=h[f].toLowerCase(),y=p[f].isjsonvalue,b=p[f].searchkey,E=y?u[v][b]:u[v],I=E.toLowerCase().indexOf(C);if(E=E.toLowerCase(),"*"===C||0===I||y&&I>0)g=!0;else{if(!("msgtypes"===b&&h[f]==MessageActionConstants.MSG_TYPE_LINKS&&u[v][b].indexOf(MessageActionConstants.MSG_TYPE_TEXT)>=0)){g=!1;break}g=!0}}g&&(e.getashtml?i+=MessageActionsUI.getHTML(u,e.html):a[d]=u,s++)}}}return e.getashtml?i:a},sortByName:function(e){var t=[];for(var i in e){var a=[];a.push(i),a.push(MessageActions.getObject(i).name),t.push(a)}t=$Util.sortString(t,1,!1);for(var s=[],n=0;n<t.length;n++)s.push(t[n][0]);return s}};var BotConstants={},BotsUI={},Bots={},MyBots={},BotExecutorsUI={},BotExecutors={},BotSuggestions={};BotConstants={Handlers:[0,5,8,9,10],CUSTOM_BOT:3,ORGSCOPE:1,TEAMSCOPE:2,PRIVATESCOPE:3,MINE:1,ALL:2,DRE:0,MESSAGEHANDLERS:{TEXT:0,LINK:1,FILE:2,EVENT:3,STATUS:4,WELCOME:5,LOCATION:6,CONTACT:7,MENTION:8,INCOMING_WEBHOOK:9,CONTEXT:10},ACTIONHANDLER:101,isActionType:function(e){return e>=101&&105>=e},isHandlerType:function(e){return e>=0&&10>=e},isBotHandler:function(e){return this.isActionType(e)||this.isHandlerType(e)},NOTHING_CHANGED:0,DETAILS_CHANGED:1,LIST_CHANGED:2,SPECIFIED_COMMANDS_DETAILS:3},BotsUI={listviewhtml:'<div id="{BOTID}" botbuttons purpose="preview" botid="{BOTID}" class="indivcom cur"><div class="zchlistimg mrgR10 mrgT3 floatl">{DELETEBUTTON}{PHOTO}</div><div class="dIB mrgL10 w70"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn mrgR10 floatl ellips">{NAME}</div>{CREATOR}{TEAMNAME}<div class="clr6 font14 dN zcinddics mrgL20">{EDITOPTIONS}</div></div></div><div class="floatl mrgT5 clr6">{DESC}</div><div class="zchnsrclft mrgT10"><div class="zchlsrctit dIB">{UCOUNT}{SUBSCRIPTIONBUTTON}</div></div></div></div>',searchHtml:'<div uid="{BOTID}" data-val="{NAME}" elemtype="bot" purpose="search"><span class="usrimgsts"><img width="24" height="24" src="{IMGURL}"></span><span class="usrname ellips">{NAME}<em>'+Resource.getRealValue("group.created.by")+" {CREATOR}</em></span></div>",appviewhtml:'<div appbuttons purpose="toggleSelection" botid="{BOTID}" class="cur zcappintl zctext"><div class="zchlistimg mrgT3 floatl"><div title="Select" class="msi-hissel posa"></div>{PHOTO}</div><div class="dIB mrgL10 mrgT3 w70"><div title="{NAME}" class="ellips">{NAME}{SANDBOXTEXT}</div><div class="ellips mrgT5 clr8">{DESC}</div></div></div>',show:function(e,t){e&&0==Bots.getBotsCount()?$("#IntegrationsRHS").html('<span list-view="true" class="zcldng"></span>'):this.populate(t),e&&Bots.get()},getIdFromElem:function(e){return e=$(e),$WC.$CUtil.isEmpty(e.attr("botid"))?e.parents("[botid]").attr("botid"):e.attr("botid")},bindEvents:function(){$(document).on("click","[botbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof BotsUI.handle[t]&&BotsUI.handle[t](BotsUI.getIdFromElem(this),this,e)}),$(document).on("click","[execbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof BotExecutorsUI.handle[t]&&BotExecutorsUI.handle[t](this,e,BotsUI.getIdFromElem(this))}),$(document).on("focus","[botinputs],[actionmenu],[botstatus]",function(){$(this).removeClass("zcfdk_tmbzoom"),"undefined"!=typeof $(this).attr("actionmenu")&&BotExecutorsUI.handle.actionEditMode($(this))}),$(document).on("focusout","[actionmenu]",function(){BotExecutorsUI.handle.actionSavedMode($(this))}),$(document).on("keyup","[actionmenu]",function(e){BotExecutorsUI.handle.validateActionHandler($(this),e,BotsUI.getIdFromElem(this))}),$(document).on("keyup","[botsearch]",function(e){BotsUI.populate(e)})},getBotsHomeViewHTML:function(e){if("undefined"==typeof e)return"";var t=e.id,i=$WC.$CUtil.processXSS(e.name),a=$WC.$CUtil.processXSS(e.desc),s=e.creator,n=Users.getName(s,e.creator_name);a=a.length>70?$.trim(a.substr(0,70))+"...":a;var r='<div id="homeui_'+t+'" documentclick="view_component" compid="'+t+'"  elementcat= "bots" purpose="componentview" class="zchmbtbx posl dIB cur"><div class="zchmbtcnt posl"><span id="'+t+'" documentclick="component_markseen" type="bots" class="msi-close cur"></span><div class="zhmhd imgurl"><img class="mrgR10 floatl" src="'+Bots.getImgUrl(t)+'"/><div class="floatl	"><div class="bold">'+i+'</div><div>{CREATOR}</div></div></div><div class="clr6 mrgT10">'+a+'</div><div class="font15 bold zcbtacbtn"><span class="zchmbtsb mrgL10 cur" id="'+t+'" documentclick="subscribe_latestbot" >'+Resource.getRealValue("bots.subscribe")+'</span></div></div><div class="zchmbtimg"><img src="'+Bots.getIconImgUrl()+'"/></div></div>';return r=Bots.isFromIntegration(t)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>"+(e.scope==BotConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):Bots.isFromSandBox(t)?r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span> ("+Resource.getRealValue("app.sandbox")+")</span>"+(e.scope==BotConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):r.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="'+s+'" class="zctxthgh cur">'+$Util.escapeReplacementString(n)+"</span>")},switchView:function(e,t,i,a){var s=$("#IntegrationsRHS");s.fadeOut(300,function(){$WC.$CUtil.isEmpty(a)?IntegrationsCwin.hide():IntegrationsCwin.init(void 0,a),s.html(e).fadeIn(300,function(){"function"==typeof i&&i(),$WC.$CUtil.isEmpty(t)||ZCScroll.customScroll($("#"+t),!0)})})},handle:{createUI:function(){var e=Template.EditBots.replace(/{HEADER}/,Resource.getRealValue("bots.create")).replace(/{BOTID}/g,"").replace(/{NAME}/g,"").replace(/{DESC}/g,"").replace(/{PHOTO}/,"").replace(/{DEFAULTIMG}/g,Bots.getDefaultImgUrl()).replace(/{BOTSCOPERADIOBUTTONS}/g,BotsUI.getScopeBtnsHtml(BotConstants.PRIVATESCOPE));BotsUI.switchView(e,"editbotui",function(){BotsUI.bindCreateEvents($("#editbotui")),$("#botname").focus()})},createOrEdit:function(e,t,i){$WC.$CUtil.isEmpty(e)?this.create():this.edit(e,t,i)},create:function(){var e=BotsUI.validateAndGetParams($("#editbotui"));$WC.$CUtil.isEmpty(e)||($Util.Button.addLoadIcon($("#IntegrationsRHS").find('[purpose="create"]')),Bots.create(e,function(e){BotsUI.handle.editBotHandlers(e)}))},editUI:function(e){Clickoutside.clear("Integrationspreviewcontainer");var t=Bots.getObject(e),i=Template.EditBots;i=i.replace(/{BOTID}/g,t.id).replace(/{HEADER}/,Resource.getRealValue("bots.edit")+" - "+$Util.xssAndEscapeReplacementString(t.name)).replace(/{NAME}/g,$Util.xssAndEscapeReplacementString(t.name)).replace(/{DESC}/g,$Util.xssAndEscapeReplacementString(t.desc)).replace(/{DEFAULTIMG}/g,Bots.getDefaultImgUrl()).replace(/{PHOTO}/,'<img width="50px" height="50px" src="'+Bots.getImgUrl(e)+'"/>').replace(/{BOTSCOPERADIOBUTTONS}/g,BotsUI.getScopeBtnsHtml(t.scope)),BotsUI.switchView(i,"editbotui",function(){if(BotsUI.bindCreateEvents($("#editbotui")),$("#botname").attr("readonly",""),$("#botdesc").focus(),Bots.isTeamScoped(e)){$("#botscopes-group").show(),$WC.DivEditor.focus("bots-groupsuggest-search-field");for(var i=t.teamids,a=0;a<i.length;a++){var s=SearchField.getNodeforSelection({uid:i[a],type:"group",name:t.team_names[i[a]]},!0,!0);$("#bots-groupsuggest-selnodes").show().append(s)}}if(!$WC.$CUtil.isEmpty(t.statusmsg))for(var n=$("#botstatuscont").children("[botstatus]"),a=0;a<t.statusmsg.length;a++)$(n[a]).val(t.statusmsg[a])})},edit:function(e){var t=BotsUI.validateAndGetParams($("#editbotui"),Bots.getObject(e));$WC.$CUtil.isEmptyObject(t)?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):Bots.edit(e,t)},"delete":function(e){var t=Bots.getObject(e).name;$WC.$Dlg.confirm({id:"deletebot",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("bot.delete.info1"),Resource.getRealValue("bot.delete.info2")],infoheader:Resource.getRealValue("integ.delete.info")}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-boticon"></div>',header:Resource.getRealValue("bots.delete.confirm",[$WC.$CUtil.processXSS(t)])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Bots.delete(e)}}]})},editBotHandlers:function(e){DREImpl.checkAndCloseEditor(function(){Clickoutside.clear("Integrationspreviewcontainer"),IntegrationUI.handle.showSavedLHSState();var t=Bots.getObject(e),i=Template.BotHandlers.replace(/{BOTID}/g,e).replace(/{NAME}/g,$Util.xssAndEscapeReplacementString(t.name)),a="";if(!$WC.$CUtil.isEmpty(t.actionhandles))for(var s=0;s<t.actionhandles.length;s++){var n=$WC.$CUtil.isEmpty(t.actionhandles)||$WC.$CUtil.isEmpty(t.actionhandles[s])?void 0:t.actionhandles[s];a+=BotsUI.getMenuHtml(n)}($WC.$CUtil.isEmpty(t.actionhandles)||t.actionhandles.length<5)&&(a+='<div execbuttons purpose="addMoreAction" class="dIB mrgT20 zcclr cur">'+Resource.getRealValue("bots.addmenu")+"</div>"),i=i.replace(/{ACTIONS}/,a),i=BotsUI.replaceMessageHandlers(i,t),BotsUI.switchView(i,"allbothandlers")})},preview:function(e,t,i){if("user"!==$(i.target).attr("elemtype")&&(IntegrationsCwin.hide(),!IntegrationUI.hasPrevWin||e!==$("#Integrationspreview").attr("botid"))){var a=BotsUI.getPreviewHtml(e);IntegrationUI.preview("botid",e,a,i,function(){ZCScroll.customScroll($("#botpreviewcont"),!0),HomeUI.markseenAndRemoveComponentDiv("homeui_"+e,"bots")})}},subscribe:function(e){Bots.subscribe(e),HomeUI.markseenAndRemoveComponentDiv("homeui_"+e,"bots"),HoverDetails.hide(),$WC.$Win.destroy("botpermalinkwin")},unSubscribe:function(e){Bots.unSubscribe(e)},startChat:function(e,t){$WC.$Win.destroy("botpermalinkwin"),MyBots.join($(t).attr("chid"))},copyPermalink:function(e){var t=Contacts.getBot(e),i="/bots/"+t.uniquename;t.app&&(i="/extensions/"+t.app.id+i),i=window.location.origin+i,$Util.copyTextToClipboard(i,function(){UI.updateBanner(Resource.getRealValue("bots.permalink.banner"))})},executeAction:function(e,t,i){var a=t.getAttribute("exec_id");Bots.executeAction(e,a),Clickoutside.handleClickOnChild(i,t)},showMoreActions:function(e,t){var i=t.getAttribute("chid");Clickoutside.bind({srcid:"bot_sub_actions_container"+i,destid:"bot_sub_actions"+i,closeOnClickSrc:!1})}},getScopeBtnsHtml:function(e){var t=[{id:"botscope1",value:BotConstants.ORGSCOPE,label:Resource.getRealValue("integration.scope1"),checked:e===BotConstants.ORGSCOPE}],i=Groups.getAllOrgGroups();return $.isEmptyObject(i)||t.push({id:"botscope2",value:BotConstants.TEAMSCOPE,label:Resource.getRealValue("channel.group"),checked:e===BotConstants.TEAMSCOPE}),t.push({id:"botscope3",value:BotConstants.PRIVATESCOPE,label:Resource.getRealValue("integration.scope3"),checked:e===BotConstants.PRIVATESCOPE}),$Dom.radio.construct("botscoperadio",t)},getPreviewHtml:function(e){var t=Bots.getObject(e),i="";Bots.isCreatedByMe(e)&&SecurityManager.hasPermission(Modules.Bots,MActions.Edit)&&(i='<div botbuttons purpose="editUI" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("commands.editconfig")+'</div><div botbuttons purpose="editBotHandlers" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("bots.handlers.edit")+"</div>"),i+='<span drebuttons type="bot" purpose="showGrantedConsents" class="zcclr zc-consents">'+Resource.getRealValue("platformconsents.viewgranted")+"</span>";var a="";if(!$WC.$CUtil.isEmpty(t.statusmsg)&&t.statusmsg.length>0){for(var s=0;s<t.statusmsg.length;s++)a+='<li class="font15 mrgT10"><span class="clr6">'+$WC.$CUtil.processXSS(t.statusmsg[s])+"</span></li>";a='<div class="zcincmli paddT10"><div class="bold mrgT15">'+Resource.getRealValue("common.status")+"</div><div>"+Resource.getRealValue("bots.preview.status")+"</div>"+a+"</div>"}var n="";if(!$WC.$CUtil.isEmpty(t.actionhandles)&&t.actionhandles.length>0){for(var s=0;s<t.actionhandles.length;s++){var r=t.actionhandles[s].display_props;n+='<div class="font15 mrgT10">'+(s+1)+') <span class="clr6">'+$WC.$CUtil.processXSS(r.name)+"</span></div>"}$WC.$CUtil.isEmpty(n)||(n='<div class="zcincmli mrgT25"><div class="bold font15">'+Resource.getRealValue("bots.menu.ques")+"</div><div>"+Resource.getRealValue("bots.preview.menu")+"</div><div>"+n+"</div></div>")}var o="";if(!$WC.$CUtil.isEmpty(t.messagehandles)&&t.messagehandles.length>0){for(var l=1,s=0;s<t.messagehandles.length;s++){var c=t.messagehandles[s];c.type!==BotConstants.MESSAGEHANDLERS.STATUS&&(o+='<div class="font15 mrgT10">'+l+') <span class="clr6">'+IntegrationsUtil.getHandlerName(c.type)+"</span></div>",l++)}$WC.$CUtil.isEmpty(o)||(o='<div class="zcincmli mrgT25"><div class="bold font15">'+Resource.getRealValue("bots.handlers.ques")+"</div><div>"+Resource.getRealValue("bots.preview.msghandlers")+"</div><div>"+o+"</div></div>")}var d="";if(!t.appid||Bots.isFromSandBox(e)){var u=window.location.origin+"/api/v2/bots/"+t.uniquename+"/message",m=window.location.origin+"/api/v2/bots/"+t.uniquename+"/incoming";d='<div class="zcincmli"><div class="mrgT25 zcendpnt"><span class="bold">'+Resource.getRealValue("channel.restapi.endpoint")+'</span><span documentclick="copyclipboard" class="zcprvwcpylnk">'+Resource.getRealValue("common.copy")+'</span><div clipboardarea class="clr6 mrgT10 wrdbrkall">'+u+'</div></div><div class="mrgT25 zcendpnt"><span class="bold">'+Resource.getRealValue("app.incoming.webhook")+'</span><span documentclick="copyclipboard" class="zcprvwcpylnk">'+Resource.getRealValue("common.copy")+'</span><div clipboardarea class="clr6 mrgT10 wrdbrkall">'+m+"</div></div></div>"}var p=Template.BotPreview.replace(/{BOTID}/g,t.id).replace(/{NAME}/g,$Util.xssAndEscapeReplacementString(t.name)).replace(/{DESC}/g,$Util.xssAndEscapeReplacementString(t.desc)).replace(/{EDITBUTTONS}/,i).replace(/{PHOTO}/,'<img height="48px" width="48px" src="'+Bots.getImgUrl(t.id)+'">').replace(/{STATUS}/g,$Util.escapeReplacementString(a)).replace(/{MENU}/g,$Util.escapeReplacementString(n)).replace(/{MSGHANDLERS}/,o).replace(/{APIENDPOINT}/,d).replace(/{SCOPEHINT}/,'<span class="clr6">'+Resource.getRealValue("integration.scope.info"+t.scope)+"</span>");return p},getMenuHtml:function(e,t){var i;return i=$WC.$CUtil.isEmpty(e)?'<div class="mrgT15 posl zcmebot zcbotin lin22'+(t?" dN":"")+'"><span class="msi-wand"></span><input id="name" type="text" actionmenu maxlength="15" autocomplete="off" placeholder="'+Resource.getRealValue("bots.action.name")+'" class="zcbtinet curtxt"/><span id="line" class="zcbotundlin"></span><span execbuttons purpose="createActionHandler" class="zcclr cur">'+Resource.getRealValue("common.add")+"</span></div>":'<div exec_id="'+e.id+'" bothandler class="mrgT15 posl zcmebot zcbotin lin22'+(t?" dN":"")+'" type="'+e.type+'" actionname="'+e.display_props.name+'"><span class="msi-wand"></span><input id="name" type="text" actionmenu maxlength="15" autocomplete="off" value="'+$WC.$CUtil.processXSS(e.display_props.name)+'" placeholder="'+Resource.getRealValue("bots.action.name")+'" class="zcbtnn curtxt"><span id="line" class="zcbotundlin zcbotundlinhid"></span><span execbuttons purpose="saveActionHandler" style="display:none" class="mrgR20 zcclr cur">'+Resource.getRealValue("common.save")+'</span><span execbuttons purpose="editHandler" class="zcclr cur dN">'+Resource.getRealValue("commands.editcode")+'</span><span execbuttons purpose="deleteHandler" class="mrgL20 zcclr cur dN">'+Resource.getRealValue("common.delete")+"</span></div>"},replaceMessageHandlers:function(e,t){if(!$WC.$CUtil.isEmpty(t.messagehandles))for(var i=0;i<t.messagehandles.length;i++){var a=t.messagehandles[i],s=(a.display_props.hint,'<div exec_id="'+t.messagehandles[i].id+'" bothandler type="'+a.type+'"><span execbuttons purpose="editHandler" class="zcclr cur">'+Resource.getRealValue("commands.editcode")+'</span><span execbuttons purpose="deleteHandler" class="mrgL20 zcclr cur">'+Resource.getRealValue("common.delete")+"</span></div>");e=e.replace(new RegExp("{TYPE"+a.type+"}"),s)}for(var i=0;10>=i;i++){var s='<div type="'+i+'" bothandler><span execbuttons purpose="addHandler" class="zcclr cur">'+Resource.getRealValue("commands.editcode")+"</span></div>";e=e.replace(new RegExp("{TYPE"+i+"}"),s)}return e},bindCreateEvents:function(e){e.find("#botscope2").length&&(e.find("#botscopes-group").append('<div class="zchcnt dIB"><div class="zchintt dIB font14 floatl bold">'+Resource.getRealValue("channel.group.title")+'</div><div class="zcaddcnt zcrtdrpd dIB floatl"><div id="bots-groupsuggest"><div id="bots-groupsuggest-selnodes" class="mrgT15 dN">'+Resource.getRealValue("bots.groups.existing")+' : </div><div id="bots-groupsuggest-search-field" contenteditable="true" placeholder="'+Resource.getRealValue("channel.team.placeholder")+'" class="crtin mrgT25" placeholder="'+Resource.getRealValue("smartsearch.search.groups")+'"></div><div id="bots-groupsuggest-results" class="chdropdwn" style="display:none"></div></div></div></div>'),SearchField.init("bots-groupsuggest")),e.find("#botphoto").on("change",function(){var e=$(this),t=e.siblings("#botdefimg"),i=$(this).siblings("[type='imgpreview']"),a=this.files[0],s=2;if("undefined"!=typeof a){if(!$Util.isValidImage(e,this.files,s))return;t.hide(),$Util.imgPrview(i,a)}}),e.find("#botscoperadio").on("change","[type='radio']",function(){$("#botscope-info").html(Resource.getRealValue("integration.scope.info"+this.value)),this.value==BotConstants.TEAMSCOPE?$("#botscopes-group").show():$("#botscopes-group").hide()})},validateAndGetParams:function(e,t){var i=$("#botname").val();if(i=$.trim(i),$WC.$CUtil.isEmpty(i)||i.length>20)return $("#botname").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#botname-header"),e,200);var a=parseInt($("#botscoperadio").find("input:checked").val());if("undefined"!=typeof t&&t.scope<a)return UI.updateBanner(Resource.getRealValue("bots.scope.error"),2e3,!0),void $Util.scrollToViewportTop($("#botscoperadio"),e,200);var s=$("#botdesc").val();if(s=$.trim(s),$WC.$CUtil.isEmpty(s))return $("#botdesc").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop($("#botdesc-header"),e,200);var n=SearchField.getSelectedList("bots-groupsuggest-search-field");if(n=n.concat(SearchField.getSelectedList("bots-groupsuggest-selnodes")),a===BotConstants.TEAMSCOPE&&0===n.length)return $("#bots-groupsuggest-search-field").addClass("error"),void $Util.scrollToViewportTop($("#addcommandscope"),e,200);n=JSON.stringify(n);var r=this.validateAndGetStatus(),o=r.statusmsg;if(r.invalidOptionsPresent)return void $Util.scrollToViewportTop($("#botstatuscont"),e,200);"undefined"!=typeof t&&(i=t.name!=i?i:void 0,s=t.desc!=s?s:void 0,a=t.scope!=a||a===CommandConstants.TEAMSCOPE?a:void 0,o=JSON.stringify(t.statusmsg)!==o?$WC.$CUtil.isEmpty(o)?"[]":o:void 0,n=a===BotConstants.TEAMSCOPE&&JSON.stringify(t.teamids)!==n?n:void 0);var l=$("#botphoto").siblings("[type='imgpreview']").find("img").attr("src");l=!$WC.$CUtil.isEmpty(l)&&l.startsWith("data:")?l:void 0;var c={name:i,scope:a,description:s,statusmsg:o,teamids:n,image:l};return $Util.checkAndRemoveUndefinedKeys(c)},validateAndGetStatus:function(){for(var e=$("#botstatuscont"),t=e.children("[botstatus]"),i=[],a=!1,s=0;s<t.length;s++){var n=$(t[s]).val();if(n=$.trim(n),!$WC.$CUtil.isEmpty(n)){if(n.length>50||!$WC.Matcher.check("textpattern",n)){a=!0,$(t[s]).addClass("zcfdk_tmbzoom");break}i.push(n)}}return i=$Util.removeDuplicateEntries(i),{isValid:!a,statusmsg:!a&&i.length>0?JSON.stringify(i):void 0}},getHTML:function(e,t,i,a){var s=Bots.getObject(e);return this.getHTMLByObj(s,t,i,a)},getHTMLByObj:function(e,t,i,a){var s=e.id;t="undefined"!=typeof t?t:this.listviewhtml;var n=$WC.$CUtil.processXSS(e.name),r=parseInt(e.usercount)>0?parseInt(e.usercount):Contacts.isBot(s)?1:0;if("undefined"!=typeof i){var o=(n.toLowerCase().indexOf(i),new RegExp($WC.Matcher.replace("escaperegexp",i),"i"));n=n.replace(o,"<b>$&</b>")}t=t.replace(/{NAME}/g,$Util.escapeReplacementString(n)).replace(/{BOTID}/g,s).replace(/{CHID}/g,Contacts.isBot(s)?Contacts.get(s).chid:null).replace(/{DESC}/,$Util.xssAndEscapeReplacementString(e.desc)).replace(/{IMGURL}/,Bots.getImgUrl(s)).replace(/{UNIQUENAME}/g,e.uniquename).replace(/{UCOUNT}/g,'<div class="dIB" title="'+r+" "+Resource.getRealValue(r>1?"bot.users.subscribed":"bot.user.subscribed")+'"><span class="msi-guest"></span><span class="clr6 mrgR10">'+r+"</span></div>").replace(/{EDITOPTIONS}/,Bots.isCreatedByMe(s)&&SecurityManager.hasPermission(Modules.Bots,MActions.Edit)?'<div botbuttons="" purpose="editBotHandlers" class="mrgL10 zcclr cur dIB"><span class="msi-editicn zcclr">&nbsp;&nbsp;</span>'+Resource.getRealValue("bots.handlers.edit")+"</div>":"").replace(/{PHOTO}/,'<img height="48px" width="48px" src="'+Bots.getImgUrl(s)+'" class="'+(Bots.hasDeletePermission(s)?"zccmdimgcr":"")+'">'),t=Bots.isFromIntegration(s)?t.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>"+(e.scope==BotConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):Bots.isFromSandBox(s)?t.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(e.appdetails.name)+'</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span> ("+Resource.getRealValue("app.sandbox")+")</span>"+(e.scope==BotConstants.ORGSCOPE?'<span class="clr6"> '+Resource.getRealValue("app.installed.org")+"</span>":"")):a?t.replace(/{CREATOR}/,""):t.replace(/{CREATOR}/,'<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="'+e.creator+'" class="zctxthgh cur">'+$Util.escapeReplacementString(Users.getName(""+e.creator,e.creator_name))+"</span>");var l=Bots.isTeamScoped(s)?"&nbsp;"+Resource.getRealValue("channel.created.for")+'&nbsp;<span class="clr5 bold">'+$Util.xssAndEscapeReplacementString(Groups.getGroupNames(e.teamids,e.team_names))+"</span>":"";t=t.replace(/{TEAMNAME}/g,l);var c=Bots.hasDeletePermission(s)?'<div botbuttons purpose="delete" title="Delete" class="msi-cmddel posa"></div>':"";t=t.replace(/{DELETEBUTTON}/,c),t=t.replace(/{SELECTBUTTON}/g,'<div appbuttons purpose="selectbot" title="Select" class="msi-tick posa"></div>');var d=Contacts.isBot(s)?'<span botbuttons purpose="unSubscribe" class="zcbotunsubbtn">'+Resource.getRealValue("bots.unsubscribe")+"</span>":'<span botbuttons purpose="subscribe" class="zcbotsubbtn">'+Resource.getRealValue("bots.subscribe")+"</span>";return t=t.replace(/{SUBSCRIPTIONBUTTON}/,d),t=t.replace(/{SANDBOXTEXT}/g,Bots.isFromSandBox(s)?'<span class="clr6"> ('+Resource.getRealValue("app.sandbox")+")</span>":"")},populate:function(e){if(IntegrationUI.listView.isCurrent(Integration.Modules.Bots,e)){var t=Bots.getBotsCount();if(IntegrationUI.listView.initialize(Integration.Modules.Bots,t,SecurityManager.hasPermission(Modules.Bots,MActions.Create)),0==t)return;var i;("undefined"==typeof e||e.which!==$zcg.ESCAPE_KEYCODE)&&(i=$("#botsearch").val());var a;$WC.$CUtil.isEmpty(i)?a=Bots.getAll(!0):(i=i.trim().toLowerCase(),a=Bots.search({val:i,getashtml:!1,limit:20}).searchedlist);for(var s="",n="",r="",o="",l=0;l<a.length;l++){var c=a[l],d=this.getHTML(c,BotsUI.listviewhtml,i);Bots.isCreatedByMe(c)?n+=d:Contacts.isBot(c)?r+=d:o+=d}$WC.$CUtil.isEmpty(n)||(s+='<div id="mybotsheader" zc_running_title class="zcinhds font16 bold paddT10 floatl posl">'+Resource.getRealValue("bots.mine")+'</div><div id="mybots" class="zcinchls">'+n+"</div>"),$WC.$CUtil.isEmpty(r)||(s+='<div id="subscribedbotsheader" zc_running_title class="zcinhds font16 bold paddT10 floatl posl">'+Resource.getRealValue("bots.subscribed")+'</div><div id="subscribedbots" class="zcinchls">'+r+"</div>"),$WC.$CUtil.isEmpty(o)||(s+='<div id="allbotsheader" zc_running_title class="zcinhds font16 bold mrgT20 paddT10 floatl posl">'+Resource.getRealValue("bots.org")+'</div><div id="allbots" class="zcinchls">'+o+"</div>"),IntegrationUI.listView.populate(Integration.Modules.Bots,"botslist",s,i,SecurityManager.hasPermission(Modules.Bots,MActions.Create))}},groupsuggestion:{search:function(e){var t=$("#bots-groupsuggest-results");t.html('<div id="bots-groupsuggest-list"  class="drpdwn srchglt"></div>');var i=SearchField.getSelectedList("bots-groupsuggest-search-field");if(i=i.concat(SearchField.getSelectedList("bots-groupsuggest-selnodes")),i.length>=4)return void UI.updateBanner(Resource.getRealValue("channel.sel.group.limit"),3e3,!0);var a=SearchAgent.search({searchin:SearchAgent.ORGGROUPS,val:e,ignorelist:i,listid:"bots-groupsuggest-list"});if(a){t.find("[purpose='search']").first().addClass("srchbn sel");var s="block"===t.css("display");s||Clickoutside.bind({srcid:"bots-groupsuggest-search-field",destid:"bots-groupsuggest-results"}),ZCScroll.scrollTop($("#bots-groupsuggest-results"),0)}else this.clear(),t.empty().hide()},handleAction:function(e,t,i){if(i){var a=SearchField.getNodeforSelection({uid:t.attr("uid"),type:t.attr("elemtype"),name:Groups.getDisplayName(t.attr("uid"))},!0);SearchField.insertNodeinField("bots-groupsuggest",void 0,a),Clickoutside.handleClickOnChild(e)}},clear:function(){$("#bots-groupsuggest-results").hide().find("#bots-groupsuggest-list").empty(),Clickoutside.clear("bots-groupsuggest-results")}},showLoading:function(e){IntegrationsCwin.showLoading(e)},reset:function(){IntegrationsCwin.close()},getPermalinkHTML:function(e){var t='<div class="dflxjustcent w100 h100 flx-dirC perma-botlink"><div class="dflxcent"><img class="perma-botimg mrgR35" src="{{img_src}}"><div><div class="font22 bold mrgB5 clr14">@{{name}}</div><div class="font16 clr6 mrgB20">{{status}}</div>{{extension_details}}<div class="font15 clr14 mrgB10 dflxcent"><em class="perma-boticns msi-sc1"></em><span class="mrgL10">{{access_scope}}</span></div><div class="font15 clr14 mrgB10 dflxcent"><em class="perma-boticns msi-sp1"></em><span class="mrgL10">{{user_count}}</span></div></div></div><div class="perma-botdashed"></div><div class="mrgT20"><div class="font14 clr6 mrgB10">{{desc}}:</div><p class="font16 clr14">{{description}}</p></div>{{creator_html}}<div class="perma-botfooter dflxcent">{{footer_html}}</div></div>',i={$by:"common.by",$desc:"common.desc",$creator:"channel.role.2",$subscribe:"bots.subscribe",$subscription_text:"bots.permalink.subscribed",$user_count:["bots.permalink.subscribers",e.usercount],bot_id:e.id,name:e.name,description:e.desc},a="bots.permalink.scope"+e.scope;if(e.scope===BotConstants.TEAMSCOPE){var s=Groups.getGroupNames(e.teamids,e.team_names);a=[a,s]}i.$access_scope=a;var n="bots.subscribe",r='<div botbuttons purpose="subscribe" botid="{{bot_id}}" class="dbtn perma-subbtn cur">{{button_text}}</div>';e.subscribed&&(i.chid=e.chid,r='<a class="font17">{{subscription_text}}</a><div botbuttons purpose="startChat" chid="{{chid}}" class="dbtn perma-subcnt cur">{{button_text}}</div>',n="common.continue");var o="",l="";if("undefined"!=typeof e.appid){o='<div class="font15 clr6 mrgB10 dflxcent"><em class="perma-boticns msi-integ"></em><span class="mrgL10">{{extension_text}}</span></div>';var c="";e.appdetails.issandbox&&(c=" ("+Resource.getRealValue("app.sandbox")+")"),i.$extension_text=["bots.permalink.extension",[e.appdetails.name,c]]}else l='<div class="mrgT25"><div class="font14 clr6 mrgB10">{{creator}}:</div><p class="font16 clr6">{{by}}&nbsp;<span class="clr14">{{creator_name}}</span>,&nbsp;<span>{{created_time}}</span></p></div>';if(i.$button_text=n,e.statusmsg&&e.statusmsg.length>0){var d=Math.round(Math.random()*(e.statusmsg.length-1));i.status=e.statusmsg[d]}else i.$status="chatbot.smsg";var u={creator_html:l,footer_html:r,extension_details:o};return t=$WC.template.replace(t,u,"InSecureHTML"),t=$WC.template.replace(t,{creator_name:Users.getName(""+e.creator,e.creator_name),created_time:$Date.relative(e.ctime),img_src:Bots.getImgUrlById(e.photoid)},"InSecureHTML"),$WC.template.replace(t,i)},constructPermalinkUI:function(e){$WC.$Win.create({id:"botpermalinkwin","class":"joinchnlwin fullwin mntnoverlay",html:BotsUI.getPermalinkHTML(e),aligncenter:!1,closefn:function(){window.history.pushState({},null,window.location.origin+"/index.do"),$("#zcwindows").removeClass("permadiv")}});$("#zcwindows").addClass("permadiv"),$("#loadingniceurl").remove()},handlePermaLink:function(e,t){var i={};"undefined"!=typeof t&&(i.store_app_id=t),$ZCAjx.ajax({url:"/v1/bots/"+e,data:i,ignorableerrorcodes:[4007],success:function(e){$("#loadingniceurl").find('[class="pgloader"]').addClass("loaded"),$WC.$CUtil.isEmptyObject(e.data)||BotsUI.constructPermalinkUI(e.data)},error:function(){$("#loadingniceurl").remove(),window.history.pushState({},null,window.location.origin+"/index.do"),$("body").removeClass("chnlpermalink")}})}},Bots={init:function(){BotsUI.bindEvents()},initSyncTime:function(){this.SyncTime=-1},getAll:function(e){var t=$DB.get("bots").list||{};if(e){var i=[];for(var a in t){var s=[];s.push(a),s.push(this.getObject(a).name),i.push(s)}i=$Util.sortString(i,1,!1);for(var n=[],r=0;r<i.length;r++)n.push(i[r][0]);return n}return t},getAppBotIds:function(e){var t=this.getAll(),i=[];for(var a in t){var s=t[a];s.appid==e&&i.push(a)}return i},isExist:function(e){return this.getAll().hasOwnProperty(e)},isCreatedByMe:function(e){var t=this.getObject(e);return $WC.$CUtil.isEmpty(t)?void 0:$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator):t.appdetails.issandbox&&WmsImpl.isLocalUser(""+t.appdetails.developer)},hasDeletePermission:function(e){var t=this.getObject(e);if(!$WC.$CUtil.isEmpty(t)&&$WC.$CUtil.isEmpty(t.appid)){if(SecurityManager.hasPermission(Modules.Bots,MActions.Delete))return WmsImpl.isLocalUser(""+t.creator)||_isAppAccountAdmin();if(WmsImpl.isLocalUser(""+t.creator)&&t.scope==BotConstants.PRIVATESCOPE)return!0}return!1},isFromIntegration:function(e){if(this.isExist(e)){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&!t.appdetails.issandbox}return!1},isFromSandBox:function(e){if(this.isExist(e)){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&t.appdetails.issandbox}return!1},isOrgScoped:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&t.scope===BotConstants.ORGSCOPE},isTeamScoped:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&t.scope===BotConstants.TEAMSCOPE},getBotsCount:function(){return Object.keys(Bots.getAll()).length},getObject:function(e){return this.isExist(e)?$DB.get("bots").list[e]:void 0},getIconImgUrl:function(){return $zcg._IMGDEFAULTSTATICURL+"/bot-icon.png"},getDefaultImgUrl:function(){return $zcg._IMGDEFAULTSTATICURL+"/bot-default.png"},getImgUrl:function(e){var t=this.getObject(e);return $WC.$CUtil.isEmpty(t)||$WC.$CUtil.isEmpty(t.photoid)?this.getDefaultImgUrl():"/botimg/"+t.photoid+"/photo.do"},getImgUrlById:function(e){return $WC.$CUtil.isEmpty(e)?this.getDefaultImgUrl():"/botimg/"+e+"/photo.do"},getActionHandles:function(e){var t=this.getObject(e);return t.actionhandles},deleteInObj:function(e){delete $DB.get("bots").list[e]},deleteAppEntities:function(e){for(var t=this.getAppBotIds(e),i=0;i<t.length;i++)this.deleteInObj(t[i])},store:function(e,t){$WC.$CUtil.isEmpty(t)||parseInt(t.updatetype)!==BotConstants.LIST_CHANGED||$DB.clear("bots");for(var i=$DB.get("bots"),a=i.list||{},s=function(e,t){for(var i in t)e[i]=t[i];return e},n=e.bots,r=0,o=n.length;o>r;r++){var l=n[r],c=l.id;a[c]=a[c]||{},a[c]=s(a[c],l)}i.list=a,i.listchecksum=$WC.$CUtil.isEmpty(t)?-1:t.listchecksum,i.detailschecksum=$WC.$CUtil.isEmpty(t)?-1:t.detailschecksum,$DB.update("bots",i)},storeSingleBot:function(e){var t=$DB.get("bots"),i=t.list||{},a=function(e,t){for(var i in t)e[i]=t[i];return e},s=e.id;i[s]=i[s]||{},i[s]=a(i[s],e),t.list=i,$DB.update("bots",t)},get:function(e){if(SecurityManager.hasPermission(Modules.Bots)){var t=$DB.get("bots")||{};$WC.$CUtil.isEmpty(t.listchecksum)&&(t.listchecksum=-1,t.detailschecksum=-1,$DB.update("bots",t));var i={listchecksum:t.listchecksum,detailschecksum:t.detailschecksum};$ZCAjx.ajax({url:"/v1/bots",type:"GET",data:i,success:function(t){$WC.$CUtil.isEmpty(t.meta)||(parseInt(t.meta.updatetype)===CommandConstants.LIST_CHANGED?Bots.store(t.data,t.meta):parseInt(t.meta.updatetype)===CommandConstants.DETAILS_CHANGED&&Bots.getSpecifiedBots(t.data.bots)),BotsUI.populate(),"function"==typeof e&&e()}})}},getSpecifiedBots:function(e){var t=$DB.get("bots"),i=[];for(var a in t.list)e[a]!=t.list[a].detailschecksum&&i.push(a);i.length>0&&$ZCAjx.ajax({url:"/v1/bots",data:{botids:i.join(",")},success:function(e){Bots.store(e.data),BotsUI.populate()}})},getOrgBot:function(e,t){$ZCAjx.ajax({url:"/v1/bots/"+e,success:function(e){"undefined"!=typeof e.data.bots&&Bots.storeSingleBot(e.data.bots[0]),"function"==typeof t&&t()}})},create:function(e,t){$ZCAjx.ajax({url:"/v1/bots",type:"POST",data:e,contentType:"application/json",status:{loading:$("#IntegrationsRHS").find('[botbuttons][purpose="createOrEdit"]'),success:"bot.added"},success:function(e){Bots.store(e.data),"function"==typeof t&&t(e.data.bots[0].id)}})},edit:function(e,t){$ZCAjx.ajax({url:"/v1/bots/"+e,type:"PUT",data:t,contentType:"application/json",status:{loading:$("#IntegrationsRHS").find('[botbuttons][purpose="createOrEdit"]'),success:"bot.edited"},success:function(t){Bots.store(t.data);var i=MyBots.getChid(e);ChatUI.isExist(i)&&ChatUI.exist[i].updateWinHeader()}})},"delete":function(e){$ZCAjx.ajax({url:"/v1/bots/"+e,type:"DELETE",success:function(e){var t=e.data.id;Contacts.deleteInObject(t),Bots.deleteInObj(t);var i=$("#"+t);i.slideUp(300,function(){if(0===i.siblings().length){var e=i.parent()[0].id;$("#"+e).remove(),$("#"+e+"header").remove(),IntegrationUI.listView.populateEmptyResult(Integration.Modules.Bots,"botslist")}$(this).remove(),ZCScroll.resetScroll($("#botslist"),!0)})}})},search:function(e){var t={html:BotsUI.searchhtml,getashtml:!0,limit:10,ignorelist:[]};e=$.extend(t,e),e.val=e.val.toLowerCase();var i=this.getSearchedList(e);return e.addrsltstoignorelist&&(e.ignorelist=e.ignorelist.concat(i.searchedlist)),clearTimeout(this.botsreqtimer),this.botsreqtimer=setTimeout(function(){-1===Bots.SyncTime&&Bots.get(function(){Bots.SyncTime=0;var t=e.getashtml?Bots.getSearchedList(e).content:Bots.getSearchedList(e);e.successcallback(t,e.listid,e.populateid,!1,e.val)})},500),i},getSearchedList:function(e){var t="",i=[],a=0,s=$Util.cloneObject(Bots.getAll()),n=MyBots.chidVsBotId[ChatBot.getChid()];if(e.includechatbot&&n){var r=Contacts.get(n),o={name:r.dname,desc:Resource.getRealValue(r.desc),id:r.zuid,usercount:r.uc,creator:"",creator_name:""};s[n]=$.extend(r,o)}for(var l in s){var c=l;if(-1===e.ignorelist.indexOf(c)&&(!e.issubscribedonly||Contacts.isExist(c))){if(a===e.limit)break;var d=s[c],u=d.name.toLowerCase().indexOf(e.val);("*"===e.val||-1!=u)&&(e.getashtml&&(t+=BotsUI.getHTMLByObj(d,e.html,e.val,e.nocreatorinfo)),i.push(c),a++)}}return{content:t,searchedlist:i}},subscribe:function(e,t,i){$ZCAjx.ajax({url:"/v1/bots/"+e+"/subscribe",type:"POST",data:{consent_validation:!0},status:{loading:"common.loading"},success:function(t){if("Consent"===t.data.status){var a=t.data;return void IntegrationsResponse.showPromptAndDebugMessages({},a)}Bots.store(t.data);var s=$("#"+t.data.bots[0].id);s.length>0&&s.slideUp(300,function(){if(0===s.siblings().length){var e=s.parent()[0].id;$("#"+e).remove(),$("#"+e+"header").remove()}BotsUI.populate(),ZCScroll.resetScroll($("#botslist"),!0)}),UI.updateBanner(Resource.getRealValue("bot.subscribed",[t.data.bots[0].name]),3e3,!1),"function"==typeof i&&i(e);var n=MyBots.getChid(e);if(MyBots.join(n),t.data.dreResponse){var r=Contacts.getBot(e);IntegrationsResponse.showOAuthPrompt(r.dname,t.data.dreResponse)}}})},unSubscribe:function(e){var t=MyBots.getChid(e);IntegrationsCwin.isCurrent(t)&&IntegrationUI.select(Integration.Modules.Bots),$ZCAjx.ajax({url:"/v1/bots/"+e+"/unsubscribe",type:"POST",status:{loading:"common.loading"},success:function(e){HoverDetails.hide();var t=e.data.id;Bots.decUserCount(t),Contacts.deleteInObject(t);var i=$("#"+t);i.length>0&&(UI.updateBanner(Resource.getRealValue("bot.unsubscribed",[Bots.getObject(t).name]),3e3,!1),i.slideUp(300,function(){if(0===i.siblings().length){var e=i.parent()[0].id;$("#"+e).remove(),$("#"+e+"header").remove()}BotsUI.populate(),ZCScroll.resetScroll($("#botslist"),!0)}))}})},decUserCount:function(e){var t=Bots.getObject(e);if("undefined"!=typeof t){var i={bots:[{id:e,usercount:Bots.getObject(e).usercount-1}]};Bots.store(i)}},getActions:function(e){var t=Contacts.getBot(e);($WC.$CUtil.isEmpty(t)||"undefined"==typeof t.actionhandles)&&(Contacts.updateBotActions(e,[]),$ZCAjx.ajax({url:"/v1/bots/"+e+"/getactions",success:function(t){Contacts.updateBotActions(e,t.data.actions);var i=MyBots.getChid(e);ChatUI.isExist(i)&&Composer.updateHelpTip(i,"msg","")},error:function(){Contacts.updateBotActions(e,void 0)}}))},executeAction:function(e,t){var i=MyBots.getChid(e);IntegrationsCwin.showLoading(i);var a=ChatUI.exist[i];a.focus(),$ZCAjx.ajax({url:"/v1/bots/"+e+"/executeaction",type:"POST",contentType:"application/json",sendSID:!0,trialExecutionChid:i,data:{exec_id:t},success:function(t){IntegrationsResponse.populateOutput({module:Integration.Components.Bot,id:e,name:Users.getName(e),imageUrl:Users.getImgUrlById(e)},t.data.dreResponse,i)},error:function(){$("#"+i).find("#loadingline").remove()}})}},MyBots={chidVsBotId:{},isBotChid:function(e){if(!$WC.$CUtil.isEmpty(e)){var t=new $CliqChatId(e);return t.isCustomBot()}return!1},getNameByChid:function(e){var t=this.getBotId(e);return Users.getName(t)},getImgByChid:function(e){var t=this.getBotId(e);return this.getImgById(t)},getImgById:function(e){return Contacts.isExist(e)?ChatBot.isBot(this.getChid(e))?ChatBot.getImgUrl():Bots.getImgUrlById(Contacts.get(e).photo):Bots.getDefaultImgUrl()},getChid:function(e){var t=Contacts.getBot(e);return $WC.$CUtil.isEmpty(t)?void 0:t.chid},getId:function(e){return e.startsWith("b-")&&(e=e.substring(2)),e},getBotId:function(e){return this.chidVsBotId[e]},getObject:function(e){return this.getAll()[e]},handleDelete:function(e){var t=this.getChid(e);Chat.quit(t,"pinnedchats"===ChatsList.getCatagory(t),!0)},needsLocation:function(e,t){var i=new $CliqChatId(e);if(i.isCustomBot()){var a=this.chidVsBotId[e];if(this.needsLocationForMessage(a))return!0}if("undefined"!=typeof t&&t.length>0)for(var s=0;s<t.length;s++){var n=t[s];if(this.needsLocationForMention(n))return!0}},needsLocationForMessage:function(e){var t=Contacts.getBot(e);return!$WC.$CUtil.isEmpty(t)&&t.permission?(1&t.permission)>0:!1},needsLocationForMention:function(e){var t=Contacts.getBot(e);return!$WC.$CUtil.isEmpty(t)&&t.permission?(2&t.permission)>0:!1},getActionsHtml:function(e){var t=this.getBotId(e),i='<div purpose="copyPermalink" botid="{{bot_id}}" botbuttons class="zcf-link">{{permalink}}</div><div purpose="unSubscribe" botid="{{bot_id}}" botbuttons class="zcf-unsub">{{unsubscribe}}</div>';return $WC.template.replace(i,{bot_id:t,$unsubscribe:"bots.unsubscribe",$permalink:"bots.permalink.title"})},populateActions:function(e){function t(){for(var e=o.children(),t=0,i=0;i<e.length;i++)t+=$(e[i]).outerWidth(!0);return t<=o.width()}if("undefined"!=typeof e){var i=new $CliqChatId(e);if(i.isCustomBot()){var a=this.getBotId(e);if("undefined"==typeof a)return!1;var s=Contacts.getBot(a);if($WC.$CUtil.isEmpty(s)||"undefined"==typeof s.actionhandles)$("#"+e).find("#helptip").html('<span class="hst-loadng"></span>'),Bots.getActions(a);else{var n=s.actionhandles.length;if(0===n)return!1;var r='<div purpose="executeAction" botid="{{bot_id}}" botbuttons exec_id="{{be_id}}" class="mrgR10 cur"><span class="msi-wand clr{{color_code}} mrgR5"></span><span class="clr6 ellips">{{name}}</span></div>',o=$('<div bot_actions_container class="dflxjustcent botmenuactns mrgat"></div>');$("#"+e).find("#helptip").html(o);for(var l=0;n>l;l++){var c=s.actionhandles[l],d=$WC.template.replace(r,{bot_id:a,be_id:c.id,name:c.display_props.name,color_code:l}),u=$(d),m=o.find("[bot_sub_actions_container]");if(m.length>0?u.insertBefore(m):o.append(u),!t()){if(0==m.length){var p='<div id="bot_sub_actions_container{{chid}}" chid="{{chid}}" botbuttons purpose="showMoreActions" bot_sub_actions_container class="posl mrgL5 botmenuactns-more"><span class="msi-optmore cur"></span><div id="bot_sub_actions{{chid}}" bot_sub_actions class="chtpopup"></div><div>';o.append($WC.template.replace(p,{chid:e})),m=o.find("[bot_sub_actions_container]")}o.find("[bot_sub_actions]").append(u)}}o.find('[purpose="executeAction"]').addClass("ellips")}return!0}}},join:function(e){$WC.$CUtil.isEmpty(e)||ChatUI.isExist(e)||ChatsList.attachContinueActiveChat(e)},handleBotOpr:function(e){if("add"===e.operation){var t={},i=e.data.id;t[i]=e.data,Contacts.storeBotsAsContacts(t);var a=MyBots.getChid(i);ChatUI.isExist(a)&&ChatUI.exist[a].updateWinHeader()}else if("remove"===e.operation){var i=e.data.id,a=MyBots.getChid(i);Contacts.deleteInObject(i),ChatUI.isExist(a)&&(ChatsList.delete(a),ChatUI.removeWindow(a))}BotContactsList.populateBotContacts()}},BotExecutorsUI={handle:{addMoreAction:function(e){var t=$("#addbotmenu");if(t.find("[actionmenu]").length<5){var i=$.parseHTML(BotsUI.getMenuHtml(void 0,!0));$(e).before(i),$(i).slideDown(200).find("input").focus(),t.find("[actionmenu]").length>=5&&$(e).remove()}},validateActionHandler:function(e,t,i){var a=$.trim(e.val()),s=e.parents("[bothandler]"),n=s.attr("exec_id");if(!$WC.$CUtil.isEmpty(n)){var r=BotExecutors.get(i,n),o=s.find('[purpose="saveActionHandler"]');$WC.$CUtil.isEmpty(r)||r.display_props.name==a?o.hide():o.show()}},saveActionHandler:function(e,t,i){e=$(e).siblings("input");var a=$.trim(e.val()),s=e.parents("[bothandler]"),n=s.attr("exec_id");if(!$WC.$CUtil.isEmpty(n)){var r=BotExecutors.get(i,n);if(!$WC.$CUtil.isEmpty(r)&&r.display_props.name!=a){var o={botid:i,name:a};BotExecutors.edit(r.type,o,function(){BotExecutorsUI.handle.actionSavedMode(e),UI.updateBanner(Resource.getRealValue("executor.saved",a)),s.find('[purpose="saveActionHandler"]').hide()})}}},createActionHandler:function(e,t,i){var a=$.trim($(e).siblings("input").val());if(a.length>0){var s={botid:i,name:a,type:BotConstants.ACTIONHANDLER};BotExecutors.create(s,function(e,t,i){var s=Bots.getObject(e);s.module=Integration.Modules.Bots,s.beId=t,s.actionName=a,DREImpl.handleEditCode(s,e,i)})}},actionSavedMode:function(e){e.removeClass("zcbtinet").addClass("zcbtnn"),e.siblings("#line").addClass("zcbotundlinhid")},actionEditMode:function(e){e.addClass("zcbtinet").removeClass("zcbtnn"),e.siblings("#line").removeClass("zcbotundlinhid")},addHandler:function(e,t,i){var a=$(e).parents("[bothandler]"),s=a.attr("type"),n={botid:i,name:s,type:s};BotExecutors.create(n,function(e,t,i){var a=Bots.getObject(e);a.module=Integration.Modules.Bots,a.beId=t,DREImpl.handleEditCode(a,e,i)})},editHandler:function(e,t,i){var a=$(e).parents("[bothandler]"),s=a.attr("type"),n=a.attr("exec_id"),r=Bots.getObject(i);r.module=Integration.Modules.Bots,r.beId=n,delete r.actionName,BotExecutors.isActionHandler(parseInt(s))&&(r.actionName=a.attr("actionname")),DREImpl.handleEditCode(r,i,s)},deleteHandler:function(e,t,i){var a=$(e).parents("[bothandler]"),s=a.attr("type"),n=Bots.getObject(i).name,r=IntegrationsUtil.getHandlerName(s,i);$WC.$Dlg.confirm({id:"deletehandler",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("executor.delete.confirm.info",[r])]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-boticon"></div>',header:Resource.getRealValue("executor.delete.confirm",[$WC.$CUtil.processXSS(n),r])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){BotExecutors.delete(a,i,function(){BotConstants.isActionType(s)&&UI.updateBanner(Resource.getRealValue("executor.deleted",r)),BotExecutorsUI.handleDelete(e,i)})}}]})}},handleDelete:function(e){e=$(e);var t=e.parents("[exec_id]"),i=parseInt(t.attr("type"));if(BotExecutors.isMessageHandler(i)){var a='<span execbuttons purpose="addHandler" class="zcclr cur">'+Resource.getRealValue("commands.editcode")+"</span>";e.parent().fadeOut(100,function(){e.siblings("[execbuttons]").remove(),e.replaceWith(a),$(this).fadeIn(100)})}else t.slideUp(200,function(){$(this).remove(),BotExecutors.isActionHandler(i)&&0===$('[purpose="addMoreAction"]').length&&$("#addbotmenu").find("[actionmenu]").length<5&&$("#addbotmenu").append('<div execbuttons purpose="addMoreAction" class="dIB mrgT20 zcclr cur">'+Resource.getRealValue("bots.addmenu")+"</div>")})}},BotExecutors={isActionHandler:function(e){return e>=101&&105>=e},isMessageHandler:function(e){return e>=0&&99>=e},getHandlerType:function(e){return this.isActionHandler(e)?"actionhandles":this.isMessageHandler(e)?"messagehandles":void 0},getAll:function(e){var t=Bots.getObject(e),i=[];return $WC.$CUtil.isEmpty(t.actionhandles)||(i=i.concat(t.actionhandles)),$WC.$CUtil.isEmpty(t.messagehandles)||(i=i.concat(t.messagehandles)),i},get:function(e,t){for(var i=this.getAll(e),a=0;a<i.length;a++){var s=i[a];if(s.id==t)return s}},getByType:function(e,t){for(var i,a=this.getAll(e),s=0;s<a.length;s++)if(i=a[s],i.type==t)return i},store:function(e,t,i){var a=this.getHandlerType(parseInt(t.type)),s=$DB.get("bots"),n=s.list[e][a];if("add"==i)$WC.$CUtil.isEmpty(n)?s.list[e][a]=[t]:n.push(t);else if("edit"==i){for(var r=0;r<n.length;r++)if(n[r].id===t.id){n[r]=t;break}}else if("delete"==i)for(var r=0;r<n.length;r++)if(n[r].id===t.id){n.splice(r,1),0==n.length&&delete s.list[e][a];break}$DB.update("bots",s),BotExecutors.isActionHandler(parseInt(t.type))&&Contacts.updateBotActions(e,Bots.getActionHandles(e))},create:function(e,t){var i=e.botid;delete e.botid,e.componentid=MyBots.getId(i),Executions.create(e,function(e){var a=e.data;if(BotExecutors.store(i,a,"add"),"function"==typeof t&&t(i,a.id,a.type),BotExecutors.isActionHandler(a.type)){var s=MyBots.getChid(i);ChatUI.isExist(s)&&MyBots.populateActions(s)}})},edit:function(e,t,i){var a=t.botid;delete t.botid,t.componentid=MyBots.getId(a),Executions.edit(e,t,function(e){if(BotExecutors.store(a,e,"edit"),BotExecutors.isActionHandler(e.type)){var t=MyBots.getChid(a);ChatUI.isExist(t)&&MyBots.populateActions(t)}"function"==typeof i&&i(a,e.id)})},"delete":function(e,t,i){Executions.delete(MyBots.getId(t),e.attr("type"),function(){var a={id:e.attr("exec_id"),type:e.attr("type")};if(BotExecutors.store(t,a,"delete"),"function"==typeof i&&i(),BotExecutors.isActionHandler(a.type)){var s=MyBots.getChid(t);ChatUI.isExist(s)&&MyBots.populateActions(s)}})}},BotSuggestions={handleClick:function(e){var t=$(e).parents('[purpose="chatview"]').attr("id");if($WC.$CUtil.isEmpty(t))return void UI.updateBanner(Resource.getRealValue("bots.suggestions.exec.error"),5e3,!0);var i=e.getAttribute("text");this.remove(t,function(){var e=$Util.getSyncedCurrentTime(),a=ChatUI.exist[t],s={msg:i,sender:WmsImpl.getZuid(),time:e,msgid:e,chid:t};a.updateMsg(s,{isundelivered:!0}),a.focus(),Chat.sendMessage(t,i,e)})},checkAndRemove:function(e){var t=$("#"+e),i=t.find("[botsuggestions]"),a=i.parents("[msgtime][chid]")[0],s=t.find("#msgarea")[0].lastChild;a!=s&&this.remove(e)},remove:function(e,t){var i=$("#"+e).find("[botsuggestions]");i.slideUp(50,function(){i.remove(),ZCScroll.updateScroll($("#"+e).find("#chatbody")),"function"==typeof t&&t()})}};var FunctionsUI={},Functions={},FunctionsUI={currentsearchval:"",function_tobecreated:{},appViewHTML:'<div appbuttons purpose="toggleSelection" functionid="{{FUNCTIONID}}" class="cur zcappintl zctext"><div class="zchlistimg mrgT3 floatl"><div title="Select" class="msi-hissel posa"></div><div class="{{CLASS_NAME}}"></div></div><div class="dIB w70 mrgT5 mrgL10"><div title="{{NAME}}" class="ellips">{{NAME}}{{SANDBOXTEXT}}</div><div class="ellips mrgT5 clr8">{{DESC}}</div></div></div>',listViewHTML:'<div id="{{FUNCTIONID}}" functionbuttons functionid="{{FUNCTIONID}}" purpose="preview" class="indivcom cur"><div class="zchlistimg mrgR10 floatl">{{DELETEHTML}}<div class="{{CLASS_NAME}}"></div></div><div class="dIB mrgL10 w70"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips">{{NAME}} &nbsp;</div><div class="dIB">{{CREATORHTML}}</div>{{EDITCODE}}</div></div>{{DESCHTML}}<div class="zchnsrclft mrgT5"><div class="zchlsrctit zcfxtme dIB clr6"><span title="'+Resource.getRealValue("function.lastexecuted")+'" class="msi-history"></span>{{TIME}}</div></div></div></div>',getHTML:function(e,t){var i,a,s=Functions.getObject(e),n=$WC.$CUtil.isEmpty(s.description)?"":'<div class="floatl clr6 mrgT5 mrgB5">{{DESC}}</div>',r=Functions.hasDeletePermission(s.id)?'<div functionbuttons purpose="delete" functionid="{{FUNCTIONID}}" title="'+Resource.getRealValue("common.delete")+'" class="msi-cmddel posa"></div>':"",o="",l="",c=$WC.$CUtil.processXSS(s.name);return Functions.isFromIntegration(e)?(i='<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">{{APPNAME}}</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>",l=s.appdetails.name):Functions.isFromSandBox(e)?(i='<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">{{APPNAME}}</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span> ("+Resource.getRealValue("app.sandbox")+")</span>",l=s.appdetails.name):i='<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="{{CREATOR}}" class="zctxthgh cur">{{CREATORNAME}}</span>',Functions.isCreatedByMe(e)&&SecurityManager.hasPermission(Modules.Functions,MActions.Edit)&&(o='<div class="clr6 font14 dN zcinddics mrgL20"><div functionid="{{FUNCTIONID}}" functionbuttons purpose="editCode" class="zcclr cur dIB"><span class="msi-editicn zcclr mrgR5"></span>'+Resource.getRealValue("commands.editcode")+"</div></div>"),$WC.$CUtil.isEmpty(t)||(c=c.replace(new RegExp($WC.Matcher.replace("escaperegexp",t),"i"),"<b>$&</b>")),a=$WC.template.replace(FunctionsUI.listViewHTML,{NAME:c,DESCHTML:n,TIME:$Date.relative(-1!==parseInt(s.latime)?s.latime:s.ctime),CREATORHTML:i,EDITCODE:o,DELETEHTML:r},"InSecureHTML"),$WC.template.replace(a,{FUNCTIONID:s.id,DESC:s.description,APPNAME:l,CREATOR:s.creator,CLASS_NAME:s.type===Functions.BUTTON_HANDLER_TYPE?"zcf-button-fx":"zcf-form-fx",CREATORNAME:Users.getName(""+s.creator,"undefined"!=typeof s.creatorname?s.creatorname:"")})},show:function(e,t){e&&0==Functions.getCount()?$("#IntegrationsRHS").html('<span list-view="true" class="zcldng"></span>'):this.populate(t),e&&Functions.getAllFromServer()},bindEvents:function(){$(document).on("click","[functionbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof FunctionsUI.handle[t]&&FunctionsUI.handle[t](this,e)}),$(document).on("keyup","[functionsinput]",function(e){FunctionsUI.populate(e)})},collapseLHS:function(){$("#integrationwin").hasClass("zcletmin")&&IntegrationUI.handle.toggleLHS()},populate:function(e){if(IntegrationUI.listView.isCurrent(Integration.Modules.Functions,e)){var t=Functions.getCount();if(IntegrationUI.listView.initialize(Integration.Modules.Functions,t,SecurityManager.hasPermission(Modules.Functions,MActions.Create)),0===t)return;var i;("undefined"==typeof e||e.which!==$zcg.ESCAPE_KEYCODE)&&(i=$("#functionssearch").val());var a;$WC.$CUtil.isEmpty(i)?a=Functions.getAllIds(!0):(i=i.trim().toLowerCase(),a=Functions.search(i,100));for(var s="",n="",r="",o=0,l=a.length;l>o;o++){var c=a[o];Functions.isCreatedByMe(c)?s+=this.getHTML(c,i):n+=this.getHTML(c,i)}a=[],$WC.$CUtil.isEmpty(s)||(s='<div id="myfunctionsheader" zc_running_title class="zcinhds font15 bold paddT10 posl" >'+Resource.getRealValue("functions.mine")+'</div><div id="myfunctions" class="zcinchls">'+s+"</div>"),$WC.$CUtil.isEmpty(n)||(n='<div id="allfunctionsheader" zc_running_title class="zcinhds font15 bold paddT10 posl clrboth">'+Resource.getRealValue("functions.all")+'</div><div id="allfunctions" class="zcinchls">'+n+"</div>"),r=s+n,IntegrationUI.listView.populate(Integration.Modules.Functions,"functionslist",r,i,SecurityManager.hasPermission(Modules.Functions,MActions.Create))}},bindCreativeEvents:function(e){e.on("keyup","[functioninputs]",function(e){$("#integrationwin").find(".zcfdk_tmbzoom").removeClass("zcfdk_tmbzoom"),"functionname"!==this.id||$WC.Matcher.check("functionname",$(this).val())||($("#functionname").addClass("zcfdk_tmbzoom"),e.stopPropagation())})},validateAndGetParams:function(e,t){var i=$.trim(e.find("#functionname").val());if($("#integrationwin").find(".zcfdk_tmbzoom").removeClass("zcfdk_tmbzoom"),$WC.$CUtil.isEmpty(i)||!$WC.Matcher.check("functionname",i))return e.find("#functionname").addClass("zcfdk_tmbzoom"),void $Util.scrollToView(e.find("#functionnamepoint"),e,200);var a=$.trim(e.find("#functiondesc").val());if($WC.$CUtil.isEmpty(a)&&!$WC.Matcher.check("textpattern",a))return e.find("#functiondesc").addClass("zcfdk_tmbzoom"),void $Util.scrollToViewportTop(e.find("#functiondesc"),e,200);"undefined"!=typeof t&&(i=t.name!=i?i:void 0,a=t.description!=a?a:void 0);var s={name:i,description:a},n=$("#function-type-radio").find('[name="function_type"]:checked');return n.length&&(s.type=parseInt(n.val())),$Util.checkAndRemoveUndefinedKeys(s)},handle:{create:function(){var e=FunctionsUI.validateAndGetParams($("#functioncreateui"));$WC.$CUtil.isEmptyObject(e)||Functions.create(e)},editCode:function(e,t,i){"undefined"==typeof i&&(i=$(e).attr("functionid"));var a=Functions.getObject(i),s=$(e).attr("handlertype");if(s=$WC.$CUtil.isEmpty(s)?a.type:parseInt(s),a.module=Integration.Modules.Functions,Executions.isExist(i,s))DREImpl.handleEditCode(a,i,s);else{var n={componentid:i,type:s};Executions.create(n,function(e){Functions.updateStorage([e.data]),DREImpl.handleEditCode(a,i,s)})}},updateFunctionDeatils:function(e,t){if(void 0!=t&&!$.isEmptyObject(t)){e.find("#functionname").val($WC.$CUtil.processXSS(t.name));var i=t.description;if($WC.$CUtil.isEmpty(i)||e.find("#functiondesc").val($WC.$CUtil.processXSS(i)),"undefined"!=typeof t.display_props&&"undefined"!=typeof t.display_props.codevisibility){var a=e.find("#funccodevisibilitycheckbox");a.prop("checked",t.display_props.codevisibility?!0:!1),$Util.CustomCheckbox.setStatus(a,t.display_props.codevisibility?!0:!1)}}},getaddui:function(e,t,i){var a=Template.FunctionsCreateUI,s=[{id:"button_function",value:Functions.BUTTON_HANDLER_TYPE,label:Resource.getRealValue("messagesource.function"),checked:!0},{id:"form_function",value:Functions.FORM_HANDLER_TYPE,label:Resource.getRealValue("functions.type.form"),checked:!1}];a=a.replace(/{BUTTON_TYPE}/,$Dom.radio.construct("function_type",s)),a=a.replace(/{custom_class}/,"");var n=$("<div>");n.html(a),void 0==i||$.isEmptyObject(i)||FunctionsUI.handle.updateFunctionDeatils(n,i),$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this);e.html(n.children()).fadeIn(300,function(){e.find("#functionname").focus()}),FunctionsUI.bindCreativeEvents(e.find("#functioncreateui"))})},saveEdit:function(e){var t=$(e).attr("functionid"),i=FunctionsUI.validateAndGetParams($("#functioncreateui"),Functions.getObject(t));$WC.$CUtil.isEmptyObject(i)?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):Functions.edit(t,i)},editConfig:function(e){var t=$(e).attr("functionid"),i=Functions.getObject(t);Clickoutside.clear("Integrationspreviewcontainer");var a=Template.FunctionsCreateUI;a=$Util.CustomCheckbox.construct(a,[{html:'<input id="funccodevisibilitycheckbox" type="checkbox" class="zcunrdchkbx"/>',key:"{FUNCTIONVISIBILITY}",checked:!1}]),a=a.replace(/{custom_class}/,"dN");var s=$("<div>");s.html(a),s.find("#functioncreateheadertip").html(Resource.getRealValue("functions.edit")),s.find("#functioncreateui_action").attr("purpose","saveEdit").removeClass("msi-rhtarw").html(Resource.getRealValue("common.save")).attr("functionid",t),void 0==i||$.isEmptyObject(i)||FunctionsUI.handle.updateFunctionDeatils(s,i),$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this);e.html(s.children()).fadeIn(300,function(){e.find("#functionname").focus()}),FunctionsUI.bindCreativeEvents(e.find("#functioncreateui"))})},preview:function(e,t){var i=$(e).attr("functionid");if(!("user"===$(t.target).attr("elemtype")||IntegrationUI.hasPrevWin&&i===$("#Integrationspreview").attr("functionid"))){var a=Functions.getObject(i),s="";Functions.isCreatedByMe(i)&&SecurityManager.hasPermission(Modules.Functions,MActions.Edit)&&(s='<div functionbuttons purpose="editConfig" functionid="{{FUNCTIONID}}" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("commands.editconfig")+"</div>"),s+='<span drebuttons type="function" purpose="showGrantedConsents" class="zcclr zc-consents">'+Resource.getRealValue("platformconsents.viewgranted")+"</span>";var n="";a.type===Functions.BUTTON_HANDLER_TYPE?(n='<div class="zcincmli"><div class="fontB mrgT25">{{button_handler}}</div><div>{{button_handler_brief}}</div><div functionid="{{FUNCTIONID}}" handlertype="2000" functionbuttons purpose="editCode" class="zcclr cur dIB"><span class="msi-editicn zcclr mrgR5"></span>{{edit_code}}</div></div><div class="zcincmli"><div class="posrel mrgT25"><div class="fontB">{{instant_button_syntax}}</div><span clipboardarea class="ellips dIB w100">[What\'s this?](invoke.function|{{NAME}})</span><span documentclick="copyclipboard" class="cpyclip">{{copy}}</span></div><div class="posrel mrgT20"><div class="fontB">{{card_button_syntax}}</div><span clipboardarea class="ellips dIB w90">{"label":"What\'s this?","action":{"type":"invoke.function","data":{"name":"{{NAME}}"}}}</span><span documentclick="copyclipboard" class="cpyclip">{{copy}}</span></div></div>',n=$WC.template.replace(n,{$button_handler:"integration.handler.function",$button_handler_brief:"functions.button.brief",$edit_code:"commands.editcode",$instant_button_syntax:"functions.instant.button",$copy:"common.copy",$card_button_syntax:"functions.card.button"})):(n='<div class="zcincmli"><div class="fontB mrgT25">{{form_submit_handler}}</div><div>{{form_submit_brief}}</div><div functionid="{{FUNCTIONID}}" handlertype="2001" functionbuttons purpose="editCode" class="zcclr cur dIB"><span class="msi-editicn zcclr mrgR5"></span>{{edit_code}}</div><div class="fontB mrgT25">{{form_change_handler}}</div><div>{{form_change_brief}}</div><div functionid="{{FUNCTIONID}}" handlertype="2002" functionbuttons purpose="editCode" class="zcclr cur dIB"><span class="msi-editicn zcclr mrgR5"></span>{{edit_code}}</div><div class="fontB mrgT25">{{form_values_handler}}</div><div>{{form_values_brief}}</div><div functionid="{{FUNCTIONID}}" handlertype="2003" functionbuttons purpose="editCode" class="zcclr cur dIB"><span class="msi-editicn zcclr mrgR5"></span>{{edit_code}}</div></div>',n=$WC.template.replace(n,{$form_submit_handler:"integration.handler.form",$form_change_handler:"integration.handler.form-onchange",$form_values_handler:"integration.handler.form-values",$form_submit_brief:"functions.formsubmit.brief",$form_change_brief:"functions.formchange.brief",$form_values_brief:"functions.formvalues.brief",$edit_code:"commands.editcode"}));var r=$WC.template.replace(Template.FunctionPreview,{EDITBUTTONS:s,DETAILS_HTML:n},"InSecureHTML");r=$WC.template.replace(r,{NAME:a.name,DESC:$WC.$CUtil.isEmpty(a.description)?"":a.description,FUNCTIONID:i,CLASS_NAME:a.type===Functions.BUTTON_HANDLER_TYPE?"zcf-button-fx":"zcf-form-fx"}),IntegrationUI.preview("functionid",i,r,t)}},"delete":function(e){var t=e.getAttribute("functionid"),i=Functions.getObject(t),a=i.type===Functions.BUTTON_HANDLER_TYPE?"function.confirm.buttondelete.info":"function.confirm.formdelete.info";$WC.$Dlg.confirm({id:"deletefunctions",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("function.confirm.delete.info1"),Resource.getRealValue(a)],infoheader:Resource.getRealValue("integ.delete.info")}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-fx"></div>',header:Resource.getRealValue("function.confirm.delete",[$WC.$CUtil.processXSS(i.name)])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Functions.delete(t)}}]})}},reset:function(){IntegrationsCwin.close()}};Functions={BUTTON_HANDLER_TYPE:2e3,FORM_HANDLER_TYPE:2001,FORM_EVENT_HANDLER_TYPE:2002,FORM_VALUES_HANDLER_TYPE:2003,FORM_HANDLERS:[2001,2002,2003],init:function(){FunctionsUI.bindEvents()},getObject:function(e){return $DB.get("functions")[e]},getAll:function(){return $DB.get("functions")},isExist:function(e){return this.getAll().hasOwnProperty(e)},getCount:function(){return Object.keys(this.getAll()).length},getAppFunctionIds:function(e){var t=this.getAll(),i=[];for(var a in t){var s=t[a];s.appid==e&&i.push(a)}return i},isFunctionAlreadyExist:function(e){var t=this.getAll();for(var i in t){var a=t[i];if(a.name===e&&WmsImpl.isLocalUser(a.creator))return!0}return!1},getDefaultImgUrl:function(){return $zcg._IMGDEFAULTSTATICURL+"/function.png"},getAllIds:function(e){var t=this.getAll();if(e){var i=[];for(var a in t){var s=[];s.push(a);{-1!==parseInt(t[a].latime)?t[a].latime:t[a].ctime}s.push(t[a].latime),i.push(s)}i=$Util.sort(i,1,!0);for(var n=[],r=0;r<i.length;r++)n.push(i[r][0]);return n}return Object.keys(t)},updateStorage:function(e){for(var t=$DB.get("functions")||{},i=function(e,t){for(var i in t)e[i]=t[i];return e},a=0,s=e.length;s>a;a++){var n=e[a],r=n.id;t[r]=t[r]||{},t[r]=i(t[r],n)}$DB.update("functions",t)},isCreatedByMe:function(e){var t=this.getObject(e);return $WC.$CUtil.isEmpty(t)?void 0:$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator):t.appdetails.issandbox&&WmsImpl.isLocalUser(""+t.appdetails.developer)},hasDeletePermission:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator)||_isAppAccountAdmin()&&SecurityManager.hasPermission(Modules.Functions,MActions.Delete):!1},isFromIntegration:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&!t.appdetails.issandbox},isFromSandBox:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&t.appdetails.issandbox},hasCodeVisiblity:function(e){var t=this.getObject(e);return this.isFromIntegration(e)?void 0:this.isFromSandBox(e)?WmsImpl.isLocalUser(t.creator):_isAppAccountAdmin()||WmsImpl.isLocalUser(t.creator)||data.display_props&&1===t.display_props.codevisibility},deleteInStorage:function(e){var t=$DB.get("functions");delete t[e]},deleteAppEntities:function(e){for(var t=this.getAppFunctionIds(e),i=0;i<t.length;i++)this.deleteInStorage(t[i])},getAllFromServer:function(){SecurityManager.hasPermission(Modules.Functions)&&($DB.clear("functions"),$ZCAjx.ajax({url:"/v1/functions",success:function(e){Functions.updateStorage(e.data.functions),FunctionsUI.populate()}}))},create:function(e){$ZCAjx.ajax({url:"/v1/functions",type:"POST",contentType:"application/json",data:e,status:{loading:$("#functioncreateui_action")},success:function(e){Functions.updateStorage(e.data.functions),FunctionsUI.handle.editCode(void 0,void 0,e.data.functions[0].id),UI.updateBanner(Resource.getRealValue("functions.createdsuccess",[e.data.functions[0].name]),3e3,!1)}})},edit:function(e,t){$ZCAjx.ajax({url:"/v1/functions/"+e,type:"PUT",contentType:"application/json",data:t,status:{loading:$("#IntegrationsRHS").find('[purpose="saveEdit"]'),success:"functions.editedsuccess"},success:function(e){Functions.updateStorage(e.data.functions)}})},search:function(e){e=e.toLowerCase();var t=this.getAll(),i=[],a=[];for(var s in t){var n=t[s],r=n.name.toLowerCase(),o=r.indexOf(e);-1!=o&&(0===o?i.push(n.id):o>0&&a.push(n.id))}return i.concat(a)},"delete":function(e){$ZCAjx.ajax({url:"/v1/functions/"+e,type:"DELETE",status:{loading:"common.loading"},success:function(t){var i=$("#"+e),a=i.siblings();if(0===a.length){var s=i.parent()[0].id;$("#"+s).remove(),$("#"+s+"header").remove(),IntegrationUI.listView.populateEmptyResult(Integration.Modules.Functions,"functionslist")}i.slideUp(300,function(){$(this).remove(),IntegrationUI.hidePreview()}),Functions.deleteInStorage(t.data.id)}})},execute:function(e,t,i,a,s){var n=$("#"+t).find('[time="'+i+'"]'),r=!1;n.length>0&&(r=n[0].hasAttribute("integresponseelem"));var o={chid:t,msgid:i,fname:e,isTempResponse:r};"undefined"!=typeof a&&"undefined"!==a&&(o.btnindex=a),s&&(o.event=s.type);var l=$("#buttonconfirminput");l.length>0&&(o.input=l.val()),$ZCAjx.ajax({url:"/executefunction.do",type:"POST",data:o,sendSID:!0,trialExecutionChid:t,status:{loading:"common.loading"},success:function(e){var i=$(s.target).text();"INPUT"===s.target.tagName&&(i=$(s.target).val()),IntegrationsResponse.populateOutput({module:Integration.Components.Function,name:i,imageUrl:Functions.getDefaultImgUrl()},e,t)}})}};var SchedulersUI={},Schedulers={},SchedulersUI={currentsearchval:"",WEEKRESOURCE:{1:Resource.getRealValue("date.sun"),2:Resource.getRealValue("date.mon"),3:Resource.getRealValue("date.tue"),4:Resource.getRealValue("date.wed"),5:Resource.getRealValue("date.thu"),6:Resource.getRealValue("date.fri"),7:Resource.getRealValue("date.sat")},DAILY_REPETITION:"DAILY",WEEKLY_REPETITION:"WEEKLY",MONTHLY_REPETITION:"MONTHLY",MONTH_DAYS:"MONTHDAYS",MONTH_WEEKS:"MONTHWEEKS",scheduler_tobecreated:{},appViewHTML:'<div appbuttons purpose="toggleSelection" schedulerid="{{SCHEDULERID}}" class="cur zcappintl zctext"><div class="zchlistimg mrgT3 floatl"><div title="Select" class="msi-hissel posa"></div><div class="msi-schedlr"></div></div><div class="dIB w70 mrgT5 mrgL10"><div title="{{NAME}}" class="ellips">{{NAME}}{{SANDBOXTEXT}}</div><div class="ellips mrgT5 clr8">{{DESC}}</div></div></div>',listViewHTML:'<div id="{{SCHEDULERID}}" schedulerbuttons schedulerid="{{SCHEDULERID}}" purpose="preview" class="indivcom cur"><div class="zchlistimg mrgR10 floatl">{{DELETEHTML}}<div class="msi-schedlr"></div></div><div class="dIB mrgL10 w70"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips">{{NAME}} &nbsp;</div><div class="dIB">{{CREATORHTML}}</div>{{EDITCODE}}</div></div>{{DESCHTML}}<div class="zchnsrclft mrgT5"><div class="zchlsrctit zcfxtme dIB clr6">{{SCHEDULEINFO}} {{TIME}} </div></div></div></div>',optionsDropdownHTML:'<div id="{{ID}}cnt"><div class="selectmlmn zcschbgdrp"><div class="dIB zcevrem"><div id="{{ID}}head" class="zcrmtm" schedulerbuttons purpose="showOptions"><div id="{{ID}}sel" class="mailids ellips" val="{{DEFAULTVALUE}}">{{DEFAULTNAME}}</div><span class="msi-darrw floatr"></span></div><ul id="{{ID}}" schedulerbuttons purpose="selectOption" style="display:none" class="dropdwncnt">{{DROPDOWN}}</ul></div></div></div>',getHTML:function(e,t){var i,a,s=Schedulers.getObject(e),n=$WC.$CUtil.isEmpty(s.description)?"":'<div class="floatl clr6 mrgT5 mrgB5">{{DESC}}</div>',r=Schedulers.hasDeletePermission(s.id)?'<div schedulerbuttons purpose="deletescheduler" schedulerid="{{SCHEDULERID}}" title="'+Resource.getRealValue("common.delete")+'" class="msi-cmddel posa"></div>':"",o="",l="",c=$WC.$CUtil.processXSS(s.name);Schedulers.isFromIntegration(e)?(i='<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">{{APPNAME}}</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>",l=s.appdetails.name):Schedulers.isFromSandBox(e)?(i='<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">{{APPNAME}}</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span> ("+Resource.getRealValue("app.sandbox")+")</span>",l=s.appdetails.name):i='<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="{{CREATOR}}" class="zctxthgh cur">{{CREATORNAME}}</span>',Schedulers.isCreatedByMe(e)&&SecurityManager.hasPermission(Modules.Schedulers,MActions.Edit)&&(o='<div class="clr6 font14 dN zcinddics mrgL20"><div schedulerid="{{SCHEDULERID}}" schedulerbuttons purpose="editCode" class="zcclr cur dIB"><span class="msi-editicn zcclr mrgR5"></span>'+Resource.getRealValue("commands.editcode")+"</div></div>"),$WC.$CUtil.isEmpty(t)||(c=c.replace(new RegExp($WC.Matcher.replace("escaperegexp",t),"i"),"<b>$&</b>"));var d=SchedulersUI.getSchedulerDisplayInfo(s.scheduler_props),u=" | "+Resource.getRealValue("scheduler.lastexecuted")+" ",m=u+'<span id="schlistvwtime">'+(-1!==parseInt(s.letime)?$Date.relative(s.letime):"")+"</span>";return a=$WC.template.replace(SchedulersUI.listViewHTML,{NAME:c,DESCHTML:n,TIME:-1!==parseInt(s.letime)?m:"",CREATORHTML:i,EDITCODE:o,DELETEHTML:r,SCHEDULEINFO:d},"InSecureHTML"),$WC.template.replace(a,{SCHEDULERID:s.id,DESC:s.description,APPNAME:l,CREATOR:s.creator,CREATORNAME:Users.getName(""+s.creator,"undefined"!=typeof s.creator_name?s.creator_name:"")})},show:function(e,t){e&&0==Schedulers.getCount()?$("#IntegrationsRHS").html('<span list-view="true" class="zcldng"></span>'):this.populate(t),e&&Schedulers.getAllFromServer()},bindEvents:function(){$(document).on("click","[schedulerbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof SchedulersUI.handle[t]&&SchedulersUI.handle[t](this,e)}),$(document).on("keyup","[schedulersinput]",function(e){SchedulersUI.populate(e)}),$(document).on("click","[schedulersselectinput]",function(e){var t=$(this).parent().find("input");$("[schedulersselectinput]").removeClass("zcddtpr");var i=t.addClass("zcddtpr").siblings("[datedropdown]").attr("id"),a=$("#"+i);ZCScroll.customScroll(a,!0),a.is(":visible")||Clickoutside.bind({event:e,srcid:t.attr("id"),destid:i,callback:function(e){$("#"+e).removeClass("zcddtpr")}});var s=e.target.value;!$WC.$CUtil.isEmpty(s)&&s.length>1&&$Util.scrollToViewportTop(a.find("[val="+s+"]").addClass("sel"),i,300)}),$(document).on("keydown","[schedulersselectinput]",function(e){var t=e.which,i=$(this).siblings("[datedropdown]").attr("id"),a=$("#schedulercreateui").find("#"+i);a.is(":visible")&&(t===$zcg.UP_KEYCODE||t===$zcg.DOWN_KEYCODE?DropdownUtil.handleListNavigation(e,a,"[timeddlist]"):t===$zcg.TAB_KEYCODE?Clickoutside.handleClickOnChild(e,i):t===$zcg.ENTER_KEYCODE&&a.find(".sel").length&&SchedulersUI.showSelectedTime(a.find(".sel"),e))}),$(document).on("keyup","[schedulersselectinput]",function(){function e(e,s){return a>e||s>a||!/^[0-9]+$/.test(i)?(t.addClass("zcfdk_tmbzoom error").attr("timeval","false"),!1):!0}var t=$(this),i=t.val(),a=parseInt(t.val());t.removeClass("zcfdk_tmbzoom error").attr("timeval","true");var s=!1;if(t.is("[hours]")&&(s=e(Schedulers.MAX_HOURS,Schedulers.MIN_HOURS)),t.is("[minutes]")&&(s=e(Schedulers.MAX_MINUTES,Schedulers.MIN_MINUTES)),s&&!$WC.$CUtil.isEmpty(a)){var n=t.addClass("zcddtpr").siblings("[datedropdown]").attr("id"),r=$("#"+n);r.find(".sel").removeClass("sel");var o=""+a;o=o.length>1?o:"0"+o,$Util.scrollToViewportTop(r.find("[val="+o+"]").addClass("sel"),n,300)}})},getSchedulerDisplayInfo:function(e){var t="";if(e.type==SchedulersUI.WEEKLY_REPETITION){var i=e.days.split(",");t="("+(i.length+" "+Resource.getRealValue(i.length>1?"common.days":"common.day"))+")"}else if(e.type==SchedulersUI.MONTHLY_REPETITION){var i=e.days.split(","),a=$WC.$CUtil.isEmpty(e.weeksofmonth)?[]:e.weeksofmonth.split(",");t="("+(a.length>0?a.length+" - "+Resource.getRealValue(a.length>1?"scheduler.period.monthweeks":"common.week"):i.length+" "+Resource.getRealValue(i.length>1?"common.days":"common.day"))+")"}var s=e.time.split(","),n=parseInt(s[0]),r=""+(0==n?12:n>12?n%12:n),o=(s[1].length<2?"0":"")+s[1],l=(r.length<2?"0":"")+r+":"+o+" "+Resource.getRealValue("scheduler.period."+(n>=12?"PM":"AM")),c=Resource.getRealValue("scheduler.period."+e.type)+" "+t+" "+Resource.getRealValue("common.at")+" "+l;return c},collapseLHS:function(){$("#integrationwin").hasClass("zcletmin")&&IntegrationUI.handle.toggleLHS()},populate:function(e){if(IntegrationUI.listView.isCurrent(Integration.Modules.Schedulers,e)){var t=Schedulers.getCount();if(IntegrationUI.listView.initialize(Integration.Modules.Schedulers,t,SecurityManager.hasPermission(Modules.Schedulers,MActions.Create)),0===t)return;var i,a;("undefined"==typeof e||e.which!==$zcg.ESCAPE_KEYCODE)&&(a=$("#schedulerssearch").val()),$WC.$CUtil.isEmpty(a)?i=Schedulers.getAllIds(!0):(a=a.trim().toLowerCase(),i=Schedulers.search(a,100));for(var s="",n="",r="",o=0,l=i.length;l>o;o++){var c=i[o];Schedulers.isCreatedByMe(c)?s+=this.getHTML(c,a):n+=this.getHTML(c,a)}i=[],$WC.$CUtil.isEmpty(s)||(s='<div id="myschedulersheader" zc_running_title class="zcinhds font15 bold paddT10 posl" >'+Resource.getRealValue("schedulers.mine")+'</div><div id="myschedulers" class="zcinchls">'+s+"</div>"),$WC.$CUtil.isEmpty(n)||(n='<div id="allschedulersheader" zc_running_title class="zcinhds font15 bold paddT10 posl clrboth">'+Resource.getRealValue("schedulers.all")+'</div><div id="allschedulers" class="zcinchls">'+n+"</div>"),r=s+n,IntegrationUI.listView.populate(Integration.Modules.Schedulers,"schedulerslist",r,a,SecurityManager.hasPermission(Modules.Schedulers,MActions.Create))}},bindCreativeEvents:function(e){e.on("keyup","[schedulerinputs]",function(e){("schedulername"===this.id&&$(this).val().length>30||!$WC.Matcher.check("textpattern",$(this).val()))&&($("#schedulername").addClass("error"),e.stopPropagation())}),e.on("change","[type='radio']",function(){this.value===SchedulersUI.DAILY_REPETITION?($("#RPMonthlyConfig").hide(),$("#RPWeeklyConfig").hide(),$("#RPInfoDesc").html(Resource.getRealValue("scheduler.period.rpinfo"+$WC.$CUtil.processXSS(this.value)))):this.value===SchedulersUI.WEEKLY_REPETITION?($("#RPMonthlyConfig").hide(),$("#RPWeeklyConfig").show(),$("#RPInfoDesc").html(Resource.getRealValue("scheduler.period.rpinfo"+$WC.$CUtil.processXSS(this.value)))):this.value===SchedulersUI.MONTHLY_REPETITION?($("#RPMonthlyConfig").show(),$("#RPWeeklyConfig").hide(),$("#RPInfoDesc").html(Resource.getRealValue("scheduler.period.rpinfo"+$WC.$CUtil.processXSS(this.value)))):this.value===SchedulersUI.MONTH_DAYS?($("#RPMonthlyDaysCalendar").show(),$("#RPMonthlyWeeksCalendar").hide()):this.value===SchedulersUI.MONTH_WEEKS&&($("#RPMonthlyDaysCalendar").hide(),$("#RPMonthlyWeeksCalendar").show())})},validateAndGetParams:function(e,t){var i=$.trim(e.find("#schedulername").val());if($WC.$CUtil.isEmpty(i)||i.length>30||!$WC.Matcher.check("textpattern",i))return e.find("#schedulername").addClass("error"),void $Util.scrollToView(e.find("#schedulernamepoint"),e,200);var a=$.trim(e.find("#schedulerdesc").val());if($WC.$CUtil.isEmpty(a)&&!$WC.Matcher.check("textpattern",a))return e.find("#schedulerdesc").addClass("error"),void $Util.scrollToViewportTop(e.find("#schedulerdesc"),e,200);if("undefined"!=typeof t&&(i=t.name!=i?i:void 0,a=t.description!=a?a:void 0),"undefined"!=typeof i&&Schedulers.isSchedulerAlreadyExist(i))return void UI.updateBanner(Resource.getRealValue("name.already.exist"),2e3,!0);var s=$.trim(e.find("[name='schedulerperiodradio']:checked").val()),n=parseInt($.trim(e.find("#schedulehours").val()));if($WC.$CUtil.isEmpty(n)||isNaN(e.find("#schedulehours").val())||n<Schedulers.MIN_HOURS||n>Schedulers.MAX_HOURS)return e.find("#schedulehours").addClass("error"),void $Util.scrollToViewportTop(e.find("#schedulehours"),e,200);var r=parseInt($.trim(e.find("#schedulemin").val()));if($WC.$CUtil.isEmpty(r)||isNaN(e.find("#schedulemin").val())||r<Schedulers.MIN_MINUTES||r>Schedulers.MAX_MINUTES)return e.find("#schedulemin").addClass("error"),void $Util.scrollToViewportTop(e.find("#schedulemin"),e,200);var o=e.find("#RPperiodampm").val();if($WC.$CUtil.isEmpty(o))return e.find("#RPperiodampm").addClass("error"),void $Util.scrollToViewportTop(e.find("#RPperiodampm"),e,200);n+=o==Resource.getRealValue("scheduler.period.PM")?12:0,n=12==n?0:n,n=24==n?12:n;var l={type:s,time:n+","+r};if(s==SchedulersUI.WEEKLY_REPETITION||s==SchedulersUI.MONTHLY_REPETITION){var c=[],d=s==SchedulersUI.MONTHLY_REPETITION?"RPMonthlyConfig":"RPWeeklyConfig",u=$.trim(e.find("[name='schedulermonthradio']:checked").val()),m=s==SchedulersUI.WEEKLY_REPETITION?"#RPCalInfoWEEKLY":"#RPCalInfoMONTHLY";if(s==SchedulersUI.MONTHLY_REPETITION&&(d=u==SchedulersUI.MONTH_DAYS?"RPMonthlyDaysCalendar":"RPMonthlyCalDays",u==SchedulersUI.MONTH_WEEKS)){var p=e.find("#RPMonthlyCalWeeks").find(".zcbtnbgclr");if(0==p.length)return e.find("#RPMonthlyCalWeeksInfo").addClass("error"),void $Util.scrollToViewportTop(e.find("#RPMonthlyCalWeeksInfo"),e,200);e.find("#RPMonthlyCalWeeksInfo").removeClass("error");for(var h=[],g=0;g<p.length;g++)h.push($(p[g]).attr("value"));l.weeksofmonth=h.join(","),c.push($("#RPMWeekDaysDropsel").attr("val"))}if(0==c.length){var f=e.find("#"+d).find(".zcbtnbgclr");if(0==f.length)return e.find(m).addClass("error"),void $Util.scrollToViewportTop(e.find(m),e,200);e.find(m).removeClass("error");for(var g=0;g<f.length;g++)c.push($(f[g]).attr("value"))}l.days=c.join(",")}if("undefined"!=typeof t&&"undefined"==typeof i&&"undefined"==typeof a){var v=t.scheduler_props;v.type==l.type&&v.time==l.time+",0"&&(v.type==SchedulersUI.DAILY_REPETITION||l.weeksofmonth&&v.weeksofmonth!==l.weeksofmonth||v.days!==l.days||(l=void 0))}return $Util.checkAndRemoveUndefinedKeys({name:i,description:a,scheduler_props:l})},getDropdownHtml:function(e,t,i){for(var a,s="",n=i?i:12===e?1:0,r=n;e>=r;r++)a=""+r,a=a.length>1?a:"0"+a,s+='<li val="'+a+'" schedulerbuttons purpose="selectTime" timeddlist'+(t==r?' class="sel"':"")+">"+a+"</li>";return s},showSelectedTime:function(e,t){var i=e.attr("val"),a=e.parent().attr("id");$("#"+a).siblings("input").val(i).removeClass("zcfdk_tmbzoom error").attr("timeval","true"),Clickoutside.handleClickOnChild(t,a)},handle:{create:function(){var e=SchedulersUI.validateAndGetParams($("#schedulercreateui"));$WC.$CUtil.isEmpty(e)||Schedulers.create(e)},editCode:function(e,t,i){"undefined"==typeof i&&(i=$(e).attr("schedulerid"));var a=Schedulers.getObject(i);a.module=Integration.Modules.Schedulers,DREImpl.handleEditCode(a,i,Schedulers.HANDLER_TYPE)},select:function(e){var t=$(e);t.hasClass("zcbtnbgclr")?t.removeClass("zcbtnbgclr"):t.addClass("zcbtnbgclr")},executescheduler:function(e,t){var i=$(t.target).parents("[schedulerid]").attr("schedulerid");Schedulers.execute(i)},selectTime:function(e,t){var e=$(e);e.parent().find(".sel").removeClass("sel"),e.addClass("sel"),SchedulersUI.showSelectedTime(e,t)},selectOption:function(e,t){var i=$(t.target).attr("val");$("#"+e.id+"cnt").find("#"+e.id+"sel").html($(t.target).text()).attr("val",i),Clickoutside.handleClickOnChild(t)},showOptions:function(e,t){var e=$(e),i=e.siblings('[purpose="selectOption"]');e.removeClass("zcfdk_tmbzoom error"),$(t.target).addClass("sel"),e.addClass("zcddsw"),Clickoutside.bind({event:t,srcid:t.currentTarget.id,destid:i[0].id,callback:function(e){var t=$("#"+e);t.removeClass("sel").removeClass("zcddsw").parent().removeClass("zcdrptop")}});var a=$("#"+i[0].id);$(window).height()<a.offset().top+a.height()+e.height()?e.parent().addClass("zcdrptop"):e.parent().removeClass("zcdrptop")},updateSchedulerDeatils:function(e,t){if(void 0==t||$.isEmptyObject(t)){var i=new Date,a=i.getHours()+1,s=a%12==0?12:a%12,n=Resource.getRealValue("scheduler.period."+(a>=12?"PM":"AM"));e.find("#schedulehours").val((10>s?"0":"")+s),e.find("#schedulemin").val("00"),e.find("#RPperiodampm").val($WC.$CUtil.processXSS(n))}else{e.find("#schedulername").val($WC.$CUtil.processXSS(t.name));var r=t.description;if($WC.$CUtil.isEmpty(r)||e.find("#schedulerdesc").val($WC.$CUtil.processXSS(r)),"undefined"!=typeof t.display_props&&"undefined"!=typeof t.display_props.codevisibility){var o=e.find("#funccodevisibilitycheckbox");o.prop("checked",t.display_props.codevisibility?!0:!1),$Util.CustomCheckbox.setStatus(o,t.display_props.codevisibility?!0:!1)}if("undefined"!=typeof t.scheduler_props){(t.scheduler_props.type==SchedulersUI.WEEKLY_REPETITION||t.scheduler_props.type==SchedulersUI.MONTHLY_REPETITION)&&(e.find("#"+(t.scheduler_props.type==SchedulersUI.WEEKLY_REPETITION?"RPWeeklyConfig":"RPMonthlyConfig")).show(),e.find("#RPInfoDesc").html(Resource.getRealValue("scheduler.period.rpinfo"+$WC.$CUtil.processXSS(t.scheduler_props.type))),e.find("#"+($WC.$CUtil.isEmpty(t.scheduler_props.weeksofmonth)?"RPMonthlyWeeksCalendar":"RPMonthlyDaysCalendar")).hide(),e.find("#"+($WC.$CUtil.isEmpty(t.scheduler_props.weeksofmonth)?"RPMonthlyDaysCalendar":"RPMonthlyWeeksCalendar")).show());var l=t.scheduler_props.time.split(","),c=parseInt(l[0]),d=0==c?12:c>12?c%12:c,u=(10>d?"0":"")+d,m=l[1].length>1?l[1]:"0"+l[1],n=Resource.getRealValue("scheduler.period."+(c>=12?"PM":"AM"));e.find("#schedulehours").val(u),e.find("#schedulemin").val($WC.$CUtil.processXSS(m)),e.find("#RPperiodampm").val($WC.$CUtil.processXSS(n))}}},getaddui:function(e,t,i){var a=Template.SchedulersCreateUI;a=$Util.CustomCheckbox.construct(a,[{html:'<input id="funccodevisibilitycheckbox" type="checkbox" class="zcunrdchkbx"/>',key:"{SCHEDULERVISIBILITY}",checked:!1}]),a=this.getPeriodRadio(a,i);var s=$("<div>");s.html(a),SchedulersUI.handle.updateSchedulerDeatils(s,i),$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this);e.html(s.children()).fadeIn(300,function(){e.find("#schedulername").focus()}),SchedulersUI.bindCreativeEvents(e.find("#schedulercreateui"))})},saveEdit:function(e){var t=$(e).attr("schedulerid"),i=SchedulersUI.validateAndGetParams($("#schedulercreateui"),Schedulers.getObject(t));$WC.$CUtil.isEmptyObject(i)?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):Schedulers.edit(t,i)},getPeriodRadio:function(e,t){var i=[{id:"schedulerperiodradio1",value:SchedulersUI.DAILY_REPETITION,label:"Daily",checked:"undefined"==typeof t||t.scheduler_props.type===SchedulersUI.DAILY_REPETITION},{id:"schedulerperiodradio2",value:SchedulersUI.WEEKLY_REPETITION,label:"Weekly",checked:t&&t.scheduler_props.type===SchedulersUI.WEEKLY_REPETITION},{id:"schedulerperiodradio3",value:SchedulersUI.MONTHLY_REPETITION,label:"Monthly",checked:t&&t.scheduler_props.type===SchedulersUI.MONTHLY_REPETITION}],a=[{id:"schedulermonthradio1",value:SchedulersUI.MONTH_DAYS,label:Resource.getRealValue("scheduler.period.monthdays"),checked:"undefined"==typeof t||$WC.$CUtil.isEmpty(t.scheduler_props.weeksofmonth)},{id:"schedulermonthradio2",value:SchedulersUI.MONTH_WEEKS,label:Resource.getRealValue("scheduler.period.monthweeks"),checked:t&&t.scheduler_props.type===SchedulersUI.MONTHLY_REPETITION&&!$WC.$CUtil.isEmpty(t.scheduler_props.weeksofmonth)}],s="",n=t&&t.scheduler_props.type===SchedulersUI.MONTHLY_REPETITION&&t.scheduler_props.weeksofmonth?t.scheduler_props.weeksofmonth.split(","):[],r='<li val="{{ROWVAL}}"">{{ROWSRC}}</li>',o="",l='<span schedulerbuttons purpose="select" value="{{ROWVAL}}" class="{{ROWCLASS}}">{{ROWSRC}}</span>',c="",d=t&&(t.scheduler_props.type===SchedulersUI.WEEKLY_REPETITION||n.length>0)?t.scheduler_props.days.split(","):[];for(var u in SchedulersUI.WEEKRESOURCE){var m=d.indexOf(u)>=0&&0==n.length?"zcbtnbgclr":"";c+=$WC.template.replace(l,{ROWVAL:u,ROWSRC:SchedulersUI.WEEKRESOURCE[u],ROWCLASS:m}),o+=$WC.template.replace(r,{ROWVAL:u,ROWSRC:SchedulersUI.WEEKRESOURCE[u]})}for(var p='<span schedulerbuttons purpose="select" value="{{MONTHVAL}}" class="{{MONTHCLASS}}">{{MONTHVAL}}</span>',h="",g=t&&t.scheduler_props.type===SchedulersUI.MONTHLY_REPETITION&&0==n.length?t.scheduler_props.days.split(","):[],f=Schedulers.MIN_DAY;f<=Schedulers.MAX_DAY_OF_MONTH;f++){var m=g.indexOf(""+f)>=0?"zcbtnbgclr":"";h+=$WC.template.replace(p,{MONTHVAL:f,MONTHCLASS:m})}for(var v=Schedulers.MIN_DAY;v<=Schedulers.MAX_WEEKS_OF_MONTH;v++){var m=n.indexOf(""+v)>=0?"zcbtnbgclr":"";s+=$WC.template.replace(l,{ROWVAL:v,ROWSRC:Resource.getRealValue("scheduler.period.weekmonth."+v),ROWCLASS:m})}weeksmonthcontent=$WC.template.replace(SchedulersUI.optionsDropdownHTML,{ID:"RPMWeekDaysDrop",DEFAULTNAME:SchedulersUI.WEEKRESOURCE[t&&t.scheduler_props.type===SchedulersUI.MONTHLY_REPETITION&&d.length>0?d[0]:1],DEFAULTVALUE:t&&t.scheduler_props.type===SchedulersUI.MONTHLY_REPETITION&&d.length>0?d[0]:1}),weeksmonthcontent=weeksmonthcontent.replace(/{{DROPDOWN}}/,o);var C=new Date,y=C.getHours()+1;return y=y%12==0?12:y%12,e=e.replace(/{Radio_Buttons}/,$Dom.radio.construct("schedulerperiodradio",i)).replace(/{Month_Radio_Buttons}/,$Dom.radio.construct("schedulermonthradio",a)),e=e.replace(/{{HOURSDROPDOWN}}/,SchedulersUI.getDropdownHtml(Schedulers.MAX_HOURS,t&&t.scheduler_props?parseInt(t.scheduler_props.time.split(",")[0]):y)).replace(/{{MINUTESDROPDOWN}}/,SchedulersUI.getDropdownHtml(Schedulers.MAX_MINUTES,t&&t.scheduler_props?parseInt(t.scheduler_props.time.split(",")[1]):0)).replace(/{{WEEKRESOURCES}}/,c).replace(/{{MONTHRESOURCES}}/,h).replace(/{{RPWEEKSMONTHHTML}}/,s).replace(/{{RPWEEKMONTHDAYSHTML}}/,weeksmonthcontent)},editConfig:function(e){var t=$(e).attr("schedulerid"),i=Schedulers.getObject(t);Clickoutside.clear("Integrationspreviewcontainer");var a=Template.SchedulersCreateUI;a=$Util.CustomCheckbox.construct(a,[{html:'<input id="funccodevisibilitycheckbox" type="checkbox" class="zcunrdchkbx"/>',key:"{SCHEDULERVISIBILITY}",checked:!1}]),a=this.getPeriodRadio(a,i);var s=$("<div>");s.html(a),s.find("#schedulercreateheadertip").html(Resource.getRealValue("schedulers.edit")),s.find("#schedulercreateui_action").attr("purpose","saveEdit").removeClass("msi-rhtarw").html(Resource.getRealValue("common.save")).attr("schedulerid",t),SchedulersUI.handle.updateSchedulerDeatils(s,i),$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this);e.html(s.children()).fadeIn(300,function(){e.find("#schedulername").focus()}),SchedulersUI.bindCreativeEvents(e.find("#schedulercreateui"))})},preview:function(e,t){var i=$(e).attr("schedulerid");if(!("user"===$(t.target).attr("elemtype")||IntegrationUI.hasPrevWin&&i===$("#Integrationspreview").attr("schedulerid"))){var a,s=Schedulers.getObject(i),n="";Schedulers.isCreatedByMe(i)&&SecurityManager.hasPermission(Modules.Schedulers,MActions.Edit)&&(n='<div schedulerbuttons purpose="editConfig" schedulerid="{{SCHEDULERID}}" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("commands.editconfig")+'</div><div schedulerbuttons purpose="executescheduler" schedulerid="{{SCHEDULERID}}" class="dbtn adbtn floatr mrgL20 msi-plyschbtn">'+Resource.getRealValue("scheduler.testrun")+"</div>");var r=s.scheduler_props,o=SchedulersUI.getSchedulerDisplayInfo(r),l="";if(r.type==SchedulersUI.WEEKLY_REPETITION||r.type==SchedulersUI.MONTHLY_REPETITION){var c='<div class="schparent mrgT15 {{MONTHCLS}}">{{MONTHRESOURCES}}</div>',d='<span class="{{ROWCLASS}}">{{ROWSRC}}</span>',u="",m="",p="",h=r.type!==SchedulersUI.WEEKLY_REPETITION&&$WC.$CUtil.isEmpty(r.weeksofmonth)?[]:r.days.split(",");for(var g in SchedulersUI.WEEKRESOURCE){var f=h.indexOf(g)>=0?"zcbtnbgclr":"",v=r.type==SchedulersUI.WEEKLY_REPETITION;u+=$WC.template.replace(d,{ROWSRC:v?SchedulersUI.WEEKRESOURCE[g]:"-",ROWCLASS:v?f:""}),p+=$WC.template.replace(d,{ROWSRC:SchedulersUI.WEEKRESOURCE[g],ROWCLASS:""}),m+=$WC.template.replace(d,{ROWSRC:h.indexOf(g)>=0?"":"-",ROWCLASS:h.indexOf(g)>=0?"msi-tick":""})}if(r.type==SchedulersUI.WEEKLY_REPETITION)c=$WC.template.replace(c,{MONTHRESOURCES:u,MONTHCLS:"zcscmonthcls"},"InSecureHTML");else if(r.type==SchedulersUI.MONTHLY_REPETITION){var C='<span class="{{MONTHCLASS}}">{{MONTHVAL}}</span>',y="",b=r.days.split(",");if($WC.$CUtil.isEmpty(r.weeksofmonth))for(var E=Schedulers.MIN_DAY;E<=Schedulers.MAX_DAY_OF_MONTH;E++){var f=b.indexOf(""+E)>=0?"zcbtnbgclr":"";y+=$WC.template.replace(C,{MONTHVAL:E,MONTHCLASS:f})}else{var I=r.weeksofmonth.split(",");y=y+"<div>"+p+"</div>";for(var T=Schedulers.MIN_DAY;T<=Schedulers.MAX_WEEKS_OF_MONTH;T++){var f=I.indexOf(""+T)>=0?"zcbtnbgclr":"";y=y+"<div>"+$WC.template.replace(d,{ROWSRC:Resource.getRealValue("scheduler.period.weekmonth."+T),ROWCLASS:""})+(f.length>0?m:u)+"</div>"}}c=$WC.template.replace(c,{MONTHRESOURCES:y,MONTHCLS:"schmonthly zcschwkel"},"InSecureHTML")}l=c}var S=$WC.$CUtil.isEmpty(s.letime)||"-1"==s.letime?"-":$Date.relative(parseInt(s.letime)),R=new Date,A=$WC.$CUtil.isEmpty(s.netime)||"-1"==s.netime?"-":parseInt(s.netime)<R.getTime()?$Date.daytime(parseInt(s.netime)):$Date.relativetimeleft(parseInt(s.netime));a=$WC.template.replace(Template.SchedulerPreview,{EDITBUTTONS:n,SCHEDULERPROPS:o,LASTRUN:S,NEXTRUN:A,MONTHRESOURCES:l},"InSecureHTML"),a=$WC.template.replace(a,{NAME:s.name,DESC:$WC.$CUtil.isEmpty(s.description)?"":s.description,SCHEDULERID:i}),IntegrationUI.preview("schedulerid",i,a,t,function(){Schedulers.hasCodeVisiblity(i)?Executions.getDetails(i,Schedulers.HANDLER_TYPE,$("#schedulerpreviewcode"),$("#schedulerpreviewcont")):$("#schedulerpreviewcodeholder").prepend('<div class="posa textcent zcfxnprv" >'+Resource.getRealValue("scheduler.code.hidden.info")+"</div>")}),$(e).find("#schlistvwtime").html(S)}},deletescheduler:function(e){var t=e.getAttribute("schedulerid"),i=Schedulers.getObject(t).name;$WC.$Dlg.confirm({id:"deleteschedulers",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("scheduler.confirm.delete.info1"),Resource.getRealValue("scheduler.confirm.delete.info2")],infoheader:Resource.getRealValue("integ.delete.info")}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-schedlr"></div>',header:Resource.getRealValue("scheduler.confirm.delete",[$WC.$CUtil.processXSS(i)])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){Schedulers.deletescheduler(t)}}]})}},reset:function(){IntegrationsCwin.close()}};Schedulers={HANDLER_TYPE:5e3,MAX_HOURS:12,MIN_HOURS:1,MAX_MINUTES:59,MIN_MINUTES:0,MIN_DAY:1,MAX_DAY_OF_MONTH:31,MAX_WEEKS_OF_MONTH:5,init:function(){SchedulersUI.bindEvents()},getObject:function(e){return $DB.get("schedulers")[e]},getAll:function(){return $DB.get("schedulers")},isExist:function(e){return this.getAll().hasOwnProperty(e)},getCount:function(){return Object.keys(this.getAll()).length},getAppSchedulerIds:function(e){var t=this.getAll(),i=[];for(var a in t){var s=t[a];s.appid==e&&i.push(a)}return i},isSchedulerAlreadyExist:function(e){var t=this.getAll();for(var i in t){var a=t[i];if(a.name===e&&WmsImpl.isLocalUser(a.creator))return!0}return!1},getDefaultImgUrl:function(){return $zcg._IMGDEFAULTSTATICURL+"/scheduler.png"},getAllIds:function(e){var t=this.getAll();if(e){var i=[];for(var a in t){var s=[a,t[a].name];i.push(s)}i=$Util.sortString(i,1,!1);for(var n=[],r=0;r<i.length;r++)n.push(i[r][0]);return n}return Object.keys(t)},updateStorage:function(e){for(var t=$DB.get("schedulers")||{},i=function(e,t){for(var i in t)e[i]=t[i];return e},a=0,s=e.length;s>a;a++){var n=e[a],r=n.id;t[r]=t[r]||{},t[r]=i(t[r],n)}$DB.update("schedulers",t)},isCreatedByMe:function(e){var t=this.getObject(e);return $WC.$CUtil.isEmpty(t)?void 0:$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator):t.appdetails.issandbox&&WmsImpl.isLocalUser(""+t.appdetails.developer)},hasDeletePermission:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator)||_isAppAccountAdmin()&&SecurityManager.hasPermission(Modules.Schedulers,MActions.Delete):!1},isFromIntegration:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&!t.appdetails.issandbox},isFromSandBox:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&t.appdetails.issandbox},hasCodeVisiblity:function(e){var t=this.getObject(e);return this.isFromIntegration(e)?void 0:this.isFromSandBox(e)?WmsImpl.isLocalUser(t.creator):WmsImpl.isLocalUser(t.creator)||t.display_props&&1===t.display_props.codevisibility},deleteInStorage:function(e){var t=$DB.get("schedulers");delete t[e]},deleteAppEntities:function(e){for(var t=this.getAppSchedulerIds(e),i=0;i<t.length;i++)this.deleteInStorage(t[i])},getAllFromServer:function(){SecurityManager.hasPermission(Modules.Schedulers)&&($DB.clear("schedulers"),$ZCAjx.ajax({url:"/v1/schedulers",success:function(e){Schedulers.updateStorage(e.data.schedulers),SchedulersUI.populate()}}))},create:function(e){$ZCAjx.ajax({url:"/v1/schedulers",type:"POST",contentType:"application/json",data:e,status:{loading:$("#schedulercreateui_action")},success:function(e){Schedulers.updateStorage(e.data.schedulers),SchedulersUI.handle.editCode(void 0,void 0,e.data.schedulers[0].id),UI.updateBanner(Resource.getRealValue("schedulers.createdsuccess",[e.data.schedulers[0].name]),3e3,!1)}})},edit:function(e,t){$ZCAjx.ajax({url:"/v1/schedulers/"+e,type:"PUT",contentType:"application/json",data:t,status:{loading:$("#IntegrationsRHS").find('[purpose="saveEdit"]'),success:"schedulers.editedsuccess"},success:function(e){Schedulers.updateStorage(e.data.schedulers)}})},search:function(e){e=e.toLowerCase();var t=this.getAll(),i=[],a=[];for(var s in t){var n=t[s],r=n.name.toLowerCase(),o=r.indexOf(e);-1!=o&&(0===o?i.push(n.id):o>0&&a.push(n.id))}return i.concat(a)},deletescheduler:function(e){$ZCAjx.ajax({url:"/v1/schedulers/"+e,type:"DELETE",status:{loading:"common.loading"},success:function(t){var i=$("#"+e),a=i.siblings();if(0===a.length){var s=i.parent()[0].id;$("#"+s).remove(),$("#"+s+"header").remove(),IntegrationUI.listView.populateEmptyResult(Integration.Modules.Schedulers,"schedulerslist")}i.slideUp(300,function(){$(this).remove(),IntegrationUI.hidePreview()}),Schedulers.deleteInStorage(t.data.id)}})},execute:function(e){$ZCAjx.ajax({url:"/v1/schedulers/"+e+"/executescheduler",type:"POST",status:{loading:"common.loading"},success:function(t){if(t&&t.data&&t.data.schedulers){var i=t.data.schedulers[0];if(1==t.data.status)UI.updateBanner(Resource.getRealValue("schedulers.executesuccess"),4e3,!1);else{var a=t.data.dreResponse&&t.data.dreResponse.lineNumber?Resource.getRealValue("commands.error.lineno",""+t.data.dreResponse.lineNumber):"",s=t.data.dreResponse&&t.data.dreResponse.errorMessage?t.data.dreResponse.errorMessage:"";UI.updateBanner(Resource.getRealValue("schedulers.executefailure",[i.name,s,a]),4e3,!0)}Schedulers.updateStorage(t.data.schedulers),SchedulersUI.populate(),$("#schprvlstrun").html($WC.$CUtil.isEmpty(i.letime)||"-1"==i.letime?"-":$Date.relative(parseInt(i.letime))),$("#schprvnxtrun").html($WC.$CUtil.isEmpty(i.netime)||"-1"==i.netime?"-":$Date.relativetimeleft(parseInt(i.netime)))}if(t.data.dreResponse){var n=Schedulers.getObject(e);IntegrationsResponse.showOAuthPrompt(n.name,t.data.dreResponse)}}})}};var PlatformDatabasesUI={},PlatformDatabases={},PlatformDatabasesUI={currentsearchval:"",clientindex:1,dragtimer:"",appViewHTML:'<div appbuttons purpose="toggleSelection" platformdatabaseid="{{PLATFORMDATABASEID}}" class="cur zcappintl zctext"><div class="zchlistimg mrgT3 floatl"><div title="Select" class="msi-hissel posa"></div><div class="msi-platfrmdb"></div></div><div class="dIB w70 mrgT5 mrgL10"><div title="{{NAME}}" class="ellips">{{NAME}}{{SANDBOXTEXT}}</div><div class="ellips mrgT5 clr8">{{DESC}}</div></div></div>',listViewHTML:'<div id="{{PLATFORMDATABASEID}}" platformdatabasebuttons platformdatabaseid="{{PLATFORMDATABASEID}}" purpose="preview" class="indivcom cur"><div class="zchlistimg mrgR10 floatl">{{DELETEHTML}}<div class="msi-platfrmdb"></div></div><div class="dIB mrgL10 w70"><div class="zchnsrclft"><div class="zchlsrctit dIB"><div class="zchlstcn floatl ellips">{{NAME}} &nbsp;</div><div class="dIB">{{CREATORHTML}}</div>{{EDITCODE}}{{VIEWDB}}</div></div>{{DESCHTML}}</div></div>',fieldHTML:'<div class="strlst-cont {{UNIQCLS}}" storagesdoubletab="editfield" field_name="{{NAME}}" type="{{TYPE}}" fid="{{COLUMN_INDEX}}" defaultvalue="{{DEFAULT_VALUE}}" isunique="{{ISUNIQUE}}" isfldrequired={{ISREQUIRED}} cliindex="{{CLIINDEX}}" isnewfield="{{ISNEWFLD}}"><div class="{{UICLASS}} font15">{{UITYPE}}</div><div class="fld-name">{{UITYPESTR}}</div><div class="str-data" id="dispname">{{DISPLAYNAME}}</div><div class="edt-icn"><em class="msi-edit mrgR20" platformdatabasebuttons purpose="previewField" title="'+Resource.getRealValue("storages.fields.edit.title")+'"></em><em class="msi-delete mrgR20" platformdatabasebuttons purpose="deleteField" title="'+Resource.getRealValue("storages.fields.delete.title")+'"></em></div></div></div>',editOverHTML:'<div class="edt-ovrlay"><div class="rhs-edtcont"><section class="rhs-edtbody"><div class="mrgT30"><span integlhsmenu entity="PlatformStorages"></span><div class="zcinhds font17 bold posl dIB zvta">{{PAGE_TITLE}}<span class="mrgL10 {{UICLASS}}"> {{UITYPE}} </span></div></div><div class="str-edtfld"><label for="name">'+Resource.getRealValue("storages.fields.title")+'</label><input type="text" id="display_name" maxlength="30" value="{{DISPLAYNAME}}"/></div><div class="str-edtfld"><label for="id" class="str-mantry">'+Resource.getRealValue("storages.fields.name")+'</label><input type="text" id="field_name" maxlength="30" value="{{FIELD_NAME}}"/></div><div class="str-edtfld"><label for="value">'+Resource.getRealValue("storages.fields.defaultval")+'</label><input type="text" id="default_value" maxlength="{{DEFMAXLEN}}" class="{{DEFNBCLS}}" value="{{DEFAULT_VALUE}}"/><div class="bolen-cont {{DEFBLCLS}}"><label class="msi-dwnarw bolen-optns" for="drop-down" id="bool_default_value">{{DEFAULT_VALUE}}</label><input type="text" id="drop-down"><ul class="bln-msgopt font13"><li class="{{TRUE_SELECTED}}" platformdatabasebuttons="bool" purpose="selectOption">TRUE</li><li class="{{FALSE_SELECTED}}" platformdatabasebuttons="bool" purpose="selectOption">FALSE</li></ul></div></div><div class="str-slctfld mrgT30"><div class="cus-chbox"><input type="checkbox" id="isfldrequired" {{ISREQUIRED}}><span class="msi-chbox"></span></div><label for="manitory" class="mrgL15 font15">'+Resource.getRealValue("storages.fields.required")+'</label></div><div class="str-slctfld mrgT20"><div class="cus-chbox"><input type="checkbox" id="isunique" {{ISUNIQUE}}><span class="msi-chbox"></span></div><label for="duplicate" class="mrgL15 font15">'+Resource.getRealValue("storages.fields.unique")+'</label></div></section><footer class="edt-submt"><div class="txtrgt"><span class="submt-opt sub-cncl" platformdatabasebuttons purpose="cancelFieldEdit">'+Resource.getRealValue("storages.fields.cancel")+'</span><span class="submt-opt" platformdatabasebuttons purpose="saveFieldEdit" id="storagesavefield" type="{{TYPE}}" fid="{{COLUMN_INDEX}}" cliindex="{{CLIINDEX}}">'+Resource.getRealValue("storages.fields.save")+"</span></div></footer></div></div>",STR_ADD_SCRIPT:'values_map = Map(); \n{{SETRECVAL}}response_map=zoho.cliq.createRecord("{{NAME}}", values_map); \n',STR_UPDATE_SCRIPT:'values_map = Map(); \n{{SETRECVAL}}// Set values for other fields if required \n{{QRYREC}}if(record_id.length() > 0){ \n	response_map=zoho.cliq.updateRecord("{{NAME}}", record_id, values_map); \n}',STR_GET_SCRIPT:'// To get record with the record id \nrecord_id="123456789"; \nresponse_map=zoho.cliq.getRecordById("{{NAME}}", record_id);',STR_LIST_SCRIPT:'query_map = Map(); \ncriteria_string="{{CRIVAR}}"; \nquery_map.put("criteria",criteria_string); \nresponse_map=zoho.cliq.getRecords("{{NAME}}", query_map); \nrecord_id=0; \nif(response_map.get("status").equalsIgnoreCase("SUCCESS") && response_map.get("list").size()>0){ \n	record_id=response_map.get("list").get(0).get("id"); \n} \n',STR_DELETE_SCRIPT:'{{QRYREC}}if(record_id.length() > 0){ \n	zoho.cliq.deleteRecord("{{NAME}}", record_id); \n} \n',getHTML:function(e,t){var i,a,s=PlatformDatabases.getObject(e),n=$WC.$CUtil.isEmpty(s.description)?"":'<div class="floatl clr6 mrgT5 mrgB5">{{DESC}}</div>',r=PlatformDatabases.hasDeletePermission(s.id)?'<div platformdatabasebuttons purpose="deleteplatformdatabase" platformdatabaseid="{{PLATFORMDATABASEID}}" title="'+Resource.getRealValue("common.delete")+'" class="msi-cmddel posa"></div>':"",o="",l="",c="",d=$WC.$CUtil.processXSS(s.display_name);return PlatformDatabases.isFromIntegration(e)?(i='<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">{{APPNAME}}</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span>",l=s.appdetails.name):PlatformDatabases.isFromSandBox(e)?(i='<span class="clr6">'+Resource.getRealValue("common.via")+' </span><span class="clr5 bold">{{APPNAME}}</span><span class="clr6"> '+Resource.getRealValue("app.app")+"</span> ("+Resource.getRealValue("app.sandbox")+")</span>",l=s.appdetails.name):i='<span class="clr6">'+Resource.getRealValue("group.created.by")+' </span><span elemtype="user" hover="true" uid="{{CREATOR}}" class="zctxthgh cur">{{CREATORNAME}}</span>',PlatformDatabases.isCreatedByMe(e)&&SecurityManager.hasPermission(Modules.PlatformStorages,MActions.Edit)&&(o='<div class="clr6 font14 dN zcinddics mrgL10 zvainh"><div platformdatabaseid="{{PLATFORMDATABASEID}}" platformdatabasebuttons purpose="editFields" class="zcclr cur dIB">'+Resource.getRealValue("platfrom.storage.editfields")+"</div></div>",$zcg._PLATFORMSTORAGEUI&&(c='<div class="clr6 font14 dN zcinddics mrgL10 zvainh" ><a href="/storages/{{DBNAME}}/records" target="_blank" platformdatabasebuttons purpose="viewdb" class="zcclr cur dIB">'+Resource.getRealValue("platfrom.storage.viewdb")+"</a></div>")),$WC.$CUtil.isEmpty(t)||(d=d.replace(new RegExp($WC.Matcher.replace("escaperegexp",t),"i"),"<b>$&</b>")),a=$WC.template.replace(PlatformDatabasesUI.listViewHTML,{NAME:d,DESCHTML:n,CREATORHTML:i,EDITCODE:o,VIEWDB:c,DELETEHTML:r},"InSecureHTML"),$WC.template.replace(a,{PLATFORMDATABASEID:s.id,DESC:s.description,APPNAME:l,CREATOR:s.creator,DBNAME:s.name,CREATORNAME:Users.getName(""+s.creator,"undefined"!=typeof s.creator_name?s.creator_name:"")})},show:function(e,t){e&&0==PlatformDatabases.getCount()?$("#IntegrationsRHS").html('<span list-view="true" class="zcldng"></span>'):this.populate(t),e&&PlatformDatabases.getAllFromServer()},bindEvents:function(){$(document).on("click","[platformdatabasebuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof PlatformDatabasesUI.handle[t]&&PlatformDatabasesUI.handle[t](this,e)}),$(document).on("keyup","[platformdatabasesinput]",function(e){PlatformDatabasesUI.populate(e)})},isFieldLimitReached:function(e){var t=($("#StoragesFieldsCreateUI"),$("#storagesfieldseditlistview")),i=t.find('[type="'+e+'"]').length,a=5,s=Resource.getRealValue("storages.fields."+e);return e==PlatformDatabases.TYPE_LIMITED_TEXT?a=PlatformDatabases.MAX_TEXT_FIELDS:e==PlatformDatabases.TYPE_NUMBER?a=PlatformDatabases.MAX_NUM_FIELDS:e==PlatformDatabases.TYPE_BOOLEAN&&(a=PlatformDatabases.MAX_BOOL_FIELDS),i>=a?(UI.updateBanner(Resource.getRealValue("platform.storage.fields.maxfields.reached",[s,a]),4e3,void 0,!0),!0):!1},handleFieldAddition:function(e,t){var i=$("#storagesfieldseditlistview");i.find("#emtydrgfld").hide();var a=PlatformDatabasesUI.fieldHTML,s=e.field_name,n=e.type,r=e.id||"",o=e.default_value||"",l="",c="chtr-fld",d=""+t,u=e.mandatory||"false",m=PlatformDatabasesUI.clientindex;return PlatformDatabasesUI.clientindex=PlatformDatabasesUI.clientindex+1,n==PlatformDatabases.TYPE_LIMITED_TEXT?(s=s||"",l=Resource.getRealValue("storages.fields.char.sc")):n==PlatformDatabases.TYPE_NUMBER?(s=s||"",l=Resource.getRealValue("storages.fields.number.sc")):n==PlatformDatabases.TYPE_BOOLEAN&&(s=s||"",l="",c="strge-togle"),a=$WC.template.replace(a,{NAME:s,DISPLAYNAME:e.display_name||s,TYPE:n,UITYPE:l,UICLASS:c,UITYPESTR:Resource.getRealValue("storages.fields."+n),COLUMN_INDEX:r,DEFAULT_VALUE:o,ISUNIQUE:d,CLIINDEX:m,UNIQCLS:"true"==d?"unic-fld":"",ISNEWFLD:"undefined"==typeof e.field_name?"true":"false",ISREQUIRED:u}),i.append(a),$(a)},handleFieldEdit:function(e){var t=PlatformDatabasesUI.editOverHTML,i=e.attr("type"),a=e.attr("fid"),s="",n=e.attr("defaultvalue"),r="dN",o="",l=PlatformDatabases.MAX_TEXT_LENGTH;i==PlatformDatabases.TYPE_LIMITED_TEXT?s=Resource.getRealValue("storages.fields.char.sc"):i==PlatformDatabases.TYPE_NUMBER?(s=Resource.getRealValue("storages.fields.number.sc"),l=PlatformDatabases.MAX_LONG_LENGTH):i==PlatformDatabases.TYPE_BOOLEAN&&(s="",r="",o="dN",n=n.length>0?n.toUpperCase():"FALSE"),t=$WC.template.replace(t,{FIELD_NAME:e.attr("field_name"),PAGE_TITLE:e.attr("field_name")||Resource.getRealValue("storages.fields.configure"),DISPLAYNAME:e.find("#dispname").text(),TYPE:i,UITYPE:s.length>0?"[ "+s+" ]":s,DEFAULT_VALUE:n,COLUMN_INDEX:a,ISUNIQUE:"true"==e.attr("isunique")?"checked":"",ISREQUIRED:"true"==e.attr("isfldrequired")?"checked":"",CLIINDEX:e.attr("cliindex"),DEFNBCLS:o,DEFBLCLS:r,DEFMAXLEN:l,TRUE_SELECTED:"TRUE"==n.toUpperCase()?"sel_status":"",FALSE_SELECTED:"FALSE"==n.toUpperCase()?"sel_status":""});$WC.$Win.create({id:"storagefieldeditwin","class":"str-edtovrlay",html:t,closebeforefn:function(e){var t=$("#"+e).find("#storagesavefield");PlatformDatabasesUI.handle.handleCloseBefore(t)}})},collapseLHS:function(){$("#integrationwin").hasClass("zcletmin")&&IntegrationUI.handle.toggleLHS()},populate:function(e){if(IntegrationUI.listView.isCurrent(Integration.Modules.PlatformStorages,e)){var t=PlatformDatabases.getCount();if(IntegrationUI.listView.initialize(Integration.Modules.PlatformStorages,t,SecurityManager.hasPermission(Modules.PlatformStorages,MActions.Create)),0===t)return;var i,a;("undefined"==typeof e||e.which!==$zcg.ESCAPE_KEYCODE)&&(a=$("#platformdatabasessearch").val()),$WC.$CUtil.isEmpty(a)?i=PlatformDatabases.getAllIds(!0):(a=a.trim().toLowerCase(),i=PlatformDatabases.search(a,100));for(var s="",n="",r="",o=0,l=i.length;l>o;o++){var c=i[o];PlatformDatabases.isCreatedByMe(c)?s+=this.getHTML(c,a):n+=this.getHTML(c,a)}i=[],$WC.$CUtil.isEmpty(s)||(s='<div id="myplatformdatabasesheader" zc_running_title class="zcinhds font15 bold paddT10 posl" >'+Resource.getRealValue("platformdatabases.mine")+'</div><div id="myplatformdatabases" class="zcinchls">'+s+"</div>"),$WC.$CUtil.isEmpty(n)||(n='<div id="allplatformdatabasesheader" zc_running_title class="zcinhds font15 bold paddT10 posl clrboth">'+Resource.getRealValue("platformdatabases.all")+'</div><div id="allplatformdatabases" class="zcinchls">'+n+"</div>"),r=s+n,IntegrationUI.listView.populate(Integration.Modules.PlatformStorages,"platformdatabaseslist",r,a,SecurityManager.hasPermission(Modules.PlatformStorages,MActions.Create))}},bindCreativeEvents:function(e){e.on("keyup","[platformdatabaseinputs]",function(e){("platformdatabasename"===this.id&&$(this).val().length>30||!$WC.Matcher.check("commandpattern",$(this).val()))&&($("#platformdatabasename").addClass("error"),e.stopPropagation())});var t=document.querySelector("#StoragesFieldsCreateUI");$(t).on("dblclick","[storagesdoubletab]",function(){var e=$(this);if("addfield"==e.attr("storagesdoubletab")){var t=$(this).attr("type");if(!PlatformDatabasesUI.isFieldLimitReached(t)){var i=PlatformDatabasesUI.handleFieldAddition({type:t});PlatformDatabasesUI.handleFieldEdit(i)}}else"editfield"==e.attr("storagesdoubletab")&&PlatformDatabasesUI.handleFieldEdit(e)}),$("#StoragesFieldsUIDragItems").on("dragstart",function(e){var t=$(e.target).attr("type"),i=document.createElement("img");i.src=PlatformDatabasesUI.getImgUrl("storage-"+t+".png"),e.originalEvent.dataTransfer.setDragImage(i,-10,-10),e.originalEvent.dataTransfer.setData("text/plain",t),e.stopPropagation()}),$("#storagesfieldseditlistview").on("dragenter dragleave dragover drop",function(e){e.preventDefault(),e.stopPropagation();var t=$("#StoragesFieldsCreateUI");if("drop"==e.type){var i=e.originalEvent;if(i.dataTransfer&&i.dataTransfer.items.length){var a=i.dataTransfer.getData("text");if(!$WC.$CUtil.isEmpty(a)&&!PlatformDatabasesUI.isFieldLimitReached(a)){var s=PlatformDatabasesUI.handleFieldAddition({type:a});PlatformDatabasesUI.handleFieldEdit(s)}}t.find("#strfieldropcontainer").hide()}else"dragover"==e.type?(clearTimeout(PlatformDatabasesUI.dragtimer),t.find("#strfieldropcontainer").css({display:"table",height:t.find("#storagesfieldseditlistview").outerHeight(),width:t.find("#storagesfieldseditlistview").outerWidth()})):"dragleave"==e.type&&(clearTimeout(PlatformDatabasesUI.dragtimer),PlatformDatabasesUI.dragtimer=setTimeout(function(){t.find("#strfieldropcontainer").hide()},75))})},validateAndGetParams:function(e,t){var i=$.trim(e.find("#platformdatabasename").val().toLowerCase());if($WC.$CUtil.isEmpty(i)||i.length>30||!$WC.Matcher.check("commandpattern",i))return e.find("#platformdatabasename").addClass("error"),void $Util.scrollToView(e.find("#platformdatabasenamepoint"),e,200);e.find("#platformdatabasename").val(i);var a=$.trim(e.find("#platformdatabasedispname").val());if($WC.$CUtil.isEmpty(a)||a.length>30||!$WC.Matcher.check("textpattern",a))return e.find("#platformdatabasedispname").addClass("error"),void $Util.scrollToView(e.find("#platformdatabasedispnamepoint"),e,200);var s=$.trim(e.find("#platformdatabasedesc").val());return $WC.$CUtil.isEmpty(s)&&!$WC.Matcher.check("textpattern",s)?(e.find("#platformdatabasedesc").addClass("error"),void $Util.scrollToViewportTop(e.find("#platformdatabasedesc"),e,200)):("undefined"!=typeof t&&(i=t.name!=i?i:void 0,s=t.description!=s?s:void 0,a=t.display_name!=a?a:void 0),"undefined"!=typeof i&&PlatformDatabases.isPlatformDatabaseAlreadyExist(i)?void UI.updateBanner(Resource.getRealValue("name.already.exist"),2e3,!0):$Util.checkAndRemoveUndefinedKeys({name:i,description:s,display_name:a}))},validateAndSaveField:function(e){var t=$("#StoragesFieldsCreateUI"),i=e.find("#storagesavefield"),a=i.attr("type"),s=(i.attr("fid"),e.find("#isunique").is(":checked")),n=i.attr("cliindex"),r=e.find("#isfldrequired").is(":checked"),o=$.trim(e.find("#field_name").val().toLowerCase());if($WC.$CUtil.isEmpty(o)||o.length>30||!$WC.Matcher.check("commandpattern",o))return e.find("#field_name").addClass("error"),void UI.updateBanner(Resource.getRealValue("storages.fields.name.tip"),3e3,!0);if(PlatformDatabases.RESERVED_FIELD_NAMES.indexOf(o)>=0)return void UI.updateBanner(Resource.getRealValue("storages.fields.name.reserved",o),3e3,!0);e.find("#field_name").removeClass("error");var l=$.trim(e.find("#display_name").val());if($WC.$CUtil.isEmpty(l)&&(l=o),l.length>30||!$WC.Matcher.check("textpattern",l))return void e.find("#display_name").addClass("error");e.find("#display_name").removeClass("error");var c=$.trim(e.find("#default_value").val());if(a==PlatformDatabases.TYPE_LIMITED_TEXT){if(c.length>PlatformDatabases.MAX_TEXT_LENGTH)return void e.find("#default_value").addClass("error")}else if(a==PlatformDatabases.TYPE_NUMBER){if(0==c.length||c.length>PlatformDatabases.MAX_LONG_LENGTH||!$WC.Matcher.check("qq",c))return UI.updateBanner(Resource.getRealValue("storages.fields.invalid.defvalue",o),4e3,!0),void e.find("#default_value").addClass("error")}else if(a==PlatformDatabases.TYPE_BOOLEAN&&"true"!=c.toLowerCase()&&"false"!=c.toLowerCase())return void e.find("#default_value").addClass("error");e.find("#default_value").removeClass("error");var d=t.find('[field_name="'+o+'"]');if(d.length>0&&d.attr("cliindex")!=n)return UI.updateBanner(Resource.getRealValue("name.already.exist"),3e3,!0),void e.find("#field_name").addClass("error");e.find("#field_name").removeClass("error");var u=t.find('[cliindex="'+n+'"]');u.attr({field_name:o,defaultvalue:c,isunique:1==s,isfldrequired:r,isnewfield:"false"}),u.find("#dispname").text(l),s?u.addClass("unic-fld"):u.removeClass("unic-fld"),this.handle.closeWindow(i)},validateAndGetFields:function(e,t){var i=$("#StoragesFieldsCreateUI"),a=i.find("#storagesfieldseditlistview"),s=a.children("[storagesdoubletab]"),n=[],r={},o=0,l=[],c=[],d=!1,u=!1;for(var m in e.fields){var p=e.fields[m];r[p.id]=p}for(var m in e.unique_keys){var h=e.unique_keys[m];1==h.length?n.push(h[0]):h.length>1&&(c.push(h),o++)}for(var g=c.length,m=0;m<s.length;m++){var f=$(s[m]),v=f.attr("field_name");if(t&&PlatformDatabases.RESERVED_FIELD_NAMES.indexOf(v)>=0)return void UI.updateBanner(Resource.getRealValue("storages.fields.name.reserved",v),3e3,!0);var C={field_name:v,type:f.attr("type"),display_name:f.find("#dispname").text(),default_value:f.attr("defaultvalue"),mandatory:f.attr("isfldrequired")},y=$.trim(f.attr("fid"));if(y.length>0){C.id=y;var b=r[y];u||b.field_name==C.field_name&&b.display_name==C.display_name&&b.default_value==C.default_value&&b.mandatory==C.mandatory||(u=!0)}else u=!0;l.push(C),"true"==f.attr("isunique")&&(-1==n.indexOf(v)&&(d=!0),c.push([v]))}var E={};if((u||l.length>0&&l.length!=$Util.getObjectKeysLength(r))&&(E.fields=l),d||n.length!=c.length-g){if(c.length>PlatformDatabases.MAX_UNIQUE_KEYS_LENGTH)return void(t?UI.updateBanner(Resource.getRealValue("storage.fields.max.uk.reached",PlatformDatabases.MAX_UNIQUE_KEYS_LENGTH),3e3,void 0,!0):"");E.unique_keys=c}return 0==E.length?void(t?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):""):E},populateFields:function(e){var t=[];for(var i in e.unique_keys){var a=e.unique_keys[i];1==a.length&&t.push(a[0])}var s=$("#storagesfieldseditlistview");s.find("[storagesdoubletab]").remove();var n=[];for(var i in e.fields){var r=[e.fields[i],e.fields[i].field_name];n.push(r)}n=$Util.sortString(n,1,!1);for(var o=0;o<n.length;o++){var l=n[o][0];PlatformDatabasesUI.handleFieldAddition(l,t.indexOf(l.field_name)>=0)}PlatformDatabasesUI.populateLimitOfFields()},populateLimitOfFields:function(){var e=$("#StoragesFieldsCreateUI"),t=$("#storagesfieldseditlistview"),i=PlatformDatabases.MAX_TEXT_FIELDS-t.find('[type="limited-text"]').length,a=PlatformDatabases.MAX_NUM_FIELDS-t.find('[type="number"]').length,s=PlatformDatabases.MAX_BOOL_FIELDS-t.find('[type="boolean"]').length;e.find("#strtxtlimitspn").text(i<PlatformDatabases.MAX_TEXT_FIELDS?i+"/"+PlatformDatabases.MAX_TEXT_FIELDS:"").attr("title",Resource.getRealValue("storages.fields.types.title",[i,PlatformDatabases.MAX_TEXT_FIELDS,Resource.getRealValue("storages.fields.limited-text")])),e.find("#strnumlimitspn").text(a<PlatformDatabases.MAX_NUM_FIELDS?a+"/"+PlatformDatabases.MAX_NUM_FIELDS:"").attr("title",Resource.getRealValue("storages.fields.types.title",[a,PlatformDatabases.MAX_NUM_FIELDS,Resource.getRealValue("storages.fields.number")])),e.find("#strboollimitspn").text(s<PlatformDatabases.MAX_BOOL_FIELDS?s+"/"+PlatformDatabases.MAX_BOOL_FIELDS:"").attr("title",Resource.getRealValue("storages.fields.types.title",[s,PlatformDatabases.MAX_BOOL_FIELDS,Resource.getRealValue("storages.fields.boolean")]))},handle:{create:function(){var e=PlatformDatabasesUI.validateAndGetParams($("#platformdatabasecreateui"));$WC.$CUtil.isEmpty(e)||PlatformDatabases.create(e)},select:function(e){var t=$(e);t.hasClass("zcbtnbgclr")?t.removeClass("zcbtnbgclr"):t.addClass("zcbtnbgclr")},updatePlatformDatabasesDeatils:function(e,t){if(void 0!=t&&!$.isEmptyObject(t)){e.find("#platformdatabasename").val($WC.$CUtil.processXSS(t.name)),e.find("#platformdatabasedispname").val($WC.$CUtil.processXSS(t.display_name));var i=t.description;$WC.$CUtil.isEmpty(i)||e.find("#platformdatabasedesc").val($WC.$CUtil.processXSS(i))}},getaddui:function(e,t,i){var a=Template.PlatformDatabasesCreateUI,s=$("<div>");s.html(a),PlatformDatabasesUI.handle.updatePlatformDatabasesDeatils(s,i),$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this);e.html(s.children()).fadeIn(300,function(){e.find("#platformdatabasename").focus()}),PlatformDatabasesUI.bindCreativeEvents(e.find("#platformdatabasecreateui"))})},saveEdit:function(e){var t=$(e).attr("platformdatabaseid"),i=PlatformDatabasesUI.validateAndGetParams($("#platformdatabasecreateui"),PlatformDatabases.getObject(t));$WC.$CUtil.isEmptyObject(i)?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):PlatformDatabases.edit(t,i)},editConfig:function(e){var t=$(e).attr("platformdatabaseid"),i=PlatformDatabases.getObject(t);Clickoutside.clear("Integrationspreviewcontainer");var a=Template.PlatformDatabasesCreateUI,s=$("<div>");s.html(a),s.find("#platformdatabasecreateheadertip").html(Resource.getRealValue("platformdatabases.edit")),s.find("#platformdatabasecreateui_action").attr("purpose","saveEdit").removeClass("msi-rhtarw").html(Resource.getRealValue("common.save")).attr("platformdatabaseid",t),PlatformDatabasesUI.handle.updatePlatformDatabasesDeatils(s,i),$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this);e.html(s.children()).fadeIn(300,function(){e.find("#platformdatabasename").focus()}),PlatformDatabasesUI.bindCreativeEvents(e.find("#platformdatabasecreateui"))})},editFields:function(e,t,i){PlatformDatabasesUI.clientindex=1;var a=i||$(e).attr("platformdatabaseid"),s=PlatformDatabases.getObject(a);Clickoutside.clear("Integrationspreviewcontainer");var n=Template.PlatformDatabaseFieldsUI;n=$WC.template.replace(n,{NAME:s.display_name,DRGIMGURL:PlatformDatabasesUI.getImgUrl("storage-drag.svg"),DRGURLTEXT:PlatformDatabasesUI.getImgUrl("storage-limited-text.png"),DRGURLNUM:PlatformDatabasesUI.getImgUrl("storage-number.png"),DRGURLBOOL:PlatformDatabasesUI.getImgUrl("storage-boolean.png")});var r=$("<div>");r.html(n),r.find("#platformdatabasecreateheadertip").html(Resource.getRealValue("platformdatabases.edit")),r.find("#storagesecreateui_fields").attr("purpose","saveFields").removeClass("msi-rhtarw").attr("platformdatabaseid",a),$("#IntegrationsRHS").fadeOut(300,function(){var e=$(this);e.html(r.children()).fadeIn(300,function(){e.find("#platformdatabasename").focus()}),PlatformDatabasesUI.bindCreativeEvents(e.find("#platformdatabasecreateui")),PlatformDatabasesUI.populateFields(s)})},saveFields:function(e){var t=$(e).attr("platformdatabaseid"),i=PlatformDatabasesUI.validateAndGetFields(PlatformDatabases.getObject(t),!0);$WC.$CUtil.isEmptyObject(i)?UI.updateBanner(Resource.getRealValue("integration.nochanges"),3e3,void 0,!0):PlatformDatabases.edit(t,i,!0)},previewField:function(e){var t=$(e).parents("[defaultvalue]");PlatformDatabasesUI.handleFieldEdit(t)},deleteField:function(e){var t=$(e).parents("[defaultvalue]"),i=$("#StoragesFieldsCreateUI");$WC.$CUtil.isEmpty(t.attr("fid"))?(t.remove(),0==i.find("[cliindex]").length&&i.find("#emtydrgfld").show(),PlatformDatabasesUI.populateLimitOfFields()):$WC.$Dlg.confirm({id:"deleteplatformdatabasefields",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("storages.fields.confirm.delete.info1"),Resource.getRealValue("storages.fields.confirm.delete.info2")],infoheader:Resource.getRealValue("integ.delete.info")}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-platfrmdb"></div>',header:Resource.getRealValue("storages.fields.confirm.delete",[$WC.$CUtil.processXSS(t.find("#dispname").text())])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){t.remove(),0==i.find("[cliindex]").length&&i.find("#emtydrgfld").show(),PlatformDatabasesUI.populateLimitOfFields()}}]})},saveFieldEdit:function(){var e=$("#storagefieldeditwin");PlatformDatabasesUI.validateAndSaveField(e)},cancelFieldEdit:function(e){this.handleCloseBefore(e),this.escape()},selectOption:function(e){var t=$(e);if("bool"==t.attr("platformdatabasebuttons")){var i=$("#storagefieldeditwin");$(i.find("#bool_default_value")).text(t.text()),$(i.find("#default_value")).val(t.text()),t.parent().find(".sel_status").removeClass("sel_status"),t.addClass("sel_status")}},handleCloseBefore:function(e){var t=$("#StoragesFieldsCreateUI");if(e){var i=$(e).parent().find("[cliindex]"),a=i.attr("cliindex"),s=t.find('[cliindex="'+a+'"]');"true"==s.attr("isnewfield")&&s.remove()}0==t.find("[cliindex]").length&&t.find("#emtydrgfld").show(),PlatformDatabasesUI.populateLimitOfFields()},closeWindow:function(){PlatformDatabasesUI.populateLimitOfFields(),$WC.$Win.destroy("storagefieldeditwin")},escape:function(){return $WC.$Win.isExist("storagefieldeditwin")&&0===$("#storagefieldeditwin").next().length?(this.closeWindow(),!0):void 0},preview:function(e,t){var i=$(e).attr("platformdatabaseid");if(!("user"===$(t.target).attr("elemtype")||IntegrationUI.hasPrevWin&&i===$("#Integrationspreview").attr("platformdatabaseid"))){var a,s=PlatformDatabases.getObject(i),n="",r=s.fields.length>0&&PlatformDatabases.isCreatedByMe(i);PlatformDatabases.isCreatedByMe(i)&&SecurityManager.hasPermission(Modules.PlatformStorages,MActions.Edit)&&(n='<div platformdatabasebuttons purpose="editConfig" platformdatabaseid="{{PLATFORMDATABASEID}}" class="dbtn adbtn floatr mrgL20">'+Resource.getRealValue("commands.editconfig")+"</div>"),a=$WC.template.replace(Template.PlatformDatabasePreview,{EDITBUTTONS:n},"InSecureHTML"),a=$WC.template.replace(a,{NAME:s.name,DESC:$WC.$CUtil.isEmpty(s.description)?"":s.description,PLATFORMDATABASEID:i,SCRPTCLS:r?"":"dN"}),IntegrationUI.preview("platformdatabaseid",i,a,t,function(){r&&PlatformDatabasesUI.renderSampleScripts(s)})}},deleteplatformdatabase:function(e){var t=e.getAttribute("platformdatabaseid"),i=PlatformDatabases.getObject(t).display_name;$WC.$Dlg.confirm({id:"deleteplatformdatabases",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("platformdatabase.confirm.delete.info1"),Resource.getRealValue("platformdatabase.confirm.delete.info2")],infoheader:Resource.getRealValue("integ.delete.info")}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-platfrmdb"></div>',header:Resource.getRealValue("platformdatabase.confirm.delete",[$WC.$CUtil.processXSS(i)])}),buttons:[{text:Resource.getRealValue("dialog.delete.confirm"),colour:$WC.$Dlg.RED_BUTTON,action:function(){PlatformDatabases.deleteplatformdatabase(t)}}]})}},getImgUrl:function(e){return $zcg._IMGDEFAULTSTATICURL+"/"+e},renderSampleScripts:function(e){var t="",i='values_map.put("{{FLDNAME}}", "{{FLDVAL}}"); \n',a="",s="";for(var n in e.fields){var r=e.fields[n],o="";r.type==PlatformDatabases.TYPE_LIMITED_TEXT?o="ABC":r.type==PlatformDatabases.TYPE_NUMBER?o="123":r.type==PlatformDatabases.TYPE_BOOLEAN&&(o="TRUE"),t+=$WC.template.replace(i,{FLDNAME:r.field_name,FLDVAL:o}),0==a.length&&(a=t),0==s.length&&(s=r.field_name+"=="+o)}var l=$WC.template.replace(PlatformDatabasesUI.STR_ADD_SCRIPT,{NAME:e.name,SETRECVAL:t},"InSecureHTML"),c=$WC.template.replace(PlatformDatabasesUI.STR_GET_SCRIPT,{NAME:e.name}),d=$WC.template.replace(PlatformDatabasesUI.STR_LIST_SCRIPT,{NAME:e.name,CRIVAR:s}),u=$WC.template.replace(PlatformDatabasesUI.STR_UPDATE_SCRIPT,{NAME:e.name,SETRECVAL:a,QRYREC:d},"InSecureHTML"),m=$WC.template.replace(PlatformDatabasesUI.STR_DELETE_SCRIPT,{NAME:e.name,QRYREC:d},"InSecureHTML");DREImpl.renderScript(l,$("#storageaddpreviewcode"),$("#platformdatabasepreviewcont")),DREImpl.renderScript(d,$("#storagelistpreviewcode"),$("#platformdatabasepreviewcont")),DREImpl.renderScript(c,$("#storagegetpreviewcode"),$("#platformdatabasepreviewcont")),DREImpl.renderScript(u,$("#storageupdatepreviewcode"),$("#platformdatabasepreviewcont")),DREImpl.renderScript(m,$("#storagedeletepreviewcode"),$("#platformdatabasepreviewcont"))},reset:function(){IntegrationsCwin.close()}};PlatformDatabases={TYPE_LIMITED_TEXT:"limited-text",TYPE_NUMBER:"number",TYPE_BOOLEAN:"boolean",MAX_TEXT_LENGTH:100,MAX_LONG_LENGTH:19,MAX_UNIQUE_KEYS_LENGTH:4,MAX_TEXT_FIELDS:5,MAX_NUM_FIELDS:5,MAX_BOOL_FIELDS:5,RESERVED_FIELD_NAMES:["id"],init:function(){PlatformDatabasesUI.bindEvents()},getObject:function(e){return $DB.get("platformdatabases")[e]},getAll:function(){return $DB.get("platformdatabases")},isExist:function(e){return this.getAll().hasOwnProperty(e)},getCount:function(){return Object.keys(this.getAll()||{}).length},getAppPlatformDatabaseIds:function(e){var t=this.getAll(),i=[];for(var a in t){var s=t[a];s.appid==e&&i.push(a)}return i},isPlatformDatabaseAlreadyExist:function(e){var t=this.getAll();for(var i in t){var a=t[i];if(a.name===e&&WmsImpl.isLocalUser(a.creator))return!0}return!1},getAllIds:function(e){var t=this.getAll();if(e){var i=[];for(var a in t){var s=[a,t[a].display_name];i.push(s)}i=$Util.sortString(i,1,!1);for(var n=[],r=0;r<i.length;r++)n.push(i[r][0]);return n}return Object.keys(t)},updateStorage:function(e){for(var t=$DB.get("platformdatabases")||{},i=function(e,t){for(var i in t)e[i]=t[i];return e},a=0,s=e.length;s>a;a++){var n=e[a],r=n.id;t[r]=t[r]||{},t[r]=i(t[r],n)}$DB.update("platformdatabases",t)},isCreatedByMe:function(e){var t=this.getObject(e);return $WC.$CUtil.isEmpty(t)?void 0:$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator):t.appdetails.issandbox&&WmsImpl.isLocalUser(""+t.appdetails.developer)},hasDeletePermission:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t)&&$WC.$CUtil.isEmpty(t.appid)?WmsImpl.isLocalUser(""+t.creator)||_isAppAccountAdmin()&&SecurityManager.hasPermission(Modules.PlatformStorages,MActions.Delete):!1},isFromIntegration:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&!t.appdetails.issandbox},isFromSandBox:function(e){var t=this.getObject(e);return!$WC.$CUtil.isEmpty(t.appid)&&t.appdetails.issandbox},deleteInStorage:function(e){var t=$DB.get("platformdatabases");delete t[e]},deleteAppEntities:function(e){for(var t=this.getAppPlatformDatabaseIds(e),i=0;i<t.length;i++)this.deleteInStorage(t[i])},getAllFromServer:function(){SecurityManager.hasPermission(Modules.PlatformStorages)&&$ZCAjx.ajax({url:"/v2/storages",data:{getchecksum:!0},success:function(e){PlatformDatabases.removeDeletedInObj(e.list),PlatformDatabases.getModifiedDatabases(e.list),PlatformDatabasesUI.populate()},error:function(e){UI.updateBanner(e.message,2e3,!0)}})},getModifiedDatabases:function(e){var t=this.getAll()||{},i=[];for(var a in e)("undefined"==typeof t[a]||t[a].detailschecksum!=e[a])&&i.push(a);i.length>0?$ZCAjx.ajax({url:"/v2/storages",data:{storageids:i.join(",")},success:function(e){PlatformDatabases.updateStorage(e.list),PlatformDatabasesUI.populate()}}):"undefined"==typeof this.getAll()&&PlatformDatabases.updateStorage({})},removeDeletedInObj:function(e){var t=$DB.get("platformdatabases")||{};for(var i in t)"undefined"==typeof e[i]&&i>=0&&delete t[i]},create:function(e){$ZCAjx.ajax({url:"/v2/storages",type:"POST",contentType:"application/json",data:e,status:{loading:$("#platformdatabasecreateui_action")},success:function(e){PlatformDatabases.updateStorage([e.object]),PlatformDatabasesUI.handle.editFields(void 0,void 0,e.object.id),UI.updateBanner(Resource.getRealValue("platformdatabases.createdsuccess",[e.object.name]),3e3,!1)},error:function(e){UI.updateBanner(e.message,2e3,!0)}})},edit:function(e,t,i){$ZCAjx.ajax({url:"/v2/storages/"+e,type:"PUT",contentType:"application/json",data:t,status:{loading:$("#IntegrationsRHS").find('[purpose="'+(i?"saveFields":"saveEdit")+'"]')},success:function(e){PlatformDatabases.updateStorage([e.object]),PlatformDatabasesUI.populateFields(PlatformDatabases.getObject(e.object.id));var i="undefined"!=typeof t&&t.fields?Resource.getRealValue("platformdatabases.field.editedsuccess"):Resource.getRealValue("platformdatabases.editedsuccess",[e.object.name]);UI.updateBanner(i,3e3,!1)},error:function(e){UI.updateBanner(e.message,2e3,!0)}})},search:function(e){e=e.toLowerCase();var t=this.getAll(),i=[],a=[];for(var s in t){var n=t[s],r=n.display_name.toLowerCase(),o=r.indexOf(e);-1!=o&&(0===o?i.push(n.id):o>0&&a.push(n.id))}return i.concat(a)},deleteplatformdatabase:function(e){$ZCAjx.ajax({url:"/v2/storages/"+e,type:"DELETE",status:{loading:"common.loading"},success:function(){var t=$("#"+e),i=t.siblings();if(0===i.length){var a=t.parent()[0].id;$("#"+a).remove(),$("#"+a+"header").remove(),IntegrationUI.listView.populateEmptyResult(Integration.Modules.PlatformStorages,"platformdatabaseslist")}t.slideUp(300,function(){$(this).remove(),IntegrationUI.hidePreview()}),PlatformDatabases.deleteInStorage(e)},error:function(e){UI.updateBanner(e.message,2e3,!0)}})}};var ChatUI={},Chat={},ChatsList={},ChatNotify={};ChatUI={exist:{},userchatmap:{},groupchatmap:{},statuspredictinterval:3e3,participantwithnamecount:10,permissions:{},display_delaytimer:null,typingStatusTimer:{},cachedImages:{},udsdownloadfailurls:[],attachpendingchats:[],init:function(){this.permissions={1:{fileshare:!0,guest:!0,audio:!0,video:!0,history:!0,fileforward:!0},8:{fileshare:!0,guest:!1,audio:!1,video:!1,history:!1,fileforward:!0,edittitle:!1},9:{fileshare:!0,guest:!1,audio:!1,video:!1,history:!1,fileforward:!0,edittitle:!1,invitemember:!1,deletemember:!1,mute:!0},10:{fileshare:!0,guest:!1,audio:!0,video:!0,history:!0,fileforward:!0,edittitle:!1,invitemember:!1,deletemember:!1},3:{fileshare:!0,guest:!0,audio:!1,video:!1,history:!0,fileforward:!0},4:{fileshare:!0,guest:!0,audio:!1,video:!1,history:!0,fileforward:!0},5:{fileshare:!0,guest:!0,audio:!1,video:!1,history:!0,fileforward:!0},6:{fileshare:!1,guest:!0,audio:!1,video:!1,history:!0,fileforward:!0},0:{fileshare:!1,guest:!1,audio:!1,video:!1,history:!0,fileforward:!1},2:{fileshare:!0,guest:!1,audio:!1,video:!1,history:!1,fileforward:!0,edittitle:!1,invitemember:!1,deletemember:!1,mute:!1}}},isSystemChat:function(e){return this.isExist(e)?this.exist[e].isSystemChat():$DB.isEmpty("bot")?void 0:$DB.get("bot").chid===e},isChannel:function(e){return parseInt(e)===$zcg.ORGCHANNEL},getPermissions:function(e){return this.permissions[e]},getWin:function(e){return this.exist[e]},isExist:function(e){return this.exist.hasOwnProperty(e)},isCurrent:function(e){return MainUI.current===e},getMsgArea:function(e){this.isExist(e)&&ChatUI.exist[e].win().find("#msgarea")},hasPermission:function(e,t){return this.isExist(e)?this.exist[e].getPermission()[t]:!1},getCType:function(e){return this.exist[e].ctype},getTitle:function(e){return this.isExist(e)?$WC.$CUtil.processXSS(this.exist[e].title):""},isParticipantExist:function(e,t){return Participants.get(e).isParticipantExist(t)},getParticipantName:function(e,t){return this.isExist(e)?Users.getName(t):""},getParticipantStatus:function(e,t){return Contacts.isExist(t)?Contacts.get(t).status:Contacts.statuscodes.ADD_TO_CONTACTS},isAttachPending:function(e){return-1!=ChatUI.attachpendingchats.indexOf(e)},removefromAttachPendingList:function(e){ChatUI.isAttachPending(e)&&ChatUI.attachpendingchats.splice($.inArray(e,ChatUI.attachpendingchats),1)},create:function(e){function t(e){return $WC.$CUtil.isEmpty(e)||$.isEmptyObject(e)?!1:$Util.getObjectKeysLength(e)<=4?!1:!0}function i(e,t){var i=e.update(t);if(e.isChannel()&&ChannelsUI.List.LHS.add(n,t,!0),ChatsList.updateChatData(n,i,e.createdbyme),"chat"!==t.createfrom){var a=t.mutedinterval?1:0;"undefined"==typeof t.mutedinterval&&(a=t.m?parseInt(t.m):0),ChatUI.updateMuteStatus(n,a,t.mutedinterval,e.createdbyme)}}function a(e,t){var a=t.chid,s=e.win().find("#msgarea");if(i(e,t),e.composerheight=$("#composer"+a).height(),ChatUI.showHistoryStatusinChatTranscript(a),e.isNewChat(t))e.updateEmptyStateStatus(!0),e.addChatInformation();else{e.updateLoading(""===s.html());var n="undefined"!=typeof t.time?t.time-1:void 0;0===parseInt(t.history)&&(n=$Util.getSyncedCurrentTime()),Chat.getTranscriptFromRServer(a,!0,void 0,n,function(e,t,i,a,s){var n={chid:e,transcript:t,fromtime:i,totime:a,partial:s,unreadtime:-1};Chat.handleFetchTranscript(n);var r=ChatUI.exist[e];MainUI.isChatinViewport(e)&&0===r.win().find("#chatbody").scrollTop()&&r.loadVisibleImages()},Chat.LINESLIMIT)}e.isOrgGroupChannel()&&Groups.getMembers(e.orggroups),MMChat.handleCWinCreated(e),$ZCVideoBroadcast.handleCWinCreated(e),Conference.handleChatWindowCreated(e),ZCScroll.customScroll($("#chatbody")),UIDataPersist.handleWindowCreate(a),e.isOnetoOneChat()&&Tour.isNewTourAvailable("one2onechat")&&Tour.show("one2onechat",a,!0),e.isGroupChat()&&Tour.isNewTourAvailable("adhocchat")&&Tour.show("adhocchat",a,!0),e.isChannel()&&Tour.isNewTourAvailable("channels")&&Tour.show("channels",a,!0)}var s,n=e.chid,r=t(e);if(Participants.updateParticipantsObj(n,e.recipants,e.pcount),this.isExist(n)){if(s=this.exist[n],!r)return;s.isreadyforfetching?i(s,e):(s.isreadyforfetching=!0,a(s,e)),s.updateUI(),MainUI.getMefront(n,"chat"===e.createfrom),ZCScroll.resetScroll($("#chatwindows #"+n+" #chatbody"))}else{this.exist[n]=new $Cwin(n);var o=new $CliqChatId(n);s=this.exist[n],s.createdbyme="undefined"==typeof e.mtype;var l="chat"===e.createfrom||"true"===e.btf?!0:"false"===e.autojoin,c=Template.MarkDownDescription.replace(/{HELPTEXT}/,ChatUI.exist[n].randomhelptip),d=$WC.template.replace(Template.ChatWindow,{HELPTIPHTML:o.isCustomBot?c:'<span class="hst-loadng"></span>',CHID:n,CHN_LCK:o.isChannel()&&Channels.islockNeeded(o)?$WC.template.replace('<em title="{{title}}" class="msi-chnlck"></em>',{$title:"channel.lock.tip"}):"",CHN_TYPE_ICON:o.isChannel()&&Channels.isMultiTeamChannel(Channels.getByChid(n))?$WC.template.replace('<em title="{{title}}" class="msi-multiteamchannel"></em>',{$title:"channel.multiteam.icon.tip"}):"",VIDEO_CHAT_HTML:MMChat.isAudioVideoCallEnabled()?MMChatUI.getVideoChatHTML(!0):""},"InSecureHTML");MainUI.addChatInView(d,n,l,e.mutedinterval||e.m?!0:!1),r?s.update(e):(s.isreadyforfetching=!1,s.title=e.title,s.updateLoading(!0)),s.bindEvents(),s.updateUI(),MainUI.getMefront(n,l,!0),r&&a(s,e)}_isDesktopApp()&&DesktopApp.enableMenu(["close-chat"])},isUndeliveredMsg:function(e){return this.checkOrReplaceUndeliveredMsg(e)},updateMsgDeliverance:function(e){this.isExist(e.chid)&&(this.getWin(e.chid).lastmsgtime=parseInt(e.time),this.getWin(e.chid).unreadtime=parseInt(e.time)+1),this.checkOrReplaceUndeliveredMsg(e,!0)},checkOrReplaceUndeliveredMsg:function(e,t){var i=MsgUtil.getMsgObjVersion(e);"v0"==i&&(e=$WC.CMsgUtil.convertMsgObj(e));var a=$("#"+e.chid).find("#msgarea").children(),s=a.filter('[msgid="'+e.ack+'"][mymsg="true"]');if(s.length){if(t){var n=a.index(s);"undefined"!=typeof a[n-2]&&"date"===a[n-2].getAttribute("purpose")&&a[n-2].setAttribute("msgtime",e.time);{var r=ChatUI.exist[e.chid];r.scrolldown}s.replaceWith(MsgTemplate.getMsgContent(e,{})),r.getScrollDown()}return!0}return!1},removeWindow:function(e){if(ChatNotify.clear(),Chat.pauseMedia(e,"chatbody"),this.isExist(e)){{ChatUI.exist[e]}MainUI.close(e),MMChat.handleChatWindowClosed(e),$ZCVideoBroadcast.handleChatWindowClosed(e),Conference.handleChatWindowClosed(e),$WC.CustomMsg.removeMsgObj(e)}},retainWindowOnDelete:function(e,t){if(this.isExist(e)){var i=this.exist[e];i.disableComposer(e,t,!0)}},hasUnreadOrUnseenMsgs:function(e){return this.getUnreadOrUnseenMsgCount(e)>0},getUnreadOrUnseenMsgCount:function(e){var t=0;if(this.isExist(e)&&(t=ChatUI.exist[e].unreadmsgcount),0==t){var i=ChatsList.get(e);!$.isEmptyObject(ChatsList.unreadchatarr)&&ChatsList.unreadchatarr.hasOwnProperty(e)&&(t=i&&i.unreadmsgs?i.unreadmsgs:ChatsList.UNREAD_MSG_COUNT_FOR_UNREAD_CHAT)}return t},getUnreadMsgTime:function(e){var t=-1;return this.isExist(e)&&(t=ChatUI.exist[e].unreadtime),-1==t&&!$.isEmptyObject(ChatsList.unreadchatarr)&&ChatsList.unreadchatarr.hasOwnProperty(e)&&(t=ChatsList.unreadchatarr[e]),t},doChangesBeforeHide:function(e){if(this.isExist(e)){var t=ChatUI.exist[e];t.retainScrollPosition(),t.removeNewmsgNotification(),t.win().find("#helptip").css("visibility","hidden")}},doChangesAfterVisible:function(e){if(this.isExist(e)){var t=this.exist[e],i=Chat.isChannelChid(e);if(t.retainScrollPosition(),t.unreadmsgcount>0&&(t.getScrollDown(),t.updateScrollClass(t.scrolltop)),t.fetchTranscriptOnReconnection(),MainUI.isCurrent(e)){t.focus();var a=new $CliqChatId(e);a.isCustomBot()&&MyBots.populateActions(e)}ChatUI.isExist(e)&&0===ChatUI.getWin(e).win().find("#chatbody").scrollTop()&&ChatUI.getWin(e).loadVisibleImages();var s=$("#tabscode"+e).attr("typing");if(null==s||""==s||WmsImpl.isLocalUser(s)?ChatUI.updateTypingStatus(e,""):ChatUI.updateTypingStatus(e,"chat.is.typing",s,Users.getName(s,$("#tabscode"+e).attr("nname")),!0),i){var n=Channels.getByChid(e);!ChannelsPermission.hasPermission(Channels.ACTIONS.SEND_MESSAGE,n)&&Channels.isJoined(n)&&t.disableComposer(t.chid,Resource.getRealValue("channel.sendmessage.notallowed.message"))}ChatUI.isAttachPending(e)||Participants.get(e).hasAllParticipants()||Chat.getParticipants(e,!0)}},retainScrollPosition:function(e){for(var t=0,i=e.length;i>t;t++){var a=e[t];this.isExist(a)&&ChatUI.exist[a].retainScrollPosition()}},flicker:function(e){this.isExist(e)&&this.exist[e].flicker()},displayMsg:function(e,t){if(!t&&Mentions.isMine(e)){var i=Mentions.addLiveMentionMsg($Util.cloneObject(e,!0));e.mentionmsgid=i}if(MsgUtil.isMsgContainsDelayProp(e)){var a=parseInt(e.config.d);clearTimeout(this.display_delaytimer),this.display_delaytimer=setTimeout(function(){ChatUI.updateWmsServerLastMsgTime(e.chid,parseInt(e.time)),ChatUI.exist[e.chid].updateMsg(e)},a)}else ChatUI.updateWmsServerLastMsgTime(e.chid,parseInt(e.time)),ChatUI.isExist(e.chid)&&this.exist[e.chid].updateMsg(e)},handleMyMsg:function(e){var t=this.exist[e.chid];MsgUtil.isMentionMsg(e.msg)?t.showInviteMemberPromptbanner():t.clearSuggestToadd([])},removeNewmsgNotification:function(e,t){var i=this.exist[e];"undefined"==typeof i?ChatsList.removeBubble(e):i.removeNewmsgNotification(t),_isDesktopApp()&&DesktopApp.handleChatRead(e),ChatsList.deleteFromUnreadChatArr(e),ChatsList.showUnreadChatsView(!0,e)},updateGuestData:function(e,t){if(this.isExist(e.chid)){var i=this.exist[e.chid];"url"===t?i.updateGuestUrl(e.msg):"option"===t&&i.updateGuestOption(e.guest)}},focus:function(e){this.exist[e].focus()},updateTypingStatus:function(e,t,i,a,s){clearTimeout(ChatUI.typingStatusTimer[e]),$WC.$CUtil.isEmpty(t)?(this.updateStatusMsg(e,t),ChatsList.updateTypingStatus(e,!1)):(this.updateStatusMsg(e,Resource.getRealValue(t,[Users.getName(i,a)])),ChatsList.updateTypingStatus(e,s,i,a),ChatUI.typingStatusTimer[e]=setTimeout(function(){ChatUI.updateTypingStatus(e,"")},15e3))},updateStatusMsg:function(e,t){this.isExist(e)&&this.exist[e].updateStatusMsg(t)},updateBulkParticipantStatusInUI:function(e){for(var t in e)this.updateParticipantStatusInUI(t)},updateParticipantStatusInUI:function(e){if(this.userchatmap.hasOwnProperty(e)){var t=this.userchatmap[e],i=t.length;if(i)for(var a=(Contacts.get(e),0);i>a;a++)this.isExist(t[a])&&Participants.get(t[a]).updateParticipantsInUI(e);ChatsList.updateBulkPresence(e,"contact")}else{var s=LeftPannel.container.find("[profileid='"+e+"']");if(s.length<0)return;var n=s.attr("chid"),r=ChatUI.exist[n];if(r){ChatUI.addToUserChatmap(e,n);var o=Participants.get(n);o.pcount=o.pcount?o.pcount:2,-1!=o.recipants.indexOf(e)&&o.recipants.push(e),Participants.get(n).updateParticipantsInUI(e)}ChatsList.updatePresence(s,e,"contact")}},addToUserChatmap:function(e,t){this.userchatmap[e]=this.userchatmap[e]||[],-1===$.inArray(t,this.userchatmap[e])&&this.userchatmap[e].push(t)},removeFromUserChatmap:function(e,t){this.userchatmap.hasOwnProperty(e)&&(this.userchatmap[e].removeElement(t),0===this.userchatmap[e].length&&delete this.userchatmap[e])},addToGroupChatMap:function(e,t){this.groupchatmap[e]=this.groupchatmap[e]||[],-1===$.inArray(t,this.groupchatmap[e])&&this.groupchatmap[e].push(t)},getMappedChidforGroup:function(e){return this.groupchatmap.hasOwnProperty(e)?this.groupchatmap[e].join(","):""},"delete":function(e){for(var t=Participants.get(e).recipants,i=0;i<t.length;i++)this.removeFromUserChatmap(t[i],e);$WC.DivEditor.clearObj("composer"+e),delete this.exist[e]},showHistoryStatusinChatTranscript:function(e){var t=ChatUI.exist[e];if(0===t.history){var i={chid:e,history:t.history},a={ignoretime:!0},s=this.formatasHistoryObj(i);s.info.msg="history.storage.info",t.updateinChatTranscript(s,a),t.getScrollDown()}},formatasHistoryObj:function(e){e.msg=0===parseInt(e.history)?"history.storage.disabled":"history.storage.enabled",e.mode="ZC CUSTOM MESSAGE";var t={info:e,mtype:"16",chid:e.chid,time:$Util.getSyncedCurrentTime(),version:"v1"};return t},enableDisableHistory:function(e){var t=ChatUI.exist[e.chid];t.history=parseInt(e.history);var i=this.formatasHistoryObj(e),a={ignoretime:!0};t.updateMsg(i,a),t.updateAdditionalOptionsUI()},updateTitle:function(e){ChatUI.exist[e.chid].updateTitle(e.msg.title)},handleReconnection:function(){function e(e,t){setTimeout(function(){ChatUI.isExist(e)&&ChatUI.exist[e].fetchTranscriptOnReconnection()},t)}var t=MainUI.getVisibleChats(),i=t.length,a=500;for(var s in ChatUI.exist){var n=ChatUI.exist[s];n.reconnect=!0}for(var s=0;i>s;s++){var r=t[s];if(ChatUI.isExist(r)){var o=ChatUI.exist[r];o.win().find("#cstatusmsg").html('<div class="hst-loadng"></div>'),Chat.makejoinchatrequest(r,o.ctype,!1,!0),e(r,a),a+=500}}MainUI.removeChatsFromHideport(),Participants.destroy()},checkLoadMoreMsgs:function(e,t){if(ZCScroll.isScrollUp(e)){var i=t.find("[mtype]"),a=t[0].firstChild.id;if(i.length&&"loadmoremsgs"===a&&"loadingoldmsgs"!==a)return!0}else if(ZCScroll.isScrollDown(e)){var i=t.find("[mtype]"),s=t[0].lastChild.id;if(i.length&&"loadmoremsgs"===s&&"loadingoldmsgs"!==s)return!0}return!1},hasLoadMoreMsgs:function(e){var t=e[0];if(ZCScroll.isScrollUp(t)){if("true"===e.attr("hastopmore"))return e.attr("hastopmore","false"),!0}else if(ZCScroll.isScrollDown(t)&&"true"===e.attr("hasbottommore"))return e.attr("hasbottommore","false"),!0;return!1},updateWmsServerLastMsgTime:function(e,t){ChatUI.exist[e]&&(ChatUI.exist[e].wmslmsgtime=t)},isLastMsgMissingInChatWindow:function(e){if("undefined"!=typeof e.lmsgtime){var t=$("#"+e.chid).find('[mtype][msgtime="'+e.lmsgtime+'"]');return t.length<1}return!1},updateMissingTranscript:function(e,t){function i(e){for(var t=[],i=0;i<e.length;i++){var a=e[i];MsgUtil.isChatMoreMsg(a)||t.push(a)}return t}var a=parseInt(e.time);-1==t||t>a||Chat.getTranscriptFromRServer(e.chid,void 0,t+1,a-1,function(e,t,a,s){if(t=i(t),!$.isEmptyObject(t)&&ChatUI.isExist(e)){var n=$("#"+e).find("#msgarea"),r=a-1,o=n.find("[mtype][msgtime='"+r+"']"),l=o.prevAll('[purpose="sender"]:first').attr("sender"),c=o.nextAll("[mtype][msgtime]"),d=t.length;if(d){Chat.updateSenderForNewMsgsinTranscript(l,t);var u=ChatUI.exist[e],m="undefined"!=typeof u.unreadtime?u.unreadtime:-1,p={chid:e,unreadmarkertime:m,onreconnection:!0},h=MsgUtil.formatTranscript(t,p);if(h.length){var g;if(c.length){var f=$(c[0]).prevAll('[purpose="sender"]:first'),v=f.attr("sender"),C=t[d-1],y=C.sender,b=C.time;if(l==v){if(y!=v&&$Date.isSameDay(r,b)){var E=f[0].cloneNode(!0);$(c[0]).hasClass("nwmsg")&&$(E).addClass("nwmsg"),h.push(E)}}else y==v&&(g=$(f[0]))}MsgUtil.updateTranscriptInBetween(n,h,a,s+1),g&&g.remove(),u.getScrollDown()}}}})},handleMissingTranscriptResponse:function(e,t,i,a){if(!$.isEmptyObject(t)&&ChatUI.isExist(e)){var s=$("#"+e),n=s.find("#msgarea");if(t.length){var r=ChatUI.exist[e],o="undefined"!=typeof r.unreadtime?r.unreadtime:-1,l={chid:e,unreadmarkertime:o};("undefined"!=typeof i||"undefined"!=typeof a)&&(l.onreconnection=!0);var c=MsgUtil.formatTranscript(t,l);if(c.length)if(MsgUtil.updateTranscript(n,c,i,a),"undefined"!=typeof a){var d=parseInt(a)+1,u=n.find("[msgtime="+d+"][mtype]");u.length&&$Util.scrollToViewportTop(u,s.find("#chatbody"))}else r.getScrollDown()}}},showTranscriptRetryUI:function(e,t,i){if(ChatUI.isExist(e)){var a=$("#"+e).find("#msgarea"),s=a.find("[mtype]"),n=parseInt(s.last().attr("msgtime")),r={$transcripterror:"common.transcript.retry",$retry:"message.option.retry"};r.FROMTIME=t?t:"",r.TOTIME=i?i:"";var o=a.find('[purpose="loadtranscriptonretry"][fromtime="'+r.FROMTIME+'"][totime="'+r.TOTIME+'"]');o.length&&$(o).parent()[0].remove();var l=$WC.template.replace(Template.TranscriptRetryUI,r);if(ChatUI.removeRetryLoaderUI(e),a.find("#loadingoldmsgs").remove(),$WC.$CUtil.isEmpty(t)&&$WC.$CUtil.isEmpty(i)&&(0==s.length?a.html(l):a.prepend(l)),$WC.$CUtil.isEmpty(t)){if(!$WC.$CUtil.isEmpty(i)){var c=a.find('[chid="'+e+'"][msgtime="'+(parseInt(i)+1)+'"]'),d=a.find('[purpose="date"][msgtime="'+(parseInt(i)+1)+'"]'),u=c.prev('[purpose="sender"]');d.length?d.before(l):u.before(l)}}else{var m=a.find('[chid="'+e+'"][msgtime="'+(parseInt(t)-1)+'"]');m.length&&m.after(l)}if(t==n){var p=ChatUI.exist[e];p.getScrollDown()}}},removeRetryLoaderUI:function(e){var t=$("#"+e).find("#msgarea");t.find("#retrytranscriptloader").remove()},handleScrollToLoadMore:function(e){var t=e.dom,i=t.find("#currenttranscript");i.off("scroll").on("scroll",function(){if(ChatUI.hasLoadMoreMsgs(i)){var a={},s='<div id="loadingoldmsgs" class="hst-loadngmn"><div class="hst-loadng"></div></div>';if(ZCScroll.isScrollUp(i[0])){i.prepend(s);var n=i.find("[mtype]").first().attr("msgtime");a={totime:parseInt(n)-1}}else{i.append(s);var r=i.find("[mtype]").last().attr("msgtime");a={fromtime:parseInt(r)+1}}if($WC.$CUtil.isEmptyObject(a))return;data=$.extend({},a,e.data),e.fetchmethod(data)}var o=e.chid;ChatUI.isExist(o)&&ChatUI.getUnreadOrUnseenMsgCount(o)&&ChatUI.exist[o].removeNewmsgNotification(),Mentions.captureAndRead(i,"chathistory"),clearTimeout(ChatUI.scrolltimer),ChatUI.scrolltimer=setTimeout(function(){ChatUI.loadVisibleImages(t.find("#currenttranscript")[0])},$zcg.ORIGINALIMG_LOAD_TIMEOUT)})},scrollToMsgView:function(e,t,i){var a=$Util.getDivFromTime(e,t,i);if(ZCScroll.customScroll(i),a.length){var s=e?$Util.scrollToViewportTop:$Util.scrollToView;s.apply($Util,[a,i])}else ZCScroll.getScrollDown(i[0])},updateFirstMsgOffsetValue:function(e,t,i){if(e||t){var a=$Util.getDivFromTime(e,t,i).filter("[mtype]");a.length&&($Util.firstmsgoffset=a.position().top)}},getDivFromTime:function(e,t,i){var a=e?parseInt(e)+1:parseInt(t)-1;return i.find("[msgtime="+a+"]")},getSenderForLastMsgSender:function(e){return MsgUtil.isInfoMsg(e.mtype)?null:e.sender},getTranscriptJSONToUpdateLastMsg:function(e){for(var t=e.length-1;t>=0;t--){var i=e[t],a=MsgUtil.isDeletedInfoMsg(i)&&!MsgUtil.getDelMsgVisibility(i);if(!MsgUtil.isInfoMsg(i.mtype)&&!a&&!MsgUtil.isChatMoreMsg(i))return i}},isPinned:function(e){return $WC.$CUtil.isEmpty(e)?!1:e.ispinned},isMuted:function(e){var t=!1;if(ChatUI.isExist(e)){var i=ChatUI.exist[e];t=i.isMuted()}return!$.isEmptyObject(ChatsList.mutedchats)&&ChatsList.mutedchats.indexOf(e)>=0?!0:t},isOpenedbyMe:function(e){if(ChatUI.isExist(e)){var t=ChatUI.exist[e];return t.createdbyme}return!1},updateMuteStatus:function(e,t,i,a){if(ChatUI.isExist(e)){var s=ChatUI.exist[e];s.updateMuteStatus(t,i)}ChatsList.mutedchats||(ChatsList.mutedchats=[]),1===parseInt(t)?ChatsList.mutedchats.indexOf(e)<0&&ChatsList.mutedchats.push(e):$WC.$CUtil.removeElementFromArray(ChatsList.mutedchats,e);var n=ChatsList.get(e);n&&!n.ispinned&&(n.muted_interval=i,t?(LeftPannel.LHSList.addNewInUI("mutedchats",[e],a),ChatsList.removeFromUI(e,"chats")):(LeftPannel.LHSList.addNewInUI("chats",[e],a),ChatsList.removeFromUI(e,"mutedchats")))},updateChannelImage:function(e){ChatUI.isExist(e)&&ChatUI.exist[e].updateUI()},loadOriginalSource:function(e){if(e=$(e),void 0!==e.attr("originalsrc")){var t="VIDEO"===e[0].tagName,i=t?"poster":"src";t||(e.attr("tempsrc",e.attr(i)),e.attr("src")&&e.css("background","url("+e.attr("src")+")"),e.attr("src","")),e.attr(i,e.attr("originalsrc")),e.removeAttr("originalsrc"),e.removeClass("invisible"),t||(e.on("load",function(){var t=$(this);e.off("load"),e.off("error"),t.css("background","transparent"),t.siblings("div[att_loading]").remove(),t.removeAttr("tempsrc"),ChatUI.addToImageCache(t.attr(i))}),e.on("error",function(){var t=$(this);e.off("load"),e.off("error"),t.attr("originalsrc",t.attr(i)),t.attr(i,t.attr("tempsrc")),""===t.attr("src")&&t.addClass("invisible"),t.removeAttr("tempsrc"),ChatUI.sendUDSDownloadFailureMail(t.parents("[chid]"))}))}},loadVisibleImages:function(e){for(var t=e.getBoundingClientRect().top,i=t+e.offsetHeight,a=e.querySelectorAll("img[originalsrc],video[originalsrc]"),s=0;s<a.length;s++){var n=a[s],r=n.getBoundingClientRect().top,o=r+n.offsetHeight;(r>t&&i>r||o>t&&i>o||t>r&&o>i)&&ChatUI.loadOriginalSource(n)}},isCachedImage:function(e){return ChatUI.cachedImages[e]===!0},addToImageCache:function(e){ChatUI.cachedImages[e]=!0},isUDSDownloadEnabled:function(){return!$WC.$CUtil.isEmpty($zcg._DOWNLOADSERVERURL)},isUDSUploadEnabled:function(){return!$WC.$CUtil.isEmpty($zcg._UPLOADSERVERURL)},sendUDSDownloadFailureMail:function(e,t){if(ChatUI.isUDSDownloadEnabled()){var i=e.attr("url"),a=e.attr("hasthumbnail"),s="true"===e.attr("isv1"),n=e.attr("chid");if(s&&"undefined"!=typeof i&&-1==ChatUI.udsdownloadfailurls.indexOf(i)){ChatUI.udsdownloadfailurls.push(i),ChatUI.udsdownloadfailurls.length>100&&ChatUI.udsdownloadfailurls.splice(0,1);var r="Unable to download file via UDS "+$zcg._ZUID+" "+n+" | "+$Util.getSyncedCurrentTime()+" | "+window.location.origin+" | "+i+("true"!==a||t?"":" Thumbnail");_sendDebugMail(r,"UDS Unable to download File")}}},hideLeftBarMsgCount:function(e){var t=LeftPannel.container.find("#tab"+e);t.find("#msgcount"+e).empty().hide()},handleOnContactDelete:function(e,t){var i=MainUI.getOngoing121ChatwithRecipient(e);if(!$WC.$CUtil.isEmpty(i)&&!Users.isSameOrg(e)){var a=Users.getName(e),s=ChatUI.exist[i];s.disableComposer(i,Resource.getRealValue(t?"chat.continue.conversation.notallowed.1":"chat.continue.conversation.notallowed.2",[a]))}},getParticipantsImgHTML:function(e,t){var i=Participants.get(e),a=i.recipants;if(t=t||2,a){for(var s=a.length,n='<div class="part_img">',r=0;s>r&&!(r>=t);r++)n+='<img title="'+Users.getName(a[r])+'"src="'+Users.getImgUrlById(a[r])+'"/>';var o=s-t;return o>0&&(n+="<span>+"+o+"</span>"),n+"</div>"}return""},updateEditedMsgInfoFromWms:function(e){this.isExist(e.chid)&&(e=MsgUtil.getMockedObject(e.chid,e),this.displayMsg(e))},updateEditedMsgFromWms:function(e){var t=$Util.cloneObject(e.msg,!0),i=t[0].msg;for(var a in i)e[a]=i[a];var s=t[1],n=e.chid,r=!WmsImpl.isLocalUser(e.sender),o={isnew:r&&(t[0].islastmsgid||void 0!==s)};if(e){if(e=MsgUtil.updateEditedMsgObj(e),e=$WC.CMsgUtil.convertMsgObj(e),this.updateTypingStatus(n,""),Chat.updateEditedMsgInOtherArea(e),this.isExist(n)){var l=this.exist[n];l.updateEditedMsginChatTranscript(e,o)}else r&&(ChatUI.create(e),Chat.join(e.chid,e.ctype,!1,!0));t[0].islastmsgid&&(ChatsList.updateLastMsgInfo(e),WmsBarImpl.updateLastMsgTxtInfo(e))}if(s&&s.msg){var c=s.msg;c.chid=n,c.mtype=s.mtype,this.updateEditedMsgInfoFromWms(s.msg)}},updateChatWindowOptions:function(){var e=ChatUI.exist;for(var t in e)e[t].updateWinHeader(),e[t].updateAdditionalOptionsUI()},updateReactionsInCwin:function(e,t){var i=ChatUI.exist[e];if(i){for(var a=i.win().find("#chatbody"),s=a.find("[msgtime="+MsgUtil.getTimefromMsgObj(t)+"]"),n=s.find("[purpose=reactionarea]"),r=n.children().children(),o=0,l={};r.length>0;){var c=r.attr("unicode");c&&(l[c]=o++),r=r.next()}n.html(MsgTemplate.getReactionsHtml(t.reactions,MsgUtil.getTimefromMsgObj(t),i,l)),i.isScrollDown(50)&&i.getScrollDown(),ZCScroll.updateScroll(a)}},updateForwardMsginCwin:function(e,t){var i=ChatUI.exist[t];if(i)for(var a=e.msglist,s=0;s<a.length;s++)a[s].dname=e.dname,a[s].nname=e.nname,a[s]=$WC.CMsgUtil.convertMsgObj(a[s]),ChatUI.displayMsg(a[s])}},ChatsList={UNREAD_MSG_COUNT_FOR_UNREAD_CHAT:1,uilimit:10,unreadelements:{top:[],bottom:[]},searchhtml:'<div chid="{CHID}" elemtype="chat" purpose="search"><span class="usrimgsts">{CHATIMAGE}{USERSTATUS}</span><span class="usrname ellips" title="{TITLE}">{TITLENAME}<em>{ADDITIONALINFO}</em></span></div>',init:function(){LeftPannel.updateCallback({type:"chat",create:function(){ChatsList.showUnreadChatsView()},markallread:function(e,t){var i=$(t).parents("[category]").attr("category");Chat.markAllChatsRead(i)},action:function(e,t){ChatsList.action(e,t)},headeraction:function(e,t){var i=$(t).parent().attr("category");ChatsList.toggle(i),LeftPannel.toggleHeader(i)},more:function(e,t){t=$(t);var i=t.parent(),a=i.attr("category"),s=i.attr("expand"),n=LeftPannel.container.find("#"+a+"list");if("chats"===a&&"gotohistory"===t.attr("purpose"))ChatHistory.load();else{"false"==s?n.addClass("zcmoreshow zcmoreshowanim"):n.removeClass("zcmoreshow").addClass("zcmorehideanim"),i.attr("expand","false"==s?"true":"false");var r=function(){var e=Resource.getRealValue("false"==s?"common.less":"app.show.more"),t='<span class="showmore" workfor="chat" elemtype="more">'+e+'</span><span id="unreadcount" class="msgnotify unreadchts dN"></span>';"chats"===a?"false"===s&&(ZCTrack.track("LHS_MORE_CHATS"),t='<span class="showmore" workfor="chat" elemtype="more">'+Resource.getRealValue("common.less")+'</span><span class="dot"></span><span class="showmore" workfor="chat" elemtype="more" purpose="gotohistory">'+Resource.getRealValue("common.showall")+"</span>"):t='<span class="showmore" workfor="chat" elemtype="more">'+e+"</span>",i.html(t),ChatsList.updateShowMoreCount(a),ZCScroll.resetScroll($("#leftpannel #list"))};n.handleAnimationEnd(function(){n.removeClass("zcmorehideanim zcmoreshowanim"),r()})}}})},markUnread:function(e,t){ChatsList.unreadchatarr[e]=t;var i=LeftPannel.container.find("#tab"+e);i.addClass("actunrdmg").attr("unread",!0)},isExist:function(e){return""!==this.getCatagory(e)},getAll:function(){return $.extend({},$DB.get("chats"))},getCatagory:function(e){var t=$DB.get("chats")[e];if(!t){if(Chat.isChannelChid(e)){var i=Channels.getByChid(e);if(Channels.isPinned(i))return"pinnedchats";if(Channels.isMuted(i))return"mutedchats"}return""}return t.ispinned?"pinnedchats":ChatUI.isMuted(e)?"mutedchats":"chats"},get:function(e){return $DB.get("chats")[e]},getTitle:function(e,t,i){var a=Channels.getByChid(e);return t=$WC.$CUtil.isEmpty(t)?"":t,$WC.$CUtil.isEmptyObject(a)?this.get(e)&&(t=(this.isOnetoOneChat(e)||ChatsList.isBotChat(e))&&i?"@"+$Util.getTitleString(this.get(e).title):this.get(e).title):t=Channels.getDisplayNameForChannel(a),$WC.$CUtil.processXSS(t)},hasPermission:function(e,t){var i=this.get(e);return ChatUI.getPermissions(this.isGroupChat(e)?""+$zcg.CT_NFY_ZOHOGROUP:i.ctype)[t]},isGroupChat:function(e){var t=this.get(e);return t?t.pcount>2:!1},isOnetoOneChat:function(e){var t=this.get(e);return t&&t.ctype==$zcg.CHAT?2==t.pcount&&!t.customgroup:!1},isBotChat:function(e){return MyBots.isBotChid(e)||ChatBot.isBot(e)},showUnreadChatsView:function(e,t){var i=LeftPannel.container.find("#chats"),a=i.find("#unreadfilter"),s="true"===a.attr("isfilterapplied"),n=ChatsList.getUnreadChats("chats").length;if(!e||s){if(s)if(t&&n>0)i.find("#tab"+t).slideUp("fast"),n<=ChatsList.uilimit&&i.find("#chatsshowmore").slideUp();else{if(e&&n>0){var r=i[0].querySelectorAll('[catagory="chats"][unread="true"]');return $(r).slideDown(),n>ChatsList.uilimit&&i.find("#chatsshowmore").slideDown(),void(s=!0)}var r=i[0].querySelectorAll('[catagory="chats"]');$(r).slideDown(),i.find("#chatsshowmore").slideDown(),a.attr("isfilterapplied","false"),a.attr("title",Resource.getRealValue("chat.header.showunread")),s=!1}else{if(0===n)return;var r=i[0].querySelectorAll('[catagory="chats"]:not([unread="true"])');$(r).slideUp(),n<=ChatsList.uilimit&&i.find("#chatsshowmore").slideUp(),a.attr("isfilterapplied","true"),a.attr("title",Resource.getRealValue("chat.header.showall")),s=!0}ChatsList.updateShowMoreCount("chats"),n?s?a.addClass("active").removeClass("inactive"):a.addClass("inactive").removeClass("active"):a.removeClass("inactive active")}},getRecipientDatafor121chat:function(e){var t={};if(this.isOnetoOneChat(e)){var i=this.get(e),a=i?i.recipants:[];2==a.length&&(WmsImpl.isLocalUser(a[0].zuid)?(t.dname=a[1].dname,t.zuid=a[1].zuid):(t.dname=a[0].dname,t.zuid=a[0].zuid))}return t},getRecipantForChats:function(e){for(var t=[],i=0,a=e.length;a>i;i++){var s=e[i];if(this.isExist(s)){var n=this.get(s);if(!this.isGroupChat(s)){var r=this.getRecipantIds(n.recipants);t.push(r[0])}}}return t},getParticipantDetail:function(e,t){var i=null;if(this.isExist(e))for(var a=this.get(e).recipants,s=0,n=a.length;n>s;s++)if(a[s].zuid===t){i=a[s];break}return i},addToObj:function(e,t){var i=$DB.get("chats");$.extend(i,t)},markRead:function(e){ChatsList.deleteFromUnreadChatArr(e),ChatsList.removeBubble(e)},markAllread:function(e){ChatsList.unreadchatarr={},ChatsList.removeallunreadchats(e),HomeUI.reinit()},deleteInObj:function(e){delete $DB.get("chats")[e]},update:function(e,t){$.isEmptyObject(e)||(e.fromserver?this.updateDataFromChatServer(e,t):this.updateDataFromWMS(e))},updateChatData:function(e,t,i){var a=this.getCatagory(e);a=$WC.$CUtil.isEmpty(a)?"chats":a;var s=$DB.get("chats");s[e]=s[e]||{},s[e].recipants=s[e].recipants||[],$WC.$CUtil.isEmpty(t.recipants)||t.recipants.length!=t.pcount||(s[e].recipants=t.recipants),s[e].addinfo=Chat.parseAddinfo(t.addinfo),s[e].title=$WC.$CUtil.processXSS(t.title),s[e].pcount=parseInt(t.pcount),s[e].ctype=t.ctype,s[e].customgroup=t.customgroup,LeftPannel.LHSList.addNewInUI(a,[e],i)},updateDataFromWMS:function(e){var t=($DB.get("chats"),"chats"),i=e.isunread,a=this.formatedAndUpdateDataFromWMS(e.resp,i);1===a.tobeadded.length&&(t=this.getCatagory(a.tobeadded[0])),LeftPannel.LHSList.addNewInUI(t,a.tobeadded)},formatedAndUpdateDataFromWMS:function(e){var t=$DB.get("chats"),i=[];for(var a in e){var s=e[a];if(ChatUI.updateMuteStatus(a,s.mute?1:0,s.mute),t[a]=t[a]||{},t[a].recipants=[],s.recipantssummary=JSON.parse(s.recipantssummary),$WC.$CUtil.isEmpty(s.recipantssummary))delete t[a];else{for(var n in s.recipantssummary){var r={};r.zuid=n,r.dname=s.recipantssummary[n],t[a].recipants.push(r)}if(!$WC.$CUtil.isEmpty(s.lmhash)){var o="string"==typeof s.lmhash?JSON.parse(s.lmhash):s.lmhash;$.isEmptyObject(o)||(o.time=s.lmtime,t[a].lastmsginfo=this.parseLastMsgInfo(a,o))}t[a].addinfo=Chat.parseAddinfo(s.addinfo),t[a].title=$WC.$CUtil.processXSS(s.title),t[a].pcount=parseInt(s.pcount),t[a].ctype=s.ctype,t[a].deleted=s.deleted,t[a].removed=s.removed,t[a].customgroup="true"==s.customgroup,i.push(a)}}return{obj:t,tobeadded:i}},updateDataFromChatServer:function(e,t){var i=$DB.get("chats"),a=e.resp;for(var s in a)if("pinnedchats"!==t&&"mutedchats"!==t||"chats"!==this.getCatagory(s)||(this.removeFromUI(s),this.deleteInObj(s)),"chats"!==t||"pinnedchats"!==this.getCatagory(s)&&"mutedchats"!==this.getCatagory(s)){var n=a[s];i[s]=i[s]||{},i[s].recipants=i[s].recipants||[],$WC.$CUtil.isEmpty(n.recipants)||(i[s].recipants=JSON.parse(n.recipants)),$WC.$CUtil.isEmpty(n.lastmsginfo)||(i[s].lastmsginfo=this.parseLastMsgInfo(s,n.lastmsginfo)),i[s].addinfo=Chat.parseAddinfo(n.addinfo),i[s].title=$WC.$CUtil.processXSS(n.title),i[s].pcount=parseInt(n.pcount),i[s].isrecent=!0,i[s].ispinned=e.ispinned||(n.pinned?!0:!1),i[s].muted_interval=n.muted_interval,i[s].ismuted=e.ismuted||(n.muted_interval>-1?!0:!1),i[s].ctype=n.chat_type,i[s].deleted=n.deleted,i[s].removed=n.removed,i[s].unreadmsgs=n.unreadmsgs,i[s].unreadtime=n.unreadtime,i[s].customgroup=n.customgroup}this.populate(t)},action:function(e,t){var i=t.getAttribute("chid"),a=t.getAttribute("catagory");e.target.id==="tabpin"+i?"chats"===a?Chat.markUnmarkPinnedChat(i,!0):"pinnedchats"===a&&Chat.markUnmarkPinnedChat(i,!1):e.target.id==="tabunmute"+i?Chat.muteChat(i,!1):e.target.id==="tabdelete"+i?(Chat.quit(i,"pinnedchats"===a?!0:!1,!0),ChatsList.delete(i),Chat.removefromRC(i)):ChatsList.attachContinueActiveChat(i)},getHtml:function(e,t,i,a){var s="chat",n=e,r="contact"===a.profile&&Contacts.isBotId(a.profileid);if(pintext=r?"common.bot.pin":"common.pin",unpintext=r?"common.bot.unpin":"common.unpin",i.ctype==$zcg.ORGCHANNEL){s="channel",pintext="common.channel.pin",unpintext="common.channel.unpin";var o=Channels.getByChid(t),l=Channels.getDisplayNameForChannel(o),c=Channels.isMultiTeamChannel(o),d=Channels.islockNeeded(o);i.title="undefined"!=typeof l?l:i.title}var u='<div id="tab{CHID}" chid="{CHID}" catagory="'+n+'" elemtype="'+s+'" profile="{PROFILE}" profileid="{PROFILEID}" uid="{HOVERID}" class="zcuserstatus '+(ChatUI.isCurrent(t)?"chatsel":"")+'"'+(ChatUI.hasUnreadOrUnseenMsgs(t)?' unread="true"':"")+'><div id="tabu{CHID}"></div><div class="floatl userdetails {CHN_ICONS}" elemname><span id="tabtitle{CHID}" class="ellips {CHN_ICONS_WID}">{TITLE}</span><span class="usrdtl-icns">{CHN_TYPE_ICON} {CHN_LCK} </span></div><div id="otherinfo{CHID}">'+("mutedchats"===e?'<div id="tabunmute{CHID}" title="'+Resource.getRealValue("Unmute Conversation")+'" class="msi-unmuteicon"></div>':"chats"===e?'<div id="tabpin{CHID}" title="'+Resource.getRealValue(pintext)+'" class="msi-pin"></div>':'<div id="tabpin{CHID}" title="'+Resource.getRealValue(unpintext)+'" class="msi-unpin"></div>')+'<div id="tabscode{CHID}" purpose="status" class="{STATUS}"></div><div id="msgcount{CHID}" class="msgnotify {MUTECSS}">{UNREADCOUNT}</div>'+("pinnedchats"===e?"":'<div id="tabdelete{CHID}" title="'+Resource.getRealValue("common.chat.remove")+'"  class="msi-chtclse"></div>')+"</div></div>",m="channel"===s?a.profileid:t;return u=u.replace(/{CHID}/g,t).replace(/{UNREADCOUNT}/g,ChatUI.hasUnreadOrUnseenMsgs(t)?ChatUI.getUnreadOrUnseenMsgCount(t):"").replace(/{TITLE}/g,$WC.Matcher.replace("escapeReplacementString",ChatsList.getTitle(t,i.title,!0))).replace(/{PROFILE}/g,a.profile).replace(/{PROFILEID}/g,a.profileid).replace(/{MUTECSS}/g,ChatUI.hasUnreadOrUnseenMsgs(t)&&(ChatUI.isMuted(t)||"mutedchats"===e)?"mute":"").replace(/{STATUS}/g,$WC.Matcher.replace("escapeReplacementString",a.status)).replace(/{HOVERID}/g,m).replace(/{CHN_ICONS_WID}/g,d||c?"usrdtl-txt":"").replace(/{CHN_LCK}/,d?'<em title="'+Resource.getRealValue("channel.lock.tip")+'" class="msi-chnlck"></em>':"").replace(/{CHN_TYPE_ICON}/,c?'<em title="'+Resource.getRealValue("channel.multiteam.icon.tip")+'" class="msi-multiteamchannel"></em>':"").replace(/{CHN_ICONS}/,d&&c?"chnmultiicns":"")},populate:function(e){LeftPannel.LHSList.populateChats(e)},toggle:function(e){var t=LeftPannel.container.find("#"+e+"list"),i="none"===t.css("display");if("chats"==e)var a={hpchats:i?1:0};else if("pinnedchats"==e)var a={hppinnedchats:i?1:0};else if("mutedchats"==e)var a={hpmutedchats:i?1:0};Settings.update(a),ChatsList.updateChatsHeaderHtml(e)},removeFromUI:function(e,t){var i="undefined"==typeof t?this.getCatagory(e):t;if(!$WC.$CUtil.isEmpty(i)){var a=LeftPannel.container.find("#"+i);a.find("#tab"+e).remove(),ChatsList.showUnreadChatsView(!0);var s=a.find("#"+i+"list");if($WC.$CUtil.isEmpty(s.html())){var n="pinnedchats"===i?'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("pinnedchat.none")+"</div>":'<div emptymsg="true" class="cntemptymsg" >'+Resource.getRealValue("chat.none")+"</div>";s.html(n),"chats"===i?a.find("#chatsshowall").remove():"mutedchats"===i&&(a.find("#"+i+"listholder").remove(),a.find("#"+i+"header").remove())}s.children().length<=ChatsList.uilimit&&a.find("[expand]").length>0&&("chats"===i&&0===a.find("#chatsshowall").length?(LeftPannel.LHSList.removeOrAddShowMore(i),s.removeClass("zcmoreshow")):"mutedchats"===i&&a.find("[expand]").remove())}},getHolderHTML:function(e,t){var i='<div id="{{category_name}}header" class="zclftitmn cur" workfor="chat" elemtype="header"><div title="{{header_tip}}" class="zcbdytitle">{{header_name}}<div class="zccunt posl dIB"><span id="totalunreadcount" style="display:none"></span></div></div>{{header_action}}</div><div id="{{category_name}}listholder"><div id="{{category_name}}list"  class="{{category_name}}list"></div>{{showmore_html}}<div class="zclin"></div></div>',a="",s="";return"chats"==e?(a='<span id="unreadfilter" isfilterapplied="false" title="'+Resource.getRealValue("chat.header.showunread")+'" workfor="chat" elemtype="create" class="msi-unreadfilter cur"></span>',s=t?'<div id="chatsshowmore" class="zcuserstatus zcmorechl"  expand="false" category="'+e+'"><span class="showmore" workfor="chat" elemtype="more">'+Resource.getRealValue("app.show.more")+'</span><span id="unreadcount" class="msgnotify unreadchts dN"></span></div>':""):"mutedchats"===e&&(a='<span id="markallread" title="'+Resource.getRealValue("chat.markread.none")+'" workfor="chat" elemtype="markallread" class="msi-readall cur"></span>',s=t?'<div class="zcuserstatus zcmorechl"  expand="false" category="'+e+'"><span class="showmore" workfor="chat" elemtype="more">'+Resource.getRealValue("app.show.more")+"</span></div>":""),i=$WC.template.replace(i,{header_action:a,showmore_html:s},"InSecureHTML"),i=$WC.template.replace(i,{$category_name:e,$header_tip:"common.lhs.headertip",$header_name:"common."+e})},repopulate:function(){this.populate("pinnedchats"),this.populate("mutedchats"),this.populate("chats")},getCHIDsfromListView:function(){var e=function(e,t){return e.map(function(){return this.getAttribute(t)}).toArray()},t="chid",i=LeftPannel.container,a=e(i.find("#chatslist [catg='chats']"),t);return pinnedchats=e(i.find("#pinnedchatslist").children(),t),pinnedchats.concat(a)},rearrangeChats:function(e){var t=LeftPannel.container.find("#"+e+"list"),a=this.getAllSortedChats(e),s=a.length;for(_print("rearrangechats",a),i=0;s>i;i++)t.find("#tab"+a[i][0]).detach().appendTo(t);this.updateShowMoreCount(e),ChatsList.updateUnreadNotifier()},getAllSortedChats:function(e){var t=this.getSortedChatsList(e);return $Util.sort(t.chatsarr,1,!0)},getSortedChatsList:function(e){_print("rearrangechats","gonna rearrange chats "+new Date);var t=$DB.get("chats");"mutedchats"===e?$.extend(t,Channels.getMutedChannels()):"pinnedchats"===e&&$.extend(t,Channels.getPinnedChannels());var i=[],a=[];for(var s in t){var n=t[s].lastmsginfo,r=-1;if("undefined"!=typeof n&&n.time&&(r=parseInt(n.time)),"undefined"==typeof n&&Chat.isChannelChid(s)){var o=Channels.getByChid(s);r=o?parseInt(o.lmtime):r}i.push([s,r])}var l={chatswithunread:a,chatsarr:i};return l},pinUnpinChat:function(e,t){var i=$Util.cloneObject(this.get(t),!0),a={},s=ChatUI.isMuted(t)?"mutedchats":"chats";i.ispinned=!1,"pin"===e&&(s="pinnedchats",i.ispinned=!0),LeftPannel.LHSList.removeFromAllCategories(t,s),a[t]=i,this.deleteInObj(t),this.addToObj(s,a),LeftPannel.LHSList.addNewInUI(s,[t]),ChatsList.handlePinForHeaderCount(t),ChatsList.updateUnreadNotifier(),ZCScroll.updateScroll($("#leftpannel #list")),ChatUI.isExist(t)&&ChatUI.exist[t].updateAdditionalOptionsUI()},updateParticipants:function(e,t,i){var a=function(e){var t,i=e.s;"undefined"!=typeof i&&(t=i.split(":",2),e.dname=i.substring(t.join(":").length+1),e.zuid=t[0],e.scode=t[1])},s=this.get(e);if("undefined"!=typeof s){var n=t.length;if("add"==i)for(var r=0;n>r;r++){a(t[r]);var o={};o.zuid=t[r].zuid,o.dname=t[r].dname,s.recipants.push(o),s.pcount++}else if("delete"==i){for(var l=this.getRecipantIds(t),c=s.recipants,r=0,n=c.length;n>r;r++)-1!==l.indexOf(c[r].zuid)&&(c.splice(r,1),r--,n--);s.pcount--}else{s.recipants=[];for(var r=0;n>r;r++){a(t[r]);var o={};o.zuid=t[r].zuid,o.dname=t[r].dname,s.recipants.push(o),s.pcount=s.recipants.length}}this.updateElement(e,null,!0)}},"delete":function(e){var t=this.get(e);if("undefined"!=typeof t){this.removeFromUI(e);var i=this.getRecipantIds(t.recipants);this.deleteInObj(e),ZCScroll.updateScroll($("#leftpannel #list"));var a=1==i.length?i[0]:MyBots.isBotChid(e)||ChatBot.isBot(e)?MyBots.getBotId(e):void 0;"undefined"!=typeof a?ContactsList.addNew(a):$WC.Matcher.check("emailid",t.addinfo.PEND_INV)&&ContactsList.addNew(t.addinfo.PEND_INV)}},attachContinueActiveChat:function(e,t){var i=this.get(e);this.removeBubble(e),!$WC.$CUtil.isEmpty(i)&&i.isrecent&&delete i.isrecent,Chat.attachSession(e,t)},persistforuser:function(e){var t=this.getAll(),i=!1,a=OrgInvitees.getAll();if(!$.isEmptyObject(t))for(var s in t){var n=t[s];if(MyBots.isBotChid(s)){if(i=MyBots.getBotId(s)===e)break}else{if(a.length&&n.addinfo&&n.addinfo.PEND_INV===e)return!0;if(recipants=this.getRecipantIds(n.recipants),recipants.length<=1&&($.isEmptyObject(n.addinfo)||n.addinfo.CT_TYPE!==$zcg.CT_NFY_ZOHOGROUP)&&(i=recipants[0]===e))break}}return i},parseDetails:function(e){var t=-1,i="",a="status zcstatus--7";if(parseInt(e.ctype)===$zcg.ORGCHANNEL){var s=Channels.getByChid(e.chid);$WC.$CUtil.isEmptyObject(s)?(t=e.addinfo.CHANNELUID,i="channel",a="msi-sc"+e.addinfo.CHANNEL_SCOPE+" msci"):(t=s.oc_id,i="channel",a="msi-sc"+Channels.getLevel(s)+" msci")}else if(parseInt(e.ctype)!==$zcg.NO_OPERATIONCHAT){var n="undefined"!=typeof e.recipants?this.getRecipantIds(e.recipants):[],r=parseInt(e.pcount);if(1===n.length&&this.isOnetoOneChat(e.chid))t=n[0],i="contact",a=Contacts.getStatusStyle(t,ChatUI.getParticipantStatus(e.chid,n[0]),!0);else if(n.length>1||r>=2)t=-1,i="group",a=this.getDynamicGroupClass();else if(0==n.length&&1==r&&$WC.Matcher.check("emailid",e.addinfo.PEND_INV))t=e.addinfo.PEND_INV,i="contact",a="status zcstatus-0";else{if(0!=n.length||1!=r)return null;t="-1",i="contact",a="status zcstatus-1"}}else{var n=this.getRecipantIds(e.recipants);a="msi-boticon status",i="bot",e.chid&&(MyBots.isBotChid(e.chid)||ChatBot.isBot(e.chid))?(i="contact",t=MyBots.getBotId(e.chid)):1===n.length&&(i="contact",t=n[0])}return{profile:i,profileid:t,status:a}},parseLastMsgInfo:function(e,t){try{if("string"==typeof t){if(0===$.trim(t).length)return"";t=JSON.parse(t)}if(t.dname=WmsImpl.isLocalUser(t.sender)?Resource.getRealValue("common.you"):Users.getName(t.sender,t.dname),t.time=MsgUtil.getTimefromMsgObj(t),t.mtype===""+$zcg.DELETE_MTYPE)t.msg=MsgTemplate.getDeletedMsgText(),t.isdeleted=!0,t.delete_msg_visible=MsgUtil.getDelMsgVisibility(t);else if(MsgUtil.isEditedMsg(t.mtype))MsgUtil.updateEditedMsgObj(t);else if("20"===t.mtype||"object"==typeof t.msg&&"undefined"!=typeof t.msg.fName){t.mtype="20";var i="undefined"==typeof t.__module?"att":t.__module;t.msg=Resource.getRealValue("chat."+i+".shared",[t.dname])}else MsgUtil.isInfoMsg(t.mtype)?t.isinfomsg=!0:"string"==typeof t.msg&&(t.mtype=""+$zcg.TEXT_MTYPE,t.msg=t.msg);return t}catch(a){_print("lastmsgparsing",[e,t])}return""},getLastMsgHTML:function(e,t,i,a){if($WC.$CUtil.isEmpty(t))return"";var s=function(e){return e.msg&&"USER DELETED"===e.msg.mode&&e.msg.userlist?e.msg.userlist.hasOwnProperty($zcg._ZUID):!1},n={html:'<div class="zcunrdltmsg floatl ellips">{SENDER}{LASTMSG}</div>',senderhtml:'<span class="zcunrdname floatl ellips bold">{SENDERNAME}</span><span class="zcunrdmsg">:</span>',removequoteText:!0,listview:!0};a=$.extend({},n,a);var r=parseInt(t.mtype),o=(t.isdeleted,"");switch(r){case 65:case 16:var l="";s(t)?l=Resource.getRealValue("chat.removed.info"):(t=$WC.CMsgUtil.convertMsgObj($WC.$CUtil.cloneObject(t)),t=MsgUtil.getMockedObject(e,t),l=MsgTemplate.getInfoMsg(t)),o='<div class="infomsg padd0 ellips">'+l+"</div>",a.senderhtml="";break;case 20:o='<div class="infomsg padd0 ellips">'+t.msg+"</div>",a.senderhtml="";break;case $zcg.DELETE_MTYPE:o='<div class="dltinfomsg ellips">'+MsgTemplate.getDeletedMsgText()+"</div>",a.senderhtml="";break;case 12:var c=Users.getName(t.sender,t.dname),l=t.msg,d=t.msg.lastIndexOf("</blockquote>");a.removequoteText&&-1!==d&&d+13<l.length&&(l=l.substring(d+13));var u=l.indexOf("<br>"),m=l.indexOf("\n");(-1!==u||-1!==m)&&(l=l.substring(0,-1!==u?u+4:-1!==m?m+1:0)),l=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("img","src"),null,l,"$4");var p={msg:l,isEdited:t.isEdited,chid:e};p.mentions=void 0!==t.meta?t.meta.mentions:t.mentions,o=MsgTemplate.getDisplayContent(p,!0),o=Smiley.convertAnimatedTo24(o),o='<div class="floatl ellips">'+o+"</div>",a.senderhtml=this.isOnetoOneChat(e)&&!WmsImpl.isLocalUser(t.sender)?"":a.senderhtml.replace(/{SENDERNAME}/g,$WC.Matcher.replace("escapeReplacementString",c));break;case"default":return o}return a.html.replace(/{SENDER}/g,$WC.Matcher.replace("escapeReplacementString",a.senderhtml)).replace(/{LASTMSG}/g,$WC.Matcher.replace("escapeReplacementString",o))},getLastMsgInChat:function(e,t){return ChatsList.isExist(e)?new $CliqChatId(e).isChannel()?Channels.getByChid(e).lminfo:ChatsList.get(e).lastmsginfo:t},updateLastMsgInfo:function(e,t,i){e.mtype=e.mtype?e.mtype:""+$zcg.TEXT_MTYPE,t=t?t:e.chid,e=$WC.CMsgUtil.convertMsgObj(e);var a=parseInt(e.mtype);a===$zcg.ATTACHMENT_MTYPE?(e.dname=WmsImpl.isLocalUser(e.sender)?Resource.getRealValue("common.you"):Users.getName(e.sender,e.nname),e.msg=$.isEmptyObject(e.info)?"":Resource.getRealValue("chat."+e.info.mod+".shared",[e.dname])):a===$zcg.DELETE_MTYPE&&(e.msg=MsgTemplate.getDeletedMsgText());var s={};if(s.dname=$WC.$CUtil.processXSS(e.dname),s.mtype=e.mtype,s.sender=e.sender,s.time=MsgUtil.getTimefromMsgObj(e),s.msg=e.msg,s.isEdited=e.isEdited,MsgUtil.isNewMentionMsg(e.msg)&&void 0!=e.mentions&&(s.mentions=e.mentions),MsgUtil.isDeletedInfoMsg(e)&&(s.delete_msg_visible=MsgUtil.getDelMsgVisibility(e)),parseInt(e.ctype)===$zcg.ORGCHANNEL){var n=Channels.getByChid(t);n&&(s.time>Channels.getLastMsgTimeForChannel(n)||i)&&Channels.updateLastMsgInfo(t,s)}var r=this.get(t);"undefined"!=typeof r&&"undefined"!=typeof r.lastmsginfo&&(s.time>=r.lastmsginfo.time||i)&&(r.lastmsginfo=s)},updateLastMsgInfoFromTranscript:function(e,t){if(this.isExist(e)){var i=this.get(e),a={},s=parseInt(t.mtype);if(a.time=MsgUtil.getTimefromMsgObj(t),a.sender=t.sender,a.dname=WmsImpl.isLocalUser(t.sender)?Resource.getRealValue("common.you"):Users.getName(t.sender,t.dname),a.isEdited=t.isEdited,20===s){var n=t.mod;a.msg=Resource.getRealValue("chat."+n+".shared",[a.dname])}else a.msg=MsgTemplate.getDisplayContent({msg:$WC.Matcher.replace("removespantag",t.msg,"$1")}),s=s?s:$zcg.TEXT_MTYPE;a.mtype=s;var r=function(e,t){var i=e.lastmsginfo;return"undefined"==typeof e?!1:"undefined"==typeof i?!0:t.time>i.time||i.delete_msg_visible===!1?!0:!1};r(i,a)&&(i.lastmsginfo=a)}},updateElement:function(e,t,i){var a=this.get(e);if("undefined"==typeof a&&Chat.isChannelChid(e)&&(a=Channels.getByChid(e)),"undefined"!=typeof a){var s=LeftPannel.container.find("#tab"+e);if(ChatUI.hasUnreadOrUnseenMsgs(e)){var n=ChatUI.getUnreadOrUnseenMsgCount(e);s.find("#msgcount"+e).html(n).show(),ChatUI.isMuted(e)&&ChatUI.hasUnreadOrUnseenMsgs(e)?s.find("#msgcount"+e).addClass("mute"):s.find("#msgcount"+e).removeClass("mute"),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateBadge(!0)}if(i){a.chid=e;var r=this.parseDetails(a);if(null==r)return;if("undefined"==typeof r)return void this.delete(e);s.attr("profileid",r.profileid).attr("profile",r.profile);var o=s.find('[purpose="status"]'),l=o.attr("typing");l||s.find("#tabscode"+e).removeClass().addClass(r.status)}if(null!==t&&(""!==t||""===t&&2===a.pcount)){if(""===t){t=a.title;var c=this.getRecipantIds(a.recipants)[0],d=null;(d=this.getParticipantDetail(e,c))&&(t=Users.getName(c,d.dname))}a.title=t,s.find("#tabtitle"+e).text($WC.$CUtil.decodeHTMLEntities(ChatsList.getTitle(e,t,!0))).attr("title")}}},getRecipantIds:function(e,t){for(var t=t||WmsImpl.getZuid(),i=[],a=0,s=e.length;s>a;a++)i.push(e[a].zuid);return-1!==i.indexOf(t)&&i.splice(i.indexOf(t),1),i},getSearchResults:function(){function e(e,t,i,a,s){var n=$WC.$CUtil.processXSS(t.title),r="",o=(Chat.getGroupId(e),""),l=ChatsList.getLastMsgHTML(e,ChatsList.parseLastMsgInfo(e,t.lastmsginfo),n);if(a=$WC.$CUtil.processXSS(a),i=i.replace(/{CHID}/g,e).replace(/{CHATIMAGE}/g,$WC.Matcher.replace("escapeReplacementString",HistoryUI.getRecipantsPhoto(t.recipants,t.pcount,t.addinfo,t.title,t.ctype,e,t.customgroup))).replace(/{TITLE}/g,$WC.Matcher.replace("escapeReplacementString",n)),s&&(n=n.replace(new RegExp($WC.Matcher.replace("escaperegexp",a),"i"),"<b>$&</b>")),2===parseInt(t.pcount))for(var c=t.recipants.length,d=0;c>d;d++){var u=t.recipants[d].zuid;WmsImpl.isLocalUser(u)||(r=Users.getEmailId(u),o='<span class="'+Contacts.getStatusStyle(u)+'"></span>')}return i.replace(/{ADDITIONALINFO}/,r).replace(/{USERSTATUS}/,o).replace(/{TITLENAME}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{LASTMSGHTML}/g,$WC.Matcher.replace("escapeReplacementString",l))}function t(e,t,i){if(t.length>0&&-1!==t.indexOf(e))return!1;var a=i.length;if(a>0)for(var s=0,n=a;n>s;s++)if(!ChatsList.hasPermission(e,i[s]))return!1;return!0}return function(i){var a=this.getAll(),s={html:this.searchhtml,ignorelist:[],highlight:!0,limit:25};i=$.extend({},s,i);var n=i.val.toLowerCase(),r=i.html,o=i.permission,l=i.ignorelist,c=i.highlight,d=i.limit,u=[],m=[],p=[],h="",g=[],f=0;for(var v in a){var C=a[v];if(t(v,l,o))if("*"===n)u.push([C.title,v]);else{var y=C.title.toLowerCase().indexOf(n);if(-1===y)continue;0===y?u.push([C.title,v]):m.push([C.title,v])}}p=$Util.sort(u,0),f=p.length,d>f&&(p=p.concat($Util.sort(m,0))),p=p.slice(0,d),f=p.length;for(var b=0;f>b;b++){var v=p[b][1];g.push(v);var E=ChatsList.get(v);h+=e(v,E,r,n,c,E.ctype)}return{content:h,searchedlist:g}}}(),updateBulkPresence:function(e,t,i){var a=LeftPannel.container.find("[profileid='"+e+"']");this.updatePresence(a,e,t,i)},updatePresence:function(e,t,i,a){if(e.length>0){var s="";if("contact"===i)s=Contacts.getStatusStyle(t,a,!0);else if("group"===i&&"-1"===t)s=this.getDynamicGroupClass();else if("bot"===i)s="msi-boticon status";else if("channel"===i){var n=Channels.getByChid(e.attr("chid"));s="msi-sc"+n.sc+" msci"}var r=e.find("[purpose='status']");r.removeClass().addClass(s),r.attr("typing",""),r.attr("nname","")}},updateTypingStatus:function(e,t,i,a){{var s=LeftPannel.container.find("#tab"+e),n=s.find("#tabscode"+e);ChatsList.get(e)}if(!ChatUI.isMuted(e)&&t)n.addClass("msi-cht-1"),n.attr("typing",i),n.attr("nname",a),s.find("#msgcount"+e).hide();else{n.removeClass(),s.find("#msgcount"+e).show();var r=s.attr("profileid"),o=s.attr("profile");""!==o&&this.updatePresence(s,r,o,ChatUI.getParticipantStatus(e,r))}},updateMediaPlayingStatus:function(e,t,i){var a=LeftPannel.container.find("#tab"+e),s=a.find("#tabscode"+e);if(s.removeClass(),i)s.addClass("audioplayer"===t?"msi-audrun":"msi-vidorun"),a.find("#msgcount"+e).hide();else{a.find("#msgcount"+e).show(),ChatUI.isMuted(e)&&ChatUI.hasUnreadOrUnseenMsgs(e)?a.find("#msgcount"+e).addClass("mute"):a.find("#msgcount"+e).removeClass("mute");var n=a.attr("profileid"),r=a.attr("profile");"channel"!=r&&-1!=parseInt(n)?this.updateBulkPresence(n,r):this.updatePresence(a,n,r)}},removeallunreadchats:function(e){var t=ChatsList.getUnreadChats(e,!0);_print("removedunreadchats"," chatarr is ==>"+JSON.stringify(t)+" time: ===>"+new Date);for(var i=0;i<t.length;i++){var a=t[i].chid;ChatUI.removeNewmsgNotification(a,!0)}},deleteFromUnreadChatArr:function(e){if(!$.isEmptyObject(ChatsList.unreadchatarr)&&ChatsList.unreadchatarr.hasOwnProperty(e)){delete ChatsList.unreadchatarr[e];var t=ChatsList.get(e);t&&(t.unreadmsgs=0)}},updateMsgCount:function(e,t){var i=LeftPannel.container.find("#tab"+e);0>=t?(i.removeClass("actunrdmg").removeAttr("unread"),t="",LeftPannel.container.find("#msgcount"+e).removeClass("mute"),this.updateUnreadChatsList(e)):(i.addClass("actunrdmg").attr("unread",!0),ChatUI.isMuted(e)?LeftPannel.container.find("#msgcount"+e).addClass("mute"):(LeftPannel.container.find("#msgcount"+e).removeClass("mute"),this.updateUnreadChatsList(e))),i.find("#msgcount"+e).html(t),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateBadge(!0),this.updateUnreadNotifier()},updateUnreadChatsList:function(e){var t=this.getCatagory(e);this.updateChatsHeaderHtml(t)},updateChatsHeaderHtml:function(e){if("pinnedchats"===e||"chats"===e||"mutedchats"===e){var t=$("#"+e+"header"),i=t.find("#totalunreadcount"),a=!Settings.getFromObj("hp"+e),s=ChatsList.getUnreadChats(e).length;if(a?i.show():i.hide(),s>0?i.html(s):i.html("").hide(),"mutedchats"===e){var n=$("#"+e+"header").find("#markallread");s?n.addClass("active"):n.removeClass("active"),n.attr("title",Resource.getRealValue(s?"chat.markread.all":"chat.markread.none"))}if("chats"===e){ChatsList.showUnreadChatsView(!0);var n=$("#"+e+"header").find("#unreadfilter"),r="true"===n.attr("isfilterapplied");s?r?n.addClass("active").removeClass("inactive"):n.addClass("inactive").removeClass("active"):n.removeClass("inactive active")}}},updateShowMoreCount:function(e){var t=$("#"+e+"listholder"),i=t.find('[catagory="'+e+'"]'),a=$("#"+e+"header").find("#unreadfilter"),s="true"===a.attr("isfilterapplied"),n=t.find('[category="'+e+'"][expand]');if(n.length){var r=n.find("#unreadcount");n=n[0];var o=0;if("false"===n.getAttribute("expand")){s&&(i=t.find('[catagory="'+e+'"][unread]'));for(var l=10;l<i.length;l++)i[l].hasAttribute("unread")&&o++}o?r.html(o).show():r.html("").hide()}},handlePinForHeaderCount:function(e){ChatsList.updateUnreadChatsList(e)},removeBubble:function(e){this.updateMsgCount(e,0),this.updateShowMoreCount(this.getCatagory(e)),LeftPannel.container.find("#msgcount"+e).removeClass("mute");var t=$("#zcdashbdmain").find('[data-unread="'+e+'"]');HomeUI.removeOfflineDiv(t),"undefined"!=typeof DesktopApp&&DesktopApp.Dock.updateBadge()},getDynamicGroupClass:function(){return"msi-grpstatus-2"},updateUnreadNotifier:function(){function e(e){for(var t=0,i=0;i<e.length;i++){var a=$(e[i]);if("header"===a.attr("elemtype")){var s,n=a.attr("workfor");if("contact"===n){t+=Contacts.getPendingContactsList(!0).length;continue}if("chat"===n)var s=$("chatsheader"===a.attr("id")?"#chatslist":"#pinnedchatslist");unreadchatelems=s.find("[unread]");for(var r=0;r<unreadchatelems.length;r++){var o=$(unreadchatelems[r]).attr("chid");ChatUI.isMuted(o)||t++}}else t++}return t}var t=this.getUnreadChats(),i=this.getPendingContactsinLHS(),a=t.concat(i);listDOM=$("#leftpannel #list"),unreadnotifier=listDOM.find("#unreadnotifier"),counter=$(unreadnotifier).find("#counter"),listelem=listDOM[0],t.length>=1?$Util.loadfavicon(!0):0===t.length&&$Util.loadfavicon();for(var s=[],n=[],r=0;r<a.length;r++){var o="contact"==a[r].type,l=o?a[r].uid:a[r].chid;if(o||!ChatUI.isMuted(l)){var c=o?$("#contactinvitationsheader")[0]:$("#tab"+l)[0];if(!$(c).isScrolledToView(listelem,.5,.5)){var d=$Util.getScrollpositiontoView(c,listelem);if("invalid"==d){var u=t[r].type;switch(u){case"pinnedchats":c=$("#pinnedchatsheader")[0],d=$Util.getScrollpositiontoView(c,listelem);break;case"chats":c=$("#chatsheader")[0],d=$Util.getScrollpositiontoView(c,listelem);break;case"channels":var m=Channels.getByChid(l),p=(Channels.getLevel(m),Channels.getSubHeaderId(m)),c=$("#"+p+"header")[0];d=$Util.getScrollpositiontoView(c,listelem),"invalid"==d&&(c=$("#channelsheader")[0],d=$Util.getScrollpositiontoView(c,listelem))}}"top"==d?s.push(c):"bottom"==d&&n.push(c)}}}this.unreadelements.top=$Util.cloneArray($Util.removeDuplicateEntries(s)),this.unreadelements.bottom=$Util.cloneArray($Util.removeDuplicateEntries(n));var h=e(this.unreadelements.top),g=e(this.unreadelements.bottom);if(h>0||g>0){var f=h>0,v=f?h:g,C=Resource.getRealValue("chat.unread.scroll",[Resource.getRealValue(v>1?"common.shortcut.notifications":"common.shortcut.notification")]);$(unreadnotifier).removeClass("hidden").attr("title",C),f?$(unreadnotifier).removeClass("zcunrdcrbtmdwn"):$(unreadnotifier).addClass("zcunrdcrbtmdwn"),$(counter).html(v)}else $(counter).html(""),$(unreadnotifier).addClass("hidden").removeAttr("title")},getPendingContactsinLHS:function(){for(var e=[],t=$("#contactinvitationslist").find('[catagory="invitation"]'),i=0;i<t.length;i++){var a=$(t[i]),s=a.attr("uid"),n={uid:s,type:"contact"};e.push(n)}return e},getUnreadChats:function(e,t){var i=[],a=[];t=t?t:!1,i=$("#list").find('[catagory="'+e+'"][unread]'),"chats"===e&&t?i=$.merge(i,$("#list").find('[catagory="mutedchats"][unread]')):"undefined"==typeof e&&(i=$("#list").find('[catagory="chats"][unread]'),i=$.merge(i,$("#list").find('[catagory="pinnedchats"][unread]')));for(var s=0;s<i.length;s++){var n=$(i[s]),r=n.attr("chid"),o={chid:r,type:n.attr("catagory")};a.push(o)}return a},sortUnreadChatsByPosition:function(e,t){for(var i=[],a=0;a<e.length;a++){var s=[],n=e[a];s.push(n.id),s.push($(n).offset().top),i.push(s)}return $Util.sort(i,1,t)}},Chat={LINESLIMIT:50,participantssearchhtml:'<div uid="{USERID}" elemtype="contact" data-val="{DNAME}" purpose="search"><span class="usrimgsts"><img width="24" height="24" src="{IMGURL}"><span class="{STATUSCLASS}"></span></span><span id="contactdname{USERID}" class="usrname ellips">{DNAMEVAL}<em id="contactmailid{USERID}">{EMAILID}</em></span></div>',handleCreate:function(e){if(ChatUI.isExist(e.chid)){var t=ChatUI.exist[e.chid];t.update(e),Participants.updateParticipantsObj(e.chid,e.recipants,e.pcount),t.updateUI(),t.addChatInformation(),MainUI.getMefront(e.chid,!0)}else ChatUI.create(e)},checkForBots:function(e){var t=e.split(",");return 1===t.length&&Contacts.isBot(e)},create:function(e,t,i,a,s){if(!SecurityManager.hasPermission(Modules.DirectMessage))return void UserInfo.createUserRHSView(e);if(this.checkForBots(e)){var n=Contacts.get(e).chid;return void Chat.attachSession(n,!1)}var r={};r.type=t,r.attach="true",r.autojoin="false",r.sid=WmsImpl.getSid(),"inv_chat"===t?r.emailid=e:$WC.Matcher.check("emailid",e)?r.emailid=e:r.userList=e,"undefined"!=typeof i&&(r.title=i),"undefined"!=typeof a&&(r.msg=a),$ZCAjx.ajax({url:"/createim.do",type:"POST",data:r,protocol:"pex",success:function(t){if("string"!=typeof t){if(1==$Util.getObjectKeysLength(t)&&!$WC.$CUtil.isEmpty(t.chid)){var i=Chat.getTitleforCwin(t.chid,e);t.title=$WC.$CUtil.isEmpty(i)?"":i}if($WC.$CUtil.isEmptyObject(t)||"false"===t.chatavailable)return;t.createfrom="chat",Chat.handleCreate(t)}else-1===t.indexOf("Success")&&UI.updateBanner(Resource.getRealValue("chat.create.error"),2e3,!0);if(s)switch(s){case"one_newchat":ZCTrack.track("ADDMEMBER",{TYPE:"1-1 Chat",MODE:"New Chat"});break;case"smartchat":ZCTrack.track("CREATE_CHAT",{TYPE:"Smart Chat"})}}})},attachSession:function(e,t,i,a){if(ChatUI.isExist(e)){var s=ChatUI.exist[e];return s.createdbyme=!0,MainUI.getMefront(e,!0),void("function"==typeof i&&i())}ChatUI.isAttachPending(e)||ChatUI.attachpendingchats.push(e),$ZCAjx.ajax({url:"/attachsession.do",type:"POST",protocol:"pex",data:{chid:e,sid:WmsImpl.getSid()},ignorableerrorcodes:[11004],success:function(a){if(ChatUI.removefromAttachPendingList(e),"string"!=typeof a){var s=Chat.isChannelChid(e);if($WC.$CUtil.isEmpty(a)||$.isEmptyObject(a))a={},a.chid=e,a.title=ChatsList.isExist(e)?ChatsList.getTitle(e):"";else if(!s&&a.isremoveduser)return void $Util.showUserRemovedAlert(e);t?a.autojoin=!0:a.createfrom="chat",s?ChannelsUI.handleCreateChatWindow(a,a.autojoin):($WC.$CUtil.isEmpty(a.users)||"object"==typeof a.users||(a.users=JSON.parse(a.users)),Chat.handleCreate(a)),"function"==typeof i&&i()}},error:function(t){if(ChatUI.removefromAttachPendingList(e),$ZCVideoBroadcast.handleChatAttachFailed(e,t["I18N.KEY"]),!$WC.$CUtil.isEmpty(t)&&11004==parseInt(t.ERRCODE))if(ChatsList.isExist(e)){var i=ChatsList.getRecipientDatafor121chat(e),s=Resource.getRealValue("common.this.recipient");$.isEmptyObject(i)||(s="<b>"+Users.getName(i.zuid,i.dname)+"</b>"),$WC.$Dlg.confirm({id:"attachsessionerror",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("chat.attach.invalid.recipient.error",[s])]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-green"></div>'}),buttons:[{text:Resource.getRealValue("chat.goto.history"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){ChatHistory.load()}}],closefn:function(){ChatsList.delete(e)}})}else UI.updateBanner(Resource.getRealValue("chat.continue.nonorg.nonmutual.contact.failed",[Resource.getRealValue("common.this.recipient")]),3e3,!0);"function"==typeof a&&a(t)}})},makechatasunread:function(e,t,i){var a=$("#"+e),s=0;if(a.length){var n=a.find('[msguid="'+t+'"]');n.length&&(s=n.nextAll("[msguid]").length+1)}var r=ChatsList.get(e);r&&(r.unreadmsgs=s),Chat.quit(e),$ZCAjx.ajax({url:"/v2/chats/"+e+"/unread",type:"PUT",contentType:"application/json",data:{message_id:t,time:i},success:function(){ChatsList.markUnread(e,i)},error:function(){UI.updateBanner(Resource.getRealValue("message.option.markunread.failure"),2e3,!0)}})},jumpToConversation:function(e,t,i){if(ChatUI.isExist(e)){var a=ChatUI.exist[e];a.createdbyme=!0,MainUI.getMefront(e,a.createdbyme),a.scrollToSpecificMessage(t,i)}else Chat.attachSession(e,void 0,function(){ChatUI.exist[e].setScrollToMessage(t,i)})},join:function(e,t,i,a){return ChatUI.isChannel(t)?void Channels.handlejoin(e):void this.makejoinchatrequest(e,t,i,a)},makejoinchatrequest:function(e,t,i,a,s){$ZCAjx.ajax({url:"/joinchat.do",data:{chid:e,btf:i,autojoin:a,sid:WmsImpl.getSid()},type:"POST",success:function(t){if(ChatUI.isExist(e)){var i=ChatUI.exist[e];i.update(t),i.updateUI()}s&&Chat.isChannelChid(e)&&ChannelsUI.handleCreateChatWindow(t,!1)}})},markAllChatsRead:function(e){if("undefined"!=typeof e){for(var t=ChatsList.getUnreadChats(e),i=[],a=0;a<t.length;a++)i.push(t[a].chid);i.length&&$ZCAjx.ajax({url:"/markasread.do",data:{chid:i.join()},type:"POST",success:function(t){for(var i=t.chid.split(","),a=($("#chatwindowshideport"),0);a<i.length;a++)ChatUI.removeNewmsgNotification(i[a],!0),ChatUI.isExist(i[a])&&!ChatUI.isOpenedbyMe(i[a])&&MainUI.close(i[a]);$("#"+e+"header").find("#markallread").removeClass("active")}})}},quit:function(e,t,i,a){var s={chid:e,close:"true",unpin:t};"undefined"!=typeof a&&(s.triggerby=a),i&&(s.closeactive=!0,s.markseen=!0),this.checkAndCloseTour(e),$ZCAjx.ajax({url:"/quitchat.do",type:"POST",data:s,protocol:"pex"}),ChatUI.removeWindow(e)},checkAndCloseTour:function(e){var t=$("#onboardtour");t.length&&t.attr("chid")===e&&Tour.closeTour(!0)},pauseAllMedia:function(){var e=MediaPlayer.cache;for(var t in e)for(var i in e[t]){ChatsList.updateMediaPlayingStatus(i,"audioplayer",!1);for(var a in e[t][i])e[t][i][a].pause()}},pauseMedia:function(e,t){if(e){var i=MediaPlayer.cache;if(t){var a=e;if(ChatsList.updateMediaPlayingStatus(a,"audioplayer",!1),i[t]){for(var s in i[t][a])i[t][a][s].pause();i[t][a]={}}}else{var t=e;for(var a in i[t])for(var s in i[t][a])i[t][a][s].pause();i[t]={}}}},getUnfurledLinkDetails:function(e,t,i){var a={link:e};$ZCAjx.ajax({url:"/getunfurleddata.do",type:"POST",data:a,success:function(e){i(e)},error:function(){var e=ChatUI.exist[t],i=e.win().find("#urlinfopreview"+t);e.toggleLinkPreview(!1,i.attr("currentlink"))}})},sendMessage:function(e,t,i,a,s,n,r){var o={chid:e,msg:t,msgid:i,sid:WmsImpl.getSid(),dname:$WC.$CUtil.decodeHTMLEntities(WmsImpl.getNickName())},l=$("#urlinfopreview"+e).attr("unfurl");l=$WC.$CUtil.isEmpty(l)?!0:l,o.unfurl=l;var c=$WC.Matcher.check("linkRegExp",t)?$("#urlinfopreview"+e).attr("currentlink"):"";if($WC.$CUtil.isEmpty(c)||(o.link=c),"undefined"!=typeof n&&(o.repliedmsguid=n),!$WC.$CUtil.isEmpty(s)){var d=s.commandid;if("undefined"!=typeof d){o.commandid=d;var u=CommandSuggestions.getSelectedForExecution(e);CommandSuggestions.prevSugg="",$WC.$CUtil.isEmpty(u)||(o.selections=JSON.stringify(u)),Commands.updateRecentCommands({commandid:d,html:$("#composer"+e)[0].innerHTML}),CommandFileUploadUI.cleanUpCommandFiles(e),$WC.DivEditor.clear("composer"+e),IntegrationsCwin.showLoading(e)}}$WC.$CUtil.isEmpty(a)||"undefined"!=typeof a.msguid&&(o.msguid=a.msguid,o.notifyedit="undefined"!=typeof a.notify?a.notify:!1),s&&s.filesdetails&&s.filesdetails.length>0&&(o=$ZCAjx.formData(o,"files",s.filesdetails,!0)),Chat.checkAndCloseTour(e),1!=Settings.getFromObj("do_create_chat")&&(o.onboardingstepkey="do_create_chat",CheckList.markAsCompleted("do_create_chat"));var m={url:"/sendofficechatmessage.do",type:"POST",protocol:"pex",data:o,timeout:1e4,sendSID:!0,trialExecutionChid:e,status:{error:"chat.message.send.error"},success:function(i){if("undefined"!=typeof d)if(0>d)CommandsUI.handleSystemCommandResponse(e,d,i);else{var s=Commands.getObject(d);IntegrationsResponse.populateOutput({module:Integration.Components.Command,id:d,name:"/"+s.name,imageUrl:Commands.getImgUrl(d,s.scope)},i.dreResponse,e),HomeUI.markseenAndRemoveComponentDiv("homeui_"+d,"commands")}else if(Chat.trackSendMessage(t,c),"function"==typeof r&&r(e,i,a),"undefined"!=typeof i.dreResponse){var n,o;if("undefined"!=typeof i.dreResponse.component)n=i.dreResponse.component.id,o=i.dreResponse.component.name;else{var l=new $CliqChatId(e);l.isCustomBot()&&(n=MyBots.getBotId(e),o=MyBots.getNameByChid(e))}$WC.$CUtil.isEmpty(n)||IntegrationsResponse.populateOutput({module:Integration.Components.Bot,id:n,name:o,imageUrl:Users.getImgUrlById(n)},i.dreResponse,e)}},error:function(t){if($("#"+e).find('[msgtime="'+i+'"]').find("[purpose=time_star_holder]").after(Template.resendMessageHtml.replace(/{MSGTIME}/g,i).replace(/{CSSCLASS}/g,"absretry")),$("#"+e).find("#loadingline").remove(),Chat.isChannelChid(e)){var a=Channels.getByChid(e);$.isEmptyObject(a)||Channels.handleErrorCode(a.oc_id,t.ERRCODE,Channels.ACTIONS.SEND_MESSAGE)}},ontimeout:function(){$("#"+e).find('[msgtime="'+i+'"]').find("[purpose=time_star_holder]").after(Template.resendMessageHtml.replace(/{MSGTIME}/g,i).replace(/{CSSCLASS}/g,"absretry")),$("#"+e).find("#loadingline").remove();var t={chid:e,msgid:i,senderid:$zcg._ZUID,status:"Failed"};_print("ajaxcalls",[this.url,t,$Util.getSyncedCurrentTime()])}};if(s&&s.filesdetails&&s.filesdetails.length>0&&(m.processData=!1,m.contentType=!1),d)Commands.needsLocationForExecution(d)&&(m.setLocation=!0);else{var p=s?s.mentionedBotIds:void 0;MyBots.needsLocation(e,p)&&(m.setLocation=!0)}$ZCAjx.ajax(m)},trackSendMessage:function(e,t){if(Smiley.regexp.test(e))for(var i=$Util.removeDuplicateEntries(e.split(/ +/)),a=0;a<i.length;a++)if("undefined"!=typeof Smiley.smileyobj[i[a]]){var s=i[a],n=s in Smiley.shortcutsobj?Smiley.shortcutsobj[s]:s.split(":")[1];trackobj={NAME:$Util.getTitleString(Resource.getRealValue(s in Smiley.flagcodes?"flag."+n:"smiley."+n)),CODE:s},ZCTrack.track("SMILEY",trackobj)}if($WC.Matcher.check("linkRegExp",e,!0)){var r=$WC.Matcher.match("linkRegExp",e);if(!$WC.$CUtil.isEmpty(r))for(var a=0,o=r.length;o>a;a++){var l=$Util.getDomain(r[a]);l=l.match("zoho.com$")?l:"External",ZCTrack.track("UNFURLING",{Domain:l,Unfurl:!$WC.$CUtil.isEmpty(t)&&t===r[a]})}}},sendFile:function(e){if(e.file1.files&&$Util.isFilesizeExceeded(e.file1.files))return $Util.showInvalidFileAlert($("#file"+e.chid.value),e.file1.files.length>1?$Util.CUMULATIVEFILESIZE_INVALID:$Util.FILESIZE_INVALID),e.reset(),!1;for(var t={id:e.chid.value,sid:WmsImpl.getSid()},i=[],a=0;a<e.file1.files.length;a++){var s=e.file1.files.item(a),n=s.name,r=n.lastIndexOf("."),o=r>0?n.substring(r):"",n=r>0?n.substring(0,r):n;n=n.substring(0,FileUploadUI.MAX_ALLOWED_FILE_NAME_LENGTH-(o.length+1)),i.push([s,n+o])}var l=$ZCAjx.formData(t,"files",i,!0);$ZCAjx.ajax({url:"/v1/attachments",type:"POST",data:l,processData:!1,contentType:!1,success:function(t){if(!$WC.$CUtil.isEmpty(t)){var i=t.data,a=e.chid.value,s=new $CliqChatId(a);if(s.isCustomBot()&&"undefined"!=typeof i.dreResponse){var n=MyBots.getBotId(a);IntegrationsResponse.populateOutput({module:"bots",id:n,name:MyBots.getNameByChid(a),imageUrl:Users.getImgUrlById(n)},i.dreResponse,a)}else ChatUI.displayMsg(t.data)}}}),e.reset()},forwardAttachment:function(e,t,i,a,s,n,r){var o={id:t,type:e,mod:"att",sid:WmsImpl.getSid(),comment:n};r||(o.mime=s,o.fname=i,o.url=a);var l=r?"/v1/attachments/"+a+"/forward":"/fileforward.do";$ZCAjx.ajax({url:l,type:"POST",data:o,status:{error:"chat.attachment.forward.error"}})},getTranscriptFromRServer:function(e,t,i,a,s,n){var r={chid:e,partial:t,tzoffset:$zcg._TZOFFSET,lang:$zcg._LANG,ccode:$zcg._CCODE};"undefined"!=typeof i&&(r.fromtime=i),"undefined"!=typeof a&&(r.totime=a),"undefined"!=typeof n&&(r.lineslimit=n),"undefined"!=typeof t&&(r.partial=t),$ZCAjx.ajax({url:"/gettranscriptfromrsasjson.do",data:r,headers:{"Cache-Control":"no-cache,no-store,must-revalidate"},success:function(n){var r=ChatUI.exist[e];if(r&&r.removeLoading(),n=n.substring(0,n.length-1),n=JSON.parse("["+n+"]"),s(e,n,i,a,t),!$WC.$CUtil.isEmpty(r)){if(!$WC.$CUtil.isEmptyObject(r.scrollToMsg)){var o=r.scrollToMsg;r.scrollToMsg={},r.scrollToSpecificMessage(o.msgTime,o.sender)}r.storage.setAllMessages(n)}},error:function(){var n=ChatUI.exist[e];n&&n.removeLoading(),s(e,[],i,a,t)},networkerror:function(){var n=ChatUI.exist[e];n&&n.removeLoading(),ChatUI.showTranscriptRetryUI(e,i,a),s(e,[],i,a,t)}})},getMultipleTranscriptFromRServer:function(e,t){var i={list:JSON.stringify(e)};$ZCAjx.ajax({url:"/gettranscriptsasjsonforweb.do",data:i,success:function(e){t(e)},error:function(){t([])}})},getMsgHistoryTranscript:function(e,t,i,a){$ZCAjx.ajax({url:"/v2/chats/"+e+"/transcript/"+t,type:"GET",success:function(e){var t=e.transcript;"function"==typeof i&&i(t)},error:function(e){"function"==typeof a&&a(e)}})},deleteMessage:function(e,t,i){var a={};$WC.$CUtil.isEmpty(e)||$WC.$CUtil.isEmpty(t)||$WC.$CUtil.isEmpty(i)||(a.msgack_key=i,a.sid=WmsImpl.getSid(),$ZCAjx.ajax({url:"/v2/chats/"+e+"/messages/"+t,type:"DELETE",data:a,contentType:"application/json",success:function(){},error:function(){}}))},updateSenderForNewMsgsinTranscript:function(e,t){for(var i=0;i<t.length;i++)t[i].sender||MsgUtil.isChatMoreMsg(t[i])||(t[i].sender=e)},handleFetchTranscript:function(e){var t=e.chid,i=e.transcript,a=e.fromtime,s=e.totime,n=(e.partial,e.unreadtime),r=e.onreconnection;if(ChatUI.isExist(t)){var o=$("#"+t),l=o.find("#msgarea"),c=i.length,d="undefined"!=typeof a&&"undefined"==typeof s,u=ChatUI.exist[t];n="undefined"!=typeof n?n:-1,UIDataPersist.hasWindow(t)?n=UIDataPersist.handleUnreadTime(t,i):"-1"!=n&&(u.unreadtime=parseInt(n)),c>0&&d&&!u.isunread&&(ChatUI.hasUnreadOrUnseenMsgs(t)&&(u.removeNewmsgNotification(),u.isunread=i[c-1].time+1),n=i[c-1].time+1),!$.isEmptyObject(ChatsList.unreadchatarr)&&ChatsList.unreadchatarr.hasOwnProperty(t)&&(n=ChatsList.unreadchatarr[t]);var m={chid:t,unreadmarkertime:n};if(r&&(m.onreconnection=!0),c&&d){var p=l.find('[purpose="sender"]').last().attr("sender");"undefined"==typeof p&&(p=null),this.updateSenderForNewMsgsinTranscript(p,i)}var h=MsgUtil.formatTranscript(i,m);if(ChatUI.updateFirstMsgOffsetValue(s,a,l),MsgUtil.updateTranscript(l,h,a,s),l.hasClass("nwmsg")||a||s||l.hide().fadeIn(),c){if(_print("scroll","fetch transcript ===>"+ChatUI.getTitle(t)),Mentions.offlinemsgs)return void Mentions.handleOfflineUnreadMsg(t);if(d)u.getScrollDown();else{var g=parseInt(s)+1,f=l.find("[msgtime="+g+"][mtype]");f.length?$Util.scrollToViewportTop(f,o.find("#chatbody")):u.getScrollDown()}if(u.updateScrollClass(u.scrolltop),"undefined"==typeof s){var v=ChatUI.getTranscriptJSONToUpdateLastMsg(i);if("undefined"!=typeof v){v.time=parseInt(v.time),ChatsList.updateLastMsgInfoFromTranscript(t,v),u.lastmsgtime=v.time;var C=parseInt(i[i.length-1].time);ChatUI.updateWmsServerLastMsgTime(t,C),-1===u.unreadtime&&(u.unreadtime=ChatsList.unreadchatarr&&ChatsList.unreadchatarr.hasOwnProperty(t)?parseInt(ChatsList.unreadchatarr[t]):parseInt(v.time)+1)}}else if(-1===u.unreadtime){var v=ChatUI.getTranscriptJSONToUpdateLastMsg(i);"undefined"!=typeof v&&(u.unreadtime=ChatsList.unreadchatarr&&ChatsList.unreadchatarr.hasOwnProperty(t)?parseInt(ChatsList.unreadchatarr[t]):parseInt(v.time)+1)}}}},getDetails:function(e){var t=new $CliqChatId(e),i={};if(t.isChannel())i.type="channel",e=Channels.getChannelId(e),i.imgurl=Channels.getImgUrl(e,Channels.Org),i.name=Channels.getName(e,name);else if(t.isSystemChat())i.type="bot",e=MyBots.getBotId(e),i.name=Users.getName(e),i.imgurl=MyBots.getImgById(e);else{i.name=ChatsList.getTitle(e.toString()),i.type="adhocchat",i.imgurl=$zcg._IMGDEFAULTSTATICURL+"/groupicon-100.png";var a=ChatsList.getRecipientDatafor121chat(e);if("undefined"!=typeof a.zuid)i.imgurl=Users.getImgUrlById(a.zuid);else{var s=ChatHistoryTitleSearch.data[e.toString()];if("undefined"!=typeof s){var n=s.chid,r=ChatsList.getTitle(n,s.title);i.img=HistoryUI.getRecipantsPhoto($WC.$CUtil.isEmpty(s.participants)?{}:JSON.parse(s.participants),s.participantscount,Chat.parseAddinfo(s.addinfo),r,s.ctype,n,s.customgroup)}}}return i},setHistoryStorage:function(e,t,i){$ZCAjx.ajax({url:"/sethistorystorage.do",type:"POST",data:{chid:e,option:t},success:function(){"function"==typeof i&&i()},error:function(){UI.updateBanner(Resource.getRealValue("history.set.error",[t]),2e3,!0)}})},setTitle:function(e,t,i){$ZCAjx.ajax({url:"/settitle.do",protocol:"pex",type:"POST",data:{chid:e,title:t,uname:WmsImpl.getZuid()},success:function(i){"contact_rename"===i.module?Contacts.updateContactName(i.cntid,i.title):"user_rename"===i.module&&Users.updateUserName(i.cntid,t,e),WmsBarImpl.updateTitle(e,t)},error:function(){UI.updateBanner(Resource.getRealValue("chat.settiltle.error"),2e3,!0),ChatUI.exist[e].updateTitle(i)}})},clearTitle:function(e){$ZCAjx.ajax({url:"/cleartitle.do",type:"POST",data:{chid:e,uname:WmsImpl.getZuid()}})},sendStatus:function(e,t){"2"!==StatusController.getScode()&&$ZCAjx.ajax({url:"/sendstatus.do",type:"POST",protocol:"pex",data:{userid:WmsImpl.getZuid(),chid:e,status:""+t,sid:WmsImpl.getSid(),dname:$WC.$CUtil.decodeHTMLEntities(WmsImpl.getNickName())},success:function(e){AutoUpdater.handleLatestClientVersion(e.latestclientversion)}})},getGuesturl:function(e){var t=ChatUI.exist[e];if("true"===$zcg._ISNONORGMEMBERINVITEALLOWED&&$WC.$CUtil.isEmpty(t.guesturl)){var i={};i.chid=e,i.sid=WmsImpl.getSid(),$ZCAjx.ajax({url:"/getguesturl.do",type:"GET",data:i,success:function(e){ChatUI.updateGuestData(e,"url"),t.populateGuest()},error:function(){UI.updateBanner(Resource.getRealValue("chat.guest.url.error"),2e3,!0),$zcg._ISNONORGMEMBERINVITEALLOWED="false",t.guesturl=""}})}else $WC.$CUtil.isEmpty(t.guesturl)||t.populateGuest()},addMember:function(e,t,i,a){if(ChatUI.exist[e].isChannel())return void Channels.invite(e,t,"",a);a=a||{};var s={chid:e,ulist:t};$ZCAjx.ajax({url:"/addmember.do",type:"POST",data:s,success:function(){if("samechat"==i){var t=ChatUI.exist[e];t.isGroupChat()&&ZCTrack.track("ADDMEMBER",{TYPE:"Group Chat",MODE:"Same Chat"})}"one_samechat"==i&&ZCTrack.track("ADDMEMBER",{TYPE:"1-1 Chat",MODE:"Same Chat"}),"function"==typeof a.success&&a.success()},error:function(){"function"==typeof a.error&&a.error()}})},deleteMember:function(e,t){if(ChatUI.exist[e].isChannel())return void Channels.deleteMember(e,t);for(var i=0,a=t.length;a>i;i++){var s=t[i];-1!==s.indexOf("|")&&(s="*"+WmsImpl.getZuid()+"|"+s),t[i]=s}$ZCAjx.ajax({url:"/deletemember.do",type:"POST",data:{chid:e,ulist:t.join(",")}})},leave:function(e){if(ChatUI.exist[e].isGroupChat()){var t=ChatsList.get(e),i=function(e){$ZCAjx.ajax({url:"/v2/chats/"+e+"/leave",type:"POST",success:function(){ChatUI.isExist(e)&&(ChatUI.removeWindow(e),$ZCVideoBroadcast.handleDelete(e)),ChatsList.isExist(e)&&ChatsList.delete(e)},error:function(e){UI.updateBanner(Resource.getRealValue(e.code),3e3,!0)}})};$WC.$Dlg.create({id:"leavegroupchat",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-exit clr-red"></div>',header:Resource.getRealValue("chat.leave.header",[$WC.$CUtil.processXSS(t.title)]),subheader:Resource.getRealValue("chat.leave.subheader")}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("chat.leave.info1"),Resource.getRealValue("chat.leave.info2")]}),buttons:[{text:Resource.getRealValue("chat.leave.yes"),colour:$WC.$Dlg.RED_BUTTON,action:function(){i(e)}},{text:Resource.getRealValue("chat.leave.mute"),colour:$WC.$Dlg.GREY_BUTTON,action:function(){Chat.muteChat(e,!0,-1)}}]})}},setGuestAccess:function(e,t){$ZCAjx.ajax({url:"/setguestaccess.do",type:"POST",data:{chid:e,allow:t}})},propagateMsgSeen:function(e,t){$ZCAjx.ajax({url:"/propagatemsgseen.do",type:"POST",data:{chid:e,mentionmsgid:t},ignorableerrorcodes:[$EC.SECURITY_IPLOCKED]})},getPinnedChats:function(){$ZCAjx.ajax({url:"/v1/chats",type:"GET",data:{pinned:!0,joined:!0},success:function(e){var t=Chat.formatChatsFetchResponse(e.data.chats);ChatsList.update({fromserver:!0,resp:t,ispinned:!0},"pinnedchats")}})},getMutedChats:function(){$ZCAjx.ajax({url:"/v1/chats",type:"GET",data:{muted:!0,pinned:!1,joined:!0},success:function(e){var t=Chat.formatChatsFetchResponse(e.data.chats,!0);ChatsList.update({fromserver:!0,resp:t,ismuted:!0},"mutedchats")}})},getRecentChatsFromServer:function(e,t){e=e?e:-1,t=t?t:10;var i={limit:t,fromtime:e,muted:!1,pinned:!1,joined:!0,closed:!1};$ZCAjx.ajax({url:"/v1/chats",type:"GET",data:i,success:function(e){var t=Chat.formatChatsFetchResponse(e.data.chats);ChatsList.update({fromserver:!0,resp:t},"chats")}})},formatChatsFetchResponse:function(e,t){t&&!ChatsList.mutedchats&&(ChatsList.mutedchats=[]);for(var i={},a=0;a<e.length;a++){var s=e[a].chatid;i[s]=e[a],t&&ChatsList.mutedchats.indexOf(s)<0&&ChatsList.mutedchats.push(s)}return i},muteChat:function(e,t,i){$ZCAjx.ajax({url:"/mutechat.do",type:"POST",data:{chatid:e,mute:t,time:i},success:function(){var a=-1!==parseInt(i)?$Util.getSyncedCurrentTime()+1e3*i:-1;ChatUI.updateMuteStatus(e,t?1:0,t?a:-1)}})},markUnmarkPinnedChat:function(e,t){$ZCAjx.ajax({url:"/markchataspinned.do",type:"POST",data:{chatid:e,pin:t},success:function(t){var i=t.status,a=t.purpose;"true"===i?ChatsList.pinUnpinChat(a,e):UI.updateBanner(Resource.getRealValue("pin"===a?"chat.mark.pin.error":"chat.mark.unpin.error"),2e3,!0)}})},isAllowedUser:function(e,t){var i=Participants.get(e).recipants;return!$WC.$CUtil.isEmpty(i)&&i.length>0?!(i.indexOf(t)>=0):void 0},getParticipantDetails:function(e,t,i){new $CliqChatId(e);$ZCAjx.ajax({url:"/v1/chats/"+e+"/participants?zuid="+t,type:"GET",success:function(e){i(e.data)}})},getParticipants:function(e,t,i){if(!$WC.$CUtil.isEmpty(e)){var a=Chat.isChannelChid(e);if(a){var s=Channels.chidmap[e];if($WC.$CUtil.isEmpty(s)&&!Channels.isExist(s))return}$ZCAjx.ajax({url:"/v1/chats/"+e+"/participants",type:"GET",success:function(s){if(ChatUI.isExist(e)&&!$WC.$CUtil.isEmpty(s)&&!$WC.$CUtil.isEmpty(s.data)){var n=s.data.users,r=ChatUI.exist[e],o=Participants.get(e);o.destroyObj(),o.addParticipants(n),r.updateWinHeader(),r.addChatInformation(),ChatsList.updateParticipants(e,n),"function"==typeof i&&i(n),t&&(a?ParticipantsWin.updateChannelParticipantsUI(!1):ParticipantsWin.populateDefaultResult("participants")),a&&Channels.updateParticipantCount(e,o.pcount)}}})}},parseAddinfo:function(e){var t={};if(e=$.trim(e),e.length>0)if(-1===e.indexOf(":"))t.CT_TYPE=0;else for(var i=e.split(":"),a=0,s=i.length;s>a;a+=2)t[i[a]]=i[a+1];return t},getGroupId:function(e){var t={};return"string"==typeof e?ChatUI.isExist(e)?t=ChatUI.exist[e].addinfo:$.isEmptyObject(e=ChatsList.get(e).addinfo)||(t=e):t=e,$.isEmptyObject(t)||parseInt(t.CT_TYPE)!==$zcg.CT_NFY_ZOHOGROUP?null:t.GROUPID},isChannelChid:function(e){var t=new $CliqChatId(e);return t.isChannel()},hasProfile:function(e){return null!==e?Contacts.isExist(e)&&-1!=Contacts.getStatus(e)||Users.isSameOrg(e):!1},getTitleforCwin:function(e,t){var i,a=new $CliqChatId(e),s=t.split(",");if(a.isChannel()){var n=Channels.getDisplayNameForChannel(Channels.getByChid(e));n&&(i=n)}else ChatsList.isExist(e)?i=ChatsList.getTitle(e):1==s.length&&(i=Users.getName(s[0]));return i},removefromRC:function(e){$ZCAjx.ajax({url:"/v1/chats/"+e+"/close",type:"POST"})},getAllowedUsers:function(e){var t=function(e){for(var t={},i=e.length,a=0;i>a;a++){var s=e[a];t[s.zuid]={DNAME:Contacts.getDisplayName(s.zuid)||s.dname,ZUID:s.zuid,EMAILID:s.email}}return t},i=e.chid,a={},s=!0;return Chat.isChannelChid(i)&&Channels.getAllowedUsers(new $CliqChatId(i),function(n){n&&(Channels.AllowedUsers[i]=n),s=!1,n.length?(e.customobject=t(n),e.contactshtml=e.html,a=SearchAgent.getCustomSearchResults(e),e.successcallback(a.content,e.listid,e.populateid)):e.emptycallback(e.val,e.listid,e.populateid)}),{searchedlist:a.searchedlist||[],content:a.content||"",furtherreq:s}},isExists:function(e){return ChatUI.isExist(e)},removeDeletedMsgInOtherArea:function(e){var t=e.chid,i=MsgUtil.getDelMsgVisibility(e);i?Mentions.updateDeletedMention(e):(MessageOperations.delete.add(t,e),Mentions.deleteMentionFromStorage(Mentions.getMentionMsgId(e)));var a=ChatUI.exist[t],s=ChatsList.get(t),n=!1;if(s&&s.lastmsginfo){var r=s.lastmsginfo;n=r.time==MsgUtil.getTimefromMsgObj(e)||r.time==e.time}if(a&&!i){var o=a.storage;if(o.removeMessage(e.msguid),n){var l=ChatUI.getTranscriptJSONToUpdateLastMsg(o.getAllMessages());e=l?l:e}}n&&(ChatsList.updateLastMsgInfo(e,t,!0),WmsBarImpl.updateDeletedMsgInfo(e)),$ZCAjx.removeFromCacheByUrlandChid("/gettranscriptasjsonforweb.do",t)},updateEditedMsgInOtherArea:function(e){Mentions.updateEditedMention(e),$ZCAjx.removeFromCacheByUrlandChid("/gettranscriptasjsonforweb.do",e.chid)}},ChatNotify={checkAndEnableDNPermissionUI:function(){var e=Settings.getFromObj("dnpopup_viewedtime");if("undefined"!=typeof Notification&&"default"===Notification.permission&&e>=0&&(new Date).getTime()>e){var t=Template.DNPermissionUI;$("#loadingline").before(t)}},showBrowserPermissionPopUp:function(){$("#desktopnoti_popup").fadeOut(300,function(){$("#desktopnoti_popup").remove()}),Notification.requestPermission().then(function(e){if("granted"===e)Settings.update({dnpopup_viewedtime:"-1"});else{var t=(new Date).getTime()+2592e6;Settings.update({dnpopup_viewedtime:t})}})},requestPermission:function(){$WC.DesktopNotification.requestPermission()},notify:function(e){this.requestPermission();var t=MsgUtil.getMsgObjVersion(e);if("v0"==t&&(e=$WC.CMsgUtil.convertMsgObj(e)),"undefined"==typeof e.m||MsgUtil.pushForceNotification(e)){var i=e.chid,a=MsgUtil.isCustomSender(e)?e["custom.sender"].name:ChatBot.isBot(e.chid)?ChatBot.getTitle():Users.getName(e.sender,e.dname);a=$WC.$CUtil.decodeHTMLEntities(a);var s="";s=$.isEmptyObject(e.info)||"undefined"==typeof e.info.mod?Resource.getRealValue("common.says.extended",[ChatsList.isOnetoOneChat(i)||ChatsList.isBotChat(i)||$WC.$CUtil.isEmpty(e.title)?"@"+a:a+" @"+$WC.$CUtil.decodeHTMLEntities(e.title)]):Resource.getRealValue("chat."+e.info.mod+".shared",[ChatsList.isOnetoOneChat(i)||ChatsList.isBotChat(i)?"@"+a+" ":a+" "]),NotifyByTitle.show(s),(!$zcg._WINFOCUS||$zcg._WINFOCUS&&!MainUI.isChatinViewport(e.chid))&&this.visual(e),(1===parseInt(e.a)||$Util.wmsnotifyowner.isOwner())&&this.sound(e)}},visual:function(e){function t(e,i,a){return"undefined"==typeof a?"":$WC.Matcher.replace("removehtmltag",a,t)}if(this.hasPermission(e,"visual")){var i=e.chid,a=MsgUtil.isCustomSender(e)?MsgUtil.isCustomSenderImage(e)?e["custom.sender"].img:Users.getDefaultImgUrl():Users.getImgUrlById(e.sender),s=MsgUtil.isCustomSender(e)?e["custom.sender"].name:ChatBot.isBot(i)?ChatBot.getTitle():Users.getName(e.sender,e.dname),n="",r="",o=ChatUI.exist[e.chid];if(s=$WC.$CUtil.decodeHTMLEntities(s),"16"===e.mtype)return;Settings.getFromObj("msgnotify")?(a=$Util.getImgStaticUrl()+"/chaticon.png",o.isChannel()&&(a=Channels.getImgUrlByChid(e.chid)),r=$WC.$CUtil.isEmpty(e.title)||s===e.title?Resource.getRealValue("common.zoho.chat"):$WC.$CUtil.decodeHTMLEntities(e.title),n=Resource.getRealValue(Mentions.isMine(e)?"notification.mention":"notification.message")):(e.ctype==$zcg.NO_OPERATIONCHAT&&(a=MyBots.isBotChid(e.chid)?MyBots.getImgByChid(e.chid):ChatBot.getImgUrl()),r=Mentions.isMine(e)?s+" "+Resource.getRealValue("common.mentioned")+" "+Resource.getRealValue("common.you.small")+($WC.$CUtil.isEmpty(e.title)||s===e.title?"":" "+Resource.getRealValue("common.in")+" "+$WC.$CUtil.decodeHTMLEntities(e.title)):ChatsList.isOnetoOneChat(i)||ChatsList.isBotChat(i)||$WC.$CUtil.isEmpty(e.title)?"@"+s:s+" @"+$WC.$CUtil.decodeHTMLEntities(e.title),$.isEmptyObject(e.info)||"undefined"==typeof e.info.mod?(n=MsgUtil.isMentionMsg(e.msg)?MsgTemplate.getDisplayableMention(e,e.msg,'<span class="hvrinfo {CLASSMINE}" mentionedid="$1" {MENTIONATTRIBUTES}>$2</span>:'):e.msg,n=MsgUtil.getDisplayableSilentUserMentionMsg(n),n=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("img","src"),null,n,"$4"),n=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("a","href"),null,n,"$4"),n=$WC.Matcher.replace("horizontal_rule_tag",n," --- "),n=$WC.Matcher.replace("removehtmltag",n,t),n=$WC.$CUtil.decodeHTMLEntities(n)):n=Resource.getRealValue("chat."+e.info.mod+".shared",[""])),$Util.notify({type:"message",chid:i,icon:a,title:r,body:n,isattached:e.a,clickcallback:function(){ChatUI.exist[i]&&MainUI.getMefront(i,!0)},replyable:0===Settings.getFromObj("msgnotify"),replycallback:function(e){Chat.sendMessage(i,e,$Util.getSyncedCurrentTime())}})}},sound:function(e){var t=ChatUI.isExist(e.chid),i=ChatUI.exist[e.chid];if(this.hasPermission(e,"sound")&&("undefined"==typeof DesktopApp||!DesktopApp.isAudioMuted))if(Mentions.isMine(e)){var a;a=Settings.getFromObj(Settings.getFromObj("mentionsoundnotify")?"smention":i.isOnetoOneChat()?Settings.getFromObj("mymsgsoundnotify")?"smymessage":"smessage":"smessage"),Sound.play(Sound.tonemapping[a])}else if(i.isOnetoOneChat()){var a=Settings.getFromObj(Settings.getFromObj("mymsgsoundnotify")?"smymessage":"smessage");Sound.play(Sound.tonemapping[a])}else t&&Settings.getFromObj("msgsoundnotify")&&Sound.play(Sound.tonemapping[Settings.getFromObj("smessage")])},clear:function(){NotifyByTitle.stop()},hasPermission:function(e,t){var i=ChatUI.exist[e.chid];if(parseInt(MySelf.scode)===$zcg.CON_BUSY)return!1;if("visual"==t){if(1===Settings.getFromObj("vmessage"))return!0;if(1===Settings.getFromObj("vmymessage")&&i.isOnetoOneChat())return!0;if(1===Settings.getFromObj("vmention")&&Mentions.isMine(e))return!0}if("sound"==t){if(0===Settings.getFromObj("globalsoundnotify"))return!1;if(1===Settings.getFromObj("msgsoundnotify"))return!0;if(1===Settings.getFromObj("mymsgsoundnotify")&&i.isOnetoOneChat())return!0;if(1===Settings.getFromObj("mentionsoundnotify")&&Mentions.isMine(e))return!0}return!1}};var $CliqChatId=function(e){this.chid=e;var t=e.split("_",3);if(3==t.length){this.prd=t[0],this.wmsChid=t[1],this.restoreKey=t[2];var i=this.restoreKey.split("-",2);this.scopeId=i[0],2==i.length?this.chatType="C4"==i[1]?this.RestoreTypes.CHANNEL:i[1]:1==i.length&&(this.chatType=this.RestoreTypes.CHANNEL)}else this.wmsChid=e};$CliqChatId.prototype={RestoreTypes:{CHANNEL:1,TAZ:"B1",CUSTOM_BOT:"B2"},isChat:function(){return"undefined"==typeof this.chatType},isChannel:function(){return this.chatType===this.RestoreTypes.CHANNEL},isDefaultBot:function(){return this.chatType===this.RestoreTypes.TAZ},isCustomBot:function(){return this.chatType===this.RestoreTypes.CUSTOM_BOT},isSystemChat:function(){return this.isDefaultBot()||this.isCustomBot()}};var $Cwin=function(e){this.ctype=1,this.id=e,this.chid=e,this.creator=null,this.title=null,this.history=1,this.mute=0,this.mutedinterval=-1,this.guest=0,this.guesturl=null,this.cscode=null,this.unreadmsgcount=0,this.addinfo={},this.cursearchval="",this.curtrigger="",this.suggesttoadd=[],this.dragtimer="",this.dragtimercomp="",this.reconnect=!1,this.scrolltop=0,this.scrolldown=!1,this.allowedtriggers=$Util.cloneArray(Composer.defaultTriggers.allowedtriggers),this.currenttriggers=[],this.msghidetimer="",this.scrolltimer="",this.linkData={},this.previewtimer="",this.unreadtime=-1,this.lastmsgtime=-1,this.wmslmsgtime=-1,this.mediaplaying=!1,this.iscomposerdisabled=!1,this.isMediaChatRunning=!1,this.ishoffconfirmationshown=!1,this.lastEnterKeyTime=-1,this.composerheight=0,this.createdbyme=!1,this.isreadyforfetching=!0,this.scrollToMsg={},this.showemptystatemsg=!1,this.customgroup=!1,this.storage=new TranscriptStorage,this.randomhelptip=this.getRandomHelpText(),this.UploadFileConstructed=!1};$Cwin.prototype.getRandomHelpText=function(){var e=[Resource.getRealValue("chat.helptip.emoji"),Resource.getRealValue("chat.helptip.slash")];return e[Math.floor(Math.random()*e.length)]},$Cwin.prototype.win=function(){return $("#"+this.chid)},$Cwin.prototype.getMefront=function(){!ChatUI.isCurrent(this.chid)&&MainUI.isChatPaneView()&&MainUI.getMefront(this.chid,!0),this.removeNewmsgNotification()},$Cwin.prototype.getPermission=function(){var e=1;return $.isEmptyObject(this.addinfo)?this.isGroupChat()&&(e=$zcg.CT_NFY_ZOHOGROUP):e="undefined"!=typeof this.addinfo.EVENTUID?$zcg.CT_NFY_ZOHOGROUP:this.addinfo.CT_TYPE,(this.isChannel()||this.isSystemChat()||this.isEntityChat())&&(e=this.ctype),ChatUI.getPermissions(""+e)},$Cwin.prototype.getMessageOptions=function(){var e=MessageOperations.FORWARD|MessageOperations.FORK|MessageOperations.EDIT|MessageOperations.DELETE,t=!0;return this.isChannel()&&(t=ChannelsPermission.hasPermission(Channels.ACTIONS.SEND_MESSAGE,new $CliqChatId(this.chid))),e=t?e|MessageOperations.REPLY:e},$Cwin.prototype.updateTriggers=function(e){var t=Channels.getChannelId(this.chid);if(this.isChannel()){var i=Channels.getObject(t);if($WC.$CUtil.isEmpty(e)||$WC.$CUtil.isEmpty(e.orgid)||(this.orgid=e.orgid),$WC.$CUtil.isEmpty(e)||$WC.$CUtil.isEmpty(e.orggroups)||(this.orggroups=e.orggroups),this.allowedtriggers=[":"],SecurityManager.hasPermission(Modules.Commands)&&this.allowedtriggers.push("/"),this.isSharedChannel()||this.isPrivateChannel()||Channels.hasAnyAdvancedRules(i)){var a=this.allowedtriggers.indexOf("#");-1!==a&&this.allowedtriggers.splice(a,1)}if(ChannelsPermission.hasPermission(Channels.ACTIONS.SPECIAL_MENTIONS,i)&&(this.allowedtriggers.push("#"),this.allowedtriggers.push("cc:@"),this.allowedtriggers.push("cc:")),ChannelsPermission.hasPermission(Channels.ACTIONS.MENTION_USERS,i)&&this.allowedtriggers.push("@"),ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,i)&&this.allowedtriggers.push("+"),this.isCrossProductChannelChat()){var s=this.allowedtriggers.indexOf("+");-1!==s&&this.allowedtriggers.splice(s,1);var n=this.allowedtriggers.indexOf("-");-1!==n&&this.allowedtriggers.splice(n,1)}}else this.isCrossProductChat()?this.allowedtriggers=["+",":"]:this.isSystemChat()?this.allowedtriggers=[":","/","@"]:$WC.Matcher.check("emailid",this.addinfo.PEND_INV)&&(this.allowedtriggers=[":","/","@","cc:","cc:@"]);this.currenttriggers=this.allowedtriggers},$Cwin.prototype.updateEmptyStateStatus=function(e){this.showemptystatemsg=e?!0:!1},$Cwin.prototype.isEmptyStatePending=function(){return this.showemptystatemsg},$Cwin.prototype.isNewChat=function(e){var t=e.nc?parseInt(e.nc):0;return 1===t||"true"==e.newchat},$Cwin.prototype.update=function(e){this.addinfo=Chat.parseAddinfo(e.addinfo),this.history=e.history?parseInt(e.history):1,this.guest=e.guest?parseInt(e.guest):0,this.creator=e.creator?e.creator:null,this.ctype=parseInt(e.ctype),this.updateTriggers(e);var t,i,a=Participants.get(this.chid),s=e.title?e.title:"";if("true"==e.customgroup&&(this.customgroup=!0),e.users)a.addParticipants(e.users,e.pcount);else{var n=e.pcount?parseInt(e.pcount):2;if(!this.isChannel()&&(2>=n&&($WC.$CUtil.isEmpty(e.t121t)?$WC.$CUtil.isEmpty(e.sender)||WmsImpl.isLocalUser(e.sender)||(t=[e.sender,WmsImpl.getZuid()]):(i=JSON.parse(e.t121t),t=Object.keys(i)),this.isDefaultBot()&&(s=$WC.$CUtil.isEmpty(ChatBot.getTitle(this.chid))?e.title:ChatBot.getTitle(this.chid))),"undefined"!=typeof e.recipants&&(t=e.recipants.split(",")),t&&t.length)){a.recipants=t,a.updateParticipantCount(t.length);var r=a.getRecipientFor121Chat();i&&r&&!Users.isExist(r)&&(s=i[r])}this.reconnect&&parseInt(a.getPcount())!==n&&Chat.getParticipants(e.chid,!0)}!s&&this.customgroup&&(s=Resource.getRealValue("chat.adhoc.title"),_sendDebugMail("Custom Group has been set as true and title is empty for the chid "+this.chid,"Empty title and Custom group true")),this.updateTitle(s),this.addToUserChatMap();var o={title:this.title,addinfo:e.addinfo,pcount:a.getPcount(),ctype:this.ctype,customgroup:this.customgroup};return a.getPcount()>0&&(o.recipants=a.getParticipantsDetail()),o},$Cwin.prototype.addToUserChatMap=function(){if(this.isOnetoOneChat()){var e=Participants.get(this.chid).getRecipientFor121Chat();e&&ChatUI.addToUserChatmap(e,this.chid)}},$Cwin.prototype.updateUI=function(){this.updateWinHeader()},$Cwin.prototype.updateWinHeader=function(){var e=this,t=this.win(),i=t.find("#header"),a=this.chid,s=i.find("#usrsmsg"+a),n=Participants.get(this.chid),r=n.getPcount(),o=!1;if(this.isBot()||r||(o=!0),this.updateTitle(this.title),this.updateChatImage(o),o)return void s.attr("class","zcloadstatus");if(s.attr("class","hdrstatus ellips"),this.isSystemChat()||this.isChannel()||this.isGroupChat()){if(s.empty().removeAttr("title"),!this.isSystemChat()&&r>0){var l=Resource.getRealValue(r>1?"chat.participants.count":"channel.tip.joinedparticip",[r]);s.html(this.hasPariticipantViewPermission()?'<a href="javascript:;">'+l+"</a>":l),s.find("a").off("click").on("click",function(t){t.stopImmediatePropagation(),e.constructParticipantsUI()})}if(this.isChannel()&&ChannelsUI.updateIcon(Channels.getByChid(a)),this.isDefaultBot())s.html('<span class="msi-boticon mrgR5"></span>'+Resource.getRealValue("chatbot.smsg"));else if(this.isCustomBot()){var c=MyBots.getBotId(a),d=Contacts.getContactSmsg(c);d=$WC.$CUtil.isEmpty(d)?Resource.getRealValue("chatbot.smsg"):d,s.html('<span class="msi-boticon mrgR5"></span>'+d)}}else{var u=n.getRecipientFor121Chat();u?(n.updateRecipantStatus(),this.isOnetoOneChat()&&!Contacts.isExist(u)&&Users.getName(u)!=this.title&&Users.get(u,"chatwindow",function(){ChatUI.isExist(a)&&ChatUI.exist[a].updateRecipientName(u)})):$WC.Matcher.check("emailid",this.addinfo.PEND_INV)&&s.html('<span class="usrstatus zcstatus-0 hdrsts"></span><span class="vtm">'+Resource.getRealValue("invitees.chat.header.status")+"</span>"),s.off()}},$Cwin.prototype.hasPariticipantViewPermission=function(){return this.isChannel()?ChannelsPermission.hasPermission(MActions.ViewParticipants,Channels.getLevel(Channels.getByChid(this.chid))):!0},$Cwin.prototype.addChatInformation=function(){var e=this.win().find("#msgarea");if(this.isEmptyStatePending()&&0==this.win().find("#chatinformation"+this.chid).length&&(e.find("#loadingoldmsgs").remove(),""==e.html())){var t=this.chid,i=Participants.get(t);if(this.isCustomBot())this.win().find("#chatbody").prepend('<div id="chatinformation'+t+'"><div class="mrgT25 textcent zcemptystate"><div class="font12 ital clr6">'+Resource.getRealValue("bots.chat.subscription",MyBots.getNameByChid(t))+"</div></div></div>");else if(this.isChannel()){var a=Channels.getByChid(t);if($.isEmptyObject(a)||!ChannelsPermission.hasPermission(Channels.ACTIONS.SEND_MESSAGE,a))return;var s='<div class="rds4 chtch cur" elemtype="channel" hover="true" uid="'+a.oc_id+'" >'+ChannelsUI.getImageByChid(t)+"</div>",n=Template.EmptyState.channel.replace(/{CHANNELIMAGE}/g,s);this.win().find("#chatbody").prepend('<div id="chatinformation'+t+'" class="zcemptystate" data-purpose="zcemptystate">'+n+Template.EmptyState.button.replace(/{CHID}/g,t)+"</div>"),this.updateEmptyStateStatus(!1)}else if(i.recipants){var r=i.recipants;if(this.isOnetoOneChat()){var o=$WC.$CUtil.processXSS(Users.getName(i.getRecipientFor121Chat()));if(!$WC.$CUtil.isEmpty(o)){var n=Template.EmptyState.chat.replace(/{PARTICIPANTS}/g,ChatUI.getParticipantsImgHTML(t)).replace(/{RECIPIANT}/g,o);this.win().find("#chatbody").prepend('<div id="chatinformation'+t+'" class="zcemptystate" data-purpose="zcemptystate">'+n+Template.EmptyState.button.replace(/{CHID}/g,t)+"</div>")}}else if(this.isGroupChat()&&Object.keys(r).length==parseInt(i.getPcount())){var l=$WC.$CUtil.processXSS(QuickChat.emptyStateAdhocChatTitle($Util.cloneArray(r)));if(!$WC.$CUtil.isEmpty(l)){var n=Template.EmptyState.adhocchat.replace(/{PARTICIPANTS}/g,ChatUI.getParticipantsImgHTML(t)).replace(/{RECIPIANT}/g,$WC.Matcher.replace("escapeReplacementString",l));this.win().find("#chatbody").prepend('<div id="chatinformation'+t+'" class="zcemptystate" data-purpose="zcemptystate">'+n+Template.EmptyState.button.replace(/{CHID}/g,t)+"</div>")}}this.updateEmptyStateStatus(!1)}}},$Cwin.prototype.disableComposer=function(e,t,i){if(MainUI.isChatView(e)){this.iscomposerdisabled=!0;var a=MainUI.container.find("#"+e);if(a.find("#triggeratt"+e).hide(),a.find("#triggersmileys"+e).hide(),a.find("#chatinvite"+e).hide(),a.find("#helptip").css("visibility","hidden"),i)$WC.DivEditor.disableEditor("composer"+e,t),a.find("#triggeractions"+e).hide(),a.find("#chataddoptions").hide();else{var s=Template.DisableComposer.replace("{DISABLEMSG}",t);$("#"+e).find("#chatwindropdown").replaceWith(s)}this.getScrollDown()}},$Cwin.prototype.updateTitle=function(e){if(""===e){e=this.title;var t=Participants.get(this.chid);this.isOnetoOneChat()&&t.recipants.length&&(e=Users.getName(t.getRecipientFor121Chat()))}this.title=$WC.$CUtil.decodeHTMLEntities(e);var e=this.win().find("#title"+this.chid);if(e.text(this.title).attr({"data-val":this.title,title:this.title,spellcheck:"false"}),ChatsList.updateElement(this.chid,$WC.$CUtil.processXSS(this.title),!1,this.isChannel()),this.isChannel()){e.removeAttr("contenteditable");var i=Channels.getByChid(this.chid),a=this.title;$WC.$CUtil.isEmpty(i)||$.isEmptyObject(i)||(this.title=i.cn,a=Channels.getDisplayNameForChannel(Channels.getByChid(this.chid))),e.text(a).attr({"data-val":this.title,title:a,spellcheck:"false"})}else this.isSystemChat()?e.removeAttr("contenteditable"):this.isGroupChat()&&this.updateChatImage();this.updateAdditionalOptionsUI()},$Cwin.prototype.updateChatImage=function(e){var t,i=this.win().find("#header"),a=this.chid,s=i.find("#userimage"),n=Participants.get(this.chid);if(e)return void s.addClass("zcloadimg");if(this.isOnetoOneChat()){var r=n.recipants;$.isArray(n.recipants)&&(r=n.getRecipientFor121Chat()),r&&(t='<img elemtype="user" hover="true" uid="'+r+'" src="'+Users.getImgUrlById(r)+'" height="55" width="55" class="floatl rds4 cur">')}else if(this.isChannel()){var o=Channels.getByChid(a);t='<div class="rds4 chtch cur" elemtype="channel" hover="true" uid="'+o.oc_id+'" >'+ChannelsUI.getImageByChid(a)+"</div>"}else this.isGroupChat()?t=HistoryUI.getRecipantsPhoto(n.getParticipantsDetail(),n.getPcount(),this.addinfo,this.title,this.ctype,a,this.isCustomGroup()):this.isDefaultBot()?t='<div class="rds4 chtch"><img src="'+ChatBot.getImgUrl()+'"/></div>':this.isCustomBot()?t='<div class="rds4 chtch"><img  elemtype="contact" hover="true" uid="'+MyBots.getBotId(a)+'" src="'+MyBots.getImgByChid(a)+'" class="cur"/></div>':$WC.Matcher.check("emailid",this.addinfo.PEND_INV)&&(t='<div class="rds4 chtch"><img src="/officechat/images/cnt-avtr.png"/></div>');t&&(s.removeClass("zcloadimg"),s.html(t))},$Cwin.prototype.updateRecipientName=function(e){for(var t=this.chid,i=$("#"+t).find('span[uid="'+e+'"]'),a=Users.getName(e),s=0;s<i.length;s++)$(i[s]).html(a)},$Cwin.prototype.updateGuestUrl=function(e){this.guesturl=e},$Cwin.prototype.updateGuestOption=function(e){this.guest=parseInt(e);var t=this.win();if(this.guest===$zcg.GUEST_ALLOW)t.find("#allowguest").removeClass().addClass("msi-guesturl").html(Resource.getRealValue("chat.guest.url")),t.find("#blockguest").removeClass("guestdis");else if(this.guest===$zcg.GUEST_BLOCK){if(this.hideInfoDiv(),!$zcg._PLANDETAILS.isGuestAccessAllowed)return void t.find("#guestoption").remove();t.find("#allowguest").removeClass().addClass("zcf-allowuser").html(Resource.getRealValue("common.allow")),t.find("#blockguest").addClass("guestdis")}},$Cwin.prototype.updateMuteStatus=function(e,t){this.mute=e,"undefined"!=typeof t&&(this.mutedinterval=t),this.updateAdditionalOptionsUI()},$Cwin.prototype.clearSuggestToadd=function(e){if(e.length>0)for(var t=0,i=e.length;i>t;t++){var a=e[t],s=a.s?a.s.split(":",2)[0]:a.uname;this.suggesttoadd.splice(this.suggesttoadd.indexOf(s),1)}else this.suggesttoadd=[];0===this.suggesttoadd.length?this.clearInviteMemberPromptbanner():this.showInviteMemberPromptbanner()},$Cwin.prototype.hideInfoDiv=function(e){e&&e.stopPropagation(),this.win().find("#infocont").slideUp()},$Cwin.prototype.populateGuest=function(){var e=this,t=this.win().find("#infocont"),i=Participants.get(this.chid);if(i.participantspopulated&&("block"===t.css("display")&&t.hide(),i.participantspopulated=!1),"none"===t.css("display")){var a='<div class="posrel"><div class="guesturl"><p>'+Resource.getRealValue("chat.guest.urlsend")+'</p><input readonly="true" type="text" value="{GUESTURL}"></div><span purpose="close" class="msi-close cclose"></span></div>';a=a.replace(/{GUESTURL}/g,this.guesturl?this.guesturl:""),t.html(a).off().on("click","[purpose]",function(t){var i=this.getAttribute("purpose");"close"===i&&e.hideInfoDiv(t)}),t.find("input").on("focus mouseup",function(e){"mouseup"===e.type?e.preventDefault():"focus"===e.type&&$(this).select()}),t.slideDown()}else t.slideUp()},$Cwin.prototype.constructParticipantsUI=function(){if(this.hasPariticipantViewPermission()){var e=!1,t=this.hasPermissionToDeleteMember()&&Participants.get(this.chid).getPcount()>(this.isChannel()?1:2),i=this.getPermission().invitemember;if(i=void 0===i?!0:i,Chat.isChannelChid(this.chid)){e=!0;var a=Channels.getChannelId(this.chid);i=ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,a)}ParticipantsWin.createModelWindow("participants",this.chid,t,i,e)}},$Cwin.prototype.callDeleteParticipant=function(e){if(!(this.isChannel()&&!this.hasPermissionToDeleteMember()||Participants.get(this.chid).getPcount()<=(this.isChannel()?1:2))){var t=$(e).attr("uid");$Util.showChatDeleteMemberAlert(this.chid,Users.getName(t),[t])}},$Cwin.prototype.getChatTypeHTML=function(){var e="";return this.isLiveSupport()&&(e='<div><span title="'+Resource.getRealValue("embed.livesupport")+'" class="msi-livecht"></span></div>'),e},$Cwin.prototype.updateAdditionalOptionsUI=function(){MainUI.isChatPaneView()&&$("#chatwindows").addClass("zcbroadsheet");var e=this.getPermission(),t=this.chid,i=this.win(),a=this,s=Channels.getChannelId(this.chid),n=!0,r=!0,o=this.isChannel(),l=this.isBot(),c=this.isGroupChat();if(!o||"undefined"!=typeof s){r=this.guest==$zcg.GUEST_BLOCK&&!$zcg._PLANDETAILS.isGuestAccessAllowed||"false"===$zcg._ISNONORGMEMBERINVITEALLOWED?!1:!0,n=this.history&&!$zcg._PLANDETAILS.isDisableHistoryAllowed||"false"===$zcg._ISHISTORYOFFALLOWED?!1:!0;var d="undefined"==typeof e.invitemember?!0:e.invitemember,u=e.fileshare;if(o&&Channels.isJoined(s)){var m=Channels.getObject(s);d=ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,m),u=ChannelsPermission.hasPermission(Channels.ACTIONS.SEND_MESSAGE,m)}var p="undefined"==typeof e.mute?!0:e.mute,h="",g=[];h+=g.length>0?'<div id="profileinfo{CHID}" profilid="'+g[0]+'" profile="'+g[1]+'" purpose="options" ><span title='+MMChat.getCustomTitle("common.viewinfo","south").replace(" ","&nbsp;")+' class="msi-zinfo zcthmfnt"></span></div>':this.getChatTypeHTML(),h+=p?'<div id="mute{CHID}" class="zc-mute-bx" data-purpose="zcmutechannel"><span class='+(this.isMuted()?'"zcf-mute" id="unmuteicon{CHID}"':'"zcf-unmute" data-hover="chat.mute" documenthover="muteoptions" title='+Resource.getRealValue("chat.mute"))+'></span><div class="chtpopup zchmute">'+(this.isMuted()?'<div id="mute" mute=0 purpose="actions">'+Resource.getRealValue("chat.unmute")+"</div>":"")+'<div id="mute" mute=1 purpose="actions">'+Resource.getRealValue("chat.mute.one")+'</div><div id="mute" mute=8 purpose="actions">'+Resource.getRealValue("chat.mute.eight")+'</div><div id="mute" mute=24 purpose="actions">'+Resource.getRealValue("chat.mute.oneday")+'</div><div id="mute" mute=168 purpose="actions">'+Resource.getRealValue("chat.mute.oneweek")+'</div><div id="mute" class="bdrB0" purpose="actions">'+Resource.getRealValue("chat.mute.infinite")+"</div></div></div>":"",h+=MMChatUI.getCallOptionsHtmlForCwin(this),Conference.isAudioConferenceAllowed()||Conference.isVideoConferenceAllowed()?h+=MediaManager.getGroupCallOptionsHtmlForCwin(this):this.hasPermissionToHostPrimeTime()&&(h+='<div id="videobroadcast{CHID}" class="bcstrt" purpose="options" title='+MMChat.getCustomTitle("videobroadcast.primetime","south")+' ><div class="videobrdhdr" data-purpose="zcbroadcast"><span class="zcf-broadcast" ></span></div></div>'),this.isOnetoOneChat()||(h+=d?'<div id="chatinvite{CHID}" purpose="options"  data-purpose="zcbroadcast"><span title='+MMChat.getCustomTitle("channel.action.6","south").replace(/ /g,"&nbsp;")+' class="zcf-memberAdd font15" data-purpose="zcaddmember"></span></div>':"",this.isChannel()||this.win().find("#title"+this.chid).attr("contenteditable","true")),h=h.replace(/{CHID}/g,t),i.find("#chataddoptions").html(h),this.isOnetoOneChat()&&MMChat.showTour(t);var f='<div class="zceditrsndfile" data-purpose="zcsharefile" id="triggeratt{CHID}" {DISPLAY}>{UPLOADFORM}</div>',v="";if(!this.UploadFileConstructed){if(u){this.UploadFileConstructed=!0;var C=Template.UploadFileIframe;FileUploadHandler.isAjaxUploadCompatible()&&(C=$zcg._CLOUDPICKERENABLED?Template.FilePickerActionsHtml:"",C+=Template.UploadFile.replace(/{FILEPICKERDESKTOP}/g,Template.FilePickerDesktop)),f=f.replace(/{UPLOADFORM}/g,C),f=f.replace(/{DISPLAY}/g,"").replace(/{UPLOADCLASS}/g,"msi-atchmnd").replace(/{CTYPE}/g,this.ctype)}else f=f.replace(/{UPLOADFORM}/g,"").replace(/{DISPLAY}/g,"style='display:none'"),v="atchmndhide";f=f.replace(/{CHID}/g,t);var y=i.find("#triggeratt"+t);y.parent().addClass(v),y.replaceWith(f),this.bindFileUploadEvents()}var b;l?(b='<div class="chtpopup font14"> <div id="print" class="zcf-print" purpose="actions">'+Resource.getRealValue("common.print")+"</div>{PINUNPIN}{BOTACTIONS}</div>",b=b.replace(/{BOTACTIONS}/,this.isDefaultBot()?"":MyBots.getActionsHtml(t))):b='<div class="chtpopup font14"> <div id="print" class="zcf-print" purpose="actions">'+Resource.getRealValue("common.print")+"</div>{GUESTHTML}{PINUNPIN}{HISTORYSTORAGE}{MUTUAL_CHATS}{INVITE_PARTCIPANT}{ENDLIVESUPPORT}{PREVIEWOPTION}{PERMALINK}{LEAVEOPTION}</div>";var E=ChatsList.getCatagory(this.chid),I=o?"common.channel.pin":l?"common.bot.pin":"common.pin",T=o?"common.channel.unpin":l?"common.bot.unpin":"common.unpin";b=b.replace(/{PINUNPIN}/g,(o?Channels.isPinned(s):"chats"!==E&&"mutedchats"!==E)?'<div id="unpin" purpose="actions" class="zcf-unpin">'+Resource.getRealValue(T)+"</div>":'<div id="pin" purpose="actions" class="zcf-pin">'+Resource.getRealValue(I)+"</div>"),b=b.replace(/{HISTORYSTORAGE}/g,"undefined"!=typeof this.history&&e.history&&n?'<div id="historystorage" class="zcf-secretchat ellips" action="'+(0===this.history?"enable":"disable")+'" purpose="actions">'+Resource.getRealValue(0===this.history?"history.storage.enable":"history.storage.disable")+"</div>":""),b=b.replace(/{ENDLIVESUPPORT}/g,this.addinfo&&parseInt(this.addinfo.CT_TYPE)===$zcg.CT_NFY_LIVESUPPORT?'<div id="endlivesupport" class="msi-endsupport" purpose="actions">'+Resource.getRealValue("chat.end.support")+"</div>":""),b=b.replace(/{GUESTHTML}/g,e.guest&&r&&SecurityManager.hasPermission(Modules.DirectMessage)?'<div id="guestoption" class="guest zcf-guest">'+Resource.getRealValue("common.guest")+'<span class="msi-rightarr bold posa"></span><div class="setpopup submenu"><div class="zcacsub">'+(this.guest===$zcg.GUEST_ALLOW?'<div id="blockguest" class="zcf-blockuser" purpose="actions">'+Resource.getRealValue("chat.guest.block")+'</div><div id="allowguest" class="zcf-allowuser" purpose="actions">'+Resource.getRealValue("chat.guest.url")+"</div>":'<div id="blockguest" class="guestdis zcf-blockuser ellips" purpose="actions">'+Resource.getRealValue("chat.guest.block")+'</div><div id="allowguest" class="zcf-allowuser ellips" purpose="actions">'+Resource.getRealValue("common.allow")+"</div>")+"</div></div></div>":""),b=b.replace(/{LEAVEOPTION}/g,c&&Participants.get(this.chid).getPcount()>2||o&&ChannelsPermission.hasPermission(Channels.ACTIONS.LEAVE_ALLOWED,s)?'<div id="leave" class="zcf-leave notheme" purpose="actions">'+Resource.getRealValue("common.leave")+"</div>":""),b=b.replace(/{PREVIEWOPTION}/g,o?'<div id="preview" class="zcf-infoC" purpose="actions">'+Resource.getRealValue("channel.viewinfo")+"</div>":""),b=b.replace(/{PERMALINK}/g,o?'<div id="channelpermalink" class="zcf-link" purpose="actions">'+Resource.getRealValue("channel.permalink")+"</div>":""),b=b.replace(/{MUTUAL_CHATS}/g,this.isOnetoOneChat()?'<div id="mutualchats" class="zcf-common ellips" purpose="actions">'+Resource.getRealValue("common.mutualchats")+"</div>":""),b=this.isOnetoOneChat()?b.replace(/{INVITE_PARTCIPANT}/g,d?'<div id="chatinvite{CHID}" purpose="actions" class="zcf-memberAdd">'+Resource.getRealValue("channel.action.6")+"</div>":""):b.replace(/{INVITE_PARTCIPANT}/g,""),b=b.replace(/{CHID}/g,t),i.find("#chatactionsholder"+t).html(b),this.updateTriggers(),i.find("#mute"+t).on("mouseover",function(){if(a.isMuted()){var e=Resource.getRealValue("chat.muted.forever");if(-1!==parseInt(a.mutedinterval)){var s=parseInt(a.mutedinterval)-+new Date;7>s/864e5&&(e=Resource.getRealValue("chat.onmute")+" : "+$Date.relativetimeleft(a.mutedinterval))}else e=Resource.getRealValue("chat.muted.forever");i.find("#unmuteicon"+t).attr("title",$Util.getCustomTooltip(e,"","","south"))}})}},$Cwin.prototype.bindFileUploadEvents=function(e){e=e||this.win();var t=this.chid;$zcg._CLOUDPICKERENABLED&&e.find("#subfile"+t).on("click",function(i){Clickoutside.handleClickOnChild(i),e.find("#file"+t).trigger("click")}),e.find("#file"+t).on("click",function(e){document.activeElement!=this&&(e.stopPropagation(),$(this).focus())}),e.find("#file"+t).on("change",function(){var e=this.parentNode,i=e.getAttribute("type");"iframe"===i?Chat.sendFile(e):"html5"===i&&FileUploadUI.handlePreview(t,this.files,!0,!1)})},$Cwin.prototype.bindEvents=function(){var e=this,t=this.win(),i=this.chid;t.find("#compcontainer").on("click","[purpose]",function(a){var s=$(this).attr("purpose");"moreaction"==s||"filepicker"==s?(e.getMefront(),Composer.handleClick.call(e,a,this)):"fwdclose"==s?(a.stopPropagation(),MessageOperations.forward.clearSelection(i)):"fwdnext"==s?(a.stopPropagation(),MessageOperations.forward.initUI(i)):s=="cloudatchmnt"+i?(Clickoutside.handleClickOnChild(a),CloudPickerUI.handlePreview(i)):"scrolldown"==s&&(ZCScroll.getScrollDown(t.find("#chatbody")[0],500),a.stopPropagation())}),t.find("#msgarea").on("dblclick","[mtype]",function(e){var t=$(e.target).closest('[purpose="viewreplied"]').length,i=$(e.target).closest("[mtype]")[0],a=i.getAttribute("mtype"),s=$(e.target).parents("[inlineevent]").length||$(e.target).parents("[inlinereminders]").length;if(!t&&(MsgUtil.isTextMsg(a)||"20"===a)&&!s){var n=$Util.emptyClickedinNode(e.target,e);if(n){e.stopImmediatePropagation();var r=i.getAttribute("chid");1===ChatUI.exist[r].history&&MessageOperations.handle.reply(r,$(e.target),e)}}}),t.find("#msgarea").on("click","[mtype]",function(e){if(t.find("#chatbody").hasClass("zcmsgsel")){e.stopPropagation();var a=$(e.currentTarget),s=a.find('[purpose="msgselect"]'),n=!a.hasClass("zcmsgselbx");s.length>0&&MessageOperations.forward.handleMsgSelection(s,i,n)}}),t.find("#msgarea").on("click","[purpose]",function(e){var t=$(this).attr("purpose"),a=["loadtranscriptonretry","viewreplied","loadbetweenmsgs"];if(a.indexOf(t)>-1)if(e.stopImmediatePropagation(),"loadtranscriptonretry"==t){var s=$("#"+i).find("#msgarea"),n=$(e.currentTarget),r=$(n).parent(),o=r.nextAll("[mtype]:first").attr("msgtime"),l=r.prev("[mtype]").attr("msgtime"),c=$(n).attr("fromtime"),d=$(n).attr("totime");if(c=$WC.$CUtil.isEmpty(c)?void 0:c,d=$WC.$CUtil.isEmpty(d)?void 0:d,r.replaceWith('<div id="retrytranscriptloader" class="hst-loadngmn"><div class="hst-loadng"></div></div>'),$WC.$CUtil.isEmpty(c))Chat.getTranscriptFromRServer(i,void 0,c,d,function(e,t,i,a,s){ChatUI.removeRetryLoaderUI(e),ChatUI.handleMissingTranscriptResponse(e,t,c,a,s)},Chat.LINESLIMIT);else if(!$WC.$CUtil.isEmpty(c)&&$WC.$CUtil.isEmpty(d)){var u=s.find("[mtype]").not(".zcdelvrywait"),m=parseInt(u.last().attr("msgtime"));l==m?Chat.getTranscriptFromRServer(i,void 0,parseInt(l)+1,o,function(e,t,i,a,s){var n={chid:e,transcript:t,fromtime:i,totime:a,partial:s,onreconnection:!0};ChatUI.removeRetryLoaderUI(e),Chat.handleFetchTranscript(n)}):MessageOperations.reply.loadbetweenTranscript(i,l,o,!0,function(){ChatUI.removeRetryLoaderUI(i)})}}else if("viewreplied"==t){"a"===e.target.tagName.toLowerCase()&&e.preventDefault();var r=$(e.currentTarget),p=r.attr("msgtime"),h=r.find('[elemtype="user"]').attr("uid");"undefined"!=typeof p&&MessageOperations.reply.viewRepliedMessage(i,p,h)}else if("loadbetweenmsgs"==t){var r=$(e.currentTarget).parent(),o=r.nextAll("[mtype]:first").attr("msgtime"),l=r.prev("[mtype]").attr("msgtime");r.replaceWith('<div loadfromtime="'+l+'"class="hst-loadngmn"><div class="hst-loadng"></div></div>'),MessageOperations.reply.loadbetweenTranscript(i,l,o,!0)}});var a="composer"+i,s=t.find("#"+a);$WC.DivEditor.initEditor(a,{highlightclass:"sel",handleKeyDown:Composer.handleKeyDown,handleKeyUp:Composer.handleKeyUp,handlePaste:function(e,t){FileUploadUI.handlePaste(e.substring("composer".length),t)},handleTextPaste:Composer.handleTextPaste,trigger:"composer",handleInitialize:Composer.handleInitialize}),UIDataPersist.hasComposerMsg(i)&&(s.html(UIDataPersist.getComposerMsg(i)),s.one("focus",function(){UIDataPersist.moveCaretToEnd(this)})),s.on("blur",function(){e.checkStatus(this),$("#chathelptip"+i).attr("class","zcqust_tltipmn")}),s.on("paste",function(e){setTimeout(function(){ZCScroll.getScrollDown(s[0])},100),e.stopImmediatePropagation()}),s.on("mousedown",function(){Composer.clearSearchResults(e.chid)}),t.find("#compautocomplete"+i).on("click mouseover","[purpose='search']",function(t){Composer.eventsOnAutoComplete.call(e,t,this),t.stopImmediatePropagation()}),t.find("#compautocomplete"+i).on("click",function(e){e.stopImmediatePropagation()}),t.find("#smileys"+i).on("click","[code]",function(e){var t="editor"===$("#smileys"+i).attr("trigger"),a=t?"editor"+i:"composer"+i;Composer.handleSmileyInsertion(e,this,a)}),t.find("#title"+i).on("mouseup focus blur keyup keydown",function(e){$Util.handleEditor(e,this,{select:!0,focusclass:"zctlefcs",action:function(e,t,i){{var a=e.attr("chid"),s=ChatUI.exist[a];Participants.get(a).getRecipientFor121Chat()}if(i!==t){if(!ChatsList.isOnetoOneChat(a)&&-1!==t.indexOf("#"))return void $WC.$Dlg.alert({id:"chattitleerror",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("chat.title.error")]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-red"></div>'}),buttons:[{text:Resource.getRealValue("common.okgotit"),colour:$WC.$Dlg.GREEN_BUTTON}]});Chat.setTitle(a,t,i),s.updateTitle(t)}return!1}})}),t.find("#title"+i).on("click",function(e){e.stopImmediatePropagation()}),t.find("#chataddoptions").on("click","[purpose='options']",function(t){e.getMefront(),e.handleChatoptions(t,this)}),t.find("#chataddoptions").on("click","[purpose='actions']",function(){e.getMefront(),0===parseInt(this.getAttribute("mute"))?Chat.muteChat(e.chid,!1):Chat.muteChat(e.chid,!0,this.getAttribute("mute")?3600*parseInt(this.getAttribute("mute")):-1)}),t.find("#chatactionsholder"+i).on("click","[purpose='actions']",function(t){e.getMefront(),e.handleActions(t,this)}),t.find("#cclose").on("click",function(){e.closeWindow($zcg._MOUSECLICKEVENT)}),t.find("#uploadcancel").on("click",function(){FileUploadUI.cleanUpFileUpload(i)}),t.find("#zcfileexpandicon").on("click",function(){FileUploadUI.expandFilesContainer(i)}),t.on("click",function(){window.getSelection().toString()||e.getMefront()}),t.one("click","[documentclick='playlink']",function(){e.mediaplaying=!0}),t.on("keyup",function(i){27===i.which&&"block"===t.find("#infocont").css("display")&&(i.stopPropagation(),e.hideInfoDiv(i))});var n=$(window);t.find("#chatbody").on("scroll",function(){var a=$("#editcontainer"+i).length;if(a){var s=$("#compautocomplete"+i),r="editor_smileys"+i,o=$("#"+r),l="block"==s.css("display"),c="block"==o.css("display");l&&s.hide(),c&&(o.hide(),o.empty(),Clickoutside.clearCurrentElement(r))}var d=t.find("#msgarea");if(ChatUI.checkLoadMoreMsgs(this,d)){var u=d.find("[mtype]")[0].getAttribute("msgtime");Chat.getTranscriptFromRServer(e.chid,void 0,void 0,parseInt(u)-1,function(e,t,i,a,s){var n={chid:e,transcript:t,fromtime:i,totime:a,partial:s};Chat.handleFetchTranscript(n)},Chat.LINESLIMIT),e.updateLoading(!1)}var m=d.children();e.scrolldown=e.isScrollDown(),e.scrolltop=this.scrollTop,e.updateScrollClass(this.scrollTop),e.checkAndUpdateNavElem(this),e.scrolldown||$Util.throttle(e.showDateHint,e,50),$Util.addClassToViewableArea($(this),m,n),clearTimeout(e.scrolltimer),e.scrolltimer=setTimeout(function(){e.loadVisibleImages()},$zcg.ORIGINALIMG_LOAD_TIMEOUT)}),t.find("#chatbody").on("img[originalsrc]","click",function(){ChatUI.loadOriginalSource(this)}),$zcg._IE9||(t.find("#chatbody").on("dragstart dragenter dragover dragleave drop",function(t){return t.stopPropagation(),$(t.target).parents('[purpose="viewreplied"]').length?!1:("dragstart"===t.type&&e.handleDragStart(t),"dragover"===t.type&&e.handleDragOver(t,"dragtimer","#filedropcontainer"),"dragleave"===t.type&&e.handleDragLeave(t,"dragtimer","#filedropcontainer"),void("drop"===t.type&&e.handleDrop(t,this,"#filedropcontainer",!1)))}),t.find("#chatwindropdown").on("dragstart dragenter dragover dragleave drop",function(t){return t.preventDefault(),t.stopPropagation(),!Composer.hasCommandRule(e.chid)||t.originalEvent.dataTransfer.types.indexOf("Files")<0?!1:("dragover"===t.type&&e.handleDragOver(t,"dragtimercomp","#compfiledropcontainer"),"dragleave"===t.type&&e.handleDragLeave(t,"dragtimercomp","#compfiledropcontainer"),void("drop"===t.type&&e.handleDrop(t,this,"#compfiledropcontainer",!0)))})),t.find("#header").cssAnimation("zctit_blink")},$Cwin.prototype.handleDragStart=function(e){if(e.originalEvent.dataTransfer.setData("isdraggedfromcwin",!0),"a"===e.target.tagName.toLowerCase())ChatUI.draggablefile=$(e.target).parents("[mtype]");else{ChatUI.draggablefile=$(e.target).parents("[fname]");var t=ChatUI.draggablefile.find("img")[0];if(t){var i=$(t).offset();e.originalEvent.dataTransfer.setDragImage(t,e.originalEvent.clientX-i.left,e.originalEvent.clientY-i.top)}}},$Cwin.prototype.handleDragOver=function(e,t,i){if(!e.originalEvent.dataTransfer.types.includes("isdraggedfromcwin")||ChatUI.draggablefile[0]&&ChatUI.draggablefile.attr("chid")!==this.chid){e.preventDefault(),clearTimeout(this[t]);var a=this.chid;if(ChatUI.hasPermission(a,"fileshare")){var i=this.win().find(i);i.css({display:"table",height:i.parent().outerHeight()})}}},$Cwin.prototype.handleDragLeave=function(e,t,i){clearTimeout(this[t]);var a=this,s=setTimeout(function(){a.win().find(i).hide()},75);this[t]=s},$Cwin.prototype.handleDrop=function(e,t,i,a){e.preventDefault();var s=e.originalEvent;if(s.dataTransfer&&s.dataTransfer.files.length&&FileUploadUI.handlePreview(this.chid,s.dataTransfer.files,a),s.dataTransfer&&s.dataTransfer.getData("isdraggedfromcwin")){var n=ChatUI.draggablefile.context;if("a"===n.tagName.toLowerCase()){var r="",o=$(n).parents('[purpose="urlunfurl"]');r="linkhtml"===n.getAttribute("markdown")?"["+n.innerText+"]("+n.getAttribute("href")+")":o.length?$(o)[0].getAttribute("url"):n.innerText,Chat.sendMessage(this.chid,r,$Util.getSyncedCurrentTime())}else this.handleDragAndDropAttachmentOperations($(t))}ChatUI.draggablefile="",this.win().find(i).hide()},$Cwin.prototype.handleDragAndDropAttachmentOperations=function(e){var t=ChatUI.draggablefile,i=e.parent().attr("id"),a=t.attr("url"),s=t.attr("fname"),n=t.attr("content"),r="true"===t.attr("isv1"),o=$WC.$CUtil.processXSS(t.attr("comment")),l="true"===t.attr("hasthumbnail"),c={fillusersuggestfield:!0};FileForwardUI.handle(i,n,a,s,o,r,l,c)},$Cwin.prototype.showDateHint=function(){for(var e=$("#"+this.chid),t=e.find("#chatbody"),i=e.find("#datehint")[0],a=t.find("[msgtime][mtype].in-view"),s=0;s<a.length;s++)if($Util.eleminViewinWindow(a[s],t)){var n=a[s].getAttribute("msgtime"),r=$Date.day(n,{shorten:!0});i.innerHTML=r;break}r&&(i.style.opacity=1,i.style.display="block"),clearTimeout(this.datehint_timer_hide),this.datehint_timer_hide=setTimeout(function(){i.style.opacity="",i.style.display="none"},1e3)},$Cwin.prototype.checkAndUpdateNavElem=function(e){var t=$(e).parent(),i=t.find("#chtwinnav");if(ZCScroll.isScrollNearBottom(e,100))i.remove();else if(!i.length){var a=this.unreadmsgcount>0?this.unreadmsgcount:"",s='<div id="chtwinnav" class="chtwinnav" purpose="scrolldown"><span class="msi-uparrw mrgT5 font16"></span><div id="cwinunreadcount" class="msgnotify">'+a+"</div></div>";t.find("#compcontainer").append(s)}},$Cwin.prototype.closeWindow=function(e){var t=this.chid,i=this;return this.isMediaChatRunning?void MMChat.handleChatWindowBeforeClose(t,function(){i.clearCStimer(),Chat.quit(t,void 0,void 0,e)}):(Clickoutside.clear("eventpopupwindow"),Composer.clearAutoComplete(t),this.clearCStimer(),Chat.quit(t,void 0,void 0,e),void(Clickoutside.currentchain.indexOf("screenshare"+t)>-1&&(MMChat.updateScreenTourObj(),Clickoutside.clear("screenshare"+t))))},$Cwin.prototype.loadVisibleImages=function(){if(MainUI.isChatinViewport(this.chid)||this.isMediaChatRunning||IntegrationsCwin.isCurrent(this.chid)){var e=this.win();ChatUI.loadVisibleImages(e.find("#chatbody")[0])}},$Cwin.prototype.focus=function(e){e||(e="composer"+this.chid),this.iscomposerdisabled||$("#zcwindows").children().length||(this.win().find("#helptip").css("visibility","visible"),this.win().find("#compautocomplete"+this.chid).attr("trigger","composer"),$WC.DivEditor.focus(e),Settings.getFromObj("cloud_picker_tour")<1&&$zcg._CLOUDPICKERENABLED&&($("#cloud_picker_tour").remove(),this.win().find("#triggeratt"+this.chid).prepend($WC.template.replace(Template.FileAttachmentTour,{chid:this.chid}))))},$Cwin.prototype.handleChatoptions=function(e,t){var i=t.id,a=this.chid;i==="profileinfo"+a?(t=$(t),this.win().find("#"+i).addClass("sel"),"contact"===t.attr("profile")?Contacts.getProfileDetails(Participants.get(a).getRecipientFor121Chat()):"channel"===t.attr("profile")&&ChannelsUI.triggerPreview(Channels.getChannelId(a))):i==="chatinvite"+a?this.triggerChatInvite(e):i==="videocall"+a?this.startVideoCall(MMChatUI.getCallSourceInCwin(t)):i==="audiocall"+a?this.startAudioCall(MMChatUI.getCallSourceInCwin(t)):i=="screenshare"+a?this.startScreenShare(MMChatUI.getCallSourceInCwin(t)):i==="videobroadcast"+a?$ZCVideoBroadcast.trigger(a):i==="audioconference"+a?Conference.trigger(Conference.types.AUDIO,Conference.scopeTypes.CHAT,a):i==="videoconference"+a&&Conference.trigger(Conference.types.VIDEO,Conference.scopeTypes.CHAT,a)},$Cwin.prototype.startVideoCall=function(e){this.getMefront(),MMChat.startVideoChat(this,MMChatConstants.callTypes.VIDEO,MMChatConstants.callModes.OUTGOING,e)},$Cwin.prototype.startAudioCall=function(e){this.getMefront(),MMChat.startVideoChat(this,MMChatConstants.callTypes.VOICE_WITH_VIDEO,MMChatConstants.callModes.OUTGOING,e)},$Cwin.prototype.startScreenShare=function(e){this.getMefront(),MMChat.startScreenShare(this,e)},$Cwin.prototype.showVideoChatArea=function(){var e=this;this.isMediaChatRunning=!0;var t=this.win().find("#videochatspace"),i=this.win().find("#chatbody");"block"!=t.css("display")&&(t.show(),this.scrolldown||(this.scrolltop=i.scrollTop()+t.outerHeight()),e.retainScrollPosition())},$Cwin.prototype.hideVideoChatArea=function(){var e=this.win().find("#videochatspace");e.hide(),MainUI.resize()},$Cwin.prototype.setMediaChatRunning=function(e){this.isMediaChatRunning=e},$Cwin.prototype.triggerChatInvite=function(e){var t="composer"+this.chid;e.stopPropagation(),this.focus(),"+"!==this.curtrigger&&$WC.DivEditor.insertText(t," +"),Composer.clearSearchResults(this.chid),Composer.handleKeyUp(t,e,this.win().find("#"+t)[0])},$Cwin.prototype.handleActions=function(e,t){var i=t.id;if("channelpermalink"===i){var a=this.chid;return ChannelsUI.handleCopyPermaLink(this.chid,$("#chatactionsholder"+a)),void setTimeout(function(){ChatUI.isExist(a)&&(ChatUI.exist[a].updateAdditionalOptionsUI(),Clickoutside.handleClickOnChild(e))},1e3)}Clickoutside.handleClickOnChild(e);var s=this.win();if("allowguest"===i)Chat.getGuesturl(this.chid),this.guest===$zcg.GUEST_BLOCK&&(Chat.setGuestAccess(this.chid,!0),s.find("#allowguest").removeClass().addClass("msi-guesturl").html(Resource.getRealValue("chat.guest.url")),s.find("#blockguest").removeClass("guestdis"));else if("blockguest"===i)this.guest===$zcg.GUEST_ALLOW&&(Chat.setGuestAccess(this.chid,!1),s.find("#allowguest").removeClass().addClass("zcf-allowuser").html(Resource.getRealValue("common.allow")),s.find("#blockguest").addClass("zcf-blockuser")),this.hideInfoDiv();else if("print"===i)window.open("/printochatfromrs.do?chid="+this.chid+"&title="+encodeURIComponent(this.title)+"&tzoffset="+$zcg._TZOFFSET);else if("historystorage"===i)Chat.setHistoryStorage(this.chid,t.getAttribute("action"));else if("endlivesupport"===i)LiveSupport.end(this.chid);else if(i==="chatinvite"+this.chid)this.triggerChatInvite(e);else if("leave"===i)this.isChannel()?Channels.leave(this.chid):this.isGroupChat()&&Chat.leave(this.chid);else if("preview"===i){if(this.isChannel()){var n=Channels.getByChid(this.chid);ChannelsUI.triggerPreview(n.oc_id)}}else if("pin"===i)this.isChannel()?Channels.markUnmarkPinnedChannel(this.chid,!0):Chat.markUnmarkPinnedChat(this.chid,!0);else if("unpin"===i)this.isChannel()?Channels.markUnmarkPinnedChannel(this.chid,!1):Chat.markUnmarkPinnedChat(this.chid,!1);else if("mutualchats"===i){var r=Participants.get(this.chid).getRecipientFor121Chat();Contacts.getProfileDetails(r)}},$Cwin.prototype.checkStatus=function(e){this.clearCStimer();{var t=this;$("#composer"+this.chid)}this.cstimer=setTimeout(function(){Composer.hasMessage(e)&&t.cscode!==$zcg.NFY_USER_ENTERED?(Chat.sendStatus(t.chid,$zcg.NFY_USER_ENTERED),t.cscode=$zcg.NFY_USER_ENTERED):t.cscode=$zcg.NFY_USER_IDLE},ChatUI.statuspredictinterval)},$Cwin.prototype.clearCStimer=function(){clearTimeout(this.cstimer)},$Cwin.prototype.flicker=function(){this.win().find("#header").addClass("zctit_blink")},$Cwin.prototype.fetchTranscriptOnReconnection=function(){if(this.reconnect){var e=this;this.reconnect=!1;var t=-1,i=this.win().find("[mtype]").not(".zcdelvrywait");i.length&&(t=parseInt(i.last().attr("msgtime")),t=t>0?t+1:-1),Chat.getTranscriptFromRServer(this.chid,void 0,t,void 0,function(t,i,a,s,n){var r={chid:t,transcript:i,fromtime:a,totime:s,partial:n,onreconnection:!0};Chat.handleFetchTranscript(r),e.updateStatusMsg("")})}},$Cwin.prototype.updateStatusMsg=function(e){if(e=$.trim(e),0===e.length){var t=Participants.get(this.chid);e=!this.isGroupChat()&&!this.isChannel()&&t.getPcount()<=2&&t.recipants&&0===parseInt(ChatUI.getParticipantStatus(this.chid,t.getRecipientFor121Chat()))?Resource.getRealValue("chat.participant.offline",[Users.getName(t.getRecipientFor121Chat())]):"&nbsp;"}this.win().find("#cstatusmsg").html(e),this.isScrollDown()&&this.getScrollDown()},$Cwin.prototype.isMsgAlreadyUpdated=function(e){var t=(e.sender,e.time,e.msg),i=e.sender+"_"+e.time,a=$('[uid="'+i+'"]');return $WC.$CUtil.isEmpty(a)||0==a.length||a.children("pre").text()!=t&&12!=e.mtype?!1:!0},$Cwin.prototype.updateinChatTranscript=function(e,t){if(!this.isMsgAlreadyUpdated(e)){var i,a=this.win().find("#msgarea");if(e.time=parseInt(e.time),-1!=this.lastmsgtime){var s=this.win().find('[purpose="loadtranscriptonretry"][fromtime="'+(this.lastmsgtime+1)+'"]');s.length&&s.parent().remove()}this.lastmsgtime=e.time,t.isnew||(this.unreadtime=e.time+1),i=MsgUtil.format(e,t),MsgUtil.updateTranscript(a,i,e.time)}},$Cwin.prototype.updateEditedMsginChatTranscript=function(e,t){if(t=t||{},!t.isnew){var i=MsgUtil.getTimefromMsgObj(e);t.isnew=this.unreadtime<i}var a=this.win().find("#msgarea");e=this.storage.updateMessage(e);var s=MsgUtil.formatEditedMsg(e,t),n=this.win().find("#chatbody");MsgUtil.updateEditedMsginTranscript(a,s,e.msguid),ZCScroll.updateScroll(n)},$Cwin.prototype.deleteMsginChatTranscript=function(e){var t=this.win().find("#msgarea"),i=this.win().find("#chatbody"),a=e.msguid;if(MsgUtil.getDelMsgVisibility(e)){var s={},n=MsgUtil.getTimefromMsgObj(e);s.isnew=!WmsImpl.isLocalUser(e.sender)&&this.unreadtime<n,s.prevmsgsender=e.sender,s.prevmsgtime=n;var r=MsgUtil.format(e,s);MsgUtil.updateDeletedInfoMsginTranscript(t,r,a)}else $Util.removeMsginMsgArea(t.find('[msguid="'+a+'"]')),MsgUtil.getTimefromMsgObj(e)>this.unreadtime&&(this.unreadmsgcount-=this.unreadmsgcount>0?1:0,ChatsList.updateMsgCount(this.chid,this.unreadmsgcount));ZCScroll.updateScroll(i)},$Cwin.prototype.hideMsg=function(e){var t=this.win().find("#msgarea"),i=t.find("[uid='"+e+"']");if(i.length>0){var a=i.prev(),s=i.next(),n="sender"===a.attr("purpose");n=0==s.length?n:"sender"===s.attr("purpose"),n&&a.fadeOut(500,function(){a.remove()}),i.fadeOut(500,function(){i.remove()})}},$Cwin.prototype.updateMsg=function(e,t){var i=MsgUtil.isInfoMsg(e.mtype),a=i?WmsImpl.isLocalUser(e.info.opruser.zuid):WmsImpl.isLocalUser(e.sender,e),s=a||this.isScrollDown(),n=!a||e.includesenderinunread,t=t||{};e=this.storage.updateMessage(e),ChatUI.isCurrent(this.chid)&&!a&&(n=!$zcg._WINFOCUS,$zcg._WINFOCUS&&Chat.propagateMsgSeen(this.chid)),t.isnew=n;var r=new $CliqChatId(this.chid);if(r.isCustomBot()&&BotSuggestions.checkAndRemove(this.chid),this.updateinChatTranscript(e,t),MsgUtil.isHidingMsg(e)){var o=parseInt(e.meta.config.h),l=e.chid;this.msghidetimer=setTimeout(function(){ChatUI.exist[l].hideMsg(e.sender+"_"+e.time)},o)}n&&(i||ChatNotify.notify(e),this.notifyNewMessage()),s&&this.getScrollDown(),"20"===e.mtype&&MainUI.isChatinViewport(this.chid)&&0===this.win().find("#chatbody").scrollTop()&&this.loadVisibleImages(),this.chid==MMChat.chid&&t.isnew&&MMChat.handleNewMessage(),"20"==e.mtype&&r.isDefaultBot()&&e.temp_info&&ChatUI.displayMsg(e.temp_info)},$Cwin.prototype.notifyNewMessage=function(){this.setUnreadMsgCount(this.unreadmsgcount+1),ChatsList.updateMsgCount(this.chid,this.unreadmsgcount)},$Cwin.prototype.removeNewmsgNotification=function(e){var t=!1;if(ChatUI.hasUnreadOrUnseenMsgs(this.chid)>0&&!e){t=!0,Chat.propagateMsgSeen(this.chid);var i=this.win().find("#msgarea");Mentions.captureAndRead(i,"mentionrecentchat")}ChatsList.deleteFromUnreadChatArr(this.chid),UIDataPersist.markRead(this.chid),ChatsList.markRead(this.chid),this.setUnreadMsgCount(0),this.lastmsgtime>0&&(this.unreadtime=this.lastmsgtime+1),UIDataPersist.markRead(this.chid),ChatsList.removeBubble(this.chid),Mentions.clearUnreadMentions(this.chid),this.removeColornotify(),ChatNotify.clear(),t&&this.isChannel(this.chid)&&ChannelsUI.List.LHS.rearrangeChannelsList(),this.chid==MMChat.chid&&MMChat.updateUnreadCount()},$Cwin.prototype.initUnreadMsgCount=function(e){this.setUnreadMsgCount(e)},$Cwin.prototype.setUnreadMsgCount=function(e){this.unreadmsgcount=e,$ZCVideoBroadcast.handleUnreadCount(this.chid,this.unreadmsgcount),this.win().find("#cwinunreadcount").html(e>0?e:""),Conference.setUnreadMessageCount(this.chid,e)},$Cwin.prototype.removeColornotify=function(){this.win().find(".nwmsg").removeClass("nwmsg")},$Cwin.prototype.getScrollDown=function(e){var t=this.win().find("#chatbody");ZCScroll.getScrollDown(t[0],e)},$Cwin.prototype.isScrollDown=function(e){return ZCScroll.isScrollNearBottom(this.win().find("#chatbody")[0],e)},$Cwin.prototype.retainScrollPosition=function(e){if(this.scrolldown)this.getScrollDown(e);else if(this.win().find("#chatbody").length>0){var t=this.win().find("#chatbody")[0];ZCScroll.scrollTop(t,this.scrolltop,e)}},$Cwin.prototype.updateScrollClass=function(e){var t=this.win().find("#header");e?t.addClass("zhdrshdw"):t.removeClass("zhdrshdw")},$Cwin.prototype.showInviteMemberPromptbanner=function(){if(-1!=this.allowedtriggers.indexOf("+")){var e=this.suggesttoadd.length;if(e>0){for(var t=[],i=0,a=this.suggesttoadd.length;a>i;i++)t.push(Contacts.getDisplayName(this.suggesttoadd[i]));var s=1===t.length?"chat.invitationbanner.single":"chat.invitationbanner.many";this.win().find("#promptbanner").html(Resource.getRealValue(s,['<span class="hvrinfo">'+t.join(",&nbsp;")+"</span>"])+'&nbsp;&nbsp;<a href="javascript:;" id="addmemberonmention'+this.chid+'" purpose="moreaction" class="bluelink">'+Resource.getRealValue("common.add")+'</a>&nbsp;&nbsp;<span id="cancelmemberonmention'+this.chid+'" purpose="moreaction" class="redlink cp">'+Resource.getRealValue("common.cancel")+"</span>").show()}}},$Cwin.prototype.clearInviteMemberPromptbanner=function(){this.win().find("#promptbanner").hide().html("")},$Cwin.prototype.updateLoading=function(e){var t=this.win().find("#msgarea");e?t.append('<div id="loadingoldmsgs" class="zcldng"></div>'):t.find("#loadmoremsgs").replaceWith('<div id="loadingoldmsgs" class="hst-loadngmn"><div class="hst-loadng"></div></div>')},$Cwin.prototype.removeLoading=function(){var e=this.win().find("#msgarea");e.find("#loadingoldmsgs").remove()},$Cwin.prototype.isSystemChat=function(){return this.isDefaultBot()||this.isCustomBot()},$Cwin.prototype.isDefaultBot=function(){var e=new $CliqChatId(this.chid);return e.isDefaultBot()},$Cwin.prototype.isCustomBot=function(){var e=new $CliqChatId(this.chid);return e.isCustomBot()},$Cwin.prototype.isEntityChat=function(){return this.ctype===$zcg.ENTITYCHAT},$Cwin.prototype.isChannel=function(){return this.ctype===$zcg.ORGCHANNEL},$Cwin.prototype.isOrgChannel=function(){var e=Channels.getByChid(this.chid);return $.isEmptyObject(e)?!$WC.$CUtil.isEmpty(this.orgid)&&$WC.$CUtil.isEmpty(this.orggroups):Channels.isOrgScope(Channels.getLevel(e))},$Cwin.prototype.isOrgGroupChannel=function(){var e=Channels.getByChid(this.chid);return $.isEmptyObject(e)?!$WC.$CUtil.isEmpty(this.orgid)&&!$WC.$CUtil.isEmpty(this.orggroups):Channels.isOrgGroupScope(Channels.getLevel(e))},$Cwin.prototype.isPrivateChannel=function(){var e=Channels.getByChid(this.chid);return $.isEmptyObject(e)?!1:Channels.isPrivateScope(Channels.getLevel(e))},$Cwin.prototype.isSharedChannel=function(){var e=Channels.getByChid(this.chid);return $.isEmptyObject(e)?!1:Channels.isSharedScope(Channels.getLevel(e))},$Cwin.prototype.isExternalSharedChannel=function(){var e=Channels.getByChid(this.chid);return $.isEmptyObject(e)?!1:Channels.isSharedScope(Channels.getLevel(e))&&!Channels.isBelongstomyOrg(e)},$Cwin.prototype.isCrossProductChat=function(){return 5===this.ctype},$Cwin.prototype.isCrossProductChannelChat=function(){return Channels.isCrossProductChannel(new $CliqChatId(this.chid))},$Cwin.prototype.isGroupChat=function(){var e=parseInt(this.ctype);return e!=$zcg.SYSTEM_CHAT&&e!=$zcg.ORGCHANNEL&&(this.isCustomGroup()||Participants.get(this.chid).getPcount()>2)},$Cwin.prototype.isOnetoOneChat=function(){return!this.isChannel()&&!this.isCustomGroup()&&2===parseInt(Participants.get(this.chid).getPcount())},$Cwin.prototype.isCustomGroup=function(){return this.customgroup},$Cwin.prototype.isBot=function(){return this.isDefaultBot()||this.isCustomBot()},$Cwin.prototype.hasPermissionToDeleteMember=function(){return!this.isChannel()||ChannelsPermission.hasPermission(Channels.ACTIONS.REMOVE_MEMBER,new $CliqChatId(this.chid))},$Cwin.prototype.hasPermissionToHostPrimeTime=function(){return $ZCVideoBroadcast.isPrimeTimeAllowed()?this.isChannel()&&ChannelsPermission.hasPermission(Channels.ACTIONS.PRIMETIME,Channels.getChannelId(this.chid))||this.isGroupChat():void 0},$Cwin.prototype.hasPermissionToHostConference=function(){return this.isChannel()||this.isGroupChat()},$Cwin.prototype.isLiveSupport=function(){return parseInt(this.addinfo.CT_TYPE)===$zcg.CT_NFY_LIVESUPPORT},$Cwin.prototype.isMuted=function(){return 1===parseInt(this.mute)},$Cwin.prototype.getAllowedUsers=function(){return this.isChannel()&&this.isOrgGroupChannel()?Groups.getMembersFromObj(this.orggroups):void 0},$Cwin.prototype.updateOrgGroups=function(e){this.orggroups=e.join()},$Cwin.prototype.toggleLinkPreview=function(e,t){function i(e){var i=MsgTemplate.getUrlInfo(e,!1,!0);$WC.$CUtil.isEmpty(i)?a.toggleLinkPreview(!1,t):(r.html(i),r.find("[documentclick]").removeAttr("documentclick"))}var a=this,s=this.chid,n=this.win().find("#urlinfopreview"+s),r=n.find("#preview");if(e&&"undefined"!=typeof t){if(r.html('<div class="zclnkprv posl"><div class="zcldng""></div></div>'),n.show(),a.linkData.hasOwnProperty(t)&&!$.isEmptyObject(a.linkData[t])){var o={link:t,meta:{linkdetails:a.linkData[t]}};i(o)}else a.linkData[t]={},Chat.getUnfurledLinkDetails(t,s,function(e){if($.isEmptyObject(e))a.toggleLinkPreview(!1,t);else if(null!==e.linkdetails){var s={link:e.link,info:{linkdetails:e.linkdetails}};a.linkData[t]=e.linkdetails,i(s)}});n.find("#closepreview").one("click",function(){a.toggleLinkPreview(!1,t)})}if(n.attr("unfurl",e),!e)if(r.html(""),n.removeAttr("currentlink").hide(),"undefined"!=typeof t){var l=[];if($WC.$CUtil.isEmpty(n.attr("omittedlinks"))||(l=$Util.removeDuplicateEntries(n.attr("omittedlinks").split(" "))),-1==$.inArray(t,l)){var c=$.trim(n.attr("omittedlinks")+" "+t);n.attr("omittedlinks",c)}}else this.linkData={},clearTimeout(this.previewtimer),n.attr("omittedlinks",""),n.removeAttr("unfurl")},$Cwin.prototype.setLastEnterKeyPressTime=function(e){this.lastEnterKeyTime=e},$Cwin.prototype.isDoubleEnter=function(){var e=(new Date).getTime()-this.lastEnterKeyTime;return 500>e},$Cwin.prototype.getOfflineParticipants=function(){for(var e=Participants.get(this.chid).recipants,t=this.chid,i=[],a=recipants.length,s=0;a>s;s++){var n=e[s];n!=WmsImpl.getZuid()&&0==ChatUI.getParticipantStatus(t,n)&&i.push(n)}return i},$Cwin.prototype.isAnyRecipientOffline=function(){for(var e=Participants.get(this.chid).recipants,t=this.chid,i=!1,a=e.length,s=0;a>s;s++){var n=e[s];if(n!=WmsImpl.getZuid()&&(i=0==ChatUI.getParticipantStatus(t,n)))break}return i},$Cwin.prototype.setScrollToMessage=function(e,t){this.scrollToMsg={msgTime:e,sender:t}},$Cwin.prototype.scrollToSpecificMessage=function(e,t){MessageOperations.reply.viewRepliedMessage(this.chid,e,t)};var TranscriptStorage=function(){this.messages=[],this.msguids={}};TranscriptStorage.prototype.updateMessage=function(e){var t=e.msguid;if(!t)return e;for(var i=this.messages.length,a=0;i>a;a++){var s=this.messages[a];if(s.msguid===t)return e=this.copyStaticContent(s,e),this.messages[a]=e,e}return this.messages.push(e),this.msguids[t]=!0,e},TranscriptStorage.prototype.removeMessage=function(e){if(e)for(var t=this.messages.length,i=0;t>i;i++){var a=this.messages[i];if(a.msguid===e)return void this.messages.splice(i,1)}},TranscriptStorage.prototype.getLastMessage=function(){return this.messages[this.messages.length-1]},TranscriptStorage.prototype.getMessage=function(e){for(var t=this.messages.length,i=0;t>i;i++)if(this.messages[i].msguid===e)return this.messages[i]},TranscriptStorage.prototype.getAllMessages=function(){return this.messages},TranscriptStorage.prototype.setAllMessages=function(e){var t=e.length;if(MsgUtil.isChatMoreMsg(e[0])&&(e.splice(0,1),t--),MsgUtil.isChatMoreMsg(e[t-1])&&(e.splice(t-1,1),t--),!(0>=t)){var i=this.messages.length;i>0?(this.messages=this.messages.concat(e),this.messages.sort(function(e,t){return parseInt(MsgUtil.getTimefromMsgObj(e))-parseInt(MsgUtil.getTimefromMsgObj(t))})):this.messages=e;var a=this;this.messages=this.messages.filter(function(e,t,i){var s=!0;return a.msguids[i[t].msguid]=!0,void 0!==i[t-1]&&(s=i[t-1].msguid!==i[t].msguid),s&&(s=MsgUtil.isDeletedInfoMsg(i[t])?MsgUtil.getDelMsgVisibility(i[t]):s),s})}},TranscriptStorage.prototype.copyStaticContent=function(e,t){return e&&t?(e.star&&e.startype&&(t.star=e.star,t.startype=e.startype,delete e.star,delete e.startype),e.reactions&&(t.reactions=e.reactions,delete e.reactions),t):t},TranscriptStorage.prototype.hasMessage=function(e){return this.msguids.hasOwnProperty(e)},TranscriptStorage.prototype.clear=function(){this.messages=[],this.msguids={}};var HistoryUI={},ChatHistory={},ChatHistoryTitleSearch={};HistoryUI={limit:15,autoloadingcount:10,loadmore:!1,selectedcount:0,issearching:!1,prevsearchval:null,currloadingcount:0,currenttranscript:null,scrolltimer:"",initVarConstants:function(){this.currloadingcount=0,this.loadmore=!1,this.selectedcount=0,this.currenttranscript=null},init:function(){this.initVarConstants(),this.prevsearchval=null},construct:function(){if($WC.$Win.isExist("chathistory")){var e=$WC.$Win.get("chathistory");0===e.find("#fetchinghistories").length&&$Util.updateStatusMsg(e.find("#historyrows"),"loading"),e.find("#historysearch").focus()}else{var t='<div id="historysearchbar" class="hstbb"><div class="hstsrcmn"><span class="msi-sp0"></span><input id="historysearch" placeholder="'+Resource.getRealValue("common.searchhistory.minchars")+'" type="text"/></div></div><div id="historyselectionbanner" class="hsthdrdel">{SELECTALL}<span id="deleteallchatrows"  class="msi-ppdel dIB mrgLR5 cur posl"><div id="deleteallchatrowscount" class="font12 posa textcent zcrwcut"></div></span></div>';t=$Util.CustomCheckbox.construct(t,[{key:"{SELECTALL}",html:'<input id="selectallchatrows" class="zcunrdchkbx" type="checkbox"/>',"class":"msi-hisdelsel"}]);var e=$WC.$Win.create({id:"chathistory","class":"chathistory fullwin",aligncenter:!1,header:t,html:Template.ChatHistory,closefn:function(){Chat.pauseMedia("chathistory"),MainUI.handleIframes("chathistory"),HistoryUI.init()}}),i=e.find("#historyrows");ZCScroll.customScroll(i),e.on("change","input[type=checkbox]",function(e){e.stopPropagation();var t={sel:"msi-hisdelseld",rem:"msi-hisdelsel"};$Util.CustomCheckbox.setStatus($(this),e.target.checked,t)}),i.on("click","[purpose='chathistoryrow']",function(e){var t=$(this);e.stopPropagation(),"loadmore"===this.id?HistoryUI.loadMore():"chathistoryrow"===t.attr("purpose")&&e.target.id!=="select"+t.attr("chid")&&($("#historyrows").find("[select]").removeAttr("select"),t.attr("select","true"),"none"===$("#transcriptcontainer").css("display")&&Clickoutside.bind({destid:"transcriptcontainer",customShow:function(e){$("#"+e.destid).show().animate({left:"35%"},500)},doNotClose:function(){return ImgViewer.isVisible()||"chathistory"!==$WC.$Win.current},customHide:function(e){MainUI.handleIframes("chathistory"),$("#"+e.destid).animate({left:"100%"},500,function(){$(this).hide()})}}),HistoryUI.viewChat(t))}),i.on("change","input",function(e){e.stopPropagation();var t=$(this),i=t.prop("checked");i?HistoryUI.selectedcount++:HistoryUI.selectedcount--,HistoryUI.selectRow(t,i)}),i.on("scroll",function(){if(HistoryUI.loadmore&&ZCScroll.isScrollNearBottom(this,150)){var e=$(this);if(0===e.find("#loadmore").length){HistoryUI.currloadingcount++;var t=HistoryUI.currloadingcount<=HistoryUI.autoloadingcount;e.append('<div id="loadmore" purpose="chathistoryrow" class="hstrset"><div class="hst-lodngmn"><div class="hst-lodngsb">'+(t?Resource.getRealValue("common.loading")+'<span class="hst-loadng"></span>':Resource.getRealValue("common.click.more"))+"</div></div></div>"),t&&HistoryUI.loadMore()}}}),i.on("click","a",function(e){e.preventDefault()}),e.find("#historysearch").on("keyup",function(e){var t=$(this);HistoryUI.selectedcount>0&&$("#historysearch").removeClass("hisdeli"),$("#historyrows").find("[select]").removeAttr("select"),HistoryUI.handleSearch(t,$.trim(t.val()),e)}),e.find("#selectallchatrows").on("change",function(){HistoryUI.selectAllrows($(this).prop("checked"))}),e.find("#deleteallchatrows").on("click",function(e){e.stopPropagation();for(var t=$WC.$Win.get("chathistory").find("#historyrows input[type='checkbox']"),i=[],a=0,s=t.length;s>a;a++){var n=$(t[a]);n.prop("checked")&&i.push(n.attr("chid"))}var r=function(){ChatHistory.delete(i.join(","))};$Util.showChatDeleteAlert(r)}),e.find("#transcriptcontainer").on("click","[purpose='deletechatrows']",function(){var e=$WC.$Win.get("chathistory").find("#historyrows").find(".sel").attr("chid"),t=function(){ChatHistory.delete(e)};$Util.showChatDeleteAlert(t)}),e.find("#cancelhistoryselection").on("click",function(){HistoryUI.selectAllrows(!1)}),e.find("#transcriptcontainer").on("click","[purpose='transcriptoptions']",function(e){"transcriptclose"===this.id?($("#historyrows").find("[select]").removeAttr("select"),Clickoutside.handleClickOnChild(e)):HistoryUI.handleTranscriptoptions(this)}),e.find("#transcriptcontainer").on("click","[purpose='viewreplied']",function(e){"a"===e.target.tagName.toLowerCase()&&e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),i=t.attr("msgtime"),a=t.parents("[mtype]").attr("chid"),s=t.find('[elemtype="user"]').attr("uid"),n=a+"|"+s+"|"+i,r=$("#chathistory").find("#currenttranscript");"undefined"!=typeof i&&$Util.fetchAndScrollToMsg(n,r,HistoryUI.updateTranscript)}),$Util.updateStatusMsg(e.find("#historyrows"),"loading")}this.issearching&&this.updateTranscript(!0)},populate:function(e){var t=$WC.$Win.get("chathistory");if(t){var i=t.find("#historyrows");i.find("#loadmore").remove();var a=e.length,s=t.find("[chid]").length>0;if(a>0){for(var n="",r=0;a>r;r++){var o=e[r],l=o.chatid,c=i.find("#trans"+l);c.length||(n+=this.getRowforChat(o,"trans"))}s?i.append(n):i.html(n),$WC.$CUtil.isEmpty(n)?this.loadmore=!1:(ZCScroll.resetScroll(i),this.loadmore=!0)}else this.loadmore=!1,s||$Util.updateStatusMsg(i)}},getRowforChat:function(e,t){{var i=e.chatid,a=new $CliqChatId(i);ChatsList.isExist(i),ChatUI.getUnreadMsgTime(i)}isunread=ChatUI.hasUnreadOrUnseenMsgs(i);var s=ChatsList.getLastMsgInChat(i,e.lastmsginfo);s=ChatsList.parseLastMsgInfo(i,s);var n=e.lmtime;s.time&&s.time>n&&(n=s.time);var r={};if(a.isChat()&&2==e.pcount){var o=Users.getName(s.sender,s.dname);o==e.title&&(r.senderhtml="")}var l=ChatsList.getLastMsgHTML(i,s,c,r),c=e.title,d="";if(a.isChannel()){var u=Channels.getDisplayNameForChannel(Channels.getByChid(i));u&&(c=u),d='<div class="floatl zcerr"><span class="msi-resend mrgR5"></span>'+Resource.getRealValue("info.history.delete.nopermission")+"</div>"}var m='<div id="'+t+i+'" purpose="chathistoryrow" channel="'+(a.isChannel()?"true":"false")+'" deleted="'+("undefined"!=typeof e.deleted?e.deleted:0)+'" removed="'+("undefined"!=typeof e.removed?e.removed:0)+'" chid="'+i+'"  lmtime="'+e.lmtime+'" class="floatl zcunrdmn '+(a.isChannel()?"zcchunrm":"")+(isunread?" unseen":"")+($WC.$CUtil.isEmpty(l)?" zcunrdone":"")+'">'+(a.isChat()||a.isSystemChat()?"{HISTORYCHECKBOX}":"")+this.getRecipantsPhoto($WC.$CUtil.isEmpty(e.recipantssummary)?{}:JSON.parse(e.recipantssummary),e.pcount,Chat.parseAddinfo(e.addinfo),c,e.chat_type,i,e.customgroup)+'<div class="zcunrd-rht"><div class="zcunrdlt-txt floatl ellips"><span id="'+t+"title"+i+'" class="floatl ellips bold zcunrdtit">'+$WC.$CUtil.processXSS(c)+'</span><div class="zcurdtxt"><span class="zcunrd-dt ellips">'+$Date.daytime(n)+"</span></div></div>"+l+"</div>"+d+"</div>";return $Util.CustomCheckbox.construct(m,[{html:'<input type="checkbox" id="select'+i+'" chid="'+i+'" class="zcunrdchkbx">',key:"{HISTORYCHECKBOX}","class":"msi-hissel"}])},getRecipantsPhoto:function(e,t,i,a,s,n,r){var o="";if(s==$zcg.NO_OPERATIONCHAT){var l=ChatBot.getImgUrl();return MyBots.isBotChid(n)&&(l=MyBots.getImgByChid(n)),'<div class="usrimgsts floatl zc-1"><img class="zcgp1" src="'+l+'"></div>'}if(s===$zcg.ORGCHANNEL){var c=Channels.getByChid(n);return"undefined"==typeof c.photoid?'<div class="usrimgsts floatl zc-1"><div class="msi-sc'+Channels.getLevel(c)+' msci"></div></div>':'<div class="usrimgsts floatl zc-1"><img class="zcgp1" src="'+Channels.getImgUrlByChid(n)+'"></div>'}if(!$.isEmptyObject(e)){var d=e.length,t=$WC.$CUtil.isEmpty(t)?0:parseInt(t);if(t>1){if(t>2||r)o='<div title="'+$WC.$CUtil.processXSS(a)+'" class="usrimgsts floatl"><div class="zcunrdrds rds4">'+$WC.$CUtil.decodeHTMLEntities(a).substr(0,1)+"</div></div>";else for(var u=0;d>u;u++){var m=e[u];WmsImpl.isLocalUser(m.zuid)||(o='<img elemtype="user" hover="true" uid="'+m.zuid+'" class="zcgp1 floatl rds4 cur" title="'+Users.getName(m.zuid,m.dname)+'" src="'+Users.getImgUrlById(m.zuid)+'">')}o='<div class="floatl zc-1">'+o+"</div>"}}return $WC.$CUtil.isEmpty(o)&&(o='<div class="floatl zc-1"><div title="'+$WC.$CUtil.processXSS(a)+'" class="usrimgsts floatl"><div class="zcunrdrds rds4">'+$WC.$CUtil.decodeHTMLEntities(a).substr(0,1)+"</div></div></div>"),o},viewChat:function(e){var t=e.attr("chid");if(this.currenttranscript!==t){var i=$WC.$Win.get("chathistory");i.find("#transcriptcontainer").html('<div id="loadingoldmsgs" class="emcht-inftxtmn"><span class="zcldng"></span></div>'),i.find("#trans"+this.currenttranscript).removeClass("sel");var a={chid:t,unreadchat:e.hasClass("unread"),callback:HistoryUI.updateTranscript,totime:$Util.getSyncedCurrentTime(),lineslimit:Chat.LINESLIMIT};ChatHistory.getTranscript(a),this.currenttranscript=t,e.addClass("sel")}},loadMore:$Util.debounce(function(){var e=parseInt($WC.$Win.get("chathistory").find("#historyrows [lmtime]").last().attr("lmtime"));ChatHistory.getAll({title:$WC.$Win.get("chathistory").find("#historysearch").val(),totime:e,successcallback:function(e){HistoryUI.populate(e.data.chats)}})},HistoryUI,100),handleSearch:function(e,t,i){if(t.length<3)return void(HistoryUI.prevsearchval&&(this.getSearchResults(""),this.updateTranscript(!0),this.prevsearchval=null));HistoryUI.initVarConstants();var a=i.which,s=$WC.$Win.get("chathistory");if(38===a||40===a){if(s.find("#historyrows").hasOnlyChildrenlike("purpose","chathistoryrow")){var e=DropdownUtil.handleListNavigation(i,$("#historyrows"),"[purpose='chathistoryrow']");"undefined"!=typeof e&&this.viewChat(e)}}else 27===a||this.issearching&&0===t.length?(t.length&&i.stopPropagation(),this.clearSearch(e)):t.length>=3&&HistoryUI.prevsearchval!==t&&HistoryUI.getSearchResults(t,400)},clearSearch:function(e){clearTimeout(this.searchtimer),e.val(""),this.getSearchResults(""),this.updateTranscript(!0)},getSearchResults:function(e,t){e.length>0?(this.issearching=!0,this.prevsearchval=e):(this.issearching=!1,this.prevsearchval=null),HistoryUI.construct(),clearTimeout(this.searchtimer),"undefined"!=typeof t?this.searchtimer=setTimeout(function(){ChatHistory.getAll({title:e,successcallback:function(e){HistoryUI.populate(e.data.chats)}})},t):ChatHistory.getAll({title:e,successcallback:function(e){HistoryUI.populate(e.data.chats)}})},deleteChatrows:function(e){var t=e.split(","),i=$WC.$Win.get("chathistory");if(i){var a=i.find("#historyrows");i.find("#historyselectionbanner").hide(),i.find("#historyselectionbanner").removeClass("hisdelial"),$("#historysearch").removeClass("hisdeli"),$("#chathistory").removeClass("zcchndl"),this.selectedcount-=t.length;for(var s=0,n=t.length;n>s;s++)a.find("#trans"+t[s]).remove();-1!==e.indexOf(this.currenttranscript)&&(this.currenttranscript=null,this.updateTranscript(!0)),a.hasOnlyChildrenlike("purpose","chathistoryrow")||this.loadMore()}},selectRow:function(e,t){var i=$("#historyselectionbanner"),a=e.parents("[purpose='chathistoryrow']");e.prop("checked",t);var s={sel:"msi-hisseld",rem:"msi-hissel"};$Util.CustomCheckbox.setStatus(e,t,s),t?(a.addClass("zcvsble"),i.addClass("hisdelial"),$("#historysearch").addClass("hisdeli"),i.find("#deleteallchatrowscount").html(this.selectedcount),i.show(),1===this.selectedcount&&$("#chathistory").addClass("zcchndl")):(0===this.selectedcount&&($("#historysearch").removeClass("hisdeli"),i.removeClass("hisdelial"),$("#chathistory").removeClass("zcchndl")),i.find("#deleteallchatrowscount").html(this.selectedcount),a.removeClass("zcvsble"))},selectAllrows:function(e){var t=$WC.$Win.get("chathistory"),i=$WC.$Win.get("chathistory").find("#historyrows"),a=i.children('[purpose="chathistoryrow"][channel="false"]'),s=a.length;t.find("#selectallcheckbox").removeClass("msi-hisseld").addClass("msi-hissel"),this.selectedcount=e?s:0;for(var n=0;s>n;n++)this.selectRow($(a[n]).find("input"),e)},updateTranscript:function(e,t,i,a,s,n,r,o){var o=o||!1,l="",c="";if(o)l=$(r);else if(c=$WC.$Win.get("chathistory"),l=c.find("#transcriptcontainer"),!$WC.$CUtil.isEmpty(i)&&HistoryUI.currenttranscript!==i)return;if(e){var d=l.find("#currenttranscript");if(d.find("#loadingoldmsgs").remove(),"undefined"==typeof t)l.html('<span id="transcriptclose" purpose="transcriptoptions" title="'+Resource.getRealValue("common.to.close")+'" class="msi-close cclose"></span><div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("history.chat.select")+"</div></div>");else{if(!o)var u=new $CliqChatId(HistoryUI.currenttranscript);var m=!1;if(0===d.length)if(o)l.html('<div class="hstcht posl"><div id="currenttranscript" purpose="transcriptholder" class="currchatpanel hstrht-data"></div></div>'),d=l.find("#currenttranscript"),m=!0;else{var p=c.find("#trans"+HistoryUI.currenttranscript),h=c.find("#transtitle"+HistoryUI.currenttranscript).text();p.removeClass("unread"),l.html('<span id="transcriptclose" purpose="transcriptoptions" title="'+Resource.getRealValue("common.to.close")+'" class="msi-close cclose"></span><div class="zchstdel posl"><div class="floatl font15 ellips mrgR10">'+$WC.$CUtil.processXSS(h)+"</div>"+(u.isChannel()?'<div class="zcflt_btn btn-anim"><div id="continuechat" chid="'+HistoryUI.currenttranscript+'" purpose="transcriptoptions" class="zchovrcht">'+Resource.getRealValue("common.continue")+"</div></div>":0===parseInt(p.attr("removed"))&&0===parseInt(p.attr("deleted"))?'<div class="zcflt_btn btn-anim"><div id="continuechat" chid="'+HistoryUI.currenttranscript+'" purpose="transcriptoptions" class="zchovrcht">'+Resource.getRealValue("common.continue")+"</div></div>":"")+'<div id="printtranscript" purpose="transcriptoptions" chid="'+HistoryUI.currenttranscript+'" title="'+Resource.getRealValue("common.print")+'" class="msi-print clrb cur mrgL10 font16 zchsicn"></div>'+(u.isChannel()?"":'<div purpose="deletechatrows" chid="'+HistoryUI.currenttranscript+'" title="'+Resource.getRealValue("common.delete")+'" class="msi-ppdel clrb cur font16 mrgL10 zchsicn"></div>')+'</div><div class="hstcht posl"><div id="currenttranscript" purpose="transcriptholder" class="currchatpanel hstrht-data"></div></div>'),d=l.find("#currenttranscript"),m=!0}var g={chid:o?i:HistoryUI.currenttranscript,callback:HistoryUI.updateTranscript,lineslimit:Chat.LINESLIMIT};o&&(g.target=r,g.issearchacross=o),ChatUI.handleScrollToLoadMore({dom:l,chid:o?i:HistoryUI.currenttranscript,fetchmethod:ChatHistory.getTranscript,totime:s,fromtime:a,data:g});var f={chid:o?i:HistoryUI.currenttranscript,dom:d,unreadmarkertime:ChatUI.getUnreadMsgTime(i),origin:"chatHistory"},v=MsgUtil.formatTranscript(t,f);if(ChatUI.updateFirstMsgOffsetValue(s,a,d),MsgUtil.updateTranscript(d,v,a,s),a||s||!n)ChatUI.scrollToMsgView(s,a,d);else{var C=n.split("|"),y=$("#chathistory").find("#currenttranscript");msguid=C[1]+"_"+C[2],$Util.scrollToMsgInCurrentTranscriptView(msguid,y,i)}m&&0===v.length&&(d.html('<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("channel.conv.none.chat")+"</div></div>"),l.find("#printtranscript").remove()),o||(clearTimeout($Util.ontranscroll),$Util.handleTransViewScroll(l),$Util.animateBtnTransView(l))}}else l.html('<div class="emcht-inftxtmn"><div class="emcht-inftxt">'+Resource.getRealValue("history.chat.error")+"</div></div>");var b=l.find("#currenttranscript");0===b.scrollTop()&&ChatUI.loadVisibleImages(b[0])},handleTranscriptoptions:function(e){var t=e.id,e=$(e),i=e.attr("chid");if("continuechat"===t){var a=new $CliqChatId(i);a.isChannel()?(this.handleContinue(),Channels.join(i,!0)):Chat.attachSession(i),Clickoutside.clear("transcriptcontainer"),HistoryUI.handleContinue()}else"printtranscript"===t&&window.open("/printochatpreview.do?chid="+i+"&tzoffset="+$zcg._TZOFFSET)},handleContinue:function(){$WC.$Win.destroy("chathistory"),$WC.$Win.destroy("chattranscript")}},ChatHistory={load:function(){HistoryUI.construct(),this.getAll({successcallback:function(e){HistoryUI.populate(e.data.chats)}})},getAll:function(e,t){var i={};i.limit="undefined"!=typeof e.lim?e.lim:HistoryUI.limit,"undefined"!=typeof e.recipient&&(i.recipient=e.recipient),"undefined"!=typeof e.title&&(i.title=e.title),"undefined"!=typeof e.fromtime&&(i.fromtime=e.fromtime),i.totime="undefined"!=typeof e.totime?e.totime:(new Date).getTime();var a="function"==typeof e.successcallback?e.successcallback:$.noop,s="function"==typeof e.failurecallback?e.failurecallback:$.noop;$ZCAjx.ajax({url:t?"/v1/chats":"/v1/history",data:i,success:function(e){a(e,i)},error:function(e){s(e,i)}})},getTranscript:function(e){var t=e.chid,i=e.fromtime,a=e.totime,s=e.callback,n=e.mentionmsgid,r=e.target,o=e.issearchacross,l={chid:t,fromtime:i,totime:a,tzoffset:$zcg._TZOFFSET},c=e.requrl||"/gettranscriptasjsonforweb.do";e.unreadchat&&(l.makeread=!0),e.mentionmsgid&&(l.mentionmsgid=n),"undefined"!=typeof e.lineslimit&&(l.lineslimit=e.lineslimit),"undefined"!=typeof e.ctype&&(l.type=e.ctype),e.time&&(l.time=e.time),e.cache&&(l.cache=!0),$ZCAjx.ajax({url:c,data:l,success:function(e){e=e.substring(0,e.length-1),e=JSON.parse("["+e+"]"),o?s(!0,e,t,i,a,n,r,o):s(!0,e,t,i,a,n)},error:function(e){o?s(!1,e,t,i,a,n,r,o):s(!1,e,t,i,a,n)}})},"delete":function(e){e.length<=0||$ZCAjx.ajax({url:"/deleteselectedchat.do",type:"POST",data:{chid:e},success:function(){HistoryUI.deleteChatrows(e);for(var t=e.split(","),i=0;i<t.length;i++){var a=t[i];ChatUI.isExist(a)&&!$WC.$CUtil.isEmpty(ChatsList.getCatagory(a))&&(ChatUI.removeWindow(a),ChatsList.delete(a))}}})}},ChatHistoryTitleSearch={searchhtml:'<div elemtype="chathistory" purpose="search" chid="{CHID}" class="zcuserstatus {NONLASTMSGCLASS} withimg">{CHATIMAGE}<div class="zcunrd-rht"><div class="zcunrdlt-txt floatl ellips"><span class="floatl ellips bold zcunrdtit">{TITLENAME}<span></div>{LASTMSGHTML}</div><div class="msi-chatico"></div></div>',getrequesttimer:"",isupdationallowed:!1,data:{},previoussearches:[],MAXLIMIT:10,init:function(){this.defaultSearchCriteria={ignorelist:[],limit:5,successcallback:$.noop,highlight:!0}},currentsearchcriteria:{val:null},update:function(e){if(this.isupdationallowed){var t=this.data;for(var i in e){var a={},s=e[i];a.chid=s.chatid,a.title=$WC.$CUtil.processXSS(s.title),a.lmtime=s.lmtime,a.addinfo=s.addinfo,a.participants=s.recipantssummary,a.participantscount=s.pcount,a.lastmsginfo=s.lastmsginfo,a.ctype=s.chat_type,a.removed=s.removed,a.deleted=s.deleted,t[s.chatid]=a}}},cleanSearchCriteria:function(){this.currentsearchcriteria={val:null}},cleanData:function(){this.isupdationallowed=!1,this.data={},this.previoussearches=[]},getSearchResults:function(e){this.isupdationallowed=!0;var t=this.currentsearchcriteria.val;this.currentsearchcriteria=$.extend({},this.defaultSearchCriteria,e),this.currentsearchcriteria.val=this.currentsearchcriteria.val.toLowerCase();var i=this.search(),a=i.searchedlist.length;if(a>=this.currentsearchcriteria.limit||SearchAgent.isPreviouslySearched(this.previoussearches,this.currentsearchcriteria.val)||this.currentsearchcriteria.containssearch)return this.cleanSearchCriteria(),i.furtherreq=!1,i;if(t!==this.currentsearchcriteria.val){this.currentsearchcriteria.ignorelist=this.currentsearchcriteria.ignorelist.concat(i.searchedlist),this.currentsearchcriteria.limit-=a,clearTimeout(this.getrequesttimer);var s=ChatHistoryTitleSearch.currentsearchcriteria.val;null!==s&&(this.getrequesttimer=setTimeout(function(){ChatHistory.getAll({title:s,lim:ChatHistoryTitleSearch.MAXLIMIT,pno:1,successcallback:function(e,t){ChatHistoryTitleSearch.handleTitleBasedFetchSuccessResponse(e,t.title)},failurecallback:function(e,t){ChatHistoryTitleSearch.handleFetchResponse(t.title,"")}},!0)},500))}return{content:i.content,searchedlist:i.searchedlist,furtherreq:!0}},search:function(){function e(e,t,i,a){var t=$WC.$CUtil.processXSS(t),s=e.chid,n=ChatsList.getTitle(s,e.title),r=HistoryUI.getRecipantsPhoto($WC.$CUtil.isEmpty(e.participants)?{}:JSON.parse(e.participants),e.participantscount,Chat.parseAddinfo(e.addinfo),n,e.ctype,s,e.customgroup),o=ChatsList.getLastMsgInChat(s,e.lastmsginfo),l=ChatsList.getLastMsgHTML(s,ChatsList.parseLastMsgInfo(s,o),n);if(a)var c=new RegExp($WC.Matcher.replace("escaperegexp",t),"i"),d=n.match(c),u=n.replace(d,"<b>$&</b>");return i=i.replace(/{CHID}/g,s).replace(/{TITLE}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{TITLENAME}/g,$WC.Matcher.replace("escapeReplacementString",u)).replace(/{NONLASTMSGCLASS}/g,l?"":"zcunrdone").replace(/{LASTMSGHTML}/g,$WC.Matcher.replace("escapeReplacementString",l)).replace(/{ISREMOVED}/g,1===e.removed).replace(/{DELETEDSTATUS}/g,e.deleted).replace(/{CHATIMAGE}/g,$WC.Matcher.replace("escapeReplacementString",r))}function t(e,t,i){var a=t.ignorelist;if(a.length>0){var s=a.indexOf(e);if(t.filterusers&&-1===s){var n=ChatHistoryTitleSearch.getParticipantZuid(i)||ChatsList.getRecipientDatafor121chat(i.chid).zuid;s=a.indexOf(n)}if(Chat.isChannelChid(e)){var r=Channels.getChannelId(e);s=a.indexOf(r)}if(-1!==s)return!1}return t.ignorebot&&ChatsList.isBotChat(e)?!1:!0}return function(){var i=this.data,a=new RegExp("\\b"+$WC.Matcher.replace("escaperegexp",this.currentsearchcriteria.val),"i"),s=[],n=[],r=[],o="undefined"!=typeof this.currentsearchcriteria.html?this.currentsearchcriteria.html:this.searchhtml;content="",this.currentsearchcriteria.addchatlist&&(i=$.extend(this.data,ChatsList.getAll()));for(var l in i){var c=i[l];if(t(l,this.currentsearchcriteria,c)){var d=$Util.searchWithSpecialChars(c.title,this.currentsearchcriteria.val);0!==d?(a.test(c.title)||"*"===this.currentsearchcriteria.val||d>=0)&&n.push([l,c.lmtime]):s.push([l,c.lmtime])}}for(var u=$Util.getObjBasedonCriteria({startswithobj:$Util.sort(s,1,!0),containsobj:$Util.sort(n,1,!0),limit:this.currentsearchcriteria.limit,startswithsearch:this.currentsearchcriteria.startswithsearch,containssearch:this.currentsearchcriteria.containssearch}),m=0,p=u.length;p>m;m++){r.push(u[m][0]);var c=i[u[m][0]];c.chid=u[m][0],content+=e(c,this.currentsearchcriteria.val,o,this.currentsearchcriteria.highlight)}return{content:content,searchedlist:r}}}(),getParticipantZuid:function(e){if(1===e.ctype&&2===e.participantscount&&e.participants)for(var t=JSON.parse(e.participants),i=0;2>i;i++)if(t[i].zuid!==$zcg._ZUID)return t[i].zuid;return""},handleTitleBasedFetchSuccessResponse:function(e,t){var i=e.data.chats;if(ChatHistoryTitleSearch.update(i),"undefined"!=typeof i&&i.length<=this.MAXLIMIT&&$Util.updateArrayWithLimit(ChatHistoryTitleSearch.previoussearches,t,50),t===ChatHistoryTitleSearch.currentsearchcriteria.val){var a=ChatHistoryTitleSearch.search().content;ChatHistoryTitleSearch.handleFetchResponse(t,a)}},handleFetchResponse:function(e,t){t?ChatHistoryTitleSearch.currentsearchcriteria.successcallback(t,ChatHistoryTitleSearch.currentsearchcriteria.listid,ChatHistoryTitleSearch.currentsearchcriteria.populateid,"",e):ChatHistoryTitleSearch.currentsearchcriteria.emptycallback(e,ChatHistoryTitleSearch.currentsearchcriteria.listid,ChatHistoryTitleSearch.currentsearchcriteria.populateid,"",e),ChatHistoryTitleSearch.cleanSearchCriteria()},getTitle:function(e){return this.data[e]?$WC.$CUtil.processXSS(this.data[e].title):""}};var Markdown={};Markdown={apply:function(e){return e=""+e,e=this.applyOnce(e),e=this.applyRecursive(e),e=this.decodeChars(e)},applyOnce:function(e){return e=$WC.Matcher.replace("markdown_link",e,this.getLinkHTML),e=$WC.Matcher.replace("markdown_quote",e,this.getQuoteHTML),e=$WC.Matcher.replace("markdown_heading",e,this.getHeadingHTML),e=$WC.Matcher.replace("markdown_codeblock",e,this.getCodeblockHTML),e=$WC.Matcher.replace("markdown_code",e,this.getCodeHTML),"undefined"!=typeof MsgUtil&&(e=MsgUtil.getDisplayableSilentUserMentionMsg(e,!0)),e},applyRecursive:function(e){return e=$WC.Matcher.replace("markdown_bold",e,this.getBoldHTML),e=$WC.Matcher.replace("markdown_italic",e,this.getItalicHTML),e=$WC.Matcher.replace("markdown_strike",e,this.getStrikeHTML),e=$WC.Matcher.replace("markdown_underscore",e,this.getUnderscoreHTML),e=$WC.Matcher.replace("markdown_line",e,this.getLineHTML)},getLinkHTML:function(e,t,i,a,s){var n="www."===s?"http://"+a:a;return t+'<a href="'+n+'" markdown="linkhtml" target="_blank">'+Markdown.encodeChars(i)+"</a>"},getQuoteHTML:function(e,t){return t=$.trim(t),0===t.length?e:"<blockquote>"+Markdown.applyRecursive(t)+"</blockquote>"},getHeadingHTML:function(e,t,i){var a=t.length;return"<h"+a+">"+Markdown.encodeChars(i)+"</h"+a+">"},getLineHTML:function(e,t,i,a){return"<hr>"+Markdown.applyRecursive($.trim(a))},getCodeblockHTML:function(e,t,i){return i=$.trim(i),0===i.length?e:t+"<pre>"+Markdown.applyRecursive(i)+"</pre>"},getCodeHTML:function(e,t,i){return!i||!i.match(/[^_*`~]/)||"`"===i[0]||"`"===i[i.length-1]||" "===i[0]&&" "===i[i.length-1]?e:t+"<code>"+Markdown.encodeChars(i)+"</code>"},getBoldHTML:function(e,t,i){return!i||!i.match(/[^_*`~]/)||"*"===i[0]||"*"===i[i.length-1]||" "===i[0]&&" "===i[i.length-1]?e:t+"<strong>"+Markdown.applyRecursive(i)+"</strong>"},getItalicHTML:function(e,t,i){return!i||!i.match(/[^_*`~]/)||"_"===i[0]||"_"===i[i.length-1]||" "===i[0]&&" "===i[i.length-1]?e:t+"<i>"+Markdown.applyRecursive(i)+"</i>"},getStrikeHTML:function(e,t,i){return!i||!i.match(/[^_*`~]/)||"~"===i[0]||"~"===i[i.length-1]||" "===i[0]&&" "===i[i.length-1]?e:t+"<strike>"+Markdown.applyRecursive(i)+"</strike>"},getUnderscoreHTML:function(e,t,i){return!i||!i.match(/[^_*`~]/)||"__"===i[0]||"__"===i[i.length-1]||" "===i[0]&&" "===i[i.length-1]?e:t+"<u>"+Markdown.applyRecursive(i)+"</u>"},encodeChars:function(e){return e.replace(/\*/g,"&ast;").replace(/\_/g,"&#95;").replace(/\~/g,"&#126;")},decodeChars:function(e){return e.replace(/&ast;/g,"*").replace(/&#95;/g,"_").replace(/&#126;/g,"~")},remove:function(e){return e=$WC.Matcher.replace("markdown_quote",e,"$1"),e=$WC.Matcher.replace("markdown_heading",e,"$2"),e=$WC.Matcher.replace("markdown_codeblock",e,"$2"),e=$WC.Matcher.replace("markdown_code",e,"$2"),e=$WC.Matcher.replace("markdown_bold",e,"$2"),e=$WC.Matcher.replace("markdown_italic",e,"$2"),e=$WC.Matcher.replace("markdown_strike",e,"$2"),e=$WC.Matcher.replace("markdown_underscore",e,"$2"),e=$WC.Matcher.replace("text_doublequoted",e,"$2"),e=$WC.Matcher.replace("text_singlequoted",e,"$2")},convertToActualMsg:function(e,t){for(var i=$WC.DivEditor.getNodes(e),a=0,s=i.length,n="";s>a;a++)if(i[a].nodeType===Node.TEXT_NODE)n+=i[a].nodeValue;else{var r=i[a].nodeName,o="editinfo"===i[a].getAttribute("id");if("STRONG"===r)n+="*"+Markdown.convertToActualMsg(i[a],t)+"*";else if("CODE"===r)n+="`"+Markdown.convertToActualMsg(i[a],t)+"`";else if("PRE"===r)n+="```"+Markdown.convertToActualMsg(i[a],t)+"```";else if("STRIKE"===r)n+="~"+Markdown.convertToActualMsg(i[a],t)+"~";else if("I"===r)n+="_"+Markdown.convertToActualMsg(i[a],t)+"_";else if("U"===r)n+="__"+Markdown.convertToActualMsg(i[a],t)+"__";else if("EM"!==r&&"SPAN"!==r||!i[a].hasAttribute("code"))if("BLOCKQUOTE"===r)"viewreplied"!==i[a].getAttribute("purpose")&&(n+="! "+Markdown.convertToActualMsg(i[a],t)+"\n");else if("HR"===r)n+=" --- ";else if("DIV"===r&&"urlunfurl"===i[a].getAttribute("purpose"))-1===n.indexOf(i[a].getAttribute("url"))&&(n+=i[a].getAttribute("url"));else if(t&&"SPAN"===r){var l=i[a].getAttribute("elemtype");if("user"===l||"group"===l||"channel"===l||Mentions.isSpecialMentionElemType(l)){var c=i[a].innerHTML.charAt(0),d=i[a].getAttribute("uid"),u=$(i[a]).text().substring(1);if("+"===c){var m="user"===l?1:"group"===l?2:3;n+="{addchatmember:"+d+":"+m+":"+u+":addchatmember}"}else if("-"===c){var m="user"===l?1:"group"===l?2:3;n+="{deletechatmember:"+d+":"+m+":"+u+":deletechatmember}"}else n+=Composer.getMention(i[a])}else o||(n+=$(i[a]).text())}else if("DIV"===r&&("urlunfurl"===i[a].getAttribute("purpose")||$(i[a]).hasClass("zcsitedetail")||$(i[a]).hasClass("zclnkimg"))){var p=i[a].querySelector("img");n+=p&&-1===n.indexOf(p.getAttribute("src"))?p.getAttribute("src"):""}else if("BR"===r)n+="\n";else if("A"===r){var h=i[a].getAttribute("markdown");n+="linkhtml"===h?"["+i[a].text+"]("+i[a].getAttribute("href")+")":i[a].text}else if("H"===r.charAt(0)&&r.charAt(1)&&!isNaN(r.charAt(1))){var g=parseInt(r.charAt(1));n+="#".repeat(g)+" "+Markdown.convertToActualMsg(i[a],t)}else o||(n+=$(i[a]).text());else n+=i[a].getAttribute("code")}return n}};var MsgUtil={},MsgTemplate={};$WC.ButtonActionsImpl={},InfoButtonActionsImpl={},MsgUtil={MSGSOURCE_BOT:1,format:function(e,t){var i=MsgUtil.getMsgObjVersion(e);"v0"==i&&(e=$WC.CMsgUtil.convertMsgObj(e));var a=MsgTemplate.getMsg(e,t);return $(a)},formatEditedMsg:function(e,t){var i=MsgUtil.getMsgObjVersion(e);"v0"==i&&(e=$WC.CMsgUtil.convertMsgObj(e));var a=MsgTemplate.getEditedMsg(e,t);return $(a)},getMockedObject:function(e,t){var i=parseInt(t.mtype);if(20===i){var a=t.info.__module||t.mode;t.nname=t.dname,t.mod=a,t.chid=e}else 16===i?(t.info.opruser={nname:t.dname,zuid:t.sender},t.chid=e):i===$zcg.EDIT_INFO?(t.info=t.msg,t.sender=t.info.opruser.zuid,t.ref_time=t.msg.info.ref_msg_time):t.nname=t.dname;return t.chid=e,t},formatTranscript:function(e,t){var i=t.chid;t.origin=t.origin||"cwin",e=MsgUtil.processTranscript(e,i,t.origin);var a=0,s=e.length,n=0,r="";if(0>=s)return $(r);"-1"===e[0].time&&"chat.more"===e[0].msg&&(t.dom&&t.dom.attr("hastopmore","true"),r+=MsgTemplate.getLoadMore(),a++),n=a;var o=-1,l=null,c=!1,d=!1;for(t.unreadmarkertime&&(t.unreadmarkertime=parseInt(t.unreadmarkertime));s>a;a++){var u=e[a],m=MsgUtil.getMsgObjVersion(u);if("v0"==m&&(u=$WC.CMsgUtil.convertMsgObj(u)),-1!==parseInt(u.time)){if(t.onreconnection){var p=$("#"+i).find("#msgarea"),h=p.find('[mtype][msgtime="'+u.time+'"]');if(h.length)continue;if(WmsImpl.isLocalUser(u.sender)&&(h=p.find('[mtype][msgtime="'+u.ack+'"]'),h.length)){if(ChatUI.isExist(i)){var g=ChatUI.exist[i];g.lastmsgtime=parseInt(u.time),g.unreadtime=parseInt(u.time)+1}u=this.getMockedObject(t.chid,u),h.replaceWith(MsgTemplate.getMsgContent(u,{}));continue}}d=t.unreadmarkertime&&-1!==t.unreadmarkertime&&t.unreadmarkertime<=parseInt(u.time)?!0:!1;var f={chid:i,prevmsgtime:o,prevmsgsender:l,isnew:d,isprevmsgareply:c,origin:t.origin};u=this.getMockedObject(i,u),r+=MsgTemplate.getMsg(u,f),c=u.isreply,o=MsgUtil.getTimefromMsgObj(u),l=ChatUI.getSenderForLastMsgSender(u),(this.isCustomSender(u)||this.isSentByPlatformComponent(u))&&(l=u.sender+"_"+u.time)}}if(s&&e[s-1]){var v=e[s-1];"-1"===v.time&&"chat.more"===v.msg&&t.dom&&t.dom.attr("hasbottommore","true")}return $(r)},updateTranscriptInBetween:function(e,t,i,a){{var s=(e.find("[mtype]"),i-1),n=e.find('[mtype][msgtime="'+s+'"]');t.filter("[mtype]")}if(0!==t.length){var r=n.prevAll('[purpose="date"]:first'),o=n.prevAll('[purpose="sender"]:first'),l=t.filter('[purpose="date"]').first(),c=t.filter('[purpose="sender"]').first(),d=t.filter('[purpose="date"]').last(),u=e.find('[purpose="date"][msgtime="'+a+'"]');if(r.length>0&&l.length>0&&r.html()===l.html()){var m=t.index(l);if(t.splice(m,1),o.length>0&&c.length>0&&o.html()===c.html()){var m=t.index(c);t.splice(m,1)}}u.length>0&&d.length>0&&u.html()===d.html()&&u.remove(),n.after($(t))}},updateTranscript:function(e,t,i,a){function s(e,t){var i=e.find("[mtype]"),a=t.filter("[mtype]"),s=i.filter('[uid= "'+a[0].getAttribute("uid")+'"]');if(olddatestringsDOM=e.find('[purpose="date"]'),oldlastdatestringDOM=olddatestringsDOM.last(),oldlastsenderstringDOM=e.find('[purpose="sender"]').last(),newfirstdatestringDOM=t.filter('[purpose="date"]').first(),newfirstsenderstringDOM=t.filter('[purpose="sender"]').first(),islastmsgindomisinfo=MsgUtil.isInfoMsg(i.last().attr("mtype")),isfirstmsginfragmentisinfo=MsgUtil.isInfoMsg(a.first().attr("mtype")),oldlastdatestringDOM.length)if($Date.isSameDay(oldlastdatestringDOM.attr("msgtime"),newfirstdatestringDOM.attr("msgtime"))){var n=t.index(newfirstdatestringDOM);t.splice(n,1)}else{var r=olddatestringsDOM.length;oldlastdatestringDOM[0].firstChild.innerHTML=$Date.day(oldlastdatestringDOM.attr("msgtime")),r>1&&(olddatestringsDOM[r-2]=$Date.day(olddatestringsDOM[r-2].getAttribute("msgtime")))}if(newfirstsenderstringDOM.length){var o=t.index(newfirstsenderstringDOM),l=islastmsgindomisinfo;t[o-1]&&(l="16"===t[o-1].getAttribute("mtype")),oldlastsenderstringDOM.attr("sender")!==newfirstsenderstringDOM.attr("sender")||islastmsgindomisinfo&&!isfirstmsginfragmentisinfo||"date"===t[0].getAttribute("purpose")||l||t.splice(o,1)}0===s.length&&e.append(t)}function n(e,t){var i=e.find("[mtype]"),a=t.filter("[mtype]"),s=e.find('[purpose="date"]').first(),n=e.find('[purpose="sender"]').first(),r=t.filter('[purpose="date"]').last(),o=t.filter('[purpose="sender"]').last(),l=MsgUtil.isInfoMsg(i.first().attr("mtype")),c=MsgUtil.isInfoMsg(a.last().attr("mtype"));if($Date.isSameDay(s.attr("msgtime"),r.attr("msgtime"))&&s.remove(),o.length){var d=e.children(),u=d.index(n),m=c;d[u-1]&&(m="16"===d[u-1].getAttribute("mtype")),n.attr("sender")!==o.attr("sender")||c&&!l||"date"===e[0].firstChild.getAttribute("purpose")||m||n.remove()}e.prepend(t)}var r="undefined"!=typeof i&&"undefined"==typeof a,o=(e.find("[mtype]"),t.filter("[mtype]"),e.find("#transcriptfetcherror"));if(0!==t.length){var l=!e.children().length;"undefined"==typeof i&&"undefined"==typeof a&&l&&e.html(t),l?o.length?e.append(t):(e.html(t),Tour.handleFirstMsgTour(e)):r?s(e,t):n(e,t)}},updateEditedMsginTranscript:function(e,t,i){{var a=e.find('[msguid="'+i+'"]');a.find('[msgtype="msg"]')}a.replaceWith(t)},updateDeletedInfoMsginTranscript:function(e,t,i){var a=e.find('[msguid="'+i+'"]');a.replaceWith(t)},isDeletedInfoMsg:function(e){return this.validateMtype(e,$zcg.DELETE_MTYPE)},isEditedMsg:function(e){return this.validateMtype(e,$zcg.EDIT_MTYPE)},isChatMoreMsg:function(e){return e&&"more"===e.mode},isMentionMsg:function(e){return this.isOldMentionMsg(e)||this.isNewMentionMsg(e)},isNewMentionMsg:function(e){return $WC.Matcher.check("zcatmention_v2",e)},isOldMentionMsg:function(e){return $WC.Matcher.check("atmentiontemplate",e)},getDisplayableSilentUserMentionMsg:function(e,t){return $WC.Matcher.replaceWithFlag("usersilentmention",e,"g",function(e,i,a,s){var n='<span elemtype="user" hover="true" uid="{{UID}}" silentmention class="hvrinfo {{CLASSMINE}}">{{DNAME}}</span>',r=WmsImpl.isLocalUser(s),o=r||HoverDetails.hasPermissionforUserInfo(s)?Users.getName(s,a):"";return a=""===o?$WC.$CUtil.processXSS(a):o,t||(a="@"+a),$WC.template.replace(n,{UID:s,CLASSMINE:r?"atme":"",DNAME:a})})},isChatMemberAdded:function(e){return $WC.Matcher.check("addchatmember",e)},isChatMemberDeleted:function(e){return $WC.Matcher.check("deletechatmember",e)},escape:function(e,t){return t||(e=$WC.$CUtil.decodeHTMLEntities(e)),e.replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},isCustomMessage:function(e){return!$.isEmptyObject(e["brief.msg"])},isNativeWidget:function(e){return e&&"undefined"!=typeof e.native_widget},isCustomSender:function(e){return"undefined"!=typeof e["custom.sender"]&&"undefined"!=typeof e["custom.sender"].name},isCustomSenderImage:function(e){return"undefined"!=typeof e["custom.sender"]&&"undefined"!=typeof e["custom.sender"].img},isSentByBot:function(e){return"undefined"!=typeof e["custom.sender"]&&"undefined"!=typeof e["custom.sender"].ms&&parseInt(e["custom.sender"].ms)===this.MSGSOURCE_BOT},isSentByPlatformComponent:function(e){return"undefined"!=typeof e.message_source&&"undefined"!=typeof e.message_source.type},isSentByBotAction:function(e){return"undefined"!=typeof e.message_source&&typeof e.message_source.type!==Integration.Components.Bot&&"undefined"!=typeof e.message_source.action_name},isMsgContainsDelayProp:function(e){return"undefined"!=typeof e.config&&"undefined"!=typeof e.config.d},isHidingMsg:function(e){return"undefined"!=typeof e.meta&&"undefined"!=typeof e.meta.config&&"undefined"!=typeof e.meta.config.h},isSupportedEmbedType:function(e,t){var i=-1!==e.indexOf("text/")||-1!==e.indexOf("application/pdf")||-1!==e.indexOf("application/xml");return i=i&&this.isSupportedEmbedExtension(t)||this.isSupportedDocType(e,t)},isSupportedDocType:function(e,t){if(SecurityManager.hasPermission(Modules.FileViewer)){var i=["application/msword","application/vnd.oasis.opendocument.text","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/ooxml","application/vnd.ms-excel","application/vnd.oasis.opendocument.spreadsheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.sun.xml.calc","text/csv"];return i.includes(e)||this.isSupportedDocZipType(e,t)||this.isSupportedDocTextType(e,t)}return!1},isSupportedDocZipType:function(e,t){var i=["docx","sxc"];return"application/zip"===e&&i.includes(t)},isSupportedDocTextType:function(e,t){var i=["csv","tsv"];return"text/plain"===e&&i.includes(t)},isSupportedEmbedExtension:function(e){return"svg"!==e},getPreviewEmbedType:function(e){return this.isSupportedEmbedType(e)&&(e.startsWith("text/")||e.startsWith("application/xml"))?"text/plain":e},isSupportedAudioType:function(e,t){return MediaPlayer.isSupportedAudioFormat(e)||MediaPlayer.isSupportedAudioFormat("audio/"+t)},getVideoType:function(e){return"video/quicktime"===e||"video/mov"===e?"video/mp4":e},isSupportedVideoType:function(e,t){return e=this.getVideoType(e),MediaPlayer.isSupportedVideoFormat(e)||MediaPlayer.isSupportedVideoFormat("video/"+t)},getImageUrlFromId:function(e){return"/v1/images/"+e},getMsgObjVersion:function(e){return"undefined"!=typeof e.version?e.version:"v0"},pushForceNotification:function(e){return Mentions.isMine(e)||e.isreply&&e.replied.info.sender===$zcg._ZUID?!0:!1},getStarDiv:function(e,t){if(!SecurityManager.hasPermission(Modules.StarredMessages))return"";var i=Channels.getByChid(e.chid),a="",s=$("#"+e.chid).find("#chatbody").attr("msgselectionmode")?!0:!1;if(starsallowed="false"!==$zcg._ISSTARMESSAGEENABLED?i.oc_id?Channels.isJoined(i):!0:!1,msgtime=MsgUtil.getTimefromMsgObj(e),!t.isundelivered&&starsallowed)if(e.star){var n=e.startype?e.startype:StarMessages.defaultType;a='<div id="star'+msgtime+'" '+(s?'style="display: none;"':"")+' type="'+n+'" purpose="staroptions" star="true" class="msi-starsel type'+n+' starselicon cur" ></div>'}else a='<div id="star'+msgtime+'" '+(s?'style="display: none;"':"")+' purpose="staroptions" star="false" class="msi-star staricon cur" ></div>';return a},removeImagefromChatwindow:function(e){var t=$(e),i=t.parents("[chid]").attr("chid");t.remove(),ZCScroll.resetScroll($("#chatwindows #"+i+" #chatbody"))},retainScrollonImageLoad:function(e){var t=$(e),i=t.parents("[chid]").attr("chid");if(ChatUI.isExist(i)){var a=ChatUI.exist[i];a.retainScrollPosition()}},isSecureUrl:function(e){return!$WC.$CUtil.isEmpty(e)&&e.startsWith("https://")},getMsgMentionuid:function(e){var t=e.attr("msgtime"),i=e.parents("[mtype]").attr("chid"),a=e.find('[elemtype="user"]').attr("uid");return i&&a&&t?i+"|"+a+"|"+t:void 0},getMsgUidWithoutChid:function(e){if(e){var t=e.split("|");return"undefined"!==t[1]&&"undefined"!==t[2]?t[1]+"_"+t[2]:void 0}},processTranscript:function(e,t,i){for(var a=[],s=MessageOperations.delete.add,n=ChatUI.exist[t],r="cwin"===i,o=0;o<e.length;o++){var l=e[o],c=a[a.length-1];if(!(r&&n&&n.storage.hasMessage(l.msguid))){if(this.isDeletedInfoMsg(l)){var d=this.getDelMsgVisibility(l);if(!d){s(t,l);continue}if(c){var u=$Date.isSameDay(l.origin_time,c.origin_time),m=l.sender==c.sender;if(parseInt(l.mtype)==$zcg.DELETE_MTYPE&&parseInt(c.mtype)==$zcg.DELETE_MTYPE&&m&&u){var p=a[a.length-1],h=p.count?parseInt(p.count):1,g=p.msg_timings?p.msg_timings:"",f=$WC.$CUtil.isEmpty(g)?[]:g.split(",");p.count=h+1,p.final_delete_time=l.time,f.push(l.origin_time),p.msg_timings=f.join(","),a.splice(-1,1),a.push(p);continue}}}this.isEditedMsg(l)&&(l=MsgUtil.updateEditedMsgObj(l)),l.reactions&&(l.reactions=Reactions.convertObject(l.reactions)),a.push(l)}}return a},getTimefromMsgObj:function(e){return $WC.$CUtil.isEmpty(e)||$WC.$CUtil.isEmptyObject(e)?"-1":e.origin_time?e.origin_time:e.time},validateMtype:function(e,t){var i=$WC.$CUtil.isEmpty;if(!i(e)){var a=e;return i(e.mtype)||(a=e.mtype),a=parseInt(a),a!==$zcg.EDIT_MTYPE||t===$zcg.EDIT_MTYPE||i(e.current_mtype)||(a=parseInt(e.current_mtype)),a===t}},isAttachmentMsg:function(e){return this.validateMtype(e,$zcg.ATTACHMENT_MTYPE)},isTextMsg:function(e){return this.validateMtype(e,$zcg.TEXT_MTYPE)},isMsg:function(e){var t=$WC.$CUtil.isEmpty;return t(e)?void 0:this.isTextMsg(e)?!0:this.isAttachmentMsg(e)?!0:!1},isInfoMsg:function(e){return this.validateMtype(e,16)||this.isEditInfoMsg(e)},isEditInfoMsg:function(e){return this.validateMtype(e,$zcg.EDIT_INFO)},isMsgEditable:function(e,t){var i=$WC.$CUtil.isEmpty;if(i(e)||i(t))return!1;var a=$Util.getSyncedCurrentTime(),s=parseInt(this.getTimefromMsgObj(e))+$zcg._MSG_EDIT_TIMEFRAME;if(i(e.ismymsg)&&(e.ismymsg=WmsImpl.isLocalUser(e.sender)),t&&0===MessageOperations.EDIT)return!1;if(a>s)return!1;if(!$zcg._ISEDITENABLED)return!1;if(i(e.msguid))return!1;if(!MsgUtil.isTextMsg(e))return!1;if(e.iscustom||e.isnativewidget)return!1;if(e.iscomponentmsg)return!1;var n=new $CliqChatId(e.chid);if(n.isChannel()){var r=Channels.getByChid(e.chid),o=!1;return e.ismymsg&&(o=ChannelsPermission.hasPermission(Channels.ACTIONS.EDIT_MY_MSG,r)),o}return e.ismymsg},isMsgDeletable:function(e,t,i){var a=$WC.$CUtil.isEmpty;if(a(e)||a(i)||a(t))return!1;var s=$Util.getSyncedCurrentTime(),n=parseInt(this.getTimefromMsgObj(e))+$zcg._MSG_DELETE_TIMEFRAME,r=t?t.attr("msguid"):"";if(s>n)return!1;if(!$zcg._ISDELETEENABLED)return!1;if(a(r))return!1;if(i.isChannel()){var o=Channels.getByChid(e.chid),l=!1;return e.ismymsg&&(l=ChannelsPermission.hasPermission(Channels.ACTIONS.DELETE_MY_MSG,o)),l}return e.ismymsg},updateEditedMsgObj:function(e){return e.mtype=""+(e.current_mtype?e.current_mtype:e.origin_mtype?e.origin_mtype:$zcg.TEXT_MTYPE),e.isEdited=!0,e},getMsgObjfromElem:function(e,t){e=$(e);var i=e.attr("uid"),a=i.split("_")[0],s=WmsImpl.isLocalUser(a),n={chid:t?t:e.attr("chid"),time:e.attr("msgtime"),mtype:e.attr("mtype"),mod:e.attr("mode"),iscustom:"custommsg"===e.find("[msgtype]").attr("msgtype"),isnativewidget:e.find("[nativewidget]").length>0,ismymsg:s,iscomponentmsg:"true"===e.attr("componentmsg"),uid:e.attr("uid"),msguid:e.attr("msguid"),sender:a};return n},getDelMsgVisibility:function(e){if(e){var t=""+e.info_visiblity;return"true"===t||void 0===t}},getMessageDivAttrib:function(e,t){var i=parseInt(e.mtype||$zcg.TEXT_MTYPE),a=WmsImpl.isLocalUser(e.sender,e),s=!$.isEmptyObject(e.info)&&e.info.mode,n=MsgUtil.isDeletedInfoMsg(e),r=MsgUtil.getTimefromMsgObj(e),o=($WC.$CUtil.isEmpty(e.sender)?"":e.sender)+"_"+r,l=s?"infomsg width100":n?"width100 dltinfomsg msgtxt":"msgtxt in-view",c=("undefined"!=typeof e.saved?e.saved:!0,{uid:o,chid:e.chid,msgtime:r,mtype:i,"class":l});return e.msguid&&(c.msguid=e.msguid),e.ack&&t.isundelivered&&(c.msgid=e.ack),a&&(c.mymsg="true",c.class+=" me"),e.msg_timings&&(c.msg_timings=e.msg_timings),MsgUtil.isAttachmentMsg(i)&&(c.mode=e.mod),MsgUtil.isSentByPlatformComponent(e)&&(c.componentmsg="true"),t.isnew&&(c.class+=" nwmsg"),t.isundelivered&&(c.class+=" zcdelvrywait"),c}},MsgTemplate={getMsg:function(e,t){try{var i={prevmsgtime:-1,prevmsgsender:null,isundelivered:!1,isnew:!1,ignoretime:!1};t=$.extend({},i,t);var a=MsgUtil.getTimefromMsgObj(e);return this.getDateString(t.prevmsgtime,a)+this.getSenderField(e,t)+this.getMsgContent(e,t)}catch(s){_print("msgutilerr",s)}return""},getEditedMsg:function(e,t){try{var i={prevmsgtime:-1,prevmsgsender:null,isundelivered:!1,isnew:!1,ignoretime:!1};return t=$.extend({},i,t),this.getMsgContent(e,t)}catch(a){_print("msgutilerr",a)}return""},getDateString:function(e,t){var i="";return $Date.isSameDay(e,t)||(t=t?t:$Util.getSyncedCurrentTime(),i='<div purpose="date" class="zcmsg_dvdrmn" msgtime="'+t+'"><div class="zcdvdmsg">'+$Date.day(t,{shorten:!0})+"</div></div>"),i},getSenderField:function(e,t){if(!$.isEmptyObject(e.info)&&e.info.opruser&&(e.sender=e.info.opruser.zuid),$WC.$CUtil.isEmpty(e.sender)||MsgUtil.isInfoMsg(e.mtype))return"";var i=MsgUtil.isSentByPlatformComponent(e),a=MsgUtil.isCustomSender(e);if(!i&&!a&&t.prevmsgsender===e.sender&&$Date.isSameDay(t.prevmsgtime,MsgUtil.getTimefromMsgObj(e)))return"";var s='<div purpose="sender" {{custom_sender_attr}} sender="{{sender_id}}{{appended_data}}" nname="{{user_dname}}" class="sender ellips floatl {{additional_class}}"><div class="chtimg floatl"><img {{hover_profile_attributes}} src="{{sender_imgurl}}" class="{{hover_class}}"></div><span {{hover_profile_attributes}} class="{{sender_class}}">{{sender_name}}</span>{{additional_html}}</div>',n=Users.getName(e.sender,e.nname||e.dname),r=Users.getImgUrlById(e.sender),o=e.sender,l="",c='elemtype="user" hover="true" uid="{{hover_sender_id}}"',d="",u="";if(a){var m=e["custom.sender"].name;n=e["custom.sender"].name,d="_"+e.time,r=Users.getDefaultImgUrl(),MsgUtil.isCustomSenderImage(e)&&(r=e["custom.sender"].img),"undefined"!=typeof e["custom.sender"].id?(o=e["custom.sender"].id,m=Users.getName(e["custom.sender"].id,m),Contacts.isBot(e["custom.sender"].id)?r=Users.getImgUrlById(e["custom.sender"].id):Events.isEventBot(e["custom.sender"].id)&&(n=Events.getEventBotName(),m=Events.getEventBotName(),r=Events.getEventBotImageURL(),c="",o=void 0)):l='<div customsendericon class="zcf-infoC cstominfo font14 mrgL10 dIB" title="{{user_dname}}"></div>',n=$WC.$CUtil.processXSS(n),m=$WC.$CUtil.processXSS(m),u='customsender_name="'+m+'"'}!i||e.message_source.action_name||Contacts.isBotId(e.sender)||Contacts.isBotId(o)||(l=this.getMessageSourceHTML(e.message_source),d="_"+e.time);var p={additional_html:l,custom_sender_attr:u,customsender_name:m,sender_name:n,hover_profile_attributes:c};s=$WC.template.replace(s,p,"InSecureHTML"),s=$WC.template.replace(s,{user_dname:Users.getName(e.sender,e.nname)},"InSecureHTML");var h=WmsImpl.isLocalUser(e.sender,e)?"me":"";t.isnew&&(h+=" nwmsg");var g={sender_id:e.sender,sender_imgurl:r,msg_time:e.time,additional_class:h,hover_sender_id:o,hover_class:o?"cur":"",sender_class:o?"zctxtseln cur":"zcbottxt ellips",appended_data:d};return $WC.template.replace(s,g)},getMessageSourceHTML:function(e){if("undefined"==typeof e||"undefined"==typeof e.type)return"";var t='uid="{{component_id}}" hover="true" message_source_component elemtype="{{type}}"',i=e.type,a=e.name,s=e.id;i===Integration.Components.Command?(a="/"+a,t='uid="{{component_id}}" hover="true" elemtype="commandinfo"'):i===Integration.Components.Bot&&(t='botid="b-{{component_id}}" hover="true" elemtype="user" uid="b-{{component_id}}"'),"undefined"!=typeof e.store_appname&&(i!==Integration.Components.Command&&i!==Integration.Components.Bot&&i!==Integration.Components.MessageAction?(i=Integration.Components.Extension,a=e.store_appname,s=e.store_appid,t='uid={{component_id}} hover="true" elemtype="app"'):a+=" ("+e.store_appname+" "+Resource.getRealValue("app.app")+")");var n='<span id="{{component_id}}" type="{{type}}" {{hover_attributes}} title="{{component_name}}" component_name="{{component_name}}" class="zcmsgsrc ellips">{{component_type}}</span>',r={type:i,component_id:s,$component_type:"messagesource."+i,component_name:a},o={hover_attributes:t};return n=$WC.template.replace(n,o,"InSecureHTML"),$WC.template.replace(n,r)},getMessageSourceHTMLForReplyMessage:function(e){if("undefined"==typeof e||"undefined"==typeof e.type)return"";var t=e.type,i=e.name;t===Integration.Components.Command&&(i="/"+i),"undefined"!=typeof e.store_appname&&(t!==Integration.Components.Command&&t!==Integration.Components.Bot&&t!==Integration.Components.MessageAction?(t=Integration.Components.Extension,i=e.store_appname):i+=" ("+e.store_appname+" "+Resource.getRealValue("app.app")+")");var a={$component_type:"messagesource."+t,component_name:i};return $WC.template.replace('<span class="zc-msg-src-reply mL5 ellips"><span title="{{component_name}}" component_name="{{component_name}}" class="ellips bold">{{component_type}}</span></span>',a)},getMsgContent:function(e,t){var i=parseInt(e.mtype||$zcg.TEXT_MTYPE),a="",s=MsgUtil.isCustomMessage(e);t.origin=t.origin?t.origin:"cwin";var n=s||r?"zcmsgcustm":"zcmsgcnt",r=MsgUtil.isNativeWidget(e);switch(i){case $zcg.TEXT_MTYPE:a+=this.getMessageText(e);break;case 20:a+=this.getAttachment(e);break;case $zcg.EDIT_INFO:case 16:a+=this.getInfoMsg(e);break;case $zcg.DELETE_MTYPE:a+=this.getDeletedInfoMsg(e)}if($WC.$CUtil.isEmpty(a))return"";var o={msgtype:s?"custommsg":"msg","class":n},l=MsgUtil.getTimefromMsgObj(e),c="undefined"!=typeof e.saved?e.saved:!0,d=ChatUI.exist[e.chid],u="cwin"===t.origin,m=$Util.jsonToAttrib(MsgUtil.getMessageDivAttrib(e,t));o=$Util.jsonToAttrib(o);var p=c&&!t.isundelivered?this.getMsgOptionHtml(e,t,d):"",h=t.ignoretime?"":this.getTimeString(l,s),g=!c||MsgUtil.isDeletedInfoMsg(e)||MsgUtil.isInfoMsg(e.mtype)?"":MsgUtil.getStarDiv(e,t),f=Reactions.isEnabled()?'<div purpose="reactionarea">'+this.getReactionsHtml(e.reactions,l,u)+"</div>":"";return $WC.template.replace(Template.MessageDiv,{attrib:m,msgContentAttrib:o,timeContent:h,starContent:g,msgContent:a,reactionsContent:f,msgOptionsContent:p},"InSecureHTML")},getReactionsHtml:function(e,t,i,a){if(!e)return"";var s="",n=[],r=[],o="",l=i?$WC.template.replace(Template.AddReaction,{iconId:"add_reactions_list"+t,containerId:"cont_add_reactions_list"+t,documentClick:"reactions",purpose:"openSmileyBox","class":"add-emoji-cnt"}):"";for(var c in e){var d=e[c],u=d.users.length,m=d.isIamReacted?"zcreactn-optns-me":"zcreactn-optns-others",p=$WC.$CUtil.processXSS(Reactions.getToolTipContent(c,d.users));o=$WC.template.replace(Template.ReactedContentList,{cssClass:m,code:$WC.$CUtil.processXSS(c),eventID:i?"reactions":"",codeHtml:Smiley.replace(c,!0,!0,!0),count:u,title:p},"InSecureHTML"),a&&void 0!=a[c]?r[a[c]]=o:n.push({html:o,me:d.isIamReacted,count:u})}return n.sort(Reactions.sort("BYMINE")),s=r.join(""),s+=n.map(function(e){return e.html}).join(""),$WC.template.replace(Template.ReactedContent,{addReaction:l,list:s},"InSecureHTML")},getMsgOptionHtml:function(e,t,i){if(!i||"cwin"!==t.origin||t.isundelivered||MsgUtil.isDeletedInfoMsg(e)||MsgUtil.isInfoMsg(e))return"";var a=MsgUtil.getTimefromMsgObj(e),s=$("#"+e.chid).find("#chatbody").attr("msgselectionmode")?"msgsel":"",n=SecurityManager.hasPermission(Modules.MessageOptions)?MessageOperations.getMsgOperationsDiv(e,!0):"",r="";Reactions.isEnabled()&&(r=$WC.template.replace(Template.AddReaction,{iconId:"add_reactions"+a,containerId:"cont_add_reactions"+a,documentClick:"messageoperations",purpose:"addReactions","class":""}));var o=0!=(i.getMessageOptions()&MessageOperations.REPLY)?$WC.template.replace(Template.NewOptionReply,{chid:e.chid}):"",l=$WC.template.replace(Template.ForwardCheckBox,{msgtime:a,cssClass:s});return l+$WC.template.replace(Template.NewMessageOptions,{addReaction:r,msgOptions:n,reply:o},"InSecureHTML")},getTimeString:function(e,t){return'<span id="chattime" class="chattime'+(t?" cstomtime":"")+'" title="'+$Date.date(e,{withday:!0})+'">'+$Date.time(e)+"</span>"},getDeletedMsgText:function(){return Resource.getRealValue("info.message.single.deleted",[Resource.getRealValue("info.deleted")])},getMessageText:function(e){var t=MsgUtil.getMsgObjVersion(e);"v0"==t&&(e=$WC.CMsgUtil.convertMsgObj(e));var i;if(MsgUtil.isCustomMessage(e)||"undefined"!=typeof e["long.msg"]&&e["long.msg"].length>0){var a=$WC.CustomMsg.getTheme(e);a||("undefined"==typeof e["brief.msg"]&&(e["brief.msg"]={}),e["brief.msg"].themeid="0"),i=$WC.CustomMsgUI.getCustomMessageContent(e)}else{$WC.CustomMsg.storeMsgObj(e);var s="undefined"!=typeof e.info&&"undefined"!=typeof e.info.linkdetails;i=this.getDisplayContent(e,void 0,s)}if(MsgUtil.isNativeWidget(e)){var n=NativeWidgetHandler.processMsg(e);$WC.$CUtil.isEmpty(n)||(i=n)}return"undefined"!=typeof e.botSuggestions&&(i+=$WC.CustomMsgTemplate.getBotSuggestionsContent(e.botSuggestions)),MsgUtil.isSentByBotAction(e)&&(i='<span class="msi-wand clr0 mrgR5"></span>'+i),i},isGiphyLink:function(e){return e.info&&e.info.linkdetails&&e.info.linkdetails.giphyLink},getUrlInfo:function(e,t,i){try{var a=e.info.linkdetails,s=a.mimetype,n=a.linktype,r="",o="",l="",c="",d="";isvideodesc=a.description?"":"dN";var u=["bumper-sale.com","fmovies.is"];if("undefined"!=typeof a)for(var m=0;m<u.length;m++)if(-1!=a.url.indexOf(u[m]))return"";if("undefined"==typeof s)return'<div style="display:none">'+$WC.$CUtil.processXSS(a.title)+"</div>";if("text/html"===s)if(c=a.faviconlink?'<img src="'+$WC.$CUtil.processXSS(a.faviconlink)+'" onerror="$(this).remove();"/>':"","undefined"!=typeof n){if("video"===n)r=i?Template.LinkCompVideoOrImageHTML:Template.LinkVideoOrImageHTML,d='<div class="zcf-play play-icon alignM"></div>',l=a.thumbnailurl?'<img width="100%" height="170" src="'+$WC.$CUtil.processXSS(a.thumbnailurl)+'" onerror="MsgUtil.removeImagefromChatwindow(this);"/>':"",a.html=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","width"),null,a.html,function(e,t,i,a,s,n){return t+"100%"+n}),a.html=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","height"),null,a.html,function(e,t,i,a,s,n){return t+"209px"+n}),a.html=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","src"),null,a.html,function(e,t,i,a,s,n){var r=s+(-1===s.indexOf("?")?"?":"&")+"autoplay=true";return t+r+n}),o='documentclick="playlink" iframe="'+$WC.$CUtil.processXSS(a.html)+'"';else if("audio"===n)r=Template.LinkAudioHTML,a.html=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","width"),null,a.html,function(e,t,i,a,s,n){return t+"100%"+n}),a.html=$WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("iframe","height"),null,a.html,function(e,t,i,a,s,n){return t+"209px"+n}),l=a.html;else if("image"===n)r=i?Template.LinkCompVideoOrImageHTML:Template.LinkVideoOrImageHTML,l='<img documentclick="viewattachment" previewelem width="100%" height="170" src="'+$WC.$CUtil.processXSS(a.imgurl)+'" onerror="MsgUtil.removeImagefromChatwindow(this);"/>';else if("link"===n)if(r=i?Template.LinkCompPreviewHTML:Template.LinkPreviewHTML,$WC.$CUtil.isEmpty(a.thumbnailurl_width)||$WC.$CUtil.isEmpty(a.thumbnailurl_height)||!t)l=a.thumbnailurl?'<div class="zcsiteimg zcuflimg"><img src="'+$WC.$CUtil.processXSS(a.thumbnailurl)+'" onerror="MsgUtil.removeImagefromChatwindow(this);" onload="MsgUtil.retainScrollonImageLoad(this);" documentclick="viewattachment" previewelem/></div>':"";else{var p=$Util.getAspectRatioFit(a.thumbnailurl_width,a.thumbnailurl_height,400,200),h=p.height,g=p.width;l=a.thumbnailurl?'<div class="zcsiteimg"><img src="'+$WC.$CUtil.processXSS(a.thumbnailurl)+'" onerror="MsgUtil.removeImagefromChatwindow(this);" documentclick="viewattachment" previewelem/></div>':""}r=r.replace(/{ADDITIONALATTRDATA}/g,o).replace(/{VIDEOPLAYBUTTON}/g,d).replace(/{LINKTHUMBNAIL}/g,l).replace(/{FAVICON}/g,c).replace(/{LINKURL}/g,a.url).replace(/{REDIRECTLINKURL}/g,a.url).replace(/{AUTHORURL}/g,a.authorurl?a.authorurl:"").replace(/{REDIRECTAUTHORURL}/g,a.authorurl?a.authorurl:"").replace(/{LINKWEBSITEURL}/g,a.providerurl).replace(/{REDIRECTLINKWEBSITEURL}/g,a.providerurl).replace(/{LINKWEBSITENAME}/g,a.providername?$WC.$CUtil.processXSS(a.providername):"").replace(/{LINKDESCRIPTION}/g,a.description?MsgTemplate.formatUrlDescription($.trim(a.description)):"").replace(/{LINKTITLE}/g,a.title?$WC.$CUtil.processXSS(a.title):"").replace(/{THUMBNAILURL}/g,a.thumbnailurl?a.thumbnailurl:"").replace(/{AUTHORNAME}/g,a.authorname?$WC.$CUtil.processXSS(a.authorname):"").replace(/{DN}/g,isvideodesc)}else{var f=$WC.Matcher.replace("domainurl",a.url,"$2"),v=$WC.Matcher.replace("domainurl",a.url,"$1");if($WC.$CUtil.isEmpty(a.thumbnailurl_width)||$WC.$CUtil.isEmpty(a.thumbnailurl_height)||!t)l=a.thumbnailurl?'<div class="zcsiteimg zcuflimg"><img documentclick="viewattachment" previewelem src="'+$WC.$CUtil.processXSS(a.thumbnailurl)+'" onload="MsgUtil.retainScrollonImageLoad(this);" onerror="MsgUtil.removeImagefromChatwindow(this);"/></div>':"";else{var p=$Util.getAspectRatioFit(a.thumbnailurl_width,a.thumbnailurl_height,400,200),h=p.height,g=p.width;l=a.thumbnailurl?'<div class="zcsiteimg"><img documentclick="viewattachment" previewelem src="'+$WC.$CUtil.processXSS(a.thumbnailurl)+'" onerror="MsgUtil.removeImagefromChatwindow(this);"/></div>':""}r=i?Template.LinkCompPreviewHTML:Template.LinkPreviewHTML,r=r.replace(/{LINKTHUMBNAIL}/g,l).replace(/{LINKURL}/g,a.url).replace(/{FAVICON}/g,c).replace(/{REDIRECTLINKURL}/g,a.url).replace(/{LINKWEBSITEURL}/g,v).replace(/{REDIRECTLINKWEBSITEURL}/g,v).replace(/{LINKTITLE}/g,a.title?$WC.$CUtil.processXSS(a.title):"").replace(/{LINKDESCRIPTION}/g,a.description?$WC.$CUtil.processXSS($.trim(a.description)):"").replace(/{LINKWEBSITENAME}/g,f)}else{var C="";if($WC.Matcher.check("videomimetype",s)&&MediaPlayer.isSupportedVideoFormat(s)&&MsgUtil.isSecureUrl(a.url)){var y='<div class="fshrink flexC font15"><div action="fullscreen" class="cur zcf-fullscrn"></div></div>';C=Template.MediaControl.replace(/{VIDEOCONTRLRHS}/g,y).replace(/{MUTEDN}/,""),r=Template.VideoPlayer.replace(/{FILEURL}/g,a.url).replace(/{FILEID}/g,e.chid+"_"+e.time+"_"+e.sender).replace(/{TYPE}/g,"link").replace(/{MEDIACONTROLS}/g,C).replace(/{VIDEODN}/g,"dN")}else if($WC.Matcher.check("audiomimetype",s)&&MediaPlayer.isSupportedAudioFormat(s)&&MsgUtil.isSecureUrl(a.url))C=Template.MediaControl.replace(/{VIDEOCONTRLRHS}/g,"").replace(/{MUTEDN}/,"dN"),r=Template.AudioPlayer.replace(/{FILEURL}/g,a.url).replace(/{FILEID}/g,e.chid+"_"+e.time+"_"+e.sender).replace(/{TYPE}/g,"link").replace(/{MEDIACONTROLS}/g,C);else if($WC.Matcher.check("imagemimetype",s))if(a.giphyLink){var p=$Util.getAspectRatioFit(a.width,a.height,400,300),h=p.height,g=p.width;r='<div><div class="zclnkimg p10"><img src='+$WC.$CUtil.processXSS(a.url)+'  style = "width : '+g+"px; height : "+h+'px; max-width:100%;" documentclick="viewattachment" previewelem onerror="MsgUtil.removeImagefromChatwindow($(this).parent());"/></div></div>'}else if($WC.$CUtil.isEmpty(a.width)||$WC.$CUtil.isEmpty(a.height)||!t)r=t?'<div><div class="zclnkimg p10"><div><img src='+$WC.$CUtil.processXSS(a.url)+' style = "width : 350px; height : 250px; max-width:100%;" documentclick="viewattachment" previewelem onerror="MsgUtil.removeImagefromChatwindow($(this).parent());"/></div><div class="zcimlnk bold" style="width:'+g+'px;"><a href="'+a.url+'" dataurl="'+a.url+'" target="_blank">'+a.url+"</a></div></div></div>":'<div><div class="flexC"><div class="zcsiteimg"><img src='+$WC.$CUtil.processXSS(a.url)+'  documentclick="viewattachment" previewelem onerror="MsgUtil.removeImagefromChatwindow($(this).parent());"/></div><div class="zcimlnk flexG bold" style="width:'+g+'px;"><a href="'+a.url+'" dataurl="'+a.url+'" target="_blank">'+a.url+"</a></div></div></div>";else{var p=$Util.getAspectRatioFit(a.width,a.height,400,300),h=p.height,g=p.width;r='<div><div class="zclnkimg p10"><img src='+$WC.$CUtil.processXSS(a.url)+'  style = "width : '+g+"px; height : "+h+'px; max-width:100%;" documentclick="viewattachment" previewelem onerror="MsgUtil.removeImagefromChatwindow($(this).parent());"/></div></div>'}}return r}catch(b){return""}},formatUrlDescription:function(e){return e=$WC.$CUtil.processXSS(e),e&&e.length>200&&(e=e.trim().substring(0,200)+"\u2026"),e},getMarkedDownContent:function(e,t){if(e=$.trim(e),e=Smiley.replace(e),e=this.trim(e),e=MsgUtil.getDisplayableSilentUserMentionMsg(e),!t){for(var i=e.split(" "),a=[],s=0;s<i.length;s++){var n=i[s];n=this.convertLinks(n),n===i[s]&&(n=this.convertMailIds(n)),n=this.getSafeATagTarget(n),n=this.addAttributesToViewableImg(n),a.push(n)}e=a.join(" ")}return e},getDisplayContent:function(e,t,i){var a,s=$.trim(e.msg);if(MessageContextParser.isEnabled()&&"undefined"==typeof MessageBuilder){var n=e.time;s=DateTimeParser.markTimeInstances(s,n)}if(e.isEdited){var r=e.time,o=e.msguid;if(r&&o){var l=$Date.date(r,{withtime:!0,withday:!0,shorten:!0}),c='<span id="editinfo" purpose="msghistory" msguid="'+o+'" class="cur zcedtinfo hvrinfo" title="'+l+'">'+Resource.getRealValue("message.edited.info")+"</span>";s+=c}else $WC.$CUtil.isEmpty(s)||(s+='<span class="cur zcedtinfo">'+Resource.getRealValue("message.edited.info")+"</span>")}if(i){a=this.getUrlInfo(e,!0);var d=e.info.linkdetails;$WC.$CUtil.isEmpty(a)||($WC.Matcher.check("markdown_blockquote_html",s)?(s=$WC.Matcher.replace("markdown_blockquote_html",s,"$1"),s="<blockquote>"+s+" {urlinfo}</blockquote>"):$WC.Matcher.check("markdown_codeblock_html",s)?(s=$WC.Matcher.replace("markdown_codeblock_html",s,"$1"),s="<pre>"+s+" {urlinfo}</pre>"):$.trim(e.msg).length>d.url.length?s+=" {urlinfo}":s="{urlinfo}")}if(MsgUtil.isMentionMsg(s)){{Mentions.getMentionMsgId(e)}s=this.getDisplayableMention(e,s,'<span elemtype="{MENTIONELEMTYPE}" hover="true" uid="$1" class="hvrinfo {CLASSMINE}" mentionedid="$1" {MENTIONATTRIBUTES}>$2</span>')}return s=this.getMarkedDownContent(s,t),e.isreply&&(s="undefined"!=typeof e.repliedmsgcontent?e.repliedmsgcontent+s:this.getRepliedMsgHtml(e,s)),s=s.replace(/{urlinfo}/,a)},getRepliedMsgHtml:function(e,t){var i=e.replied.info,a=i.sender,s=i.sendername,n=i.msgtime,r=i.msg,o=i.mtype,l="",c="";if(Contacts.isBotId(a)||Contacts.isBotId(i.custom_sender_id)||(c=this.getMessageSourceHTMLForReplyMessage(i.message_source)),o===$zcg.TEXT_MTYPE){var d="";d=i.custom?'<div class="quotedmsgsender"><span  class="cur floatl ellips bold w100">'+s+"&nbsp;&nbsp;"+c+'<span class="reply-dt ellips">'+$Date.daytime(n)+"</span></span></div>":'<div class="quotedmsgsender"><span elemtype="user" hover="true"  uid="'+a+'" class="cur floatl ellips bold w100">'+Users.getName(a,s)+"&nbsp;&nbsp;"+c+'<span class="reply-dt ellips">'+$Date.daytime(n)+"</span></span></div>";var u=this.getMarkedDownContent(r);if(MsgUtil.isMentionMsg(u)&&!i.custom){{Mentions.getMentionMsgId(e)}u=this.getDisplayableMention(e,u,'<span elemtype="{MENTIONELEMTYPE}" hover="true" uid="$1" class="hvrinfo {CLASSMINE}" mentionedid="$1" {MENTIONATTRIBUTES}>$2</span>')}u=Smiley.convertAnimatedTo24(u),l='<blockquote class="quotedmsgdiv" purpose="viewreplied" msgtime="'+n+'" ><span class="msi-reply zcclr floatl"></span><div class="quotedmsgellips">'+d+u+"</div></blockquote>"}else{var d="";d=i.custom?'<div class="ellips mrgT6 flexC"><span class="ellips fontb">'+s+'</span><span class="reply-dt ellips">'+$Date.daytime(n)+"</span></div>":'<div elemtype="user" hover="true" uid="'+a+'" class="ellips mrgT6 flexC"><span class="ellips fontb">'+Users.getName(a,s)+'</span><span class="reply-dt ellips">'+$Date.daytime(n)+"</span></div>";var m="";if("att"===i.mod){var p=$Util.xssAndEscapeReplacementString(i.addinfo.fName),h=""+i.addinfo.fileurl,g=""+i.addinfo.contenttype,f=""+i.addinfo.comment,v=""+i.addinfo.isv1,C=""+i.addinfo.thumb;if(g&&-1!==g.indexOf("image")){var y=MsgTemplate.getCachedImageLink(g,h,p,"true"===v,"true"===C,!0);m="<div class='zcimgld posl'> <img errorpurpose='replymsgimg' extn='"+p.split(".").pop()+"' src='"+y+"'/></div>"}else m='<div class="zcimgld posl"> <span class="zcftype posa font10 bold ellips">'+p.split(".").pop()+'</span><span class="zcf-file dIB"></span></div>';$WC.$CUtil.isEmpty(f)?m+="<div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' ><span class='msi-attfile font10'></span>&nbsp"+$WC.$CUtil.processXSS(p)+"</div><div>":(f=MsgTemplate.getCommentForFileAttachment(f),m+="<div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' ><span class='msi-qut'></span>&nbsp"+f+"</div><div>")}else if("contact"===i.mod)m="<div class='zcimgld posl'><span class='msi-atchcontact dIB floatl'></span></div><div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' ><span class='msi-attcontact font14'></span>&nbsp"+$WC.$CUtil.processXSS(i.addinfo.name)+"</div><div>";else if("location"===i.mod)m='<div class="zcimgld posl"><a href="http://maps.google.com/?q='+i.addinfo.lat+","+i.addinfo.lng+'" target="_blank" class="msi-location zclomglftsb"></a></div><div class="zcattmsgdet floatl mrgL10">'+d+'<div class="zcattmsgcmnt" ><span class="msi-location font14"></span>&nbsp'+$WC.$CUtil.processXSS(i.addinfo.name)+"</div><div>";else if("event"===i.mod){var b=i.addinfo.startdate,g='<div class="zcevedte"><div class="zcemonth">{{year}}</div><div class="zcetime">{{month}}<div class="font10 clr6">{{date}}</div></div></div>';g=$WC.template.replace(g,{year:new Date(b).getFullYear(),month:$Date.getMonthString(b,!0),date:$Date.getDateString(b,!0)}),m="<div class='zcimgld posl'>"+g+"</div><div class='zcattmsgdet floatl mrgL10'>"+d+"<div class='zcattmsgcmnt' >&nbsp"+$WC.$CUtil.processXSS(i.addinfo.name)+"</div><div>"}l='<blockquote class="quotedmsgdiv" purpose="viewreplied" msgtime="'+n+'"><span class="msi-reply zcclr floatl"></span><div class="zcattmsgrly">'+m+"</div></blockquote>"}return t=l+t},trim:function(e){return e=e.replace(/<p>/gi,"").replace(/<\/p>/gi,"").replace(/\n/gi,"<br>")},convertMailIds:function(e){return e=" "+e,e=$WC.Matcher.replaceWithFlag("mail",e,"gi"),e=$.trim(e)},convertLinks:function(e){var t=!1;return e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,-1),t=!0),e=$WC.Matcher.replaceWithFlag("linkRegExp",e,"gi",function(t,i){return t!==e&&$WC.Matcher.checkWithFlag("invalidlink",$WC.$CUtil.decodeHTMLEntities(e),"i")?t:"<a href='"+i+"' target='_blank'>"+$WC.CMsgUtil.convertHomographToText(i)+"</a>"}),e=$WC.Matcher.replaceWithFlag("zcWWWlinkRegExp",e,"gi",function(t,i){return t!==e&&$WC.Matcher.checkWithFlag("invalidlink",$WC.$CUtil.decodeHTMLEntities(e),"i")?t:"<a href='http://"+i+"' target='_blank'>"+$WC.CMsgUtil.convertHomographToText(i)+"</a>"}),e=$WC.Matcher.replaceWithFlag("twoletterendinglink",e,"gi","$1<a href='http://$2' target='_blank'>$2</a>"),e=$WC.Matcher.replaceWithFlag("threeletterendinglink",e,"gi","$1<a href='http://$2' target='_blank'>$2</a>"),e=$.trim(e),e=t?"("+e+")":e},getSafeATagTarget:function(e){return $WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("a","href"),null,e,function(e,t,i,a,s,n,r,o){return 0===s.indexOf("mailto:")?e:t+s+r+' dataurl="'+$WC.$CUtil.processXSS(s)+'" '+o})},addAttributesToViewableImg:function(e){return $WC.Matcher.replacer($WC.Matcher.getRegexToAddAttrToHtmlTag("img"),null,e,'$1 documentclick="viewattachment" previewelem $3')},getRedirectLink:function(e){return window.hasOwnProperty("opener")?e:"linkredirect.sas?link="+encodeURIComponent(e)},getFileDownloadLink:function(e,t,i,a){if(a){if(ChatUI.isUDSDownloadEnabled()){var s=$zcg._DOWNLOADSERVERURL+"/webdownload?x-service="+$zcg.UDS_CLIQ_SERVICE+"&event-id="+t;return s}return"/v1/attachments/"+t}return"/download.sas?mime="+encodeURIComponent(e)+"&url="+encodeURIComponent(t)+"&fName="+encodeURIComponent(i)},getCachedImageLink:function(e,t,i,a,s,n){var r=this.getFileDownloadLink(e,t,i,a);if(!ChatUI.isCachedImage(r)){var o=s&&a?ChatUI.isUDSDownloadEnabled()?"&x-cli-msg="+encodeURIComponent("{thumbnail:true}"):"/thumbnail":"",l=r+o;if(!ChatUI.isCachedImage(l)&&ChatUI.isUDSDownloadEnabled()){var c="/v1/attachments/"+t+o;a||(c="/download.sas?mime="+encodeURIComponent(e)+"&url="+encodeURIComponent(t)+"&fName="+encodeURIComponent(i)),l=ChatUI.isCachedImage(c)?c:l}r=n||ChatUI.isCachedImage(l)?l:r}return r},getViewModeLink:function(e){return ChatUI.isUDSDownloadEnabled()&&0==e.indexOf($zcg._DOWNLOADSERVERURL)?"&x-cli-msg="+encodeURIComponent("{mode:view}"):0==e.indexOf("/v1/attachments/")?"/view":"&mode=view"},getDisplayableMention:function(e,t,i){function a(e){var t=e.hasOwnProperty("meta")?e.meta.hasOwnProperty("mentions")?e.meta.mentions:e.meta:{};return e.hasOwnProperty("mentions")&&$.extend(t,e.mentions),e.hasOwnProperty("replied")&&e.replied.hasOwnProperty("info")&&e.replied.info.hasOwnProperty("meta")&&$.extend(t,e.replied.info.meta.mentions),"undefined"!=typeof t?t:{}}var s="undefined"!=typeof e.ctype?parseInt(e.ctype):1,n="";if("undefined"!=typeof e.mentionmsgid){n=' mentionmsgid="'+e.mentionmsgid+'"';var r=(' mention_status="'+Mentions.READ+'"',Mentions.getObject(e.mentionmsgid));$.isEmptyObject(r)||parseInt(r.status)!==Mentions.UNSEEN||(n+=' unreadmention="true" mention_status="'+Mentions.UNSEEN+'"'),"true"===e.unreadmention&&(n+=' unreadmention="true" mention_status="'+Mentions.UNREAD+'"')}if(n+=' mention_on="'+s+'"',MsgUtil.isNewMentionMsg(t)){var o=a(e);if("undefined"==typeof o||$WC.$CUtil.isEmptyObject(o))return t;for(var l in o){var c=o[l],d=new $NewMention("",c.name,c.type,c.id),u={};u.mentionmsg=d.mentionmsg,u.operation="mention",u.mentionedid=c.id,u.type=c.type,u.dname=c.name,t=t.replace(d.mentionmsg,MsgTemplate.getDisplayableMentionHTML(e,u,n,i))}return t}return $WC.Matcher.replaceWithFlag("atmentiontemplate",t,"g",function(t,a,s,r){var o=r.split(":"),l={};return l.operation=o[0].slice(1),l.mentionedid=o[1],l.type=parseInt(o[2]),o=o.slice(3),o.pop(),l.mentionmsg=t,l.dname=$WC.$CUtil.decodeHTMLEntities(o.join(":")),MsgTemplate.getDisplayableMentionHTML(e,l,n,i)})},getDisplayableMentionHTML:function(e,t,i,a){var s=t.type,n=t.mentionedid,r=t.operation,o=t.dname,l="",c=!1;if(null==o)return t.mentionmsg;if(s===Mentions.UserMention){c=WmsImpl.isLocalUser(n);var d=c?$WC.$CUtil.processXSS(WmsImpl.getNickName()):Users.getName(n,o);o=""===d?$WC.$CUtil.processXSS(o):d;var u="addchatmember"==r?"+":"deletechatmember"==r?"-":"@";o=u+o,l="user"}else if(s===Mentions.GroupMention)-1!=n.search("G")&&(n=n.substring(1)),c=Groups.isOrgGroupExist(n),o="@"+o,l="group";else if(s===Mentions.ChannelMention){var m=Channels.getObject(n);c=Channels.isJoined(m),o=Channels.getMentionName(n,e.chid,o),l="channel"}else s===Mentions.BotMention?(o="@"+Users.getName(n,o),l="user"):Mentions.isSpecialMention(s)&&(l=s===Mentions.ParticipantsMention?o+"mention":o,o="@"+o);var p=i+' mentiontype="'+s+'"',h=a.replace(/{CLASSMINE}/g,c?"atme":"").replace(/{MENTIONATTRIBUTES}/g,p).replace(/{MENTIONELEMTYPE}/g,l).replace(/\$1/g,n).replace(/\$2/g,$WC.Matcher.replace("escapeReplacementString",o));return h},getDisplayableAddition:function(e){return $WC.Matcher.replace("addchatmember",e,function(e,t){var i=t.split(":"),a=i[0],s=WmsImpl.isLocalUser(a),n=$WC.$CUtil.decodeHTMLEntities(i.join(":"));n=s?$WC.$CUtil.processXSS(WmsImpl.getNickName()):Users.getName(a,n),n="+"+n;var r='<span elemtype="user" hover="true" uid="'+a+'" class="zctxtseln atmtnlink '+(s?"atme":"")+'" mentiontype="1" mentionedid="'+a+'">'+n+"</span>";return r})},getDisplayableDeletion:function(e){return $WC.Matcher.replace("deletechatmember",e,function(e,t){var i=t.split(":"),a=i[0],s=WmsImpl.isLocalUser(a),n=$WC.$CUtil.decodeHTMLEntities(i.join(":"));n=s?$WC.$CUtil.processXSS(WmsImpl.getNickName()):Users.getName(a,n),n="-"+n;var r='<span elemtype="user" hover="true" uid="'+a+'" class="zctxtseln atmtnlink '+(s?"atme":"")+'" mentiontype="1" mentionedid="'+a+'">'+n+"</span>";return r})},getAttachment:function(e){var t="";switch(e.mod){case"att":t=this.getFileAttachment(e);break;case"contact":t=this.getContactAttachment(e);break;case"location":t=this.getLocationAttachment(e);break;case"event":t=this.getEventAttachment(e)}return t},getFileAttachment:function(e){var t=e.chid,i=e.info,a=i.url,s="true"===i.isv1,n=$Util.xssAndEscapeReplacementString(i.fName),r=i.size,o=i.content,l="true"===i.thumb,c=e.sender,d=Users.getName(e.sender,e.dname),u=MsgTemplate.getFileDownloadLink(o,a,n,s),m=MsgTemplate.getFileDownloadLink(MsgUtil.getPreviewEmbedType(o),a,n,s),p=n.split(".").pop(),h="";if(o&&-1!==o.indexOf("image")&&"undefined"!=typeof i.dim&&"undefined"!=typeof i.dim.width){var g=i.dim;i.dim.height=g.height?g.height:400,i.dim.width=g.width?g.width:400}if("undefined"!=typeof o){var f="",v=MsgTemplate.getCachedImageLink(o,a,n,s,l,!0),C=ChatUI.isCachedImage(v),y=i["img-data"]?"data:image/jpeg;base64,"+i["img-data"]:"",b=i["img-data"]?"":"invisible",g=i.dim,E=C?g.width||g.tnwidth:g.tnwidth||g.width,I=C?g.height||g.tnheight:g.tnheight||g.height,T=g?$Util.getAspectRatioFit(E,I,400,200):g,$=i["img-data"]?"":'<div class="ZC_sld" att_loading ><div class="ZC_sldt ZC_sldt1"></div><div class="ZC_sldt ZC_sldt2"></div><div class="ZC_sldt ZC_sldt3"></div><div class="ZC_sldt ZC_sldt4"></div></div>',S=' filetype="'+p+'" contenttype="'+o+'" previewfilesrc="'+m+'" filesrc="'+u+'" hasthumbnail="'+l+'"',R="",A="";ChatUI.isCachedImage(v)?(f=i.dim?'<div class="posrel mrgat" '+(g?'style="width:'+T.width+"px; height:"+T.height+'px; max-width:100%; "':"")+">":"",f+='<img previewelem src="'+v+'"'+S+">",f+=i.dim?"</div>":""):(i["img-data"]&&"null"!=i["img-data"]||g.width)&&(-1!==o.indexOf("image")||l)?(f=i.dim?'<div class="posrel mrgat" style="width:'+T.width+"px; height:"+T.height+'px; max-width:100%; ">':"",f+='<img class="'+b+'"previewelem originalsrc="'+v+'"'+S+' src="'+y+'">'+$,f+=i.dim?"</div>":""):f='<div class="dN" previewelem src="'+v+'"'+S+"></div>",o&&-1!==o.indexOf("image")&&""===b&&(f+='<div class="zcimg-btns"><span documentclick="attdownload" title="'+Resource.getRealValue("common.download")+'" class="zcimg-actn-btn zcf-download"></span><span documentclick="attforward" title="'+Resource.getRealValue("common.forward")+'" class="zcimg-actn-btn zcf-forward"></span></div>',R="dN",A="zcmediaview"),h=Template.AttViewInCwin;var M="",U="",w="",_="";if(MsgUtil.isSupportedVideoType(o,p)){var O=i["img-data"]?' poster="data:image/jpeg;base64,'+i["img-data"]+'" originalsrc="'+v+'"':"",D='<div id="playarea" class="zcvdocon" previewelem '+S+'><div id="screenplay" action="play" purpose="toggleclass" operation="play" class="play-icon zcf-play alignM"></div><video id="video" action="play" {VIDEOTHUMBPOSTER} style="width:100%; height:inherit;"></video></div>',N='<div id="videorightbtns" class="fshrink flexC font15"><span documentclick="attdownload" title="'+Resource.getRealValue("common.download")+'" class="zcf-download cur mR15 font16"></span><div documentclick="attforward" title="'+Resource.getRealValue("common.forward")+'" class="zcf-forward cur mR15"></div><div action="fullscreen" class="zcf-fullscrn cur"></div></div>';O=ChatUI.isCachedImage(v)?' poster="'+v+'"':O,w=Template.MediaControl.replace(/{VIDEOCONTRLRHS}/,N).replace(/{MUTEDN}/,""),R="dN",A="zcmediaview",f=Template.AVPlayer.replace(/{FILEURL}/,u).replace(/{MEDIACONTROLS}/,w).replace(/{FILEID}/g,e.chid+"_"+e.time+"_"+e.sender).replace(/{CONTENTDIV}/g,D).replace(/{VIDEOTHUMBPOSTER}/g,O).replace(/{TYPE}/g,"uploaded").replace(/{VIDEODN}/g,"dN").replace(/{PLAYERID}/g,"videoplayer")}else(l||g.width&&-1!==o.indexOf("image"))&&(f='<div class="{PREVIEWCLASS} cur posl mrgat zcfilevw ">'+f+"</div>");if(i.comment&&(M=this.getCommentForFileAttachment(i.comment),M=M.replace(/zcslymsg-anim-72/g,"zcslymsg-anim-24"),U='<div id="comment" class="zchtcmdmgmn"><div class="msi-qut"></div><div class="zchtcmdtxt">'+M+"</div></div>",M='comment="'+$WC.$CUtil.processXSS(i.comment)+'"'),MsgUtil.isSupportedAudioType(o,p)){var L=Template.MediaControl.replace(/{VIDEOCONTRLRHS}/g,"").replace(/{MUTEDN}/,"dN");_=Template.Mp3Player.replace(/{FILENAME}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{MEDIACONTROLS}/,L).replace(/{FILEID}/g,e.chid+"_"+e.time+"_"+e.sender).replace(/{FILEURL}/,u),h=h.replace(/{INFODN}/,"zcmusicvw")}else{var W='<span class="fileprv">'+Resource.getRealValue("chat.file.preview")+"</span>";_=Template.MediaInfoHtml.replace(/{FILENAME}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{FILESIZE}/g,r).replace(/{FILETYPE}/g,p).replace(/{PREVIEWLINK}/g,MsgUtil.isSupportedEmbedType(o,p)?W:"")}h=h.replace(/{FILENAME}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{FILEID}/g,e.chid+"_"+e.time+"_"+e.sender).replace(/{FILESIZE}/g,r).replace(/{FILEURL}/,u).replace(/{FILECOMMENT}/g,$WC.Matcher.replace("escapeReplacementString",U)).replace(/{FCOMMENT}/g,$WC.Matcher.replace("escapeReplacementString",M)).replace(/{MEDIAINFO}/g,_).replace(/{FILEPREVIEW}/g,f).replace(/{PREVIEWCLASS}/g,g.height<=100?"zcfilevwsml":"").replace(/{CHID}/g,t).replace(/{FSENDER}/g,c).replace(/{SENDERNAME}/g,d).replace(/{STIME}/g,e.time).replace(/{FURL}/g,a).replace(/{CONTENTTYPE}/g,o).replace(/{HASTHUMB}/g,l).replace(/{ISV1}/g,s).replace(/{INFODN}/,R).replace(/{ZCIMGVW}/,A)}return e.isreply&&(h=this.getRepliedMsgHtml(e,h),h=Smiley.convertAnimatedTo24(h)),h},getCommentForFileAttachment:function(e){return e=$WC.$CUtil.processXSS(e),e=Markdown.apply(e),e=MsgTemplate.getMarkedDownContent(e)},getContactAttachment:function(e){for(var t,i,a=e.info,s='<div class="zcntinfmsgmn"><div class="zcntmsgsb" name="{{msgname}}"><span class="msi-atchcontact dIB floatl"></span><div class="zctitmg bold">{{msgname}}</div>{{contactno}}{{contactemail}}{{contactbirthday}}</div></div>',n="",r="",o="",l=a.extras,c=0,d=l.length;d>c;c++)t=l[c],i=t.type,"Phone"===i?n+=$WC.template.replace('<div class="zcmobmg">{{detail}}</div>',{detail:t.value}):"Email"===i?r+=$WC.template.replace('<div class="zcmobmg"><a href="mailto:{{detail}}">{{detail}}</a></div>',{detail:t.value}):"Birthday"===i&&(o+=$WC.template.replace('<div class="zcbobmg"><span class="msi-dob"></span>{{detail}}</div>',{detail:t.value}));return s=$WC.template.replace(s,{msgname:a.name}),$WC.template.replace(s,{contactno:n,contactemail:r,contactbirthday:o},"InSecureHTML")},getLocationAttachment:function(e){var t=e.info,i='<div class="zclomsgcmn"><div class="zclocmsgsb" lat="{{lat}}" lng="{{long}}" name="{{name}}"><a href="http://maps.google.com/?q={{lat}},{{long}}" target="_blank" class="msi-location zclomglftsb"></a><div class="zclomgtit">{{name}}</div><div class="clr0">{{loc}}</div><a href="http://maps.google.com/?q={{lat}},{{long}}" target="_blank"><div class="clr6"><span class="msi-direction mrgR5"></span>{{getdirections}}</div></a></div></div>';return $WC.template.replace(i,{lat:t.lat,"long":t.lng,loc:t.loc,name:t.name,$getdirections:"chat.location.direction"})},getEventAttachment:function(e){var t=e.info,i=$Date.daytime(t.startdate,{withtime:!1,raw:!0})+" "+Resource.getRealValue("common.to.small")+" "+$Date.daytime(t.enddate,{withtime:!1,raw:!0}),a='<div class="zcevntmsgmn"><div class="zcevmsgsb" startdate="{{startdate}}" enddate="{{enddate}}" name="{{name}}" ><div class="zcevedte"><div class="zcemonth">{{year}}</div><div class="zcetime">{{month}}<div class="clr6">{{date}}</div></div></div>'+(t.name?'<div class="zctitmg bold">{{name}}</div>':"")+'<div class="zcmobmg"><span class="zcemilmsg">{{eventtime}}</span></div>'+(t.description?'<div class="zcmobmg">{{description}}</div>':"")+"</div></div>";return $WC.template.replace(a,{startdate:t.startdate,enddate:t.enddate,name:t.name,description:t.description,year:new Date(t.startdate).getFullYear(),month:$Date.getMonthString(t.startdate,!0),date:$Date.getDateString(t.startdate,!0),eventtime:i})},getDeletedInfoMsg:function(e){var t=e.time;if(e.count&&e.count>1){var i;if($Date.isOnSameTime(t,e.final_delete_time)){var a=$Date.time(t)+", "+$Date.date(t,{shorten:!0,datesuffix:!1});i=Resource.getRealValue("info.deleted.on",[a])}else{var a=$Date.time(t),s=$Date.time(e.final_delete_time)+", "+$Date.date(t,{shorten:!0,datesuffix:!1});i=Resource.getRealValue("info.deleted.between",[a,s])}var n='<span class="curD" title="'+i+'">'+Resource.getRealValue("info.deleted")+"</span>";return Resource.getRealValue("info.message.multiple.deleted",[e.count,n])}var r=$Date.time(t)+", "+$Date.date(t,{shorten:!0,datesuffix:!1}),i=Resource.getRealValue("info.deleted.on",[r]),n='<span class="curD" title="'+i+'">'+Resource.getRealValue("info.deleted")+"</span>";return Resource.getRealValue("info.message.single.deleted",[n])},getInitiatorHtml:function(e){return e?WmsImpl.isLocalUser(e.zuid)?Resource.getRealValue("common.you.have"):'<span elemtype="user" uid="'+e.zuid+'" hover="true" class="hvrinfo">'+Users.getName(e.zuid,e.nname)+"</span>":""},getEditedInfoMsg:function(e,t,i){var a=$WC.template.replace,s="<div>{{content}}</div>";i=WmsImpl.isLocalUser(e.opruser.zuid)?Resource.getRealValue("common.you"):i;var n=a(Template.EditInfoMessage,{msgtime:e.info.ref_msg_time}),r=Resource.getRealValue("message.edit.info",[i,n]);return a(s,{content:r},"InSecureHTML")},getInfoMsg:function(e){var t,i=e.info,a=i.mode,s=i.opruser,n="",r=s?s.nname?s.nname:s.dname:"";if(t=s?WmsImpl.isLocalUser(s.zuid)?Resource.getRealValue("common.you.have"):'<span elemtype="user" uid="'+s.zuid+'" hover="true" class="hvrinfo">'+Users.getName(s.zuid,r)+"</span>":"","GUEST ACCESS"===a)n="on"===i.access?Resource.getRealValue("chat.guest.enable",[t]):Resource.getRealValue("chat.guest.disable",[t]);else if("USER ADDED"===a||"USER DELETED"===a){var o,l=i.userslist,c=[],d=[],u=s.zuid,m=0,n="";for(var p in l)o=p,m++,c.push(WmsImpl.isLocalUser(p)?Resource.getRealValue("common.you.small"):'<span elemtype="user" uid="'+p+'" hover="true" class="hvrinfo">'+Users.getName(p,l[p])+"</span>"),d.push(WmsImpl.isLocalUser(p)?Resource.getRealValue("common.you.small"):Users.getName(p,l[p]));c=c.join(", "),d=d.join(", "),"USER ADDED"===a?n=1===m&&u===o?Resource.getRealValue("chat.joined",[WmsImpl.isLocalUser(u)?Users.getName(u,d,1):'<span elemtype="user" uid="'+u+'" hover="true" class="hvrinfo">'+Users.getName(u,d,1)+"</span>"]):Resource.getRealValue("chat.participant.added",[t,c]):"USER DELETED"===a&&(n=1===m&&u===o?Resource.getRealValue("chat.left",[WmsImpl.isLocalUser(u)?Users.getName(u,d,1):'<span elemtype="user" uid="'+u+'" hover="true" class="hvrinfo">'+Users.getName(u,d,1)+"</span>"]):Resource.getRealValue("chat.participant.deleted",[t,c]))}else if("GUEST ENTERED"===a||"GUEST LEFT"===a){var h=$WC.$CUtil.processXSS(e.nname);n="GUEST ENTERED"===a?Resource.getRealValue("chat.guest.entered",[h]):Resource.getRealValue("chat.guest.left",[h])}else"TITLE CHANGE"===a?n=""===i.title?Resource.getRealValue("chat.title.clear",[t]):Chat.isChannelChid(e.chid)?Resource.getRealValue("channel.title.rename",[t,$WC.$CUtil.processXSS(i.title)]):Resource.getRealValue("chat.title.rename",[t,$WC.$CUtil.processXSS(i.title)]):"ZC CUSTOM MESSAGE"===a?n=Resource.getRealValue(i.msg,[t]):"CALLNOTIFICATION"===a?n=this.getCallNotificationMessage(i):"EVENTNOTIFICATION"===a?n=this.getEventNotificationInfoMessage(i,e.chid):"SHOWTIMENOTIFICATION"===a?n=this.getShowTimeNotificationMessage(i):"CHANNEL_VISIBILITY_CHANGE"===a?n=this.getChannelVisibilityChangeInfoMessage(i,e.chid,t):"MESSAGE EDITED"===a?n=this.getEditedInfoMsg(i,e.chid,t):"CHANNEL_MENTION"===a&&(n=this.getChannelMentionInfoMessage(i,e.chid));return n},getChannelMentionInfoMessage:function(e,t){var i="",a=Channels.getByChid(t),s=this.getInitiatorHtml(e.opruser),n='<span elemtype="channel" hover="true" uid="'+e.msg.ocid+'" class="hvrinfo atme" mentionedid="'+e.msg.ocid+'" mention_on="8" mentiontype="3">'+e.msg.channelname+"</span>";return a?Resource.getRealValue("channel.mention.infomsg",[s,n]):i},getChannelVisibilityChangeInfoMessage:function(e,t,i){var a="",s=Channels.getByChid(t);if(s){var n=e.msg.open_to_all,r=Groups.getGroupNames(s.scid,s.scid_name);return"true"==n?Resource.getRealValue("channel.visibility.open.infomsg."+Channels.getLevel(s),[i,r]):Resource.getRealValue("channel.visibility.closed.infomsg."+Channels.getLevel(s),[i,r])}return a},getEventNotificationInfoMessage:function(e,t){var i="";if("START"===e.msg.type&&WmsImpl.isLocalUser(e.opruser.zuid)){var a=$WC.template.replace('<span infobutton purpose="startPrimeTime" eventtitle="{{TITLE}}" class="msi-bcstrt zcthmfnt mrgR5 mrgL5"></span> <span infobutton purpose="startPrimeTime" eventtitle="{{TITLE}}" class="hvrinfo zccnm">{{PRIMETIME}}</span>',{$PRIMETIME:"common.primetime",TITLE:e.msg.title}),s=$WC.template.replace('<span infobutton purpose="startShowTime" eventtitle="{{TITLE}}" class="msi-showtime zcthmfnt mrgR5 mrgL5"></span><span infobutton purpose="startShowTime" eventtitle="{{TITLE}}" class="hvrinfo zccnm">{{SHOWTIME}}</span>',{$SHOWTIME:"common.showtime",TITLE:e.msg.title});SecurityManager.hasPermission(Modules.PrimeTime)&&ChatUI.isExist(t)&&ChatUI.exist[t].partcount>2?i=SecurityManager.hasPermission(Modules.ShowTime)?Resource.getRealValue("primetime.showtime.desc",[a,s]):Resource.getRealValue("primetime.desc",[a]):SecurityManager.hasPermission(Modules.ShowTime)&&(i=Resource.getRealValue("showtime.desc",[s]))}return i},getShowTimeNotificationMessage:function(e){return SecurityManager.hasPermission(Modules.ShowTime)&&"START"===e.msg.type&&WmsImpl.isLocalUser(e.opruser.zuid)?Resource.getRealValue("showtime.start.presenter.url",[e.opruser.nname,'<span class="linkspn"><a href="'+e.msg.presenterurl+'" target="_blank">'+Resource.getRealValue("common.here")+"</a></span>"]):""},getCallNotificationMessage:function(){var e,t,i={completed:function(a){var s,n=a.msg.duration.split(":"),r=parseInt(n[0]),o=parseInt(n[1]),l=parseInt(n[2]),c="";return"00:00:00"===a.msg.duration?i.cancelled(a):("00"!==n[2]&&(c="00"!==n[0]||"00"!==n[1]?":"+n[2]:l,s=l>1?"secs":"sec"),"00"!==n[1]&&(c="00"!==n[0]?":"+n[1]:o+c,s=1===o&&0===l?"min":"mins"),"00"!==n[0]&&(c=r+c,s=1===r&&0===o&&0===l?"hr":"hrs"),s=Resource.getRealValue("common."+s),"<div>"+Resource.getRealValue("info.call.completed",[Resource.getRealValue("info.call."+e)])+'<span class="mrgL5">'+(c+" "+s)+"</span>"+MsgTemplate.getCallButton(t?a.msg.calleduser.zuid:a.opruser.zuid,!0,e)+"</div>")},cancelled:function(i){return t?"<div>"+Resource.getRealValue("info.call.cancelled.caller",[Resource.getRealValue("info.call."+e)])+MsgTemplate.getCallButton(i.msg.calleduser.zuid,t,e)+"</div>":"<div>"+Resource.getRealValue("info.call.cancelled.callee",[Users.getName(i.opruser.zuid,i.opruser.nname),Resource.getRealValue("info.call."+e)])+MsgTemplate.getCallButton(i.opruser.zuid,t,e)+"</div>"},noresponse:function(i){return t?"<div>"+Resource.getRealValue("info.call.noresponse.caller",[Users.getName(i.msg.calleduser.zuid,i.msg.calleduser.nname),Resource.getRealValue("info.call."+e)])+MsgTemplate.getCallButton(i.msg.calleduser.zuid,t,e)+"</div>":"<div>"+Resource.getRealValue("info.call.noresponse.callee",[Resource.getRealValue("info.call."+e)])+MsgTemplate.getCallButton(i.opruser.zuid,t,e)+"</div>"},rejected:function(i){return t?"<div>"+Resource.getRealValue("info.call.rejected.caller",[Users.getName(i.msg.calleduser.zuid,i.msg.calleduser.nname)])+MsgTemplate.getCallButton(i.msg.calleduser.zuid,t,e)+"</div>":"<div>"+Resource.getRealValue("info.call.rejected.callee",[Resource.getRealValue("info.call."+e)])+MsgTemplate.getCallButton(i.opruser.zuid,t,e)+"</div>"},busy_on_another_call:function(i){return t?"<div>"+Resource.getRealValue("info.call.noresponse.caller",[Users.getName(i.msg.calleduser.zuid,i.msg.calleduser.nname),Resource.getRealValue("info.call."+e)])+MsgTemplate.getCallButton(i.msg.calleduser.zuid,t,e)+"</div>":"<div>"+Resource.getRealValue("info.call.noresponse.callee",[Resource.getRealValue("info.call."+e)])+MsgTemplate.getCallButton(i.opruser.zuid,t,e)+"</div>"}};return function(a){return e=a.msg.type,t=WmsImpl.isLocalUser(a.opruser.zuid),i[a.msg.event](a)}}(),getCallButton:function(e,t,i){return"audio"===i?MMChat.isAudioCallEnabled()?'<span infobutton purpose="triggerAudioCall" class="msi-call zccnm mrgL10" calleezuid='+e+'></span><span infobutton purpose="triggerAudioCall" class="hvrinfo zccnm mrgL5" calleezuid='+e+">"+Resource.getRealValue(t?"info.call.again":"info.call.back")+"</span>":"":"video"===i?MMChat.isVideoCallEnabled()?'<span infobutton purpose="triggerVideoCall" class="msi-video zccnm zccnvd mrgL10" calleezuid='+e+'></span><span infobutton purpose="triggerVideoCall" class="hvrinfo zccnm mrgL5" calleezuid='+e+">"+Resource.getRealValue(t?"info.call.again":"info.call.back")+"</span>":"":MMChat.isScreenSharingEnabledInAVCall()&&t?'<span infobutton purpose="triggerScreenShare" class="msi-scrnshr zccnm mrgL10" calleezuid='+e+'></span><span infobutton purpose="triggerScreenShare" class="hvrinfo zccnm mrgL5" calleezuid='+e+">"+Resource.getRealValue("videochat.sharescreen")+"</span>":""},getLoadMore:function(){return'<div id="loadmoremsgs" style="display:none"></div>'}},$WC.ButtonActionsImpl={handle:function(){var e={startchat:function(e){Chat.create(e[0],"im")},audiocall:function(e){MMChat.triggerAudioCall(e[0],"button_system_api")},videocall:function(e){MMChat.triggerVideoCall(e[0],"button_system_api")},videobroadcast:function(e,t){$ZCVideoBroadcast.join(e[0],t.sender)},joinchannel:function(e){Channels.join(e[0],!0)},approvechannel:function(e){Channels.approve(e[0])},rejectchannel:function(e){Channels.reject(e[0],"")},invite:function(e){Contacts.add("zoho",e[0])},userrecentchats:function(e){Contacts.getProfileDetails(e[0])},locationpermission:function(){var e=$zcg.LOCATION_INFO.PERMISSIONSTATE;if("granted"===e)UI.updateBanner(Resource.getRealValue("functions.location.granted"),3e3,!1,!0);else{if("undefined"!=typeof navigator&&"undefined"!=typeof navigator.geolocation){var t=function(e){_print("location",e),navigator.permissions.query({name:"geolocation"}).then(function(e){$zcg.LOCATION_INFO.PERMISSIONSTATE=e.state,_print("location",e),"granted"===e.state?UI.updateBanner(Resource.getRealValue("functions.location.allowed"),2e3):UI.updateBanner(Resource.getRealValue("functions.location.allowed.once"),5e3,void 0,!0)})},i=function(t){UI.updateBanner(Resource.getRealValue("functions.location.denied.now"),5e3,!0),_print("location",t),"undefined"===e&&($zcg.LOCATION_INFO.PERMISSIONSTATE="denied")};navigator.geolocation.getCurrentPosition(t,i)}"denied"===e&&UI.updateBanner(Resource.getRealValue("functions.location.denied"),5e3,!0)}},markreminderascomplete:function(e){Reminders.markAsCompleted(e[0],void 0,function(){UI.updateBanner(Resource.getRealValue("reminders.complete.success"),2e3)})},snoozereminder:function(e){Reminders.snoozeReminder(e[0],e[1],void 0,function(){UI.updateBanner(Resource.getRealValue("reminders.snooze.success"),2e3)})}};return function(t,i){var a=t.split("/"),s=a[0],n=a.slice(1);e[s](n,i,t)}}()},InfoButtonActionsImpl={handler:{startPrimeTime:function(e){var t=e.attr("eventtitle");$WC.Matcher.check("textpattern",t,!0)?$ZCVideoBroadcast.trigger(e.parents("[chid]").attr("chid"),t):$ZCVideoBroadcast.trigger(e.parents("[chid]").attr("chid"))},startShowTime:function(e){ShowTime.scheduleShowTimeSession(e.parents("[chid]").attr("chid"),e.attr("eventtitle"))},triggerAudioCall:function(e){MMChat.triggerAudioCall(e.attr("calleezuid"),"chatwindow_infomessage")},triggerVideoCall:function(e){MMChat.triggerVideoCall(e.attr("calleezuid"),"chatwindow_infomessage")},triggerScreenShare:function(e){MMChat.triggerScreenShare(e.attr("calleezuid"),"chatwindow_infomessage")}}},$WC.ExecuteButtonResponseImpl={handle:function(){var e={renderResponse:function(e,t){IntegrationsResponse.populateOutput({module:"functions",name:e.title||t.title,imageUrl:Functions.getDefaultImgUrl()},{output:e.info,status:"Success"},t.chid)},handleStatusChange:function(e){"loading"===e?$("#loadingline").css({width:"0px"}).show().animate({width:"90%"},1200):"complete"===e&&$("#loadingline").stop(!0,!1).animate({width:$(window).width()+"px"},300,function(){$(this).hide()})},handleSystemResponse:function(e){"banner"===e.type&&UI.updateBanner(e.info.text,2e3,"failure"===e.info.type)}};return function(t,i,a){e[t](i,a)}}()};var Composer={};Composer={defaultTriggers:{allowedtriggers:["@","+",":","cc:","cc:@","/"]},rules:{addmem:["+","@",":","cc:","cc:@"],mention:["@","cc:","cc:@",":","+"]},triggerdesc:{mention:Resource.getRealValue("common.shortcut.description.mention"),hashtag:Resource.getRealValue("common.shortcut.description.hashtag"),addmem:Resource.getRealValue("common.shortcut.description.addmember"),delmem:Resource.getRealValue("common.shortcut.description.deletemember")},getDescription:function(e){return this.triggerdesc[e]},getChidFromComposerId:function(e){var t=e.indexOf("composer")>-1?e.replace("composer",""):e.replace("editor","");return t},isEditor:function(e){return"editor"==$WC.DivEditor.editors[e].trigger},init:function(){this.triggerdesc["/"]=Resource.getRealValue("common.shortcut.description.shortcut")},updateHelpTip:function(e,t,i){var a,s='<div class="mrgat">';if("mention"!==t&&"msg"!==t||"@"!==i&&"cc:"!==i&&"cc:@"!==i&&":"!==i?"msg"===t&&""!==i?(a=this.getDescription("+"===i?"addmem":"#"===i?"hashtag":i),a+='<div class="dIB mrgL10 white-prewrp"><span class="msi-zcentr_ico mrgL10"></span> <span class="mrgR10">'+Resource.getRealValue("common.to.select")+"</span>"+Resource.getRealValue("common.to.close")+"</div>"):t.startsWith("/")?a=CommandsUtil.getHelpTip(e,t):"mention"!==t&&"msg"!==t&&"file"!==t?a=this.getDescription(t):"file"==t&&(a=Template.SendFile.replace(/{CHID}/g,e)):(a=":"!=i?this.getDescription("mention")+"&nbsp;&nbsp;&#45;":'&#8645; &#8646; <span class="mrgR10">'+Resource.getRealValue("common.to.navigate")+"</span>",a+='<div class="dIB mrgL10 white-prewrp"><span class="msi-zcentr_ico mrgL10"></span> <span class="mrgR10">'+Resource.getRealValue("common.to.select")+"</span>"+Resource.getRealValue("common.to.close")+"</div>"),"undefined"==typeof a){s=Template.MarkDownDescription.replace(/{CHID}/g,e).replace(/{HELPTEXT}/,ChatUI.exist[e].randomhelptip);var n=new $CliqChatId(e);if(n.isCustomBot()){var r=MyBots.populateActions(e);if(r)return}}else s+=a,s+="</div>";$("#"+e).find("#helptip").html(s)},doMoreaction:function(e,t,i){if(i=this.win().find(i),i.hasClass("sel")||i.addClass("sel"),e==="triggersmileys"+this.chid)$("#smileys"+this.chid).attr("style",""),Smiley.showSmileyUI(e,"smileys"+this.chid,t);else if(e==="triggeractions"+this.chid){{this.chid}Clickoutside.bind({srcid:e,destid:"chatactionsholder"+this.chid,event:t,callback:function(e){$("#"+e).removeClass("sel")}})}else if(e==="addmemberonmention"+this.chid)this.clearInviteMemberPromptbanner(),Composer.handleAddMember(this.suggesttoadd,this.chid);else if(e==="cancelmemberonmention"+this.chid){var a=ChatUI.exist[this.chid];a.clearInviteMemberPromptbanner()}t.preventDefault()},handleClick:function(e,t){Composer.doMoreaction.call(this,t.id,e,t)},handleClickForAttachment:function(e){var t=$Util.getSyncedCurrentTime(),i=ChatUI.exist[e.id.substring("sendattachment".length)],a=i.chid,s=Composer.getMessageWithOutSpecificNode("composer"+a,"\n");Chat.sendAttachment(a,s,t),Composer.updateHelpTip(a,"",""),$WC.DivEditor.clear("composer"+a)},handleInitialize:function(e,t){if(!$WC.$CUtil.isEmpty(t)){var i=Composer.getChidFromComposerId(e),a=$("#compautocomplete"+i);$(a).attr("trigger",t)}},sendMsgOnEnter:function(e,t){var i=ChatUI.exist[e];Composer.handleEnterKey.call(i,t),Composer.updateHelpTip(e,"msg",""),Composer.clearSearchResults(e),i.cursearchval="",t.removeAttribute("currcommand")},handleKeyDown:function(e,t,i){var a=Composer.getChidFromComposerId(e),s=ChatUI.exist[a],n=Composer.isEditor(e),r=t.which,o=$("#compautocomplete"+a),l="block"===o.css("display"),c=$("#urlinfopreview"+a),d="block"===c.css("display"),u=c.attr("currentlink");if(!t.ctrlKey&&!t.metaKey||66!==r&&73!==r&&85!==r||t.preventDefault(),13===r)t.shiftKey&&($WC.DivEditor.insertObject(e,i,document.createElement("br")),s&&s.scrolldown&&s.getScrollDown(500)),t.preventDefault();else if(r!==$zcg.TAB_KEYCODE||t.ctrlKey){if(l&&!t.shiftKey&&$Util.isArrowKey(r)){var m=o.find('[elemtype="commandsimagedropdown"]').length>0;r!==$zcg.UP_KEYCODE&&r!==$zcg.DOWN_KEYCODE&&(":"!==s.curtrigger&&!m||r!==$zcg.LEFT_KEYCODE&&r!==$zcg.RIGHT_KEYCODE)||t.preventDefault()}}else t.preventDefault(),i.getAttribute("rule").startsWith("/")&&l||(MainUI.onTabChange(t.shiftKey),Composer.clearAutoComplete(s.chid));if(!l){if(r===$zcg.UP_KEYCODE&&!n&&!Composer.hasMessage(i)&&!i.getAttribute("commandid")){var p=MessageOperations.edit,h=p.getEditableLastMsg(s);if(h&&!p.isSameExist(a,h.msguid))return p.init(a,h.uid),void t.preventDefault()}if(r===$zcg.UP_KEYCODE||r===$zcg.DOWN_KEYCODE){var g=CommandsUtil.isCommandHistoryAvailable(i,a,38===r);g&&t.preventDefault()}if(13===r&&t.altKey)return void MainUI.toggleChatView();if(13===r&&!t.shiftKey){if(!i.getAttribute("rule").startsWith("/")){var f=Composer.getUnfurlableLink.call(s,i);if(!n&&f&&(f!==u||!d))return void Composer.handleLinkMessage.call(s,i);if(0==s.history&&s.isAnyRecipientOffline()&&!s.ishoffconfirmationshown){var v=[],C=[{text:Resource.getRealValue("chat.historyoff.prompt.option1"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){Chat.setHistoryStorage(a,"enable",function(){Composer.sendMsgOnEnter(a,i),$WC.DivEditor.clear(i)})}},{text:Resource.getRealValue("chat.historyoff.prompt.option2"),action:function(){Composer.sendMsgOnEnter(a,i),$WC.DivEditor.clear(i),s.ishoffconfirmationshown=!0}}];if(s.isOnetoOneChat()){var y=Participants.get(a).getRecipientFor121Chat(),b=Users.getName(y);v=[Resource.getRealValue("chat.historyoff.prompt1",[Users.getName(y,b)])]}else if(s.isGroupChat()){var E=s.getOfflineParticipants(),I=parseInt(Participants.get(s.chid).pcount),T=E.length,S=T==I-1;if(S)v=[Resource.getRealValue("chat.historyoff.prompt3")];else if(1==T){var R=E[0],A=Users.getName(R);v=[Resource.getRealValue("chat.historyoff.prompt1",[Users.getName(R,A)])]}else v=[Resource.getRealValue("chat.historyoff.prompt2",[T])]}return $WC.$Dlg.confirm({id:"historyoffalert",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:v}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-green"></div>'}),buttons:C}),void $("#historyoffalert").width(700)}}Composer.sendMsgOnEnter(a,i)}}if("block"===c.css("display")){var M=Composer.getTextMessage(i),U=c.attr("currentlink");(0==M.length||-1==M.indexOf(U))&&s.toggleLinkPreview(!1)}},handleKeyUp:function(e,t,i){var a=Composer.getChidFromComposerId(e),s=ChatUI.exist[a],n=t.which,r="compautocomplete"+a,o=$("#"+r),l="none"===o.css("display")?!1:!0,c=[],d=[],u=SearchAgent.CONTACTS+SearchAgent.PARTICIPANTS,m=$("#urlinfopreview"+a),p="block"===m.css("display"),h=m.attr("currentlink"),g=$("#composer"+a).height(),f=Composer.isEditor(e),v=f?"editor":"composer";o.attr("trigger",v),$Util.isCtrlorCmdKey(t)&&191===n&&t.stopPropagation(),s.removeNewmsgNotification();var C=Composer.updateRuleCatagory(i,s);C.startsWith("/")||i.removeAttribute("currcommand"),s.currenttriggers=$Util.cloneArray("msg"===C?s.allowedtriggers:C.startsWith("/")?CommandsUtil.getAllowedTriggers(C):Composer.rules[C]),!s.isOrgChannel()||s.isSharedChannel()||"mention"!==C&&!C.startsWith("/")||s.currenttriggers.push("#");var y=function(e,t){for(var i,a=e.length,s=0;a>s;s++)i=t.indexOf(e[s]),-1!==i&&t.splice(i,1);return t},b=[];10===s.ctype&&b.push("+"),f&&b.push("+","/"),s.currenttriggers=y(b,s.currenttriggers);var E=Composer.getSearchCriteria(s,i,C),I=$WC.DivEditor.getSearchValueAndTrigger(s.currenttriggers,e,s.curtrigger);c=E.ignorelist,d=E.protocol,u=E.searchin,I.trigger&&s.curtrigger!==I.trigger&&(s.cursearchval=""),s.curtrigger=I.trigger;var T=I.val;if(""===T&&s.curtrigger&&(T="*"),T.startsWith(" ")&&(s.curtrigger=""),T!==s.cursearchval){var S="",R=25,A=!1;if(s.cursearchval=T,T.length>0){var M=r+"list",U={listid:M,srcid:e,destid:r,debugsource:e,clearcallback:function(e){"undefined"!=typeof e&&Composer.clearAutoComplete(e.replace("composer",""))}};switch(S='<div id="'+r+'list" class="'+(":"===s.curtrigger?"smilyatdrpdwn animEmoji":"drpdwn srchglt")+'"></div>',o.html(S),s.curtrigger){case"@":case"cc:":case"cc:@":if(!C.startsWith("/")&&s.isChannel()){var w=Channels.getByChid(s.chid);s.isOrgChannel()&&($.isEmptyObject(w)||!ChannelsPermission.hasPermission(Channels.ACTIONS.SPECIAL_MENTIONS,w)||Channels.hasAnyAdvancedRules(w)||(u+=SearchAgent.ORGGROUPS,U.allorggroups=!0)),s.isOrgGroupChannel()&&(u+=SearchAgent.CUSTOMSEARCH,$.isEmptyObject(w)||$.isEmptyObject(w.scid)||(u+=SearchAgent.ORGGROUPS,U.validorggroups=w.scid,U.allorggroups=!0))}s.isCrossProductChat()||(u+=SearchAgent.BOTS),c=Composer.getSelectedList(i,"@"),c=c.concat(Composer.getSelectedList(i,"cc:")),c=c.concat(Composer.getSelectedList(i,"cc:@")),c=c.concat($zcg._ZUID);var _=0;_=s.isChannel()?SearchAgent.GROUPING_CHANNELS:SearchAgent.GROUPING_CHATS,"/remind"===C&&(u=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,U.restricttosameorg=!0),U=$.extend({},U,{searchin:u,val:T,chid:a,allstatuscontacts:!1,protocol:d,ignorelist:c,peopledata:!0,clearcallback:function(){o.hide()},limit:R,customobject:s.getAllowedUsers(),groupingmode:_,specialmentions:!0}),U.scrlcontainer=s.win().find("#"+M),U.domfinder={key:"searchcatagory",value:"participants"},A=SearchAgent.search(U),o.removeClass().addClass("chtedtrdrpdwn"),MentionsUI.populatePermissions(o,s);break;case"+":s.isChannel()?(u=SearchAgent.ORGCONTACTS,s.isOrgGroupChannel()?u=SearchAgent.CUSTOMSEARCH:s.isSharedChannel()?u=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS:s.isChannel()&&Channels.hasAnyAdvancedRules(new $CliqChatId(s.chid))&&(u=SearchAgent.ALLOWEDUSERSEARCH)):u=SearchAgent.ORGCONTACTS+SearchAgent.CONTACTS,c=Composer.getSelectedList(i,"+"),c=c.concat(Contacts.getAllBotContactsIds()),U=$.extend({},U,{searchin:u,val:T,allstatuscontacts:!1,protocol:["zoho"],ignorelist:c,peopledata:!0,chid:a,ignoreparticipants:!0,limit:R,customobject:s.getAllowedUsers()}),A=SearchAgent.search(U),o.removeClass().addClass("chtedtrdrpdwn");break;case"-":c=Composer.getSelectedList(i,"-"),c=c.concat($zcg._ZUID),C.startsWith("/")?-1===T.indexOf(" ")&&(A=CommandsUtil.showOptionsTip(e,C,T)):(U=$.extend({},U,{searchin:1,chid:a,val:T,protocol:"-",ignorelist:c,peopledata:!0,limit:R}),A=SearchAgent.search(U),o.removeClass().addClass("chtedtrdrpdwn"));break;case":":U=$.extend({},U,{searchin:32,peopledata:!0,val:s.curtrigger+T}),A=SearchAgent.search(U),o.removeClass().addClass("smilyatdrpdwnmn");break;case"#":if(s.isChannel()){var O=$("#compautocomplete"+a+"list");channelid=Channels.getChannelId(a),channelCategory=ChannelsUI.List.RETRIVE_ORG,w=Channels.getByChid(a);var D;if(c.push(Channels.getChannelId(a)),s.isOrgChannel()&&Channels.isOpenToAll(w)&&!Channels.hasAnyAdvancedRules(w))u=SearchAgent.CHANNELS;else{if(!s.isOrgGroupChannel()||!Channels.isOpenToAll(w))return;channelCategory=ChannelsUI.List.RETRIVE_ORG_GROUP,u=SearchAgent.CHANNELS,Channels.isExist(channelid)&&(D=w.scid)}}U=$.extend({},U,{searchin:u,val:T,chid:a,ignorelist:c,replacecontentonsuccesscallback:!0,channelcategory:channelCategory,scid:D,successcallback:function(){O&&O.find("[purpose='search']").first().addClass("sel")},clearcallback:function(){o.hide()},limit:R}),A=SearchAgent.search(U),o.removeClass().addClass("chtedtrdrpdwn");var N=o.children();N.attr("zc_sticky_title_list","");var L=$('<div><div class="mtnsugautotitle zcstkshdw mtnsugtit" zc_sticky_title >'+Resource.getRealValue("menuname.channelsandgroups")+"</div></div>");o.html(L),L.append(N);break;case"/":s.isChannel()?(c.push(""+CommandsUtil.MAIL_COMMAND),c.push(""+CommandsUtil.TITLE_COMMAND),ChannelsPermission.hasPermission(Channels.ACTIONS.LEAVE_ALLOWED,Channels.getChannelId(s.chid))||c.push(""+CommandsUtil.LEAVE_COMMAND)):s.isSystemChat()||s.isOnetoOneChat()?c.push(""+CommandsUtil.TITLE_COMMAND):$WC.Matcher.check("emailid",s.addinfo.PEND_INV)&&(c.push(""+CommandsUtil.MUTE_COMMAND),c.push(""+CommandsUtil.UNMUTE_COMMAND)),U=$.extend({},U,{searchin:SearchAgent.COMMANDS,val:"/"+T,chid:a,limit:R,ignorelist:c}),A=SearchAgent.search(U),o.removeClass().addClass("chtedtrdrpdwn zcshortcut")}if(C.startsWith("/")&&"-"===s.curtrigger&&-1===T.indexOf(" ")||o.attr("style",""),f){var W=$("#compautocomplete"+a).outerHeight(),x={top_offset:42,bottom_offset:5,height:W};o.css($Util.positionTargetElementUpDown($(i).parent(),o,x))}var k=s.win().find("#"+M);ZCScroll.customScroll(k,!0)}A||Composer.clearAutoComplete(a)}if(CommandSuggestions.handleKeyUp(C,a,l,t,s.curtrigger,T),l)if(13===n||C.startsWith("/")&&n===$zcg.TAB_KEYCODE){if(!t.shiftKey){var z=o.find(".sel");z.length&&(Composer.select(i,z[0],s.curtrigger,a),C=Composer.updateRuleCatagory(i))}Composer.clearSearchResults(a),s.cursearchval="",z.length>0&&CommandSuggestions.handleKeyUp(C,a,l,t,s.curtrigger,T,"shortcut"===z.attr("elemtype")||"commandsdropdown"===z.attr("elemtype"))}else if(38===n||40===n||37===n||39===n){var H=o.find("#"+r+"list");if(":"===s.curtrigger){var P=Math.floor(o.width()/H.find('[elemtype="smiley"]').first().outerWidth());DropdownUtil.handleGridNavigation(t,H,"[purpose='search']",P)}else if(H.find('[elemtype="commandsimagedropdown"]').length>0){var P=CommandSuggestions.images.getColumnsCount(o),V=DropdownUtil.handleGridNavigation(t,H.find("#commandsdropdownhtml"),"[purpose='search']",P);CommandSuggestions.images.changePreviewImage(a,V.attr("imgurl"))}else 37!==n&&39!==n&&DropdownUtil.handleListNavigation(t,H,"[purpose='search']")}else 27===n&&(t.stopPropagation(),Clickoutside.handleEscape(t));else{if(n===$zcg.UP_KEYCODE||n===$zcg.DOWN_KEYCODE){var B=CommandsUtil.handleCommandHistory(i,s.chid,38===n);if(B)return}if(27===n)if(Composer.hasMessage(i)){if(t.stopPropagation(),p)return void s.toggleLinkPreview(!1,h);s.cursearchval="",Composer.clearSearchResults(a),s.iscomposerdisabled||$WC.DivEditor.clear(i),C="msg",Composer.updateHelpTip(s.chid,C,""),ZCScroll.updateScroll(s.win().find("#chatbody"))}else Composer.hasReplyWindow(a)?(t.stopPropagation(),MessageOperations.clearreplypreview(a)):Composer.isEditor(e)&&!Composer.hasMessage(i)&&(t.stopPropagation(),MessageOperations.edit.clearComposer(a));else Composer.handleLinkMessage.call(s,i,500);var F=-1;13!==n||Composer.hasMessage(i)?(F=Composer.hasMessage(i)?0:-1,s.setLastEnterKeyPressTime(F)):(s.isDoubleEnter()&&!f?Composer.sendHorizontalLineMsg(s.chid):0===s.lastEnterKeyTime||t.shiftKey||t.altKey||t.ctrlKey||t.metaKey||(F=(new Date).getTime()),s.setLastEnterKeyPressTime(F)),Composer.hasMessage(i)&&g!==s.composerheight&&(g>s.composerheight&&s.scrolldown&&s.getScrollDown(),s.composerheight=g)}Composer.hasMessage(i)&&s.cscode!==$zcg.NFY_USER_TYPING&&!C.startsWith("/")&&(s.cscode=$zcg.NFY_USER_TYPING,Chat.sendStatus(s.chid,$zcg.NFY_USER_TYPING));var j=Composer.getPlainTextFromComposer(i.id);j.length>500?Composer.updateHelpTip(s.chid,"file",""):Composer.updateHelpTip(a,C,"block"===o.css("display")?s.curtrigger:""),s.checkStatus(i)},checkAndRemoveDeleteMemberTrigger:function(e,t){var i=Composer.getSelectedList(t,"-"),a=e.isChannel()?1:2,s=Participants.get(e.chid).pcount;if(s===a||s-i.length===a){var n=e.currenttriggers.indexOf("-");-1!==n&&e.currenttriggers.splice(n,1)}else-1===e.currenttriggers.indexOf("-")&&e.hasPermissionToDeleteMember()&&!e.isCrossProductChannelChat()&&e.currenttriggers.push("-")},getSearchCriteria:function(e,t,i){var a={ignorelist:[],protocol:[],searchin:SearchAgent.PARTICIPANTS+SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS};if("msg"===i){if(0!==this.getTextMessageTillFirstNonTextNode(t).indexOf("/")){var s=e.currenttriggers.indexOf("/");-1!==s&&e.currenttriggers.splice(s,1)}}else if("mention"===i)a.protocol=["zoho"];else if("/chat"===i){var n=Composer.isCreatingGroupChat(t);if(n){var r=e.currenttriggers.indexOf("@");-1!==r&&e.currenttriggers.splice(r,1)}if(Composer.hasTitle(t)){var o=e.currenttriggers.indexOf("#");-1!==o&&e.currenttriggers.splice(o,1)}Composer.hasSelectedList(t)?(a.searchin=SearchAgent.PARTICIPANTS+SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,a.protocol=["zoho"]):a.searchin=SearchAgent.PARTICIPANTS+SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS+SearchAgent.GROUPS}else if("/newchat"===i){if(a.searchin=SearchAgent.GROUPS,Composer.hasSelectedList(t)){var r=e.currenttriggers.indexOf("@");-1!==r&&e.currenttriggers.splice(r,1)}}else"/mail"===i&&(a.searchin=SearchAgent.PARTICIPANTS+SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,a.protocol=["zoho"]);return a},clearAutoComplete:function(e){var t="compautocomplete"+e;$("#"+t).empty().hide(),Clickoutside.clear(t)},clearSearchResults:function(e){this.clearAutoComplete(e),ChatUI.exist[e].curtrigger="",CommandSuggestions.clear()},eventsOnAutoComplete:function(e,t){var i=$("#compautocomplete"+this.chid),a=i.attr("trigger"),s=a+this.chid,n=$("#"+s);if("click"===e.type){var r=$(t);Composer.select(n[0],t,this.curtrigger,this.chid);var o=Composer.updateRuleCatagory(n[0]);Composer.updateHelpTip(this.chid,o,""),Composer.clearSearchResults(this.chid),this.cursearchval="",r.length&&CommandSuggestions.handleKeyUp(o,this.chid,!0,e,this.curtrigger,"","shortcut"===r.attr("elemtype")||"commandsdropdown"===r.attr("elemtype"))}else"mouseover"===e.type&&i.find('[elemtype="commandsimagedropdown"]').length>0&&CommandSuggestions.images.changePreviewImage(this.chid,$(t).attr("imgurl"))},updateRuleCatagory:function(e){var t=this.getRuleCatagory(e);return e.setAttribute("rule",t),t},getRuleCatagory:function(e){var t=e.id;if(!Composer.isEditor(t)){var i=this.getTextMessageTillFirstNonTextNode(e,!0).replace(/^\s+/g,"");if(i.startsWith("/")){var a=Commands.getRuleCategory(e.id);if(!$WC.$CUtil.isEmpty(a))return a}var s=this.getNodeTypes(e,["+","-","@"]);if(-1!==s.indexOf("+"))return"addmem";if(-1!==s.indexOf("-"))return"delmem";if(-1!==s.indexOf("@"))return"mention"}return"msg"},getNodeTypes:function(e,t){for(var i=$WC.DivEditor.getInsertedNodes(e),a=0,s=i.length,n="",r=new Array;s>a;a++)n=i[a].getAttribute("nodetype"),-1!==t.indexOf(n)&&r.push(n);return r},getTextMessageTillFirstNonTextNode:function(e,t){for(var i=$WC.DivEditor.getNodes(e),a=0,s=i.length,n="";s>a&&i[a].nodeType===Node.TEXT_NODE;a++)n+=i[a].nodeValue;return n=$WC.DivEditor.removeBufferCharacters(n),t||(n=$.trim(n)),n},getMessageWithOutSpecificNode:function(e,t){for(var i=$WC.DivEditor.getNodes(e),a=0,s=i.length,n="";s>a;a++)if(i[a].nodeType===Node.TEXT_NODE)n+=i[a].nodeValue;else{var r=i[a].getAttribute("nodetype"),o=i[a].getAttribute("elemtype");if(-1===t.indexOf(r))if(Composer.isMentionTrigger(r,o))n+=Composer.getMention(i[a]);else if(":"===r)n+=Composer.getSmileyCode(i[a]);else if("+"===r){var l=i[a].getAttribute("uid"),c=$(i[a]).text().substring(1),r=i[a].getAttribute("elemtype"),d="contact"===r?1:"group"===r?2:3;n+="{addchatmember:"+l+":"+d+":"+c+":addchatmember}"}else if("-"===r){var l=i[a].getAttribute("uid"),c=$(i[a]).text().substring(1),r=i[a].getAttribute("elemtype"),d="contact"===r?1:"group"===r?2:3;n+="{deletechatmember:"+l+":"+d+":"+c+":deletechatmember}"}else n+="BR"===i[a].tagName?"\n":$(i[a]).text()}return n=$WC.DivEditor.removeBufferCharacters(n),n=$.trim(n)},isMentionTrigger:function(e,t){var i="@"===e||"cc:"===e||"cc:@"===e||"#"===e,a="contact"===t||"group"===t||"channel"===t||Mentions.isSpecialMentionElemType(t);return i&&a},handleEnterKey:function(e,t){var i=("composer"+this.chid,e.getAttribute("rule")),a=!1,s=Composer.isEditor(e.id);if(t=t?t:s,this.clearSuggestToadd([]),i.startsWith("/"))a=CommandsUtil.handleCommand(i,this,e);else if("delmem"===i){var n=Composer.getMessageWithOutSpecificNode(e,"-");n.length>0&&(e.setAttribute("rule","msg"),a=Composer.sendMessage.call(this,e)),a=Composer.addOrDeleteMember(e,this.chid,"-")}else if("addmem"===i)a=Composer.addOrDeleteMember(e,this.chid,"+");else if("chat"===i||"newchat"===i){var r="newchat"===i;a=Composer.createChat(e,r)}("mention"===i||"msg"===i)&&(a=Composer.sendMessage.call(this,e,t)),a&&"addmem"!==i&&(this.currenttriggers=$Util.cloneArray(this.allowedtriggers),$WC.DivEditor.clear(e)),s&&a&&MessageOperations.edit.clearComposer(this.chid)},handleTextPaste:function(e,t,i){{var a=Composer.getChidFromComposerId(t),s=ChatUI.exist[a];s.win().find("#urlinfopreview"+s.chid)}$WC.Matcher.check("linkRegExp",i)&&Composer.handleLinkMessage.call(s,e)},handleLinkMessage:function(e,t){function i(){if(o==Composer.getUnfurlableLink.call(s,e)){var t=Composer.isEditor(e.id);if(s.toggleLinkPreview(!0,o),t){var i={top_offset:78,bottom_offset:7};r.css($Util.positionTargetElementUpDown($(e).parent(),r,i))}}}var a=Composer.isEditor(e.id);if(!a&&!e.getAttribute("rule").startsWith("/")){var s=this,n=s.chid,r=s.win().find("#urlinfopreview"+n),o=Composer.getUnfurlableLink.call(s,e),l=r.attr("currentlink");if("undefined"==typeof o||l==o)return void(l!=o&&s.toggleLinkPreview(!1));if((l&&l!=o||!l)&&(r.attr("currentlink",o),s.linkData.hasOwnProperty(o)))return void($.isEmptyObject(s.linkData[o])||s.toggleLinkPreview(!0,o));clearTimeout(s.previewtimer),"undefined"!=typeof t?s.previewtimer=setTimeout(i,t):i()}},getUnfurlableLink:function(e){for(var t=this.win().find("#urlinfopreview"+this.chid),i=Composer.getTextMessage(e),a=[],s=$WC.$CUtil.decodeHTMLEntities(i).split(" "),n=$Util.removeDuplicateEntries(t.attr("omittedlinks").split(" ")),r=0;r<s.length;r++){var o=s[r];if($WC.Matcher.checkWithFlag("linkRegExp",o,"gi")){o=Markdown.remove(o);var l=$WC.Matcher.match("linkRegExp",o,"gi")[0];if(-1!=$.inArray(l,n)||l!==o)continue;a.push(l)}}return a=$Util.removeDuplicateEntries(a),a.length?a[0]:void 0},getPlainTextFromComposer:function(e){for(var t="",i=$WC.DivEditor.getNodes(e),a=0;a<i.length;a++)if(i[a].nodeType===Node.TEXT_NODE)t+=i[a].nodeValue;else{var s=$(i[a]);t+=":"===s.attr("nodetype")?s.attr("code"):"BR"===i[a].tagName?"\n":s.text()}return t=$WC.DivEditor.removeBufferCharacters(t)},sendMessage:function(e,t){var i=this.chid,a=e.id,s=Composer.isEditor(a),n=Composer.getPlainTextFromComposer(a);if(n.length>4e3)return void(s?UI.updateBanner(Resource.getRealValue("chat.message.length.alert"),3e3,!0):$WC.$Dlg.create({id:"attach",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-zinfo"></div>',header:Resource.getRealValue("chat.message.length.alert")}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("chat.message.asfile.confirm")]}),buttons:[{text:Resource.getRealValue("chat.message.asfile.yes"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){Composer.sendComposerTextAsAttachment(i)}}]}));for(var r=$WC.DivEditor.getNodes(e),o=0,l=r.length,c="",d=[],u=[],m=[];l>o;o++)if(r[o].nodeType===Node.TEXT_NODE)c+=r[o].nodeValue;else{var p=r[o].getAttribute("nodetype"),h=r[o].getAttribute("elemtype");if(Composer.isMentionTrigger(p,h)){var g=r[o].getAttribute("uid");if(Participants.get(this.chid).isParticipantExist(g)||"contact"!==h||Contacts.isBot(g))"contact"===h&&Contacts.isBot(g)&&u.push(g);else if(this.isChannel()&&!this.isSharedChannel()){var f=!1;if(this.isOrgGroupChannel()){var v=this.getAllowedUsers();!$.isEmptyObject(v)&&v[g]&&(f=!0)}else f=Users.isSameOrg(g);f&&this.suggesttoadd.push(g)}else this.suggesttoadd.push(g);c+=Composer.getMention.call(this,r[o])}else if(":"===p)c+=Composer.getSmileyCode(r[o]);else if("+"===p){var g=r[o].getAttribute("uid"),C=$(r[o]).text().substring(1),p=r[o].getAttribute("elemtype"),y="contact"===p?1:"group"===p?2:3;c+="{addchatmember:"+g+":"+y+":"+C+":addchatmember}"}else if("-"===p){var g=r[o].getAttribute("uid"),C=$(r[o]).text().substring(1),p=r[o].getAttribute("elemtype"),y="contact"===p?1:"group"===p?2:3;c+="{deletechatmember:"+g+":"+y+":"+C+":deletechatmember}"}else if("att"===p){var b=r[o].getAttribute("fileindex"),E=(ChatUI.exist[this.chid],CommandFileUploadUI.getCommandFiles(this.chid)),I=r[o].getAttribute("filename");d.push([E[b],I]),m.push(E[b])}else c+="BR"===r[o].tagName?"\n":$(r[o]).text()}c=$WC.DivEditor.removeBufferCharacters(c),c=$.trim(c);var T=c.length;if(0===T)return!1;if(m.length>0&&$Util.isFilesizeExceeded(m))return $Util.showInvalidFileAlert($("#file"+i),m.length>1?$Util.CUMULATIVEFILESIZE_INVALID:$Util.FILESIZE_INVALID),!1;var S,R,A="",M=$("#msgoptionspreview"+this.chid);if("none"!==M.css("display")&&!s){R=M.attr("msguid"),S=R.slice(R.indexOf("_")+1);var U=$("#"+this.chid).find("[mtype][msgtime='"+S+"']");A='<blockquote class="quotedmsgdiv" purpose="viewreplied"><span class="msi-reply zcclr floatl"></span>'+MessageOperations.getFormattedRepliedMsg(U)+"</blockquote>",MessageOperations.clearreplypreview(this.chid)}var w,_=$Util.getSyncedCurrentTime(),O=document.getElementById("chatinformation"+i);O&&Tour.fadeOutAndRemove($(O));var D={};if(s){var N=e.getAttribute("msguid"),L=e.getAttribute("msgtime"),W=$("#"+i),x=W.find('[msguid="'+N+'"]'),k=x.find('[msgtype="msg"]')[0],z=$.trim(Markdown.convertToActualMsg(k,!0));if(z===c)return!1;var H="checked"===W.find("#editnotify").attr("checked");D.msguid=N,D.notify=H,D.msgtime=L}else w=Commands.getCommandId(c,this.chid),$(e).attr("commandid",w?w:""),$WC.$CUtil.isEmpty(w)||Commands.isDefaultCommand(w)&&w!=CommandsUtil.MAIL_COMMAND&&w!=CommandsUtil.REMIND_COMMAND&&(c=n);if(Chat.sendMessage(this.chid,c,_,D,{commandid:w,filesdetails:d,mentionedBotIds:u},R),$WC.$CUtil.isEmpty(w)){$WC.DivEditor.initObj("composer"+this.chid),c=MsgUtil.escape(c,!0),c=Composer.wrapMentionMessage(c),c=MsgUtil.isChatMemberAdded(c)?MsgTemplate.getDisplayableAddition(c):c,c=MsgUtil.isChatMemberDeleted(c)?MsgTemplate.getDisplayableDeletion(c):c,c=Markdown.apply(c);var P={msg:c,sender:WmsImpl.getZuid(),time:_,msgid:_,chid:this.chid};if($WC.$CUtil.isEmpty(A)||(P.isreply=!0,P.repliedmsgcontent=A),$zcg._ISNEWMENTION_FORMAT_ENABLED){var V=Mentions.getMentionMetaHash(c,this.chid);$WC.$CUtil.isEmptyObject(V)||(P.mentions=V.mentions)}return t||this.updateMsg(P,{isundelivered:!0}),this.toggleLinkPreview(!1),!0}},sendHorizontalLineMsg:function(e){var t=$Util.getSyncedCurrentTime(),i="---",a={msg:Markdown.apply(i),sender:WmsImpl.getZuid(),time:t,msgid:t,chid:this.chid};Chat.sendMessage(e,i,t),ChatUI.exist[e].updateMsg(a,{isundelivered:!0})},sendComposerTextAsAttachment:function(e){var t=$.trim(Composer.getPlainTextFromComposer("composer"+e)),i=t.indexOf(".")>=1?Math.min(15,t.indexOf(".")):15,a=$WC.Matcher.replace("invalidfilenamechars",t.substring(0,i),"-")+".txt",s=new File([t],a);FileUploadUI.handlePreview(e,[s],!1,!0)},addOrDeleteMember:function(e,t,a){var s=$WC.DivEditor.getNodes(e),n=s.length,r=[],o=[],l=[],c=[],d=!1,u=ChatUI.exist[t],m=u.isChannel();for(i=0;n>i;i++){var p=s[i];if(p.nodeType!==Node.TEXT_NODE){var h=p.getAttribute("nodetype"),g=p.getAttribute("elemtype");if("contact"===g){var f=p.getAttribute("uid"),v=p.getAttribute("data-title").substring(1);"+"===h?(r.push(f),l.push(Users.getName(f,v))):"-"===h&&(o.push(f),c.push(Users.getName(f,v)))}}}if("+"===a&&r.length){var C=$Util.cloneArray(r);if(msg=Composer.getMessageWithOutSpecificNode(e,"+,-"),addeduserstr=r.join(","),addedunamestr=l.join(", "),!m){$.merge(C,Participants.get(t).recipants),delete C[$zcg._ZUID],o.length&&(C=$Util.differedArray(C,o));var y=function(){msg.length>0&&(msg=Composer.getMessageWithOutSpecificNode(e,"")),$WC.DivEditor.clear(e),Chat.create(C.join(","),"nim","",msg.length>0?msg:void 0,"one_newchat")}}var b=function(){msg.length>0?(e.setAttribute("rule","msg"),Composer.handleEnterKey.call(u,e)):$WC.DivEditor.clear(e),Composer.updateHelpTip(t,"msg",""),Chat.addMember(t,addeduserstr),o.length&&Chat.deleteMember(t,o)},E=function(){m?b():$Util.showChatAddMemberAlert(addedunamestr,r,b,y)};o.length?$Util.showChatDeleteMemberAlert(t,c.join(", "),o,E):E(),d=!0}else"-"===a&&o.length&&($Util.showChatDeleteMemberAlert(t,c.join(", "),o),d=!0);return d},handleAddMember:function(e,t){var i=[],a=ChatUI.exist[t],s=$Util.cloneArray(e);addeduserstr=e.join(",");for(var n=0;n<e.length;n++)i.push(Users.getName(e[n]));var r=i.join(", "),o=function(){Chat.addMember(t,addeduserstr,"one_samechat")};if(a.isChannel())o();else{$.merge(s,Participants.get(t).recipants),delete s[$zcg._ZUID];var l=function(){Chat.create(s.join(","),"nim","",void 0,"one_newchat")};$Util.showChatAddMemberAlert(r,e,o,l)}},parseEditor:function(e){for(var t=$WC.DivEditor.getNodes(e),i=0,a=t.length,s=[],n="",r="",o="contact",l=!1;a>i;i++)if(t[i].nodeType===Node.TEXT_NODE)n+=t[i].nodeValue;else{var c=t[i].getAttribute("nodetype");if("#"===c)l=!0,r=t[i].getAttribute("title");else if("@"===c){s.push(t[i].getAttribute("uid"));var d=t[i].getAttribute("elemtype");d&&(o=d)}else n+=":"===c?Composer.getSmileyCode(t[i]):"BR"===t[i].tagName?"\n":$(t[i]).text()}n=$WC.DivEditor.removeBufferCharacters(n),n=$.trim(n);var u={};return u.msg=n,u.ulist=s,u.ulisttype=o,u.title=r,u.topic=l,u},getDnameForChatTitle:function(e){var t="";return t=e===WmsImpl.getZuid()?WmsImpl.getNickName():$WC.$CUtil.decodeHTMLEntities(Users.getName(e)),t=t.split(" ")[0],t.substring(0,30)},select:function(e,t,i,a){var s,n="\xa0";if("+"===i)s=Composer.createMentionMemberNode(t,i);else if("-"===i){var r=e.getAttribute("rule");if(r.startsWith("/")){if("commandsdropdown"===t.getAttribute("elemtype"))return void CommandSuggestions.handleEnter(a,t);s=document.createTextNode(t.getAttribute("optionname"))}else s=Composer.createMentionMemberNode(t,i,a)}else if("@"===i||"cc:"===i||"cc:@"===i||"#"===i)s=Composer.createMentionMemberNode(t,i,a);else if(":"===i)s=Composer.createSmileyNode(t);else if("/"===i)e.setAttribute("commandid",t.getAttribute("commandid")),s=Composer.createShortCutNode(t);else if(""===i)return void CommandSuggestions.handleEnter(a,t);$WC.DivEditor.insertSelection(e,i,s),$WC.DivEditor.insertText(e.id,n)},createShortCutNode:function(e){return document.createTextNode(e.getAttribute("shortcut"))},createMentionMemberNode:function(e,t,i){var a=e.getAttribute("uid"),s=e.getAttribute("elemtype"),n=e.getAttribute("data-val");return Composer.getCreatedMentionMemberNode(a,s,t,i,n)},getCreatedMentionMemberNode:function(e,t,i,a,s){var n=document.createElement("SPAN"),r="";if(n.setAttribute("uid",e),n.setAttribute("elemtype",t),n.setAttribute("contenteditable",!1),n.setAttribute("class","selusr"),n.setAttribute("nodetype",i),"contact"===t){var s;"-"===i||"@"===i||"cc:"===i||"cc:@"===i?s=ChatUI.isParticipantExist(a,e)?ChatUI.getParticipantName(a,e):Users.getName(e,s):"+"===i&&(s=Users.getName(e,s)),r=i+s}else"group"===t?r=i+Groups.getDisplayName(e):"channel"===t?r=Channels.getMentionName(e,a,""):Mentions.isSpecialMentionElemType(t)&&(r=i+s,n.classList.add("aT"+t+"-node"));return n.innerHTML=$WC.$CUtil.processXSS(r),n.setAttribute("title",$WC.$CUtil.decodeHTMLEntities(r)),n.setAttribute("data-title",$WC.$CUtil.decodeHTMLEntities(r)),n},createChatTitleNode:function(e){var t=(e.getAttribute("uid"),e.getAttribute("elemtype")),i=e.getAttribute("title"),a=document.createElement("SPAN");return a.setAttribute("title",i),a.setAttribute("data-title",i),a.setAttribute("elemtype",t),a.setAttribute("contenteditable",!1),a.setAttribute("class","selusr"),a.setAttribute("nodetype","#"),a.textContent="#"+i,a},getMention:function(e){var t=e.getAttribute("uid"),i=$(e).text();i=i.substring(1);var a,s=e.getAttribute("elemtype");if(a="contact"===s||"user"===s?Contacts.isBot(t)?Mentions.BotMention:Mentions.UserMention:"available"===s?Mentions.AvailableMention:"participantsmention"===s?Mentions.ParticipantsMention:"group"===s?Mentions.GroupMention:Mentions.ChannelMention,$zcg._ISNEWMENTION_FORMAT_ENABLED){var n=new $NewMention(null,i,a,t);return n.mentionmsg}return"{mention:"+t+":"+a+":"+i+":mention} "},wrapMentionMessage:function(e){return MsgUtil.isNewMentionMsg(e)?e:$WC.Matcher.replaceWithFlag("zcatmention",e,"g",Composer.getWrappedMention)},getWrappedMention:function(e,t){var i=t.split(":"),a=i.splice(2).join(":");return'<div prop="mention" style="display:none">'+e+'</div><span prop="dname">@'+a+": </span>"},getTextMessage:function(e,t){for(var i="",a=$WC.DivEditor.getNodes(e),s=0,n=a.length;n>s;s++)a[s].nodeType===Node.TEXT_NODE&&(i+=a[s].nodeValue);return i=$WC.DivEditor.removeBufferCharacters(i),t?i:$.trim(i)},handleSmileyInsertion:function(e,t,i){{var a=t.getAttribute("code");Smiley.isAnimatedEmoji(a)}Composer.selectSmiley(i,t),Smiley.updateRecentSmiley(a,$(t).parents("[data-purpose]").attr("data-purpose")),e.metaKey||e.ctrlKey||Clickoutside.handleClickOnChild(e)},selectSmiley:function(e,t){var i=Composer.createSmileyNode(t);$WC.DivEditor.insertObject(e,$("#"+e)[0],i)},createSmileyNode:function(e){var t=e.getAttribute("code"),i=document.createElement("EM"),a=(e.innerhtml,e.getAttribute("unicode"));return i.setAttribute("code",t),a?(i.setAttribute("nodetype","text"),i.setAttribute("elemtype","emoji"),i.innerHTML=a,i):(i.setAttribute("title",t),i.setAttribute("nodetype",":"),i.setAttribute("class",Smiley.getSmileyData(t).classname),i)},getSmileyCode:function(e){return" "+e.getAttribute("code")+" "},hasCommandRule:function(e){var t="composer"+e,i=$("#"+t);return rulecatagory=i.attr("rule"),rulecatagory.startsWith("/")},hasMessage:function(e){var t=$WC.DivEditor.getInsertedNodes(e),i=t.length,a=Composer.getTextMessage(e);return $Util.Browser.isFirefox()&&1===i&&"BR"===t[0].tagName&&!a?!1:i||a},hasReplyWindow:function(e){var t=document.getElementById("msgoptionspreview"+e);return"block"===t.style.display},getSelectedList:function(e,t){for(var i=$WC.DivEditor.getInsertedNodes(e),a=i.length,s=0,n=[],r=null;a>s;s++)null!=t?(r=i[s].getAttribute("uid"))&&i[s].getAttribute("nodetype")===t&&n.push(r):(r=i[s].getAttribute("uid"))&&n.push(r);return n},isCreatingGroupChat:function(e){var t=$WC.DivEditor.getInsertedNodes(e),i=0,a=t.length;if(a)for(;a>i;i++)if("group"===t[i].getAttribute("elemtype"))return!0},hasSelectedList:function(e){var t=$WC.DivEditor.getInsertedNodes(e),i=0,a=t.length;if(a)for(var s;a>i;i++)if(s=t[i].getAttribute("elemtype"),"group"===s||"contact"===s)return!0},hasTitle:function(e){var t=$WC.DivEditor.getInsertedNodes(e),i=0,a=t.length,s=!1;if(a)for(;a>i;i++)if("#"===t[i].getAttribute("nodetype")){s=!0;break}return s},getTitleAutoCompleteHTML:function(e,t){e=$WC.$CUtil.processXSS(e);for(var i=e.split(" "),a=i.length-1,s="",n="",r=0;a>=0&&(!i[a]||(n=i.slice(0,a+1).join(" "),s+=this.searchtitlehtml.replace(/{TITLE}/g,$WC.Matcher.replace("escapeReplacementString",n)).replace(/{TITLEVAL}/g,$WC.Matcher.replace("escapeReplacementString",Resource.getRealValue("common.atmentions.settitle",["<b>"+n+"</b>"]))),t!==++r));a--);return s},getMessageData:function(e){for(var t={},i=e.id,a=getChidFromComposerId(i),s=$WC.DivEditor.getNodes(e),n=s.length,r="",o=0;n>o;o++)if(s[o].nodeType===Node.TEXT_NODE)r+=s[o].nodeValue;else{var l=s[o].getAttribute("nodetype"),c=s[o].getAttribute("elemtype");if(Composer.isMentionTrigger(l,c))r+=Composer.getMention.call(this,s[o]);else if(":"===l)r+=Composer.getSmileyCode(s[o]);else if("+"===l){var d=s[o].getAttribute("uid"),u=$(s[o]).text().substring(1),l=s[o].getAttribute("elemtype"),m="contact"===l?1:"group"===l?2:3;r+="{addchatmember:"+d+":"+m+":"+u+":addchatmember}"}else if("-"===l){var d=s[o].getAttribute("uid"),u=$(s[o]).text().substring(1),l=s[o].getAttribute("elemtype"),m="contact"===l?1:"group"===l?2:3;r+="{deletechatmember:"+d+":"+m+":"+u+":deletechatmember}"}else r+="BR"===s[o].tagName?"\n":$(s[o]).text()}r=$.trim($WC.DivEditor.removeBufferCharacters(r));var p=Commands.getCommandId(r,this.chid);!$WC.$CUtil.isEmpty(p)&&Commands.isDefaultCommand(p)&&p!=CommandsUtil.MAIL_COMMAND&&p!=CommandsUtil.REMIND_COMMAND&&(r=plainText,t.commandid=p);var h,g,f=$("#msgoptionspreview"+a);return"none"!==f.css("display")&&(g=f.attr("msguid"),h=g.slice(g.indexOf("_")+1),t.repliedmsguid=g,t.repliedmsgtime=h),t.message=r,t}};var ReminderConstants={};ReminderConstants={categories:{MINE:"mine",MINE_COMPLETED:"mine-completed",OTHERS:"others",OTHERS_COMPLETED:"others-completed",ALL:"all"},NEWLY_ADDED:"newlyadded",HOVER_ADD_MEMBERS_OFFSET:200,CONTENT_MAX_LENGTH:512,MAX_USER_COUNT:10,ALLOWED_TRIGGERS:["@","#"],TIME_FILTERS:{0:"none",1:"today",2:"tomorrow",3:"week",4:"month"},TIME_FILTER_CONSTANTS:{none:0,today:1,tomorrow:2,week:3,month:4}};var $ReminderList=function(e,t){this.category=e,this.listId="#"+e+"-remlist",this.timeFilter=parseInt(t),this.compact=!1,this.completed=!1;var i=this.getFilterText()+"_"+this.completed,a={},s={},n={};this.updateToken=function(){i=this.getFilterText()+"_"+this.completed,a.hasOwnProperty(i)||(a[i]=[]),a.hasOwnProperty(ReminderConstants.NEWLY_ADDED)||(a[ReminderConstants.NEWLY_ADDED]=[])},this.getCache=function(e){return a[e?e:i]},this.getCaches=function(){return a},this.getNextSetToken=function(e){return s[e?e:i]},this._getPageReference=function(e){return n[e]},this.updateCache=function(e,t){var r=Reminders.getObject(e[e.length-1]);n[i]="undefined"!=typeof r?{id:e[e.length-1],time:-1!=r.time?r.time:0}:{id:0,time:0},a[i]=a[i].concat(e),s[i]=t},this.updateCaches=function(e){a=e}};$ReminderList.prototype={getElement:function(){return $("#remrhscnt").find(this.listId)},getFilter:function(){return this.timeFilter},getFilterText:function(){return ReminderConstants.TIME_FILTERS[this.timeFilter]},getCategory:function(){return this.category+(this.isCompleted()?"-completed":"")},setFilter:function(e){this.timeFilter=parseInt(e),this.updateToken()},toggleView:function(){this.compact=!this.compact},isCompact:function(){return this.compact},toggleCompleted:function(){this.completed=!this.completed,this.updateToken()},isCompleted:function(){return this.completed},getReminders:function(e){var t=[],i=e?this.getCache(ReminderConstants.NEWLY_ADDED):this.getCache(),a=$DB.get("reminders"),s=this.getCache(ReminderConstants.NEWLY_ADDED);for(var n in i)(Reminders.lists[Reminders.currentList].getFilter()||-1==s.indexOf(i[n])||e)&&t.push(a[i[n]]);return t},refreshCategory:function(){RemindersUI.handle.refreshHTML({next_set_token:this.getNextSetToken(),category:this.getCategory(),list:this.getReminders()})},startLoadingState:function(){var e=this.getElement();e.find("#zcreminderloading").length||(Reminders.isLoadingNow=!0,e.append('<div id="zcreminderloading" class="zcldng"></div>'),e.css("opacity",.33))},endLoadingState:function(){var e=this.getElement();Reminders.isLoadingNow=!1,e.removeAttr("style"),e.find("#zcreminderloading").remove()},deleteReminders:function(e){e=$.extend([],e);for(var t in e)this.handleDelete(e[t].toString()),delete $DB.get("reminders")[e[t]]},loadMoreReminders:function(e){function t(t){"function"==typeof e&&e(t)}var i=this.getElement(),a=this.getNextSetToken();if(ZCScroll.isScrollDown(i[0])&&!Reminders.isTimerOn&&a&&-1!=a){i.append('<div id="loadmore" class="hstrset"><div class="hst-lodngmn"><div class="hst-lodngsb">'+Resource.getRealValue("common.loading")+'<span class="hst-loadng"></span></div></div></div>'),Reminders.isTimerOn=!0;var s=i.attr("category");Reminders.get({category:s,nextSetToken:a},{},function(e){i.find("#loadmore").remove(),e.isCompact=i.hasClass("remcompact")?!0:!1,Reminders.lists[Reminders.currentList].refreshCategory(),Reminders.isTimerOn=!1,t(!0)},function(){i.find("#loadmore").remove(),Reminders.isTimerOn=!1,t()},!0)}else t()},handleModify:function(e){this.handleDelete(e),this.handleChange(e)},handleDelete:function(e){var t=this.getCaches();for(var i in t)t[i].removeElement(e);this.updateCaches(t)},handleCreate:function(e){var t=this.getCaches();t[ReminderConstants.NEWLY_ADDED]=t[ReminderConstants.NEWLY_ADDED].concat(e),this.updateCaches(t),this.handleChange(e,t)},handleChange:function(e){var t=Reminders.getObject(e),i=this.getCaches(),a=Reminders.isCompleted(t).toString();for(var s in i){var n=ReminderConstants.TIME_FILTER_CONSTANTS[s.split("_")[0]],r=s.split("_")[1],o=RemindersUtil.getTimeFilter(n);a===r&&(0==n||o.fromtime<=t.time&&t.time<=o.totime)&&(i[s]=this.checkAndInsertInPosition(i[s],this.getNextSetToken(s),t,s))}this.updateCaches(i)},checkAndInsertInPosition:function(e,t,i,a){var s=this._getPageReference(a);for(var n in e){n=parseInt(n);var r=Reminders.getObject(e[n]),o=Reminders.getObject(e[n+1]);if(r.time<i.time){if(o&&(i.time<o.time||"undefined"==typeof o.time)||n==e.length&&"-1"==t){e.insert(n+1,i.id);break}}else if(r.time>i.time){e.insert(n,i.id);break}}return(!e.length||"-1"==t||i.time<s.time||i.id<=s.id&&-1==s.time)&&-1==e.indexOf(i.id)&&e.push(i.id),e}};var RemindersUI={},Reminders={};RemindersUI={remAddHTML:'<div id="remaddcnt" class="remaddcnt flexC"><div id="reminputarea" class="reminputarea"><div id="addreminderinput" content="" data-gramm="false" class="addreminput" contenteditable="true" reminderbutton purpose="closeSettingsMenu" type="text" data-text="{{placeholder}}">{{content}}</div></div><div id="remsettings" class="remsettings reminfocnt hide"><div remsetting class="remsettime-quickadd remset-icon msi-remtimeicon" id="newremsettime" reminderbutton purpose="newRemSetTime"><span reminderbutton purpose="clearSetValue" class="msi-close cur remset-close"></span></div><div remsetting class="remaddparticipants-quickadd msi-rematicon remset-icon" id="addparticipants" reminderbutton purpose="addMember"><span reminderbutton purpose="clearSetValue" class="msi-close cur remset-close"></span></div></div></div>',rhsHTML:'<div id="remrhscnt" class="remrhscnt {{category}}"><div class="remrhsheader"><div class="padd15 font20 clrE6">'+Resource.getRealValue("reminders.title")+'<span class="msi-closeicon floatr cur" reminderbutton purpose="closeRhs"></span></div><span class="remheadicon msi-reminder"></span><div class="remtabs"><span id="myremtab" reminderbutton category="mine" purpose="switchTab" currenttab="false" loaded="false" class="{{ismine}}">'+Resource.getRealValue("reminders.header.mine")+'</span><span id="othersremtab" reminderbutton category="others" purpose="switchTab" currenttab="false" loaded="false" class="{{isothers}}">'+Resource.getRealValue("reminders.header.others")+'</span></div></div><div class="remrhsmain">{{rem_add_html}}<div id="myremlist" class="myremlst"><div id="mine-remlist" reminderlist class="h100 posrel" category="mine" filter="0"></div><div filtermenu>{{bottom_menu_html}}</div></div><div id="othersremlist" class="othrremlst"><div id="others-remlist" reminderlist class="h100 posrel" category="others" filter="0"></div></div></div></div><div id="reminderhover" class="remhover"></div>',onboardingHTML:'<div class="rem-help-page"><img src="'+$Util.getImgStaticUrl()+'/default/reminder-illustration.svg" class="rem-illus-img"><div class="rem-help-con"><div class="rem-help-title">{{onboard_howto}}</div><div class="rem-help-list dflx"><span class="reb-box-25">T</span>{{onboard_stepone}}</div><div class="rem-help-list dflx"><span class="reb-box-25 msi-remtimeicon"></span>{{onboard_steptwo}}</div><div class="rem-help-list dflx"><span class="reb-box-25 msi-rematicon"></span>{{onboard_stepthree}}</div><div class="rem-help-list mrgL40">{{onboard_footer}}  '+Smiley.replace(":fireworks:")+'</div><span class="rem-help-illus msi-question"></span></div></div>',tourHTML:'<div class="rem-tour-wrp"><div class="rem-tour-lhs"><div id="remTourAnim" class="rem-tour-anim"><img src="'+$Util.getImgStaticUrl()+'/default/clock-icon.svg" class="rem-clock-img"><div class="rem-tour-screen"><div class="rem-tour-screen-wrp"><div class="rem-tour-featr rem-tour-featr1">{{tour_set}}</div><div class="rem-tour-featr rem-tour-featr2">{{tour_assign}}</div><div class="rem-tour-featr rem-tour-featr3">{{tour_snooze}}</div><div class="rem-tour-featr rem-tour-featr4">{{tour_complete}}</div></div></div></div><div class="rem-tour-txt font14 text-transU">{{tour_header}}</div></div><div class="rem-tour-rhs flexG"><div class="font18 clr4A fontb">{{tour_title}}</div><div class="clr9 font14 mrgT5">{{tour_content}}</div><span class="rem-tour-btn" reminderbutton category="mine" purpose="getAndShowInRHS">{{tour_cta}}</span></div></div>',bottomMenuHTML:'<div class="zc-nav-switch rem-nav-switch"><div remfilterbtn action="toggleCompletedReminders" class="ns-item msi-complete" title="{{completed_tip}}"></div><div remfilterbtn action="toggleCompactMode" class="ns-item msi-remviewnormal" title="{{view_tip}}"></div><div remfilterbtn action="openFilterMenu" class="ns-item msi-listfilter"><ul filtermenudropdown class="dropdwncnt ps-container"><li remfilterbtn action="changeFilter" option="1">{{opt_1}}</li><li remfilterbtn action="changeFilter" option="2">{{opt_2}}</li><li remfilterbtn action="changeFilter" option="3">{{opt_3}}</li><li remfilterbtn action="changeFilter" option="4">{{opt_4}}</li><li remfilterbtn action="changeFilter" option="0">{{opt_5}}</li></ul></div></div>',createCardHTML:'<div class="remcreatecnt"><div><div class="flexC font14 clrG"><span class="sml-dot mrgR10"></span><span class"ellips">{{header_hint}}</span></div><div class="font15 mTB10 pL15">{{content}}</div>{{time_html}}{{members_html}}</div>{{tip}}</div>',listHTML:'<div id="{{id}}" class="remcnt {{class_name}} {{time_class}}" {{info_attribute}} purpose="getInfo" remid="{{id}}"><div class="remcontentcnt flexC"><span class="remcheck fshrink {{completed_class}}" title="{{completed_tooltip}}" remid="{{id}}" {{attribute}} purpose={{purpose}}></span><div id="remlstcontent{{id}}" remid="{{id}}" class="ellips rmcontent flexG font15 {{strike_class}}">{{content}}</div>{{open_msg_html}}</div><div id="remtimecnt{{id}}" class="ellips mrgT10 {{hide}} flexC mrgL20">{{time_html}}<span class="{{assign_class}} ellips flexC clr8"><span class="ellips clr0" title="{{assign_header}}">{{assign_content}}</span></span></div></div>',compactListHTML:'<div id="{{id}}" class="remcnt {{class_name}} {{time_class}}" {{info_attribute}} purpose="getInfo" remid="{{id}}"><div class="remcontentcnt flexC"><span class="remcheck fshrink {{completed_class}}" title="{{completed_tooltip}}" remid="{{id}}" {{attribute}} purpose={{purpose}}></span><div id="remlstcontent{{id}}" remid="{{id}}" class="ellips rmcontent flexG font15 paddR10">{{content}}</div><div id="remtimecnt{{id}}" class="ellips remtimecnt flexC fshrink">{{time_html}}</div>{{open_msg_html}}</div></div>',infoHTML:'<div id="reminfocnt" class="reminfocnt" remid="{{id}}"><div id="reminfocntarrw" class="reminfocntarrw"></div><div class="{{edit_class}}"><div class="m15 posl"><div id="remcontent{{id}}" class="remcontent" remid="{{id}}" {{edit_attribute}} time="{{time}}" purpose="editContent">{{content}}</div></div><div class="m15 posl"><span id="remtime{{id}}" class="msi-reminder dIB remtimeinfo {{expired_class}}" remid="{{id}}" {{edit_attribute}} purpose="editTime" time="{{time}}">{{time_text}}</span></div>{{members_html}}</div><div class="reminfobtncnt flexC"><div class="reminfobtn remclear ellips" remid="{{id}}" reminderbutton purpose="delete">'+Resource.getRealValue("common.delete")+"</div>{{button_html}}</div></div>",errorCardHTML:'<div id="remerrorcnt" class="dflxjustcent h100 flx-dirC txtcent"><div><div class="remicon msi-reminder"></div><div class="mrgT10 font15 clr6">{{error_content}}</div></div><div class="mrgT20 font14 clr8">{{footer}}</div></div>',msgOptionHTML:'<div class="zcf-setrem zcapopt"><span class="ellips wid80 dIB">'+Resource.getRealValue("common.set.reminder")+'</span><span class="msi-rightarr bold posa"></span><div class="zchmorhov"><div class="drpdwn srchglt"><div class="posrel height100"><div id="defaulttime_{{chid}}_{{time}}" {{attributes}} class="zctext ellips {{class_name}}" parsedtime="true" purpose="setReminder">{{parsed_time}}</div><div reminderbutton purpose="setReminder" time="900000" class="zctext ellips">'+Resource.getRealValue("common.small.15minutes")+'</div><div reminderbutton purpose="setReminder" time="3600000" class="zctext ellips">'+Resource.getRealValue("event.reminder.1hour")+'</div><div reminderbutton purpose="setReminder" time="86400000" class="zctext ellips">'+Resource.getRealValue("event.reminder.1day")+'</div><div id="parsedtime_{{chid}}_{{time}}" time={{custom_time}} reminderbutton purpose="setCustomDate" class="zctext ellips">'+Resource.getRealValue("reminders.set.customtime")+"</div></div></div></div></div>",calendarHTML:'<div id="remsettimecnt" class="remsettimecnt"><div class="remdatetime flexC"><div class="bold fshrink mrgR15">'+Resource.getRealValue("common.date")+'</div><div id="remdatecnt" class="datecnt flexG ellips" reminderbutton><div id="remdate" class="zccrin reminputbox ellips">{{date}}</div></div></div><div id="remindercalendarcnt" val="{{date_value}}" class="remcalcnt"></div><div class="remdatetime flexC"><div class="bold fshrink mrgR15">'+Resource.getRealValue("common.time")+'</div><div class="timecnt flexG flexC fjustifySB"><div class="remtime flexC"><input remtimeinput id="remhrinp" reminderinput hours maxlength="2" value="{{hour}}"/><span>:</span><input remtimeinput id="remmininp" reminderinput minutes value="{{minute}}" maxlength="2"/></div><div id="remperiod" class="remperiod flexC {{period_class}}"><div id="remambutton" reminderbutton purpose="togglePeriod" val="am">'+Resource.getRealValue("scheduler.period.AM")+'</div><div id="rempmbutton" reminderbutton purpose="togglePeriod" val="pm">'+Resource.getRealValue("scheduler.period.PM")+"</div></div></div></div>{{save_html}}</div>",addParticipantsHTML:'<div id="{{search_entity}}" class="addparticipants zcrchmcnt"><div class="zccrin reminputbox"><div id="{{search_entity}}-search-field" class="remsrchfield" contenteditable="true" type="text" name="" data-text="{{searchpholder}}"></div></div><div id="{{search_entity}}-results" class="rem-drpdwn-cnt"><div id="{{search_entity}}-list" class="posl zcht100"></div></div><div class="crchndcnt crchndcnt-edit dN" id="selremparticipants"><div id="usernodecnt" class="zcrchicnt"><div id="{{search_entity}}-select-field" class="floatl"></div></div><div id="saveAddedParticipants" {{module}} purpose="{{purpose}}" class="windwbtn dIB cur">{{create}}</div></div></div>',remParticipantsSearchHTML:'<div uid="{USERID}" elemtype="contact" purpose="search" data-val="{DNAME}" class="zcrtchtcontct remcontact flexC font13"><div class="list-img posl"><img src="{IMGURL}"><div class="{STATUSCLASS}"></div></div><div class="ellips list-cnt mrgL10"><div class="ellips dflx">{DNAMEVAL}</div><div class="ellips clr6">{EMAILID}</div></div></div>',remChatHistoryHTML:'<div id="{CHID}" remchat elemtype="chat" purpose="search" chid="{CHID}" username="{TITLENAME}" class="zcrtchtcontct remcontact flexC">{CHATIMAGE}<div class="ellips mrgL10"><div class="ellips chattitle">{TITLENAME}</div></div></div>',remChannelsHTML:'<div id="{CHID}" remchat elemtype="chat" purpose="search" chid="{CHID}" class="zcrtchtcontct cur remcontact flexC"><div class="list-img">{IMG}</div><div class="ellips mrgL10"><div class="ellips chattitle">{DNAMEVAL}</div></div></div>',imgNodeHTML:'<div uid="{{uid}}" elemtype="{{type}}" {{remchat}} title="{{name}}" username="{{name}}" nodetype="@" class="dIB zcricnt posl">{{image}}{{remove_html}}</div>',removeImgNodeHTML:'<div class="msi-close posa dN cur" reminderbutton purpose="removeSelectedUser"></div>',bindEvents:function(){var e=$(document);e.on("click","[reminderbutton],[remfilterbtn]",function(e){var t=$(this);e.stopPropagation();var i=t.attr("purpose"),a=t.attr("action");t.is("[reminderbutton]")&&"function"==typeof RemindersUI.handle[i]?(RemindersUI.handle[i](t,e),$("[filtermenu]").find("[filtermenudropdown]").hide()):"function"!=typeof RemindersUI.filter[a]||t.hasClass("remdisable")||Reminders.showTour||RemindersUI.filter[a](t,e)}),e.on("focus keydown","[reminderbutton]",function(e){var t=e.which;t&&t===$zcg.ENTER_KEYCODE&&(e.preventDefault(),e.shiftKey||("addreminderinput"===this.id?$(this).is("[dropdown]")?RemindersUI.handle.atMentionSelect(e):RemindersUI.handle.addReminder():Clickoutside.handleClickOnChild(e))),$Dom.limitInput("#"+this.id)}),e.on("keyup focusout","[reminderinput]",function(e){var t=$(this);if(RemindersUtil.checkIfTimeIsValid(t),"focusout"==e.type){var i=$Date.append0(parseInt(t.val()));i=isNaN(i)?"":i,t.val(i)}}),e.on("keydown","[reminderinput]",function(e){var t=$(this),i=parseInt(t.val()),a=e.which,s=RemindersUtil.getLimits(t);RemindersUtil.checkIfTimeIsValid(t),a==$zcg.UP_KEYCODE?t.val(RemindersUI.handleUpKey(i,s)):a==$zcg.DOWN_KEYCODE&&t.val(RemindersUI.handleDownKey(i,s))}),e.on("click","[reminderinput]",function(){$(this).select()})},initInputField:function(){$WC.DivEditor.initEditor("addreminderinput",{handleKeyUp:RemindersUI.inputHandle.keyUp,handleKeyDown:RemindersUI.inputHandle.keyDown})},inputHandle:{keyUp:function(e,t){var i=$("#addreminderinput"),a=i.is("[dropdown]"),s=t.which;if(s===$zcg.ESCAPE_KEYCODE&&$WC.$CUtil.isEmpty(Composer.getPlainTextFromComposer("addreminderinput"))&&$WC.$Win.destroy("addreminderwin"),s!==$zcg.UP_KEYCODE&&s!==$zcg.DOWN_KEYCODE||!a)if(s===$zcg.ESCAPE_KEYCODE)if(t.stopPropagation(),a)i.removeAttr("dropdown"),i.siblings("#reminder-addparticipants").remove(),Clickoutside.clear("reminder-addparticipants");else{var n=$WC.DivEditor.getNodes("addreminderinput");!n.length||$WC.$CUtil.isEmpty($WC.DivEditor.removeBufferCharacters(n[0].nodeValue))?(delete Reminders.isFromMsgAction,$WC.$Win.destroy("addreminderwin"),Clickoutside.handleEscape(t)):$WC.DivEditor.clear("addreminderinput")}else RemindersUI.handle.dropdownActions(i);else t.stopPropagation(),DropdownUtil.handleListNavigation(t,$("#reminder-addparticipants-list"),'[purpose="search"]')},keyDown:function(e,t){var i=t.which;(i==$zcg.UP_KEYCODE||i==$zcg.DOWN_KEYCODE)&&t.preventDefault()}},handleUpKey:function(e,t){return $Date.append0(e<t[1]?e+1:t[0])},handleDownKey:function(e,t){return $Date.append0(e>t[0]?e-1:t[1])},bindScrollEvent:function(){$("[reminderlist]").on("scroll",function(){RemindersUI.hideHover(),Reminders.lists[Reminders.currentList].loadMoreReminders()})},updateScroll:function(e,t){var i=$("#"+e);i.length&&($Util.scrollToView(i,t,500),this.highlightReminder(i))},highlightReminder:function(e){e.cssAnimation("zctit_blink")},getRhsTempHTML:function(){var e=$WC.template.replace(RemindersUI.remAddHTML,{content:"",$placeholder:"reminders.new.add"});return $("<div>").html($WC.template.replace(RemindersUI.rhsHTML,{rem_add_html:e,bottom_menu_html:$WC.template.replace(RemindersUI.bottomMenuHTML,{$completed_tip:"reminders.show.completed",$view_tip:"reminders.view.classic",$opt_1:RemindersUI.filterText[1],$opt_2:RemindersUI.filterText[2],$opt_3:RemindersUI.filterText[3],$opt_4:RemindersUI.filterText[4],$opt_5:RemindersUI.filterText[0]}),ismine:"mine"==Reminders.currentList?"remcurtab":"",isothers:"others"==Reminders.currentList?"remcurtab":"",category:Reminders.currentList},"InSecureHTML"))},getOnboardingHTML:function(){return $WC.template.replace(RemindersUI.onboardingHTML,{$onboard_howto:"reminders.onboarding.howtoset",$onboard_stepone:"reminders.onboarding.stepone",$onboard_steptwo:"reminders.onboarding.steptwo",$onboard_stepthree:"reminders.onboarding.stepthree",$onboard_footer:"reminders.onboarding.footer"})},getTourHTML:function(){return $WC.template.replace(RemindersUI.tourHTML,{$tour_set:"reminders.tour.set",$tour_assign:"reminders.tour.assign",$tour_snooze:"reminders.tour.snooze",$tour_complete:"reminders.tour.complete",$tour_header:"reminders.title",$tour_title:"reminders.tour.title",$tour_content:"reminders.tour.content",$tour_cta:"reminders.tour.cta"})},removeFromList:function(e){var t=e.parents("[reminderlist]");e.prev().is("[remtimeheader]")&&!e.next().is("[reminderbutton]")&&e.prev().slideUp(500,function(){$(this).remove()}),e.slideUp(500,function(){$(this).remove(),RemindersUI.checkIfListIsEmpty(t),ZCScroll.updateScroll(t)}),RemindersUI.hideHover(),Reminders.lists[Reminders.currentList].loadMoreReminders()},checkIfListIsEmpty:function(e){if(Reminders.lists[Reminders.currentList].getCache(ReminderConstants.NEWLY_ADDED).length||$("[recentheader]").slideUp(500,function(){$(this).remove()}),!e.find("[purpose=getInfo]").length){var t=Reminders.lists[Reminders.currentList],i=t.getCategory();i+=t.getFilter()?"."+t.getFilterText():"",e.html($WC.template.replace(this.errorCardHTML,{footer:"",$error_content:"reminders."+i+".none"}))}},addDatePicker:function(e,t){e.DatePicker({flat:!0,format:"m/d/Y",date:t,current:t,starts:0,onChange:function(t){e.attr("val",t),e.parent().find("#remdate").html(t)}})},getCardHTML:function(e){var t="reminders.new.hint",i="",a="",s="";"undefined"!=typeof e.users&&Reminders.isAssignedToMe(e.users)?s=$WC.template.replace('<div class="remtip clr6 font14">{{text}}</div>',{$text:["reminders.tip",Commands.getObject(CommandsUtil.REMINDERS_COMMAND).name]}):"undefined"!=typeof e.chats?(i=this.getMemberHtml(e.chats,"chat"),t="reminders.chats.hint",a=e.chats.length):"undefined"!=typeof e.users&&(i=this.getMemberHtml(e.users,"user"),t="reminders.users.hint",a=e.users.length);var n=e.time>-1?$WC.template.replace('<span class="remtimeinfo dIB msi-reminder {{expired_class}}">{{time}} | {{date}}</span>',{date:$Date.day(e.time,{shortday:!0,shortmonth:!0,shorten:!0,datesuffix:!0}),time:$Date.time(e.time),expired_class:e.time<$Util.getSyncedCurrentTime()?"remexp":""},"InSecureHTML"):"";return $WC.template.replace(this.createCardHTML,{content:MsgTemplate.getDisplayContent({msg:e.content}),members_html:i,tip:s,time_html:n,$header_hint:[t,a]},"InSecureHTML")},getMemberHtml:function(e,t,i){var a="",s=$WC.template.replace('<div class="remmember {{completed_class}}"><div class="remmember-item">{{img_html}}{{remove_user_html}}</div>{{status_html}}{{remind_html}}</div>',{status_html:i?'<span class="remstatus">{{text}}</span>':""},"InSecureHTML"),n="",r=!0;1===e.length&&(r=!1);for(var o in e){var l,c=s,d="",u="",m='<img elemtype="{{type}}" title="{{name}}" hover={{hover}} uid="{{id}}" src="{{src}}">';i&&(l=e[o].completed,d=l?"cmp":"incmp",c=$WC.template.replace(c,{$text:l?"reminders.completed":"reminders.incomplete"}));var p,h={};if("user"===t)p=e[o].id,h.id=p,h.src=Users.getImgUrlById(p),h.name=Users.getName(p,e[o].name),h.hover=!0,h.type=t,u=i?'<span reminderbutton purpose="notifyAssignee" class="reremind zc-link">'+(l?"":Resource.getRealValue("reminders.action.remind"))+"</span>":"";else{p=e[o].chat_id,h=RemindersUtil.getChatDetails(p);var g=e[o].other_participant;"undefined"!=typeof g&&(h.imgurl=Users.getImgUrlById(g)),$.extend(h,{id:p,src:h.imgurl}),h.hover="channel"===h.type?!1:!0}m=h.img?h.img:$WC.template.replace(m,h);var f="";r&&(f="user"===t?'<span remuserid="{{remuserid}}" reminderbutton purpose="deleteMember" class="msi-close remset-close"></span>':""),$WC.$CUtil.isEmpty(f)||(f=$WC.template.replace(f,{remuserid:p})),c=$WC.template.replace(c,{remove_user_html:f,remind_html:u,img_html:"channel"==h.type?ChannelsUI.getImage(Channels.getByChid(h.id).oc_id):m},"InSecureHTML"),$.extend(h,{completed_class:d}),a+=$WC.template.replace(c,h),h={}}return"user"===t&&e.length<ReminderConstants.MAX_USER_COUNT&&(n='<div id="addremmembers" reminderbutton purpose="addMoreMembers" class="msi-add remmember-item addremmember"></div>'),$WC.template.replace('<div class="m15"><div class="font16">{{header}}:</div><div id="remmembers" class="mrgT15 dflx flexW">{{members}}{{add_member}}</div></div>',{$header:"reminders.title.members",members:a,add_member:n},"InSecureHTML")},getListCardHTML:function(e){var t=e.list;if(!t.length){var i=$WC.template.replace(this.errorCardHTML,{footer:'<div class="rembtn" reminderbutton category="others" purpose="getAndShowInRHS">{{text}}</div>'},"InSecureHTML");return $WC.template.replace(i,{$error_content:"reminders.mine.none",$text:"reminders.view.others"})}var a=e.category;Reminders.lists[a]=new $ReminderList(a,0),Reminders.currentList=a,t.length>3&&(t=t.slice(0,3));var s=$WC.template.replace('<div class="rembtn" reminderbutton category="{{category}}" purpose="getAndShowInRHS">{{text}}</div>',{category:a,$text:"reminders.view."+a.split("-")[0]});return $WC.template.replace('<div class="remlst"><div>{{list_html}}</div>{{button_html}}</div>',{list_html:this.getListHTML(t,-1),button_html:s},"InSecureHTML")},getRHSListHTML:function(e,t){var i="",a=e.list;if(a.length)i=this.getListHTML(a,t,!0)+'<div class="remdummygrp"></div>';else{var s=e.category;s!==ReminderConstants.categories.MINE_COMPLETED||Reminders.lists[ReminderConstants.categories.MINE].getCache(ReminderConstants.TIME_FILTERS[0]+"_false").length||Reminders.lists[ReminderConstants.categories.MINE].getCache(ReminderConstants.NEWLY_ADDED).length?s!==ReminderConstants.categories.OTHERS_COMPLETED||Reminders.lists[ReminderConstants.categories.OTHERS].getCache(ReminderConstants.TIME_FILTERS[0]+"_false").length||Reminders.lists[ReminderConstants.categories.MINE].getCache(ReminderConstants.NEWLY_ADDED).length||(s=ReminderConstants.categories.OTHERS):s=ReminderConstants.categories.MINE,s+=Reminders.lists[Reminders.currentList].getFilter()?"."+Reminders.lists[Reminders.currentList].getFilterText():"",i=$WC.template.replace(this.errorCardHTML,{footer:"",$error_content:"reminders."+s+".none"})}return i},getListHTML:function(e,t,i){var a="",s='<div remtimeheader class="remgrphdr font14">{{date_identifier}}</div>';if(e.length){var n=Reminders.lists[Reminders.currentList],r='<div remfilterheader class="remgrphdr font15 flexC">{{filtertext}}{{clearhtml}}</div>',o=[0,1,2];if(-1==o.indexOf(n.getFilter()))a+=$WC.template.replace(r,{$filtertext:RemindersUI.filterText[n.getFilter()],clearhtml:""});else if(n.isCompleted()){var l=$WC.template.replace('<span class="sml-dot mLR10"></span><span class="zc-link" reminderbutton purpose="clearCompleted">{{clear}}</span>',{$clear:"common.clear"}),c=$WC.template.replace(r,{$filtertext:"reminders.completed"});c=$WC.template.replace(c,{clearhtml:l},"InSecureHTML"),a+=c}}for(var d in e){var u=e[d],m=this.getHTML(u,i);if(!n.isCompact()&&(u.time&&u.time>-1?$Date.isSameDay(t,u.time)&&"undefined"!=typeof t||(a+=(0==d?"":"</div>")+'<div listgroup class="remlistgrp">'+$WC.template.replace(s,{date_identifier:$Date.date(u.time,{withday:!0,shortmonth:!0})},"InSecureHTML")):t&&-1!=t&&(a+=(0==d?"":"</div>")+'<div listgroup class="remlistgrp">'+$WC.template.replace(s,{$date_identifier:"reminders.timeless"})),d==e.length-1)){a+=m+"</div>";break}t=u.time,a+=m}return a},getNewRemindersHTML:function(e){var t="",i=Reminders.lists[Reminders.currentList],a=i.isCompact();return i.isCompleted()||i.getFilter()||$WC.$CUtil.isEmpty(e)||(i.getElement().find("#remerrorcnt").remove(),t=(a?"":'<div recentheader><div class="remgrphdr font14">'+Resource.getRealValue("reminders.recently.added")+"</div>")+e+(a?"":"</div>")),t},getHTML:function(e,t){var i=Reminders.isAssignedToMe(e.users),a=Reminders.isCompleted(e),s=Reminders.lists[Reminders.currentList].isCompact(),n="",r="",o="";e.creator.id==$zcg._ZUID||s?"undefined"!=typeof e.users&&i||s||(n="reminders.title.members",o="msi-assignto remassigncnt",r=e.chats?e.chats.length>1?["reminders.count.chats",e.chats.length]:Channels.getName(Channels.getChannelId(e.chats[0].chat_id),e.chats[0].title):e.users.length>1?["reminders.count.users",e.users.length]:Users.getName(e.users[0].id,e.users[0].name)):(n="reminders.title.creator",r=Users.getName(e.creator.id,e.creator.name),o="msi-assignby remassigncnt");var l="";t&&e.message&&e.message.time&&e.message.time>0&&(l=$WC.template.replace('<span class="msi-ex-popout cur fshrink" title="{{title}}" remid="{{id}}" chid={{chid}} msgtime="{{msgtime}}" sender="{{sender}}" reminderbutton purpose="openMessage"></span>',{$title:"reminders.open.message",id:e.id,chid:e.message.chat_id,msgtime:e.message.time,sender:e.message.sender_id}));var c=s?this.compactListHTML:this.listHTML,d=$WC.template.replace(c,{id:e.id,$assign_header:n,$assign_content:r}),u="";u=s?$Date.relative(e.time,{shorten:!0}):$Date.time(e.time);var m=e.time>-1||!$WC.$CUtil.isEmpty(n)?"":"dN",p=e.time>-1?$WC.template.replace('<span id="remtimelst{{id}}" class="msi-reminder remtimeinfo {{expired_class}} {{margin_class}} fshrink" time="{{time}}">{{time_text}}</span>',{time:e.time,time_text:u,margin_class:Reminders.lists[Reminders.currentList].isCompact()?"":"mrgR10",id:e.id,expired_class:$Util.getSyncedCurrentTime()>e.time?"remexp":""},"InSecureHTML"):"";return d=$WC.template.replace(d,{assign_class:o,hide:m,time_class:e.time?"":"remnotime",info_attribute:t?"reminderbutton":"",class_name:i?"myrem":"othrsrem",attribute:i?"reminderbutton":"",$completed_tooltip:a?"reminders.completed":"reminders.tooltip.incomplete",purpose:a?"markAsInComplete":"markAsCompleted",completed_class:i?a?"msi-complete clrG":"msi-circle clrB":"",strike_class:a?"lineT":"",content:MsgTemplate.getDisplayContent({msg:e.content}),open_msg_html:l,time_html:p},"InSecureHTML")},getInfoHTML:function(e){var t="",i=Reminders.isAssignedToMe(e.users),a=e.creator.id==$zcg._ZUID;if(i){var s=Reminders.isCompleted(e);t=$WC.template.replace('<div id="remcmpbtn" class="reminfobtn ellips" remid="{{id}}" reminderbutton purpose="{{purpose}}">{{text}}</div>',{id:e.id,purpose:s?"markAsInComplete":"markAsCompleted",$text:s?"reminders.mark.incompleted":"reminders.mark.completed"})}var n="",r=e.time>-1?$Date.date(e.time,{withday:!0,shortmonth:!0,shortday:!0,withtime:!0}):Resource.getRealValue("reminders.set.customdate");return a?"undefined"!=typeof e.chats?n=this.getMemberHtml(e.chats,"chat",!0):"undefined"==typeof e.users||i||(n=this.getMemberHtml(e.users,"user",!0),t=$WC.template.replace('<div id="remnotifyassignees" class="reminfobtn ellips" remid="'+e.id+'" reminderbutton purpose="notifyAssignees" title="{{tooltip_content}}">{{content}}</div>',{$tooltip_content:"reminders.tooltip.notifyassignees",$content:"reminders.notify.manual"})):(n=$WC.template.replace('<div class="m15"><div class="remcontent">{{header}} :</div><div class="mrgT15 dflx flexW"><div class="remmember" title="{{name}}"><div class="remmember-item"><img class="cur" elemtype="user" hover="true" uid="{{id}}" src="{{src}}"></div></div></div></div>',{$header:"reminders.title.creator",id:e.creator.id,src:Users.getImgUrlById(""+e.creator.id),name:Users.getName(""+e.creator.id,e.creator.name)}),-1==e.time&&(r=Resource.getRealValue("reminders.timeless"))),$WC.template.replace(this.infoHTML,{id:e.id,time:e.time?e.time:-1,time_text:r,expired_class:e.time&&e.time<$Util.getSyncedCurrentTime()?"remexp":"",content:MsgTemplate.getDisplayContent({msg:e.content}),members_html:n,button_html:t,edit_class:a?"remeditcnt":"",edit_attribute:a?"reminderbutton":""},"InSecureHTML")},getErrorCardHTML:function(){var e=$WC.template.replace(this.errorCardHTML,{footer:'<div>{{try_again}}</div><div class="paddB15 mrgT5">{{hint}}</div>'},"InSecureHTML");return $WC.template.replace(e,{$error_content:"reminders.create.error",$try_again:"reminders.try.again",$hint:["reminders.create.hint",Commands.getObject(CommandsUtil.REMIND_COMMAND).name]})},getMsgOptionHTML:function(e){if(!SecurityManager.hasPermission(Modules.Reminders))return"";var t="",i=Resource.getRealValue("reminders.message.parsing"),a="dN",s=Reminders.parsedMsgIdVsTime[e.chid+"_"+e.time];"undefined"==typeof s?(Reminders.setParsedTime(e.chid,e.time),s=-1):s>0?(t='reminderbutton time="'+s+'"',a="",i=$Date.time(s)+" "+$Date.date(s,{shortmonth:!0,shortday:!0,shorten:!0})):i=Resource.getRealValue("reminders.parse.error");var n=$WC.template.replace(this.msgOptionHTML,{chid:e.chid,time:e.time,custom_time:s});return n=$WC.template.replace(n,{attributes:t,class_name:a,parsed_time:i},"InSecureHTML")},getSaveBtnHTML:function(e){return $WC.template.replace('<div class="reminfobtncnt flexC"><div reminderbutton class="reminfobtn {{otherbtn_class}}" purpose="{{otherbtn_purpose}}">{{otherbtn_name}}</div><div reminderbutton class="reminfobtn" purpose="{{save_purpose}}">{{save}}</div></div>',{otherbtn_class:e?"remclear":"remcancel",otherbtn_purpose:e?"clearTimeForNewReminder":"cancelEditTime",save_purpose:e?"saveTimeForNewReminder":"saveEditTime",$otherbtn_name:e?"common.clear":"common.cancel",$save:"common.save"})},getCalendarHTML:function(e,t){var i=this.getSaveBtnHTML(t);e=e&&e>0?e:$Util.getSyncedCurrentTime()+36e5;var a=$Date.time(e).split(" "),s=a[0].split(":"),n="AM"==a[1]?"am":"pm",r=$WC.template.replace(this.calendarHTML,{save_html:i,date:$Date.date(e,{shortmonth:!0,shortday:!0,shorten:!0}),period_class:n,period_value:n},"InSecureHTML");return $WC.template.replace(r,{date_value:$Util.getDateWithoutTime(e),hour:s[0],minute:s[1]})},insertHTMLInList:function(e,t,i){e.append(RemindersUI.getRHSListHTML(t,i));var a=t.list;i=a.length?a[a.length-1].time:-1,e.attr({nextsettoken:t.next_set_token?t.next_set_token:-1,prevremtime:i?i:0}),ZCScroll.resetScroll(e,!0)},hideHover:function(){$("#remrhscnt").find(".remsel").removeClass("remsel"),$("#reminderhover").hide().find("#reminfocnt").remove(),Clickoutside.clear("reminderhover")},setStatusAttributes:function(e,t,i){var a=$("#reminfocnt");a.attr("remid")==e&&a.find("#remcmpbtn").attr("purpose",t).text(Resource.getRealValue(i))},userSuggest:{getSearchField:function(){return $("#reminder-addparticipants-search-field")},getSuggestField:function(){return $("#reminder-addparticipants-list")},search:function(e){var t=$("#reminder-addparticipants-results"),i=!1,a=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS+(Reminders.isFromMsgAction?SearchAgent.PARTICIPANTS:0),s=t.next().find("#reminder-addparticipants-select-field");t.parents(RemindersUI.participantsUITypes.edit).length||t.parents(RemindersUI.participantsUITypes.mention).length||s.children().length||(a+=SearchAgent.CHATHISTORY+SearchAgent.CHANNELS),"#"==$WC.DivEditor.getSearchValueAndTrigger(ReminderConstants.ALLOWED_TRIGGERS,"addreminderinput").trigger&&(a=s.children().length?0:SearchAgent.CHATHISTORY+SearchAgent.CHANNELS);var n=[$zcg._ZUID];s.children().each(function(){n.push($(this).attr("uid"))});var r=$("#reminder-addparticipants-list");return r.empty(),!s.find("[remchat]").length&&a&&(i=SearchAgent.search({searchin:a,val:e,restricttosameorg:!0,channelcategory:1,peopledata:!0,chid:Reminders.currentChatId,ignorelist:n,scrlcontainer:$("#reminder-addparticipants-list").find("#participants"),listid:"reminder-addparticipants-list",participantshtml:RemindersUI.remParticipantsSearchHTML,contactshtml:RemindersUI.remParticipantsSearchHTML,orgcontactshtml:RemindersUI.remParticipantsSearchHTML,chathistoryhtml:RemindersUI.remChatHistoryHTML,channelshtml:RemindersUI.remChannelsHTML,replacecontentonsuccesscallback:!0,allstatuscontacts:!0,emptycallback:function(){SearchField.displayNoResultFound("reminder-addparticipants",e)},clearcallback:function(){SearchField.displayNoResultFound("reminder-addparticipants",e)},groupingmode:2})),i&&($("#reminder-addparticipants-list").removeClass("dflxjustcent").find("[purpose=search]").first().addClass("sel"),t.find("[remchat]").each(function(){var e=$(this);e.children().first().addClass("list-img posl")})),$("#reminputarea").attr("hasResult",i),i},handleKeyUp:function(e){if(e.which===$zcg.ESCAPE_KEYCODE){var t=this.getSearchField(),i=t.attr("id"),a=i.substr(0,i.indexOf("-search-field"));t.html()?(SearchField.clearSearchField(a),SearchField.populateDefaultResult(a)):(Clickoutside.clear(a),$("#"+a).hide().siblings().find("#addparticipants").removeClass("active"))}},handleAction:function(e,t){if(t.length){var i=1==t.parents(RemindersUI.participantsUITypes.mention).length;i&&"click"==e.type&&($WC.DivEditor.focus("addreminderinput"),RemindersUI.handle.addAndRemoveMentionNode(t),RemindersUI.handle.dropdownActions(t.parents("#reminder-addparticipants").siblings("#addreminderinput")));var a=$("#reminder-addparticipants-select-field"),s=a.children().length<ReminderConstants.MAX_USER_COUNT;if(s){var n={};if(t.is("[remchat]")){var r=t.attr("id"),o=RemindersUtil.getChatDetails(r);n={uid:t.attr("id"),name:o.name,type:o.type,image:o.img,remchat:"remchat",remove_html:RemindersUI.removeImgNodeHTML},i||Clickoutside.handleClickOnChild(e)}else{var l=t.attr("uid");n=$.extend(RemindersUtil.getUserDetails(l),{remove_html:RemindersUI.removeImgNodeHTML}),RemindersUtil.validateUser(t,l)}html=$WC.template.replace(RemindersUI.imgNodeHTML,n,"InSecureHTML"),a.append(html),i||t.parents("#reminder-addparticipants-results").addClass("rempptsel"),SearchField.clearSearchField("reminder-addparticipants"),RemindersUI.handle.saveAddedParticipants(a)}else UI.updateBanner(Resource.getRealValue("reminders.participantcount.error",[ReminderConstants.MAX_USER_COUNT]),1e3,!0)}},populateDefaultResult:function(){this.search("*")||this.displayNoResultFound(void 0,Resource.getRealValue("reminders.nomorecontacts.error"))},displayNoResultFound:function(e,t){e=$WC.$CUtil.processXSS(e);var i=this.getSuggestField();i.addClass("dflxjustcent"),i.html("undefined"!=typeof e&&"*"!==e?Resource.getRealValue("reminders.noresults.error",[e]):i.parent().siblings("#selremparticipants").find("[remchat]").length?Resource.getRealValue("reminders.chatremlimit.error"):t)}},handle:{atMentions:function(e){var t=$(RemindersUI.participantsUITypes.mention),i=t.find("#reminder-addparticipants");if(!t.find("#reminder-addparticipants").html()){var a=$WC.template.replace(RemindersUI.addParticipantsHTML,{$searchpholder:"quickchat.node.placeholder",$create:"common.save",search_entity:"reminder-addparticipants",module:"reminderbutton",purpose:"saveEditedParticipants"});t.append(a),i=t.find("#reminder-addparticipants"),$(RemindersUI.participantsUITypes.setReminder).find("#reminder-addparticipants").remove(),i.addClass("rematmentions"),i.find("#reminder-addparticipants-search-field").parent().hide(),SearchField.init("reminder-addparticipants"),i.hide(),ZCScroll.customScroll($("#reminder-addparticipants-list"),!0)}RemindersUI.handle.getSelectedParticipantsAndInit(t.parent()),i.find("#selremparticipants").hide(),i.find("#reminder-addparticipants-results").removeClass("rempptsel"),t=$(RemindersUI.participantsUITypes.mention);var s=t.attr("currtrigger");s&&(t.find("#reminder-addparticipants-search-field").html(e),SearchField.search("reminder-addparticipants",e)),Clickoutside.bind({srcid:"addreminderinput",destid:"reminder-addparticipants",doNotClose:function(e,t,i){var a=!1,s=$(RemindersUI.participantsUITypes.mention);if("true"==s.attr("hasResult")&&s.attr("currtrigger")&&(a=!0),"undefined"!=typeof i&&"click"===i.type){var n=i.currentTarget;n&&(a=!1)}return a},customShow:function(){var e=$(RemindersUI.participantsUITypes.mention);"true"==e.attr("hasResult")&&e.attr("currtrigger")&&e.find("#reminder-addparticipants").show()},customHide:function(){$(RemindersUI.participantsUITypes.mention).find("#addreminderinput").removeAttr("dropdown"),$("#reminder-addparticipants").hide()}}),$("#reminder-addparticipants:visible").length||Clickoutside.clear("reminder-addparticipants")},atMentionSelect:function(e){var t=$("#reminder-addparticipants").find(".sel");t.length&&(RemindersUI.userSuggest.handleAction(e,t),this.addAndRemoveMentionNode(t))},addAndRemoveMentionNode:function(e){var t=document.getElementById("addreminderinput"),i=$(RemindersUI.participantsUITypes.mention).attr("currtrigger");$WC.DivEditor.insertSelection(t,i,Composer.createMentionMemberNode(e[0],"@")),$WC.DivEditor.deleteObject("addreminderinput",t.getElementsByTagName("span")[0]),$("#addreminderinput").removeAttr("dropdown")},closeSettingsMenu:function(e,t){t.stopPropagation();var i=$("#remrhscnt").find("#remsettings");i.removeClass("hide"),i=["remsettimecnt","reminder-addparticipants"];var a=Clickoutside.currentchain;for(var s in a)i.indexOf(a[s])>-1&&Clickoutside.handleClickOnChild(t,a[s])},clearSetValue:function(e){var t=e.parent();t.attr("title",""),$("#ui-ztooltip-content").empty(),"newremsettime"===t.attr("id")?RemindersUI.handle.clearTimeForNewReminder():(t.attr("userids","[]").removeClass("sel"),t=t.siblings("#reminder-addparticipants"),e.siblings("#remusercount").remove(),t.length&&(RemindersUI.handle.getSelectedParticipantsAndInit(t.parent()),RemindersUI.handle.saveAddedParticipants(t.find("#reminder-addparticipants-select-field"))))},getAndShowInRHS:function(e){if(!e.is("[onboarding]")&&!e.parents("[data-purpose]").is("[onboarding]")){clearTimeout(Reminders.tourTimer),$WC.$Win.isExist("addreminderwin")&&$WC.$Win.destroy("addreminderwin"),Reminders.resetState();var t=e.attr("category")?e.attr("category"):ReminderConstants.categories.MINE;Reminders.lists.mine=new $ReminderList(ReminderConstants.categories.MINE,0),Reminders.lists.others=new $ReminderList(ReminderConstants.categories.OTHERS,0),Reminders.currentList=Reminders.currentList?Reminders.currentList:t;var i=$("#rhssection");i.html(RemindersUI.getRhsTempHTML()),RemindersUI.initInputField(),Clickoutside.bind({srcid:"ztb-reminders",destid:"remrhscnt",doNotClose:function(e,t,i,a){return!t&&(a.hasOwnProperty("reminderhover")||$("#reminderhover").find("#reminfocnt").length)},customShow:function(){Reminders.loadPreferences(),i.addClass("zc-profilemenushow").attr("open",""),i.find("#remrhscnt").addClass("mine")},customHide:function(){Reminders.storePreferences(),i.removeClass("zc-profilemenushow").removeAttr("open"),i.find("#reminder-addparticipants").remove()}}),RemindersUI.bindScrollEvent();var a=Reminders.lists[Reminders.currentList];Reminders.get({category:a.getCategory()},RemindersUtil.getTimeFilter(a.getFilter()),function(){a.refreshCategory()})}},refreshHTML:function(e){var t=$("#rhssection"),i=e.category,a=Reminders.lists[Reminders.currentList],s=a.getElement(),n=RemindersUI.getRhsTempHTML(),r=n.find("#"+s.attr("id"));RemindersUI.insertHTMLInList(r,e,-1);var o=i===ReminderConstants.categories.MINE||i===ReminderConstants.categories.MINE_COMPLETED,l=o?["#myremtab","#othersremtab"]:["#othersremtab","#myremtab"],c={currenttab:!0,loaded:!0};t.find(l[0]).addClass("remcurtab").attr(c),t.find(l[1]).removeClass("remcurtab").attr("currenttab",!1);var d=o?["mine","others"]:["others","mine"];t.find("#remrhscnt").addClass(d[0]).removeClass(d[1]),s.html(r.html()).attr({nextsettoken:r.attr("nextsettoken"),"class":r.attr("class")}),s.prepend(RemindersUI.getNewRemindersHTML(RemindersUI.getListHTML(Reminders.lists[Reminders.currentList].getReminders(!0),-1,!0))),a.endLoadingState(),Reminders.showTour&&(s.html(RemindersUI.getOnboardingHTML()),$WC.DivEditor.focus("addreminderinput"),$("#remsettings").removeClass("hide"),$("#reminputarea").prepend('<div tourblip class="touranim"/>'),$("[filtermenu]").hide()),ZCScroll.resetScroll(s),ZCScroll.isScrollDown(a.getElement()[0])&&!Reminders.showTour&&a.loadMoreReminders()},switchTab:function(e){if(!Reminders.isLoadingNow){e.addClass("remcurtab").attr("currenttab","true").siblings().removeClass("remcurtab").attr("currenttab","false");var t=e.attr("category");Reminders.currentList=t;var i=t===ReminderConstants.categories.OTHERS?"mine":"others";$("#remrhscnt").removeClass(i).addClass(t),Reminders.get({category:Reminders.lists[Reminders.currentList].getCategory()},RemindersUtil.getTimeFilter(Reminders.lists[Reminders.currentList].getFilter()),function(){Reminders.lists[Reminders.currentList].refreshCategory()}),RemindersUI.hideHover()}},getInfo:function(e,t){var i=e.attr("remid");Clickoutside.handleClick(t),e.addClass("remsel");var a=$("#reminderhover"),s='<span id="reminfocnt" class="zcldng"></span>',n=Reminders.getObject(i);"undefined"!=typeof n?s=RemindersUI.getInfoHTML(n):Reminders.getDetails(i,a,function(t,i){i.attr("remid")==t.id&&(i.html(RemindersUI.getInfoHTML(t)),$Util.positionTargetElement(e,i,{leftoffset:10}))}),a.html(s).attr("remid",i);var r=$Util.positionTargetElement(e,a,{leftoffset:10}),o=e.offset().top+e.height()/2-r.top;$("#reminfocntarrw").css({top:o,display:o+r.top+25<window.innerHeight?"block":"none"}),Clickoutside.bind({srcid:e.attr("id"),destid:"reminderhover",closeOnClickSrc:!1,customHide:function(){$("#remrhscnt").find(".remsel").removeClass("remsel"),a.hide().find("#reminfocnt").remove()}})},markAsCompleted:function(e){Reminders.markAsCompleted(e.attr("remid"),e,function(e,t){var i=t.attr("remid");t=$("[id='"+i+"']").find(".msi-circle"),t.removeClass("msi-circle"),t.addClass("msi-complete").attr({purpose:"markAsInComplete",title:Resource.getRealValue("reminders.completed")}),$("#remlstcontent"+t.parents("[remid]").attr("remid")).addClass("lineT"),RemindersUI.setStatusAttributes(i,"markAsInComplete","reminders.mark.incompleted"),RemindersUI.removeFromList(t.parents("[purpose=getInfo]")),ZCScroll.resetScroll(t.parents("[reminderlist]")),Reminders.lists[Reminders.currentList].handleModify(i)})},markAsInComplete:function(e){Reminders.markAsInComplete(e.attr("remid"),e,function(e,t){var i=t.attr("remid");t=$("[id='"+i+"']").find(".msi-complete"),t.removeClass("msi-complete"),t.addClass("msi-circle").attr({purpose:"markAsCompleted",title:Resource.getRealValue("reminders.tooltip.incomplete")}),$("#remlstcontent"+t.parents("[remid]").attr("remid")).removeClass("lineT"),RemindersUI.setStatusAttributes(i,"markAsCompleted","reminders.mark.completed"),RemindersUI.removeFromList(t.parents("[purpose=getInfo]")),ZCScroll.resetScroll(t.parents("[reminderlist]")),Reminders.lists[Reminders.currentList].handleModify(i)})},clearCompleted:function(){var e=Reminders.lists[Reminders.currentList],t=e.getElement();e.startLoadingState(),Reminders.clearCompleted(e.getCategory(),function(){e.deleteReminders(e.getCache()),e.refreshCategory()},function(){e.endLoadingState(t)})},"delete":function(e){var t=e.attr("remid");Reminders.delete(t,e,function(e,i){RemindersUI.hideHover(),i=$("[id='"+t+"']"),RemindersUI.removeFromList(i),ZCScroll.resetScroll(i.parents("[reminderlist]")),Reminders.lists[Reminders.currentList].handleDelete(t)})},editContent:function(e){function t(){e.html(e.attr("html")).siblings("[category=charcount]").remove()}var i=e.attr("id");Clickoutside.bind({srcid:i,destid:i,closeOnClickSrc:!1,customShow:function(){var t=$WC.$CUtil.processXSS(Markdown.convertToActualMsg(e[0])).replace(/\n/g,"<br>");e.attr({contenteditable:!0,content:t,html:e.html()}).html(t).addClass("remedit"),e.after('<div id="contentcount" category="charcount" limit="'+ReminderConstants.CONTENT_MAX_LENGTH+'" class="remcount"></div>')},customHide:function(a){e.attr("contenteditable",!1).removeClass("remedit");var s=Composer.getPlainTextFromComposer(i).trim();if(s==e.attr("content")||$WC.$CUtil.isEmpty(s))t();else{var a={content:s},n=e.attr("time");n&&n>0&&(a.time=n),Reminders.edit(e.attr("remid"),a,e,function(e,t){var i=MsgTemplate.getDisplayContent({msg:e.content});t.html(i).siblings("[category=charcount]").remove(),$("[id='remlstcontent"+e.id+"']").html(i)},function(){t()})}}})},addMember:function(e,t,i){var a=!1;if($(RemindersUI.participantsUITypes.mention).find("#reminder-addparticipants").remove(),e.parents(RemindersUI.participantsUITypes.edit).length&&"addparticpants"!==e.attr("id")?($("#remaddcnt").find("#reminder-addparticipants").remove().length&&Clickoutside.clear("reminder-addparticipants"),a=!0):RemindersUI.hideHover(),!$("#reminder-addparticipants").html()||a){var s=$WC.template.replace(RemindersUI.addParticipantsHTML,{$searchpholder:"quickchat.node.placeholder",$create:"common.save",search_entity:"reminder-addparticipants",module:"reminderbutton",purpose:"saveEditedParticipants"});if(a)return void($(RemindersUI.participantsUITypes.edit).find("#reminder-addparticipants").length?i():i(s));var n=$("#remaddcnt").find("#remsettings");n.find("#addparticipants").parent().append(s),SearchField.init("reminder-addparticipants"),ZCScroll.customScroll($("#reminder-addparticipants-list"),!0)}else a&&i();Clickoutside.bind({srcid:e.attr("id"),destid:"reminder-addparticipants",customShow:function(){SearchField.clearSearchField("reminder-addparticipants");var e=$("#reminder-addparticipants"),t=e.siblings("#remsettimecnt");t.find(".remerror").length&&(RemindersUI.handle.clearTimeForNewReminder(t.find("[purpose=clearTimeForNewReminder]")),t.find(".remerror").removeClass("remerror"),t.siblings().find("#newremsettime").attr("title","")),e.siblings("#addparticipants").addClass("active"),RemindersUI.handle.getSelectedParticipantsAndInit(e.parents("#remaddcnt")),e.show(),e.find("#reminder-addparticipants-search-field").focus()},customHide:function(){var e=$("#reminder-addparticipants");e.parent().find("#addparticipants").removeClass("active"),e.hide(),$WC.DivEditor.focus("addreminderinput")},closeOnClickSrc:!0})},getSelectedParticipantsAndInit:function(e){var t=e.find("#addparticipants").attr("userids"),i=e.find("#reminder-addparticipants-select-field");i.empty(),"undefined"!=typeof t&&(t=JSON.parse(t),t.length&&!e.parents("#reminputarea").length&&(e.find("#reminder-addparticipants-results").addClass("rempptsel"),e.find("#selremparticipants").show()),t.forEach(function(e){var t=e[0];if(!$WC.$CUtil.isEmpty(t)){var a={};if("contact"===e[1])a=$.extend(RemindersUtil.getUserDetails(t),{remove_html:RemindersUI.removeImgNodeHTML});else{var s=e[0],n=RemindersUtil.getChatDetails(s);a={uid:t,name:n.name,type:e[1],image:n.img,remchat:"remchat",remove_html:RemindersUI.removeImgNodeHTML}}var r=$WC.template.replace(RemindersUI.imgNodeHTML,a,"InSecureHTML");i.append(r)}})),$WC.$CUtil.isEmpty($("#reminder-addparticipants-search-field").text())&&SearchField.populateDefaultResult("reminder-addparticipants")},saveAddedParticipants:function(e){if(!e.parents(RemindersUI.participantsUITypes.edit).length){var t=[],i=e.children().length,a=[];e.children().each(function(){var e=$(this),i=e.attr("uid"),s=e.attr("elemtype");t.push([i,s]),a.push(e.attr("username"))}),$("#remaddcnt").find("#addparticipants").attr("title",$Util.getTooltipTextForList(a));var s=$("#remaddcnt"),n=s.find("#remusercount"),r=s.find("#addparticipants"),o=s.find("#selremparticipants");0!=i?(n.show(),e.parents(RemindersUI.participantsUITypes.mention).length||o.show(),r.addClass("sel"),n.html()?n.html(i):r.append('<span id="remusercount" class="msgnotify msgnotify-reminder dflxjustcent">'+i+"</span>"),r.attr("userids",JSON.stringify(t))):(n.remove(),o.hide(),o.find("#reminder-addparticipants-select-field").empty(),s.find("#reminder-addparticipants-results").removeClass("rempptsel"),r.removeAttr("userids").removeClass("sel"))}},deleteMember:function(e){var t=e.parents("#remmembers").children().length,i=e.attr("remuserid");1!==t&&Reminders.deleteMember(e.parents("#reminfocnt").attr("remid"),i,e,function(e){var t=e.id,a=$DB.get("reminders");$DB.update("reminders",function(){var e=a[t].users;return e.forEach(function(t){t.id===i&&e.splice(e.indexOf(t),1)}),a[t].userId=e,a}()),Reminders.lists[Reminders.currentList].handleModify(e.id),Reminders.lists[Reminders.currentList].refreshCategory(),RemindersUI.hideHover(),RemindersUI.updateScroll(t,$("#remrhscnt").find("#others-remlist"))})},addMoreMembers:function(e,t){RemindersUI.handle.addMember(e,t,function(t){if(!$WC.$CUtil.isEmpty(t)){e.after(t);var i=e.next();i.find("#reminder-addparticipants-results").addClass("rempptsel"),i.find("#selremparticipants").show().find("#saveAddedParticipants").css("visibility","visible"),i.addClass("addmoremembers");var a=e.parents("#reminderhover").position().top,s=a>ReminderConstants.HOVER_ADD_MEMBERS_OFFSET+10?-ReminderConstants.HOVER_ADD_MEMBERS_OFFSET:-(a-10);i.css({left:e.position().left+65,top:s}),i.show(),SearchField.init("reminder-addparticipants")}}),Clickoutside.bind({srcid:e.attr("id"),customShow:function(){var e=$(RemindersUI.participantsUITypes.edit).find("#reminder-addparticipants");SearchField.clearSearchField("reminder-addparticipants"),e.find("#reminder-addparticipants-select-field").empty(),RemindersUI.handle.getExistingParticipantsAndInit(),SearchField.populateDefaultResult("reminder-addparticipants"),e.find("#reminder-addparticipants-search-field").focus(),e.show()},customHide:function(){var e=$(RemindersUI.participantsUITypes.edit).find("#reminder-addparticipants");e.hide()},destid:"reminder-addparticipants"})},getExistingParticipantsAndInit:function(){var e=$(RemindersUI.participantsUITypes.edit),t=e.attr("remid"),i=Reminders.getObject(t).users,a=e.find("#reminder-addparticipants-select-field");i.forEach(function(e){var t=e.id;if(!$WC.$CUtil.isEmpty(t)){var i=$WC.template.replace(RemindersUI.imgNodeHTML,$.extend(RemindersUtil.getUserDetails(t),{remove_html:""}),"InSecureHTML");a.append(i)}}),e.find("[purpose=saveEditedParticipants]").css("visibility","visible"),ZCScroll.customScroll($("#reminder-addparticipants-list"),!0)},saveEditedParticipants:function(e){var t=e.siblings("#usernodecnt").find("#reminder-addparticipants-select-field"),i=[];t.children().each(function(){var e=$(this);e.find("[purpose=removeSelectedUser]").length&&i.push(e.attr("uid"))}),Reminders.addMembers($("#reminderhover").attr("remid"),{user_ids:i},e,function(e){var t=$DB.get("reminders");t[e.id].users=e.users,$DB.update("reminders",t),Reminders.lists[Reminders.currentList].handleModify(e.id),Reminders.lists[Reminders.currentList].refreshCategory(),RemindersUI.hideHover(),RemindersUI.updateScroll(e.id,$("#remrhscnt").find("#others-remlist"))})},removeSelectedUser:function(e){var t=e.parents("#reminder-addparticipants-select-field");e.parent().remove(),RemindersUI.handle.saveAddedParticipants(t),SearchField.populateDefaultResult("reminder-addparticipants")},setReminder:function(e,t){var i=e.closest("[msgtime][mtype]"),a=(i.attr("uid").split("_"),parseInt(e.attr("time")));this.setCustomDate(e,t,"true"===e.attr("parsedtime")?a:$Util.getSyncedCurrentTime()+a)},openMessage:function(e,t){var i=e.attr("chid"),a=e.attr("msgtime"),s=e.attr("sender");if(ChatUI.isExist(i)){Clickoutside.handleClickOnChild(t);var n=ChatUI.exist[i];n.createdbyme=!0,MainUI.getMefront(i,!0),n.scrollToSpecificMessage(a,s)}else Chat.attachSession(i,void 0,function(){Clickoutside.handleClickOnChild(t),ChatUI.exist[i].setScrollToMessage(a,s)},function(){UI.updateBanner(Resource.getRealValue("reminders.messagepermission.error"),5e3,!0)})},addReminder:function(){var e=$("#addreminderwin"),t=!1;if(e.length){if(e.attr("msgAction"))return void RemindersUI.handle.createReminder(e);t=!0}var i=$("#addreminderinput"),a=Composer.getPlainTextFromComposer("addreminderinput").trim();if(RemindersUtil.validateContent(a)){i.attr("content",a),$WC.DivEditor.clear("addreminderinput");var s={content:a,parse_content:!0};return $.extend(s,RemindersUtil.getInputs()),"undefined"==typeof s.time&&"undefined"!=typeof s.chat_ids?(UI.updateBanner(Resource.getRealValue("reminders.remnotime.error"),2e3,!0),void $WC.DivEditor.insertText("addreminderinput",i.attr("content"))):void Reminders.create(s,i,function(e,i){if(t)$WC.$Win.destroy("addreminderwin"),Clickoutside.clear("addreminderwin");else{var a,s;"undefined"==typeof i.user_ids&&"undefined"==typeof i.chat_ids?(s=Reminders.lists.mine,a=$("#mine-remlist")):(s=Reminders.lists.others,a=$("#others-remlist")),s.updateToken(),s.handleCreate(e.id),s.listId!==Reminders.lists[Reminders.currentList].listId&&RemindersUI.handle.switchTab($("mine-remlist"===a.attr("id")?"#myremtab":"#othersremtab")),Reminders.lists[Reminders.currentList].refreshCategory();var n=$("#remaddcnt");n.find("#selremparticipants").hide(),n.find("#reminder-addparticipants-results").removeClass("rempptsel"),n.find("#addparticipants").attr("title","").removeAttr("userids").removeClass("active sel"),n.find("#remusercount").remove(),n.find("#newremsettime").attr("title","").removeAttr("time").removeClass("active sel"),RemindersUI.updateScroll(e.id,a)}},function(){$WC.DivEditor.insertText("addreminderinput",i.attr("content"))})}},setCustomDate:function(e,t,i){var a=$("#remrhscnt");a.find("#remsettimecnt").remove(),a.find("#reminder-addparticipants").remove();var s="",n="",r="",o=[],l=[],c="createremwin"!==e.attr("id");if(c){$WC.$Win.destroy("addreminderwin"),Clickoutside.clear("remaddcnt");var d=e.closest("[msgtime][mtype]");r=d.attr("chid"),Reminders.currentChatId=r;var u=d.attr("uid").split("_");if("20"!==d.attr("mtype")){for(var m=d.find("[msgtype=msg]")[0],p=$WC.DivEditor.getNodes(m),h=0,g=0;h<ReminderConstants.MAX_USER_COUNT&&g<p.length;g++){var f=p[g];if(f.nodeType==Node.ELEMENT_NODE&&f.hasAttribute("mentionedid")&&"user"==f.getAttribute("elemtype")){var v=f.getAttribute("mentionedid");RemindersUtil.isUserValid(v)&&(h++,l.push(f.innerText),o.push([v,"contact"]))}}s=Markdown.convertToActualMsg(m)}else d.find("#comment").length&&(s=$($WC.DivEditor.getNodes(d.find("[msgtype=msg]")[0])[1]).text());n=s.substring(0,ReminderConstants.CONTENT_MAX_LENGTH)}var C=$WC.$Win.isExist("addreminderwin"),y=!1,b=$WC.template.replace(RemindersUI.remAddHTML,{content:"",$placeholder:"reminders.new.add.opt"+Math.ceil(3*Math.random())});if($WC.$Win.isExist("addreminderwin"))var y=1===$WC.$Win.get("addreminderwin").length;if(!C||y){if(!y){var E=$WC.$Win.create({id:"addreminderwin","class":"remaddmsgaction",html:b,closefn:function(){Clickoutside.clear("remaddcnt")}});if(RemindersUI.initInputField(),c&&(E.attr("chid",r).attr("sender",u[0]).attr("msgtime",u[1]).attr("msgAction","true"),E.attr("originalmsg",n.replace(/[\r\n]+/g," ")),"undefined"!=typeof i)){var I=E.find("#newremsettime");RemindersUI.setTime(I,i)}E.find("#remsettings").removeClass("hide"),E.find("#winhead").prepend(Resource.getRealValue("reminders.create.msgaction")),E.find("#winclose").remove()}Clickoutside.bind({srcid:e.attr("id"),destid:"remaddcnt",doNotClose:function(e,t,i,a){var s=!1,n=["remsettimecnt","reminder-addparticipants"];return n.forEach(function(e){a.hasOwnProperty(e)&&(a[e].isClosed||$("#"+e).find(".remerror").length)&&(s=!0)}),s},customShow:function(){var e=$("#addreminderwin");c?(Reminders.isFromMsgAction=!0,o.length&&$("#addparticipants").attr({userids:JSON.stringify(o),title:$Util.getTooltipTextForList(l)}).addClass("sel").append('<span id="remusercount" class="msgnotify msgnotify-reminder dflxjustcent">'+o.length+"</span>")):e.show(),$WC.DivEditor.focus("addreminderinput"),$WC.DivEditor.insertText("addreminderinput",n.replace(/[\r\n]+/g," "))},customHide:function(){var e=$("#addreminderwin");c?(delete Reminders.currentChatId,delete Reminders.isFromMsgAction,$WC.$Win.destroy("addreminderwin")):(e.hide(),Clickoutside.clear("reminder-addparticipants"),e.find("#reminder-addparticipants").remove())}})}},togglePeriod:function(e){e=e.parent(),e.toggleClass("am pm")},createReminder:function(e){var t,i=(e.find("#addparticipants"),e.find("#addreminderinput"));if(t=Composer.getPlainTextFromComposer("addreminderinput").trim(),RemindersUtil.validateContent(t)){i.attr("content",t),$WC.DivEditor.clear("addreminderinput");var a="undefined"!=typeof e.attr("msgaction")?"message_action":"quick_add";if(!$("#remsettimecnt").find(".remerror").length){var s={message:{chat_id:e.attr("chid"),time:e.attr("msgtime")},source:a};if($.extend(s,RemindersUtil.getInputs()),"undefined"==typeof s.time&&"undefined"!=typeof s.chat_ids)return UI.updateBanner(Resource.getRealValue("reminders.remnotime.error"),2e3,!0),void $WC.DivEditor.insertText("addreminderinput",i.attr("content"));t!==e.attr("originalmsg")&&(s.content=t),Reminders.create(s,e,function(){$WC.$Win.destroy("addreminderwin"),Clickoutside.clear("addreminderwin")},function(){$WC.DivEditor.insertText("addreminderinput",i.attr("content"))})}}},editTime:function(e){var t=$(RemindersUI.timeUITypes.edit);if(!t.find("#remsettimecnt").length){var i=t.find("#reminder-addparticipants");i.length&&(i.remove(),Clickoutside.clear("reminder-addparticipants"));var a=RemindersUtil.getTimeToPopulate(e.attr("time")),s=RemindersUI.getCalendarHTML(a);e.after(s);var n=e.siblings("#remsettimecnt").find("#remindercalendarcnt"),r=n.attr("val");RemindersUI.addDatePicker(n,r);var o=t.find("#remsettimecnt"),l=o.outerHeight();o.addClass("posa");var c=o.siblings("[reminderbutton]"),d=c.outerHeight(),u=c.offset().top+d,m=t.offset().top,p=m>l-d?-l:d,h=window.innerHeight;2*l+d>h&&p===d&&l>h-u&&(p=-(l/2+d)),o.css("top",p)}},newRemSetTime:function(e){if(!$("[remsettimecnt]").length){var t=RemindersUtil.getTimeToPopulate(e.attr("time")),i=RemindersUI.getCalendarHTML(t,!0),a=e.parent();a.append(i),a=a.find("#remsettimecnt").find("#remindercalendarcnt");var s=a.attr("val");RemindersUI.addDatePicker(a,s),a=a.parent(),a.attr("remsettimecnt","")}Clickoutside.bind({srcid:e.attr("id"),destid:"remsettimecnt",closeOnClickSrc:!0,customShow:function(){var t=e.siblings("#remsettimecnt");e.addClass("active");var i=RemindersUtil.getTimeToPopulate(e.attr("time"));if("undefined"!=typeof i){var a=$Date.date(i,{shortmonth:!0,shortday:!0,shorten:!0}),s=e.siblings("#remsettimecnt").find("#remindercalendarcnt");s.parent().find("#remdate").html(a),a=$Util.getDateWithoutTime(i),s.DatePickerSetDate(a,!0);var n=$Date.time(i).split(":"),r=n[0];n=n[1].split(" ");var o=n[0],l=n[1].toLowerCase();t.find("#remhrinp").attr("value",r).val(r),t.find("#remmininp").attr("value",o).val(o);var c=t.find("#remperiod");c.attr("class",c.hasClass(l)?c.attr("class"):"remperiod "+l)}t.show()},customHide:function(){var t=e.siblings("#remsettimecnt");e.removeClass("active"),t.hide(),$WC.DivEditor.focus("addreminderinput")},doNotClose:function(){var e=!0;return $("[remtimeinput]").each(function(){$(this).hasClass("remerror")&&(e=!1,$Util.highlightError($("#remsettimecnt"),"remerror"))}),!e}})},clearTimeForNewReminder:function(){$("#remsettimecnt").hide().find(".remerror").removeClass("remerror"),$("#newremsettime").attr("title","").removeAttr("time").removeClass("active sel"),Clickoutside.clear("remsettimecnt"),$WC.DivEditor.focus("addreminderinput")},saveTimeForNewReminder:function(e,t){var i=$("#remsettimecnt");if(i.parents(RemindersUI.timeUITypes.edit).length||i.find(".remerror").length)$Util.highlightError(i,"remerror");else{var a=RemindersUtil.getDate(i);i=i.parents("#remsettings").find("#newremsettime"),RemindersUI.setTime(i,a.getTime()),"undefined"!=typeof e&&Clickoutside.handleClickOnChild(t)}},cancelEditTime:function(){$("#reminderhover").find("#remsettimecnt").remove()},closeRhs:function(e,t){Clickoutside.handleClickOnChild(t)},saveEditTime:function(e){var t=$("#remsettimecnt");if(t.find(".remerror").length)return void $Util.highlightError(t,"remerror");var i=$(RemindersUI.timeUITypes.edit),a=RemindersUtil.getDate(i);Reminders.edit(e.parents("[remid]").attr("remid"),{time:a.getTime()},e,function(e){RemindersUI.hideHover();var t=i.find("#remtime"+e.id),a=t.attr("time"),s=a&&a>0&&$Date.isSameDay(e.time,a),n=$Date.date(e.time,{withday:!0,shortmonth:!0,shortday:!0,withtime:!0});t.html(n).attr("time",e.time);var r=$('[id="remtimelst'+e.id+'"]'),o="true"==r.attr("includedate");if(s&&!o?n=$Date.time(e.time):o=!0,r.length)r.html(n).attr("includedate",o);else{var l=$WC.template.replace('<span id="remtimelst{{id}}" includedate=true class="msi-reminder remtimeinfo {{expired_class}}" time="{{time}}">{{time_text}}</span>',{time:e.time,time_text:n,id:e.id,expired_class:e.time<$Util.getSyncedCurrentTime()?"remexp":""},"InSecureHTML");$("#remrhscnt").find("#remtimecnt"+e.id).prepend(l)}e.time>$Util.getSyncedCurrentTime()?(t.removeClass("remexp"),r.removeClass("remexp")):(t.addClass("remexp"),r.addClass("remexp")),i.find("#remcontent"+e.id).attr("time",e.time);$("#remrhscnt");Reminders.lists[Reminders.currentList].handleModify(e.id),Reminders.lists[Reminders.currentList].refreshCategory(),RemindersUI.updateScroll(e.id,Reminders.lists[Reminders.currentList].getElement())}),t.remove()},dropdownActions:function(e){var t=$WC.DivEditor.getSearchValueAndTrigger(ReminderConstants.ALLOWED_TRIGGERS,"addreminderinput"),i=!1;$WC.$CUtil.isEmpty(t.trigger)?e.parents("#reminputarea").removeAttr("currtrigger"):(i=!0,e.parents("#reminputarea").attr("currtrigger",t.trigger)),this.atMentions(t.val),i&&"true"==$("#reminputarea").attr("hasResult")?e.attr("dropdown","true"):e.removeAttr("dropdown")},notifyAssignees:function(e){Reminders.notifyAssignees(e.attr("remId"),e)},notifyAssignee:function(e){e.addClass("loading"),Reminders.notifyAssignee(e.parents("#reminfocnt").attr("remid"),e.siblings().find("[uid]").attr("uid"),e,function(){e.removeClass("loading")},function(){e.removeClass("loading")})}},handleOnboarding:function(){var e=Settings.getFromObj("reminders_onboarded");isNaN(e)&&(e=0),!e&&SecurityManager.hasPermission(Modules.Reminders)&&$ZCAjx.ajax({url:"/v2/reminders",data:{category:ReminderConstants.categories.ALL,limit:1},success:function(e){e.list.length?Reminders.markOnboardingComplete():(Reminders.showTour=!0,RemindersUI.triggerTour())},zc_module:Modules.Reminders})},triggerTour:function(){Reminders.tourTimer=setTimeout(function(){RemindersUI.isRhsOpen()||(!Reminders.showTour||Tour.isNewTourAvailable("one2onechat")||Tour.isNewTourAvailable("adhocchat")||Tour.isNewTourAvailable("channels")?Reminders.tourTimer=setTimeout(function(){RemindersUI.triggerTour()},6e4):(Tour.showLoadingAnimation("reminders"),Reminders.markOnboardingComplete()))},6e4)},handleResize:function(){this.isRhsOpen()&&Reminders.lists[Reminders.currentList].loadMoreReminders()},isRhsOpen:function(){return $("#rhssection").is("[open]")},showNoContentBanner:function(){UI.updateBanner(Resource.getRealValue("reminders.nocontent.error"),2e3,!1,!0)},filter:{toggleCompletedReminders:function(e){RemindersUI.hideHover();for(var t in Reminders.lists){var i=Reminders.lists[t],a=e.siblings("[action=openFilterMenu]");e.siblings("[action=openFilterMenu]").removeClass("active"),i.setFilter(0),i.toggleCompleted()}i=Reminders.lists[Reminders.currentList];var s=i.getElement();s.removeAttr("nextsettoken").empty(),i.isCompleted()?(a.addClass("remdisable").find("[filtermenudropdown]").hide(),e.attr("title",Resource.getRealValue("reminders.hide.completed"))):(a.removeClass("remdisable"),e.attr("title",Resource.getRealValue("reminders.show.completed"))),Reminders.get({category:i.getCategory()},{},function(){i.refreshCategory()}),e.toggleClass("active")},toggleCompactMode:function(e){RemindersUI.hideHover(),e.siblings().find("[filtermenudropdown]").hide(),e.attr("title",Resource.getRealValue(e.hasClass("msi-remviewnormal")?"reminders.view.compact":"reminders.view.classic")).toggleClass("msi-remviewcompact msi-remviewnormal");for(var t in Reminders.lists){var i=Reminders.lists[t];i.toggleView()}i=Reminders.lists[Reminders.currentList],i.refreshCategory(),i.loadMoreReminders()},openFilterMenu:function(e){e.find("[option]").removeClass("active"),e.find("[filtermenudropdown]").toggle(),e.find("[option="+Reminders.lists[Reminders.currentList].getFilter()+"]").addClass("active")},changeFilter:function(e){var t=e.attr("option");e.parents("[filtermenudropdown]").find("[option="+Reminders.lists[Reminders.currentList].getFilter()+"]").removeClass("active");for(var i in Reminders.lists){var a=Reminders.lists[i];"none"!==ReminderConstants.TIME_FILTERS[t]?e.parents("[remfilterbtn]").addClass("active"):e.parents("[remfilterbtn]").removeClass("active"),a.setFilter(t)}a=Reminders.lists[Reminders.currentList],e.parent().toggle(),RemindersUI.hideHover(),Reminders.get({category:a.getCategory()},RemindersUtil.getTimeFilter(t),function(){a.refreshCategory()})}},setTime:function(e,t){var i=$Date.daytime(t,{stringformat:!0,shortmonth:!0});e.attr({title:i,time:t}).addClass("sel")},timeUITypes:{edit:"#reminderhover",setReminder:"#remsettings"},participantsUITypes:{mention:"#reminputarea",edit:"#reminderhover",setReminder:"#remsettings"},filterText:["common.showall","date.today","date.tomorrow","reminders.filter.week","reminders.filter.month"],handleModuleStatusChange:function(){SecurityManager.hasPermission(Modules.Reminders)?$("#ztb-reminders").show():($("#ztb-reminders").hide(),Commands.deleteInObj(CommandsUtil.REMINDERS_COMMAND),Commands.deleteInObj(CommandsUtil.REMIND_COMMAND))}},Reminders={init:function(){RemindersUI.handleOnboarding(),RemindersUI.bindEvents(),SecurityManager.register(Modules.Reminders,RemindersUI.handleModuleStatusChange)},get:function(e,t,i,a,s){var n=Reminders.lists[Reminders.currentList];n.startLoadingState(),n.updateToken();var r={};e.nextSetToken?r.next_set_token=e.nextSetToken:e.category&&(r.category=e.category),$.extend(r,t),n.getNextSetToken()&&!s||Reminders.showTour?i():$ZCAjx.ajax({url:"/v2/reminders",type:"GET",data:r,success:function(e){Reminders.update(e.list),n.updateCache(RemindersUtil.getIds(e.list),e.next_set_token?e.next_set_token:"-1"),i(e)},error:function(e){"function"==typeof a&&a(e)},zc_module:Modules.Reminders})},getDetails:function(e,t,i){$ZCAjx.ajax({url:"/v2/reminders/"+e,type:"GET",success:function(e){Reminders.update(e),i(e,t)},zc_module:Modules.Reminders})},create:function(e,t,i,a){Reminders.showTour&&(Reminders.showTour=!1,$("[tourblip]").remove(),$("[filtermenu]").show()),delete Reminders.isFromMsgAction,$ZCAjx.ajax({url:"/v2/reminders",type:"POST",data:e,contentType:"application/json",status:{success:"reminders.new.hint",loading:"common.loading"},success:function(t){$DB.get("reminders")[t.id]=t,"function"==typeof i&&i(t,e)},error:function(e){UI.updateBanner(e.message,2e3,!0),"function"==typeof a&&a(e,t)},zc_module:Modules.Reminders})},edit:function(e,t,i,a,s){$ZCAjx.ajax({url:"/v2/reminders/"+e,type:"PUT",contentType:"application/json",data:t,success:function(e){Reminders.update(e),a(e,i)},error:function(e){UI.updateBanner(e.message,2e3,!0),"function"==typeof s&&s(e,i)},zc_module:Modules.Reminders})},markAsCompleted:function(e,t,i){$ZCAjx.ajax({url:"/v2/reminders/"+e+"/complete",type:"PUT",success:function(a){Reminders.updateCompletedTime(e,$Util.getSyncedCurrentTime()),i(a,t)},error:function(e){UI.updateBanner(e.message,2e3,!0)},zc_module:Modules.Reminders})},markAsInComplete:function(e,t,i){$ZCAjx.ajax({url:"/v2/reminders/"+e+"/incomplete",type:"PUT",success:function(a){Reminders.updateCompletedTime(e,-1),i(a,t)},error:function(e){UI.updateBanner(e.message,2e3,!0)},zc_module:Modules.Reminders})},snoozeReminder:function(e,t,i,a){$ZCAjx.ajax({url:"/v2/reminders/"+e+"/snooze",type:"PUT",contentType:"application/json",data:{time:t},success:function(e){a(e,i)},error:function(e){UI.updateBanner(e.message,2e3,!0)},zc_module:Modules.Reminders})},"delete":function(e,t,i){$ZCAjx.ajax({url:"/v2/reminders/"+e,type:"DELETE",status:{loading:t},success:function(a){delete $DB.get("reminders")[e],i(a,t)},error:function(e){UI.updateBanner(e.message,2e3,!0)},zc_module:Modules.Reminders})},clearCompleted:function(e,t,i){$ZCAjx.ajax({url:"/v2/reminders/clearcompleted",type:"DELETE",contentType:"application/json",data:{category:e},success:function(){t()},error:function(){i()},zc_module:Modules.Reminders})},addMembers:function(e,t,i,a){$ZCAjx.ajax({url:"/v2/reminders/"+e+"/users",type:"POST",contentType:"application/json",data:t,status:{loading:i},success:function(e){a(e,i)},error:function(e){UI.updateBanner(e.message,1e3,!0)},zc_module:Modules.Reminders})},deleteMember:function(e,t,i,a){$ZCAjx.ajax({url:"/v2/reminders/"+e+"/users/"+t,type:"DELETE",status:{loading:i},success:function(e){a(e,i)},error:function(e){UI.updateBanner(e.message,1e3,!0)},zc_module:Modules.Reminders})},setParsedTime:function(e,t){MessageContextParser.parseTimeFromMessage(e,t,function(i){Reminders.parsedMsgIdVsTime[e+"_"+t]=i.data.time,$("#parsedtime_"+e+"_"+t).attr("time",i.data.time);var a=$("#defaulttime_"+e+"_"+t);if(i.data.time>0){var s=$Date.time(i.data.time)+" "+$Date.date(i.data.time,{shortmonth:!0,shortday:!0,shorten:!0});a.attr({reminderbutton:"",time:i.data.time}).html(s).removeClass("dN")}})},update:function(e){var t=$DB.get("reminders")||{},i=Array.isArray(e)?e:[e];for(var a in i)-1==i[a].time&&delete i[a].time,t[i[a].id]=i[a]},updateCompletedTime:function(e,t){var i=this.getObject(e);if(i&&i.users){var a=i.users,s=$zcg._ZUID;for(var n in a)s==a[n].id&&(a[n].completed_time=t)}},notifyAssignee:function(e,t,i,a,s){$ZCAjx.ajax({url:"/v2/reminders/"+e+"/users/"+t+"/remind",type:"PUT",status:{loading:i,success:"reminders.success.individualnotification"},success:function(){a()},error:function(e){UI.updateBanner(e.message,1e3,!0),s()},zc_module:Modules.Reminders})},notifyAssignees:function(e,t){$ZCAjx.ajax({url:"/v2/reminders/"+e+"/remind",type:"PUT",status:{loading:t,success:"reminders.success.manualnotification"},error:function(e){UI.updateBanner(e.message,1e3,!0)},zc_module:Modules.Reminders})},getObject:function(e){return $DB.get("reminders")[e]},isAssignedToMe:function(e){var t=$zcg._ZUID;for(var i in e)if(e[i].id==t)return!0;return!1},isCompleted:function(e){var t=e.chats;if(!$WC.$CUtil.isEmpty(e.users)){t=e.users;var i=$zcg._ZUID;for(var a in t)if(t[a].id==i)return t[a].completed_time>0}for(var a in t)if("undefined"==typeof t[a].completed_time||t[a].completed_time<0)return!1;return!0},resetState:function(){$DB.clear("reminders"),Reminders.lists.mine=null,Reminders.lists.others=null},markOnboardingComplete:function(){Settings.update({reminders_onboarded:1})},storePreferences:function(){Reminders.preferences={compact:Reminders.lists[Reminders.currentList].isCompact(),filter:Reminders.lists[Reminders.currentList].getFilter()}},loadPreferences:function(){var e=Reminders.preferences;if(!$WC.$CUtil.isEmptyObject(e)){var t=Reminders.lists.mine,i=$("[filtermenu]");e.compact!=t.isCompact()&&(t.toggleView(),Reminders.lists.others.toggleView(),i.find('[action="toggleCompactMode"]').attr("title",Resource.getRealValue("reminders.view.compact")).toggleClass("msi-remviewcompact msi-remviewnormal")),e.filter!=t.getFilter()&&(t.setFilter(e.filter),Reminders.lists.others.setFilter(e.filter),i.find('[action="openFilterMenu"]').addClass("active"))}},parsedMsgIdVsTime:{},lists:{},preferences:{}};var RemindersUtil={getIds:function(e){var t=[];for(var i in e)t.push(e[i].id);return t},getCategory:function(e){var t=e.users,i=ReminderConstants.categories.OTHERS;for(var a in t)if(t[a].id==$zcg._ZUID){i=ReminderConstants.categories.MINE;break}return i},getDate:function(e){return new Date(e.find("#remindercalendarcnt").attr("val")+" "+e.find("#remhrinp").val()+":"+e.find("#remmininp").val()+" "+(e.find("#remperiod").hasClass("am")?"am":"pm"))},getInputs:function(){var e={},t=$("#newremsettime").attr("time");void 0!==typeof t&&(e.time=t);var i,a,s=$("#addparticipants");if(s.hasClass("sel")&&(i=s.attr("userids"),"undefined"!=typeof i))if(i=JSON.parse(i),1===i.length&&"contact"!==i[0][1])a=i[0][0],e.chat_ids=[a];else{var n=[];i.forEach(function(e){n.push(e[0])}),e.user_ids=n}return e},getTimeToPopulate:function(e){var t=18e5,i=$Util.getSyncedCurrentTime();return parseInt(e)>0?e:i+t-i%t},getUserDetails:function(e){var t=Users.getDetail(e);return $.extend(t,{image:'<img src="'+t.image+'"/>',remchat:""})},getChatDetails:function(e){var t='<img src="{{image}}"/>',i=Chat.getDetails(e);return"undefined"==typeof i.img&&(i.img=$WC.template.replace(t,{image:i.imgurl},"InSecureHTML")),i},getLimits:function(e){return e.is("[minutes]")?[0,59]:[1,12]},checkIfTimeIsValid:function(e){var t=e.val(),i=e.is("[hours]")?$Util.isValidNumber(t,Events.MIN_HOURS,Events.MAX_HOURS):$Util.isValidNumber(t,Events.MIN_MINUTES,Events.MAX_MINUTES);i?e.removeClass("remerror"):e.addClass("remerror")},isUserValid:function(e){var t=Contacts.getAll(),i=Users.getAll();return("undefined"!=typeof t[e]||"undefined"!=typeof i[e])&&Users.isSameOrg(e)&&!WmsImpl.isLocalUser(e+"")},validateUser:function(e,t){if(Reminders.isFromMsgAction){var i=e.parent().attr("id");"participants"!=i&&UI.updateBanner(Resource.getRealValue("reminders.invaliduser.error",[Users.getName(t)]),2e3,!1,!0)}},getTimeFilter:function(e){var t,i,a=$Util.getSyncedCurrentTime(),s=new Date,n=60*s.getTimezoneOffset()*1e3,r=864e5,o=a-(a+-1*n)%r;if(e==ReminderConstants.TIME_FILTER_CONSTANTS.none)return{};if(e==ReminderConstants.TIME_FILTER_CONSTANTS.today)t=o,i=t+r;else if(e==ReminderConstants.TIME_FILTER_CONSTANTS.tomorrow)t=o+r,i=t+r;else if(e==ReminderConstants.TIME_FILTER_CONSTANTS.week){var l=s.getDay();t=l?o-l*r:o,i=t+7*r}else{var c=s.getDate();t=1===c?o:o-c*r,i=t+(new Date(s.getFullYear(),s.getMonth()+1,0).getDate()+1)*r}return{fromtime:t,totime:i}},validateContent:function(e){var t=!0;return $WC.$CUtil.isEmpty(e)?(RemindersUI.showNoContentBanner(),t=!1):e.length>ReminderConstants.CONTENT_MAX_LENGTH&&(UI.updateBanner(Resource.getRealValue("reminders.error.toolong"),2e3,!1,!0),t=!1),t}},RemindersWidgetManager={},RemindersWidget=function(e,t,i){this._parentId=e,this._datePicker=null,t.content=t.content.substring(0,ReminderConstants.CONTENT_MAX_LENGTH),this._actualContent=t.content,this._content=t.content,this._time=parseInt(t.time),this._users=[],this._chats=[],this._message=t.message,this._isSelfReminder=!0,this.searchEntity="reminderwidget-addusers",SearchEntities[this.searchEntity]=this,this.searchIn=i?i:SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS};RemindersWidget.prototype={_setParent:function(e){this._parentId=e},_changeType:function(e){this._isSelfReminder=e},_setContent:function(e){this._content=e.trim().substring(0,ReminderConstants.CONTENT_MAX_LENGTH)},_setTime:function(e){this._time=parseInt(e)},_setMessageDetails:function(e){this._message=e},_addUser:function(e){-1==this._users.indexOf(e)&&this._users.push(e)},_addChat:function(e){-1==this._chats.indexOf(e)&&this._chats.push(e)},_resetAssignees:function(){this._users=[],this._chats=[]},_clearDatePickerWidget:function(){this._datePicker=null},_setDatePickerWidget:function(e){this._datePicker=e},_getDatePickerWidget:function(){return this._datePicker},getContentForCreate:function(){return this._content!=this._actualContent?this._content:""},getContent:function(){return this._content},getTime:function(){return this._time},getUsers:function(){return this._users},getChats:function(){return this._chats},getMessageDetails:function(){return this._message},isSelfReminder:function(){return this._isSelfReminder},getParentContainer:function(){return $("#"+this._parentId)},refreshSearchIn:function(e,t){var i=e.length>0,a=t.length>0;this.searchIn=i?SearchAgent.PARTICIPANTS+SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS:a?0:SearchAgent.PARTICIPANTS+SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS+SearchAgent.CHATHISTORY+SearchAgent.CHANNELS},refreshAssigneeSelection:function(){var e=this.getUsers(),t=this.getChats(),i=this.getContainer(),a=i.find("[userpicker]"),s=this.searchEntity,n=i.find("#"+s+"-select-field");a.find("[uid]").remove(),n.empty();var r=i.find("#"+s+"-results");e.length||t.length?(r.addClass("rempptsel"),r.siblings("#selremparticipants").show()):(r.removeClass("rempptsel"),r.siblings("#selremparticipants").hide());var o="";if(e.length)for(var l in e){var c=e[l];params=$.extend(RemindersUtil.getUserDetails(c),{remove_html:RemindersWidgetManager.userRemoveHTML}),o+=$WC.template.replace(RemindersUI.imgNodeHTML,params,"InSecureHTML")}else if(t.length)for(var l in t){var d=t[l],u=RemindersUtil.getChatDetails(d);params={uid:d,name:u.name,type:u.type,image:u.img,remchat:"remchat",remove_html:RemindersWidgetManager.userRemoveHTML},o+=$WC.template.replace(RemindersUI.imgNodeHTML,params,"InSecureHTML")}n.append(o),a.prepend(o)},datePicker:{open:function(e){var t=this,i=t.getContainer().find("#datepicker"),a=i.siblings("#datetimepicker"),s=a.length;s||i.after(RemindersWidgetManager.datePickerWrapperHTML),Clickoutside.bind({srcid:e.attr("id"),destid:"datetimepicker",customShow:function(){var e=t._getDatePickerWidget();s||(e||(e=new DateTimeWidget("datetimepicker",{setButtonNeeded:!0}),t._setDatePickerWidget(e)),e.handleModify=function(e){t._setTime(this.getSelection().getTime()),i.find("[timefield]").html($Date.daytime(t.getTime(),{raw:!0})),t.datePicker.close.call(t,e)},e.handleCancel=function(e){t.datePicker.close.call(t,e)}),e.initialize(new Date(t.getTime())),a.show()},customHide:function(){t.datePicker.close.call(t)}})},close:function(e){e&&Clickoutside.handleClickOnChild(e),this.getContainer().find("#datetimepicker").hide()}},openUserPicker:function(e){var t=this.searchEntity;e.siblings("#"+t).length||(e.after($WC.template.replace(RemindersUI.addParticipantsHTML,{$searchpholder:"quickchat.node.placeholder",$create:"common.save",search_entity:t,module:"inlinerembtn",purpose:"saveAssignees"})),SearchField.init(t),ZCScroll.customScroll(this.getSuggestField(),!0));var i=e.siblings("#"+t);this.refreshAssigneeSelection(),i.find("#saveAddedParticipants").css("visibility","visible"),Clickoutside.bind({srcid:e.attr("id"),destid:i.attr("id"),customShow:function(){i.css("top",0),i.show()}}),SearchField.populateDefaultResult(t)},saveAssignees:function(e){this._resetAssignees();var t=this.searchEntity;e.is("[userpicker]")||(e=e.parent().find("#"+t+"-select-field"));var i=this,a=e.children("[uid]");if(a.each(function(){var e=$(this),t=e.attr("uid");e.is('[elemtype="contact"]')?i._addUser(t):i._addChat(t)}),!a.length){var s=this.getContainer().find("#"+t+"-results");s.removeClass("rempptsel"),s.siblings("#selremparticipants").hide()}this.refreshAssigneeSelection(),e.parents("#"+t).hide(),Clickoutside.clear(t)},removeUser:function(e){var t=this.searchEntity,i=e.parents("#"+t+"-select-field");i.length||(i=e.parents("[userpicker]")),e.parent().remove(),i.is("[userpicker]")&&this.saveAssignees(i),SearchField.populateDefaultResult(t)},create:function(){var e={};this._setContent(this.getContainer().find("textarea").val());var t=this.getContent(),i=this.getContentForCreate();if(RemindersUtil.validateContent(t)&&($WC.$CUtil.isEmpty(i)||(e.content=t),!e.content||!$WC.$CUtil.isEmpty(e.content))){if(this.getTime()&&(e.time=this.getTime()),!this.isSelfReminder()){var a=this.getUsers(),s=this.getChats();a.length&&(e.user_ids=a),s.length&&(e.chat_ids=s)}this.getMessageDetails()&&(e.message=this.getMessageDetails());var n=this;Reminders.create(e,null,function(){n._clearDatePickerWidget(),n.closeView()})}}},RemindersWidget.prototype=$.extend(RemindersWidget.prototype,{getSearchField:function(){return $("#"+this.searchEntity+"-search-field")},getSuggestField:function(){return $("#"+this.searchEntity+"-list")},handleKeyUp:function(e){if(e.which===$zcg.ESCAPE_KEYCODE){var t=this.getSearchField(),i=this.searchEntity;t.html()?(SearchField.clearSearchField(i),SearchField.populateDefaultResult(i)):(Clickoutside.clear(i),$("#"+this.searchEntity).hide().siblings().find("#addparticipants").removeClass("active"))}},populateDefaultResult:function(){this.search("*")||this.displayNoResultFound(void 0,Resource.getRealValue("reminders.nomorecontacts.error"))},displayNoResultFound:function(e,t){e=$WC.$CUtil.processXSS(e);var i=this.getSuggestField();i.addClass("dflxjustcent"),i.html("undefined"!=typeof e&&"*"!==e?Resource.getRealValue("reminders.noresults.error",[e]):i.parent().siblings("#selremparticipants").find("[remchat]").length?Resource.getRealValue("reminders.chatremlimit.error"):t)},search:function(e){var t=this.searchEntity,i=$("#"+t+"-list");i.empty();var a=[$zcg._ZUID],s=[],n=[];i.parent().siblings().find("#"+t+"-select-field").children().each(function(){var e=$(this),t=e.attr("uid");e.is('[elemtype="contact"]')?s.push(t):n.push(t),a.push(t)}),this.refreshSearchIn(s,n);var r=SearchAgent.search({searchin:this.searchIn,val:e,restricttosameorg:!0,peopledata:!0,chid:this._parentId,ignorelist:a,scrlcontainer:i,listid:t+"-list",contactshtml:RemindersUI.remParticipantsSearchHTML,orgcontactshtml:RemindersUI.remParticipantsSearchHTML,participantshtml:RemindersUI.remParticipantsSearchHTML,chathistoryhtml:RemindersUI.remChatHistoryHTML,channelshtml:RemindersUI.remChannelsHTML,allstatuscontacts:!0,emptycallback:function(){SearchField.displayNoResultFound(t,e)},clearcallback:function(){SearchField.displayNoResultFound(t,e)},groupingmode:2});return r&&$("#"+t+"-list").removeClass("dflxjustcent").find("[purpose=search]").first().addClass("sel"),r},handleAction:function(e,t){if(t.length){var i=this.searchEntity,a=$("#"+i+"-select-field"),s=a.children().length;if(s<ReminderConstants.MAX_USER_COUNT){var n={};if(t.is("[remchat]")){var r=t.attr("chid"),o=RemindersUtil.getChatDetails(r);n={uid:r,name:o.name,type:o.type,image:o.img,remchat:"remchat",remove_html:RemindersWidgetManager.userRemoveHTML}}else{var l=t.attr("uid");n=$.extend(RemindersUtil.getUserDetails(l),{remove_html:RemindersWidgetManager.userRemoveHTML})}a.append($WC.template.replace(RemindersUI.imgNodeHTML,n,"InSecureHTML")),s++,SearchField.clearSearchField(i)}else UI.updateBanner(Resource.getRealValue("reminders.participantcount.error",[ReminderConstants.MAX_USER_COUNT]),1e3,!0);var c=t.parents("#"+i+"-results");s&&c.addClass("rempptsel").siblings("#selremparticipants").show()}}}),RemindersWidgetManager=function(){function e(){return i}function t(e){i=e}var i=null;return{createWinHTML:'<div id="inlineremwin" inlinereminders class="cht-tltipcont"><div class="rmnd-popup cht-evntcret cht-rmndrcret" id="remwincnt"><em inlinerembtn purpose="closeView" class="msi-close cp"></em><header class="mrgB15 w100"><div class="font14"><em class="msi-remquickadd mrgR10 dib-mid"></em>{{title}}</div></header><div class="cht-evntcont"><span class="lH25 font12 fontb">{{message}}</span><textarea reminput class="font12">{{content}}</textarea><div class="mrgT20"><span class="lH25 font12 fontb">{{datentime}}</span><div class="dflxcent"><div id="datepicker" inlinerembtn purpose="datePicker.open" class="dflxcent cht-calndrset mrgR30" time="{{time}}"><span timefield class="flx1 ellips font14 cp">{{timetext}}</span><em class="cal-view msi-remquickadd cp"></em></div></div></div><div class="mrgT20"><span class="lH25 font12 fontb">{{typeheader}}</span><div inlinerembtn purpose="switchType" class="font13"><div type="self" class="posl dIB"><input id="eventreminderradio" class="evt-alrtinput cur" name="eventalerttype" type="radio" assign="self" checked="true"><span class="evt-alrttype"></span><label class="cur" for="eventreminderradio">{{type_self}}</label></div><div type="others" class="posl dIB mrgL30"><input id="eventmanagementradio" class="evt-alrtinput cur" name="eventalerttype" type="radio" assign="others"><span class="evt-alrttype"></span><label class="cur" for="eventmanagementradio">{{type_others}}</label></div><div userpicker class="mrgT18 dN"><div id="widget-addusers" inlinerembtn purpose="openUserPicker" class="add-adndr msi-plus cp dib-mid"></div></div></div></div><button inlinerembtn purpose="create" id="evsubmit" class="dbtn adbtn mrgR20">{{create}}</button><div class="rmnd-addbtn"></div></div></div></div>',datePickerWrapperHTML:'<div id="datetimepicker" class="date-picker-wrp"></div>',userRemoveHTML:'<div class="msi-close user-remove posa dN cur" inlinerembtn purpose="removeUser"></div>',getCreateWin:function(){var t=e(),i=$WC.template.replace(this.createWinHTML,{$title:"common.set.reminder",$message:"common.content",content:t.getContent(),$datentime:"event.date.header",time:t.getTime(),timetext:$Date.daytime(t.getTime(),{raw:!0}),$typeheader:"chat.helptip.type",$type_self:"reminders.type.self",$type_others:"reminders.type.others",$create:"common.create"});return i},getWidget:function(i){if(i)var a=i.parents("[purpose=chatview]").attr("id"),s=i.parents("[mtype][msgtime]").attr("msguid"),n=this.getPrefill(a,s,i.attr("id"));var r=e();return!r&&n?(r=new RemindersWidget(a,n,SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS+SearchAgent.PARTICIPANTS+SearchAgent.CHATHISTORY+SearchAgent.CHANNELS),r.getContainer=function(){return this.getParentContainer().find("#inlineremwin")},r.openView=function(e){var t=this,i=$(RemindersWidgetManager.getCreateWin());e.parents("[msgtype]").after(i),MessageContextParser.positionPopup(e,i),Clickoutside.bind({srcid:e.attr("id"),destid:i.attr("id"),customShow:function(){var e=i.find("[reminput]");e.focus(),e.on("keydown",function(e){e.metaKey+(e.metaKey||e.ctrlKey)&&e.keyCode==$zcg.ENTER_KEYCODE&&t.create()})},customHide:function(){t._clearDatePickerWidget(),t.closeView()}})},r.closeView=function(){this._clearDatePickerWidget(),this.getContainer().remove(),Clickoutside.clear("inlineremwin")},r.switchType=function(e,t){e=$(t.target);var i=e.attr("assign");switch(i){case"self":this._changeType(!0),e.parent().siblings("[userpicker]").hide();break;case"others":this._changeType(!1),e.parent().siblings("[userpicker]").show()}},r.bindEvents=function(){var e=this;$(document).on("click","[inlinerembtn]",function(t){var i=$(this),a=i.attr("purpose");if(a)if(t.stopPropagation(),"function"==typeof e[a])e[a](i,t);else{var s=a.split("."),n=s[0],r=s[1];"function"==typeof e[n][r]&&e[n][r].call(e,i,t)}})},r.bindEvents()):r&&n&&(r._setParent(a),r._setContent(n.content),r._setTime(n.time),r._setMessageDetails(n.message),r._resetAssignees()),t(r),r},getPrefill:function(e,t,i){var a={},s=$("#"+e).find('[msguid="'+t+'"]'),n=s.find("[msgtype=msg]");if(n.length){a.content=Markdown.convertToActualMsg(n[0]),a.time=n.find("#"+i).attr("parsedtime");var r={chat_id:e,time:s.attr("msgtime")};a.message=r}return a}}}();var Embed={},EmbedUI={};Embed={CUREMBEDCONFIG:{},enablelivesupport:0,data:{},status:{ENABLED:1},addData:function(e,t){this.data[e]={};for(var i=t.length,a=0;i>a;a++)this.data[e][t[a].EMBED_ID]=t[a]},getData:function(e,t){return"undefined"==typeof t?this.data[e]:this.data[e][t]},updateEmbed:function(e,t){"undefined"==typeof this.data[e]&&(this.data[e]={}),this.data[e][t.EMBED_ID]=t},deleteEmbed:function(e,t){delete this.data[e][t]},add:function(e,t,i,a){$ZCAjx.ajax({url:"/addem.do",type:"POST",data:{name:t,type:e,style:a,title:i,status:Embed.status.ENABLED},success:function(e){Embed.CUREMBEDCONFIG=e.tableToRowList.EmbedChats[0],EmbedUI.updateURL(Embed.CUREMBEDCONFIG)},paramdesc:{name:"Embed Name",style:"Style Colors",title:"Title"}})},modify:function(e,t,i,a,s){$ZCAjx.ajax({url:"/modem.do",type:"POST",data:{embedid:e,type:t,name:i,title:a,style:s},success:function(e){Embed.CUREMBEDCONFIG=e.tableToRowList.EmbedChats[0],EmbedUI.updateURL(Embed.CUREMBEDCONFIG)}})},update:function(e,t,i){$ZCAjx.ajax({url:"/updtem.do",type:"POST",data:{embdid:e,type:t},success:function(e){if("delete"!==t){var a=e.tableToRowList.EmbedChats[0];Embed.updateEmbed(i,a),EmbedUI.updateURL(a)}}})},get:function(e){$ZCAjx.ajax({url:"/getem.do",data:{type:e},success:function(t){var i=t.tableToRowList.EmbedChats,a="undefined"!=typeof i?i:[];Embed.addData(e,a),EmbedUI.populate(e)}})},getLivesupportCount:function(){$ZCAjx.ajax({url:"/getemcount.do",success:function(e){Embed.enablelivesupport=parseInt(e)}})},clearShoutBoxHistory:function(e){$ZCAjx.ajax({url:"/clearchat.do",type:"POST",data:{id:e,type:"shoutbox"},status:{success:"common.history.clear",error:"history.clear.error"}})}},EmbedUI={EMBEDFULLFORM:{sb:"shoutbox",ec:"livechat",ls:"livesupport"},DEFAULTTEMPLATE:"rosybrown",CURTEMPLATE:"rosybrown",CURPALETTEPOS:"",CHATNAME:"",PALETTEPOSITION:{emtitletextcolour:"zcttxtclr",emtitlebgcolour:"zcttbgclr",embodybgcolour:"zcbdbgclr",embodylayoutcolour:"zcbdbdrclr"},TEMPLATE:{rosybrown:{titletext:"#ffffff",titlebg:"#d48e8c",bodybg:"#f3cecd",bodylayout:"#d48e8c"},darksalmon:{titletext:"#ffffff",titlebg:"#e49881",bodybg:"#f7d3c8",bodylayout:"#e49881"},burlywood:{titletext:"#ffffff",titlebg:"#e4ca7d",bodybg:"#f3e7b5",bodylayout:"#e4ca7d"},gray:{titletext:"#ffffff",titlebg:"#969c78",bodybg:"#d6dabd",bodylayout:"#969c78"},darkseagreen:{titletext:"#ffffff",titlebg:"#90c3a2",bodybg:"#c5e6d3",bodylayout:"#90c3a2"},skyblue1:{titletext:"#ffffff",titlebg:"#82d5cd",bodybg:"#caf6f3",bodylayout:"#82d5cd"},skyblue2:{titletext:"#ffffff",titlebg:"#84bdd8",bodybg:"#d6eff6",bodylayout:"#84bdd8"}},init:function(){},bindAddEvents:function(e){e.find("#emleft").on("focusin","[type='text']",function(){var e=$("#embedaddwin"),t=e.find(this);t.hasClass("error")&&(t.removeClass("error"),e.find("#emerrmsg").slideUp()),EmbedUI.regenerate(),"emname"!==this.id&&"emtitle"!==this.id&&e.find("#emtemplate").find("[colour='"+EmbedUI.CURTEMPLATE+"']").removeClass("sel")}),e.find("#emleft").on("keyup","[type='text']",function(e){var t=$("#embedaddwin"),i=t.find(this);if(27===e.keyCode&&""!==e.target.value&&(e.stopPropagation(),i.val("")),"emtitle"===this.id||"emname"===this.id){var a=27===e.keycode||""===e.target.value?EmbedUI.CHATNAME:e.target.value;t.find("#emchattitle").text(a),"emname"===this.id&&(""===e.target.value&&(a=""),t.find("#emtitle").val(a))}else $WC.Matcher.check("hexcolourcode",e.target.value,!0)&&EmbedUI.applyColourCode(e)}),e.find("#emtemplate").on("click","[colour]",function(){var e=$("#embedaddwin");e.find("#emtemplate").find("[colour='"+EmbedUI.CURTEMPLATE+"']").removeClass("sel"),EmbedUI.CURTEMPLATE=this.getAttribute("colour"),EmbedUI.regenerate(),e.find(this).addClass("sel"),EmbedUI.applyTemplate(EmbedUI.CURTEMPLATE)}),e.find("#emcolourpalette").on("click mouseover mouseout","li",function(e){"click"===e.type&&Clickoutside.handleClickOnChild(e),EmbedUI.applyColour(e,EmbedUI.CURPALETTEPOS.substring(2,EmbedUI.CURPALETTEPOS.lastIndexOf("colour")))}),e.on("click","[purpose]",function(e){var t=$("#embedaddwin"),i=t.find(this),a=i.attr("purpose");"url"===a?i.select():"colour"===a?($("#emtemplate").find("[colour='"+EmbedUI.CURTEMPLATE+"']").removeClass("sel"),EmbedUI.regenerate(),EmbedUI.loadColourPalette(e)):"viewlist"===a?($WC.$Win.destroy("embedaddwin"),EmbedUI.createListWindow(t.find("#emwinbody").attr("chattype"))):"generate"===a&&EmbedUI.generateURL(this)})},bindListEvents:function(e){e.on("click","[purpose]",function(e){var t=$("#embedlistwin"),i=t.find(this),a=i.attr("purpose");if("catagory"===a)EmbedUI.changeOption(t,i);else if("embedaction"===a){var s=i.find(e.target),n=s.attr("action"),r=i.attr("id");if("url"===n)s.select();else if("clear"===n){var o=Template.DialogBoxImage.replace(/{DETAILEDIMAGE}/g,'<div class="msi-history"></div>'),l='<div class="bold pdbm">'+Resource.getRealValue("info.shoutbox.history.clear")+"</div><div>"+Resource.getRealValue("confirm.shoutbox.history.clear")+"</div>";$WC.$Dlg.confirm({id:"clearshouthistory"+r,bodyhtml:l,imagehtml:o,buttons:[{text:Resource.getRealValue("common.clear"),action:function(){Embed.clearShoutBoxHistory(r)}}]})}else if("enable"===n||"disable"===n){var c=i.attr("type");Embed.update(r,n,c),s.attr("action","enable"===n?"disable":"enable").html(Resource.getRealValue("enable"===n?"common.disable":"common.enable"))}else if("delete"===n){var o=Template.DialogBoxImage.replace(/{DETAILEDIMAGE}/g,'<div class="msi-embdimg"></div>'),l='<div class="bold pdbm">'+Resource.getRealValue("info.embed.delete")+"</div><div>"+Resource.getRealValue("confirm.embed.delete")+"</div>";$WC.$Dlg.confirm({id:"deleteembed"+r,bodyhtml:l,imagehtml:o,buttons:[{text:Resource.getRealValue("common.delete"),action:function(){var e=i.attr("type");Embed.update(r,n,e),Embed.deleteEmbed(e,r),i.slideUp(500,function(){i.remove(),$.isEmptyObject(Embed.getData(e))&&t.find("#embedcontent").prepend(EmbedUI.getNoConfHTML(e))})}}]})}}else("addsb"===a||"addec"==a)&&($WC.$Win.destroy("embedlistwin"),EmbedUI.createAddWindow(a.substring(3)))})},createAddWindow:function(e){if(this.CHATNAME=Resource.getRealValue("embed."+this.EMBEDFULLFORM[e]),!$WC.$Win.isExist("embedaddwin")){var t=$WC.$Win.create({id:"embedaddwin","class":"embedaddwin",header:'<a class="floatr imntwlnk" purpose="viewlist">'+Resource.getRealValue("embed.list")+"</a><span>"+this.CHATNAME+"</span>",html:Template.EmbedChatWindow.replace(/{COLOURPALETTEHTML}/g,Template.ColourPalette),closefn:function(){EmbedUI.CURTEMPLATE=EmbedUI.DEFAULTTEMPLATE,Embed.CUREMBEDCONFIG={}}});t.find("#emwinbody").attr("chattype",e),t.find("#emchattitle").text(this.CHATNAME),this.bindAddEvents(t),this.applyTemplate(this.CURTEMPLATE),t.find("[colour='"+this.CURTEMPLATE+"']").addClass("sel")}},createListWindow:function(e){if(!$WC.$Win.isExist("embedlistwin")){var t=$WC.$Win.create({id:"embedlistwin","class":"embedlistwin",header:Resource.getRealValue("setting.embed"),html:Template.EmbedchatSetting.replace(/{LIVESUPPORT}/g,Embed.enablelivesupport?'<li><div option="ls" purpose="catagory"><em class="zcsetng_arw"></em>'+Resource.getRealValue("embed.livesupport")+"</div></li>":""),openfn:function(){$("#embedlistwin").find('[option="'+e+'"]').addClass("sel")},closefn:function(){Embed.data={}}});Embed.get(e),EmbedUI.bindListEvents(t)}},populate:function(e){var t=Embed.getData(e),i="";"undefined"!=typeof t?i=$.isEmptyObject(t)?this.getNoConfHTML(e):this.getEmbedHTML(e,t):(Embed.get(e),i='<div class="zcldng"></div>',"ls"!==e&&(i+=this.getFooterHTML(e))),$("#embedcontent").html(i)},changeOption:function(e,t){e.find("[option]").removeClass("sel"),t.addClass("sel"),this.populate(t.attr("option"))},getEmbedHTML:function(e,t){var i="";for(var a in t){var s='<div id="'+t[a].EMBED_ID+'" type="'+e+'" purpose="embedaction" class="zcembddiv"><div class="bold font13">{EMBEDNAME}</div><textarea readonly="true" action="url" class="zcembtxtara">'+EmbedUI.addHTMLCodeToURL(t[a])+'</textarea><div class="zcembdinf">{SHOUTBOXCLEAR}<span action="{ATTR-EMBEDSTATUS}" class="ellips">'+Resource.getRealValue("1"===t[a].STATUS?"common.disable":"common.enable")+'</span> | <span action="delete" class="ellips">'+Resource.getRealValue("common.delete")+"</span></div></div>";i+=s.replace(/{SHOUTBOXCLEAR}/g,"sb"===e?'<span action="clear" class="ellips">'+Resource.getRealValue("embed.clearhistory")+"</span> | ":"").replace(/{ATTR-EMBEDSTATUS}/g,"1"===t[a].STATUS?"disable":"enable").replace(/{EMBEDNAME}/g,t[a].NAME)}return i+this.getFooterHTML(e)},getNoConfHTML:function(e){var t='<div class="emcht-inftxtmn">{EMBEDICON}<div class="emcht-inftxt">{NOINFO}</div></div>';if("ls"===e)t=t.replace(/{EMBEDICON}/g,"").replace(/{NOINFO}/g,Resource.getRealValue("embed.no.configuration")),Embed.enablelivesupport=0;else{var i='<div class="{ICON}"></div>'.replace(/{ICON}/g,"sb"===e?"msi-shoutbox":"msi-livecht");t=t.replace(/{EMBEDICON}/g,i).replace(/{NOINFO}/g,Resource.getRealValue("embed.no.configuration.and.configure"))}return"ls"!==e&&(t+=this.getFooterHTML(e)),t},getFooterHTML:function(e){var t='<div class="zcembdftrmn">';return"ls"!==e&&(t+='<input purpose="add'+e+'" class="floatr btn" type="button" value="'+Resource.getRealValue("common.add")+'"/>'),t+='<div class="zcembdftrmsg">'+Resource.getRealValue("embed.desc."+this.EMBEDFULLFORM[e])+"</div></div>"},regenerate:function(){var e=$("#emleft");e.find("#emgenerate").removeClass("disabledtxt").prop("disabled",!1),e.find("#emurl").val("")},applyTemplate:function(e){var t=$("#emcustomcolour");for(var i in this.TEMPLATE[e])t.find("#em"+i+"code").val(this.TEMPLATE[e][i].substring(1)).removeClass("error"),t.find("#em"+i+"colour").css("background-color",this.TEMPLATE[e][i]);$("#emerrmsg").slideUp(),this.updatePreview(this.TEMPLATE[e])},applyColourCode:function(e){var t={},i=e.target.id.substring(2,e.target.id.lastIndexOf("code"));$("#em"+i+"colour").css("background-color","#"+e.target.value),t[i]="#"+e.target.value,this.updatePreview(t)},applyColour:function(e,t){var i=$("#emleft"),a=i.find("#emcustomcolour"),s=this.rgbToHex(i.find(e.target).css("background-color")),n={};"mouseout"===e.type&&(s=this.rgbToHex(a.find("#em"+t+"colour").css("background-color"))),"click"===e.type&&(a.find("#em"+t+"colour").css("background-color","#"+s),a.find("#em"+t+"code").removeClass("error").val(s)),n[t]="#"+s,this.updatePreview(n)},updatePreview:function(e){var t=$("#emchatlayout");"undefined"!=typeof e.titletext&&t.find("#emchattitle").css("color",e.titletext),"undefined"!=typeof e.titlebg&&t.find("#emchattitle").css("background-color",e.titlebg),"undefined"!=typeof e.bodybg&&t.css("background-color",e.bodybg),"undefined"!=typeof e.bodylayout&&(t.css("border","2px solid "+e.bodylayout),t.find("#emchatmidlayout").css("border-bottom-color",e.bodylayout),t.find("#emchatbotlayout").css("border-bottom-color",e.bodylayout),t.find("#emchatbotlayout").css("border-top-color",e.bodylayout))},addHTMLCodeToURL:function(e){return'<div style="height:400px;"><iframe style="overflow:hidden;width:100%;height:100%;" frameborder="0" border="0" src="'+e.URL+"&chaturl="+encodeURIComponent(e.NAMEURL)+"&V="+encodeURIComponent(e.STYLE)+'"></iframe></div>'},updateURL:function(e){var t=$("#emleft");t.find("#emurl").val(this.addHTMLCodeToURL(e)),t.find("#emgenerate").attr("embedid",e.EMBED_ID)},generateURL:function(e){var t=$("#emwinbody"),i=t.find("#emleft"),a=i.find("#emname").val().trim(),s=i.find("#emtitle").val().trim(),n=i.find("#emcustomcolour").find("input[type='text']");if(this.inputValidation(a,s,n)){var r=t.attr("chattype"),o=n[0].value+"-"+n[1].value+"-"+n[3].value+"-"+n[2].value;if(i.find("#emgenerate").addClass("disabledtxt").prop("disabled",!0),e.hasAttribute("embedid")){var l=e.getAttribute("embedid");(Embed.CUREMBEDCONFIG.NAME!==a||Embed.CUREMBEDCONFIG.STYLE!==o+"-"+s)&&Embed.modify(l,r,a,s,o)}else Embed.add(r,a,s,o)}},inputValidation:function(e,t,i){var a=$("#emleft"),s=i.length,n=0;if($WC.Matcher.check("empty",e))return a.find("#emname").addClass("error"),a.find("#emerrmsg").html(Resource.getRealValue("embed.name.error")).show(),!1;if($WC.Matcher.check("empty",t))return a.find("#emtitle").addClass("error"),a.find("#emerrmsg").html(Resource.getRealValue("embed.chattitle.error")).show(),!1;for(;s>n;n++)if(!$WC.Matcher.check("hexcolourcode",i[n].value=i[n].value.trim()))return a.find("#"+i[n].id).addClass("error"),a.find("#emerrmsg").html(Resource.getRealValue("embed.colourcode.error")).show(),!1;return!0},loadColourPalette:function(e){var t=$("#emleft"),i=t.find("#emcolourpalette"),a=e.target.id;""!==this.CURPALETTEPOS&&i.removeClass(this.PALETTEPOSITION[this.CURPALETTEPOS]),i.addClass(this.PALETTEPOSITION[a]),this.CURPALETTEPOS=a,t.find("#"+a).parent().addClass("sel"),Clickoutside.bind({event:e,srcid:a,destid:"emcolourpalette",callback:function(e){$("#"+e).parent().removeClass("sel")}})},componentToHex:function(e){var t=e.toString(16);return 1===t.length?"0"+t:t},rgbToHex:function(e){var t=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(",");return this.componentToHex(parseInt(t[0]))+this.componentToHex(parseInt(t[1]))+this.componentToHex(parseInt(t[2]))}};var Tour={};Tour={uimapping:{one2onechat:{v0:["zcsharefile","LT"],v1:["zcsmileys","RT"]},adhocchat:{v0:["zcslash","L"],v2:["zcaddmember","RB"]},channels:{v0:["zcmention","L"],v1:["zcpinchat","RT"],v2:["zcmutechannel","RB"]},history:["zchistory","RB"],starmsg:["zcstarredmessages","RB"],mentions:["zcatmention","RB"],reminders:["zcreminders","RB"],msgactions:{v0:["zcmsgactions","RT"]}},updateTourMapping:function(e){var t=ChatUI.exist[e];if(t){var i=t.getPermission();if(MMChat.isCallIconAllowed()&&i.video&&MMChat.isAudioVideoCallEnabled()&&$.extend(Tour.uimapping.one2onechat,{v2:["zcaudio","LM"]}),t.hasPermissionToHostPrimeTime()){var a=Conference.isAudioConferenceAllowed()||Conference.isVideoConferenceAllowed()?"LM":"RB";$.extend(Tour.uimapping.adhocchat,{v1:["zcbroadcast",a]})}Reactions.isEnabled()&&$.extend(Tour.uimapping.msgactions,{v1:["zcmsgreactions","RT"]})}},isNewTourAvailable:function(e){var t=$DB.get("tour");if(!$WC.$CUtil.isEmptyObject(t)||t.istourrestricted)return!1;var i=e+"tourversion",a=JSON.parse($zcg._TOURVERSIONS),s=Settings.getFromObj(i,!0);return $.isEmptyObject(a)?!1:s!==a[i]},show:function(e,t,i,a){if(!$ZCVideoBroadcast.isVideoBroadcastPage){var s=i?3e3:0;clearTimeout(this.timer),this.timer=setTimeout(function(){if(!t||MainUI.isChatinViewport(t)){var i=$("#onboardtour"),s=i.attr("module")===e;if(s){if(t!==i.attr("chid"))return}else{if(i.length)return;Tour.updateTourMapping(t)}var n=Tour.uimapping[e];if(t=t||"",$WC.$CUtil.isArray(n))var r=n;else if("object"==typeof n){var o=Settings.getFromObj(e+"tourversion",!0);s&&(o=Tour.getTourVersion());var r=n[o]}if(r){i.attr("id","dummyonbrd");var l='<div class="onboardtour {{onboardWrapperClass}}" data-position="{{position}}" module="{{module}}" id="onboardtour" version="{{version}}" chid="{{chid}}" data-target="{{target}}">{{tourHTML}}</div>',c="",d="";if(Tour.fadeOutAndRemove(i),"reminders"==e)c=RemindersUI.getTourHTML();else if("msgactions"===e&&"v1"===o)c=Reactions.getTourHTML()+Tour.getNavHTML(n,o),d="whitebgtour";else{var u=Template.FeatureTour.replace(/{TITLE}/g,Resource.getRealValue("tour."+r[0]+".title")).replace(/{DESC}/g,Resource.getRealValue("tour."+r[0]+".desc"));c=u+Tour.getNavHTML(n,o)}if("adhocchat"===e){var m=$("#groupcall"+t);"v1"===o?m.addClass("shw-drp-dwn"):m.removeClass("shw-drp-dwn")}else if("one2onechat"===e){var p=$("#call"+t);"v2"===o?p.addClass("shw-drp-dwn"):p.removeClass("shw-drp-dwn")}l=$WC.template.replace(l,{tourHTML:c,position:r[1],module:e,version:o,chid:t,target:r[0],onboardWrapperClass:d},"InSecureHTML"),$("body").append(l),"function"==typeof a&&a(),Tour.positionTourTip(),Clickoutside.bind({destid:"onboardtour",closeOnClickSrc:!1,customHide:function(){Tour.closeTour(!0)}}),Tour.bindEvents()}}},s)}},getNavHTML:function(e,t){var i='<span class="nexttip" data-purpose="close-tour">'+Resource.getRealValue("tour.gottip")+"</span>";if($WC.$CUtil.isArray(e))return'<div class="nav">'+i+"</div>";for(var a=$Util.getObjectKeysLength(e),s="",n='<span class="nexttip" data-purpose="next-tip">'+Resource.getRealValue("tour.nexttip")+"</span>",r=0;a>r;r++)s+='<em data-nav="v'+r+'"></em>';return t==="v"+(a-1)&&(n=i),'<div class="nav"><span>'+s+"</span>"+n+"</div>"},getTourVersion:function(){var e=$("#onboardtour").attr("version");return e&&"string"==typeof e?"v"+(parseInt(e.replace(/^\D+/g,""))+1):""},positionTourTip:function(){var e=$("#onboardtour");if(e.length){var t=e.attr("chid"),i=$(t?"#"+t:"body"),a=i.find('[data-purpose="'+e.attr("data-target")+'"]'),s=24;if(a.length){var n,r=a.offset(),o=e.attr("data-position"),l=r.top-e.outerHeight()-20;"LT"===o?n=r.left+a.width()/2-s:"RT"===o?n=r.left-e.outerWidth()+a.outerWidth()/2+s:"RB"===o?(l=r.top+a.outerHeight()+10,n=r.left-e.outerWidth()+a.outerWidth()/2+s):"L"===o?(n=r.left+10,l+=10):"LM"===o&&(n=r.left-e.outerWidth()-10,l=r.top-e.outerHeight()/2+a.outerHeight()/2-10),e.css({top:l+10+"px",left:n+"px"})}}},bindEvents:function(){var e=$("#onboardtour");e.on("click",'[data-purpose="next-tip"]',function(){var t=e.attr("module");Tour.updateTourObj(t),Tour.show(e.attr("module"),e.attr("chid"))}),e.on("click",'[data-purpose="close-tour"]',function(){Tour.closeTour()})},updateTourObj:function(e,t){var i={};e+="tourversion";var a=Settings.getFromObj(e,!0),s=JSON.parse($zcg._TOURVERSIONS),n=s[e];t||"string"!=typeof a||(n="v"+(parseInt(a.replace(/^\D+/g,""))+1)),i[e]=n,Settings.update(i)},updateStorageTourObj:function(){var e=new Date;e.setDate(e.getDate()+1),$DB.update("tour",{istourrestricted:!0},e.getTime())},closeTour:function(e){var t=$("#onboardtour");if(t.length){Tour.updateStorageTourObj();var i=t.attr("module"),a=t.attr("version"),s=t.attr("chid"),n=e?!1:!0;Tour.updateTourObj(i,n),$(".tour-action").removeClass("tour-action"),$('.touranim[module="'+i+'"]').remove(),Tour.fadeOutAndRemove(t),"adhocchat"===i&&"v1"===a?$("#groupcall"+s).removeClass("shw-drp-dwn"):"one2onechat"===i&&"v2"===a&&$("#call"+s).removeClass("shw-drp-dwn")}},fadeOutAndRemove:function(e){e&&e.length&&e.fadeOut(300,function(){e.remove()})},showLoadingAnimation:function(e){if(!$('[data-purpose="tour_animated"]').length){var t,i='<div class="touranim" data-purpose="tour_animated" module="'+e+'"></div>',a={mentions:"atmention",starmsg:"starredmessages",reminders:"reminders"},s=a[e]||e,n=$("#ztb-"+s);$('[data-purpose="tour_animated"]').remove(),n.attr("onboarding",""),n.find(".ztb-icons").before(t=$(i)),n.on("click",function(t){var i=$(this);i.is("[onboarding]")&&(Tour.topbarTourClickHandler(t,e),$(this).removeAttr("onboarding"))}),t.on("click",function(t){Tour.topbarTourClickHandler(t,e)})}},topbarTourClickHandler:function(e,t){e.stopImmediatePropagation();var i=$("#onboardtour");i.length?Tour.fadeOutAndRemove(i,function(){Tour.show(t)}):Tour.show(t)},handleFirstMsgTour:function(e){var t=e.parents('[purpose="chatview"]');if(t.length){if(Tour.fadeOutAndRemove(t.find('[data-purpose="zcemptystate"]')),SecurityManager.hasPermission(Modules.MessageOptions)&&Tour.isNewTourAvailable("msgactions")&&!$("#onboardtour").length){var i=e.find(".msgtxt:last");i.find('[purpose="messageoperations"]').length&&Tour.show("msgactions",t.attr("id"),!0,function(){var t=e.find(".msgtxt:last");t.addClass("tour-action").find('[purpose="messageoperations"]').attr("data-purpose","zcmsgactions"),t.find('[purpose="addReactions"]').attr("data-purpose","zcmsgreactions")})}Tour.isNewTourAvailable("history")&&Tour.showLoadingAnimation("history")}}};var CheckList=function(){var e=[],t=[],i="",a=function(){var i=$("#onboardchecklist");t.find('ul[data-purpose="checklist-nav"]').on("click","li",function(){s($(this))}),e.find("#profilephoto").on("change",function(){r(this)}),e.find('ul[data-purpose="list"]').on("click","li",function(){n($(this))}),i.find('[purpose="addmultipleuser"]').on("click",function(){$(this).parent().remove();var e=InviteUsersToOrg.getDataFromTable(!1,i.find("#invite_inputbox"));i.find("#invteinput").html(InviteUsersToOrg.getTextDom()),i.find("#invite_inputbox").find("input").empty(),InviteUsersToOrg.populateTextBox(e,!1,i.find("#invite_textbox")),e.invalid&&e.invalid.length&&p(u(e.invalid))}),i.find("[purpose='uploadfile']").on("change",function(e){i.find('[purpose="addmultipleuser"]').parent().remove();var t=InviteUsersToOrg.getDataFromTable(!1,i.find("#invite_inputbox"));i.find("#invite_textbox").length||i.find("#invteinput").html(InviteUsersToOrg.getTextDom()),InviteUsersToOrg.populatedatafromfile(e,this.files,!1,t)}),i.find("[data-module]").on("click",function(){o($(this))})},s=function(i){var a=i.attr("data-target");if(a&&a!==t.find(".sel").attr("data-target"))return"completed"===i.attr("data-status")?void CheckList.populateCompRHS(a):void e.stop().fadeOut(function(){CheckList.populateRHS(a)})},n=function(e){var t=e.parents('[data-action="dropdown"]').find('[data-purpose="header"]');t.attr("key",e.attr("key")).html(e.html())},r=function(t){var i=e.find("[type='imgpreview']"),a=t.files[0],s=10;if("undefined"!=typeof a){if(!$Util.isValidImage(t,t.files,s))return;$Util.imgPrview(i,a)}},o=function(e){var t=e.attr("data-module"),i={createchannel:function(){ChannelsUI.create()},joinchannel:function(){ChannelsUI.List.loadAllowedChannelsView(!0)},getconnect:function(){QuickChat.createwin({classname:" chlstcht"},"adhocchatwin"),$('[data-target="checklist"]').remove()},createevent:function(){SecurityManager.hasPermission(Modules.Events)&&(EventsUI.add(),EventsUI.populate("evlist"),EventsUI.handle.showCreateWin())},invite:function(){d($("#invite_textbox").is(":visible")?InviteUsersToOrg.getDatafromtextbox(!1):InviteUsersToOrg.getDataFromTable(!0))},dolater:function(){var t=e.attr("data-target");t&&MainUI.getMefront(t,!0),$("#onboardchecklist").fadeOut(600,function(){$(this).remove(),CheckList.updateCount(!0)})},saveprofile:function(){CheckList.saveProfileDetails(e)},deletephoto:function(){y()},openurl:function(){b(e.attr("url"),l(e))}};"function"==typeof i[t]&&i[t]()},l=function(e){return e.parents('[data-purpose="checklistRHS"]').attr("module")},c=function(e){e.find('[data-target="touranim"]').remove()},d=function(t){if(t&&t.valid&&t.valid.length){for(var i=[],a=0,s=t.valid.length;s>a&&!(i.length>=100);a++)i.push({email:t.valid[a].email,fname:t.valid[a].fname});if(t.invalid.length&&!e.find('[data-target="continue"]').length){if(i.length>0)return e.find('[data-module="invite"]').html(Resource.getRealValue("common.continue")).attr("data-target","continue"),void p(u(t.invalid));p(u(t.invalid))}i.length>0&&(e.find('[data-module="invite"]').addClass("zcloadling"),m(i))}else t&&t.invalid&&t.invalid.length?p(u(t.invalid)):($("#invite_textbox").addClass("errortxt"),p(Resource.getRealValue("checklist.invite.empty")+"",!1))},u=function(e){for(var t='<div class="invalid dIB posrel">'+Resource.getRealValue("checklist.emailaddresses")+'<div class="mail_ttip">{{EMAILADDRESSES}}</div></div>',i="<ul>",a=0,s=e.length;s>a;a++)i+="<li>"+$WC.$CUtil.processXSS(e[a])+"</li>";return i+="</ul>",t=t.replace(/{{EMAILADDRESSES}}/g,i),t='<div class="emailinvalid">'+Resource.getRealValue("invite.users.error",[t])+"</div>"},m=function(e){$ZCAjx.ajax({url:"/inviteuserstoorg.do",type:"POST",data:{userslist:JSON.stringify(e),onboardingstepkey:"invite_member"},success:function(){CheckList.markInviteMemberComplete(),OrgInvitees.getOrgInviteesForLHS()},error:function(){p(),$('[data-module="invite"]').removeClass("zcloadling")}})},p=function(e){if(e){var t='<div class="email_check">'+e+"</div>"||T.errorfield;$("#chkerrorfield").html(t)}},h=function(){var t=e.find('[data-purpose="list"]');ZCScroll.customScroll(t),e.find("#timezone").on("keyup",function(e){var t=$(this),i=e.which;if(i!==$zcg.UP_KEYCODE&&i!==$zcg.DOWN_KEYCODE){i===$zcg.ESCAPE_KEYCODE&&t.trigger("blur");var a=g($.trim(t.val())).html;""===a&&(a="<li>"+Resource.getRealValue("common.search.result.none")+"</li>"),t.parent().find('[data-purpose="list"]').html(a)}})},g=function(e){for(var t=[["Etc/GMT+12","( UTC -12:00 ) GMT-12:00(Etc/GMT+12)"],["Etc/GMT+11","( UTC -11:00 ) GMT-11:00(Etc/GMT+11)"],["Pacific/Midway","( UTC -11:00 ) Samoa Standard Time(Pacific/Midway)"],["Pacific/Niue","( UTC -11:00 ) Niue Time(Pacific/Niue)"],["Pacific/Pago_Pago","( UTC -11:00 ) Samoa Standard Time(Pacific/Pago_Pago)"],["Pacific/Samoa","( UTC -11:00 ) Samoa Standard Time(Pacific/Samoa)"],["US/Samoa","( UTC -11:00 ) Samoa Standard Time(US/Samoa)"],["Etc/GMT+10","( UTC -10:00 ) GMT-10:00(Etc/GMT+10)"],["HST","( UTC -10:00 ) Hawaii Standard Time(HST)"],["Pacific/Honolulu","( UTC -10:00 ) Hawaii Standard Time(Pacific/Honolulu)"],["Pacific/Johnston","( UTC -10:00 ) Hawaii Standard Time(Pacific/Johnston)"],["Pacific/Rarotonga","( UTC -10:00 ) Cook Is. Time(Pacific/Rarotonga)"],["Pacific/Tahiti","( UTC -10:00 ) Tahiti Time(Pacific/Tahiti)"],["SystemV/HST10","( UTC -10:00 ) Hawaii Standard Time(SystemV/HST10)"],["US/Hawaii","( UTC -10:00 ) Hawaii Standard Time(US/Hawaii)"],["Pacific/Marquesas","( UTC -9:-30 ) Marquesas Time(Pacific/Marquesas)"],["America/Adak","( UTC -9:00 ) Hawaii-Aleutian Daylight Time(America/Adak)"],["America/Atka","( UTC -9:00 ) Hawaii-Aleutian Daylight Time(America/Atka)"],["US/Aleutian","( UTC -9:00 ) Hawaii-Aleutian Daylight Time(US/Aleutian)"],["Etc/GMT+9","( UTC -9:00 ) GMT-09:00(Etc/GMT+9)"],["Pacific/Gambier","( UTC -9:00 ) Gambier Time(Pacific/Gambier)"],["SystemV/YST9","( UTC -9:00 ) Alaska Standard Time(SystemV/YST9)"],["AST","( UTC -8:00 ) Alaska Daylight Time(AST)"],["America/Anchorage","( UTC -8:00 ) Alaska Daylight Time(America/Anchorage)"],["America/Juneau","( UTC -8:00 ) Alaska Daylight Time(America/Juneau)"],["America/Nome","( UTC -8:00 ) Alaska Daylight Time(America/Nome)"],["America/Yakutat","( UTC -8:00 ) Alaska Daylight Time(America/Yakutat)"],["SystemV/YST9YDT","( UTC -8:00 ) Alaska Daylight Time(SystemV/YST9YDT)"],["US/Alaska","( UTC -8:00 ) Alaska Daylight Time(US/Alaska)"],["Etc/GMT+8","( UTC -8:00 ) GMT-08:00(Etc/GMT+8)"],["Pacific/Pitcairn","( UTC -8:00 ) Pitcairn Standard Time(Pacific/Pitcairn)"],["SystemV/PST8","( UTC -8:00 ) Pacific Standard Time(SystemV/PST8)"],["America/Dawson","( UTC -7:00 ) Pacific Daylight Time(America/Dawson)"],["America/Ensenada","( UTC -7:00 ) Pacific Daylight Time(America/Ensenada)"],["America/Los_Angeles","( UTC -7:00 ) Pacific Daylight Time(America/Los_Angeles)"],["America/Tijuana","( UTC -7:00 ) Pacific Daylight Time(America/Tijuana)"],["America/Vancouver","( UTC -7:00 ) Pacific Daylight Time(America/Vancouver)"],["America/Whitehorse","( UTC -7:00 ) Pacific Daylight Time(America/Whitehorse)"],["Canada/Pacific","( UTC -7:00 ) Pacific Daylight Time(Canada/Pacific)"],["Canada/Yukon","( UTC -7:00 ) Pacific Daylight Time(Canada/Yukon)"],["Mexico/BajaNorte","( UTC -7:00 ) Pacific Daylight Time(Mexico/BajaNorte)"],["PST","( UTC -7:00 ) Pacific Daylight Time(PST)"],["PST8PDT","( UTC -7:00 ) Pacific Daylight Time(PST8PDT)"],["SystemV/PST8PDT","( UTC -7:00 ) Pacific Daylight Time(SystemV/PST8PDT)"],["US/Pacific","( UTC -7:00 ) Pacific Daylight Time(US/Pacific)"],["US/Pacific-New","( UTC -7:00 ) Pacific Daylight Time(US/Pacific-New)"],["America/Dawson_Creek","( UTC -7:00 ) Mountain Standard Time(America/Dawson_Creek)"],["America/Hermosillo","( UTC -7:00 ) Mountain Standard Time(America/Hermosillo)"],["America/Phoenix","( UTC -7:00 ) Mountain Standard Time(America/Phoenix)"],["Etc/GMT+7","( UTC -7:00 ) GMT-07:00(Etc/GMT+7)"],["MST","( UTC -7:00 ) Mountain Standard Time(MST)"],["PNT","( UTC -7:00 ) Mountain Standard Time(PNT)"],["SystemV/MST7","( UTC -7:00 ) Mountain Standard Time(SystemV/MST7)"],["US/Arizona","( UTC -7:00 ) Mountain Standard Time(US/Arizona)"],["America/Boise","( UTC -6:00 ) Mountain Daylight Time(America/Boise)"],["America/Cambridge_Bay","( UTC -6:00 ) Mountain Daylight Time(America/Cambridge_Bay)"],["America/Chihuahua","( UTC -6:00 ) Mountain Daylight Time(America/Chihuahua)"],["America/Denver","( UTC -6:00 ) Mountain Daylight Time(America/Denver)"],["America/Edmonton","( UTC -6:00 ) Mountain Daylight Time(America/Edmonton)"],["America/Inuvik","( UTC -6:00 ) Mountain Daylight Time(America/Inuvik)"],["America/Mazatlan","( UTC -6:00 ) Mountain Daylight Time(America/Mazatlan)"],["America/Shiprock","( UTC -6:00 ) Mountain Daylight Time(America/Shiprock)"],["America/Yellowknife","( UTC -6:00 ) Mountain Daylight Time(America/Yellowknife)"],["Canada/Mountain","( UTC -6:00 ) Mountain Daylight Time(Canada/Mountain)"],["MST7MDT","( UTC -6:00 ) Mountain Daylight Time(MST7MDT)"],["Mexico/BajaSur","( UTC -6:00 ) Mountain Daylight Time(Mexico/BajaSur)"],["Navajo","( UTC -6:00 ) Mountain Daylight Time(Navajo)"],["SystemV/MST7MDT","( UTC -6:00 ) Mountain Daylight Time(SystemV/MST7MDT)"],["US/Mountain","( UTC -6:00 ) Mountain Daylight Time(US/Mountain)"],["America/Belize","( UTC -6:00 ) Central Standard Time(America/Belize)"],["America/Costa_Rica","( UTC -6:00 ) Central Standard Time(America/Costa_Rica)"],["America/El_Salvador","( UTC -6:00 ) Central Standard Time(America/El_Salvador)"],["America/Guatemala","( UTC -6:00 ) Central Standard Time(America/Guatemala)"],["America/Managua","( UTC -6:00 ) Central Standard Time(America/Managua)"],["America/Regina","( UTC -6:00 ) Central Standard Time(America/Regina)"],["America/Swift_Current","( UTC -6:00 ) Central Standard Time(America/Swift_Current)"],["America/Tegucigalpa","( UTC -6:00 ) Central Standard Time(America/Tegucigalpa)"],["Canada/East-Saskatchewan","( UTC -6:00 ) Central Standard Time(Canada/East-Saskatchewan)"],["Canada/Saskatchewan","( UTC -6:00 ) Central Standard Time(Canada/Saskatchewan)"],["Chile/EasterIsland","( UTC -6:00 ) Easter Is. Time(Chile/EasterIsland)"],["Etc/GMT+6","( UTC -6:00 ) GMT-06:00(Etc/GMT+6)"],["Pacific/Easter","( UTC -6:00 ) Easter Is. Time(Pacific/Easter)"],["Pacific/Galapagos","( UTC -6:00 ) Galapagos Time(Pacific/Galapagos)"],["SystemV/CST6","( UTC -6:00 ) Central Standard Time(SystemV/CST6)"],["America/Cancun","( UTC -5:00 ) Central Daylight Time(America/Cancun)"],["America/Chicago","( UTC -5:00 ) Central Daylight Time(America/Chicago)"],["America/Indiana/Knox","( UTC -5:00 ) Central Daylight Time(America/Indiana/Knox)"],["America/Knox_IN","( UTC -5:00 ) Eastern Daylight Time(America/Knox_IN)"],["America/Menominee","( UTC -5:00 ) Central Daylight Time(America/Menominee)"],["America/Merida","( UTC -5:00 ) Central Daylight Time(America/Merida)"],["America/Mexico_City","( UTC -5:00 ) Central Daylight Time(America/Mexico_City)"],["America/Monterrey","( UTC -5:00 ) Central Daylight Time(America/Monterrey)"],["America/North_Dakota/Center","( UTC -5:00 ) Central Daylight Time(America/North_Dakota/Center)"],["America/North_Dakota/New_Salem","( UTC -5:00 ) Central Daylight Time(America/North_Dakota/New_Salem)"],["America/Rainy_River","( UTC -5:00 ) Central Daylight Time(America/Rainy_River)"],["America/Rankin_Inlet","( UTC -5:00 ) Central Daylight Time(America/Rankin_Inlet)"],["America/Winnipeg","( UTC -5:00 ) Central Daylight Time(America/Winnipeg)"],["CST","( UTC -5:00 ) Central Daylight Time(CST)"],["CST6CDT","( UTC -5:00 ) Central Daylight Time(CST6CDT)"],["Canada/Central","( UTC -5:00 ) Central Daylight Time(Canada/Central)"],["Mexico/General","( UTC -5:00 ) Central Daylight Time(Mexico/General)"],["SystemV/CST6CDT","( UTC -5:00 ) Central Daylight Time(SystemV/CST6CDT)"],["US/Central","( UTC -5:00 ) Central Daylight Time(US/Central)"],["US/Indiana-Starke","( UTC -5:00 ) Eastern Daylight Time(US/Indiana-Starke)"],["America/Atikokan","( UTC -5:00 ) Eastern Standard Time(America/Atikokan)"],["America/Bogota","( UTC -5:00 ) Colombia Time(America/Bogota)"],["America/Cayman","( UTC -5:00 ) Eastern Standard Time(America/Cayman)"],["America/Coral_Harbour","( UTC -5:00 ) Eastern Standard Time(America/Coral_Harbour)"],["America/Eirunepe","( UTC -5:00 ) Acre Time(America/Eirunepe)"],["America/Guayaquil","( UTC -5:00 ) Ecuador Time(America/Guayaquil)"],["America/Jamaica","( UTC -5:00 ) Eastern Standard Time(America/Jamaica)"],["America/Lima","( UTC -5:00 ) Peru Time(America/Lima)"],["America/Panama","( UTC -5:00 ) Eastern Standard Time(America/Panama)"],["America/Port-au-Prince","( UTC -5:00 ) Eastern Daylight Time(America/Port-au-Prince)"],["America/Porto_Acre","( UTC -5:00 ) Acre Time(America/Porto_Acre)"],["America/Rio_Branco","( UTC -5:00 ) Acre Time(America/Rio_Branco)"],["Brazil/Acre","( UTC -5:00 ) Acre Time(Brazil/Acre)"],["EST","( UTC -5:00 ) Eastern Standard Time(EST)"],["Etc/GMT+5","( UTC -5:00 ) GMT-05:00(Etc/GMT+5)"],["Jamaica","( UTC -5:00 ) Eastern Standard Time(Jamaica)"],["SystemV/EST5","( UTC -5:00 ) Eastern Standard Time(SystemV/EST5)"],["America/Indiana/Petersburg","( UTC -4:00 ) Central Daylight Time(America/Indiana/Petersburg)"],["America/Indiana/Vincennes","( UTC -4:00 ) Central Daylight Time(America/Indiana/Vincennes)"],["America/Detroit","( UTC -4:00 ) Eastern Daylight Time(America/Detroit)"],["America/Fort_Wayne","( UTC -4:00 ) Eastern Daylight Time(America/Fort_Wayne)"],["America/Grand_Turk","( UTC -4:00 ) Eastern Daylight Time(America/Grand_Turk)"],["America/Havana","( UTC -4:00 ) Central Daylight Time(America/Havana)"],["America/Indiana/Indianapolis","( UTC -4:00 ) Eastern Daylight Time(America/Indiana/Indianapolis)"],["America/Indiana/Marengo","( UTC -4:00 ) Eastern Daylight Time(America/Indiana/Marengo)"],["America/Indiana/Vevay","( UTC -4:00 ) Eastern Daylight Time(America/Indiana/Vevay)"],["America/Indianapolis","( UTC -4:00 ) Eastern Daylight Time(America/Indianapolis)"],["America/Iqaluit","( UTC -4:00 ) Eastern Daylight Time(America/Iqaluit)"],["America/Kentucky/Louisville","( UTC -4:00 ) Eastern Daylight Time(America/Kentucky/Louisville)"],["America/Kentucky/Monticello","( UTC -4:00 ) Eastern Daylight Time(America/Kentucky/Monticello)"],["America/Louisville","( UTC -4:00 ) Eastern Daylight Time(America/Louisville)"],["America/Montreal","( UTC -4:00 ) Eastern Daylight Time(America/Montreal)"],["America/Nassau","( UTC -4:00 ) Eastern Daylight Time(America/Nassau)"],["America/New_York","( UTC -4:00 ) Eastern Daylight Time(America/New_York)"],["America/Nipigon","( UTC -4:00 ) Eastern Daylight Time(America/Nipigon)"],["America/Pangnirtung","( UTC -4:00 ) Eastern Daylight Time(America/Pangnirtung)"],["America/Thunder_Bay","( UTC -4:00 ) Eastern Daylight Time(America/Thunder_Bay)"],["America/Toronto","( UTC -4:00 ) Eastern Daylight Time(America/Toronto)"],["Canada/Eastern","( UTC -4:00 ) Eastern Daylight Time(Canada/Eastern)"],["Cuba","( UTC -4:00 ) Central Daylight Time(Cuba)"],["EST5EDT","( UTC -4:00 ) Eastern Daylight Time(EST5EDT)"],["IET","( UTC -4:00 ) Eastern Daylight Time(IET)"],["SystemV/EST5EDT","( UTC -4:00 ) Eastern Daylight Time(SystemV/EST5EDT)"],["US/East-Indiana","( UTC -4:00 ) Eastern Daylight Time(US/East-Indiana)"],["US/Eastern","( UTC -4:00 ) Eastern Daylight Time(US/Eastern)"],["US/Michigan","( UTC -4:00 ) Eastern Daylight Time(US/Michigan)"],["America/Caracas","( UTC -4:00 ) Venezuela Time(America/Caracas)"],["America/Anguilla","( UTC -4:00 ) Atlantic Standard Time(America/Anguilla)"],["America/Antigua","( UTC -4:00 ) Atlantic Standard Time(America/Antigua)"],["America/Aruba","( UTC -4:00 ) Atlantic Standard Time(America/Aruba)"],["America/Asuncion","( UTC -4:00 ) Paraguay Time(America/Asuncion)"],["America/Barbados","( UTC -4:00 ) Atlantic Standard Time(America/Barbados)"],["America/Blanc-Sablon","( UTC -4:00 ) Atlantic Standard Time(America/Blanc-Sablon)"],["America/Boa_Vista","( UTC -4:00 ) Amazon Time(America/Boa_Vista)"],["America/Campo_Grande","( UTC -4:00 ) Amazon Time(America/Campo_Grande)"],["America/Cuiaba","( UTC -4:00 ) Amazon Time(America/Cuiaba)"],["America/Curacao","( UTC -4:00 ) Atlantic Standard Time(America/Curacao)"],["America/Dominica","( UTC -4:00 ) Atlantic Standard Time(America/Dominica)"],["America/Grenada","( UTC -4:00 ) Atlantic Standard Time(America/Grenada)"],["America/Guadeloupe","( UTC -4:00 ) Atlantic Standard Time(America/Guadeloupe)"],["America/Guyana","( UTC -4:00 ) Guyana Time(America/Guyana)"],["America/La_Paz","( UTC -4:00 ) Bolivia Time(America/La_Paz)"],["America/Manaus","( UTC -4:00 ) Amazon Time(America/Manaus)"],["America/Martinique","( UTC -4:00 ) Atlantic Standard Time(America/Martinique)"],["America/Montserrat","( UTC -4:00 ) Atlantic Standard Time(America/Montserrat)"],["America/Port_of_Spain","( UTC -4:00 ) Atlantic Standard Time(America/Port_of_Spain)"],["America/Porto_Velho","( UTC -4:00 ) Amazon Time(America/Porto_Velho)"],["America/Puerto_Rico","( UTC -4:00 ) Atlantic Standard Time(America/Puerto_Rico)"],["America/Santiago","( UTC -4:00 ) Chile Time(America/Santiago)"],["America/Santo_Domingo","( UTC -4:00 ) Atlantic Standard Time(America/Santo_Domingo)"],["America/St_Kitts","( UTC -4:00 ) Atlantic Standard Time(America/St_Kitts)"],["America/St_Lucia","( UTC -4:00 ) Atlantic Standard Time(America/St_Lucia)"],["America/St_Thomas","( UTC -4:00 ) Atlantic Standard Time(America/St_Thomas)"],["America/St_Vincent","( UTC -4:00 ) Atlantic Standard Time(America/St_Vincent)"],["America/Tortola","( UTC -4:00 ) Atlantic Standard Time(America/Tortola)"],["America/Virgin","( UTC -4:00 ) Atlantic Standard Time(America/Virgin)"],["Brazil/West","( UTC -4:00 ) Amazon Time(Brazil/West)"],["Chile/Continental","( UTC -4:00 ) Chile Time(Chile/Continental)"],["Etc/GMT+4","( UTC -4:00 ) GMT-04:00(Etc/GMT+4)"],["PRT","( UTC -4:00 ) Atlantic Standard Time(PRT)"],["SystemV/AST4","( UTC -4:00 ) Atlantic Standard Time(SystemV/AST4)"],["America/Glace_Bay","( UTC -3:00 ) Atlantic Daylight Time(America/Glace_Bay)"],["America/Goose_Bay","( UTC -3:00 ) Atlantic Daylight Time(America/Goose_Bay)"],["America/Halifax","( UTC -3:00 ) Atlantic Daylight Time(America/Halifax)"],["America/Moncton","( UTC -3:00 ) Atlantic Daylight Time(America/Moncton)"],["America/Thule","( UTC -3:00 ) Atlantic Daylight Time(America/Thule)"],["Antarctica/Palmer","( UTC -3:00 ) Chile Time(Antarctica/Palmer)"],["Atlantic/Bermuda","( UTC -3:00 ) Atlantic Daylight Time(Atlantic/Bermuda)"],["Atlantic/Stanley","( UTC -3:00 ) Falkland Is. Summer Time(Atlantic/Stanley)"],["Canada/Atlantic","( UTC -3:00 ) Atlantic Daylight Time(Canada/Atlantic)"],["SystemV/AST4ADT","( UTC -3:00 ) Atlantic Daylight Time(SystemV/AST4ADT)"],["AGT","( UTC -3:00 ) Argentine Time(AGT)"],["America/Araguaina","( UTC -3:00 ) Brasilia Time(America/Araguaina)"],["America/Argentina/Buenos_Aires","( UTC -3:00 ) Argentine Time(America/Argentina/Buenos_Aires)"],["America/Argentina/Catamarca","( UTC -3:00 ) Argentine Time(America/Argentina/Catamarca)"],["America/Argentina/ComodRivadavia","( UTC -3:00 ) Argentine Time(America/Argentina/ComodRivadavia)"],["America/Argentina/Cordoba","( UTC -3:00 ) Argentine Time(America/Argentina/Cordoba)"],["America/Argentina/Jujuy","( UTC -3:00 ) Argentine Time(America/Argentina/Jujuy)"],["America/Argentina/La_Rioja","( UTC -3:00 ) Argentine Time(America/Argentina/La_Rioja)"],["America/Argentina/Mendoza","( UTC -3:00 ) Argentine Time(America/Argentina/Mendoza)"],["America/Argentina/Rio_Gallegos","( UTC -3:00 ) Argentine Time(America/Argentina/Rio_Gallegos)"],["America/Argentina/San_Juan","( UTC -3:00 ) Argentine Time(America/Argentina/San_Juan)"],["America/Argentina/Tucuman","( UTC -3:00 ) Argentine Time(America/Argentina/Tucuman)"],["America/Argentina/Ushuaia","( UTC -3:00 ) Argentine Time(America/Argentina/Ushuaia)"],["America/Bahia","( UTC -3:00 ) Brasilia Time(America/Bahia)"],["America/Belem","( UTC -3:00 ) Brasilia Time(America/Belem)"],["America/Buenos_Aires","( UTC -3:00 ) Argentine Time(America/Buenos_Aires)"],["America/Catamarca","( UTC -3:00 ) Argentine Time(America/Catamarca)"],["America/Cayenne","( UTC -3:00 ) French Guiana Time(America/Cayenne)"],["America/Cordoba","( UTC -3:00 ) Argentine Time(America/Cordoba)"],["America/Fortaleza","( UTC -3:00 ) Brasilia Time(America/Fortaleza)"],["America/Jujuy","( UTC -3:00 ) Argentine Time(America/Jujuy)"],["America/Maceio","( UTC -3:00 ) Brasilia Time(America/Maceio)"],["America/Mendoza","( UTC -3:00 ) Argentine Time(America/Mendoza)"],["America/Montevideo","( UTC -3:00 ) Uruguay Time(America/Montevideo)"],["America/Paramaribo","( UTC -3:00 ) Suriname Time(America/Paramaribo)"],["America/Recife","( UTC -3:00 ) Brasilia Time(America/Recife)"],["America/Rosario","( UTC -3:00 ) Argentine Time(America/Rosario)"],["America/Sao_Paulo","( UTC -3:00 ) Brasilia Time(America/Sao_Paulo)"],["Antarctica/Rothera","( UTC -3:00 ) Rothera Time(Antarctica/Rothera)"],["BET","( UTC -3:00 ) Brasilia Time(BET)"],["Brazil/East","( UTC -3:00 ) Brasilia Time(Brazil/East)"],["Etc/GMT+3","( UTC -3:00 ) GMT-03:00(Etc/GMT+3)"],["America/St_Johns","( UTC -2:-30 ) Newfoundland Daylight Time(America/St_Johns)"],["CNT","( UTC -2:-30 ) Newfoundland Daylight Time(CNT)"],["Canada/Newfoundland","( UTC -2:-30 ) Newfoundland Daylight Time(Canada/Newfoundland)"],["America/Godthab","( UTC -2:00 ) Western Greenland Summer Time(America/Godthab)"],["America/Miquelon","( UTC -2:00 ) Pierre &amp; Miquelon Daylight Time(America/Miquelon)"],["America/Noronha","( UTC -2:00 ) Fernando de Noronha Time(America/Noronha)"],["Atlantic/South_Georgia","( UTC -2:00 ) South Georgia Standard Time(Atlantic/South_Georgia)"],["Brazil/DeNoronha","( UTC -2:00 ) Fernando de Noronha Time(Brazil/DeNoronha)"],["Etc/GMT+2","( UTC -2:00 ) GMT-02:00(Etc/GMT+2)"],["Atlantic/Cape_Verde","( UTC -1:00 ) Cape Verde Time(Atlantic/Cape_Verde)"],["Etc/GMT+1","( UTC -1:00 ) GMT-01:00(Etc/GMT+1)"],["America/Scoresbysund","( UTC +0:00 ) Eastern Greenland Summer Time(America/Scoresbysund)"],["Atlantic/Azores","( UTC +0:00 ) Azores Summer Time(Atlantic/Azores)"],["Africa/Abidjan","( GMT 0:00 ) Greenwich Mean Time(Africa/Abidjan)"],["Africa/Accra","( GMT 0:00 ) Greenwich Mean Time(Africa/Accra)"],["Africa/Bamako","( GMT 0:00 ) Greenwich Mean Time(Africa/Bamako)"],["Africa/Banjul","( GMT 0:00 ) Greenwich Mean Time(Africa/Banjul)"],["Africa/Bissau","( GMT 0:00 ) Greenwich Mean Time(Africa/Bissau)"],["Africa/Casablanca","( GMT 0:00 ) Western European Time(Africa/Casablanca)"],["Africa/Conakry","( GMT 0:00 ) Greenwich Mean Time(Africa/Conakry)"],["Africa/Dakar","( GMT 0:00 ) Greenwich Mean Time(Africa/Dakar)"],["Africa/El_Aaiun","( GMT 0:00 ) Western European Time(Africa/El_Aaiun)"],["Africa/Freetown","( GMT 0:00 ) Greenwich Mean Time(Africa/Freetown)"],["Africa/Lome","( GMT 0:00 ) Greenwich Mean Time(Africa/Lome)"],["Africa/Monrovia","( GMT 0:00 ) Greenwich Mean Time(Africa/Monrovia)"],["Africa/Nouakchott","( GMT 0:00 ) Greenwich Mean Time(Africa/Nouakchott)"],["Africa/Ouagadougou","( GMT 0:00 ) Greenwich Mean Time(Africa/Ouagadougou)"],["Africa/Sao_Tome","( GMT 0:00 ) Greenwich Mean Time(Africa/Sao_Tome)"],["Africa/Timbuktu","( GMT 0:00 ) Greenwich Mean Time(Africa/Timbuktu)"],["America/Danmarkshavn","( GMT 0:00 ) Greenwich Mean Time(America/Danmarkshavn)"],["Atlantic/Reykjavik","( GMT 0:00 ) Greenwich Mean Time(Atlantic/Reykjavik)"],["Atlantic/St_Helena","( GMT 0:00 ) Greenwich Mean Time(Atlantic/St_Helena)"],["Etc/GMT","( GMT 0:00 ) GMT+00:00(Etc/GMT)"],["Etc/GMT+0","( GMT 0:00 ) GMT+00:00(Etc/GMT+0)"],["Etc/GMT-0","( GMT 0:00 ) GMT+00:00(Etc/GMT-0)"],["Etc/GMT0","( GMT 0:00 ) GMT+00:00(Etc/GMT0)"],["Etc/Greenwich","( GMT 0:00 ) Greenwich Mean Time(Etc/Greenwich)"],["Etc/UCT","( GMT 0:00 ) Coordinated Universal Time(Etc/UCT)"],["Etc/UTC","( GMT 0:00 ) Coordinated Universal Time(Etc/UTC)"],["Etc/Universal","( GMT 0:00 ) Coordinated Universal Time(Etc/Universal)"],["Etc/Zulu","( GMT 0:00 ) Coordinated Universal Time(Etc/Zulu)"],["GMT","( GMT 0:00 ) Greenwich Mean Time(GMT)"],["GMT0","( GMT 0:00 ) GMT+00:00(GMT0)"],["Greenwich","( GMT 0:00 ) Greenwich Mean Time(Greenwich)"],["Iceland","( GMT 0:00 ) Greenwich Mean Time(Iceland)"],["UCT","( GMT 0:00 ) Coordinated Universal Time(UCT)"],["UTC","( GMT 0:00 ) Coordinated Universal Time(UTC)"],["Universal","( GMT 0:00 ) Coordinated Universal Time(Universal)"],["Zulu","( GMT 0:00 ) Coordinated Universal Time(Zulu)"],["Asia/Riyadh87","( GMT 3:7 ) GMT+03:07(Asia/Riyadh87)"],["Asia/Riyadh88","( GMT 3:7 ) GMT+03:07(Asia/Riyadh88)"],["Asia/Riyadh89","( GMT 3:7 ) GMT+03:07(Asia/Riyadh89)"],["Mideast/Riyadh87","( GMT 3:7 ) GMT+03:07(Mideast/Riyadh87)"],["Mideast/Riyadh88","( GMT 3:7 ) GMT+03:07(Mideast/Riyadh88)"],["Mideast/Riyadh89","( GMT 3:7 ) GMT+03:07(Mideast/Riyadh89)"],["Atlantic/Canary","( GMT 0:00 ) Western European Summer Time(Atlantic/Canary)"],["Atlantic/Faeroe","( GMT 0:00 ) Western European Summer Time(Atlantic/Faeroe)"],["Atlantic/Madeira","( GMT 0:00 ) Western European Summer Time(Atlantic/Madeira)"],["Eire","( GMT 0:00 ) Irish Summer Time(Eire)"],["Europe/Belfast","( GMT 0:00 ) British Summer Time(Europe/Belfast)"],["Europe/Dublin","( GMT 0:00 ) Irish Summer Time(Europe/Dublin)"],["Europe/Guernsey","( GMT 0:00 ) British Summer Time(Europe/Guernsey)"],["Europe/Isle_of_Man","( GMT 0:00 ) British Summer Time(Europe/Isle_of_Man)"],["Europe/Jersey","( GMT 0:00 ) British Summer Time(Europe/Jersey)"],["Europe/Lisbon","( GMT 0:00 ) Western European Summer Time(Europe/Lisbon)"],["Europe/London","( GMT 0:00 ) British Summer Time(Europe/London)"],["GB","( GMT 0:00 ) British Summer Time(GB)"],["GB-Eire","( GMT 0:00 ) British Summer Time(GB-Eire)"],["Portugal","( GMT 0:00 ) Western European Summer Time(Portugal)"],["WET","( GMT 0:00 ) Western European Summer Time(WET)"],["Africa/Algiers","( GMT 1:00 ) Central European Time(Africa/Algiers)"],["Africa/Bangui","( GMT 1:00 ) Western African Time(Africa/Bangui)"],["Africa/Brazzaville","( GMT 1:00 ) Western African Time(Africa/Brazzaville)"],["Africa/Douala","( GMT 1:00 ) Western African Time(Africa/Douala)"],["Africa/Kinshasa","( GMT 1:00 ) Western African Time(Africa/Kinshasa)"],["Africa/Lagos","( GMT 1:00 ) Western African Time(Africa/Lagos)"],["Africa/Libreville","( GMT 1:00 ) Western African Time(Africa/Libreville)"],["Africa/Luanda","( GMT 1:00 ) Western African Time(Africa/Luanda)"],["Africa/Malabo","( GMT 1:00 ) Western African Time(Africa/Malabo)"],["Africa/Ndjamena","( GMT 1:00 ) Western African Time(Africa/Ndjamena)"],["Africa/Niamey","( GMT 1:00 ) Western African Time(Africa/Niamey)"],["Africa/Porto-Novo","( GMT 1:00 ) Western African Time(Africa/Porto-Novo)"],["Africa/Tunis","( GMT 1:00 ) Central European Summer Time(Africa/Tunis)"],["Africa/Windhoek","( GMT 1:00 ) Western African Summer Time(Africa/Windhoek)"],["Etc/GMT-1","( GMT 1:00 ) GMT+01:00(Etc/GMT-1)"],["Africa/Ceuta","( GMT 1:00 ) Central European Summer Time(Africa/Ceuta)"],["Arctic/Longyearbyen","( GMT 1:00 ) Central European Summer Time(Arctic/Longyearbyen)"],["Atlantic/Jan_Mayen","( GMT 1:00 ) Central European Summer Time(Atlantic/Jan_Mayen)"],["CET","( GMT 1:00 ) Central European Summer Time(CET)"],["ECT","( GMT 1:00 ) Central European Summer Time(ECT)"],["Europe/Amsterdam","( GMT 1:00 ) Central European Summer Time(Europe/Amsterdam)"],["Europe/Andorra","( GMT 1:00 ) Central European Summer Time(Europe/Andorra)"],["Europe/Belgrade","( GMT 1:00 ) Central European Summer Time(Europe/Belgrade)"],["Europe/Berlin","( GMT 1:00 ) Central European Summer Time(Europe/Berlin)"],["Europe/Bratislava","( GMT 1:00 ) Central European Summer Time(Europe/Bratislava)"],["Europe/Brussels","( GMT 1:00 ) Central European Summer Time(Europe/Brussels)"],["Europe/Budapest","( GMT 1:00 ) Central European Summer Time(Europe/Budapest)"],["Europe/Copenhagen","( GMT 1:00 ) Central European Summer Time(Europe/Copenhagen)"],["Europe/Gibraltar","( GMT 1:00 ) Central European Summer Time(Europe/Gibraltar)"],["Europe/Ljubljana","( GMT 1:00 ) Central European Summer Time(Europe/Ljubljana)"],["Europe/Luxembourg","( GMT 1:00 ) Central European Summer Time(Europe/Luxembourg)"],["Europe/Madrid","( GMT 1:00 ) Central European Summer Time(Europe/Madrid)"],["Europe/Malta","( GMT 1:00 ) Central European Summer Time(Europe/Malta)"],["Europe/Monaco","( GMT 1:00 ) Central European Summer Time(Europe/Monaco)"],["Europe/Oslo","( GMT 1:00 ) Central European Summer Time(Europe/Oslo)"],["Europe/Paris","( GMT 1:00 ) Central European Summer Time(Europe/Paris)"],["Europe/Podgorica","( GMT 1:00 ) Central European Summer Time(Europe/Podgorica)"],["Europe/Prague","( GMT 1:00 ) Central European Summer Time(Europe/Prague)"],["Europe/Rome","( GMT 1:00 ) Central European Summer Time(Europe/Rome)"],["Europe/San_Marino","( GMT 1:00 ) Central European Summer Time(Europe/San_Marino)"],["Europe/Sarajevo","( GMT 1:00 ) Central European Summer Time(Europe/Sarajevo)"],["Europe/Skopje","( GMT 1:00 ) Central European Summer Time(Europe/Skopje)"],["Europe/Stockholm","( GMT 1:00 ) Central European Summer Time(Europe/Stockholm)"],["Europe/Tirane","( GMT 1:00 ) Central European Summer Time(Europe/Tirane)"],["Europe/Vaduz","( GMT 1:00 ) Central European Summer Time(Europe/Vaduz)"],["Europe/Vatican","( GMT 1:00 ) Central European Summer Time(Europe/Vatican)"],["Europe/Vienna","( GMT 1:00 ) Central European Summer Time(Europe/Vienna)"],["Europe/Warsaw","( GMT 1:00 ) Central European Summer Time(Europe/Warsaw)"],["Europe/Zagreb","( GMT 1:00 ) Central European Summer Time(Europe/Zagreb)"],["Europe/Zurich","( GMT 1:00 ) Central European Summer Time(Europe/Zurich)"],["MET","( GMT 1:00 ) Middle Europe Summer Time(MET)"],["Poland","( GMT 1:00 ) Central European Summer Time(Poland)"],["ART","( GMT 2:00 ) Eastern European Summer Time(ART)"],["Africa/Blantyre","( GMT 2:00 ) Central African Time(Africa/Blantyre)"],["Africa/Bujumbura","( GMT 2:00 ) Central African Time(Africa/Bujumbura)"],["Africa/Cairo","( GMT 2:00 ) Eastern European Summer Time(Africa/Cairo)"],["Africa/Gaborone","( GMT 2:00 ) Central African Time(Africa/Gaborone)"],["Africa/Harare","( GMT 2:00 ) Central African Time(Africa/Harare)"],["Africa/Johannesburg","( GMT 2:00 ) South Africa Standard Time(Africa/Johannesburg)"],["Africa/Kigali","( GMT 2:00 ) Central African Time(Africa/Kigali)"],["Africa/Lubumbashi","( GMT 2:00 ) Central African Time(Africa/Lubumbashi)"],["Africa/Lusaka","( GMT 2:00 ) Central African Time(Africa/Lusaka)"],["Africa/Maputo","( GMT 2:00 ) Central African Time(Africa/Maputo)"],["Africa/Maseru","( GMT 2:00 ) South Africa Standard Time(Africa/Maseru)"],["Africa/Mbabane","( GMT 2:00 ) South Africa Standard Time(Africa/Mbabane)"],["Africa/Tripoli","( GMT 2:00 ) Eastern European Time(Africa/Tripoli)"],["CAT","( GMT 2:00 ) Central African Time(CAT)"],["Egypt","( GMT 2:00 ) Eastern European Summer Time(Egypt)"],["Etc/GMT-2","( GMT 2:00 ) GMT+02:00(Etc/GMT-2)"],["Europe/Kaliningrad","( GMT 3:00 ) Eastern European Summer Time(Europe/Kaliningrad)"],["Libya","( GMT 2:00 ) Eastern European Time(Libya)"],["Asia/Amman","( GMT 2:00 ) Eastern European Summer Time(Asia/Amman)"],["Asia/Beirut","( GMT 2:00 ) Eastern European Summer Time(Asia/Beirut)"],["Asia/Damascus","( GMT 2:00 ) Eastern European Summer Time(Asia/Damascus)"],["Asia/Gaza","( GMT 2:00 ) Eastern European Summer Time(Asia/Gaza)"],["Asia/Istanbul","( GMT 2:00 ) Eastern European Summer Time(Asia/Istanbul)"],["Asia/Jerusalem","( GMT 2:00 ) Israel Standard Time(Asia/Jerusalem)"],["Asia/Nicosia","( GMT 2:00 ) Eastern European Summer Time(Asia/Nicosia)"],["Asia/Tel_Aviv","( GMT 2:00 ) Israel Standard Time(Asia/Tel_Aviv)"],["EET","( GMT 2:00 ) Eastern European Summer Time(EET)"],["Europe/Athens","( GMT 2:00 ) Eastern European Summer Time(Europe/Athens)"],["Europe/Bucharest","( GMT 2:00 ) Eastern European Summer Time(Europe/Bucharest)"],["Europe/Chisinau","( GMT 2:00 ) Eastern European Summer Time(Europe/Chisinau)"],["Europe/Helsinki","( GMT 2:00 ) Eastern European Summer Time(Europe/Helsinki)"],["Europe/Istanbul","( GMT 2:00 ) Eastern European Summer Time(Europe/Istanbul)"],["Europe/Kiev","( GMT 2:00 ) Eastern European Summer Time(Europe/Kiev)"],["Europe/Mariehamn","( GMT 2:00 ) Eastern European Summer Time(Europe/Mariehamn)"],["Europe/Minsk","( GMT 2:00 ) Eastern European Summer Time(Europe/Minsk)"],["Europe/Nicosia","( GMT 2:00 ) Eastern European Summer Time(Europe/Nicosia)"],["Europe/Riga","( GMT 2:00 ) Eastern European Summer Time(Europe/Riga)"],["Europe/Simferopol","( GMT 2:00 ) Eastern European Summer Time(Europe/Simferopol)"],["Europe/Sofia","( GMT 2:00 ) Eastern European Summer Time(Europe/Sofia)"],["Europe/Tallinn","( GMT 2:00 ) Eastern European Summer Time(Europe/Tallinn)"],["Europe/Tiraspol","( GMT 2:00 ) Eastern European Summer Time(Europe/Tiraspol)"],["Europe/Uzhgorod","( GMT 2:00 ) Eastern European Summer Time(Europe/Uzhgorod)"],["Europe/Vilnius","( GMT 2:00 ) Eastern European Summer Time(Europe/Vilnius)"],["Europe/Zaporozhye","( GMT 2:00 ) Eastern European Summer Time(Europe/Zaporozhye)"],["Israel","( GMT 2:00 ) Israel Standard Time(Israel)"],["Turkey","( GMT 2:00 ) Eastern European Summer Time(Turkey)"],["Africa/Addis_Ababa","( GMT 3:00 ) Eastern African Time(Africa/Addis_Ababa)"],["Africa/Asmera","( GMT 3:00 ) Eastern African Time(Africa/Asmera)"],["Africa/Dar_es_Salaam","( GMT 3:00 ) Eastern African Time(Africa/Dar_es_Salaam)"],["Africa/Djibouti","( GMT 3:00 ) Eastern African Time(Africa/Djibouti)"],["Africa/Kampala","( GMT 3:00 ) Eastern African Time(Africa/Kampala)"],["Africa/Khartoum","( GMT 3:00 ) Eastern African Time(Africa/Khartoum)"],["Africa/Mogadishu","( GMT 3:00 ) Eastern African Time(Africa/Mogadishu)"],["Africa/Nairobi","( GMT 3:00 ) Eastern African Time(Africa/Nairobi)"],["Antarctica/Syowa","( GMT 3:00 ) Syowa Time(Antarctica/Syowa)"],["Asia/Aden","( GMT 3:00 ) Arabia Standard Time(Asia/Aden)"],["Asia/Baghdad","( GMT 3:00 ) Arabia Daylight Time(Asia/Baghdad)"],["Asia/Bahrain","( GMT 3:00 ) Arabia Standard Time(Asia/Bahrain)"],["Asia/Kuwait","( GMT 3:00 ) Arabia Standard Time(Asia/Kuwait)"],["Asia/Qatar","( GMT 3:00 ) Arabia Standard Time(Asia/Qatar)"],["Asia/Riyadh","( GMT 3:00 ) Arabia Standard Time(Asia/Riyadh)"],["EAT","( GMT 3:00 ) Eastern African Time(EAT)"],["Etc/GMT-3","( GMT 3:00 ) GMT+03:00(Etc/GMT-3)"],["Europe/Moscow","( GMT 4:00 ) Moscow Daylight Time(Europe/Moscow)"],["Europe/Volgograd","( GMT 3:00 ) Volgograd Summer Time(Europe/Volgograd)"],["Indian/Antananarivo","( GMT 3:00 ) Eastern African Time(Indian/Antananarivo)"],["Indian/Comoro","( GMT 3:00 ) Eastern African Time(Indian/Comoro)"],["Indian/Mayotte","( GMT 3:00 ) Eastern African Time(Indian/Mayotte)"],["W-SU","( GMT 3:00 ) Moscow Daylight Time(W-SU)"],["Asia/Baku","( GMT 4:00 ) Azerbaijan Summer Time(Asia/Baku)"],["Asia/Dubai","( GMT 4:00 ) Gulf Standard Time(Asia/Dubai)"],["Asia/Muscat","( GMT 4:00 ) Gulf Standard Time(Asia/Muscat)"],["Asia/Tbilisi","( GMT 4:00 ) Georgia Time(Asia/Tbilisi)"],["Asia/Yerevan","( GMT 4:00 ) Armenia Summer Time(Asia/Yerevan)"],["Etc/GMT-4","( GMT 4:00 ) GMT+04:00(Etc/GMT-4)"],["Europe/Samara","( GMT 4:00 ) Samara Summer Time(Europe/Samara)"],["Indian/Mahe","( GMT 4:00 ) Seychelles Time(Indian/Mahe)"],["Indian/Mauritius","( GMT 4:00 ) Mauritius Time(Indian/Mauritius)"],["Indian/Reunion","( GMT 4:00 ) Reunion Time(Indian/Reunion)"],["NET","( GMT 4:00 ) Armenia Summer Time(NET)"],["Asia/Tehran","( GMT 3:30 ) Iran Standard Time(Asia/Tehran)"],["Iran","( GMT 3:30 ) Iran Standard Time(Iran)"],["Asia/Kabul","( GMT 4:30 ) Afghanistan Time(Asia/Kabul)"],["Asia/Aqtau","( GMT 5:00 ) Aqtau Time(Asia/Aqtau)"],["Asia/Aqtobe","( GMT 5:00 ) Aqtobe Time(Asia/Aqtobe)"],["Asia/Ashgabat","( GMT 5:00 ) Turkmenistan Time(Asia/Ashgabat)"],["Asia/Ashkhabad","( GMT 5:00 ) Turkmenistan Time(Asia/Ashkhabad)"],["Asia/Dushanbe","( GMT 5:00 ) Tajikistan Time(Asia/Dushanbe)"],["Asia/Karachi","( GMT 5:00 ) Pakistan Time(Asia/Karachi)"],["Asia/Oral","( GMT 5:00 ) Oral Time(Asia/Oral)"],["Asia/Samarkand","( GMT 5:00 ) Uzbekistan Time(Asia/Samarkand)"],["Asia/Tashkent","( GMT 5:00 ) Uzbekistan Time(Asia/Tashkent)"],["Asia/Yekaterinburg","( GMT 6:00 ) Yekaterinburg Summer Time(Asia/Yekaterinburg)"],["Etc/GMT-5","( GMT 5:00 ) GMT+05:00(Etc/GMT-5)"],["Indian/Kerguelen","( GMT 5:00 ) French Southern &amp; Antarctic Lands Time(Indian/Kerguelen)"],["Indian/Maldives","( GMT 5:00 ) Maldives Time(Indian/Maldives)"],["PLT","( GMT 5:00 ) Pakistan Time(PLT)"],["Antarctica/Mawson","( GMT 6:00 ) Mawson Time(Antarctica/Mawson)"],["Asia/Kolkata","( GMT 5:30 ) India Standard Time(Asia/Calcutta)"],["Asia/Colombo","( GMT 5:30 ) Sri Lanka Time(Asia/Colombo)"],["IST","( GMT 5:30 ) India Standard Time(IST)"],["Asia/Katmandu","( GMT 5:45 ) Nepal Time(Asia/Katmandu)"],["Antarctica/Vostok","( GMT 6:00 ) Vostok Time(Antarctica/Vostok)"],["Asia/Almaty","( GMT 6:00 ) Alma-Ata Time(Asia/Almaty)"],["Asia/Bishkek","( GMT 6:00 ) Kirgizstan Time(Asia/Bishkek)"],["Asia/Dacca","( GMT 6:00 ) Bangladesh Time(Asia/Dacca)"],["Asia/Dhaka","( GMT 6:00 ) Bangladesh Time(Asia/Dhaka)"],["Asia/Omsk","( GMT 7:00 ) Omsk Summer Time(Asia/Omsk)"],["Asia/Qyzylorda","( GMT 6:00 ) Qyzylorda Time(Asia/Qyzylorda)"],["Asia/Thimbu","( GMT 6:00 ) Bhutan Time(Asia/Thimbu)"],["Asia/Thimphu","( GMT 6:00 ) Bhutan Time(Asia/Thimphu)"],["BST","( GMT 6:00 ) Bangladesh Time(BST)"],["Etc/GMT-6","( GMT 6:00 ) GMT+06:00(Etc/GMT-6)"],["Indian/Chagos","( GMT 6:00 ) Indian Ocean Territory Time(Indian/Chagos)"],["Asia/Kashgar","( GMT 8:00 ) China Standard Time(Asia/Kashgar)"],["Asia/Urumqi","( GMT 8:00 ) China Standard Time(Asia/Urumqi)"],["Asia/Rangoon","( GMT 6:30 ) Myanmar Time(Asia/Rangoon)"],["Indian/Cocos","( GMT 6:30 ) Cocos Islands Time(Indian/Cocos)"],["Asia/Novosibirsk","( GMT 7:00 ) Novosibirsk Summer Time(Asia/Novosibirsk)"],["Antarctica/Davis","( GMT 7:00 ) Davis Time(Antarctica/Davis)"],["Asia/Bangkok","( GMT 7:00 ) Indochina Time(Asia/Bangkok)"],["Asia/Hovd","( GMT 7:00 ) Hovd Summer Time(Asia/Hovd)"],["Asia/Jakarta","( GMT 7:00 ) West Indonesia Time(Asia/Jakarta)"],["Asia/Krasnoyarsk","( GMT 8:00 ) Krasnoyarsk Summer Time(Asia/Krasnoyarsk)"],["Asia/Phnom_Penh","( GMT 7:00 ) Indochina Time(Asia/Phnom_Penh)"],["Asia/Pontianak","( GMT 7:00 ) West Indonesia Time(Asia/Pontianak)"],["Asia/Saigon","( GMT 7:00 ) Indochina Time(Asia/Saigon)"],["Asia/Vientiane","( GMT 7:00 ) Indochina Time(Asia/Vientiane)"],["Etc/GMT-7","( GMT 7:00 ) GMT+07:00(Etc/GMT-7)"],["Indian/Christmas","( GMT 7:00 ) Christmas Island Time(Indian/Christmas)"],["VST","( GMT 7:00 ) Indochina Time(VST)"],["Asia/Brunei","( GMT 8:00 ) Brunei Time(Asia/Brunei)"],["Asia/Chongqing","( GMT 8:00 ) China Standard Time(Asia/Chongqing)"],["Asia/Harbin","( GMT 8:00 ) China Standard Time(Asia/Harbin)"],["Asia/Hong_Kong","( GMT 8:00 ) Hong Kong Time(Asia/Hong_Kong)"],["Asia/Irkutsk","( GMT 9:00 ) Irkutsk Summer Time(Asia/Irkutsk)"],["Asia/Kuala_Lumpur","( GMT 8:00 ) Malaysia Time(Asia/Kuala_Lumpur)"],["Asia/Kuching","( GMT 8:00 ) Malaysia Time(Asia/Kuching)"],["Asia/Macao","( GMT 8:00 ) China Standard Time(Asia/Macao)"],["Asia/Makassar","( GMT 8:00 ) Central Indonesia Time(Asia/Makassar)"],["Asia/Manila","( GMT 8:00 ) Philippines Time(Asia/Manila)"],["Asia/Shanghai","( GMT 8:00 ) China Standard Time(Asia/Shanghai)"],["Asia/Singapore","( GMT 8:00 ) Singapore Time(Asia/Singapore)"],["Asia/Taipei","( GMT 8:00 ) China Standard Time(Asia/Taipei)"],["Asia/Ujung_Pandang","( GMT 8:00 ) Central Indonesia Time(Asia/Ujung_Pandang)"],["Asia/Ulaanbaatar","( GMT 8:00 ) Ulaanbaatar Summer Time(Asia/Ulaanbaatar)"],["Asia/Ulan_Bator","( GMT 8:00 ) Ulaanbaatar Summer Time(Asia/Ulan_Bator)"],["Australia/Perth","( GMT 8:00 ) Western Standard Time (Australia)(Australia/Perth)"],["Australia/West","( GMT 8:00 ) Western Standard Time (Australia)(Australia/West)"],["CTT","( GMT 8:00 ) China Standard Time(CTT)"],["Etc/GMT-8","( GMT 8:00 ) GMT+08:00(Etc/GMT-8)"],["PRC","( GMT 8:00 ) China Standard Time(PRC)"],["Singapore","( GMT 8:00 ) Singapore Time(Singapore)"],["Asia/Choibalsan","( GMT 9:00 ) Choibalsan Summer Time(Asia/Choibalsan)"],["Asia/Pyongyang","( GMT 9:00 ) Korea Standard Time(Asia/Pyongyang)"],["Asia/Dili","( GMT 9:00 ) East Timor Time(Asia/Dili)"],["Asia/Jayapura","( GMT 9:00 ) East Indonesia Time(Asia/Jayapura)"],["Asia/Seoul","( GMT 9:00 ) Korea Standard Time(Asia/Seoul)"],["Asia/Tokyo","( GMT 9:00 ) Japan Standard Time(Asia/Tokyo)"],["Asia/Yakutsk","( GMT 10:00 ) Yaktsk Summer Time(Asia/Yakutsk)"],["Etc/GMT-9","( GMT 9:00 ) GMT+09:00(Etc/GMT-9)"],["JST","( GMT 9:00 ) Japan Standard Time(JST)"],["Japan","( GMT 9:00 ) Japan Standard Time(Japan)"],["Pacific/Palau","( GMT 9:00 ) Palau Time(Pacific/Palau)"],["ROK","( GMT 9:00 ) Korea Standard Time(ROK)"],["ACT","( GMT 9:30 ) Central Standard Time (Northern Territory)(ACT)"],["Australia/Adelaide","( GMT 9:30 ) Central Standard Time (South Australia)(Australia/Adelaide)"],["Australia/Broken_Hill","( GMT 9:30 ) Central Standard Time (South Australia/New South Wales)(Australia/Broken_Hill)"],["Australia/Darwin","( GMT 9:30 ) Central Standard Time (Northern Territory)(Australia/Darwin)"],["Australia/North","( GMT 9:30 ) Central Standard Time (Northern Territory)(Australia/North)"],["Australia/South","( GMT 9:30 ) Central Standard Time (South Australia)(Australia/South)"],["Australia/Yancowinna","( GMT 9:30 ) Central Standard Time (South Australia/New South Wales)(Australia/Yancowinna)"],["AET","( GMT 10:00 ) Eastern Standard Time (New South Wales)(AET)"],["Antarctica/DumontDUrville","( GMT 10:00 ) Dumont-d Urville Time(Antarctica/DumontDUrville)"],["Asia/Vladivostok","( GMT 10:00 ) Vladivostok Summer Time(Asia/Vladivostok)"],["Australia/ACT","( GMT 10:00 ) Eastern Standard Time (New South Wales)(Australia/ACT)"],["Australia/Brisbane","( GMT 10:00 ) Eastern Standard Time (Queensland)(Australia/Brisbane)"],["Australia/Canberra","( GMT 10:00 ) Eastern Standard Time (New South Wales)(Australia/Canberra)"],["Australia/Currie","( GMT 10:00 ) Eastern Standard Time (New South Wales)(Australia/Currie)"],["Australia/Hobart","( GMT 10:00 ) Eastern Standard Time (Tasmania)(Australia/Hobart)"],["Australia/Lindeman","( GMT 10:00 ) Eastern Standard Time (Queensland)(Australia/Lindeman)"],["Australia/Melbourne","( GMT 10:00 ) Eastern Standard Time (Victoria)(Australia/Melbourne)"],["Australia/NSW","( GMT 10:00 ) Eastern Standard Time (New South Wales)(Australia/NSW)"],["Australia/Queensland","( GMT 10:00 ) Eastern Standard Time (Queensland)(Australia/Queensland)"],["Australia/Sydney","( GMT 10:00 ) Eastern Standard Time (New South Wales)(Australia/Sydney)"],["Australia/Tasmania","( GMT 10:00 ) Eastern Standard Time (Tasmania)(Australia/Tasmania)"],["Australia/Victoria","( GMT 10:00 ) Eastern Standard Time (Victoria)(Australia/Victoria)"],["Etc/GMT-10","( GMT 10:00 ) GMT+10:00(Etc/GMT-10)(Etc/GMT-10)"],["Pacific/Guam","( GMT 10:00 ) Chamorro Standard Time(Pacific/Guam)"],["Pacific/Port_Moresby","( GMT 10:00 ) Papua New Guinea Time(Pacific/Port_Moresby)"],["Pacific/Saipan","( GMT 10:00 ) Chamorro Standard Time(Pacific/Saipan)"],["Pacific/Truk","( GMT 10:00 ) Truk Time(Pacific/Truk)"],["Pacific/Yap","( GMT 10:00 ) Yap Time(Pacific/Yap)"],["Australia/LHI","( GMT 10:30 ) Load Howe Standard Time(Australia/LHI)"],["Australia/Lord_Howe","( GMT 10:30 ) Load Howe Standard Time(Australia/Lord_Howe)"],["Antarctica/Casey","( GMT 8:00 ) Western Standard Time (Australia)(Antarctica/Casey)"],["Asia/Sakhalin","( GMT 11:00 ) Sakhalin Summer Time(Asia/Sakhalin)"],["Asia/Magadan","( GMT 12:00 ) Magadan Summer Time(Asia/Magadan)"],["Etc/GMT-11","( GMT 11:00 ) GMT+11:00(Etc/GMT-11)"],["Pacific/Efate","( GMT 11:00 ) Vanuatu Time(Pacific/Efate)"],["Pacific/Guadalcanal","( GMT 11:00 ) Solomon Is. Time(Pacific/Guadalcanal)"],["Pacific/Kosrae","( GMT 11:00 ) Kosrae Time(Pacific/Kosrae)"],["Pacific/Noumea","( GMT 11:00 ) New Caledonia Time(Pacific/Noumea)"],["Pacific/Ponape","( GMT 11:00 ) Ponape Time(Pacific/Ponape)"],["SST","( GMT 11:00 ) Solomon Is. Time(SST)"],["Pacific/Norfolk","( GMT 11:30 ) Norfolk Time(Pacific/Norfolk)"],["Antarctica/McMurdo","( GMT 12:00 ) New Zealand Standard Time(Antarctica/McMurdo)"],["Antarctica/South_Pole","( GMT 12:00 ) New Zealand Standard Time(Antarctica/South_Pole)"],["Asia/Anadyr","( GMT 12:00 ) Anadyr Summer Time(Asia/Anadyr)"],["Asia/Kamchatka","( GMT 12:00 ) Petropavlovsk-Kamchatski Summer Time(Asia/Kamchatka)"],["Etc/GMT-12","( GMT 12:00 ) GMT+12:00(Etc/GMT-12)"],["Kwajalein","( GMT 12:00 ) Marshall Islands Time(Kwajalein)"],["NST","( GMT 12:00 ) New Zealand Standard Time(NST)"],["NZ","( GMT 12:00 ) New Zealand Standard Time(NZ)"],["Pacific/Auckland","( GMT 12:00 ) New Zealand Standard Time(Pacific/Auckland)"],["Pacific/Fiji","( GMT 12:00 ) Fiji Time(Pacific/Fiji)"],["Pacific/Funafuti","( GMT 12:00 ) Tuvalu Time(Pacific/Funafuti)"],["Pacific/Kwajalein","( GMT 12:00 ) Marshall Islands Time(Pacific/Kwajalein)"],["Pacific/Majuro","( GMT 12:00 ) Marshall Islands Time(Pacific/Majuro)"],["Pacific/Nauru","( GMT 12:00 ) Nauru Time(Pacific/Nauru)"],["Pacific/Tarawa","( GMT 12:00 ) Gilbert Is. Time(Pacific/Tarawa)"],["Pacific/Wake","( GMT 12:00 ) Wake Time(Pacific/Wake)"],["Pacific/Wallis","( GMT 12:00 ) Wallis &amp; Futuna Time(Pacific/Wallis)"],["NZ-CHAT","( GMT 12:45 ) Chatham Standard Time(NZ-CHAT)"],["Pacific/Chatham","( GMT 12:45 ) Chatham Standard Time(Pacific/Chatham)"],["MIT","( UTC +13:00 ) West Samoa Time(MIT)"],["Pacific/Apia","( UTC +13:00 ) West Samoa Time(Pacific/Apia)"],["Pacific/Fakaofo","( UTC +13:00 ) Tokelau Time(Pacific/Fakaofo)"],["Etc/GMT-13","( GMT 13:00 ) GMT+13:00(Etc/GMT-13)"],["Pacific/Enderbury","( GMT 13:00 ) Phoenix Is. Time(Pacific/Enderbury)"],["Pacific/Tongatapu","( GMT 13:00 ) Tonga Time(Pacific/Tongatapu)"],["Etc/GMT-14","( GMT 14:00 ) GMT+14:00(Etc/GMT-14)"],["Pacific/Kiritimati","( GMT 14:00 ) Line Is. Time(Pacific/Kiritimati)"]],i="",a="",s="",n=t.length,r=0;n>r;r++){var o=t[r][0];a="";var l=t[r][1].toLowerCase();e&&-1===l.indexOf(e.toLowerCase())||(o===$zcg._USERTIMEZONE&&(a="sel_status",s=t[r][1]),i+='<li key="'+o+'" class="'+a+'">'+t[r][1]+"</li>")}return{html:i,key:$zcg._USERTIMEZONE,value:s}},f=function(){var e={en:"English",de:"German",el:"Greek",es:"Spanish",fr:"French",it:"Italian",ja:"Japanese",nl:"Dutch",pt:"Portuguese",ru:"Russian",tr:"Turkish",vi:"Vietnamese",zh:"Chinese"},t="",i="",a="",s=$zcg._ALLOWEDLANGUAGES;for(var n in e)s.indexOf(n)<0||(i="",n===$zcg._LANG&&(i="sel_status",a=e[n]),t+='<li key="'+n+'" class="'+i+'">'+e[n]+"</li>");return{html:t,key:$zcg._LANG,value:a}},v=function(){var e=new Date;return e.getTime()<parseInt(Settings.getFromObj("ob_checklist_later"))+2592e5?void CheckList.updateCount():void CheckList.populateOnbardingCheckListUI()},C=function(){var e=CheckList.getChecklistArray(),t="";i="";for(var a=0;a<e.length;a++){var s="",n=e[a][0],r='data-target="'+n+'"';CheckList.isCompleted(n)?(s="zccompleted",r='data-target="'+n+'" data-status="completed"'):""===i&&(i=n,"invite_member"===n&&CheckList.isMayBeLater(n)&&(i="")),t+='<li class="'+s+'" '+r+" >"+Resource.getRealValue(e[a][1])+"</li>"}return""!==i||CheckList.isCompleted("invite_member")||(i="invite_member"),t},y=function(){$ZCAjx.ajax({url:"deleteuserphoto.do",type:"POST",success:function(){e.find('[type="imgpreview"]').html(E())}})},b=function(e,t){CheckList.updateOnboarding(t),window.open(e,"_blank"),CheckList.markAsCompleted(t)},E=function(){var e=$Util.getImgStaticUrl()+"/usr-default.png";return'<img class="cur" previewelem documentclick="viewattachment" uid="'+$zcg._ZUID+'" imgsrc="'+e+'" src="'+e+'" />'},I=function(){for(var e=CheckList.getRemainingSteps(),t=CheckList.getChecklistArray().length,i="",a=0;t>a;a++)i+="<em></em>";return'<div class="lst_status" data-purpose="statusui">'+i+'</div><div class="cmp_count textright"><span data-purpose="remainingcount">'+e+"/"+t+"</span>  "+Resource.getRealValue("checklist.completed")+"</div>"},T={baseUI:'<div id="onboardchecklist" class="onb_chklst"><h1><span>'+Resource.getRealValue("checklist.hey",["<em data-name>"+$WC.$CUtil.processXSS($zcg._USERNICKNAME)+"</em>"])+'</span> <br/><p class="ds_in_blk" data-purpose="heading">{HEADING}</p></h1><div class="checklist"><div class="lstlhs" data-purpose="checklistLHS"><ul data-purpose="checklist-nav">{LHSMENU}</ul>{REMAININGGSTATUS}</div><div class="lstrhs" data-purpose="checklistRHS"></div><div class="dolater" data-purpose="do-later"><div class="cur" data-module="dolater" data-target="{TARGETELEM}">'+Resource.getRealValue("checklist.dolater")+"</div></div></div></div>",invite_member:"<h3>"+Resource.getRealValue("checklist.invite.header")+'</h3><p class="wid80">'+Resource.getRealValue("checklist.invite.desc")+'</p><div id="invteinput" class="invite_mem"></div><div id="chkerrorfield" class="chkerrorfield"></div><div id="inviteoptns" class="inviteoptns"><span id="multipleusersbtn">+ '+Resource.getRealValue("invite.users.add")+' <a class="cur" purpose="addmultipleuser">'+Resource.getRealValue("invite.users.multiple.users")+"</a> </span>"+("windows"!==$Util.getOS()?"("+Resource.getRealValue("invite.users.or")+') <span><input purpose="uploadfile" listen="file" type="file"><span class="cur" ><a>'+Resource.getRealValue("invite.users.upload")+"</a></span> ( "+Resource.getRealValue("invite.users.upload.csvfile")+" )</span>":"")+'</div><button id="invitbtn" class="chklstbtn invitbtn" data-module="invite" disable=true>'+Resource.getRealValue("checklist.sendinvites")+"</button>",do_channel_action:"<h3>"+Resource.getRealValue("checklist.channel.header")+"</h3><p>"+Resource.getRealValue("checklist.channel.desc")+'</p><div class="mrgT30">'+Resource.getRealValue("checklist.channel.desc1")+'</div><div class="chklstlink mrgT30 msi-rhtarw" data-module="createchannel">'+Resource.getRealValue("checklist.channel.create")+"</div>{JOIN_CHANNEL}",join_channel:'<span class="clr6 font14 paddLR10">(or)</span><div class="chklstlink mrgT30 msi-rhtarw" data-module="joinchannel">'+Resource.getRealValue("checklist.channel.join")+"</div>",view_mobile_apps:"<h3>"+Resource.getRealValue("checklist.mobile.header")+"</h3><p>"+Resource.getRealValue("checklist.mobile.desc")+'</p><div class="zcappsimgs mrgT25"><a href="'+$zcg._PLAYSTOREURL+'" target="_blank"><img src="{STATICURL}/appsimage/google.png" class="width100"/></a><a href="'+$zcg._APPSTOREURL+'" target="_blank"><img src="{STATICURL}/appsimage/apple.png" class="width100"/></a></div><p class="mrgT20">'+Resource.getRealValue("checklist.mobile.desc1")+"</p>",view_applications:"<h3>"+Resource.getRealValue("checklist.apps.header")+"</h3><p>"+Resource.getRealValue("checklist.apps.desc")+'</p><div class="mrgT30">'+Resource.getRealValue("checklist.apps.desc1")+'</div><div class="chklstlink mrgT30 msi-rhtarw" ><a data-module="openurl" url="'+$zcg._MARKETPLACEURL+'">'+Resource.getRealValue("checklist.apps.market")+"</a></div>",do_create_chat:'<div class="chklist_chat"><img class="darkmodeimg" src="{STATICURL}/dark_checklist.svg" /><img src="{STATICURL}/checklist.svg" /><div class="font20"><div class="clr6">'+Resource.getRealValue("checklist.connect.header")+'</div><p class="clr6 font18">'+Resource.getRealValue("checklist.connect.desc")+'</p><div class="chklstlink mrgT30 msi-rhtarw" data-module="getconnect">'+Resource.getRealValue("checklist.connect.link")+"</div></div></div>",set_user_profile:'<div class="usrprofile dflx"><div class="photo dIB"><div class="ds_in_blk posl"><div type="imgpreview"><img class="cur" uid="'+$zcg._ZUID+'" imgsrc="'+$zcg._PHOTOSERVER+"/file?fs=thumb&nocache="+Date.now()+'" src="'+$zcg._PHOTOSERVER+"/file?fs=thumb&nocache="+Date.now()+'" /></div><input type="file" id="profilephoto" name="photo" class="sendfile width100" accept="image/*"><span class="usrimgchng posa msi-camera"></span></div><div class="cur mrgT10 textcent zcunderlin clr6 font14" data-module="deletephoto">'+Resource.getRealValue("common.remove")+'</div></div><div class="mrgL30 flx1"><div><label class="clr6 font13 bold dspblck mrgB10">'+Resource.getRealValue("checklist.profile.name")+'</label><input type="text" class="width300" data-profile="dname" value="{USERNAME}"/></div><div class="mrgT30"><label class="clr6 font13 bold dspblck mrgB10">'+Resource.getRealValue("checklist.profile.zone")+'</label><div class="zcdropdwn timezone" data-action="dropdown"><input type="text" id="timezone" class="posa" /><label for="timezone" data-purpose="header" key="{TIMEKEY}" class="msi-darrw" data-profile="timezone">{TIMEVAL}</label><ul data-purpose="list" class="ztb-dropdown">{TIMEZONE}</ul></div></div><div  class="mrgT30"><label class="clr6 font13 bold dspblck mrgB10">'+Resource.getRealValue("checklist.profile.language")+'</label><div class="zcdropdwn" data-action="dropdown"><input type="text" id="language" class="posa" /><label for="language" data-purpose="header" key="{LANGKEY}" class="msi-darrw" data-profile="lang">{LANGVAL}</label><ul data-purpose="list" class="ztb-dropdown">{LANGUAGE}</ul></div></div><div class="chklstbtn mrgT30" data-module="saveprofile">'+Resource.getRealValue("common.savechanges")+"</div></div></div>",create_event:'<h2 class="font20">'+Resource.getRealValue("checklist.event.header")+'</h2><ul class="clr6 mrgT20 chklstevnt" ><li class="mrgB10">'+Resource.getRealValue("checklist.event.link1")+'</li><li class="mrgB10">'+Resource.getRealValue("checklist.event.link2")+'</li></ul><div class="mrgT20">'+Resource.getRealValue("checklist.event.desc1")+'</div><div class="mrgT30 eventdesc">'+Resource.getRealValue("checklist.event.desc2")+'</div><div class="chklstlink mrgT15 msi-rhtarw" data-module="createevent">'+Resource.getRealValue("checklist.event.link")+"</div>",invitesuccess:'<div class="responseui"><svg width="129px" height="54px" viewBox="0 0 129 54" version="1.1"><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Artboard" transform="translate(-123.000000, -263.000000)"><g id="request-sent" transform="translate(124.000000, 263.000000)"><path d="M104.236842,5.5 L112.763158,5.5" id="Line" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><path d="M18.2333333,50.5 L24.7666667,50.5" id="Line-Copy-2" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><path d="M110.25,14.5 L126.75,14.5" id="Line-Copy" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><path d="M0.243902439,42.5 L19.7560976,42.5" id="Line-Copy-3" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><circle id="Oval-2" stroke="#C2C2C2" stroke-width="0.979999967" cx="103.5" cy="45.5" r="1.01000002"></circle><circle id="Oval-2-Copy" stroke="#C2C2C2" stroke-width="0.979999967" cx="25.5" cy="11.5" r="1.01000002"></circle><g id="check-(2)" transform="translate(38.000000, 0.000000)" fill-rule="nonzero"><g id="Layer_1"><ellipse id="Oval" fill="#61C2AB" cx="27" cy="27" rx="27" ry="26.9822812"></ellipse><polygon id="Shape" fill="#FFFFFF" points="24.8349375 41.3521875 12.069 31.4069063 15.6988125 26.7485625 23.5380937 32.855625 36.4761562 14.1859688 41.3310937 17.5491563"></polygon></g></g></g></g></g></svg><h1>'+Resource.getRealValue("checklist.invite.success")+'</h1><p class="clr6">'+Resource.getRealValue("checklist.invite.success.desc")+"</p></div>",allcompleted:'<div class="responseui"><svg width="129px" height="54px" viewBox="0 0 129 54" version="1.1"><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Artboard" transform="translate(-123.000000, -263.000000)"><g id="request-sent" transform="translate(124.000000, 263.000000)"><path d="M104.236842,5.5 L112.763158,5.5" id="Line" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><path d="M18.2333333,50.5 L24.7666667,50.5" id="Line-Copy-2" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><path d="M110.25,14.5 L126.75,14.5" id="Line-Copy" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><path d="M0.243902439,42.5 L19.7560976,42.5" id="Line-Copy-3" stroke="#C2C2C2" stroke-width="1.46999995" stroke-linecap="square"></path><circle id="Oval-2" stroke="#C2C2C2" stroke-width="0.979999967" cx="103.5" cy="45.5" r="1.01000002"></circle><circle id="Oval-2-Copy" stroke="#C2C2C2" stroke-width="0.979999967" cx="25.5" cy="11.5" r="1.01000002"></circle><g id="check-(2)" transform="translate(38.000000, 0.000000)" fill-rule="nonzero"><g id="Layer_1"><ellipse id="Oval" fill="#61C2AB" cx="27" cy="27" rx="27" ry="26.9822812"></ellipse><polygon id="Shape" fill="#FFFFFF" points="24.8349375 41.3521875 12.069 31.4069063 15.6988125 26.7485625 23.5380937 32.855625 36.4761562 14.1859688 41.3310937 17.5491563"></polygon></g></g></g></g></g></svg><h1>'+Resource.getRealValue("checklist.completed.header")+'</h1><p class="clr6 mrgT20">'+Resource.getRealValue("checklist.completed.desc")+'</p><p class="clr6 mrgT15">'+Resource.getRealValue("checklist.completed.desc1")+'</p><div class="cur mrgT15 zcunderlin" data-module="dolater" data-purpose="close-onboard">'+Resource.getRealValue("common.close")+"</div></div>","completed.rhsUI":'<div class="chklstcompui"><div class="chklstcompheader msi-hissel">'+Resource.getRealValue("checklist.completedui.header")+'</div><div class="chklstimg"><img class="darkmodeimg" src="{DARKMODE_IMAGE}"><img src="{IMAGE}"></div><div class="chklstcompfooter txtcent">{COMPLETED-FOOTER}</div></div>'};return{init:v,populateOnbardingCheckListUI:function(){var a=CheckList.getRemainingSteps();if(0!=a){$("#onboardchecklist").remove();var s=MainUI.currentchat||"home";$("#zcdashbdmain").after(T.baseUI.replace(/{REMAININGGSTATUS}/g,I()).replace(/{HEADING}/g,Resource.getRealValue("checklist.steps."+a)).replace(/{TARGETELEM}/g,s).replace(/{LHSMENU}/g,C())),""!==i&&(e=$("#onboardchecklist").find('[data-purpose="checklistRHS"]'),t=e.parent().find('[data-purpose="checklistLHS"]'),CheckList.updateCompletedStatusUI(a),this.populateRHS(i))}},populateRHS:function(i){t.find(".sel").removeClass("sel"),t.find(".compsel").removeClass("compsel"),t.find('[data-target="'+i+'"]').addClass("sel");var s=T[i].replace(/{STATICURL}/g,$Util.getImgStaticUrl());if("set_user_profile"===i){var n=g(),r=f();s=T[i].replace(/{USERNAME}/g,$WC.$CUtil.processXSS($zcg._USERNICKNAME)).replace(/{TIMEKEY}/g,n.key).replace(/{TIMEVAL}/g,n.value).replace(/{TIMEZONE}/g,n.html).replace(/{LANGUAGE}/g,r.html).replace(/{LANGVAL}/g,r.value).replace(/{LANGKEY}/g,r.key)}else if("do_channel_action"===i){var o="true"===$zcg._ISADMIN?"":T.join_channel;s=T[i].replace(/{JOIN_CHANNEL}/g,o)}e.attr("module",i).html(s).hide().fadeIn(),"set_user_profile"===i&&h(),"invite_member"===i&&e.find("#invteinput").append(InviteUsersToOrg.getTableDom()),a()},populateCompRHS:function(i){t.find(".sel").removeClass("sel"),t.find(".compsel").removeClass("compsel"),t.find('[data-target="'+i+'"]').addClass("compsel");var a=T["completed.rhsUI"].replace(/{COMPLETED-FOOTER}/g,Resource.getRealValue("checklist.completedui."+i)).replace(/{IMAGE}/g,$zcg._IMGSTATICURL+"/checklist/"+i+".svg").replace(/{DARKMODE_IMAGE}/g,$zcg._IMGSTATICURL+"/checklist/dark_"+i+".svg");"set_user_profile"===i&&(a=a.replace(/\[icon sign]/g,'<a class="msi-popout" title="'+Resource.getRealValue("common.viewprofile")+'"></a>')),e.attr("module",i).html(a)},saveProfileDetails:function(t){var i={};t.addClass("zcloadling"),i.dname=$.trim(e.find('[data-profile="dname"]').val()),i.timezone=e.find('[data-profile="timezone"]').attr("key"),i.lang=e.find('[data-profile="lang"]').attr("key");var a,s=e.find("#profilephoto")[0].files[0];$WC.$CUtil.isEmpty(s)||(a=[[s]]),i.onboardingstepkey="set_user_profile";var n=$ZCAjx.formData(i,"photo",a,!0);$ZCAjx.ajax({url:"updateuserprofile.do",type:"POST",processData:!1,contentType:!1,data:n,success:function(e){t.removeClass("zcloadling"),$zcg._USERNICKNAME=e.dname,$zcg._LANG=e.lang,$zcg._USERTIMEZONE=e.timezone,$("[data-name]").html($WC.$CUtil.processXSS($zcg._USERNICKNAME)),$("#ztb-profile-image").attr("src",$zcg._PHOTOSERVER+"/file?fs=thumb&nocache="+Date.now()),CheckList.markAsCompleted("set_user_profile")}})},updateOnboarding:function(e){$ZCAjx.ajax({url:"updonboardingsteps.do",data:{onboardingstepkey:e,onboardingstepval:"1"},type:"POST",success:function(e){$zcg._USERNICKNAME=e.dname,$zcg._LANG=e.lang,$zcg._USERTIMEZONE=e.timezone,$("[data-name]").html($WC.$CUtil.processXSS($zcg._USERNICKNAME))}})},getChecklistArray:function(){var e=[["do_channel_action","checklist.lhs.channel"]];return MMChat.isAudioVideoCallEnabled()&&e.push(["do_create_chat","checklist.lhs.connect"]),_isMobileAppEnabled()&&e.push(["view_mobile_apps","common.mobileapps"]),"true"===$zcg._ISADMIN&&(SecurityManager.hasPermission(Modules.Applications)&&e.push(["view_applications","app.cliqapps"]),CheckList.hasOrgMembersAlready()||e.unshift(["invite_member","checklist.lhs.invite"])),e.length<5&&SecurityManager.hasPermission(Modules.Events)&&e.push(["create_event","checklist.lhs.event"]),e.length<5&&e.unshift(["set_user_profile","checklist.lhs.profile"]),e},getRemainingSteps:function(){for(var e=CheckList.getChecklistArray(),t=0,i=0;i<e.length;i++)CheckList.isCompleted(e[i][0])&&t++;return e.length-t},isCompleted:function(e){var t=["invite_member","view_applications"];if(t.indexOf(e)>-1)return"1"===$zcg.ADMIN_ONBOARDING_STEPS[e];var i=Settings.getFromObj(e);return e&&1===i},isMayBeLater:function(e){var t=["invite_member","view_applications"];if(t.indexOf(e)>-1)return"0"===$zcg.ADMIN_ONBOARDING_STEPS[e];var i=Settings.getFromObj(e);return e&&0===i},updateCompleted:function(e){var t=["invite_member","view_applications"];if(t.indexOf(e)>-1)return void($zcg.ADMIN_ONBOARDING_STEPS[e]="1");var i={};i[e]=1,Settings.updateInObj(i)},handleGetStartedMenu:function(e){var t=CheckList.getRemainingSteps(),i=e.find("ul");if(i.find('li[documentclick="checklist"]').remove(),0==t)return void $("#ztb-checklistcount").remove();if(i){var a=$("#ztb-settings");a.find("#ztb-checklistcount").remove(),c(a),i.prepend('<li documentclick="checklist"><a>'+Resource.getRealValue("checklist.getstarted")+"<em>"+t+"</em></a></li>")}},updateCount:function(e){var t=CheckList.getRemainingSteps();if(0!=t){var i=$("#ztb-settings");if(i.find("#ztb-checklistcount").remove(),c(i),i.append('<div id="ztb-checklistcount" class="msgnotify mrgT3">'+t+"</div>"),e){var a=new Date;Settings.update({ob_checklist_later:a.getTime()}),i.find(".ztb-icons").append('<span class="touranim" data-target="touranim"></span>'),setTimeout(function(){c(i)},1e4)}}},markInviteMemberComplete:function(){var e=$('[data-purpose="checklist-nav"]').find('li[data-target="invite_member"]');e.attr("data-status","completed").removeClass().addClass("zccompleted lineanim"),$zcg.ADMIN_ONBOARDING_STEPS.invite_member="1",CheckList.updateCompletedStatusUI(),CheckList.populateRHS("invitesuccess")},markAsCompleted:function(e){CheckList.updateCompleted(e);var t=$('[data-purpose="checklist-nav"]').find('li[data-target="'+e+'"]');t.hasClass("sel")&&CheckList.selectNextAvailableMenu(t),t.attr("data-status","completed").removeClass().addClass("zccompleted lineanim"),CheckList.updateCompletedStatusUI()},selectNextAvailableMenu:function(e){var t=e.nextAll("li[data-target]").eq(0);if(t.length)t.trigger("click");else{var i=e.prevAll("li[data-target]").eq(0);if(i.length)i.trigger("click");else{var a=CheckList.getRemainingSteps();if(0==a){CheckList.populateRHS("allcompleted");var s=$("#onboardchecklist"),n=s.find('[data-purpose="do-later"]');s.find('[data-purpose="close-onboard"]').attr("data-target",n.find('[data-module="dolater"]').attr("data-target")),n.remove(),$('li[documentclick="checklist"]').remove(),$("#ztb-checklistcount").remove()}}}},hasOrgMembersAlready:function(){return"true"===$zcg._REGISTERED_EXISTING_ZOHOORG_WITHMEMBERS},updateCompletedStatusUI:function(e){if(t.length){var i=CheckList.getChecklistArray().length,e=e||CheckList.getRemainingSteps();t.find('[data-purpose="statusui"] em').eq(e).addClass("chksel"),t.find('[data-purpose="remainingcount"]').html(i-e+"/"+i);var a=0==e?Resource.getRealValue("checklist.steps."+e,[i]):Resource.getRealValue("checklist.steps."+e);$("#onboardchecklist").find('[data-purpose="heading"]').html(a)}},handleErrorOnFileuploadInviteUser:function(e){p(u(e.invalid))}}}(),HoverDetails={};HoverDetails={TRIGGER_LP:1,LHS_LEFTOFFSET:-8,CONTAINER_MAXWIDTH:283,CONTAINER_MAXHEIGHT:200,init:function(){HoverDetails.bindEvents()},hasPermissionforUserInfo:function(e){return $WC.$CUtil.isEmpty(e)?!1:Contacts.isExist(e)&&Contacts.getStatus(e)!=Contacts.INVITED||Users.isSameOrg(e)},getHtml:function(){var e={user:function(e,t){t=t||{};var i=(t.typinguser,t.isfromlhs,t.lastmsginfo),a=t.chid,s=t.htmlstr,n=Users.getImgUrlById(e,"original"),r=HoverDetails.getinfoHtml(e,t),o="",l="",c="",d="";if(HoverDetails.hasPermissionforUserInfo(e)){var u=(Contacts.get(e),Users.getInfo(e)),m="",p="";if(u&&u.timezone&&(m=$Date.getOtherZoneTime(u.timezone,u.timeoffset),p=$.trim(m.split("(")[0])),Users.isUserPeopleInfoExist(e))o=Users.getName(e,u.fullname),l=u.emailid,d=Users.getCheckinStatus(e);else{if(!Users.isUserExist(e)&&!Contacts.isExist(e))return"";o=Users.getName(e),l=Users.getEmailId(e)}WmsImpl.isLocalUser(e)?s=s||Template.HoverUI.LocalUser:Chat.hasProfile(e)?(s=s||Template.HoverUI.User,s=s.replace(/{HISTORY}/g,'<div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("chat.recent")+'"><div class="msi-history"></div></div>').replace(/{VIEWPROFILE}/g,SecurityManager.hasPermission(Modules.DirectMessage)?'operation="hviewinfo"':"").replace(/{HOVERCLASS}/g,"hvrinfo").replace(/{STARTCHAT}/g,SecurityManager.hasPermission(Modules.DirectMessage)?'<div class="zcchticn cur zcchinf" operation="hchat" title="'+Resource.getRealValue("common.startchat")+'"><div class="msi-chat cur"></div></div>':"").replace(/{CALLOPTION}/g,HoverDetails.getCallOptionHtml(e)).replace(/{INFO}/g,'<div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("common.profileinfo")+'"  operation="preview" type="user" uid="'+e+'"><div class="msi-zinfo"></div></div>')):s=s||Template.HoverUI.InvitedUser,s=s.replace(/{USERFULLTIME}/g,m).replace(/{USERTIME}/g,p).replace(/{STATUSCLASS}/g,Contacts.isExist(e)?Contacts.getStatusStyle(e):"").replace(/{INVITEUSER}/g,"").replace(/{UID}/g,e).replace(/{CHECKIN_ST}/g,d)}else Users.isInvalidZuid(e)?(s=Template.HoverUI.NonOrgNonMutualUser,o="{{NONUSER}}",c='<div class="font14 textcent padd10">'+Resource.getRealValue("usermentions.unavailable")+"</div>",r=""):(s=s||Template.HoverUI.NonOrgNonMutualUser,o=Users.getName(e),c='<div class="font14 textcent padd10">'+Resource.getRealValue("usermentions.notaccessible")+"</div>",t.isSilentMention&&(o="{{NONUSER}}",r=""));s=s.replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",o)).replace(/{USERIMAGE}/g,'<canvas width="'+HoverDetails.CONTAINER_MAXWIDTH+'" height="'+HoverDetails.CONTAINER_MAXHEIGHT+'"documentclick="viewprofileimage" id="contacthoverblurimg" uid="'+e+'" imgsrc="'+n+'" class="zcblrimg cur"/><div class="zchvimgcnt"><img documentclick="viewprofileimage" id="contacthoverimg" uid="'+e+'" imgsrc="'+n+'" class="zcorgimg"/></div>').replace(/{MAILIDVAL}/g,l).replace(/{NOTUSER}/g,c).replace(/{ADDINFO}/g,r);var h="";if(i&&a){var g=i.sender,f=i.time,v=WmsImpl.isLocalUser(g)?Resource.getRealValue("common.you"):Users.getName(g,i.dname),h='<div class="chtdetails posl mrgT25 paddB10"><div class="zchthovmsg"><div class="msi-chat"></div><div class="sendrdet"><div class="zlsdtit ellips font14 bold dIB">'+$WC.Matcher.replace("escapeReplacementString",v)+'</div><div class="msgtime clrc font12 floatr dIB">'+($WC.$CUtil.isEmpty(f)?"":$Date.daytime(f))+'</div></div></div><div class="zchthmsg posl clr6 ellips">{LASTMSG}</div></div>',C={html:h,listview:!1};h=ChatsList.getLastMsgHTML(a,i,"",C)}return s=s.replace(/{LASTMSGHTML}/g,h)},bot:function(e,t){t=t||{};var i=(t.typinguser,t.isfromlhs,t.customSenderInfo),a=Bots.getDefaultImgUrl(),s=t.htmlstr,n=i?i.name:"",r=Resource.getRealValue("chatbot.smsg"),o="",l="";if(Contacts.isExist(e)){var c=Contacts.get(e),d=ChatBot.isBot(c.chid);a=d?ChatBot.getHoverImgUrl():Users.getImgUrlById(e),n=c.dname,r=Contacts.getBotStatusMsg(e),o=c.app?'<span class="clr6 fntnrml">'+Resource.getRealValue("common.via")+' <span class="clr5 bold"> '+$WC.$CUtil.processXSS(c.app.name)+" </span>"+Resource.getRealValue("app.app")+(c.app.issandbox?" ("+Resource.getRealValue("app.sandbox")+")":"")+"</span><div>"+$WC.$CUtil.processXSS(c.desc)+"</div>":d?"<div>"+Resource.getRealValue(c.desc)+"</div>":"<div>"+Resource.getRealValue("channel.restapi.endpoint")+"<span title="+$Util.getCustomTooltip('<span style = "width: 200px; display: block ">'+Resource.getRealValue("bot.restapi.title")+"</span>","html")+' class="msi-zinfo mrgL10 clr8 zvtam cur"></span></div><div title="/api/v2/bots/'+c.uniquename+'/message" class="ellips">/api/v2/bots/'+c.uniquename+"/message</div>",l='<div class="mrgB15 textcent"><div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("common.startchat")+'"><div operation="hchat" class="msi-chat"></div></div></div>'}else{if(!Bots.isExist(e))return HoverDetails.getNotFoundHTML("bot",t.targetElement);var u=Bots.getObject(e);a=Bots.getImgUrlById(u.photoid),n=$WC.$CUtil.processXSS(u.name),u.statusmsg&&u.statusmsg.length>0&&(r=u.statusmsg[0]),o="<div>"+$WC.$CUtil.processXSS(u.desc)+"</div>",l='<div botbuttons purpose="subscribe" botid="'+e+'" class="textcent mrgB15"><span class="zcbotsubbtn cur">'+Resource.getRealValue("bots.subscribe")+"</span></div>"}return s=(s||Template.HoverUI.Bot).replace(/{BOTID}/,e).replace(/{DNAME}/,n).replace(/{BOTSTATUS}/g,r).replace(/{DNAMEVAL}/,n).replace(/{MAILIDVAL}/g,r).replace(/{BOTENDPOINT}/,o).replace(/{STARTCHAT}/,l).replace(/{BOTIMAGE}/,'<canvas width="'+HoverDetails.CONTAINER_MAXWIDTH+'" height="'+HoverDetails.CONTAINER_MAXHEIGHT+'"documentclick="viewprofileimage" id="contacthoverblurimg" uid="'+e+'" imgsrc="'+a+'" class="zcblrimg cur"/><div class="zchvimgcnt"><img documentclick="viewprofileimage" id="contacthoverimg" uid="'+e+'" imgsrc="'+a+'"/></div>')},channel:function(e,t){t=t||{};var i=t.typinguser,a=0==t.targetElement[0].id.search("channelpending")?Channels.PENDING:Channels.CREATED,s=a==Channels.CREATED?Channels.getObject(e):Channels.Approval[e],n=s.lminfo,r="",o="",l="",c=i[0],d=i[1],u=$WC.$CUtil.isEmpty(c)?"":'<div class="zchvtyg ellips"><span>'+Users.getName(c,d)+"&nbsp;</span><span>"+Resource.getRealValue("chat.is.type")+"</span></div>";if((Channels.isCreated(s)||Channels.isEditVisibility(s))&&(o='<div id="hoptions" class="zchoviccnt textcent"><div class="zcchticn cur zcchinf" operation="continuechannel" chid="'+s.chid+'" title="'+Resource.getRealValue("common.continue")+'"><div class="msi-chat"></div></div>'+(Channels.isCreated(s)||Channels.isEditVisibility(s)?'<div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("common.viewinfo")+'"  operation="preview" type="channel" uid="'+e+'"><div class="msi-zinfo"></div></div>':"")+("undefined"!=typeof s.joined&&1===parseInt(s.joined)&&ChannelsPermission.hasPermission(Channels.ACTIONS.LEAVE_ALLOWED,s)?'<div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("common.leave")+'"  operation="leave" type="channel" uid="'+e+'"><div class="msi-exit font16"></div></div>':"")+"</div>"),$WC.$CUtil.isEmpty(n))(Channels.isPending(s.chid)||Channels.isEditVisibility(s)&&"true"==$zcg._ISAPPACCOUNTADMIN)&&(o='<div class="zchoviccnt textcent"><div class="zcchticn cur zcchinf" operation="hchat" uid="'+s.cr+'" title="Initiate chat with channel creator"><div class="msi-chat"></div></div><div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("common.viewinfo")+'" operation="preview" type="channel" uid="'+e+'" ><div class="msi-zinfo"></div></div>'+(Channels.isJoined(s.chid)&&Channels.isEditVisibility(s)?'<div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("common.leave")+'"  operation="leave" type="channel" uid="'+e+'"><div class="msi-exit font16"></div></div>':"")+"</div>",l='<div class="clr8 zcctchts zcprlinb"><div class="zchovrcht  font14 bold dIB" operation="approve">'+Resource.getRealValue("common.approve")+'</div><div class="zchovcdel font14 bold dIB mrgL20" operation="reject">'+Resource.getRealValue("common.decline")+"</div></div>"),r='<div class="hdrstatus"><div class="zctxal">'+Resource.getRealValue("group.created.by")+'&nbsp;</div><div class="zctxal bold mrgT5 ellips">'+Users.getName(s.cr,s.cr_n)+"</div></div>"+($WC.$CUtil.isEmpty(s.cd)?"":'<div id="hovergdesc" class="hdrstatus ellips">'+$WC.$CUtil.processXSS(s.cd)+"</div>");else{n=ChatsList.parseLastMsgInfo(s.chid,n);var m='<div class="ellips mrgT10 bold font14">{SENDERNAME}</div>',p='{SENDER}<div class="ellips mrgT10 clr6">{LASTMSG}</div><div class="clrc font12 mrgT10">'+($WC.$CUtil.isEmpty(n.time)?"":$Date.daytime(n.time))+"</div>",h=$WC.$CUtil.isEmpty(n.sender)||MsgUtil.isInfoMsg(n.mtype)?"":'<div><img class="zcsdrimg" src="'+Users.getImgUrlById(n.sender)+'"></div>',g={html:p,senderhtml:m,listview:!1};p=ChatsList.getLastMsgHTML(s.chid,n,s.cn,g),r='<div class="zchthovmsg">'+h+"<div>"+p+"</div></div>"}var f=$WC.$CUtil.isEmpty(s.chid)?Channels.getImgUrl(s.oc_id):Channels.getImgUrlByChid(s.chid);imagehtml='<canvas width="'+HoverDetails.CONTAINER_MAXWIDTH+'" height="'+HoverDetails.CONTAINER_MAXHEIGHT+'"documentclick="viewprofileimage" id="contacthoverblurimg" imgsrc="'+f+'" class="zcblrimg cur"/><div class="zchvimgcnt"><img documentclick="viewprofileimage" id="contacthoverimg" imgsrc="'+f+'"/><span id="loadingdiv" class="zcldng"></span></div>';var v=Template.HoverUI.CHANNEL_HOVERDETAIL.replace(/{TITLE}/g,$WC.$CUtil.processXSS(Channels.getDisplayNameForChannel(s))).replace(/{USERIMAGE}/g,imagehtml).replace(/{CHANNELOPTION}/g,o).replace(/{TYPINGHTML}/g,u).replace(/{CHANNELAPPROVEOPTION}/g,l).replace(/{LASTMSGINFO}/g,$WC.Matcher.replace("escapeReplacementString",r));return v},chat:function(e,t){t=t||{};var i=t.typinguser,a=(t.isfromlhs,ChatsList.get(e)),s=a.lastmsginfo;if(!a.lastmsginfo)return"";var n=MsgUtil.isInfoMsg(s.mtype),r=a.title,o="",l=1,c="",d=a.addinfo,u=a.recipants,m=(ChatUI.getPermissions($.isEmptyObject(d)?a.pcount>2?""+$zcg.CT_NFY_ZOHOGROUP:"1":a.addinfo.CT_TYPE),'<div class="clrc font12 mrgT10">'+(s.time?$Date.daytime(s.time):"")+"</div>"),p='<div class="zlsdtit ellips font14 bold">{SENDERNAME}</div>',h=!1,g=a.lastmsginfo.sender,f="",v="";if(groupchattitle="",a.ctype==$zcg.NO_OPERATIONCHAT){var o=ChatBot.getHoverImgUrl();MyBots.isBotChid(e)&&(o=MyBots.getImgByChid(e))}else $WC.Matcher.check("emailid",a.addinfo.PEND_INV)&&(o="/officechat/images/cnt-avtr.png");if(!$.isEmptyObject(u)){var C=u.length,y=$WC.$CUtil.isEmpty(a.pcount)?0:parseInt(a.pcount),b=y>=3||y>C,E=0;if(y>2&&!h){o="";for(var I="",T=0;C>T&&(!b||3!==E);T++){if(E++,0==T)var S=Users.getImgUrlById(u[T].zuid),R='<canvas width="'+HoverDetails.CONTAINER_MAXWIDTH+'" height="'+HoverDetails.CONTAINER_MAXHEIGHT+'"documentclick="viewprofileimage" id="contacthoverblurimg" imgsrc="'+S+'" class="zcblrimg cur"/><div class="zchvimgcnt dN"><img documentclick="viewprofileimage" class="zcorgimg dN" id="contacthoverimg" imgsrc="'+S+'"/><span id="loadingdiv" class="zcldng"></span></div>';I+='<img title="'+Users.getName(u[T].zuid,u[T].dname)+'"src="'+Users.getImgUrlById(u[T].zuid)+'"/>'}if(b){var A=y-E;A>0&&(E++,I+="<div>+"+A+"</div>")}groupchattitle=r,c=R+'<div class="usrimgsts floatl zcgrpcht">'+I+"</div>"}else if(C>1&&y>1)for(var T=0;C>T;T++)WmsImpl.isLocalUser(u[T].zuid)||(o=Users.getImgUrlById(u[T].zuid,"original"),f=Users.getName(u[T].zuid,u[T].dname),v=HoverDetails.getCallOptionHtml(u[T].zuid))}var M=$WC.$CUtil.isEmpty(o)?c:'<canvas width="'+HoverDetails.CONTAINER_MAXWIDTH+'" height="'+HoverDetails.CONTAINER_MAXHEIGHT+'"documentclick="viewprofileimage" id="contacthoverblurimg" imgsrc="'+o+'" class="zcblrimg cur"/><div class="zchvimgcnt"><img documentclick="viewprofileimage" class="zcorgimg" id="contacthoverimg" imgsrc="'+o+'"/><span id="loadingdiv" class="zcldng"></span></div>',U=Template.HoverUI.chat;r=f==r?r:"",$WC.$CUtil.isEmpty(s)||(dname=Users.getName(s.sender,s.dname),p=""),U=Template.HoverUI.CHAT_HOVERDETAIL.replace(/{TITLE}/g,n?"":'<div class="zlsdtit ellips font14 bold">'+dname+"</div>").replace(/{CHATTITLE}/g,$WC.$CUtil.isEmpty(groupchattitle)?"":'<div class="zcinhds bold font14 ellips mrgT10">'+groupchattitle+"</div>").replace(/{CHID}/g,e).replace(/{LASTMSGTIME}/g,m).replace(/{CALLOPTION}/g,v).replace(/{USERIMAGE}/g,M),U=U.replace(/{CHID}/g,e).replace(/{CTYPE}/,l).replace(/{UPLOADCLASS}/g,"").replace(/{MSGSENDUSERIMG}/g,$WC.$CUtil.isEmpty(g)||n?"":'<div><img class="zcsdrimg" src="'+Users.getImgUrlById(g)+'"></div>'),i="undefined"!=typeof i?i:[];var w=i[0],_=i[1];U=$WC.$CUtil.isEmpty(w)?U.replace(/{TYPINGHTML}/g,""):U.replace(/{TYPINGHTML}/g,'<div class="zchvtyg ellips"><span>'+Users.getName(w,_)+"&nbsp;</span><span>"+Resource.getRealValue("chat.is.type")+"</span></div>");var O={html:U,senderhtml:p,listview:!1};return U=ChatsList.getLastMsgHTML(e,s,r,O)},commandinfo:function(e,t){var i=Commands.getObject(e);if("undefined"==typeof i)return HoverDetails.getNotFoundHTML("command",t.targetElement);var a="",s={CONTAINER_MAXWIDTH:HoverDetails.CONTAINER_MAXWIDTH,CONTAINER_MAXHEIGHT:HoverDetails.CONTAINER_MAXHEIGHT,CID:e,IMGURL:Commands.getImgUrl(e),COMMANDNAME:"/"+i.name,HINT:i.hint,UID:i.creator,DEVELOPER:Users.getName(i.creator,i.creator_name),$CHATTITLE:"common.you",OPERATION:"",USERCLASS:"",$DEV_INSTALLER:"app.developer"},n="";return i.appdetails&&(n=i.appdetails.issandbox?'<div id="appinfo" aid={{AID}} class="zcconactdet mrgT20"><div class="bold font14"><span class="zcusrehov">{{EXTN}}</span></div><div class="mrgT5"><span class="clr0">{{APPNAME}} ({{SANDBOX}})</span></div></div>':'<div id="appinfo" aid={{AID}} class="zcconactdet mrgT20"><div class="bold font14"><span class="zcusrehov">{{EXTN}}</span></div><div class="mrgT5" operation="appinfo"><span class="clr0 zctxthgh cur">{{APPNAME}}</span></div></div>',n=$WC.template.replace(n,{$EXTN:"app.app",$SANDBOX:"app.sandbox",AID:i.appdetails.store_appid,APPNAME:i.appdetails.name})),a=$WC.template.replace(Template.HoverUI.Command,{APPLICATION:n},"InSecureHTML"),i.appdetails&&!i.appdetails.issandbox&&(s.$DEV_INSTALLER="app.install.by"),i.creator!=$zcg._ZUID&&(s.$CHATTITLE="common.startchat",s.OPERATION="operation=hchat",s.USERCLASS="cur zctxthgh"),a=$WC.template.replace(a,s)},app:function(e){var t=Applications.getObjectByStoreId(e),i={container_maxwidth:HoverDetails.CONTAINER_MAXWIDTH,container_maxheight:HoverDetails.CONTAINER_MAXHEIGHT,id:e,image_src:Applications.getImgUrlById(t.photo_id),name:t.name,desc:t.description,developer_id:t.developer,developer_name:Users.getName(""+t.developer,t.developer_name),$chat_title:"common.you",$installed_or_created_by:"app.install.by",operation:"",user_class:""};return t.issandbox&&(i.$installed_or_created_by="app.developer"),t.developer!=$zcg._ZUID&&(i.$chat_title="common.startchat",i.operation="operation=hchat",i.user_class="cur zctxthgh"),$WC.template.replace(Template.HoverUI.Application,i)}};return function(t,i,a){return"messageaction"===t||"scheduler"===t||"function"===t?HoverDetails.getNotFoundHTML(t,a.targetElement,!0):("user"!==t&&"contact"!==t||!Contacts.isBotId(i)?("user"===t||"contact"===t)&&(t="user"):t="bot",e[t](i,a))}}(),getNotFoundHTML:function(e,t,i){var a='<div id="hoptions" class="zc-hover-cntr-empty"><img src="{{image_src}}"/><span title="{{name}}" class="bold mrgL10 font14 ellips">{{name}}</span>'+(i?"":'<span class="msi-zinfo cstominfo font14 mrgL10" title="{{tool_tip}}"></span>')+"</div>",s=$(t).attr("component_name"),n=Users.getDefaultImgUrl();switch(e){case"command":n=Commands.getDefaultImgUrl();break;case"bot":n=Bots.getDefaultImgUrl();break;case"messageaction":n=MessageActions.getDefaultImgUrl();break;case"function":n=Functions.getDefaultImgUrl();break;case"scheduler":n=Schedulers.getDefaultImgUrl();break;case"application":n=Applications.getDefaultImgUrl()}return $WC.template.replace(a,{image_src:n,name:s,$tool_tip:"messagesource.moreinfo.noallowed"})},bindEvents:function(){var e=$("#hover");e.on("click","[operation]",function(t){var i=$(this),a=e.attr("hovereduid"),s=e.attr("type"),n=i.attr("operation");if("user"===s||"contact"===s||"bot"===s)if("more"===n||"less"===n){if(t.stopPropagation(),Contacts.isExist(a)||WmsImpl.isLocalUser(a))var r=Contacts.get(a),o=WmsImpl.isLocalUser(a)?$DB.get("status").Default[0]:$Util.getTitleString(Contacts.getStatusMsg(r.smsg,r.status));if("more"===n)e.find("#moreless").attr("operation","less").text(Resource.getRealValue("common.less.continuation"));else{var o=$.trim(o.substr(0,74))+"...";e.find("#moreless").attr("operation","more").text(Resource.getRealValue("common.more.continuation"))}e.find("#statusmsg").html($WC.$CUtil.processXSS(o))}else"videocall"===n?(HoverDetails.hide(),MMChat.triggerVideoCall(i.attr("uid"),"contact_hover"),WebMessanger.hideOnesearch()):"audiocall"===n?(HoverDetails.hide(),MMChat.triggerAudioCall(i.attr("uid"),"contact_hover"),WebMessanger.hideOnesearch()):"preview"===n?(HoverDetails.hide(),UserInfo.createUserRHSView(a),WebMessanger.hideOnesearch()):"addtochannelorchat"===n?(HoverDetails.hide(),Composer.handleAddMember([a],i.attr("chid")),ZCTrack.track("ADD_MEMBER_FROM_HOVER",{TRIGGER:"Mouse"})):($WC.$Win.closeAll(),HoverDetails.hide(),ContactsList.doOperation(n,a));else if("channel"===s)if(HoverDetails.hide(),"preview"===n)ChannelsUI.triggerPreview(a);else if("leave"===n){var l=Channels.getObject(a);Channels.isJoined(l)&&Channels.leave(l.chid)}else"continuechannel"===n?ChannelsUI.getChat(i.attr("chid"),a):"hchat"===n?ContactsList.doOperation(n,i.attr("uid")):("approve"===n||"reject"===n)&&ChannelsUI.doOperation(n,a);else if("chat"===s){if(HoverDetails.hide(),"continuechat"===n)ChatsList.attachContinueActiveChat(i.attr("chid"));else if("videocall"===n)MMChat.triggerVideoCall(i.attr("uid"),"contact_hover");else if("audiocall"===n)MMChat.triggerAudioCall(i.attr("uid"),"contact_hover");else if("preview"===n)HoverDetails.hide(),UserInfo.createUserRHSView(i.attr("uid"));else if(ChatsList.isOnetoOneChat(a)){var c=ChatsList.getRecipientDatafor121chat(a).zuid;ContactsList.doOperation(n,c)}}else"commandinfo"===s?($WC.$Win.closeAll(),HoverDetails.hide(),"hchat"===n?Chat.create(e.find("#devinfo").attr("uid"),"im"):"commandinfo"===n?(IntegrationUI.init(Integration.Modules.Commands),CommandsUI.handle.preview(this,t,e.find("#hoptions").attr("cid"))):"appinfo"===n&&(t.stopPropagation(),ApplicationsUI.handle.previewFromChat(e.find("#appinfo").attr("aid")))):"app"===s&&($WC.$Win.closeAll(),HoverDetails.hide(),"hchat"===n?Chat.create(e.find("#devinfo").attr("uid"),"im"):"app_preview"===n&&(t.stopPropagation(),ApplicationsUI.handle.previewFromChat(e.find("[store_appid]").attr("store_appid"))));LeftPannel.clearHoverTimeOut()}),e.on("click",'[hover="true"]',function(e){e.stopPropagation()}),e.on("mouseenter",function(){LeftPannel.ishovered=!0}),e.on("mouseleave",function(t){LeftPannel.ishovered=!1,t.stopPropagation();var i=t.relatedTarget;if(null!==i){if($(i).closest(".ui-ztooltip").length)return;if($Util.isClickableHoverElem(i)&&$Util.isHoverElement($(this),i,"hover"))return $(i).addClass("zcurdft"),void($Util.isMentionElement(i)&&$(i).attr("class","zclfthovmn"))}parseInt(e.attr("triggerfrom"))===parseInt(HoverDetails.TRIGGER_LP)&&LeftPannel.mouseout(t,this)}),e.on("mousedown",function(e){e.stopPropagation()})},showDetails:function(e,t){var i=$("#hover"),a=$(e).attr("elemtype"),s=$(e).attr("uid"),n=$(e).attr("catagory"),r="",t=t||{};if(i.attr("hovereduid")===s){if(t.targetElement=e,s==$zcg._ZUID?i.addClass("zcmyprfl"):i.removeClass("zcmyprfl"),"chat"==a&&ChatsList.isOnetoOneChat(s)){var o=ChatsList.get(s),l=o.lastmsginfo,c=ChatsList.getRecipientDatafor121chat(s).zuid;if(l&&(t.lastmsginfo=l,t.chid=s),!Users.isAdditionalInfoExist(c))return void PeopleServerData.getProfileInfoFromServer(c,function(){parseInt(i.attr("hovereduid"))==parseInt(s)&&HoverDetails.showDetails(e,t)});r=HoverDetails.getHtml("user",c,t),s=c}else if("app"===a){var d=Applications.getObjectByStoreId(s);if($WC.$CUtil.isEmptyObject(d)){if(!t.showEmpty)return void Applications.get(function(){t.showEmpty=!0,HoverDetails.showDetails(e,t)});r=HoverDetails.getNotFoundHTML("application",e)}else r=HoverDetails.getHtml(a,s)}else t.isSilentMention="undefined"!=typeof e.attr("silentmention"),r=HoverDetails.getHtml(a,s,t);r=$WC.template.replace(r,{NONUSER:e.text().replace("@","")});var u="";if("mutedchats"===n){var m=ChatsList.get($(e).attr("chid")),p=parseInt(m.muted_interval);if(-1!==p){u='<div class="mrgT20 font13"><span>'+Resource.getRealValue("chat.onmute")+' : </span><span class="bold">'+Resource.getRealValue("chat.mute.infinite")+"</span></div>";var h=p-+new Date;7>h/864e5&&(u='<div class="mrgT20 font13"><span>'+Resource.getRealValue("chat.onmute")+' : </span><span class="bold">'+$Date.relativetimeleft(p)+"</span></div>")}}if(r=r.replace(/{MUTEDDETAILS}/g,u),r.length>0){i.html(r),!Contacts.isBotId(s)&&Users.isExist(s)&&Users.checkAndUpdateAvailabilityStatus(s,i[0]),i.find("#invitecont").appendTo("#hoptions"),i.find("#contacthoverimg").hide();var g=i.find("#contacthoverimg")[0];$WC.$CUtil.isEmpty(g)?i.find("#loadingdiv").fadeOut("fast"):(this.CONTAINER_MAXHEIGHT="channel"==a?150:200,i.find("#contacthoverimg").on("load",function(){HoverDetails.setImgAspectRatio(this,this.width,this.height),i.find("#loadingdiv").fadeOut("fast"),i.find("#contacthoverimg").fadeIn("slow")}).attr("src",g.getAttribute("imgsrc"))),i.show();var f={positionparent:!0,leftoffset:t.leftoffset};$Util.positionTargetElement(e,i.children().first(),f)}}},show:function(e,t,i){var a,s=$(e),n=$("#hover"),r=s.attr("elemtype"),o=s.attr("uid"),l={};switch(l.isfromlhs=t,i&&(l.typinguser=i),t?(n.addClass("zchvinlft"),a=HoverDetails.LHS_LEFTOFFSET,l.leftoffset=a):n.removeClass("zchvinlft"),r){case"user":case"contact":if($WC.$CUtil.isEmpty(o)||WmsImpl.isAnnonUser(o)||$WC.Matcher.check("emailid",o))return;var c=s.context.parentElement.parentElement.attributes;!t&&c.hasOwnProperty("chid")&&$Util.isAllowedUser(c.chid.value,o,function(e){e&&(l.addchid=c.chid.value,l.isAllowedUser=e,HoverDetails.showDetails(s,l))}),n.attr("hovereduid",o).attr("type",r).attr("triggerfrom",t?HoverDetails.TRIGGER_LP:"").addClass("zcbrn");var d=!1;if(d=Contacts.isBotId(o)?Contacts.isExist(o)||Bots.isExist(o):Users.isAdditionalInfoExist(o))HoverDetails.showDetails(s,l);else{$("#hover").show(),$("#hoptions").show().html('<div class="zcldng zcemtyld"></div>');var u={positionparent:!0,leftoffset:a};$Util.positionTargetElement(s,n.children().first(),u),Contacts.isBotId(o)?Bots.getOrgBot(o,function(){var e="undefined"!=typeof s.attr("mentionedid")?s.text().substring(1):s.parents("[customsender_name]").attr("customsender_name");l.customSenderInfo={name:e},HoverDetails.showDetails(s,l)}):PeopleServerData.getProfileInfoFromServer(o,function(e){parseInt(n.attr("hovereduid"))==parseInt(e)&&HoverDetails.showDetails(s,l)},function(){Users.isInvalidZuid(o)||Users.invalidUserIds.push(o),HoverDetails.showDetails(s)})}break;case"channel":t?(n.attr("hovereduid",o).attr("type",r).attr("triggerfrom",t?HoverDetails.TRIGGER_LP:"").addClass("zcbrn"),HoverDetails.showDetails(s,l)):ChannelsUI.triggerPreview(o,s[0].hasAttribute("message_source_component"));break;case"chat":n.attr("hovereduid",o).attr("type",r).attr("triggerfrom",t?HoverDetails.TRIGGER_LP:"").addClass("zcbrn"),HoverDetails.showDetails(s,l);break;case"command":IntegrationUI.construct(),CommandsUI.handle.preview(s,void 0,!0);break;case"commandinfo":case"app":case"messageaction":case"scheduler":case"function":n.attr("hovereduid",o).attr("type",r),HoverDetails.showDetails(s)}},handleEscape:function(){return HoverDetails.hide()},getinfoHtml:function(e,t){t=t||{};var i=t.addinfo||'<div class="zcconctd">{TEAMINFODIV}<div class="zctxal mrgT20"><div>{MOBILE}{EXTN}{COUNTRYHTML}</div></div><div id="invitecont" invitecont class="clr8 zcctchts zcprlinb">{INVITEUSER}{ADDMEMBER}</div></div>',a=Users.getInfo(e),s=Contacts.get(e),n="";if(a&&a.country&&HoverDetails.hasPermissionforUserInfo(e)){var r=a.country;n=a.timezone&&a.timeoffset?$Date.getOtherZoneTime(a.timezone,a.timeoffset):""}if(Users.isAdditionalInfoExist(e)){var o=$WC.$CUtil.processXSS(a.designation),l=$WC.$CUtil.processXSS(a.departmentname),c=$WC.$CUtil.processXSS(a.mobile),d=$WC.$CUtil.processXSS(a.extension),u=$WC.$CUtil.processXSS(a.work_location);o||l||(i=i.replace(/{COUNTRYHTML}/g,r?'<div class="zctxal bold"><span class="country">'+Resource.getRealValue("common.country")+'</span></div><div class="zctxal mrgT5 ellips">'+$WC.Matcher.replace("escapeReplacementString",$WC.$CUtil.processXSS(r))+"</div>":"")),i=i.replace(/{TEAMINFODIV}/g,o||l?'<div id="teaminfo" class="mrgT20">{DESIGNATION}{DEPARTMENT}</div>':""),i=i.replace(/{DESIGNATION}/g,o?'<div class="zctxal">'+$WC.Matcher.replace("escapeReplacementString",o)+"</div>":"").replace(/{DEPARTMENT}/g,l?'<div class="zctxal mrgT5">'+$WC.Matcher.replace("escapeReplacementString",l)+"</div>":"").replace(/{DEPARTMENT_ID}/g,a.department_id||"").replace(/{EMPID}/g,a.empid||"").replace(/{MOBILE}/g,c?'<span class="clr6 dIB">'+Resource.getRealValue("common.mobile")+'&nbsp;:&nbsp;</span><span class="bold dIB paddR10">'+$WC.Matcher.replace("escapeReplacementString",c)+"</span>":"").replace(/{EXTN}/g,d?(c?"":"")+'<div class="clr6 mrgT5"><span class="extn">'+Resource.getRealValue("common.extension")+'&nbsp;:&nbsp;</span><b class="clr0">'+$WC.Matcher.replace("escapeReplacementString",d)+"</b></div>":"").replace(/{COUNTRY}/g,t.getlocation?r:"").replace(/{LOCALTIME}/g,n||"").replace(/{WORKLOCATION}/g,u?u:"").replace(/{COUNTRYHTML}/g,"")}else if(Contacts.isBotId(e)){var m=Bots.getObject(e),p="";if(m.app&&!$WC.$CUtil.isEmpty(m.app.id)){var p=Resource.getRealValue("common.via")+' <span class="bold">'+$Util.xssAndEscapeReplacementString(m.app.name)+"</span> "+Resource.getRealValue("app.app");m.app.issandbox&&(p=p+" ("+Resource.getRealValue("app.sandbox")+") ")}i=i.replace(/{API}/,"/api/v2/bots/"+m.uniquename+"/message").replace(/{DESC}/,m.desc).replace(/{EXTN}/,p)}else i=i.replace(/{TEAMINFODIV}/g,"").replace(/{EXTN}/g,"").replace(/{MOBILE}/g,"").replace(/{COUNTRYHTML}/g,r?'<div class="zctxal bold"><span class="country">'+Resource.getRealValue("common.country")+'</span></div><div class="zctxal mrgT5 ellips">'+$WC.Matcher.replace("escapeReplacementString",r)+"</div>":"").replace(/{LOCALTIME}/g,n).replace(/{WORKLOCATION}/g,"").replace(/{EMPID}/g,"");if(t.getstatus){if(null!==s||WmsImpl.isLocalUser(e)){var h=WmsImpl.isLocalUser(e)?$WC.$CUtil.processXSS($DB.get("status").Default[0]):$Util.getTitleString(Contacts.getStatusMsg(s.smsg,s.status));i=i.replace(/{STATUSDIV}/g,'<div id="statusmsg" class="zchvrsts line-clamp">'+$WC.Matcher.replace("escapeReplacementString",h)+"</div>"),i=i.replace(/{TEAMINFOCLASS}/g,"zchvrlinbtb")}else i=i.replace(/{STATUSDIV}/g,"").replace(/{TEAMINFOCLASS}/g,"");i=i.replace(/{CONTACTINFOCLASS}/g,(h||o||l)&&(c||d||r)?"zchvrlinbtb":"")}if(!$WC.$CUtil.isEmptyString(t.addchid)&&t.isAllowedUser){var g=new $CliqChatId(t.addchid);i=i.replace(/{ADDMEMBER}/g,'<div operation="addtochannelorchat" id="invitetochat" class="zchovrcht font14 bold dIB mLR10" chid="'+t.addchid+'" uid="'+e+'" >'+Resource.getRealValue(g.isChannel()?"add.to.channel":"add.to.chat")+"</div>"),i=i.replace(/{INVITEUSER}/g,"")}return i=null===s||s.status!==$zcg.CON_REQACC&&s.status!==$zcg.CON_REMIND_ME_LATER?null!==s&&s.status===$zcg.CON_UNAPRD?i.replace(/{INVITEUSER}/g,'<div operation="inviteuser" class="zchovrcht {INVITECLASS} font14 bold dIB">'+Resource.getRealValue("contact.reinvite")+'</div><div operation="deleteinvite" class="zchovcdel font14 bold dIB mrgL20">'+Resource.getRealValue("contact.delete.invite")+"</div>"):Contacts.isMutual(e)||WmsImpl.isAnnonUser(e)||WmsImpl.isLocalUser(e)?i.replace(/{INVITEUSER}/g,""):i.replace(/{INVITEUSER}/g,'<div operation="inviteuser" class="zchovrcht {INVITECLASS} font14 bold dIB">'+Resource.getRealValue("contact.invite")+"</div>"):i.replace(/{INVITEUSER}/g,'<div operation="accept" class="zchovrcht {INVITECLASS} font14 bold dIB">'+Resource.getRealValue("contact.accept.invite")+"</div>"),i=i.replace(/{INVITECLASS}/g,""),i=i.replace(/{ADDMEMBER}/g,"")},getCallOptionHtml:function(e){var t=Contacts.get(e),i=t?parseInt(t.status):0;if(!MMChat.isRunning&&MMChat.isInitialized&&i!==$zcg.CON_UNAPRD&&i!==$zcg.CON_REQACC){var a=MMChat.isAudioCallEnabled()?'<div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("videochat.audiocall")+'" operation="audiocall" uid="'+e+'"><div class="msi-call"></div></div>':"",s=MMChat.isVideoCallEnabled()?'<div class="zcchticn cur zcchinf" title="'+Resource.getRealValue("videochat.videocall")+'" operation="videocall" uid="'+e+'"><div class="msi-video"></div></div>':"";return a+s}return""},hide:function(){var e=$("#hover");return e.attr("hovereduid","").attr("type",""),"block"===e.css("display")?(e.hide(),!0):!1},setImgAspectRatio:function(e,t,i){var a=i/this.CONTAINER_MAXHEIGHT>=t/this.CONTAINER_MAXWIDTH;$(e).css(a?{width:"auto",height:"100%"}:{width:"100%",height:"auto"}),this.setImagePositon(e,t,i)},setImagePositon:function(e,t,i){var a=this.CONTAINER_MAXWIDTH,s=this.CONTAINER_MAXHEIGHT,n=$Util.getAspectRatioFit(e.width,e.height,a,s,!0);t>a&&i>s-40&&$(e).attr("style","").css({width:n.width+"px",height:n.height+"px"}).parent().css({height:"100%",width:"100%"}),a>t&&s-40>i&&$(e).attr("style","").parent().css({height:$("#imgcontainer").height()-40,width:"100%"}),t>a&&s-40>i&&$(e).attr("style","").css({width:n.width+"px",height:n.height+"px"}).parent().css({height:$("#imgcontainer").height()-40,width:"100%"}),a>t&&i>s-40&&$(e).attr("style","").css({width:n.width+"px",height:n.height+"px"}),this.populateBlurBgImage(e,"",n)},populateBlurBgImage:function(e,t,i){var a=this.CONTAINER_MAXWIDTH-i.width,s=this.CONTAINER_MAXHEIGHT-i.height;if(0!=a||0!=s){var n=$(e).parent().siblings("canvas")[0],r=i.width/i.ratio,o=i.height/i.ratio;if(a>0){var l=a/10;n.getContext("2d").drawImage(e,0,0,l,o,0,0,a/2,this.CONTAINER_MAXHEIGHT),n.getContext("2d").drawImage(e,a/2,0,i.width,this.CONTAINER_MAXHEIGHT),n.getContext("2d").drawImage(e,r-l,0,l,o,i.width+a/2,0,a/2,this.CONTAINER_MAXHEIGHT)}else if(s>0){var c=s/10;n.getContext("2d").drawImage(e,0,0,r,c,0,0,this.CONTAINER_MAXWIDTH,s/2),n.getContext("2d").drawImage(e,0,s/2,this.CONTAINER_MAXWIDTH,i.height),n.getContext("2d").drawImage(e,0,o-c,r,c,0,i.height+s/2,this.CONTAINER_MAXWIDTH,s/2)}}}};var ZCTrack={};ZCTrack={source:1,actionmapping:{CREATE_CHAT:"Create Chat",SPOTLIGHT_SEARCH:"Spotlight Search",ADDMEMBER:"Member Added",SMILEY:"Smiley",MANAGE:"Manage Org",UPGRADE:"Upgrade plan",AUDIOVIDEOCALL:"AudioVideo Call",CALL_INITIATED:"Call Initiated",CALL_ANSWERED:"Call Answered",CALL_CONNECTED:"Call Connected",CALL_DISCONNECTED:"Call Disconnected",CALL_FAILED:"Call Failed",PRIMETIME_TRIGGER:"Trigger PrimeTime",PRIMETIME_HOST_CAM_SUCCESS:"Host Camera Permission Success PrimeTime",PRIMETIME_HOST_CAM_FAILURE:"Host Camera Permission Failure PrimeTime",PRIMETIME_JOIN:"Join PrimeTime",PRIMETIME_ALLOW_LIVEPIC:"Allow LivePicture PrimeTime",PRIMETIME_DENY_LIVEPIC:"Deny LivePicture PrimeTime",UPDATE_BOT_HANDLERS:"Update Bot Handlers",NEW_SEARCH:"New Search",SEARCH_QUANTIFIER:"Search Quantifier",CHAT_HISTORY_VIEW:"Chat History View",MARKETPLACE_APPSLINK:"Clicked Marketplace link",INVITE_USER_THROUGH_FILE:"Admins Inviting Users through file upload",GA_DIRECTMESSAGE:"Global Action - DirectMessage",GA_ADHOCCHAT:"Global Action - AdhocChat",GA_AUDIOVIDEOCALL:"Global Action - AudioVideoCall",GA_CREATECHANNEL:"Global Action - CreateChannel",GA_CREATEEVENT:"Global Action - CreateEvent",EVENT_RESCHEDULE:"Event rescheduled",EVENT_USEREDIT:"Event attendees edited",EVENT_CREATE_FROM_MCP:"Event creation from messageconextparser",LHS_MORE_CHANNEL:"Channel More - LHS",LHS_MORE_CONTACTS:"Contacts More - LHS",LHS_MORE_BOTS:"Bots More - LHS",LHS_MORE_CHATS:"Chats More - LHS",CHANNELS_CLICKED:"Channels Clicked",LHS_CHANNEL_CLICK:"Accessed Channel from LHS Channels",RHS_ACTION:"RHS Actions",ANNOTATE:"Annotate",ACTIONS_ON_MSG:"Actions on Messages",ADD_MEMBER_FROM_HOVER:"Add to Channel - Chat from Hover",UNFURLING:"Unfurling"},init:function(){try{$zoho.spotlight.identify($zcg._ZUID)}catch(e){return}},track:function(e,t){if("undefined"==typeof this.actionmapping[e])throw e+" is not defined in Tracking actions map";try{1===this.source&&$zoho.spotlight.track(this.actionmapping[e],t)}catch(i){return}}};var DREImpl={},Executions={};DREImpl={jsonViewCSSLoaded:!1,jsonViewJSLoaded:!1,current:{params:null,handlerHelpLink:null},helpLinks:{},isEditorExist:function(){return $("#delugeEditorArea").length>0},isEditorInitialised:function(){return this.isEditorExist()&&$("#delugeEditorArea").children().length>0},loadEditorFiles:function(e){if("undefined"==typeof delugeEditor){var t=document.createElement("script");t.src="//"+$zcg._DRESERVERURL+"/js/includeDelugeEditor.js",document.head.appendChild(t),"function"==typeof e&&(t.onload=e)}else"function"==typeof e&&e()},init:function(e){var t=DREImpl.getDREScript(e);DREImpl.current.params=e.params;var i="",a=e.params;if(!$WC.$CUtil.isEmpty(a)){i="{";for(var s=0;s<a.length;s++)i+=a[s].param_type+":"+a[s].param_name+",";i=i.substring(0,i.length-1),i+="}"}var n=function(){if(DREImpl.isEditorInitialised())$("#delugeeditorcontainer").removeClass("zcshowloading"),delugeEditor.setEditorContent(t),delugeEditor.setOptions({topBar:{config:[{label:"Help",submenu:[{action:"changeUrl",label:"Cliq Guide",url:DREImpl.current.handlerHelpLink}]}]}}),$WC.$CUtil.isEmpty(i)||delugeEditor.addFuncParamsToEditor(i),DREImpl.handle.hideLogs();else{var e={script:t,save:function(){DREImpl.saveScriptCallback()},saveAndExecute:function(){DREImpl.saveScriptCallback(!0)},execute:function(){DREImpl.saveScriptCallback(!0)},loading:{show:function(){$("#delugeeditorcontainer").addClass("zcshowloading")},hide:function(){$("#delugeeditorcontainer").removeClass("zcshowloading")}},callback:function(){delugeEditor.setEditorContent(t),$WC.$CUtil.isEmpty(i)||delugeEditor.addFuncParamsToEditor(i)}};e.topBar={config:[{label:"Help",submenu:[{action:"changeLabel",label:"Guide",newLabel:"Deluge Utilities"},{action:"remove",label:"Cliq Guide"},{action:"add",after:"Deluge Utilities",type:"link",label:"Cliq Guide",url:DREImpl.current.handlerHelpLink},{action:"changeLabel",label:"Support",newLabel:"Contact Us"}]}]},initializeDelugeEditor($("#delugeEditorArea")[0],e)}};"undefined"!=typeof delugeEditor?n():this.loadEditorFiles(function(){n()})},isDelugeEditorScriptChanged:function(){return"undefined"!=typeof delugeEditor&&this.isEditorExist()&&delugeEditor.isEditorContentModified()},checkAndCloseEditor:function(e){if(DREImpl.isDelugeEditorScriptChanged())$WC.$Dlg.alert({id:"delugeeditorsave",bodyhtml:Resource.getRealValue("integration.codechanges"),imagehtml:'<div class="msi-alert"></div>',"class":"zcdlgedtrsv zcdalogbx zcdalogbxgrn",buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){$WC.$Win.isExist("jsonview")&&$WC.$Win.destroy("jsonview"),e()}}]});else if($("#StoragesFieldsCreateUI").length){var t=$("#StoragesFieldsCreateUI").find("[platformdatabaseid]").attr("platformdatabaseid"),i=PlatformDatabasesUI.validateAndGetFields(PlatformDatabases.getObject(t),!1);$WC.$CUtil.isEmptyObject(i)?e():$WC.$Dlg.alert({id:"storagefieldeditorsave",bodyhtml:Resource.getRealValue("storages.fields.savechanges"),imagehtml:'<div class="msi-alert"></div>',"class":"zcdlgedtrsv zcdalogbx zcdalogbxgrn",buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){e()}}]})}else $WC.$Win.isExist("jsonview")&&$WC.$Win.destroy("jsonview"),e()},renderScript:function(e,t,i,a){var s=function(){var s=DelugeUtil.renderScript(e);$(s).attr("clipboardarea","true"),t.html(s).slideDown(function(){t.append('<span documentclick="copyclipboard" class="cpyclip">'+Resource.getRealValue("common.copy")+"</span>"),i.length>0&&(ZCScroll.customScroll(i,!0),$Util.scrollToViewportTop(t,i,200)),"undefined"!=typeof a&&a.length>0&&a.attr("purpose","hideCodePreview").text(Resource.getRealValue("commands.hidecode"))})};"undefined"!=typeof DelugeUtil?s():this.loadEditorFiles(function(){setTimeout(function(){s()},1e3)})},resize:function(){this.isEditorInitialised()&&delugeEditor.resize()},getDREScript:function(e){var t=e.script;return t="\n"+t.substring(t.indexOf("{")+2,t.length-1)},saveScriptCallback:function(e){var t,i=$("#delugeeditorcontainer"),a=i.attr("componentid"),s=i.attr("handlertype"),n=!1;s==CommandConstants.EXECUTION_HANDLER_TYPE||s==CommandConstants.SUGGESTION_HANDLER_TYPE?t=e?function(e){e.commands&&Commands.store(e),UI.updateBanner(Resource.getRealValue("commands.tryin.cwin"),5e3),IntegrationsCwin.init();var t="composer"+IntegrationsCwin.chat.id,i=$("#"+t);$WC.DivEditor.clear(t),$WC.DivEditor.focus(t),$WC.DivEditor.insertText(t,"/"+Commands.getObject(a).name),ChatUI.exist[IntegrationsCwin.chat.id].cursearchval="",i.trigger("keyup")}:function(e){e.commands&&Commands.store(e)}:s==MessageActionConstants.EXECUTION_HANDLER_TYPE?t=function(e){e.messageactions&&MessageActions.store(e)}:ApplicationConstants.isAppHandler(s)?e&&(n=!0,t=function(e){$Util.Button.showCompletionAndResetContent($('[purpose="saveAndExecute"]')),"Success"===e.status&&DREDebugUtil.executeParamsWindow(DREImpl.current.params,s)}):Schedulers.HANDLER_TYPE==s&&e&&(n=!0,t=function(e){"Success"===e.status?Executions.execute(s,a):$Util.Button.showCompletionAndResetContent($('[purpose="saveAndExecute"]'),!0)});var r={componentid:a,script:getEditorValue()};Executions.edit(s,r,t,n)},handle:{closeoutput:function(){$("#integoutputcont").removeClass("zcotani").fadeOut(300)},showOtherHandlers:function(e){Clickoutside.clear("toggleeditcodeoptions");var t=$(e.currentTarget).find('[purpose="switchHandler"]');t.addClass("zcshwalwys"),Clickoutside.bind({destid:"otherhandlerslist",callback:function(){t.removeClass("zcshwalwys")}})},switchHandler:function(e){var t=$(e.target).attr("handlertype");if(!$WC.$CUtil.isEmpty(t)){Clickoutside.handleClickOnChild(e);var i=$("#delugeeditorcontainer"),a=i.attr("modulename"),s=i.attr("componentid");i.addClass("zcshowloading").attr("handlertype",t),delugeEditor.setEditorContent("");var n={module:a};if(Executions.isExist(s,t))DREImpl.handleEditCode(n,s,t);else if(a===Integration.Modules.Bots){var r={botid:"b-"+s,type:t};BotExecutors.create(r,function(e,t,i){DREImpl.handleEditCode(n,MyBots.getId(e),i)})}else if(a===Integration.Modules.Commands||a===Integration.Modules.Functions){var o={componentid:s,type:t};Executions.create(o,function(e){a===Integration.Modules.Commands?Commands.store(e.data):Functions.updateStorage([e.data]),DREImpl.handleEditCode(n,s,t)})}else if(a===Integration.Modules.Applications){var l=Applications.getObject(s).store_appid;ApplicationsUI.handle.createHandler(l,void 0,void 0,t)}$("#drelogstable").remove(),$("#delugeeditorcontainer").removeClass("zcshowdrelogs"),$("#delugeeditorcontainer").find("[editor]").css("height","100%"),$("#drelogs").css("height","0%")}},update:function(e,t){t?delugeEditor.editor.saveAndExecute():delugeEditor.editor.saveScript()},saveAndExecute:function(){delugeEditor.editor.saveAndExecute()},toggleLogs:function(e){$("#integrationwin").hasClass("zcshowdrelogs")?this.hideLogs(e):this.showLogs(e)},showLogs:function(e,t){if($("#integrationwin").addClass("zcshowdrelogs"),$("#integrationwin").find('[purpose="toggleLogs"]').text(Resource.getRealValue("drelogs.hide")),t||!($("#drelogstable").length>0)){var i=$("#delugeeditorcontainer"),a=i.attr("componentId"),s=i.attr("handlerType");Executions.getLogs(a,s,void 0,t)}},refreshLogs:function(e){this.showLogs(e,!0)},hideLogs:function(){$("#integrationwin").removeClass("zcshowdrelogs"),$("#delugeeditorcontainer").find("[editor]").css("height","100%"),$("#drelogstablecontainer").empty(),$("#integrationwin").find('[purpose="toggleLogs"]').text(Resource.getRealValue("drelogs.show"))},expandLogs:function(e){var t=$(e.target);"true"==t.attr("isExpanded")?(t.parent().removeClass("expanded"),t.attr("isExpanded","false").text(Resource.getRealValue("drelogs.show.more")).addClass("debugshowmore")):(t.parent().addClass("expanded"),t.attr("isExpanded","true").text(Resource.getRealValue("drelogs.show.less")).removeClass("debugshowmore"))},toggleMinView:function(){var e=$("#drelogstablecontainer").attr("minview"),t=$("#drelogstablecontainer"),i=$("#drelogstable");"true"==e?(t.attr("minview","false").find(".debugminimz").attr("title",Resource.getRealValue("drelogs.expanded")).toggleClass("msi-more",!0),i.find(".zcdebuginfo").addClass("expanded"),i.find(".debugshowmore").addClass("hide")):"false"==e&&(t.attr("minview","true").find(".debugminimz").attr("title",Resource.getRealValue("drelogs.minimized")).toggleClass("zcf-minimize",!0),i.find(".zcdebuginfo").removeClass("expanded"),DREImpl.checkAndAddShowMore(e,!0)),DREImpl.handleSizeChange()},jsonView:function(e){var t=$(e.currentTarget),i=$WC.$CUtil.decodeHTMLEntities(t.attr("json")),a="",s="";$Util.isValidJSON(i)&&"true"==t.attr("showinmsgbuilder")&&(s=$zcg._SERVERURL+"/messagebuilder#"+encodeURIComponent(i),a='<a id="messagebuilderlink" target="_blank" href="'+s+'">'+Resource.getRealValue("drelogs.msgbuilder.view")+"</a>");var n='<div class="zcjsonvwhdr"><span>{{jsonviewHeader}}</span>'+a+'<span class="zcjsonvwcpy" documentclick="copyclipboard">{{copy}}</span><span id="jsonString" class="zcjsonvwcpydiv" clipboardarea>{{json}}</span></div>';if(n=$WC.template.replace(n,{$jsonviewHeader:"drelogs.jsonview.header",json:i,$copy:"common.copy"}),$WC.$Win.isExist("jsonview"))$("#jsonview").find("#messagebuilderlink").length&&($("#jsonview #messagebuilderlink").attr("href",s),$("#jsonview #jsonString").text(i));else{var r=$WC.$Win.create({id:"jsonview",header:n,"class":"zcjsonvwer",bg:!1,aligncenter:!1,html:'<div id="jsonviewcontainer" class="zcjsonvwcntr"></div>'});$Util.center($("#jsonview")),r.setAsDraggable($("#jsonview #winhead")),r.on("click","a",function(e){e.preventDefault(),window.open(e.target.getAttribute("href"))})}DREImpl.jsonViewJSLoaded&&DREImpl.jsonViewCSSLoaded?($("#jsonviewcontainer").JSONView(i),$Util.center($("#jsonview"))):($(".zcjsonvwcntr").addClass("chlmore-loading"),DREImpl.loadJSONViewDependencyFiles(function(){$(".zcjsonvwcntr").removeClass("chlmore-loading"),$("#jsonviewcontainer").JSONView(i),$Util.center($("#jsonview"))}))},shareTempResponse:function(e){e.stopPropagation();var t=$(e.target).parents("[integresponseelem]"),i=t.attr("time"),a=t.attr("chid");$ZCAjx.ajax({url:"/v1/chats/"+a+"/shareintegrationresponse",type:"POST",contentType:"application/json",data:{msgid:i}})},removeTempResponse:function(e){var t=$(e.target).parents("[integresponseelem]"),i=$(t).parents('[purpose="chatview"]').attr("id");t.slideUp("normal",function(){$(this).remove(),ZCScroll.updateScroll($("#"+i).find("#chatbody"))})},showDetailedConsents:function(e){var t=$(e.currentTarget);t.attr("purpose","hideDetailedConsents").addClass("active"),t.find('[drebuttons][purpose="detailedConsents"]').slideDown(function(){var e=t.closest("[consents_container]");ZCScroll.customScroll(e,!0),$Util.scrollToViewportTop(t,e,100)})},hideDetailedConsents:function(e){var t=$(e.currentTarget);t.attr("purpose","showDetailedConsents").removeClass("active"),t.find('[drebuttons][purpose="detailedConsents"]').slideUp(function(){var e=t.closest("[consents_container]");ZCScroll.customScroll(e,!0)})},executeWithConsent:function(e){var t=$("#platformconsentprompt").find("[consent_key]");Executions.executeWithConsent(t.attr("consent_key"),t.attr("chid"),$(e.currentTarget))},toggleGrantedConsents:function(e){$("#platformconsentprompt").toggleClass("show-granted-consents").removeClass("show-extension-consents"),$(e.currentTarget).toggleClass("text-toggler")},toggleExtensionConsents:function(e){var t=$("#extension-consents");if(t.length)$("#platformconsentprompt").toggleClass("show-extension-consents").removeClass("show-granted-consents");else{var i=$("#platformconsentprompt").find("[consent_key]");Executions.viewExtensionConsents(i.attr("store_appid"),i.attr("consent_key"))}$(e.currentTarget).toggleClass("text-toggler")},showGrantedConsents:function(e){Executions.showGrantedConsents($(e.currentTarget).attr("type"),$("#Integrationspreview").attr("component_id"))},revokeConsents:function(e){var t=$(e.currentTarget);Executions.revokeConsents(t)}},resizerActive:!1,bindSizeChangerEvents:function(){var e=$("#IntegrationsRHS");e.on("mousedown","[sizechanger]",function(){DREImpl.resizerActive=!0,$("#delugeeditorcontainer").addClass("zcnotrans")}),e.on("mousemove",function(e){DREImpl.resizerActive&&DREImpl.handleSizeChange(e)}),e.on("mouseup mouseleave",function(){DREImpl.resizerActive=!1,$("#delugeeditorcontainer").removeClass("zcnotrans")})},bindEvents:function(){$(document).on("click","[drebuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");"function"==typeof DREImpl.handle[t]&&DREImpl.handle[t](e)})},handleSizeChange:function(e){$("[editor]").removeAttr("style");var t="undefined"!=typeof e,i=$("#delugeeditorcontainer"),a=$("#drelogs");a.css("height","auto");var s=0;t&&(s=e.clientY-i[0].offsetTop);var n=i.height(),r=n-s,o=a.height()+20;t||(o=Math.min(o,.4*n)),r=Math.min(r,o);var l=Math.round(r/n*100);l=Math.min(80,Math.max(20,l));var c=100-l;$("[editor]").css("height",c+"%"),a.css("height","calc("+(100-c)+"% - 20px)"),this.resize()},saveAndExecuteFunction:function(e,t,i,a){this.updateFunction(e,t,i,a)},showDebugInfo:function(e){$("#integoutputcont").removeClass("zcotani"),$("#integoutput").html(e),$("#integoutputcont").fadeIn(300).addClass("zcotani")},handleEditCode:function(e,t,i){Clickoutside.clear("otherhandlerslist");var a=e.module,s=$("#delugeeditorcontainer");if(0===s.length){var n,r='integlhsmenu entity="'+a+'"';switch(a){case Integration.Modules.Commands:n='id="commandseditcode" commandid="'+t+'" '+(e.isSuggestion?'suggestion="true"':"");break;case Integration.Modules.Bots:n='id="botseditcode" botid="'+t+'" type="'+i+'" exec_id="'+e.beId+'"',r='botbuttons purpose="editBotHandlers"',t=MyBots.getId(t);break;case Integration.Modules.Functions:n='id="functionseditcode" functionid="'+t+'"';break;case Integration.Modules.MessageActions:n='id="messageactionseditcode" messageactionid="'+t+'"';break;case Integration.Modules.Applications:n='id="appseditcode" type="'+i+'" appid="'+t+'"';break;case Integration.Modules.Channels:n='id="channelseditcode" type="'+i+'" channelid="'+t+'"'}var o=Template.DelugeEditorUI.replace(/{NAME}/,$Util.xssAndEscapeReplacementString(e.name)).replace(/{COMPONENT_ID}/,t).replace(/{HANDLER_TYPE}/,i).replace(/{TYPE}/g,a).replace(/{PARENT_PARAMS}/,n).replace(/{BACK_BUTTON_PARAMS}/,r);Clickoutside.clear("Integrationspreviewcontainer"),$("#integrationwin").removeClass("zcshowdrelogs");var l=$("#IntegrationsRHS").children().length>0?300:0;$("#IntegrationsRHS").fadeOut(l,function(){IntegrationUI.handle.changeLHSState(!0),a===Integration.Modules.Bots&&i!=BotConstants.MESSAGEHANDLERS.MENTION?IntegrationsCwin.init(void 0,MyBots.getChid("b-"+t)):IntegrationsCwin.init(),$(this).html(o),DREImpl.populateOtherHandlers(a.toLowerCase(),i,t),$(this).fadeIn(l,function(){Executions.getDetails(t,i)})})}else Executions.getDetails(t,i),DREImpl.populateOtherHandlers(a.toLowerCase(),i,t)},populateOtherHandlers:function(e,t,i){var a=[];"commands"===e?a=CommandConstants.Handlers:"bots"===e?a=BotConstants.Handlers:"applications"===e?a=ApplicationConstants.Handlers:"functions"===e&&-1!==Functions.FORM_HANDLERS.indexOf(parseInt(t))&&(a=Functions.FORM_HANDLERS);var s="";if(a.length>0){var n=IntegrationsUtil.getHandlerName(t,i),r="";"bots"===e&&(r="<h4>"+Resource.getRealValue("bots.interactions")+"</h4>");for(var o in a){var l=a[o];if(l!=t){var c=IntegrationsUtil.getHandlerName(l);r+='<div handlerType="'+l+'">'+c+"</div>"}}if("bots"===e){var d="b-"+i,u=Bots.getActionHandles(d);if(!$WC.$CUtil.isEmpty(u)){var m="";for(var o in u){var p=u[o],h=$WC.$CUtil.processXSS(p.display_props.name);p.type!=t?m+='<div handlerType="'+p.type+'" class="ellips">'+h+"</div>":n=h}m.length>0&&(r+='<h4 class="ellips">'+Resource.getRealValue("bots.actions")+"</h4>"+m)}}s='<span id="otherhandlers" drebuttons purpose="showOtherHandlers" class="posl cur floatr zcintghndlrs"><span id="editcodeheadertext">'+n+'</span><span class="msi-dwnarw dIB mrgL10 cur"><div id="otherhandlerslist" drebuttons purpose="switchHandler" class="zcchgcmd dN">'+r+"</div></span></span>"}$("#otherhandlers").replaceWith(s)},handleLogs:function(e,t,i){if(this.isEditorExist()){var a=!i&&0===$("#drelogstable").length,s=0;t&&(s=$("#drelogstablecontainer").find("tbody").children("tr").length-1);var n=$("#drelogstablecontainer").attr("minview"),r="true"==n?"zcf-minimize":"msi-more",o="true"==n?"drelogs.minimized":"drelogs.expanded";if(e.length>0){for(var l="",c=0;c<e.length;c++){var d=e[c],u='<div class="txtcent">-</div>';if(d.user){u='<div title="{{executed_time}}">{{time}}</div>'+(d.executionTime?'<div title="{{exec_time}}">{{execution_time}} {{ms}}</div>':"")+'<span title="{{user_id}}">{{zuid}}</span><span class="msi-zinfo mrgL10 clr8 zvtam cur" title="{{email}}"></span>';var m={$user_id:"drelogs.userid",$exec_time:"drelogs.exec_time",$executed_time:"drelogs.executed_time",$ms:"drelogs.milliseconds",zuid:d.user.id,email:d.user.email,execution_time:d.executionTime};u=$WC.template.replace(u,m),u=$WC.template.replace(u,{time:$Date.daytime(d.time,{raw:!0})},"InSecureHTML")}var p="";if(d.output){var h=!1;"object"==typeof d.output&&(h=Array.isArray(d.output)?d.output.length>0:!$WC.$CUtil.isEmptyObject(d.output)),p='<div class="zcdebugresp"><span documentclick="copyclipboard" class="zcjsonvwcpy">{{copy}}</span><span drebuttons showinmsgbuilder="{{msg_builder}}" purpose="jsonView" json="{{output}}">'+(h?(d.outputErrorMessage?'<span title="{{output_error_resp}}" class="msi-alerttriangle mrgR5"></span><span>{{outputerror}}</span><br/>':"")+'<span title="{{title}}" class="msi-external mrgR5 cur {{errorclass}}"></span><span clipboardarea>{{output}}</span>':"<span clipboardarea>{{output}}</span>")+"</span></div>",p=$WC.template.replace(p,{$title:"drelogs.view_output",$output_error_resp:"drelogs.outputjsonerror",output:JSON.stringify(d.output),errorclass:d.outputErrorMessage?"zclogserr":"",msg_builder:d.outputErrorMessage?"false":"true",outputerror:d.outputErrorMessage,$copy:"common.copy"})}else if(d.errorMessage){p='<div class="zcdebugresp"><span title="{{error_resp}}" class="msi-alerttriangle mrgR5"></span><span>{{error}}'+(d.lineNumber>0?" ( {{line_no}} : {{line}} )":"")+"</span></div>";var m={$error_resp:"drelogs.output_error",$line_no:"drelogs.line_number",line:d.lineNumber,error:d.errorMessage};p=$WC.template.replace(p,m)}if(!$WC.$CUtil.isEmpty(d.debugInfo)){p+="<div>";for(var g=0;g<d.debugInfo.length;g++){var f,v=d.debugInfo[g];f=$Util.isValidJSON(v,!0)?'<div class="zcdebugsub"><span drebuttons purpose="jsonView" json="{{debug}}"><span title="{{title}}" class="msi-external mrgR5 cur"></span></span><span clipboardarea>{{debug}}</span><span documentclick="copyclipboard" class="zcjsonvwcpy">{{copy}}</span></div>':'<div class="zcdebugsub">{{debug}}</div>',p+=$WC.template.replace(f,{$title:"drelogs.view_debug_info",debug:v,$copy:"common.copy"})}p+="</div>"}$WC.$CUtil.isEmpty(p)&&(p='<div class="txtcent">-</div>'),l+="<tr><td>"+(s+c+1)+'</td><td class="lin20">'+u+'</td><td class="zcdebuginfo"><div class="debugcelwrp">'+p+"</div></td></tr>"}if(t)$("#drelogstablecntr").find("tbody").append(l);else{var m={$s_no:"drelogs.s_no",$details:"drelogs.req_details",$output:"drelogs.output",$info:"drelogs.info",disIcon:r,$title:o},C='<table><colgroup><col width="50px"><col width="180px"></colgroup><tr><th>{{s_no}}</th><th>{{details}}</th><th>{{output}}<span drebuttons purpose="toggleMinView" title="{{title}}" class="{{disIcon}} debugminimz posa cur line30 hide"></span></th></tr></table><div id="drelogstablecntr" class="zcdrelogstblecntr"><table id="drelogstable"><colgroup><col width="50px"><col width="180px"></colgroup>'+l+"</table></div>";$("#drelogstablecontainer").html($WC.template.replace(C,m)),DREImpl.checkAndAddShowMore(n,!1)}var y="";e.length>=20&&(y=e[e.length-1].time-1),$("#drelogstablecontainer").attr("toTime",y)}else t?$("#drelogstablecontainer").removeAttr("totime"):$("#drelogstablecontainer").html('<div class="zcdrenologs bold">'+Resource.getRealValue("drelogs.none")+"</div>");ZCScroll.resetScroll($("#drelogstablecntr")),$("#drelogstablecntr").off("scroll").on("scroll",function(){var e=$("#delugeeditorcontainer"),t=e.attr("componentId"),i=e.attr("handlerType");clearTimeout(DREImpl.debugLogsScrollTimer),DREImpl.debugLogsScrollTimer=setTimeout(function(){if(ZCScroll.isScrollDown($("#drelogstablecntr")[0])){var e=$("#drelogstablecontainer").attr("totime");$WC.$CUtil.isEmpty(e)||($("#drelogstablecontainer").removeAttr("totime"),Executions.getLogs(t,i,e))}},100)}),a&&DREImpl.handleSizeChange()}},checkAndAddShowMore:function(e,t){for(var i=$("#drelogstable").find("tbody"),a=i.children().length,s=0;a>s;s++){var n=i.children()[s];if(n.offsetHeight>80)if("undefined"!=typeof t&&t!==!0){var r="zcdebugminview",o="";"true"!=e&&(r+=" expanded",o="hide"),$(n).find(".zcdebuginfo").addClass(r).append('<div drebuttons purpose="expandLogs" isExpanded="false" class="debugshowmore p5 cur linkclr '+o+'">'+Resource.getRealValue("drelogs.show.more")+"</div>")}else $(n).find(".debugshowmore").removeClass("hide")}},loadJSONViewDependencyFiles:function(e){var t=document.createElement("script");t.onload=function(){DREImpl.jsonViewJSLoaded=!0,DREImpl.jsonViewCSSLoaded&&e()},t.src=($WC.$CUtil.isEmpty($zcg._JSSTATICURL)?"/officechat/javascript":$zcg._JSSTATICURL+"/officechat/js")+"/thirdparty/jquery.jsonview.js",document.head.appendChild(t);var i=document.createElement("link");i.onload=function(){DREImpl.jsonViewCSSLoaded=!0,DREImpl.jsonViewJSLoaded&&e()};var a=($WC.$CUtil.isEmpty($zcg._CSSTATICURL)?"":$zcg._CSSTATICURL)+"/officechat/styles/thirdparty/jquery.jsonview.css";$(i).attr({rel:"stylesheet",href:a}),document.head.appendChild(i)}};var Executions={isExist:function(e,t){if(t==CommandConstants.EXECUTION_HANDLER_TYPE||t==CommandConstants.SUGGESTION_HANDLER_TYPE){if(t==CommandConstants.EXECUTION_HANDLER_TYPE)return Commands.isExist(e);if(t==CommandConstants.SUGGESTION_HANDLER_TYPE){var i=Commands.getObject(e);return"undefined"!=typeof i.execution_props["suggest.id"]}}else{if(BotConstants.isBotHandler(t)){(""+e).startsWith("b-")||(e="b-"+e);var a=BotExecutors.getByType(e,t);return"undefined"!=typeof a}if(t==MessageActionConstants.EXECUTION_HANDLER_TYPE)return MessageActions.isExist(e);if(t==Functions.BUTTON_HANDLER_TYPE||t==Functions.FORM_HANDLER_TYPE)return Functions.isExist(e);if(t==Functions.FORM_EVENT_HANDLER_TYPE){var s=Functions.getObject(e);return s&&s.execution_props["eventhandler.id"]}if(t==Functions.FORM_VALUES_HANDLER_TYPE){var s=Functions.getObject(e);return s&&s.execution_props["valueshandler.id"]}if(ApplicationConstants.isAppHandler(t)){var n=Applications.getByType(e,t);return"undefined"!=typeof n}if(t==Schedulers.HANDLER_TYPE)return Schedulers.isExist(e)}return!1},create:function(e,t){var i={};DREImpl.isEditorExist()||(i.loading="common.loading"),$ZCAjx.ajax({url:"/v1/executions",type:"POST",data:e,contentType:"application/json",status:i,success:function(e){"function"==typeof t&&t(e)}})},edit:function(e,t,i,a){var s={};a?$Util.Button.addLoadIconForAjax($('[purpose="saveAndExecute"]')):s.loading=$('[purpose="update"]'),DREImpl.handle.closeoutput(),$ZCAjx.ajax({url:"/v1/executions/"+e,type:"PUT",data:t,contentType:"application/json",status:s,success:function(s){if(s=s.data,"Success"===s.status){if(!a){var n=Resource.getRealValue("executor.saved");if(BotConstants.isBotHandler(e)||ApplicationConstants.isAppHandler(e)||e==ChannelWebhooks.HANDLERS.OUTGOING)n=Resource.getRealValue("executor.saved",IntegrationsUtil.getHandlerName(e,t.componentid));else{var r;e==CommandConstants.EXECUTION_HANDLER_TYPE||e==CommandConstants.SUGGESTION_HANDLER_TYPE?r="command.saved":e==MessageActionConstants.EXECUTION_HANDLER_TYPE?r="messageaction.saved":e==Functions.BUTTON_HANDLER_TYPE||-1!==Functions.FORM_HANDLERS.indexOf(parseInt(e))?r="functions.saved":e==Schedulers.HANDLER_TYPE&&(r="schedulers.saved"),"undefined"!=typeof r&&(n=Resource.getRealValue(r))}UI.updateBanner(n,2e3)}}else{var o='<div class="bold font14 erclr">'+Resource.getRealValue("commands.error")+"</div><div>"+(s.lineNumber>0?" ("+Resource.getRealValue("commands.error.lineno",""+s.lineNumber)+")":"")+$WC.$CUtil.processXSS(s.errorMessage)+"</div>";DREImpl.showDebugInfo(o)}"function"==typeof i&&i(s)},error:function(){$Util.Button.showCompletionAndResetContent($('[purpose="saveAndExecute"]'),!0)}})},getDetails:function(e,t,i,a,s){var n=!1;"undefined"==typeof DREImpl.helpLinks[t]&&(n=!0),$ZCAjx.ajax({url:"/v1/executions/"+t,data:{componentid:e,helplinkstatus:n},success:function(e){n?(DREImpl.helpLinks[t]=e.data.helpLink,DREImpl.current.handlerHelpLink=e.data.helpLink):DREImpl.current.handlerHelpLink=DREImpl.helpLinks[t],"undefined"!=typeof i&&i.length>0?DREImpl.renderScript(DREImpl.getDREScript(e.data),i,a,s):$("#delugeEditorArea").length>0&&(DREImpl.init(e.data),(ApplicationConstants.isAppHandler(t)||Schedulers.HANDLER_TYPE==t)&&$("#delugeeditorcontainer").find('[purpose="saveAndExecute"]').removeClass("hide"),$("#delugeeditorcontainer").find('[purpose="showLogs"]').removeClass("dN"),$("#tryanother").show())}})},getLogs:function(e,t,i,a){var s={};s.componentid=e,$WC.$CUtil.isEmpty(i)?$("#drelogstablecontainer").html('<div id="drelogsloading" style="height:100px;"><div class="zcldng"></div></div>'):(s.totime=i,$("#drelogstablecontainer").append('<div id="drelogsloading" class="chlmore-loading"></div>')),$("#drelogs")[0].offsetTop>=$(document).height()&&DREImpl.handleSizeChange(),$ZCAjx.ajax({url:"/v1/executions/"+t+"/logs",data:s,success:function(e){$("#drelogsloading").remove(),DREImpl.handleLogs(e.data.logs,"undefined"!=typeof i,a)}})},"delete":function(e,t,i){$ZCAjx.ajax({url:"/v1/executions/"+t,type:"DELETE",data:{componentid:e},contentType:"application/json",status:{loading:"common.loading",success:"executor.deleted"},success:function(a){BotConstants.isActionType(t)||UI.updateBanner(Resource.getRealValue("executor.deleted",IntegrationsUtil.getHandlerName(t,e)),3e3),"function"==typeof i&&i(a)}})},execute:function(e,t,i){"undefined"==typeof i&&(i={}),$ZCAjx.ajax({url:"/v1/executions/"+e+"/execute",type:"POST",contentType:"application/json",status:{loading:$('[purpose="handleExecute"]')},data:{componentId:t,params:i},success:function(t){DREDebugUtil.populateResult(t,e)},error:function(){Schedulers.HANDLER_TYPE==e&&$Util.Button.showCompletionAndResetContent($('[purpose="saveAndExecute"]'),!0)}})},executeWithConsent:function(e,t,i){$ZCAjx.ajax({url:"/v1/executions/1/confirmconsent",type:"POST",data:{key:e,allow_for_extension:$("#allow_for_extension").is(":checked")},status:{loading:i},contentType:"application/json",success:function(e){var t=$("#platformconsentprompt").find("[consent_key]");if(s=t.attr("chid"),$WC.$Win.destroy("platformconsentprompt"),!$WC.$CUtil.isEmptyObject(e))if(e.data.bots){Bots.store(e.data);var i=e.data.bots[0].id,a=$("#"+i);a.length>0&&a.slideUp(300,function(){if(0===a.siblings().length){var e=a.parent()[0].id;$("#"+e).remove(),$("#"+e+"header").remove()}BotsUI.populate(),ZCScroll.resetScroll($("#botslist"),!0)}),UI.updateBanner(Resource.getRealValue("bot.subscribed",[e.data.bots[0].name]),3e3,!1),"function"==typeof callback&&callback(i);var s=MyBots.getChid(i);if(MyBots.join(s),e.data.dreResponse){var n=Contacts.getBot(i);IntegrationsResponse.showOAuthPrompt(n.dname,e.data.dreResponse)}}else{var r=e.data,o=r.dreResponse.message_source||r.dreResponse.output.meta.message_source;r.dreResponse.result?"Success"===r.dreResponse.status&&r.dreResponse.result.output.length>0&&(CommandSuggestions.clearDropDown(s),CommandSuggestions.populate(s,r.dreResponse.result.output)):IntegrationsResponse.populateOutput(o,r.dreResponse,s)}}})},viewExtensionConsents:function(e,t){$("#platformconsentprompt").addClass("consents-loading"),$ZCAjx.ajax({url:"/v1/applications/"+e+"/impacts",type:"GET",data:{key:t},success:function(e){IntegrationConsents.addExtensionConsentsInView(e.data.consents,e.data.extension.name),$("#platformconsentprompt").removeClass("show-granted-consents consents-loading").addClass("show-extension-consents")}})},showGrantedConsents:function(e,t){$ZCAjx.ajax({url:"/v1/"+e+"s/"+t+"/consents",status:{loading:!0},success:function(i){var a=i.data.granted_consents;if($WC.$CUtil.isEmptyObject(a))return void UI.updateBanner(Resource.getRealValue("platformconsents.consents.none"),void 0,void 0,!0);if("application"===e){var s=i.data.extension;componentInfo={name:s.name,store_appid:s.store_appid,store_appname:s.name}}else{var n=new BaseComponent(i.data.message_source);componentInfo={name:n.getName(),store_appid:n.getStoreAppId(),store_appname:n.getStoreAppName()}}var r=$WC.template.replace(IntegrationConsents.htmls.header,{component_name:componentInfo.name,img_src:"application"!==e?n.getImageURL():Applications.getImgUrlById(i.data.extension.photo_id)}),o=IntegrationConsents.getGrantedConsentView(a);o=$WC.template.replace(o,{component_id:t,type:e}),$WC.$Win.create({id:"grantedconsentsview","class":"botDialog view-granted-consents",header:r,html:o})}})},revokeConsents:function(e){var t=e.attr("type"),i=e.attr("component_id");$ZCAjx.ajax({url:"/v1/"+t+"s/"+i+"/consents",type:"DELETE",status:{loading:e,success:"platformconsents.consents.revoked"},success:function(){$WC.$Win.destroy("grantedconsentsview")}})}},DREDebugUtil=function(){var e=!1,t={string:"STRING",map:"MAP"},i={http_method:"http_method",app_info:"app_info",install:"install",upgrade:"upgrade",headers:"headers",authtoken:"authtoken",params:"params",body:"body",user:"user",key:"key",value:"value"},a={ExecuteParamUI:'<div class="mcontent posrel" id="executeParamContent"><div class="font17 bold dflxcent pL20 zcinteg-execparam-hdr fshrink">{{title}}</div><div id="paramValues" class="w100 posl font15 pLR30 overflw-a flexG">{{params}}</div><div class="dflxcent fshrink w100 zcinteg-execparam-footr"><div dredebugbuttons purpose="handleExecute" class="windwbtn cur mrgR10 posl">{{submit}}</div></div></div><div class="mcontent posrel hide" id="executeParamResult"><div class="bold dflxcent pL20 zcinteg-execparam-hdr fshrink"><span dredebugbuttons purpose="handleExecuteBack" class="zchat-zcheadicn mrgR10" title={{back}}></span><span class="font17">{{response}}</span></div><div id="paramResult" class="w100 font15 pLR30 mrgB20 overflw-a flexG wrdbrkall"></div></div>',ExecuteParamRadioButtonUI:'<div id="radioButton"><div class="mrgB35"><span>{{nameValue}} ({{inputType}})</span></div>{{extensionTypeOptions}}<div class="dflxcent mrgB30" id="current_version"><div title="{{currentVersion}}" class="clr14 w40 pL20"><span>{{currentVersion}}</span></div><input name="currentVersion" class="param-input" id="currentVersionValue" placeholder="{{currentVersionPlaceholder}}"></div><div class="dflxcent mrgB30 hide" id="existing_version"><div title="{{existingVersion}}" class="clr14 w40 pL20"><span>{{existingVersion}}</span></div><input name="existingVersion" class="param-input" id="existingVersionValue" placeholder="{{existingVersionPlaceholder}}"></div></div>'},s={addMapInputField:function(e){var t="#"+e.target.id,i='<div class="mrgB10 dflx fjustifySB param-input"><input class="w25" id="key" placeholder="{{keyPlaceholder}}"><input class="wid70" id="value" placeholder="{{valuePlaceholder}}"></div>',a={$keyPlaceholder:"dre.debugutil.placeholder.key",$valuePlaceholder:"dre.debugutil.placeholder.value"};i=$WC.template.replace(i,a),$(t).before(i)},handleExecuteBack:function(){$("#executeParamResult").addClass("hide"),$("#paramResult").html(""),$("#executeParamContent").removeClass("hide")},handleExecute:function(e){for(var a=$("#delugeeditorcontainer"),s=a.attr("componentid"),n=a.attr("handlertype"),r=IntegrationsCwin.chat.id,o={},l=$(e.target).parents().children("#paramValues").children(),c=DREImpl.current.params,d=0;d<c.length;d++){var u="#"+c[d].param_name,m=c[d].param_name;if(c[d].param_type==t.string)o[m]=c[d].param_name==i.http_method?$(l).find("#http_methodradio [type='radio']:checked").val():l.find(u).val();else if(c[d].param_type==t.map)if(c[d].param_name==i.app_info)"undefined"!=typeof $(l).find("#extensiontyperadio [type='radio']").val()?$(l).find("#extensiontyperadio [type='radio']:checked").val()==i.install?o.app_info={type:"install",current_version:$(l).find("#currentVersionValue").val()}:$(l).find("#extensiontyperadio [type='radio']:checked").val()==i.upgrade&&(o.app_info={type:"upgrade",current_version:$(l).find("#currentVersionValue").val(),existing_version:$(l).find("#existingVersionValue").val()}):o.app_info={type:"uninstall",current_version:$(l).find("#currentVersionValue").val()};else if(c[d].param_name!=i.user){var p=l.find(u).children(),h={};for(k=0;k<p.length-1;k++)currentElement=p[k].children,currentElement[0].id==i.key&&currentElement[1].id==i.value&&(h[currentElement[0].value]=currentElement[1].value);o[c[d].param_name]=h}}null!==r&&(o.chid=r),Executions.execute(n,s,o)}},n=function(e){e.find("#extensiontyperadio").on("change","[type='radio']",function(){e.find("#existing_version").toggleClass("hide")})},r=function(t,r){t.sort(function(e,t){return e.param_name>t.param_name?1:t.param_name>e.param_name?-1:0}),t.sort(function(e,t){return e.param_type>t.param_type?-1:t.param_type>e.param_type?1:0}),r==ApplicationConstants.INCOMING_WEBHOOK&&(t.push(t[0]),t.shift());for(var o={},l="",c="",d=0;d<t.length;d++){switch(t[d].param_name){case i.user:c+='<div class="dflxcent mrgB35 mrgT20"><div title="{{inputType}}" class="clr14 bold w40 pR25 ellips">{{inputType}}</div><div class="clr6">{{username}}</div></div>',o={$inputType:"dre.debugutil.username",username:$zcg._USERFULLNAME},c=$WC.template.replace(c,o);break;case i.app_info:if(r!=ApplicationConstants.UNINSTALLATION_HANDLER){var u=[{id:"extensionInstall",value:"install",label:Resource.getRealValue("dre.debugutil.extension.install"),checked:!0},{id:"extensionUpgrade",value:"upgrade",label:Resource.getRealValue("dre.debugutil.extension.upgrade"),checked:!1}],m=$Dom.radio.construct("extensiontype",u),p='<div class="dflxcent mrgB30"><div title="{{extensionType}}" class="clr14 w40 pL20"><span>{{extensionType}}</span></div><div id="extensiontyperadio">{{radiohtml}}</div></div>';p=$WC.template.replace(p,{radiohtml:m},"InSecureHTML")}l+=$WC.template.replace(a.ExecuteParamRadioButtonUI,{extensionTypeOptions:"undefined"!=typeof p?p:""},"InSecureHTML"),o={$nameValue:"dre.debugutil.extension.details",$inputType:"dre.debugutil.map",$extensionType:"dre.debugutil.extension.type",$currentVersion:"dre.debugutil.current.version",$existingVersion:"dre.debugutil.existing.version",$currentVersionPlaceholder:"dre.debugutil.placeholder.currentversion",$existingVersionPlaceholder:"dre.debugutil.placeholder.existingversion"};break;case i.headers:case i.params:l+='<div class="dflx mrgB30"><div class="clr14 w40 pR25 ellips"><span title="{{nameValue}}">{{nameValue}}  ({{inputType}})</span></div><div class="dflx flx-dirC" id="{{name}}"><div class="mrgB10 dflx fjustifySB param-input"><input class="w25" id="key" placeholder="{{keyPlaceholder}}"><input class="wid70" id="value" placeholder="{{valuePlaceholder}}"></div><div dredebugbuttons purpose="addMapInputField" id="addMapInputField_{{name}}" class="font13 clr-link cur">+ {{addAnother}}</div></div></div>',o={$inputType:"dre.debugutil.map",name:t[d].param_name,$nameValue:"dre.debugutil."+t[d].param_name,$keyPlaceholder:"dre.debugutil.placeholder.key",$valuePlaceholder:"dre.debugutil.placeholder.value",$addAnother:"dre.debugutil.add.another"};break;case i.body:l+='<div class="dflx mrgB30"><div class="clr14 w40 pR25 ellips"><span title="{{nameValue}}">{{nameValue}}  ({{inputType}})</span></div><textarea class="param-input" id="{{name}}" name="{{name}}" placeholder="{{placeholder}}"></textarea></div>',o={$inputType:"dre.debugutil.string",$nameValue:"dre.debugutil.body",placeholder:Resource.getRealValue("dre.debugutil.placeholder.body"),name:t[d].param_name};break;case i.http_method:var u=[{id:"httpMethodGet",value:"get",label:Resource.getRealValue("dre.debugutil.get"),checked:!0},{id:"httpMethodPost",value:"post",label:Resource.getRealValue("dre.debugutil.post"),checked:!1}],m=$Dom.radio.construct("httpMethod",u),h='<div class="dflxcent mrgB30"><div class="clr14 w40 pR25 ellips"><span title="{{nameValue}}">{{nameValue}} ({{inputType}})</span></div><div id="http_methodradio">{{radiohtml}}</div></div>';l+=$WC.template.replace(h,{radiohtml:m},"InSecureHTML"),o={$inputType:"dre.debugutil.string",$nameValue:"dre.debugutil."+t[d].param_name,name:t[d].param_name};break;case i.authtoken:l+='<div class="dflxcent mrgB30"><div class="clr14 w40 pR25 ellips"><span title="{{nameValue}}">{{nameValue}} ({{inputType}})</span></div><input class="param-input" id="{{name}}" name="{{name}}" placeholder="{{placeholder}}"></div>',o={$inputType:"dre.debugutil.string",$nameValue:"dre.debugutil."+t[d].param_name,$placeholder:"dre.debugutil.placeholder."+t[d].param_name,name:t[d].param_name}}l=$WC.template.replace(l,o)}l=c+l,o={$title:["dre.debugutil.execute.title",$("#editcodeheadertext").text()],$submit:"dre.debugutil.execute",$response:"dre.debugutil.response",$back:"common.back"};var g=$WC.template.replace(a.ExecuteParamUI,o),g=$WC.template.replace(g,{params:l},"InSecureHTML");if(!$WC.$Win.isExist("integ_executeparams_win")){var f=$WC.$Win.create({id:"integ_executeparams_win","class":"zcinteg-execparam-win adchtwin",html:g});ZCScroll.customScroll($("#paramValues, #paramResult"),!0),n(f),e||(e=!0,$(document).on("click","[dredebugbuttons]",function(e){e.stopPropagation();var t=this.getAttribute("purpose");s[t](e)}))}},o=function(e,t){if("undefined"!=typeof e.data.dreResponse)if(ApplicationConstants.isAppHandler(t)){if("Failure"==e.data.dreResponse.status){errorStatement=e.data.dreResponse.errorMessage+" ( "+Resource.getRealValue("commands.error.lineno",""+e.data.dreResponse.lineNumber)+" ) ",o='<div class="mrgT20"><div class="font16 bold mrgT10">{{errorTitle}}</div><div class="mrgT10 clr6"><div class="zcdebugsub">{{error}}</div></div>';var i={$errorTitle:"commands.error",error:errorStatement};o=$WC.template.replace(o,i)}else{var a=e.data.dreResponse,s="";if("undefined"!=typeof a.debugLogs){var n=a.debugLogs;for(s='<div class="mrgT20"><div class="font16 bold mrgT10">{{logsTitle}}</div>',d=0;d<n.length;d++)eachInfoHtml=$Util.isValidJSON(n[d],!0)?'<div class="mrgT10 clr6"><span drebuttons purpose="jsonView" json="{{debug}}" class="zcdrelogs"><span class="msi-external mrgR5 cur"></span><span class="wrdbrkall">{{debug}}</span></span></div>':'<div class="mrgT10 clr6"><div class="zcdebugsub">{{debug}}</div></div>',s+=$WC.template.replace(eachInfoHtml,{debug:n[d]});s+="</div>",s=$WC.template.replace(s,{$logsTitle:"drelogs.title"})}var r="undefined"!=typeof a.output?a.output:{},o='<div class="mrgT20"><div class="mrgT10 clr6"><span drebuttons purpose="jsonView" json="{{output}}" class="zcdrelogs"><span class="msi-external mrgR5 cur"></span><span class="wrdbrkall">{{output}}</span></span></div></div>';o=$WC.template.replace(o,{output:JSON.stringify(r)}),o+=s}$("#executeParamContent").addClass("hide"),$("#paramResult").append(o),$("#executeParamResult").removeClass("hide")}else if(Schedulers.HANDLER_TYPE==t)if("Success"==e.data.dreResponse.status){$Util.Button.showCompletionAndResetContent($('[purpose="saveAndExecute"]')),UI.updateBanner(Resource.getRealValue("schedulers.executesuccess"),4e3,!1);var l=e.data.dreResponse.result.message.userMessage;if(!$WC.$CUtil.isEmpty(l)){for(var c='<div class="zcdrelogs"><div class="bold font14">'+Resource.getRealValue("commands.debuginfo")+"</div>",d=0;d<l.length;d++){var u="";u+=$Util.isValidJSON(l[d],!0)?'<div class="zcdebugsub"><span drebuttons purpose="jsonView" json="{{debug}}"><span title="{{title}}" class="msi-external mrgR5 cur"></span></span>{{debug}}</div>':"{{debug}}<br>",u=$WC.template.replace(u,{debug:l[d],$title:"drelogs.view_debug_info"}),c+=u}c+="</div>",DREImpl.showDebugInfo(c)}}else{$Util.Button.showCompletionAndResetContent($('[purpose="saveAndExecute"]'),!0);var m=Resource.getRealValue("commands.error.lineno",""+e.data.dreResponse.lineNumber),p=e.data.dreResponse.errorMessage;UI.updateBanner(Resource.getRealValue("schedulers.executefailure",["",p,m]),4e3,!0)}};return{executeParamsWindow:function(e,t){r(e,t)},populateResult:function(e,t){o(e,t)}}}(),AutoUpdater={},UIDataPersist={};AutoUpdater={updateNeeded:!1,handleLatestClientVersion:function(e){if(!this.updateNeeded){var t=parseInt(e.substr(1)),i=parseInt($zcg._CURRENT_CLIENT_VERSION.substr(1));isNaN(t)||isNaN(i)||t>i&&(this.updateNeeded=!0)}},handleIdleState:function(){$DB.sessionstoragesupport&&this.updateNeeded&&!this.shouldPreventReload()&&UIDataPersist.reloadPreservingUI()},shouldPreventReload:function(){if(MainUI.hasOverlayWindow()||ImgViewer.isVisible()||MMChat.isRunning)return!0;var e=ChatUI.exist;for(var t in e)if(e[t].mediaplaying)return!0;e=MediaPlayer.cache.chatbody;for(var t in e)if(Object.keys(e[t]).length>0)return!0;return!1}},UIDataPersist={isAlreadyRestored:!1,UIData:{ChatWindows:{},focusedWindow:""},ChatWindow:function(e,t,i,a,s){return{chid:e,unreadCount:t,unreadTime:i,composerMsg:a,isChannel:s}},reloadPreservingUI:function(){var e=MainUI.getAllOngoingChats();for(var t in e){var i=ChatUI.exist[e[t]],a=i.win(),s=a.find("#composer"+a[0].id).html(),n=-1==i.unreadtime?i.lastmsgtime+1:i.unreadtime;this.addChatWindow(i.chid,i.unreadmsgcount,n,s,i.isChannel())}this.UIData.chatsInViewport=MainUI.getVisibleChats(),this.UIData.focusedWindow=MainUI.currentchat,this.storeData(),window.location.reload()},restoreUI:function(){if(!this.isAlreadyRestored&&!$ZCVideoBroadcast.isVideoBroadcastPage){this.isAlreadyRestored=!0;var e=$DB.get("uielements");void 0!=e&&(this.UIData=e);var t={};for(var i in this.UIData.chatsInViewport){var a=this.UIData.chatsInViewport[i],s=this.getWindow(a);null!=s?(s.isChannel?Channels.handlejoin(a,!1):ChatsList.attachContinueActiveChat(a,!0),t[a]=!0):this.UIData.chatsInViewport.splice(i,1)}for(var a in this.UIData.ChatWindows)if(!t.hasOwnProperty(a)){var s=this.getWindow(a);s.unreadCount>0&&(s.isChannel?Channels.handlejoin(a,!1):ChatsList.attachContinueActiveChat(a,!0))}Object.keys(this.UIData.ChatWindows).length&&($zcg._WINFOCUS=!1),this.storeData()}},addChatWindow:function(e,t,i,a,s){if(this.UIData.ChatWindows.hasOwnProperty(e)){var n=this.UIData.ChatWindows[e];n.unreadCount=t,n.unreadTime=i,n.composerMsg=a}else this.UIData.ChatWindows[e]=this.ChatWindow(e,t,i,a,s);this.storeData()},removeChatWindow:function(e){delete this.UIData.ChatWindows[e],this.storeData()},handleWindowCreate:function(e){var t=ChatUI.exist[e];if(0==t.unreadmsgcount&&UIDataPersist.hasWindow(e)){var i=UIDataPersist.getWindow(e),a=i.unreadCount;a>0&&(ChatsList.updateMsgCount(e,a),t.unreadmsgcount=a)}UIDataPersist.UIData.focusedWindow==e&&(MainUI.getMefront(e,!0),UIDataPersist.UIData.focusedWindow="",UIDataPersist.storeData())},handleUnreadTime:function(e,t){var i=this.getWindow(e),a=String(i.unreadTime),s=ChatUI.exist[e];s.unreadtime=i.unreadTime;var n=0;for(var r in t){var o=t[r];-1!=o.time&&o.time>=i.unreadTime&&n++}return ChatsList.updateMsgCount(e,n),s.unreadmsgcount=n,this.removeChatWindow(e),a},hasWindow:function(e){return this.UIData.ChatWindows.hasOwnProperty(e)},getWindow:function(e){return this.hasWindow(e)?this.UIData.ChatWindows[e]:null},storeData:function(){$DB.update("uielements",this.UIData)},hasComposerMsg:function(e){return this.hasWindow(e)&&this.getWindow(e).composerMsg?""!=this.UIData.ChatWindows[e].composerMsg:!1},getComposerMsg:function(e){var t=this.UIData.ChatWindows[e].composerMsg;return this.UIData.ChatWindows[e].composerMsg="",this.storeData(),t},markRead:function(e){if(this.hasWindow(e)){var t=this.getWindow(e);(t.unreadTime>0||t.unreadCount>0)&&(t.unreadTime=t.lastmsgtime+1,t.unreadCount=0,this.storeData())}},moveCaretToEnd:function(e){var t=e.childNodes;$WC.DivEditor._setCaretPositionRelative(e.id,t[t.length-1],"end")}};var $ZCVideoBroadcast={isInitialized:!1,isBrowserSupported:null,isVideoBroadcastPage:$zcg._isVideoBroadcastPage===!0,details:$zcg._VIDEOBROADCASTDETAILS,MAX_TOPIC_LENGTH:30,MODES:{live:1,streaming:2},init:function(){if(!this.isInitialized){if(this.isVideoBroadcastPage){var e=$zcg._IMGDEFAULTSTATICURL+"/videochat-bg.jpg";"host"==this.details.action?($ZCVideoBroadcastImpl.init("videobroadcast",e,$zcg._ZUID,this.details.chid),this.details.title&&$ZCVideoBroadcastImpl.setTitle(this.details.title)):$ZCVideoBroadcastImpl.init("videobroadcast",e,$zcg._ZUID,this.details.chid,this.details.bid,this.details.hostid)}this.isInitialized=!0}},isPrimeTimeAllowed:function(){return SecurityManager.hasPermission(Modules.PrimeTime)&&this.isSupported()&&!this.isVideoBroadcastPage},isStreamingEnabled:function(){return SecurityManager.hasPermission(Modules.PTStreaming)&&Plan.isBroadcastAllowed()},bindEvents:function(){$(document).on("click","[primetimebutton]",function(e){e.stopPropagation();var t=$(this),i=t.attr("purpose");$ZCVideoBroadcast.handle[i](e,t)}),$(document).on("keyup","[broadcastinput]",function(e){e.which==$zcg.ENTER_KEYCODE?$ZCVideoBroadcast.handle.startBroadcast():$ZCVideoBroadcast.validateBroadcastTitle($(this))}),$(document).on("change","[broadcastscope] [type='radio']",function(){this.value==BotConstants.TEAMSCOPE?$("#broadcast-groupsuggest-cnt").removeClass("dN"):$("#broadcast-groupsuggest-cnt").addClass("dN")})},validateBroadcastTitle:function(e){var t=e.val(),i=!$WC.$CUtil.isEmpty(t)&&$WC.Matcher.check("textpattern",t)&&t.length<=$ZCVideoBroadcast.MAX_TOPIC_LENGTH;return i?e.removeClass("zcfdk_tmbzoom"):e.addClass("zcfdk_tmbzoom"),i},handle:{openPrimeTime:function(e,t){window.open(t.attr("link")),$WC.$Win.destroy("primetime_trigger")},startBroadcast:function(){var e=$("#startbroadcast").find("#broadcastTopic"),t=$ZCVideoBroadcast.validateBroadcastTitle(e);if(t){var i=parseInt($("#broadcastscope").find("input:checked").val());if(i){var a=window.location.origin+"/startbroadcast.do?title="+encodeURIComponent(e.val())+"&entity_type="+i;if(i==BotConstants.TEAMSCOPE){var s=SearchField.getSelectedList("broadcast-groupsuggest-search-field").join();if($WC.$CUtil.isEmpty(s))return void UI.updateBanner(Resource.getRealValue("videobroadcast.sel.group"),2e3,!0);a+="&entity_ids="+encodeURIComponent(s)}$WC.$Win.destroy("start_broadcast_win"),window.open(a)}}}},trigger:function(e,t){if(SecurityManager.hasPermission(Modules.PrimeTime)&&!this.isVideoBroadcastPage){var i=window.location.origin+"/startprimetime.do?chid="+encodeURIComponent(e);t&&(i+="&title="+encodeURIComponent(t)),this.showOnboarding(i);var a=new $CliqChatId(e).isChannel();ZCTrack.track("PRIMETIME_TRIGGER",{chatType:a?"channel":"chat"})}},join:function(e,t){SecurityManager.hasPermission(Modules.PrimeTime)&&t!=$zcg._ZUID&&!this.isVideoBroadcastPage&&window.open(window.location.origin+"/joinprimetime.do?key="+encodeURIComponent(e))},handleChatAttachFailed:function(e,t){this.isVideoBroadcastPage&&e==this.details.chid&&$ZCVideoBroadcastImpl.handleChatAttachFailed(t)},handleDelete:function(e){this.isVideoBroadcastPage&&e==this.details.chid&&$ZCVideoBroadcastImpl.handleDelete(e)},handleEscape:function(e){return this.isVideoBroadcastPage&&e==this.details.chid?($ZCVideoBroadcastImpl.handleEscape(),!0):!1},handleLogout:function(){try{this.isVideoBroadcastPage&&$ZCVideoBroadcastImpl.handleLogout()}catch(e){}},handleWmsConnectionStatus:function(e){try{this.isVideoBroadcastPage&&(e&&this.init(),$ZCVideoBroadcastImpl.handleWmsConnectionStatus(e))}catch(t){setTimeout(function(){throw t},1)}},handleWmsMessage:function(e){try{this.isVideoBroadcastPage&&$ZCVideoBroadcastImpl.handleWmsMessage(e),LiveVideoMsgHandler.handleMessage(e)}catch(t){setTimeout(function(){throw t},1)}},handleCWinCreated:function(e){this.isVideoBroadcastPage&&$ZCVideoBroadcastImpl.handleCWinCreated(e)},handleUnload:function(){this.isVideoBroadcastPage&&$ZCVideoBroadcastImpl.handleUnload()},handleUnreadCount:function(e,t){this.isVideoBroadcastPage&&$ZCVideoBroadcastImpl.handleUnreadCount(e,t)},handleChatWindowClosed:function(e){this.isVideoBroadcastPage&&$ZCVideoBroadcastImpl.handleChatWindowClosed(e)},isDomExist:function(e){return this.isVideoBroadcastPage?$ZCVideoBroadcastImpl.isDomExist(e):!1},isSupported:function(){return null==this.isBrowserSupported&&(this.isBrowserSupported=$Util.Browser.isChrome()||$Util.Browser.isFirefox()),this.isBrowserSupported},showOnboarding:function(e){var t=Settings.getFromObj("primetime_onboard_count");return Number.isNaN(t)&&(t=0),2>=t?(Settings.update({primetime_onboard_count:t+1}),void this.showOldOnboarding(e)):void window.open(e)},showOldOnboarding:function(e){var t=$WC.template.replace(Template.primetimedlg,{link:e});$WC.$Win.create({id:"primetime_trigger",header:$WC.template.replace('<div class="clr0 msi-bcstrt"><strong>{{header}}</strong></div>',{$header:"videobroadcast.primetime"}),html:t,"class":"zcprime"})},showBroadcastStartWin:function(){var e=$WC.template.replace('<div class="clr0"><span class="bold">{{title}}</span></div><div class="font15 clr6 mrgT10">{{hint}}</div>',{$title:"videobroadcast.streaming",$hint:"videobroadcast.streaming.desc"}),t=[],i=!0;_isAppAccountAdmin()&&(t.push({id:"broadcastscopeorg",value:BotConstants.ORGSCOPE,label:Resource.getRealValue("integration.scope1"),checked:i}),i=!1);var a="";if(!$WC.$CUtil.isEmptyObject(Groups.getAllOrgGroups())){t.push({id:"broadcastscopeteam",value:BotConstants.TEAMSCOPE,label:Resource.getRealValue("integration.scope2"),checked:i});var s=i?"":"dN";a=$WC.template.replace('<div id="broadcast-groupsuggest-cnt" class="{{class_name}} dflx mrgT40 fshrink"><div class="w25 bold font14">{{topic}}</div><div id="broadcast-groupsuggest" class="flexG"><div id="broadcast-groupsuggest-selnodes" class="mrgT15 dN"></div><div id="broadcast-groupsuggest-search-field" contenteditable="true" placeholder="{{place_holder}}" class="crtin"></div><div id="broadcast-groupsuggest-results" class="chdropdwn" style="display:none"></div></div></div>',{$place_holder:"channel.team.placeholder",$topic:"channel.group.title",class_name:s})}var n=$WC.template.replace('<div id="broadcastscope" broadcastscope class="dflxcent mrgT30 fshrink"><div class="w25 bold font14">{{header}}</div><div>{{radio_btn}}</div></div>',{$header:"channel.levels"}),r="";r=t.length?$Dom.radio.construct("broadcastscope",t):Resource.getRealValue("videobroadcast.streaming.info"),n=$WC.template.replace(n,{radio_btn:r},"InSecureHTML");var o=$WC.template.replace(Template.PTBroadcastStartWin,{id:"startbroadcast",select_mode:"",src:$zcg._IMGDEFAULTSTATICURL+"/pt_assembly.svg",$topic:"videobroadcast.title",$start:"common.start"});o=$WC.template.replace(o,{select_scope:n,org_group_sugg_html:a},"InSecureHTML");{var l=$WC.$Win.create({id:"start_broadcast_win","class":"rhsoverly",aligncenter:!1,header:e,closeoutside:!0,html:o});new TeamSuggestions("broadcast-groupsuggest",4)}l.addClass("zc-profilemenushow broadcastui"),l.find("#broadcastTopic").focus()}},PrimetimeSession=function(e,t){this.setProperties(e),this.linkedMsgUID=t,this.isLive()&&this.syncDetails(!0)};PrimetimeSession.prototype={setProperties:function(e){this.startTime=e.start_time,this.title=e.title,this.chatId=e.chat_id,this.callId=e.call_id,this.creator=e.creator,this.joinLink=e.join_link,this.endTime=e.end_time,this.viewersCount=e.viewers_count?parseInt(e.viewers_count):0,this.isStreaming=e.is_streaming,this.isEdited=e.is_edited},isLive:function(){return-1==this.endTime&&this.syncDetails(),-1==this.endTime},syncDetails:function(e){var t=this;if(!this.lastSyncTime||Date.now()-this.lastSyncTime>15e3||e){if(!NativeWidgetHandler.isInView(this.callId))return;this.lastSyncTime=Date.now(),$ZCAjx.ajax({url:"/v2/primetimes/"+this.callId,success:function(i){i.is_live||e?(t.setProperties(i),t.updateMessageInDOM()):t.markSessionEnd()}})}},markSessionEnd:function(){this.endTime=this.endTime>-1?this.endTime:Date.now(),this.updateMessageInDOM(),this.updateMessage()},getRunTime:function(){var e=this.startTime,t=(-1==this.endTime?Date.now():this.endTime)-e;"undefined"!=typeof $ZCVideoBroadcastImpl&&$ZCVideoBroadcastImpl.player&&$ZCVideoBroadcastImpl.player.playhead_&&(t=1e3*$ZCVideoBroadcastImpl.player.playhead_.getTime()),t=t?t:0;var i=Math.floor(t/36e5),a=Math.floor(t/6e4%60),s=Math.floor(t%6e4/1e3),n="";return i>0&&(n+=i+" : "),n+=$Date.append0(a)+" : "+$Date.append0(s)},getCardHTML:function(){var e=this.isLive(),t=$zcg._ZUID,i=$ZCVideoBroadcast.isVideoBroadcastPage,a=i&&this.callId==$ZCVideoBroadcastImpl.broadcastId,s=e&&!a?$WC.template.replace(LiveVideoMsgHandler.joinLinkBtnHTML,{joinLink:this.joinLink,$join:"common.join"}):e&&i&&a?'<div class="clr8">'+Resource.getRealValue(t==this.creator.id?"videobroadcast.ishosting":"videobroadcast.isviewing")+"</div>":"",n=$WC.template.replace(LiveVideoMsgHandler.cardHTML,{callId:this.callId,$header:this.title,creatorimg:Users.getImgUrlById(this.creator.id),title:this.title,creator:this.creator.name,$has_started:e?["videobroadcast.primetime.started",""]:["videobroadcast.primetime.ended",""],$status:"videobroadcast.onair",ended:e?"":"ended",hide:!e&&!this.isEdited||a?"dN":"",runtime:this.getRunTime()});return n=$WC.template.replace(n,{vcount:"&nbsp;&nbsp;"+this.viewersCount,btnarea:s},"InSecureHTML")},updateCard:function(){NativeWidgetHandler.updateDOM(this.callId,{vcount:"&nbsp;&nbsp;"+this.viewersCount,timer:this.getRunTime()})},updateMessage:function(){WmsImpl.isLocalUser(this.creator.id)&&$ZCAjx.ajax({url:"/v2/primetimes/"+this.callId+"/end",type:"POST",contentType:"application/json",data:{msguid:this.linkedMsgUID}})},updateMessageInDOM:function(){var e=this.getCardHTML();e=$(e).find("[nativewidget]").html(),NativeWidgetHandler.updateMessage(this.callId,e)},getMessageObject:function(){var e={start_time:this.startTime,title:this.title,chat_id:this.chatId,call_id:this.callId,creator:this.creator,join_link:this.joinLink,viewers_count:this.viewersCount,end_time:this.endTime,is_streaming:this.isStreaming},t={type:"primetimecard",data:e},i={msg:Resource.getRealValue(this.isLive()?"videobroadcast.primetime.started":"videobroadcast.primetime.ended",[this.creator.name]),nativeWidget:t};return i},handle:{offersdp:function(e){var t=e.session;"main"==t&&(this.viewersCount=Object.keys(e.participants).length)},participantjoin:function(){this.viewersCount=this.viewersCount+1},participantleft:function(){this.viewersCount&&(this.viewersCount=this.viewersCount-1)},handleBroadcastViewer:function(e){this.viewersCount=e.viewersCount},endcall:function(){this.markSessionEnd()},streamEnd:function(){this.markSessionEnd()},error:function(){this.markSessionEnd()}}};var LiveVideoMsgHandler={sessions:{},timer:"",cardHTML:'<div class="zcmsg_bx pt-card"><div nativewidget="primetimecard" class="btncnt pt-card" componentid="{{callId}}"><div class="zctitle"><div class="mrgR10 ellips">{{title}}</div><div class="msi-bcstrt"></div></div><div class="zcdesc"><div class="flexC justifySB"><div class="pt-status-btn {{ended}} ">{{status}}</div><div class="flexC"><span class="msi-multiusr"></span><div replace="vcount" class="pt-stats ellips clr6">{{vcount}}</div></div></div><div class="details pT15"><img class="fshrink" src="{{creatorimg}}"><div class="pt-status font15"><span class="creator bold">{{creator}}</span> {{has_started}}</div></div><div class="actnfootr"><div class="timer ellips {{hide}}"><span class="msi-clock font12 mR5"></span><span class="pt-stats" replace="timer">{{runtime}}</span></div>{{btnarea}}</div></div></div></div>',joinLinkBtnHTML:'<a target="_blank" rel="noopener noreferrer" href="{{joinLink}}" class="dbtn">{{join}}</a>',handleMessage:function(e){var t=e.opr,i=e.bid,a=this.sessions[i];a&&"function"==typeof a.handle[t]&&a.handle[t].call(a,e)},getMsgObj:function(e){var t=this.sessions[e];return"undefined"!=typeof t?t.getMessageObject():void 0},getHTML:function(e){var t=e.call_id;return this.sessions[t].getCardHTML()},register:function(e){var t=e.msguid,i=e.native_widget.data;i.is_edited=e.isEdited;var a=i.call_id;"undefined"==typeof this.sessions[a]?this.sessions[a]=new PrimetimeSession(i,t):e.isEdited&&this.sessions[a].setProperties(i);var s=this.sessions[a];if(!this.timer&&s.isLive()){var n=this;this.timer=setInterval(function(){var e=n.sessions,t=0;for(var i in e){var a=e[i];a.isLive()&&(t++,a.updateCard())}t||(clearInterval(n.timer),n.timer=null)},1e3)}},handleReconnect:function(){var e=this.sessions;for(var t in e)e[t].isLive()&&e[t].syncDetails(!0)}},NativeWidgetHandler={entities:{primetimecard:"LiveVideoMsgHandler"},processMsg:function(e){if(e.native_widget){var t=e.native_widget,i=this.getEntityObject(t.type);return"undefined"!=typeof i?(i.register(e),i.getHTML(t.data)):""}},updateDOM:function(e,t){var i=this.getWidget(e);if(i.length)for(var a in t)i.find('[replace="'+a+'"]').html(t[a])},updateMessage:function(e,t){var i=this.getWidget(e);i.length&&i.html(t)},isInView:function(e){return this.getWidget(e).length>0},getWidget:function(e){return $('[nativewidget][componentid="'+e+'"]')},getMsgObj:function(e,t){var i=this.getEntityObject(t);return i.getMsgObj(e)},getEntityObject:function(e){return $Util.getNamespace(e,this.entities)},handleReconnection:function(){var e=this.entities;for(var t in e){var i=this.getEntityObject(t);"function"==typeof i.handleReconnect&&i.handleReconnect()}}},MMChat={},MMChatUI={},MMChatConstants={},MediaManager={};MMChatConstants={callTypes:{VOICE:"voice",VIDEO:"video",SCREEN:"screen",VOICE_WITH_VIDEO:"voicewhivi"},callModes:{INCOMMING:"incomming",OUTGOING:"outgoing"},callStatusCodes:{STARTED:0,CALLING:1,WAITING:2,CONNECTING:3,CONNECTED:4,ENDED:5}},MMChatUI={getVideoChatHTML:function(e){var t="zcvdlrgbtncnt",i="",a="",s=$WC.template.replace('<div id="vcsettings" class="msi-settings zcmxtp dN" videochatbutton purpose="deviceSettings" title="{{title}}"></div>',{$title:"videochat.settings.devicesettings"}),n=$WC.template.replace('<div id="avmoreopts" class="msi-optmore zcmxtp dN" videochatbutton purpose="showMoreOption"><div id="videochatmoreoption" class="vc-more-optns-cnt zcbtndd font13 textcent posa cur"><div class="msi-settings ellips scrnshrenbld" type="button" videochatbutton purpose="deviceSettings">{{device_settings}}</div><div id="screenshareopt" class="msi-scrnshr-start ellips mrgT15" type="button" videochatbutton purpose="shareScreen">{{start_screen_share}}</div><div id="startvideoopt" class="msi-video ellips dN mrgT15" type="button" videochatbutton purpose="startVideo">{{start_video}}</div></div></div>',{$start_screen_share:"videochat.screen.share",$device_settings:"videochat.settings.devicesettings",$start_video:"videochat.start.video"});return e||(t="zcincmclcnt",i=$WC.template.replace('<div id="vctogglechat" class="msi-chat mrgL10 dN" videochatbutton purpose="showChat" title="{{title}}"></div>',{$title:"common.chat"}),a='<div id="innerchat" class="zcmcembd zcmulticht"><div id="innerchatholder" class="inchtcntnt" ></div></div>'),$WC.template.replace(Template.VideoChatFloatingHTML,{chat_holder:a,chat_option:i,class_name:t,device_settings:s,more_options:n,pulse_cnt:Template.VideoChatPulseCnt},"InSecureHTML")},getCallOptionsHtmlForCwin:function(e){var t="";if(MMChat.isCallIconAllowed()&&e.isOnetoOneChat()){var i=e.getPermission();if(i.video){var a="",s="",n="",r="",o="",l="";MMChat.isScreenSharingEnabledInAVCall()&&(r="zcf-sharescrn",o="common.screenshare",l="screenshare",a=$WC.template.replace('<div id="screenshare{{chid}}" class="zcf-sharescrn ellips" data-purpose="zcscreenshare" purpose="options" vcstrtdrp>'+Resource.getRealValue("videochat.sharescreen")+"</div>",{chid:e.chid})),MMChat.isVideoCallEnabled()&&(r="zcf-video",o="videochat.videocall",l="videocall",n=$WC.template.replace('<div id="videocall{{chid}}" class="zcf-video ellips" purpose="options" vcstrtdrp>'+Resource.getRealValue("videochat.videocall")+"</div>",{chid:e.chid})),MMChat.isAudioCallEnabled()&&(r="zcf-calloption",o="videochat.audiocall",l="audiocall",s=$WC.template.replace('<div id="audiocall{{chid}}" class="zcf-call ellips" purpose="options" data-purpose="zcaudio" vcstrtdrp>'+Resource.getRealValue("videochat.audiocall")+"</div>",{chid:e.chid})),t='<div id="call{{chid}}" class="call-options"><div vcstrt><span class="{{call_icon}}"></span></div><div class="chtpopup call-drpdwn" data-purpose="drpdowncalloption">{{audiohtml}}{{videohtml}}{{screen_share_opt}}</div></div>',t=$WC.template.replace(t,{$call_hint:o,call_type:l,chid:e.chid}),t=$WC.template.replace(t,{audiohtml:s,videohtml:n,call_icon:r,screen_share_opt:a},"InSecureHTML")}}return t},getCallSourceInCwin:function(e){var t="chatwindow_normal";return MainUI.isChatPaneView()&&(e.hasAttribute("vcstrtdrp")&&(t="chatwindow_drop"),t="chatwindow_collapse"),t},showExtensionInstallPreview:function(e){$WC.$CUtil.isEmpty(e)&&(e="videochatbutton");var t=$WC.template.replace('<div class="cliqextn-mc"><div class="dflx"><div class="cliqextn-mc-img dflxjustcent fshrink"><img src="{{src}}" class="h100 w100"></div><div class="mrgL30"><div class="font16 lin22 mrgT5">{{hint}}</div><div class="mrgT15 dbtn cliqextn-mc-btn" {{event_attribute}} purpose="goToStore">{{btn_text}}</div></div></div></div>',{$hint:"extension.install.hint",$btn_text:"extension.install",event_attribute:e,src:$zcg._IMGDEFAULTSTATICURL+"/logo/v1/cliq-icon.ico"});$WC.$Win.create({id:"extension_install_preview",header:$WC.template.replace('<div class="dflxcent w100 pR25 pL25"><span class="font17 flxG clr0 bold">{{header}}</span></div>',{$header:"extension.install.header"}),html:t,"class":"cliqextn-win adchtwin"})},handleModuleStatusChange:function(){MMChat.isAnyMediaOptionEnabled()&&(MMChat.isInitialized||MMChat.loadAndinit()),ChatUI.updateChatWindowOptions()}},MMChat={DISCONNECT_MSG:{ERROR:"0",CANCELLED:"4",COMPLETED:"3",REJECTED:"5",NORESPONSE:"6",BUSY_ON_OTHER_CALL:"15"},DRAGGABLESIZE:{width:400,height:230},STARTINGSIZE:{width:300,height:200},AUDIOCALL_SIZE:{width:440,height:115},MINIMUM_WIDTH:300,MINIMUM_DRAGGABLE_WIDTH:375,DEFAULTVIDEORATIO_CHROME:1.7777777777777777,DEFAULTVIDEORATIO_FIREFOX:1.3333333333333333,INNERCHATWIDTH:400,MAXVIDEOFRAMEWIDTH:560,BUTTONSFADEOUTTIME:3e3,CHATCONTAINERPADDING:20,CHATCONTAINERRATIO:.35,IMAGEPULSERATIO:1.6,CALLCONNECTION_TIMEOUT:2e4,VIDEO_LOADING_TIMEOUT:5e3,ANIMATION_TIME:400,ERRORBANNER_SHOWTIME:3e3,PERMISSION_DIALOGUE_DELAY:1200,allowedOverlayWindow:["videocall_dvic_pref","fileforwardwin","fileuploadwin","spotlight","VideoChatInfoMessage","MediaChatTerminate","MediaChatTerminateOnAccept","MediaChatDeviceSwitchConfirm","feedbackwin","widgetconfirm","widgetinfo","widgetalert","custommsg"],callStatusClasses:["mmchtstrt","mmchtclng","mmchtwtg","mmchtcntg","mmchtcntd","mmchtend"],callType:null,callMode:null,callStatus:5,isInitialized:!1,isRunning:!1,isFullscreen:!1,isFloatingView:!1,isReconnecting:!1,isDraggable:!1,isDragged:!1,isInnerChatVisible:!1,isConnectedTransitioned:!1,isConnectNotifyReceived:!1,isRemoteCamOff:!1,sid:null,zuid:"",chid:"",dom:{floatingDom:null,localVideo:null,remoteVideo:null,sharedScreen:null,msgcount:null,innerChat:null,timer:null,audioVis:null},devicePreference:{},videoSize:null,remoteVideoSize:null,localVideoSize:null,sharedScreenSize:null,acceptCallTimer:null,triggerCallTimer:null,buttonsFadeoutTimer:null,permissionDialogueTimer:null,remoteVideoTimer:null,videoLoadingTimer:null,api:{},localStream:null,lastCallAPI:null,audioContext:null,audioAnalyser:null,logData:[],isAnyMediaOptionEnabled:function(){return this.isAudioCallEnabled()||this.isVideoCallEnabled()||this.isScreenSharingEnabledInAVCall()},isAudioVideoCallEnabled:function(){return this.isAudioCallEnabled()||this.isVideoCallEnabled()},isAudioVideoSupported:function(){return this.isBrowserSupported()&&!$ZCVideoBroadcast.isVideoBroadcastPage},isAudioCallEnabled:function(){return SecurityManager.hasPermission(Modules.AudioCall)&&this.isAudioVideoSupported()&&SecurityManager.hasPermission(Modules.DirectMessage)},isVideoCallEnabled:function(){return SecurityManager.hasPermission(Modules.VideoCall)&&this.isAudioVideoSupported()&&SecurityManager.hasPermission(Modules.DirectMessage)},isScreenSharingEnabledInAVCall:function(){return SecurityManager.hasPermission(Modules.ScreenSharing)&&this.isScreenShareSupportedBrowser()},isBrowserSupported:function(){return this.isScreenShareSupportedBrowser()||$Util.Browser.isOpera()||$Util.Browser.isSafari()||$Util.Browser.isEdge()},isScreenShareSupportedBrowser:function(){return $Util.Browser.isChrome()||$Util.Browser.isFirefox()},isAudioCall:function(e){return e===MMChatConstants.callTypes.VOICE||this.isAudioVideoCall(e)},isVideoCall:function(e){return e===MMChatConstants.callTypes.VIDEO},isScreenShare:function(e){return e===MMChatConstants.callTypes.SCREEN},isAudioVideoCall:function(e){return e===MMChatConstants.callTypes.VOICE_WITH_VIDEO},isInCommingCall:function(e){return e===MMChatConstants.callModes.INCOMMING},isOutGoingCall:function(e){return e===MMChatConstants.callModes.OUTGOING},isCallConnected:function(){return this.callStatus===MMChatConstants.callStatusCodes.CONNECTED},isInVideoView:function(){return $("body").hasClass("zcvidcall")},isSwitchAllowed:function(){return this.isVideoCall(this.callType)||this.api.getSwitchMode()},isScreenShareAllowed:function(){return this.api.getScreenMode()},init:function(){if(this.dom.floatingDom=$("#videochat"),!$Util.Browser.isFirefox()){var e=$DB.get("mediadevicepref");$WC.$CUtil.isEmpty(e)||(this.devicePreference=e)}this.AnswerCall.init(),this.bindEvents(),VideoCallReceiver.init(),this.isInitialized=!0,ChatUI.updateChatWindowOptions(),($Util.Browser.isChrome()||_isDesktopApp())&&ScreenShare.Extension.checkInstalledStatus()},animator:function(){var e=MMChat.audioAnalyser;if(MMChat.isRunning){if(requestAnimationFrame(MMChat.animator),e){var t=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(t),t=Array.from(t);var i=Math.max.apply(null,t),a=0;i>0&&(a=65+35*(i-150)/105),MMChat.dom.audioVis.css({width:a+"%",height:a+"%"})}}else{try{MMChat.audioContext.close()}catch(s){}MMChat.audioContext=null,MMChat.audioAnalyser=null}},initUI:function(){this.dom.floatingDom.html(MMChatUI.getVideoChatHTML(!1)),this.dom.innerChat=this.dom.floatingDom.find("#innerchat"),this.dom.msgcount=this.dom.floatingDom.find("#newmsgcount"),$("[localuserimg]").attr("src",Users.getImgUrlById($zcg._ZUID))},destroyUI:function(){this.dom.floatingDom.empty()},askCloseConfirmation:function(e){$WC.$Dlg.confirm({id:"MediaChatTerminate",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue((MMChat.isVideoCall(MMChat.callType)?"video":MMChat.isAudioCall(MMChat.callType)?"audio":"screen")+"chat.confirm.quit")]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-green"></div>'}),buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){MMChat.close("On close chat confirmation"),"function"==typeof e&&e()}}]}),setTimeout(function(){$('#MediaChatTerminate [type="button"][value="Yes"]').focus()},0)},getRecentCalls:function(e,t){$ZCAjx.ajax({url:"/v2/calls",type:"GET",headers:{limit:t},success:function(t){"function"==typeof e&&e(t)}})},adjustPulseSize:function(){if($("#remotevideocontainer").hasClass("zc-vc-primary-vid-cnt")?this.dom.audioVis.show():this.dom.audioVis.hide(),this.isInVideoView()){var e="";if(e=this.isFullscreen||this.isFloatingView?this.dom.floatingDom.find("#remotevideocontainer [remoteuserimg]").not("#innerchat #remotevideocontainer [remoteuserimg]"):this.getCWin().win().find("#remotevideocontainer [remoteuserimg]"),e.length){var t={width:e.width()*MMChat.IMAGEPULSERATIO,height:e.height()*MMChat.IMAGEPULSERATIO},i={"max-width":e.width()*(MMChat.IMAGEPULSERATIO-.2),"max-height":e.height()*(MMChat.IMAGEPULSERATIO-.2)},a={"max-width":e.width()*(MMChat.IMAGEPULSERATIO-.4),"max-height":e.height()*(MMChat.IMAGEPULSERATIO-.4)};this.dom.audioVis.parent().css(t),this.dom.audioVis.find("div:first-child").css(i),this.dom.audioVis.find("div:nth-child(2)").css(a)}}},bindEvents:function(){function e(e,a){var s=e.clientX-t,n=e.clientY-i,r=MMChat.isFullscreen&&MMChat.isInnerChatVisible?MMChat.dom.innerChat.width():0;0>s?s=0:s+a.width()>document.documentElement.clientWidth-r&&(s=document.documentElement.clientWidth-a.width()-r),0>n?n=0:n+a.height()>document.documentElement.clientHeight&&(n=document.documentElement.clientHeight-a.height()),(a.offset().left!=s||a.offset().top!=n)&&(MMChat.isDragged=!0,a.css({left:s,top:n}))}$(document).on("click","[videochatbutton]",function(e){if(e.stopPropagation(),!MMChat.isDragged){var t=$(this),i=t.attr("purpose");MMChat.handle[i](t,e)}}),$(document).on("mousedown","[videochatdragcontainer]",function(e){var t=$(this);if(!t.hasClass("zc-vc-primary-vid-cnt")){var i=t.attr("component");("floatingcontainer"!=i||MMChat.isFloatingView&&!MMChat.isFullscreen)&&("videocontainer"!=i||MMChat.isFullscreen)&&a(e,t)}});var t=0,i=0,a=function(a,s){if(a.preventDefault(),1===a.which){var n=function(t){e(t,s)};window.addEventListener("mousemove",n,!0),t=a.clientX-s.offset().left,i=a.clientY-s.offset().top,$(document).one("mouseup focusout",function(e){e.stopPropagation(),window.removeEventListener("mousemove",n,!0),t=0,i=0,setTimeout(function(){MMChat.isDragged=!1},100)})}};this.dom.floatingDom.find("video").bind("contextmenu",function(){return!1}),$WC.$Win.on("window-created",function(){MMChat.handleOverlayWindowCreatedOrDestroyed()}),$WC.$Win.on("window-destroyed",function(){MMChat.handleOverlayWindowCreatedOrDestroyed()})},correctVideoSize:function(){this.isRunning&&this.isInVideoView()&&(this.handleUIResize(),this.isFloatingView&&!this.isFullscreen&&this.setFloatingView(!0,!1,!0))},close:function(e,t){this.isRunning=!1;try{t||(this.api.updateLogMessage("[stopchat] SOURCE: "+e),this.api.stopChat()),this.AnswerCall.isVisible||VideoCallReceiver.stop()}catch(i){MMChat.log(i.message)}if(ZCTrack.track("CALL_DISCONNECTED",{Type:MMChat.callType}),this.sid=null,this.lastCallAPI=this.api,this.api=null,this.localStream=null,this.localVideoSize=null,this.remoteVideoSize=null,this.sharedScreenSize=null,this.isFloatingView=!1,this.isReconnecting=!1,this.isConnectedTransitioned=!1,this.isConnectNotifyReceived=!1,this.isRemoteCamOff=!1,this.setCallStatus(MMChatConstants.callStatusCodes.ENDED),clearTimeout(this.remoteVideoTimer),clearTimeout(this.videoLoadingTimer),ChatUI.updateChatWindowOptions(),this.updateSearchWindowOptions(),$WC.$Dlg.destroy("VideoChatInfoMessage"),$WC.$Dlg.destroy("MediaChatTerminate"),$("body").removeClass("zcvcflcrn zcvchidbtns zcvcrcamoff zcvclcamoff mmchtrcnt zcvidcall zcaudcall mmchtend zc-vc-vid-disabl"),$(".zcvcbtninv").removeClass("zcvcbtninv"),MMChat.dom.audioVis.css({width:0,height:0}),this.dom.localVideo.attr("src","").parents("[component=videocontainer]").addClass("zc-vc-secondary-vid-cnt").removeClass("zc-vc-primary-vid-cnt zc-vc-tertiary-vid-cnt").attr("videochatbutton",""),this.dom.remoteVideo.attr("src","").parents("[component=videocontainer]").addClass("zc-vc-primary-vid-cnt").removeClass("zc-vc-secondary-vid-cnt zc-vc-tertiary-vid-cnt").removeAttr("videochatbutton"),this.dom.sharedScreen.attr("src","").parents("[component=videocontainer]").addClass("zc-vc-tertiary-vid-cnt").removeClass("zc-vc-primary-vid-cnt zc-vc-secondary-vid-cnt").attr("videochatbutton","").hide(),this.dom.floatingDom.find("#vc-loader").empty(),this.dom.floatingDom.hide(),this.resetScreenShareOpt(),this.showUnreadCount(0),this.isFullscreen&&this.toggleFullscreen(),"undefined"!=typeof this.getCWin()){var a=this.getCWin();a.setMediaChatRunning(!1),a.hideVideoChatArea(),a.win().find("#videochatspace").removeClass("zcvcspltvw").find("#vc-loader").empty()}this.destroyUI()},getCWin:function(){return ChatUI.exist[this.chid]},forcePlay:function(){var e=[this.dom.localVideo[0],this.dom.localVideo[1],this.dom.remoteVideo[0],this.dom.remoteVideo[1],this.dom.sharedScreen[0],this.dom.sharedScreen[1]];for(var t in e){var i=e[t],a="object"==typeof i.srcObject?i.srcObject:$(i).attr("src");if(!$WC.$CUtil.isEmpty(a))try{i.play()}catch(s){}}},getDefaultRatio:function(){return $Util.Browser.isFirefox()?this.DEFAULTVIDEORATIO_FIREFOX:this.DEFAULTVIDEORATIO_CHROME},handle:{goToStore:function(){$WC.$Win.destroy("extension_install_preview"),ScreenShare.Extension.openStore()},toggleFullscreen:function(){MMChat.toggleFullscreen()},toggleMic:function(){var e="common.micoff",t=$('[videochatbutton][purpose="toggleMic"]');MMChat.api.isMicOff()?(MMChat.api.micOn(),t.addClass("msi-mic")):(MMChat.api.micOff(),e="common.micon",t.removeClass("msi-mic")),t.attr("title",Resource.getRealValue(e)),MMChat.updateMediaClasses()},toggleCam:function(){if(!MMChat.isSwitchAllowed())return void MMChat.showUnSupportedBanner("videochat.switch.not.supported");var e="videochat.cameraoff",t=$('[videochatbutton][purpose="toggleCam"]');MMChat.api.isCameraOff()?(MMChat.api.cameraOn(),t.removeClass("msi-vmute")):(MMChat.api.cameraOff(),e="videochat.cameraon",t.addClass("msi-vmute")),t.attr("title",Resource.getRealValue(e)),MMChat.updateMediaClasses()},endCall:function(){MMChat.close("On end button click")},showChat:function(){MMChat.isFullscreen?MMChat.setInnerChatVisibility(!MMChat.isInnerChatVisible):ChatsList.attachContinueActiveChat(MMChat.chid),MMChat.forcePlay()},switchVideo:function(e,t){(!MMChat.isFullscreen||$(t.target).attr("swap"))&&MMChat.switchVideo(e)},deviceSettings:function(){MMChat.showDevicePreference()},showMoreOption:function(e,t){var i=e.attr("id");Clickoutside.bind({srcid:i,destid:"videochatmoreoption",event:t,customShow:function(){$("[id="+i+"]").addClass("zc-vc-more-optns")},customHide:function(){$("[id="+i+"]").removeClass("zc-vc-more-optns")}})},shareScreen:function(e,t){return MMChat.isScreenShareAllowed()?$Util.Browser.isChrome()&&!ScreenShare.Extension.isInstalled()?void MMChatUI.showExtensionInstallPreview():(MMChat.api.setChromeExtensionAvailable(!0),MMChat.api.addScreenShare(function(){$("[id="+e.attr("id")+"]").addClass("msi-scrnshr-stop").removeClass("msi-scrnshr-start").text(Resource.getRealValue("videochat.screen.share.stop")).attr("purpose","stopScreenShare"),MMChat.isScreenShare(MMChat.callType),$("body").addClass("zc-vc-scrn-shr")}),void Clickoutside.handleClickOnChild(t)):void MMChat.showUnSupportedBanner("videochat.screenshare.not.allowed")},stopScreenShare:function(e,t){MMChat.api.removeScreenShare(),Clickoutside.handleClickOnChild(t)},startVideo:function(e,t){return MMChat.isSwitchAllowed()?(MMChat.handle.toggleCam(),void Clickoutside.handleClickOnChild(t)):void MMChat.showUnSupportedBanner("videochat.switch.not.supported")},tryScreenshare:function(){$("#onboardscreenshare").remove(),MMChat.startScreenShare(ChatUI.exist[MainUI.currentchat],"chatwindow_collapse")}},handleGetMeFront:function(){this.isRunning&&MMChat.getCWin()&&(this.isFullscreen&&MainUI.current!=this.chid&&this.toggleFullscreen(),MainUI.isChatinViewport(this.chid)?this.isFullscreen||this.setFloatingView(!1):"profileview"==MainUI.current||this.hasBlockingOverlayWindow()?this.setFloatingView(!0):this.isFullscreen||this.setFloatingView(!0)),this.handleUIResize()},handleMouseMove:function(){clearTimeout(this.buttonsFadeoutTimer),this.isRunning?($("body").removeClass("zcvchidbtns"),this.buttonsFadeoutTimer=setTimeout(function(){$("body").addClass("zcvchidbtns")},this.BUTTONSFADEOUTTIME)):$("body").removeClass("zcvchidbtns")},handleEscape:function(){if(!this.isInitialized)return!1;if(this.isRunning){if(this.isFullscreen)return this.isInnerChatVisible?this.setInnerChatVisibility(!1):this.toggleFullscreen(),!0;if(MainUI.isCurrentisChat()&&MainUI.current==this.chid){var e=this.chid;return MMChat.askCloseConfirmation(function(){MainUI.current=e,Chat.quit(e,void 0,void 0,$zcg._ESCEVENT)}),!0}}return MMChat.AnswerCall.dom.replyTextbox&&MMChat.AnswerCall.dom.replyTextbox.is(":focus")?(MMChat.AnswerCall.rejectCall(),!0):void 0},handleKeyDown:function(e){return this.isFullscreen&&9==e.keyCode?(e.preventDefault(),!0):void 0},handleUnload:function(){this.isRunning&&(MMChat.api.updateLogMessage("[stopchat] SOURCE: On window unload"),MMChat.api.stopChat())},handleCWinCreated:function(e){this.isRunning&&(e.chid!=this.chid||e.isMediaChatRunning||e.showVideoChatArea()),"function"==typeof this.aftercwinCreated&&this.aftercwinCreated(e)},handleChatWindowClosed:function(e){this.isRunning&&(this.chid==e&&this.close("On chat window removed"),this.handleUIResize())},handleChatWindowBeforeClose:function(e,t){this.isFullscreen?this.setInnerChatVisibility(!1):MMChat.askCloseConfirmation(t)},handleOverlayWindowCreatedOrDestroyed:function(){this.hasBlockingOverlayWindow()?this.isFullscreen?this.toggleFullscreen():this.setFloatingView(!0):this.isFullscreen||this.handleGetMeFront()},hasBlockingOverlayWindow:function(){for(var e=$("#zcwindows").children(),t=!1,i=0;i<e.length;i++){var a=e[i].id;if(this.allowedOverlayWindow.indexOf(a)<0){t=!0;break}}return t},handleNewMessage:function(){if(this.isFullscreen&&this.isInnerChatVisible){var e=this.getCWin();e&&e.removeNewmsgNotification()}this.updateUnreadCount()},handleServerStatus:function(e){this.isRunning&&this.api&&this.api.setWmsServerUpStatus(e)},handleUIResize:function(){this.isRunning&&null!=this.videoSize&&this.getCWin()&&(this.setVideoSizeInCwin(),this.adjustPulseSize())},setVideoSizeInCwin:function(){var e=MMChat.getCWin();if(e){var t=e.win().find("#videochatspace");if(this.isInVideoView()){var i=e.win().find("#chatbody"),a=this.videoSize?this.videoSize.width/this.videoSize.height:this.getDefaultRatio(),s=Math.min(i.width()-this.CHATCONTAINERPADDING,this.MAXVIDEOFRAMEWIDTH),n=(i.height()+t.height()+this.CHATCONTAINERPADDING)*this.CHATCONTAINERRATIO,r=n*a;r>s&&(r=s),r+this.CHATCONTAINERPADDING<this.MINIMUM_WIDTH&&(r=this.MINIMUM_WIDTH);var o=r/a;t.css({height:o+this.CHATCONTAINERPADDING,width:r+this.CHATCONTAINERPADDING})}else t.css(this.AUDIOCALL_SIZE);MainUI.resize()}},setVideoSizeInFullScreen:function(e){if(this.isVideoCall(this.callType)&&this.isFullscreen){var t=this.videoSize?this.videoSize.width/this.videoSize.height:this.getDefaultRatio(),i=this.dom.floatingDom.find("[id=videocontainer]").not("#innerchat #videocontainer"),a=i.width();e&&(a=this.isInnerChatVisible?a-this.INNERCHATWIDTH:a+this.INNERCHATWIDTH);var s=a/i.height(),n=this.dom.floatingDom.find(".zc-vc-primary-vid-cnt").not("#innerchat .zc-vc-primary-vid-cnt");s>t?n.addClass("zc-vc-h100").removeClass("zc-vc-w100"):n.addClass("zc-vc-w100").removeClass("zc-vc-h100")}},handleWMSMessage:function(e){this.isInitialized&&VideoCallReceiver.handleVideoMessage(e)},isCallIconAllowed:function(){return this.isInitialized&&!this.isRunning&&MMChat.isAnyMediaOptionEnabled()},getCwinForZuidIfExistInView:function(e){var t=null,i=ChatUI.exist;for(var a in i)if(i[a].isOnetoOneChat()&&Participants.get(i[a].chid).getRecipientFor121Chat()==e){t=i[a];break}return t},log:function(e){this.logData.push((new Date).getTime()+" : "+e),this.logData.length>100&&this.logData.shift()},runConnectedTransition:function(){return this.isConnectedTransitioned?void MainUI.resize():(this.setVideoSizeInCwin(),$("body").addClass("zcvctrncnt"),setTimeout(function(){$("body").removeClass("zcvctrncnt")},this.ANIMATION_TIME),this.setCallStatus(MMChatConstants.callStatusCodes.CONNECTED),clearTimeout(this.remoteVideoTimer),this.handleGetMeFront(),void(this.isConnectedTransitioned=!0))},showUnreadCount:function(e){""===e||0==e?(this.dom.msgcount.text(""),this.dom.msgcount.hide()):(this.dom.msgcount.text(e),this.dom.msgcount.show())},showTour:function(e){var t=$("#chatwindowsviewport").find("#"+e),i=t.find('[data-purpose="zcscreenshare"]').attr("id");if(!$ZCVideoBroadcast.isVideoBroadcastPage&&MMChat.isCallIconAllowed()&&"0"===Settings.getFromObj("av_screen_shared",!0)&&!Tour.isNewTourAvailable("one2onechat")&&Tour.isNewTourAvailable("screenshare")&&MMChat.isScreenSharingEnabledInAVCall()&&i){if($('[data-purpose="tour_animated"]').length)return;t.find('[data-purpose="drpdowncalloption"]').addClass("shwcldrpdwn"),MMChat.updateScreenTourTimeout&&clearTimeout(MMChat.updateScreenTourTimeout);var a='<div class="touranim" data-purpose="tour_animated" module="screenshare"></div>';t.find('[data-purpose="zcscreenshare"]').prepend(a),Clickoutside.bind({srcid:"#"+e,destid:i,closeOnClickSrc:!1,customHide:function(){t.find('[data-purpose="drpdowncalloption"]').removeClass("shwcldrpdwn"),t.find('[data-purpose="tour_animated"][module="screenshare"]').remove(),MMChat.updateScreenTourObj()}})}},updateScreenTourObj:function(){var e=JSON.parse($zcg._TOURVERSIONS).screensharetourversion,t=Settings.getFromObj("screensharetourversion",!0);e!=t&&Tour.updateTourObj("screenshare")},handleScreenCallTourAnimation:function(){Settings.update({av_screen_shared:"1"}),this.updateScreenTourObj();var e='<div class="mcontent"><div class="dflx flx-dirC h100"><div class="flxG posrel"><div class="scrn-system-con dflxcent"><div class="scrn-sharing-system"><img src={{systemscreenshare}} width="100%"></div><div class="scrn-sharing-animation"><img src={{screenshareanimation}} width="100%"></div><div class="scrn-sharing-system big-scrn"><img class="system-screen-share" src={{systemscreenshare}} width="100%"><div class="blink-scrn"></div></div></div></div><div class="scrn-sharing-text">{{content}}<a class="a-link" target="_blank" href={{helpdoclink}}>{{more}}</a></div><div class="fshrink mrgTB25 textcent" videochatbutton purpose="tryScreenshare"><div class="dbtn scrn-sharing-btn">{{trynow}}</div></div></div></div></div>',t=$WC.template.replace(e,{$content:"tour.zcscreenshare.desc",$trynow:"tour.trynow",$more:"common.learnmore",$helpdoclink:$zcg._SSTUTORIALLINK,systemscreenshare:$zcg._IMGDEFAULTSTATICURL+"/system-screen-share.svg",screenshareanimation:$zcg._IMGDEFAULTSTATICURL+"/screen-share-animation.gif"}),i=$WC.template.replace('<div class="font22">{{title}}</div>',{$title:"tour.zcscreenshare.title"});$WC.$Win.create({"class":"botDialog scrnSharing",id:"onboardscreenshare",header:i,html:t,closeoutside:!0})},startScreenShare:function(e,t){0===Settings.getFromObj("av_screen_shared")?($('[data-purpose="drpdowncalloption"]').removeClass("shwcldrpdwn"),e.win().find('[data-purpose="tour_animated"][module="screenshare"]').remove(),MMChat.handleScreenCallTourAnimation()):MMChat.startVideoChat(e,MMChatConstants.callTypes.SCREEN,MMChatConstants.callModes.OUTGOING,t)},startVideoChat:function(){var e=arguments;if(this.devicePreference.mic){var t={};this.getMediaDevices(function(i){i.forEach(function(e){t[e.kind+"&"+e.deviceId]=e}),MMChat.devicePreference.mic&&!t.hasOwnProperty("audioinput&"+MMChat.devicePreference.mic.deviceId)&&delete MMChat.devicePreference.mic,MMChat.startCall.apply(MMChat,e)},function(){MMChat.devicePreference={},MMChat.startCall.apply(MMChat,e)})}else this.startCall.apply(this,e)},startCall:function(e,t,i,a){if(this.isOutGoingCall(i)&&this.isScreenShare(t)&&$Util.Browser.isChrome()&&!ScreenShare.Extension.isInstalled())return void MMChatUI.showExtensionInstallPreview();if(!this.isRunning){this.isRunning=!0,this.callType=t,this.callMode=i;var s=Participants.get(e.chid),n=s.getRecipientFor121Chat();if($WC.$CUtil.isEmpty(n)){var r=s.recipants;if(r.length||!MMChat.isInCommingCall(i))return this.isRunning=!1,void MMChat.showCallFailedBanner();n=MMChat.AnswerCall.zuid}this.initUI(),e.setMediaChatRunning(!0),this.videoSize=null,this.remoteVideoSize=null,this.localVideoSize=null,this.sharedScreenSize=null,this.zuid=n,this.chid=e.chid;var o=MMChatConstants.callStatusCodes.STARTED,l=e.win();this.dom.timer=l.find("#videochattimer").add(this.dom.floatingDom.find("#videochattimer")),this.dom.audioVis=l.find("#vcaudiopulse").add(this.dom.floatingDom.find("#vcaudiopulse")),this.dom.remoteVideo=l.find("#remotevideo").add(this.dom.floatingDom.find("#remotevideo")),this.dom.localVideo=l.find("#localvideo").add(this.dom.floatingDom.find("#localvideo")),this.dom.sharedScreen=l.find("#sharedscreen").add(this.dom.floatingDom.find("#sharedscreen")),this.dom.floatingDom.find("#videochattitle").html(Users.getName(MMChat.zuid)),clearTimeout(MMChat.acceptCallTimer),clearTimeout(MMChat.triggerCallTimer),MMChat.aftercwinCreated=null;var c="";this.isVideoCall(t)?c="zcvidcall":this.isAudioCall(t)?(c="zcaudcall",this.isRemoteCamOff=!0):(c="zc-vc-scrn-shr "+(this.isOutGoingCall(i)?"zcaudcall":"zcvidcall"),this.isRemoteCamOff=!0),$("body").removeClass("zcaudcall zcvidcall zc-vc-scrn-shr").addClass(c),$('[videochatbutton][purpose="toggleMic"]').attr("title",Resource.getRealValue("common.micoff")).css("opacity","").addClass("msi-mic"),$('[videochatbutton][purpose="toggleCam"]').attr("title",Resource.getRealValue("videochat.cameraoff")).css("opacity","").removeClass("msi-vmute"),$("[remoteuserimg]").attr("src","").attr("src",Users.getImgUrlById(n)),$("[localuserimg]").attr("src",Users.getImgUrlById($zcg._ZUID)),$(".zcclrnm").html(Users.getName(n)),$(".zcvctmr").text("00 : 00"),this.dom.sharedScreen.parents("[component=videocontainer]").hide(),ChatUI.updateChatWindowOptions();var d={zuid:n,chid:this.chid};this.isOutGoingCall(i)?(MMChat.isScreenShare(t)&&(o=MMChatConstants.callStatusCodes.WAITING,$("[id=screenshareopt]").addClass("msi-scrnshr-stop").removeClass("msi-scrnshr-start").text(Resource.getRealValue("videochat.screen.share.stop")).attr("purpose","stopScreenShare")),d.callingZUID=$zcg._ZUID,d.calledZUID=n,$Util.Browser.isChrome()&&(d.extAvailable=ScreenShare.Extension.isInstalled()),VideoCallReceiver.startChat(n,t,d,this.VideoChatHandler),ZCTrack.track("CALL_INITIATED",{Type:t,Source:a}),Clickoutside.currentchain.indexOf("screenshare"+this.chid)>-1&&(MMChat.updateScreenTourObj(),Clickoutside.clear("screenshare"+this.chid))):(o=MMChatConstants.callStatusCodes.CONNECTING,VideoCallReceiver.answerChat(n,this.sid,t,this.VideoChatHandler),VideoCallReceiver.stop(),ZCTrack.track("CALL_ANSWERED",{Type:t,Source:a})),this.setCallStatus(o);var u=this.STARTINGSIZE;if(MMChat.isVideoCall(t)||MMChat.isScreenShare(t)&&MMChat.isInCommingCall(i)){var m=l.find("#chatbody"),p=m.width()-40,h=m.height()*this.CHATCONTAINERRATIO;p>=h?p=h:h=p,u={height:h+MMChat.CHATCONTAINERPADDING,width:p+MMChat.CHATCONTAINERPADDING}}else u=this.AUDIOCALL_SIZE;l.find("#videochatspace").css(u),l.find("video").attr("src","").bind("contextmenu",function(){return!1}),e.showVideoChatArea(),this.adjustPulseSize();try{MMChat.animator()}catch(g){MMChat.log(g)}}},setCallStatus:function(e){this.callStatus;this.callStatus=e,$("body").removeClass(MMChat.callStatusClasses.join(" ")).addClass(MMChat.callStatusClasses[e])},setFloatingView:function(e,t,i){if(e){if(!this.isCallConnected())return;if(this.hasBlockingOverlayWindow()?(this.dom.floatingDom.find("#vcfullscreen, #vctogglechat").hide(),this.dom.floatingDom.find("#vcsettings").css("right","5px")):(this.dom.floatingDom.find("#vcfullscreen, #vctogglechat").css("display",""),this.dom.floatingDom.find("#vcsettings").css("right","")),this.isFloatingView&&!i)return;this.getCWin().hideVideoChatArea();var a=this.DRAGGABLESIZE;if(this.isInVideoView()){var s=this.getDefaultRatio();this.videoSize&&(s=this.videoSize.width/this.videoSize.height);var n=this.DRAGGABLESIZE.width,r=this.DRAGGABLESIZE.height,o=n,l=r;isNaN(s)||(o=r*s,o>n&&(o=n)),o<this.MINIMUM_DRAGGABLE_WIDTH&&(o=this.MINIMUM_DRAGGABLE_WIDTH),l=o/s,a={width:o,height:l}}else a={width:this.AUDIOCALL_SIZE.width-this.CHATCONTAINERPADDING,height:this.AUDIOCALL_SIZE.height-this.CHATCONTAINERPADDING};i||this.dom.floatingDom.css({left:"auto",right:20,top:"auto",bottom:20}),t?this.dom.floatingDom.animate(a,100):this.dom.floatingDom.css(a),this.dom.floatingDom.show()}else this.dom.floatingDom.hide(),this.getCWin().showVideoChatArea();this.isFloatingView=e,this.adjustPulseSize()},setInnerChatVisibility:function(e){var t=this.getCWin();if(e){if(t){var i=t.win();this.isInnerChatVisible=!0,MMChat.setVideoSizeInFullScreen(!0),i.width("inherit"),i.height("100%"),i.find("#chatbody").height(""),MainUI.isChatPaneView()||i.show(),MainUI.handleIframes(i.attr("id")),this.dom.innerChat.find("#innerchatholder").prepend(i),ZCScroll.customScroll(i.find("#chatbody"),!0),this.dom.floatingDom.addClass("zcinchtvis"),this.dom.innerChat.css({right:0}),t.getScrollDown(),t.focus()}}else{if(t){var i=t.win();i.css("opacity","")}this.isInnerChatVisible=!1,MMChat.setVideoSizeInFullScreen(!0),MMChat.dom.floatingDom.removeClass("zcinchtvis")}setTimeout(function(){MMChat.adjustPulseSize()},this.ANIMATION_TIME)},showDevicePreference:function(){if(!($("#videocall_dvic_pref").length>0)){var e={camera:[],mic:[],speaker:[]},t={};navigator.mediaDevices.enumerateDevices().then(function(i){i.forEach(function(i){t[i.kind+"&"+i.deviceId]=i,"videoinput"==i.kind?e.camera.push(i):"audioinput"==i.kind?e.mic.push(i):"audiooutput"==i.kind&&e.speaker.push(i)});var a='<option class="clr0" comp_key="table" value="{{DID}}" {{SEL}}>{{NAME}}</option>',s=Template.videoChatDevicePreference;$WC.$Win.create({id:"videocall_dvic_pref",header:'<div class="hdr">'+Resource.getRealValue("videochat.settings.msg1")+"</div>",html:s,"class":"zcmediaui"});var n=$("#videocall_dvic_pref"),r=function(e,t){for(var i="",s=0;s<e.length;s++)i+=$WC.template.replace(a,{NAME:e[s].label,DID:e[s].deviceId,SEL:e[s].deviceId==t||e[s].label==t?'selected="selected"':""});return i};if(e.mic.length){var o=MMChat.localStream.getAudioTracks()[0].label;MMChat.devicePreference.mic&&(o=MMChat.devicePreference.mic.deviceId),n.find("#mdevicelist_mic").removeAttr("disabled").html(r(e.mic,o))}if(e.speaker.length){var o="default";MMChat.devicePreference.speaker&&(o=MMChat.devicePreference.speaker.deviceId),n.find("#mdevicelist_speaker").removeAttr("disabled").html(r(e.speaker,o))}n.on("click","[mdevice-switch]",function(){n.find("[mdevice-switch]").removeClass("zcmedsel");var e=$(this).addClass("zcmedsel").attr("mdevice-switch");n.find("[mdevice-cnt]").hide(),n.find('[mdevice-cnt="'+e+'"]').show()}),n.find("#mdevice_pref_save").click(function(){var e=n.find("#mdevicelist_mic").val(),i=n.find("#mdevicelist_speaker").val();MMChat.setPreferedDevice({mic:t["audioinput&"+e],speaker:t["audiooutput&"+i]})})})}},setPreferedDevice:function(e){var t=[],i=function(){if(e.speaker&&e.speaker.deviceId){var i=MMChat.dom.remoteVideo[0];"function"==typeof i.setSinkId&&(i.setSinkId(e.speaker.deviceId),MMChat.api?MMChat.api.setSpeakerDevice(e.speaker):MMChat.lastCallAPI&&MMChat.lastCallAPI.setSpeakerDevice(e.speaker))}if(MMChat.isRunning&&t.length){{var a=MMChat.getCWin(),s=MMChat.callType;MMChat.callMode}MMChat.close("On device switch"),setTimeout(function(){MMChat.startVideoChat(a,s,MMChatConstants.callModes.OUTGOING,"")},1e3)}MMChat.devicePreference=e,$DB.update("mediadevicepref",e),$WC.$Win.destroy("videocall_dvic_pref")};this.isRunning?this.devicePreference.hasOwnProperty("mic")&&this.devicePreference.mic.deviceId==e.mic.deviceId?i():$WC.$Dlg.confirm({id:"MediaChatDeviceSwitchConfirm",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("videochat.devicechange.msg1"),Resource.getRealValue("videochat.devicechange.msg2")]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn clr-red"></div>',ispositive:!0,header:Resource.getRealValue("videochat.devicechange.confirm")}),buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){t.push(e.mic),i()}}]}):(t.push(e.mic),i())},getMediaDevices:function(e,t){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(t){e(t)}):setTimeout(function(){"function"==typeof t&&t()},1)},showPermissionDialogue:function(){var e=0,t="auto",i="permission-chrome-cam-2";$Util.Browser.isChrome()?MMChat.isVideoCall(MMChat.callType)?(e=450,t=190,i="permission-chrome-cam-2"):(e=465,t=190,i="permission-chrome-mic-2"):$Util.Browser.isFirefox()?MMChat.isVideoCall(MMChat.callType)?(e=535,t=276,i="permission-firefox-cam-2"):(e=500,t=225,i="permission-firefox-mic-2"):$Util.Browser.isOpera()?MMChat.isVideoCall(MMChat.callType)?(e=455,t=197,i="permission-opera-cam-2"):(e=470,t=196,i="permission-opera-mic-2"):$Util.Browser.isSafari()?(e=455,t=170,i=MMChat.isVideoCall(MMChat.callType)?"permission-safari-cam-2":"permission-safari-mic-2"):$Util.Browser.isEdge()&&(e=370,t=65,i=MMChat.isVideoCall(MMChat.callType)?"permission-edge-cam-2":"permission-edge-mic-2");var a="",s="",n="";MMChat.isVideoCall(MMChat.callType)?(a=Resource.getRealValue("common.permission.cameramic"),s=Resource.getRealValue("videochat.permission.msg2"),n=Resource.getRealValue("videochat.permission.msg3")):(a=Resource.getRealValue("videochat.permission.msg4"),s=Resource.getRealValue("videochat.permission.msg5"),n=Resource.getRealValue("videochat.permission.msg6"));var r=$zcg._IMGDEFAULTSTATICURL+"/"+i+".png",o='<div class="zcviacct">'+a+'<span class="zcviarw"></span></div><img src="'+r+'"  class="zcviimg mrgT25"/><div class="font14 zclin18 mrgT10 clr6">'+s+"</br>"+n+"</div>";$WC.$Dlg.alert({id:"VideoChatInfoMessage",bodyhtml:o});var l=$("#VideoChatInfoMessage");l.addClass("zcvcprmisn");var c=0;e<window.innerHeight&&(c=(window.innerHeight-e)/2),l.height(e),l.find("img").height(t)},showCallFailedBanner:function(){UI.updateBanner(Resource.getRealValue("videochat.call.failed"),2e3,!0),ZCTrack.track("CALL_FAILED",{Type:MMChat.callType})},switchVideo:function(e){if(this.isCallConnected()){this.isFullscreen&&(this.dom.floatingDom.find(".zc-vc-primary-vid-cnt").not("#innerchat .zc-vc-primary-vid-cnt").css(e.position()),e.css({left:"",top:""}));var t=e.hasClass("zc-vc-secondary-vid-cnt")?"zc-vc-secondary-vid-cnt":"zc-vc-tertiary-vid-cnt",i=$(".zc-vc-primary-vid-cnt"),a=$("."+t);i.addClass(t).removeClass("zc-vc-primary-vid-cnt").attr("videochatbutton",""),a.removeClass(t).addClass("zc-vc-primary-vid-cnt").removeAttr("videochatbutton").attr("title","");var s=e.attr("id");this.videoSize="remotevideocontainer"==s?this.remoteVideoSize:"localvideocontainer"==s?this.localVideoSize:this.sharedScreenSize,this.isFullscreen?this.setVideoSizeInFullScreen():this.correctVideoSize(),this.updateMediaClasses(),this.adjustPulseSize()}},toggleFullscreen:function(){var e="videochat.fullscreen",t={left:"",right:"",top:"",bottom:"",width:"",height:""};if(this.isFullscreen){if(this.setInnerChatVisibility(!1),MMChat.dom.innerChat.find("#innerchatholder").children().length>0){var i=MMChat.dom.innerChat.find("#"+MMChat.getCWin().chid);i.css("opacity",""),MainUI.handleIframes(i.attr("id")),MainUI.isChatPaneView()?$("#chatwindowshideport").append(i):(MMChat.getCWin().win().width("inherit"),$("#chatwindowsviewport").append(i)),ZCScroll.customScroll(i.find("#chatbody"),!0),MainUI.isCurrentisChat()&&(MainUI.current="home"),$("#chatwindows").find('.selcht[purpose="chatview"]').removeClass("selcht"),"profileview"==MainUI.current?$("#chatwindows").hide():MainUI.getMefront(MMChat.chid,!0),MMChat.getCWin().showVideoChatArea(),MainUI.resize(),this.handleUIResize(),this.forcePlay()}var a=MMChat.DRAGGABLESIZE;this.dom.floatingDom.find("#vctogglechat").attr("title",Resource.getRealValue("common.chat"));var s=this.dom.floatingDom.find("#videochatctrlbtnscontain , #vcfullscreen, #vcsettings");s.hide();var n=function(){s.show(),$("body").removeClass("zcvcflcrn"),MMChat.adjustPulseSize(),MMChat.correctVideoSize()};if(MainUI.isChatinViewport(MMChat.chid)&&!this.hasBlockingOverlayWindow()){var r=this.getCWin().win().find("#videochatvisiblearea");a=r.offset(),a.width=r.width(),a.height=r.height(),this.dom.floatingDom.animate(a,function(){$(this).hide(),MMChat.isFloatingView=!1,n()})}else{var o=this.getDefaultRatio();this.videoSize&&(o=this.videoSize.width/this.videoSize.height);var l=this.DRAGGABLESIZE.width,c=this.DRAGGABLESIZE.height,d=l,u=c;isNaN(o)||(d=c*o,d>l&&(d=l,u=l/o)),d<this.MINIMUM_DRAGGABLE_WIDTH&&(d=this.MINIMUM_DRAGGABLE_WIDTH),a.width=d,a.height=u,a=Object.assign(a,{left:$(document).width()-a.width-20,top:$(document).height()-a.height-20}),this.dom.floatingDom.animate(a,function(){n(),MMChat.isFloatingView=!1,MMChat.setFloatingView(!0,!0)})}var m=this.dom.floatingDom.find(".zc-vc-secondary-vid-cnt"),p=this.dom.floatingDom.find(".zc-vc-tertiary-vid-cnt"),h={top:"",bottom:m.parent().height()-m.offset().top-m.height()};m.css(h),p.css(h);var g={width:55,height:55,left:15,bottom:15};m.animate(g,function(){$(this).css(t)}),g.left=85,p.animate(g,function(){$(this).css(t)})}else{var s=this.dom.floatingDom.find("#videochatctrlbtnscontain , #vcfullscreen , #vcsettings"),m=this.dom.floatingDom.find(".zc-vc-secondary-vid-cnt"),p=this.dom.floatingDom.find(".zc-vc-tertiary-vid-cnt"),a={left:85,bottom:15,width:m.width(),height:m.height()};if(p.css(a),a.left=15,m.css(a),s.hide(),$("body").addClass("zcvcflcrn"),!this.isFloatingView){var r=this.getCWin().win().find("#videochatvisiblearea");a=r.offset(),a.width=r.width(),a.height=r.height(),this.dom.floatingDom.css(a),this.dom.floatingDom.show()}this.dom.floatingDom.find("#vctogglechat").attr("title",Resource.getRealValue("videochat.toggle.chat")),this.dom.floatingDom.animate({width:"100%",height:"100%",top:0,left:0},function(){s.css("display",""),MMChat.adjustPulseSize(),MMChat.setVideoSizeInFullScreen()});var g={width:120,height:120,left:60,bottom:50};m.animate(g,function(){$(this).css(t)}),g.left=210,p.animate(g,function(){$(this).css(t)}),e="videochat.minimize"}$('[videochatbutton][purpose="toggleFullscreen"]').attr("title",Resource.getRealValue(e)),this.isFullscreen=!this.isFullscreen,this.adjustPulseSize()},triggerCall:function(e,t,i){var a=MMChat.getCwinForZuidIfExistInView(e);a?(MainUI.getMefront(a.chid,!0),MMChat.isVideoCall(t)?a.startVideoCall(i):MMChat.isAudioCall(t)?a.startAudioCall(i):a.startScreenShare(i)):(MMChat.aftercwinCreated=function(a){Participants.get(a.chid).getRecipientFor121Chat()==e&&(MMChat.isVideoCall(t)?a.startVideoCall(i):MMChat.isAudioCall(t)?a.startAudioCall(i):a.startScreenShare(i),MMChat.aftercwinCreated=null,clearTimeout(MMChat.triggerCallTimer))},clearTimeout(MMChat.triggerCallTimer),MMChat.triggerCallTimer=setTimeout(function(){MMChat.aftercwinCreated=null,MMChat.showCallFailedBanner()},MMChat.CALLCONNECTION_TIMEOUT),Chat.create(e,"im"))},triggerAudioCall:function(e,t){this.triggerCall(e,MMChatConstants.callTypes.VOICE_WITH_VIDEO,t)},triggerVideoCall:function(e,t){this.triggerCall(e,MMChatConstants.callTypes.VIDEO,t)},triggerScreenShare:function(e,t){this.triggerCall(e,MMChatConstants.callTypes.SCREEN,t)},updateMediaClasses:function(){$("body").removeClass("zcvclcamoff zcvcrcamoff"),this.api.isCameraOff()&&$("body").addClass("zcvclcamoff"),this.isRemoteCamOff&&$("body").addClass("zcvcrcamoff")},updateSearchWindowOptions:function(){GSUI.isNewSearchUIShown()&&$("#GS-results").find("[media-disable]").attr("media-disable","false")},updateUnreadCount:function(){var e=this.getCWin();e&&this.showUnreadCount(e.unreadmsgcount)},aftercwinCreated:function(){},getCustomTitle:function(e,t){return $Util.getCustomTooltip(Resource.getRealValue(e),"","",t)},getStreamURL:function(e){var t=window.URL||window.webkitURL;return t.createObjectURL(e)},setVideoSource:function(e,t){if("object"==typeof e[0].srcObject)e[0].srcObject=t,e[1].srcObject=t;else{var i=this.getStreamURL(t);e.attr("src",i),this.log("StreamUrl "+i)}},resetScreenShareOpt:function(){$("[id=screenshareopt]").addClass("msi-scrnshr-start").removeClass("msi-scrnshr-stop").text(Resource.getRealValue("videochat.screen.share")).attr("purpose","shareScreen")},showUnSupportedBanner:function(e){var t=Resource.getRealValue(e,Users.getName(MMChat.zuid))+"<br><br>"+Resource.getRealValue("videochat.callsupport.hint");UI.updateBanner(t)},loadAndinit:function(){for(var e=$zcg._VIDEOCHATPROPS.JSLIST,t=e.length,i=function(){t--,0>=t&&MMChat.init()},a=0;a<e.length;a++){var s=document.createElement("script");s.src=e[a],s.onload=i,document.head.appendChild(s)}}},MMChat.AnswerCall={CLOSE_TIMEOUT:3e4,MAX_CHARACTER:2e3,dom:{},customMsgs:[],zuid:null,sid:null,chid:null,closeTimer:null,isVisible:!1,isReplying:!1,init:function(){var e=this;this.dom.main=$("#vcincommingcall"),this.bindEvents(),$ZCAjx.ajax({url:"v1/mediacallrejectmessage",success:function(t){e.addCustomMsg(t.data.messages)}})},initUI:function(){this.dom.main.html($WC.template.replace(Template.VideoChatIncomming,{pulse_cnt:Template.VideoChatPulseCnt},"InSecureHTML")),this.dom.acceptButton=this.dom.main.find("[vcacceptcall]"),this.dom.rejectButton=this.dom.main.find("[vcreject]"),this.dom.replyContainer=this.dom.main.find("#vcreplycontainer"),this.dom.replyTextbox=this.dom.main.find("#vcreplycusmsg"),this.addCustomMsg(this.customMsgs)},destroyUI:function(){this.dom.main.empty()},addCustomMsg:function(e){var t=this.dom.main.find("#customvcrejectmsg"),i='<div class="mrgT15 cur" vcreplymsg vccustommsg action="sendpresetmsg">{{MSG}}</div>',a=null;if(e instanceof Array){if(this.customMsgs=e,t.html(""),e.length){for(var s in e){var n=e[s].msg;a=$($WC.template.replace(i,{MSG:n})),t.prepend(a)}a.addClass("mrgB5")}}else this.customMsgs.length>5&&this.customMsgs.pop(),this.customMsgs.push(e),this.addCustomMsg(this.customMsgs)},bindEvents:function(){var e=this;this.dom.main.on("click","[action]",function(){if(action=this.getAttribute("action"),"acceptcall"==action)MMChat.isRunning?$WC.$Dlg.confirm({id:"MediaChatTerminateOnAccept",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue("videochat.confirm.disconnect",[Users.getName(MMChat.zuid),Users.getName(e.zuid)])]}),headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-zinfo clr-green"></div>'}),buttons:[{text:Resource.getRealValue("common.goahead"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){MMChat.close("On close confirmation to accept another call"),MMChat.AnswerCall.acceptCall()}}]}):e.acceptCall();else if("replycall"==action)VideoCallReceiver.speakerOff(),e.dom.replyContainer.show(),e.dom.main.find("[pulsediv]").hide(),e.dom.replyContainer.find("#vcreplycusmsg").focus();else if("rejectcall"==action)e.rejectCall();else if("sendreplymsg"==action){if(""==e.dom.replyTextbox.val())return;e.replyMessage()}else"sendpresetmsg"==action&&e.replyMessage(this.innerText,this.hasAttribute("vccustommsg"))}),this.dom.main.on("keydown","[vcreplytxtbx]",function(t){if(13==t.keyCode){if(""==this.value)return;e.replyMessage()}})},close:function(e){this.isVisible&&this.sid==e&&this.hide(),VideoCallReceiver.stop()},replyMessage:function(e,t){var t=1==t,i=this;if(e||(e=this.dom.replyTextbox.val(),t=!0),e&&""!=e){if(e.length>this.MAX_CHARACTER)return void UI.updateBanner(Resource.getRealValue("videochat.incommingreply.errormsg"),2e3,!0);var a={zuid:this.zuid,message:e,custom:t},s=function(){UI.updateBanner(Resource.getRealValue("chat.message.send.error"),2e3,!0)};this.chid&&(a.chid=this.chid);var n={url:"v1/mediacallrejectmessage/",type:"POST",data:a,error:s,success:function(e){t&&i.addCustomMsg(e.data.messages)}};$ZCAjx.ajax(n)}this.rejectCall()},show:function(e,t,i,a){if(this.isVisible||MMChat.isRunning&&MMChat.zuid==e&&MMChat.isCallConnected()&&!MMChat.isReconnecting)return VideoCallReceiver.ignoreChat(e,t,VideoConstants.BUSY_ON_ANOTHER_CALL),void VideoCallReceiver.stop();this.isReplying&&this.hide(!0),1===Settings.getFromObj("globalsoundnotify")&&$Util.wmsnotifyowner.isOwner()&&((MMChat.isAudioCall(i)||MMChat.isAudioVideoCall(i)||MMChat.isVideoCall(i))&&1===Settings.getFromObj("av_call_sound_notify")||MMChat.isScreenShare(i)&&1===Settings.getFromObj("screen_call_sound_notify"))&&VideoCallReceiver.playSound(),this.initUI();var s=this.dom.main;s.find("[pulsediv]").show();var n=Users.getName(e),r=Users.getImgUrlById(e),o=Resource.getRealValue(MMChat.isVideoCall(i)?"videochat.incomming.video":MMChat.isAudioCall(i)?"videochat.incomming.audio":"videochat.incomming.screen");this.isVisible=!0,this.sid=t,this.zuid=e,this.chid=a.chid,this.type=i,this.dom.main.removeClass("vctpvid vctpaud zc-vc-incmng-scrn"),MMChat.isVideoCall(i)?(this.dom.main.addClass("vctpvid"),this.dom.acceptButton.addClass("msi-video"),this.dom.rejectButton.addClass("msi-vmute")):MMChat.isScreenShare(i)?this.dom.main.addClass("zc-vc-incmng-scrn"):(this.dom.main.addClass("vctpaud"),this.dom.acceptButton.removeClass("msi-video"),this.dom.rejectButton.removeClass("msi-vmute")),s.find("[callername]").html(n),s.find("[remoteuserimg]").attr("src","").attr("src",r),s.find("[vccallmsg]").text(o),s.css({left:"",top:"",width:"",height:""}),s.show(),$zcg._WINFOCUS||($Util.wmsnotifyowner.isOwner()&&$Util.notify({type:"videocall",chid:this.zuid,icon:r,title:$WC.$CUtil.decodeHTMLEntities(n),body:o,replyable:!1}),MMChat.isScreenShare(i)&&(o=n+" "+o),NotifyByTitle.show(o)),this.closeTimer=setTimeout(function(){MMChat.AnswerCall.hide(),VideoCallReceiver.stop()},this.CLOSE_TIMEOUT)},acceptCall:function(){MMChat.AnswerCall.hide(!0);{var e=MMChat.AnswerCall.zuid,t=MMChat.AnswerCall.chid,i=MMChat.AnswerCall.type,a=null;ChatUI.exist}MMChat.sid=MMChat.AnswerCall.sid,("undefined"==t||"null"==t)&&(t=null),a=t?ChatUI.exist[t]:MMChat.getCwinForZuidIfExistInView(e),a?(MainUI.getMefront(a.chid,!0),MMChat.startVideoChat(a,i,MMChatConstants.callModes.INCOMMING,"incomming_notification")):(MMChat.aftercwinCreated=function(a){(t&&a.chid==t||!t&&a.isOnetoOneChat()&&Participants.get(a.chid).getRecipientFor121Chat()==e)&&MMChat.startVideoChat(a,i,MMChatConstants.callModes.INCOMMING,"incomming_notification")},clearTimeout(MMChat.acceptCallTimer),MMChat.acceptCallTimer=setTimeout(function(){MMChat.aftercwinCreated=null,MMChat.showCallFailedBanner()},MMChat.CALLCONNECTION_TIMEOUT),t?ChatsList.attachContinueActiveChat(t):Chat.create(e,"im"))},rejectCall:function(){this.hide(!0),VideoCallReceiver.ignoreChat(this.zuid,this.sid,MMChat.DISCONNECT_MSG.REJECTED),VideoCallReceiver.stop()},hide:function(e){if(this.isVisible=!1,NotifyByTitle.stop(),clearTimeout(this.closeTimer),this.closeTimer=null,$WC.$Dlg.destroy("MediaChatTerminateOnAccept"),e)this.dom.replyTextbox.val("");else if(""!=this.dom.replyTextbox.val())return this.dom.acceptButton.css("visibility","hidden"),void(this.isReplying=!0);this.dom.main.hide(),this.dom.replyContainer.hide(),this.dom.acceptButton.css("visibility",""),this.destroyUI()}},MMChat.VideoChatHandler={setVideoChatAPI:function(e){MMChat.log("setVideoChatAPI"),MMChat.api=e,e.setChatUserName(Users.getName(MMChat.zuid)),e.setWmsServerUpStatus($zcg._CONNECTED);var t=[];MMChat.devicePreference.mic&&t.push(MMChat.devicePreference.mic),t&&e.setDevices(t),MMChat.devicePreference.speaker&&e.setSpeakerDevice(MMChat.devicePreference.speaker)},getVideoChatAPI:function(){return MMChat.log("getVideoChatAPI"),MMChat.api},handleMediaPermission:function(e,t){if(MMChat.log("handleMediaPermission "+e),"pending"==e)MMChat.permissionDialogueTimer=setTimeout(function(){MMChat.showPermissionDialogue(),MMChat.isCallConnected(MMChat.callStatusCode)||MMChat.setCallStatus(MMChatConstants.callStatusCodes.WAITING)},MMChat.PERMISSION_DIALOGUE_DELAY);else if("granted"==e)clearTimeout(MMChat.permissionDialogueTimer),$WC.$Dlg.destroy("VideoChatInfoMessage"),MMChat.callStatus<MMChatConstants.callStatusCodes.CONNECTING&&MMChat.setCallStatus(MMChat.isInCommingCall(MMChat.callMode)?MMChatConstants.callStatusCodes.CONNECTING:MMChatConstants.callStatusCodes.CALLING);else if(("denied"==e||"blocked"==e)&&!MMChat.isCallConnected()){clearTimeout(MMChat.permissionDialogueTimer),$WC.$Dlg.destroy("VideoChatInfoMessage"),MMChat.close("On handleMediaPermission - "+e);var i="videochat.permission.msg4";if(MMChat.isVideoCall(MMChat.callType))i="common.permission.cameramic";else if(MMChat.isScreenShare(t))return;$WC.$Dlg.create({id:"VideoChatInfoMessage",version:2,"class":"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-zinfo clr-green"></div>'}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Resource.getRealValue(i)]}),buttons:[{text:Resource.getRealValue("common.okgotit"),colour:$WC.$Dlg.GREEN_BUTTON}]})}},handleChatReceived:function(){MMChat.log("handleChatReceived ")},handleChatAnswered:function(){MMChat.log("handleChatAnswered ")},handleLocalStream:function(e){if(MMChat.localStream=e,MMChat.log("handleLocalStream"),!MMChat.isRunning){try{MMChat.lastCallAPI.updateLogMessage("[stopchat] SOURCE: On previous call end in handleLocalStream"),MMChat.lastCallAPI.stopChat()}catch(t){}return void MMChat.close("On handleLocalStream and call not running")}var i=MMChat.dom.localVideo[1];$(i).one("loadedmetadata",function(){if(MMChat.localVideoSize={width:this.videoWidth,height:this.videoHeight},!MMChat.isVideoCall(MMChat.callType)&&this.videoWidth>0){$("body").removeClass("zcaudcall").addClass("zcvidcall");var e=$(MMChat.dom.localVideo[0]).parents("[component=videocontainer]");MMChat.videoSize||MMChat.switchVideo(e),e.hasClass("zc-vc-primary-vid-cnt")&&(MMChat.videoSize=MMChat.localVideoSize),MMChat.isFullscreen?MMChat.setVideoSizeInFullScreen():MMChat.setVideoSizeInCwin(),MMChat.correctVideoSize()}MMChat.updateMediaClasses()}),MMChat.setVideoSource(MMChat.dom.localVideo,e)},handleLocalSrc:function(e){MMChat.log("handleLocalSrc "+e)},handleRemoteStream:function(e){MMChat.log("handleRemoteStream");var t=MMChat.dom.remoteVideo[1];$(t).one("loadedmetadata",function(){MMChat.isVideoCall(MMChat.callType)?(MMChat.remoteVideoSize={width:this.videoWidth,height:this.videoHeight},MMChat.videoSize=MMChat.remoteVideoSize):((!MMChat.localVideoSize||MMChat.localVideoSize.width<=0)&&$('[videochatbutton][purpose="toggleCam"]').addClass("msi-vmute").attr("title",Resource.getRealValue("videochat.cameraon")),this.videoWidth>0&&(MMChat.remoteVideoSize={width:this.videoWidth,height:this.videoHeight},MMChat.isRemoteCamOff=!1,MMChat.videoSize||(MMChat.videoSize=MMChat.remoteVideoSize),$("body").removeClass("zcaudcall").addClass("zcvidcall"),MMChat.isFullscreen?MMChat.setVideoSizeInFullScreen():MMChat.setVideoSizeInCwin(),MMChat.correctVideoSize(),MMChat.updateMediaClasses())),MMChat.isConnectNotifyReceived&&MMChat.runConnectedTransition(),MMChat.devicePreference.speaker&&"function"==typeof this.setSinkId&&this.setSinkId(MMChat.devicePreference.speaker.deviceId),this.muted=!1}),MMChat.setVideoSource(MMChat.dom.remoteVideo,e);try{if(MMChat.audioContext)try{MMChat.audioContext.close()}catch(i){}var a=new AudioContext;MMChat.audioContext=a;var s=a.createAnalyser();MMChat.audioAnalyser=s;var n=a.createMediaStreamSource(e),r=a.createMediaStreamDestination();n.connect(s),s.connect(r)}catch(i){}},handleRemoteSrc:function(e){MMChat.log("handleRemoteSrc "+e)},handleRemoteMediaStatus:function(e,t){MMChat.api&&MMChat.api.getSessionId()!==MMChat.sid||(MMChat.log("handleRemoteMediaStatus "+e+t),"camera"==e&&("1"==t?MMChat.isRemoteCamOff=!1:"0"==t&&(MMChat.isRemoteCamOff=!0),MMChat.updateMediaClasses(),MMChat.adjustPulseSize()))},handleSwitchingDevices:function(e){MMChat.log("handleSwitchingDevices "+e),("start"==e||"started"==e)&&this.handleLocalStream(MMChat.api.getLocalStream())},handleConnectNotify:function(){MMChat.log("handleConnectNotify "),MMChat.isScreenSharingEnabledInAVCall()?$("[id=videochatvisiblearea]").removeClass("zc-scrn-shr-disabl"):$("[id=videochatvisiblearea]").addClass("zc-scrn-shr-disabl"),MMChat.isScreenShare(MMChat.callType)&&MMChat.isOutGoingCall(MMChat.callMode)&&!MMChat.isScreenShareAllowed()&&(MMChat.showUnSupportedBanner("videochat.screenshare.not.supported"),$("body").removeClass("zc-vc-scrn-shr")),MMChat.isConnectNotifyReceived=!0,MMChat.videoSize||MMChat.isAudioCall(MMChat.callType)?MMChat.runConnectedTransition():MMChat.videoLoadingTimer=setTimeout(function(){MMChat.runConnectedTransition()},MMChat.VIDEO_LOADING_TIMEOUT),ZCTrack.track("CALL_CONNECTED",{Type:MMChat.callType})},handleChatRunningTime:function(e){MMChat.dom.timer.text(e)},handleVideoChatStatus:function(e){MMChat.log("handleVideoChatStatus "+e);var t=0;if("calling"==e)t=MMChatConstants.callStatusCodes.CALLING;else{if("connecting"!=e)return;t=MMChatConstants.callStatusCodes.CONNECTING}MMChat.setCallStatus(t)},handleSessionId:function(e){MMChat.log("handleSessionId "+e),MMChat.sid=e},handleCloseRequest:function(e){return MMChat.api&&MMChat.api.getSessionId()!==MMChat.sid?void MMChat.log("old session id"):MMChat.isCallConnected()&&e==MMChat.DISCONNECT_MSG.NORESPONSE?void MMChat.log("Invalid close request"):(MMChat.log("handleCloseRequest "+e),MMChat.setCallStatus(MMChatConstants.callStatusCodes.ENDED),void(MMChat.isRunning&&(MMChat.close("On handleCloseRequest",!0),e==MMChat.DISCONNECT_MSG.ERROR?MMChat.showCallFailedBanner():e==MMChat.DISCONNECT_MSG.NORESPONSE||e==MMChat.DISCONNECT_MSG.REJECTED||e==MMChat.DISCONNECT_MSG.BUSY_ON_OTHER_CALL)))},handleReconnect:function(e){if(MMChat.log("handleReconnect"+e),MMChat.isRunning){if(MMChat.api&&MMChat.api.getSessionId()!==MMChat.sid)return void MMChat.log("old session id");if(!MMChat.isCallConnected())return MMChat.close("On call not connected in reconnect"),void MMChat.showCallFailedBanner();var t=MMChat.dom.floatingDom.find("#vc-loader").add(MMChat.getCWin().win().find("#vc-loader"));"started"==e?($("body").addClass("mmchtrcnt"),MMChat.isVideoCall(MMChat.callType)&&$Util.animateBufferLoader(t,8),MMChat.isReconnecting=!0):"connected"==e?(MMChat.isReconnecting=!1,$("body").removeClass("mmchtrcnt"),t.empty()):"failed"==e&&(MMChat.setCallStatus(MMChatConstants.callStatusCodes.ENDED),MMChat.close("On handleReconnect - failed"),MMChat.showCallFailedBanner())}},handleScreenShareReconnect:function(e){MMChat.log("handleScreenShareReconnect"+e)},handleLocalMediaStatus:function(e){MMChat.log("handleLocalMediaStatus "+e)},handleVideoError:function(e){MMChat.log("handleVideoError "+e),MMChat.close("On handleVideoError"),MMChat.showCallFailedBanner()},handleSwitchingToVideoCall:function(e){MMChat.log("handleSwitchingToVideoCall "+e)},handleBrowserNotSupported:function(e){MMChat.log("handleBrowserNotSupported "+e)},handleRemoteScreenShareStreamAdded:function(e){MMChat.log("handleRemoteScreenShareStreamAdded"),$("[id=videochatvisiblearea]").addClass("zc-scrn-shr-disabl");var t=MMChat.dom.sharedScreen[1];$(t).one("loadedmetadata",function(){MMChat.sharedScreenSize={width:this.videoWidth,height:this.videoHeight},MMChat.isScreenShare(MMChat.callType)&&(MMChat.videoSize=MMChat.sharedScreenSize,MMChat.api.isCameraOff()&&$('[videochatbutton][purpose="toggleCam"]').addClass("msi-vmute").attr("title",Resource.getRealValue("videochat.cameraon")),MMChat.updateMediaClasses()),$("body").removeClass("zcaudcall").addClass("zcvidcall"),MMChat.dom.sharedScreen.parents("[component=videocontainer]").show(),MMChat.runConnectedTransition(),MMChat.switchVideo($(MMChat.dom.sharedScreen[0]).parents("[component=videocontainer]"))}),MMChat.setVideoSource(MMChat.dom.sharedScreen,e)},handleStopSharing:function(){MMChat.log("handleStopSharing"),MMChat.resetScreenShareOpt(),MMChat.isScreenShare(MMChat.callType),$("body").removeClass("zc-vc-scrn-shr")},handleRemoteScreenShareStreamRemoved:function(){MMChat.log("handleRemoteScreenShareStreamRemoved"),MMChat.isScreenSharingEnabledInAVCall()&&$("[id=videochatvisiblearea]").removeClass("zc-scrn-shr-disabl");var e=MMChat.dom.sharedScreen.parents("[component=videocontainer]"),t=MMChat.dom.floatingDom.find(".zc-vc-tertiary-vid-cnt").not("#innerchat .zc-vc-tertiary-vid-cnt");if(e.hasClass("zc-vc-primary-vid-cnt"))t.css({left:"",top:""}),MMChat.switchVideo(t);else if(e.hasClass("zc-vc-secondary-vid-cnt")){t=e;var i=$(".zc-vc-tertiary-vid-cnt"),a=$(".zc-vc-secondary-vid-cnt");a.removeClass("zc-vc-secondary-vid-cnt").addClass("zc-vc-tertiary-vid-cnt"),i.removeClass("zc-vc-tertiary-vid-cnt").addClass("zc-vc-secondary-vid-cnt")}t.css({left:"",top:""}),MMChat.updateMediaClasses(),MMChat.correctVideoSize(),MMChat.dom.sharedScreen.attr("src",""),e.hide()},handleExtInstallSuccess:function(){ScreenShare.Extension.setStatusAsInstalled()},handleScreenOn:function(){},handleScreenOnButton:function(){},handleCameraOn:function(){}};var VideoChatMessageNotifier={handleVideoChat:function(){return MMChat.log("handleVideoChat"),!0},handleChatRequest:function(e,t,i,a,s,n){MMChat.log("handleChatRequest"),s=s?JSON.parse(s):{},(MMChat.isScreenShare(n)||MMChat.isAudioVideoCall(n))&&(a=n),MMChat.AnswerCall.show(e,i,a,s)},handleChatAnswered:function(e){MMChat.log("handleChatAnswered"),MMChat.AnswerCall.close(e)},handleCloseRequest:function(e,t){MMChat.log("handleCloseRequest"+e+" "+t),MMChat.AnswerCall.close(e)},handleBrowserNotSupported:function(){MMChat.log("handleBrowserNotSupported")}};SecurityManager.register(Modules.Media,MMChatUI.handleModuleStatusChange),MediaManager=function(){function e(){return"undefined"!=typeof WebRTCUserMedia}function t(t){function i(){"function"==typeof t&&t()}e()?i():$Util.loadMultipleFiles("script",$zcg._VIDEOCHATPROPS.MEDIACOMPONENTS_JS_LIST,i)}function i(e){var t="",i=[];if(e.hasPermissionToHostPrimeTime()&&$ZCVideoBroadcast.isPrimeTimeAllowed()&&i.push("videobroadcast"),e.hasPermissionToHostConference()&&(Conference.isAudioConferenceAllowed()&&i.push("audioconference"),Conference.isVideoConferenceAllowed()&&i.push("videoconference")),i.length){var a={videobroadcast:"zcf-broadcast",audioconference:"zcf-video-conf",videoconference:"zcf-video-conf",groupcall:"zcf-group-call"},s={videobroadcast:"videobroadcast.primetime",audioconference:"conference.audio.title",videoconference:"conference.video.title",groupcall:"media.video.group.call"},n='<div class="call-options grp-call-opts" id="{{group_call_type}}{{chid}}" purpose="options" data-purpose="{{data_purpose}}"><div><span class="{{group_call_icon}}" title="{{group_call_title}}"></span></div>{{drop_down}}</div>',r="",o=i[0],l="zcbroadcast";i.length>1&&(r='<div class="chtpopup call-drpdwn">',i.forEach(function(e){r+=$WC.template.replace('<div id="{{type}}{{chid}}" class="{{icon}} ellips" purpose="options" data-purpose="{{data_purpose}}">{{title}}</div>',{type:e,icon:a[e],$title:s[e],data_purpose:"videobroadcast"===e?l:""})}),l="",r+="</div>",o="groupcall"),t=$WC.template.replace(n,{drop_down:r},"InSecureHTML"),t=$WC.template.replace(t,{group_call_type:o,group_call_icon:a[o],group_call_title:$Util.getCustomTooltip(Resource.getRealValue(s[o]),"text",!1,"south"),chid:e.chid,data_purpose:l})}return t}function a(){return"undefined"!=typeof MMChat&&MMChat.isRunning||"undefined"!=typeof ConferenceImpl&&ConferenceImpl.hasCurrentSession()}return{isInitialized:e,initialize:t,isAnySessionRunning:a,getGroupCallOptionsHtmlForCwin:i}}();var InviteUsersToOrg={};InviteUsersToOrg={MAXIMUM_INVITES:100,Template:{popup:{popupUI:'<div id="inviteuserui" class="mcontent"><div class="lin22 font15">'+Resource.getRealValue("invite.users.body")+'</div><div id ="inputbox_textbox" class="userdetails posrel"></div><div id="chkerrorfield" class="chkerrorfield"></div><div id="inviteoptns" class="inviteoptns"><span id="multipleusersbtn">+ '+Resource.getRealValue("invite.users.add")+' <a class="cur" purpose="showtexteditor">'+Resource.getRealValue("invite.users.multiple.users")+"</a> </span> "+("windows"!==$Util.getOS()?"("+Resource.getRealValue("invite.users.or")+') <span><input purpose="uploadfile" listen="file" type="file"><a class="cur" >'+Resource.getRealValue("invite.users.upload")+"</a> ( "+Resource.getRealValue("invite.users.upload.csvfile")+" )</span>":"")+'</div><div class="brkline"></div><div class="footer"><span class="accnts cur msi-manage-org" purpose="manageorg">'+Resource.getRealValue("invite.users.manage.org")+'</span><div id="invitbtn" class="dbtn floatr" purpose="inviteusers">'+Resource.getRealValue("checklist.sendinvites")+"</div></div></div>",tableEditor:'<table id = "invite_inputbox"><tr><td><input content="fname" placeholder="Scott"></td><td class="posrel"><input listenevent=blur content="email" inputpurpose="invite_table" listen="keyup" placeholder="scott@{{domainnameorexample}}"></td></tr><tr><td><input content="fname" placeholder="Chloe"></td><td class="posrel"><input listenevent=blur content="email" inputpurpose="invite_table" listen="keyup" placeholder="chloe@{{domainnameorexample}}"></td></tr><tr><td><input content="fname" placeholder="Taichang"></td><td class="posrel"><input listenevent=blur content="email" inputpurpose="invite_table" listen="keyup" placeholder="taichang@{{domainnameorexample}}"></td></tr><tr><td><input content="fname" placeholder="Rebecca"></td><td class="posrel"><input listenevent=blur inputpurpose="invite_table" content="email" listen="keyup" placeholder="rebecca@{{domainnameorexample}}"></td></tr></table>',texteditor:'<textarea id="invite_textbox" inputpurpose="invite_textbox" listen="keyup" class="invitetxtbox font16" placeholder="Scott<scottfisher@{{domainnameorzylker}}>,Matta<matta@{{domainnameorzylker}}>" contenteditable=true></textarea>'}},createInviteUserPopUpUI:function(){$WC.$Win.create({id:"inviteuserui",header:'<div class="header"><strong>'+Resource.getRealValue("invite.users.title")+"</strong></div>",html:InviteUsersToOrg.Template.popup.popupUI,closeoutside:!0,"class":"zcinviteusers"}),$("#inviteuserui").find("#inputbox_textbox").append(InviteUsersToOrg.getTableDom()),InviteUsersToOrg.bindEvents()},getTableDom:function(){return InviteUsersToOrg.bindTableEditorDomEvents($($WC.template.replace(InviteUsersToOrg.Template.popup.tableEditor,{domainnameorexample:""!=$zcg._APPACCOUNTDOMAIN?$zcg._APPACCOUNTDOMAIN:"example.com"})))},getTextDom:function(){return InviteUsersToOrg.bindTextEditorDomEvents($($WC.template.replace(InviteUsersToOrg.Template.popup.texteditor,{domainnameorzylker:""!=$zcg._APPACCOUNTDOMAIN?$zcg._APPACCOUNTDOMAIN:"zylker.com"})))},bindTextEditorDomEvents:function(e){return e.on("keydown",function(){var t=this.value;if(13===event.which)event.shiftKey||event.preventDefault();else if(32===event.which)event.preventDefault(),InviteUsersToOrg.checkAndAddComma(this);else if(""===this.value)$("#invite_error").remove(),$("#chkerrorfield").empty();else{var i=e.parent().parent().find("#invitbtn"),a=InviteUsersToOrg.parseMailids(t);a.valid.length>0?i.text(Resource.getRealValue("checklist.inviteall")).removeAttr("disable"):i.text(Resource.getRealValue("checklist.sendinvites")).attr("disable",!0)}}).on("paste",function(){var t=$(this),i=setTimeout(function(){var a=InviteUsersToOrg.parseMailids(t.val());t.val(""),InviteUsersToOrg.populateTextBox(a,!0,e),clearTimeout(i)},100);event.stopImmediatePropagation()}),e},bindTableEditorDomEvents:function(e){return e.find("[listen='keyup']").on("keyup keydown",function(t){var i=this.getAttribute("inputpurpose");if("keyup"===t.type&&"invite_table"===i){var a=$(this),s=a.val();if($WC.Matcher.check("emailid",s)||""===s){var n=a.parent();n.hasClass("msi-alert")&&(n.removeClass("msi-alert"),$("#chkerrorfield").empty())}var r=$("#invitbtn"),o=InviteUsersToOrg.getDataFromTable(!1,e);o.valid.length>0?r.text(Resource.getRealValue("checklist.inviteall")).removeAttr("disable"):r.text(Resource.getRealValue("checklist.sendinvites")).attr("disable",!0)}}),e.find("[listenevent=blur]").on("blur",function(){InviteUsersToOrg.getDataFromTable(!0,e)}),e},bindEvents:function(){var e=$("#inviteuserui");e.on("click","[purpose]",function(){var e=this.getAttribute("purpose");"manageorg"===e?(window.open($zcg._ADMINCONSOLEURL),$WC.$Win.closeAll()):"showtexteditor"===e?(InviteUsersToOrg.showTextBox(InviteUsersToOrg.getDataFromTable(),!0),$("#chkerrorfield").empty()):"inviteusers"===e&&InviteUsersToOrg.sendinvitations($("#inviteuserui").find("#invite_inputbox").length?InviteUsersToOrg.getDataFromTable(!0):InviteUsersToOrg.getDatafromtextbox(!0))}),e.find("[purpose='uploadfile']").on("change",function(e){InviteUsersToOrg.populatedatafromfile(e,this.files,!0),$("#chkerrorfield").empty()})},showTextBox:function(e,t){if(!$("#inviteuserui").find("#invite_textbox").length&&t){$("#multipleusersbtn").hide();var i=$("#inputbox_textbox");i.fadeOut("fast",function(){i.html(InviteUsersToOrg.getTextDom()).fadeIn("fast",function(){e&&InviteUsersToOrg.populateTextBox(e,t)})})}else e&&InviteUsersToOrg.populateTextBox(e,t)},populateTextBox:function(e,t,i){var a=e.valid,s=a.length;s>InviteUsersToOrg.MAXIMUM_INVITES&&(a=a.slice(0,InviteUsersToOrg.MAXIMUM_INVITES));for(var n=i?i:$("#invite_textbox"),r=n.val(),o=0;s>o;o++)r+=a[o].fname?a[o].fname+"<"+a[o].email+">,":a[o].email+", ";n.val(r),e.invalid&&e.invalid.length&&t&&($("#invite_error").remove(),InviteUsersToOrg.showErrorOnInvite(InviteUsersToOrg.constructInviteErrorHTML(e.invalid)))},getDataFromTable:function(e,t){for(var i=t?t.find("tr"):$("#invite_inputbox").find("tr"),a=i.length,s={valid:[],invalid:[]},n=0;a>n;n++){var r=$(i[n]),o={};o.fname=r.find("[content='fname']").val();var l=r.find("[content='email']");if(o.email=l.val().trim(),""!==o.email)if($WC.Matcher.check("emailid",o.email))s.valid.push(o);else{if(e)return l.parent().addClass("msi-alert"),void l.focus();s.invalid.push(o.email)}}return s},getDatafromtextbox:function(e){var t=$("#invite_textbox").val();if(t=$.trim(t),t.length>0){var i=InviteUsersToOrg.parseMailids(t);return i.invalid.length&&e&&($("#invite_error").remove(),InviteUsersToOrg.showErrorOnInvite(InviteUsersToOrg.constructInviteErrorHTML(i.invalid))),i}return e?($("#invite_error").remove(),void InviteUsersToOrg.showErrorOnInvite(Resource.getRealValue("checklist.invite.empty"))):void 0},populatedatafromfile:function(e,t,i,a){var s=function(){$("#inviteoptns").find("[purpose='uploadfile']").val("")};if(t.length>0){var n=t[0];if("text/csv"===n.type){var r=new FileReader;r.onload=function(e){var t=e.target.result;if(""!==t){ZCTrack.track("INVITE_USER_THROUGH_FILE");var n=InviteUsersToOrg.parseMailids(t),r=a||InviteUsersToOrg.getDataFromTable(!1);r.valid.length&&(n.valid=n.valid.concat(r.valid)),InviteUsersToOrg.showTextBox(n,i),i||CheckList.handleErrorOnFileuploadInviteUser(n)}else InviteUsersToOrg.showErrorOnInvite(Resource.getRealValue("invite.users.error.emptyfile"));s()},r.onerror=function(){s()},r.readAsText(n)}else i&&InviteUsersToOrg.showErrorOnInvite(Resource.getRealValue("invite.users.choosevalidfile")),s()}},parseMailids:function(){function e(e){return'"'===e.charAt(0)&&(e=e.substring(1)),'"'===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e}function t(t,i){for(var a=t.split(","),s=0,n=a.length;n>s;s++){var r=$.trim(a[s]).split("<"),o={};if(1===r.length){var l=r;if(""===l[0])return;$WC.Matcher.check("emailid",l[0])?(o.email=l[0],i.valid.push(o)):i.invalid.push(l[0])}else{var c=r[1].slice(0,r[1].length-1);c.length>0&&(c=e(c),$WC.Matcher.check("emailid",c)?(o.fname=r[0],o.email=c,i.valid.push(o)):i.invalid.push(c))}}}return function(e){for(var i={valid:[],invalid:[]},a=e.split(/\r\n|\s|\n/),s=0,n=a.length;n>s;s++){var r=a[s];$.trim(r).length>0&&t(r,i)}return i.valid.length&&(i.valid=InviteUsersToOrg.removeDuplicateEntries(i.valid)),i}}(),sendinvitations:function(e){if(e&&e.valid&&e.valid.length){var t={userslist:JSON.stringify(e.valid),onboardingstepkey:"invite_member"};$ZCAjx.ajax({url:"/inviteuserstoorg.do",type:"POST",data:t,success:function(){"1"!==$zcg.ADMIN_ONBOARDING_STEPS.invite_member&&CheckList.markInviteMemberComplete(),OrgInvitees.getOrgInviteesForLHS(),UI.updateBanner(Resource.getRealValue("invite.users.success"),2e3,!1),$WC.$Win.closeAll()},error:function(){$WC.$Win.closeAll()}})}else if($("#inviteuserui").find("#invite_inputbox").length){var i='<div class="email_check">'+Resource.getRealValue("checklist.invite.empty")+"</div>";$("#chkerrorfield").html(i)}},constructInviteErrorHTML:function(e){for(var t='<span class="invalid dIB cur posrel">'+Resource.getRealValue("checklist.emailaddresses")+'<div class="mail_ttip">{{EMAILADDRESSES}}</div></span>',i="<ul>",a=0,s=e.length;s>a;a++)i+="<li>"+$WC.$CUtil.processXSS(e[a])+"</li>";return i+="</ul>",t=t.replace(/{{EMAILADDRESSES}}/g,i),t=Resource.getRealValue("invite.users.error",[t])},showErrorOnInvite:function(e){var t='<span id="invite_error" class="alertbx msi-alert">'+e+"</span>";$("#inputbox_textbox").prepend(t)},checkAndAddComma:function(e){var t=e.value,i=e.selectionStart,a=e.selectionEnd;e.value=t.slice(0,i)+","+t.slice(a),e.selectionStart=e.selectionEnd=i+1},removeDuplicateEntries:function(e,t){var i=[];return t&&(e=e.sort()),$.each(e,function(e,t){-1==$.inArray(t,i)&&i.push(t)}),i}};var CRCHandler=function(e,t,i){var a=this._status.NOT_IN_SYNC;_defineReadOnlyProperties(this,t),_defineReadOnlyProperties(this,{_name:e,_callback:i}),this.getSyncStatus=function(){return a},this._setSyncStatus=function(e){a=e}};CRCHandler.prototype={markAsNotInSync:function(){this._setSyncStatus(this._status.NOT_IN_SYNC)},sync:function(){this.getSyncStatus()!==this._status.SYNCED?this._makeSyncRequest():"function"==typeof this._callback.afterSync&&this._callback.afterSync()},_status:{NOT_IN_SYNC:0,SYNCED:1},_markAsSynced:function(){this._setSyncStatus(this._status.SYNCED)},_getList:function(){return $DB.get(this._name).list||{}},_updateData:function(e){var t={list:e};$DB.update(this._name,t),this._markAsSynced()},_makeSyncRequest:function(){var e=this;$ZCAjx.ajax({url:e.api,headers:{"X-Checksum":Crc32.calculateChecksum(e._getList())},success:function(t){e._fetchMismatchedData(t)},cacheCallback:function(){e._markAsSynced(),e._callback.afterSync()}})},_fetchMismatchedData:function(e){var t=e.data.id_vs_checksum,i=[],a=this._getList();for(var s in t)("undefined"==typeof a[s]||a[s].checksum!==t[s])&&i.push(s);for(var s in a)"undefined"==typeof t[s]&&delete a[s];var n={},r=this;i.length>0&&$ZCAjx.ajax({url:this.api,data:{ids:i.toString(",")},success:function(e){$.extend(a,e.data.list);for(var t in a)n[a[t].id]=a[t];r._updateData(n),r._callback.afterSync()}})}};var Crc32=function(){var e={},t=function(t){var i=-1;for(var a in t){var s=255&(i^t.charCodeAt(a));if(s="undefined"!=typeof e[""+s]?e[""+s]:s,255>=s>>>0){for(var n=0;8>n;n++)s=s>>>1^3988292384*(1&s);e[""+(255&(i^t.charCodeAt(a)))]=s>>>0}i=i>>>8^s>>>0}return~i>>>0};return{calculateChecksum:function(e){var i=[];for(var a in e)i.push(""+e[a].detailschecksum);return i.sort(),t(i.join(""))}}}(),ProfileMenu={},ProfileMenuUI={};ProfileMenuUI={htmls:{header:'<div class="zc-usermenuheader"><div purpose="closerhswin" class="msi-chtclose cur"></div><div class="cuserimg mrgT25 dIB posl"><div class="usrimg" type="imgpreview"><img id="userprofileimgview" src="'+$zcg._PHOTOSERVER+"/file?fs=thumb&nocache="+Date.now()+'"></div><input type="file" id="profilephotochange" name="photo" class="sendfile" accept="image/*"><span class="zuserimgchng msi-camera posa"></span></div><div class="usrdetails ellips username bold">'+$WC.$CUtil.processXSS($zcg._USERFULLNAME,!0)+'</div><div class="ellips useremail" title="'+$zcg._EMAILID+'">'+$zcg._EMAILID+'</div><div class="ellips font13 mrgT10"><span class="mrgR5 myaccntlink hvrinfo"><a href="'+$zcg._ACCOUNTSURL+'" target="_blank">'+Resource.getRealValue("profileview.accounts.title")+'</a></span><span class="dot"></span><span documentclick="logout" type="button" class="signout hvrinfo cur mrgL5">'+Resource.getRealValue("profileview,accounts.signout")+'</span></div><div id="userstatusdetails" class="userstatusui mrgT15 mrgB10"><div class="scodestatus dIB" id="statusoptionscont" showstatusoptions><div id="currentscode" class="msi-dwnarw cur"><span class="status zcstatus-1 dsinblk"></span></div><div id="statusoptions" class="scodeoptions font13 posa"><div scode="1" purpose="setscode" smsg="'+Resource.getRealValue("common.available")+'" class="cur"><span class="status zcstatus-1 dsinblk mrgR10"></span><span class="font14 ellips">'+Resource.getRealValue("common.available")+'</span></div><div scode="3" purpose="setscode" smsg="'+Resource.getRealValue("common.busy")+'" class="cur"><span class="status zcstatus-3 dsinblk mrgR10"></span><span class="font14 ellips">'+Resource.getRealValue("common.busy")+'</span><div class="mrgT5 mrgL20 font12 clr8">'+Resource.getRealValue("profileview.busy.desc")+'</div></div><div scode="2" purpose="setscode" smsg="'+Resource.getRealValue("common.invisible")+'" class="cur"><span class="status zcstatus-2 dsinblk mrgR10"></span><span class="font14 ellips">'+Resource.getRealValue("common.invisible")+'</span><div class="mrgT5 mrgL20 font12 clr8">'+Resource.getRealValue("profileview.invisible.desc")+'</div></div></div></div><div id="custstatusmsg" class="statusmsg dIB "><input id="stmsgeditor"/><span id="showcstmoptns" class="icnoptns msi-dwnarw"></span><div id="statusmsgsugg" class="smsgoptions font13 posa"><ul id="statusmsg"></ul></div></div></div></div>',checklist:'<div purpose="checklist" class="zc-userchecklist"><div class="liststatus"><div class="font16"><span data-purpose="remainingcount">3/5</span><span class="font12 mrgL5 clr6">'+Resource.getRealValue("checklist.completed")+'</span></div><div data-purpose="checkliststatusui" class="liststatus-countr"><em></em><em></em><em></em><em></em><em></em></div></div><div purpose="openchecklist" class="setupcliq cur">'+Resource.getRealValue("profileview.checklist.setup")+"</div></div>",mycliq:'<div purpose="mycliq" class="zc-usersubsection"><div class="header">'+Resource.getRealValue("profileview.mycliq.header")+'</div><div class="options"><div purpose="personalize"><span class="msi-personalize"></span><span class="ellips">'+Resource.getRealValue("common.settings")+'</span></div><div purpose="pendinginvites"><span class="msi-pendinginv"></span><span class="ellips" title="'+Resource.getRealValue("profileview.mycliq.pendinginvites")+'">'+Resource.getRealValue("profileview.mycliq.pendinginvites")+"</span></div>"+(_isAppAccountAdmin()||""===$zcg._MARKETPLACEURL?"":'<div purpose="marketplace"><span class="msi-marketplace"></span><span class="ellips" title="'+Resource.getRealValue("profileview.marketplace")+'">'+Resource.getRealValue("profileview.marketplace")+"</span></div>")+"</div></div>",myorganization:'<div purpose="myorganization" class="zc-usersubsection myorg"><div class="header">'+Resource.getRealValue("profileview.myorg.header")+'</div><div class="options"><div purpose="adminpanel"><span class="msi-adminpanel"></span><span class="ellips" title="'+Resource.getRealValue("checklist.completedui.adminpanel")+'">'+Resource.getRealValue("checklist.completedui.adminpanel")+"</span></div>"+($zcg._ISCREATEPEOPLE_ENABLED?'<div purpose="create_orgdirectory"><span class="msi-people"></span><span class="ellips">'+Resource.getRealValue("profileview.orgdirectory")+"</span></div>":"")+(_isDesktopApp()||"true"!=$zcg._ISORGOWNER&&"true"!=$zcg._ISAPPACCOUNTOWNER||0==$zcg._PLANDETAILS.planId?"":'<div purpose="subscription"><span class="msi-subscription"></span><span class="ellips">'+Resource.getRealValue("common.subscription")+"</span></div>")+(_isAppAccountAdmin()&&""!==$zcg._MARKETPLACEURL?'<div purpose="marketplace"><span class="msi-marketplace"></span><span class="ellips">'+Resource.getRealValue("profileview.marketplace")+"</span></div>":"")+"{{slackmigrationhtml}}{{hipchatmigrationhtml}}</div></div>",slackmigrationhtml:'<div purpose="slackmigration"><span class="slackicon"><img src="/officechat/images/slacklogo.svg"></span><span class="ellips">'+Resource.getRealValue("common.imports.migratefrom")+"&nbsp;"+Resource.getRealValue("common.imports.slack")+"</span></div>",hipchatmigrationhtml:'<div purpose="slackmigration"><span class="msi-migrdata"></span><span class="ellips">'+Resource.getRealValue("common.imports.migratedata")+"</span></div>",helpguide:'<div purpose="guide" class="zc-usersubsection userguide"><div class="header">'+Resource.getRealValue("profileview.help.header")+'</div><div class="options">'+(""!==$zcg._WHATSNEWLINK?'<div purpose="whatsnewlink"><span class="msi-whatsnew"></span><span class="ellips">'+Resource.getRealValue("announcement.forum.title")+"</span></div>":"")+'<div purpose="cliqresources"><span class="msi-cliqresources"></span><span class="ellips">'+Resource.getRealValue("profileview.help.cliqresources")+"</span></div>"+(""!==$zcg._WEBINARLINK?'<div purpose="webinars"><span class="msi-webinar"></span><span class="ellips">'+Resource.getRealValue("profileview.help.webinars")+"</span></div>":"")+'<div purpose="keyboardshortcuts"><span class="msi-keyboard"></span><span class="ellips">'+Resource.getRealValue("profileview.help.shortcuts")+'</span></div><div purpose="feedback"><span class="msi-feedback"></span><span class="ellips" title="'+Resource.getRealValue("profileview.help.sendfeedback")+'">'+Resource.getRealValue("profileview.help.sendfeedback")+"</span></div></div></div>",darkmode_html:'<div id="darkmode_head" class="zc-mycliqapps"><div class="flexC fjustifySB"><div class="font14 clr6">{{dark_mode}}<span id="darkmode_loader" class="darkmodeldr mL10 reqprocess_anim hide"></span></div><label class="switch-btn"><input purpose="darkmode_setting" type="checkbox" {{checked_cls}}><span id="darkmode_slider" class="slider"><em></em></span></label></div></div>',darkmode_tourhtml:'<div id="darkmode_tour" class="onboardtour whitebgtour" data-position="RT" module="darkmode"><span class="close-icon zcf-close" purpose="close_darkmodetour"></span><span class="darkmode-newtxt">{{darkmode_new}} <span class="zcslymsg-fireworks" ></span></span><div><img src="'+$Util.getImgStaticUrl()+'/nightmode_tour.svg" class="darkmode-tour-img"></div><div class="pLR10"><div class="tour-title font16 fontb">{{darkmode_intro}}</div><div class="tour-desc clr6 font14 line22 mT10">{{darkmode_desc}} </div></div></div>',mobileapps:'<div purpose="cliqapps" class="zc-mycliqapps"><div class="mobileapps dispflex"><span class="font13">'+Resource.getRealValue("common.mobile")+'</span><a target="_blank" href="'+$zcg._APPSTOREURL+'"><span class="msi-macstore font15" title="'+Resource.getRealValue("common.ios")+'"></span></a><a target="_blank" href="'+$zcg._PLAYSTOREURL+'"><span class="msi-plystore font15" title="'+Resource.getRealValue("common.android")+'"></span></a></div><div class="desktopapps dispflex"><span class="font13">'+Resource.getRealValue("common.desktop")+'</span><a target="_blank" class="'+("mac"===$Util.getOS()?"sel":"")+'" href="'+$zcg._MACAPPURL+'"><span class="msi-macstore font15" title="'+Resource.getRealValue("profileview.desktop.mac")+'"></span></a><a target="_blank" class="'+("windows"===$Util.getOS()?"sel":"")+'" href="'+$zcg._WINDOWSAPPURL+'"><span class="msi-windws font15" title="'+Resource.getRealValue("profileview.desktop.windows")+'"></span></a><a target="_blank" class="'+("linux"===$Util.getOS()?"sel":"")+'" href="'+$zcg._LINUXAPPURL+'"><span class="msi-ubuntu font15" title="'+Resource.getRealValue("profileview.desktop.linux")+'"></span></a></div></div>',pendinginvitesempty:'<div class="emptystate dispflex"><div>'+Resource.getRealValue("contact.invitations.empty")+"</div></div>",recentstories:'<div purpose="recentstoriesUI" overlay class="zc-recentstories"><div id="recentstoriesheader" class="header"><span purpose="closeoverlay" class="msi-bckarw cur"></span>'+Resource.getRealValue("profileview.help.recentstories")+'</div><div class="storieslist"><div><div class="zcloadblogimg"></div><div class="details"><div class="blogtitle zcloadblogtitle"></div><div class="blogdetails zcloadblogdetails"></div></div></div><div><div class="zcloadblogimg"></div><div class="details"><div class="blogtitle zcloadblogtitle"></div><div class="blogdetails zcloadblogdetails"></div></div></div><div><div class="zcloadblogimg"></div><div class="details"><div class="blogtitle zcloadblogtitle"></div><div class="blogdetails zcloadblogdetails"></div></div></div></div></div>',feedbackui:'<div purpose="feedbackUI" overlay class="zc-feedbackui"><div id="feedbackheader" class="header"><span purpose="closeoverlay" class="msi-bckarw cur"></span>'+Resource.getRealValue("profileview.help.sendfeedback")+'</div><div id="feedbackfaqs">{FAQHTML}</div><div id="feedbackcomposer" class="mrgT40">{FEEDBACKCOMPOSER}</div></div>',feedbackuiadminfaqshtml:'<div class="subheader">'+Resource.getRealValue("profileview.feedback.faqheader")+'</div><div class="faqlist subsection"><div><a target="_blank" href="'+$zcg._PRICINGPAGELINK+'">'+Resource.getRealValue("profileview.adminfaq.faq1")+"</a></div>"+($WC.$CUtil.isEmpty($zcg._SMARTCHATHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._SMARTCHATHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.adminfaq.faq2")+"</a></div>")+($WC.$CUtil.isEmpty($zcg._CHANNELSHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._CHANNELSHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.adminfaq.faq3")+"</a></div>")+($WC.$CUtil.isEmpty($zcg._MARKETPLACEHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._MARKETPLACEHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.adminfaq.faq4")+"</a></div>")+($WC.$CUtil.isEmpty($zcg._BOTSHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._BOTSHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.adminfaq.faq5")+"</a></div>")+'<div class="adminguidelinks">'+Resource.getRealValue("profileview.feedback.faqmore")+"&nbsp;"+Resource.getRealValue("common.on")+'&nbsp;<a target="_blank" href="'+$zcg._ADMINGUIDELINK+'">'+Resource.getRealValue("profileview.feedback.adminguide")+'</a>&nbsp;&vert;&nbsp;<a target="_blank" href="'+$zcg._USERGUIDELINK+'">'+Resource.getRealValue("profileview.feedback.userguide")+"</a></div></div>",feedbackuiuserfaqshtml:'<div class="subheader">'+Resource.getRealValue("profileview.feedback.faqheader")+'</div><div class="faqlist subsection">'+($WC.$CUtil.isEmpty($zcg._SMARTCHATHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._SMARTCHATHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.adminfaq.faq2")+"</a></div>")+($WC.$CUtil.isEmpty($zcg._FORMATHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._FORMATHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.usersfaq.faq1")+"</a></div>")+($WC.$CUtil.isEmpty($zcg._LHSHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._LHSHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.usersfaq.faq2")+"</a></div>")+($WC.$CUtil.isEmpty($zcg._EVENTSHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._EVENTSHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.usersfaq.faq3")+"</a></div>")+($WC.$CUtil.isEmpty($zcg._BOTSHELPLINK)?"":'<div><a target="_blank" href="'+$zcg._BOTSHELPLINK+'?utm_source=Product&utm_medium=links&utm_campaign=rhs_feedback">'+Resource.getRealValue("profileview.adminfaq.faq5")+"</a></div>")+'<div class="userguidelinks"><a target="_blank" class="zcunderlin" href="'+$zcg._USERGUIDELINK+'">'+Resource.getRealValue("profileview.feedback.faqmore")+"..</a></div></div>",feedbackuicomposerhtml:'<div class="subheader">'+Resource.getRealValue("profileview.feedback.desc")+'</div><div class="subsection fdbkcnt fdbk"><div class="ellips zccsugg">'+Resource.getRealValue("feedback.info")+'</div><div id="feedbackcomment" class="tatext contentarea" placeholder="'+Resource.getRealValue("feedback.add.info")+'" contenteditable="true"></div><div class="zcfdbkbt">'+Template.UploadFile.replace(/{UPLOADCLASS}/g,"msi-atchmnd floatl").replace(/{FILEPICKERDESKTOP}/g,Template.FilePickerDesktop).replace(/{CHID}/g,"")+'<div class="upldfiles"><div type="filelist" class="dispflex"></div><div class="attchtext dN">'+Resource.getRealValue("feedback.add.attachment")+'</div></div><input id="feedbacksubmit" purpose="submit" type="button" class="adbtn" value="'+Resource.getRealValue("common.send")+'"></div></div>',feedbackuisuccessstatushtml:'<div class="subheader">'+Resource.getRealValue("profileview.feedback.desc")+'</div><div class="subsection completed"><div class="successimg"></div><div class="infothnksmsg bold">'+Resource.getRealValue("profileview.feedback.thanks")+'</div><div class="infodescsmsg">'+Resource.getRealValue("profileview.feedback.thanksinfo")+'</div><div purpose="openfeedbackcomposer" class="opencomposer cur">'+Resource.getRealValue("profileview.feedback.sendagain")+"</div></div></div>"},acceptorrejectinvite:function(e,t){var i=$("#accountmenu").find("[pendinginvitesUI]");if(0!==i.length){var a=i.find("#pending"+e);if(a.length>0){var s=Resource.getRealValue("accept"===t?"contact.pendinginvite.accepted":"contact.pendinginvite.declined"),n="accept"===t?"clraccpt":"clrrejct",r=a.find("#additionalinfo"),o=a.find("#cntoperations");if(r.html(s).addClass(n),"accept"===t){var l='<span class="msi-chat pdbtn mrgL10" purpose="startchat" uid="'+e+'" title="'+Resource.getRealValue("common.click.continue")+'"></span>';o.html(l).fadeIn(300)}else"reject"===t&&(o.html("").fadeIn(300),setTimeout(function(){a.slideUp(300,function(){$(this).remove(),0===$.trim($("#pendinglist").html()).length&&$("#pendingheader").after(ProfileMenuUI.htmls.pendinginvitesempty)})},3e3))}}},openrecentstories:function(){var e=ProfileMenuUI.htmls.recentstories,t=$("#accountmenu").find("#usermenu");t.after(e);var i=$("#accountmenu").find('[purpose="recentstoriesUI"]');i.addClass("show")},updateChecklistStatus:function(){var e=CheckList.getRemainingSteps();if(e>0){var t=CheckList.getChecklistArray().length,i=t-e,a=$('[data-purpose="checkliststatusui"] em');if(i>0)for(var s=0;i>s;s++)a.eq(s).addClass("chksel");$('[data-purpose="remainingcount"]').html(i+"/"+t)}},updateUI:function(){"fuji"!==$zcg._BRAND&&UI.FeedBack.loadChat(),0===Contacts.getPendingContactsList().length&&$('[purpose="pendinginvites"]').remove(),ProfileMenuUI.updateChecklistStatus(),StatusUI.updateDefaultStatus(),StatusController.get(!0)},getFooterHtml:function(){var e="";return SecurityManager.hasPermission(Modules.DarkMode)&&(e=$WC.template.replace(ProfileMenuUI.htmls.darkmode_html,{checked_cls:Settings.getFromObj("darkmode")?"checked":"",$dark_mode:"profileview.theme.darkmode"})),!_isDesktopApp()&&_isMobileAppEnabled()&&(e+=ProfileMenuUI.htmls.mobileapps),$WC.$CUtil.isEmpty(e)?e:'<div class="zc-profilefootr">'+e+"</div>"},getProfileHtml:function(){var e=ProfileMenuUI.htmls.header;0!==CheckList.getRemainingSteps()&&(e+=ProfileMenuUI.htmls.checklist),e+=ProfileMenuUI.htmls.mycliq,_isAppAccountAdmin()&&(e+=ProfileMenuUI.htmls.myorganization),e+=ProfileMenuUI.htmls.helpguide,e='<div class="zc-usermenucontainer">'+e+"</div>",e+=ProfileMenuUI.getFooterHtml();var t=_isAppAccountAdmin()&&SecurityManager.hasPermission(Modules.HipchatMigration)?ProfileMenuUI.htmls.hipchatmigrationhtml:"";return e=$WC.template.replace(e,{slackmigrationhtml:_isAppAccountAdmin()&&SecurityManager.hasPermission(Modules.SlackMigration)&&$WC.$CUtil.isEmpty(t)?ProfileMenuUI.htmls.slackmigrationhtml:"",hipchatmigrationhtml:t},"InSecureHTML")}},ProfileMenu={init:function(e){var t=$("#rhssection"),i='<div id="accountmenu"><div id="usermenu" >'+ProfileMenuUI.getProfileHtml()+"</div></div>";t.empty().html(i),ProfileMenuUI.updateUI(),Clickoutside.bind({srcid:"ztb-profile",event:e,customShow:function(){$("#rhssection").addClass("zc-profilemenushow")},destid:"accountmenu",customHide:function(){$("#rhssection").removeClass("zc-profilemenushow")}}),ProfileMenu.isDarkmodeTourAvail()&&Clickoutside.bind({srcid:"accountmenu",event:e,destid:"darkmode_head",customShow:function(){var e='<div class="touranim" module="darkmode"></div>';$(e).insertBefore('[purpose="darkmode_setting"]'),$("#darkmode_head").append(ProfileMenu.getDarkmodeTourHtml())},customHide:function(){ProfileMenu.closeDarkmodeTour()}}),ZCTrack.track("RHS_ACTION",{TRIGGER:"RHS Opened"}),StatusUI.init(),this.bindEvents()},loadDarkModeFiles:function(e){var t=""===$zcg._CSSTATICURL?"/officechat/styles/mpchat/darkmode.css":$zcg._CSSTATICURL+"/officechat/styles/darkmode_min.css";$Util.loadDynamicFiles({type:"link",url:t,callback:function(){"function"==typeof e&&e()}})},bindEvents:function(){var e=$("#accountmenu");e.on("click","[purpose]",function(e){var t=$("#accountmenu"),i=$(this).attr("purpose");if("personalize"===i)PersonalizeUI.createWindow(),Clickoutside.handleClickOnChild(e);else if("pendinginvites"===i)ContactsUI.showPendingRequests();else if("adminpanel"===i)ZCTrack.track("MANAGE"),window.open($zcg._ADMINCONSOLEURL);else if("subscription"===i)ZCTrack.track("UPGRADE"),window.open($WC.$CUtil.isEmpty($zcg._ZOHOONE_SUBSCRIPTION_URL)?"fuji"==$zcg._BRAND?$zcg._PLANDETAILS.paymentsURL:Plan.getPaymentUpgradeURL():$zcg._ZOHOONE_SUBSCRIPTION_URL);else if("marketplace"===i)ZCTrack.track("MARKETPLACE_APPSLINK"),window.open($zcg._MARKETPLACEURL);else if("slackmigration"===i)window.open("/migrate.do");else if("create_orgdirectory"===i)$zcg._ISVALIDPEOPLEUSER?OrgDirectory.syncUsers():OrgDirectory.createUI(),Clickoutside.handleClickOnChild(e);else if("whatsnewlink"===i)window.open($zcg._WHATSNEWLINK);else if("recentstories"===i)ProfileMenuUI.openrecentstories();else if("cliqresources"===i)ZCTrack.track("RHS_ACTION",{TRIGGER:"User HelpDocs"}),window.open($zcg._HELPDOCLINK);else if("webinars"===i)ZCTrack.track("RHS_ACTION",{TRIGGER:"Webinar"}),window.open($zcg._WEBINARLINK);else if("keyboardshortcuts"===i)UI.KeyboardShortcuts.createwin(),Clickoutside.handleClickOnChild(e);else if("feedback"===i)UI.FeedBack.constructUI();else if("chatwithus"===i)Clickoutside.handleClickOnChild(e),$zoho.salesiq.floatwindow.visible("show");else if("close_darkmodetour"===i)ProfileMenu.closeDarkmodeTour();else if("darkmode_setting"===i){var a=$("#darkmode_loader");ProfileMenu.isDarkmodeTourAvail()&&ProfileMenu.closeDarkmodeTour(),this.checked?(a.removeClass("hide"),ProfileMenu.loadDarkModeFiles(function(){Settings.update({darkmode:1},function(){ProfileMenu.darkmodeToggle(a)})})):(a.removeClass("hide"),Settings.update({darkmode:0},function(){ProfileMenu.darkmodeToggle(a)}))}else if("acceptinvite"===i){var s=this.getAttribute("uid");Contacts.acceptorreject(s,"accept",ProfileMenuUI.acceptorrejectinvite(s,"accept"),!0)}else if("declineinvite"===i){var s=this.getAttribute("uid");Contacts.acceptorreject(s,"reject",ProfileMenuUI.acceptorrejectinvite(s,"reject"),!0)}else if("startchat"===i){Clickoutside.handleClickOnChild(e);var s=this.getAttribute("uid");Chat.create(s,"im")}else if("closeoverlay"===i){var n=t.find("[overlay]");n.fadeOut(300,function(){$(this).remove()})}else if("closerhswin"===i)Clickoutside.handleClickOnChild(e);else if("openchecklist"===i)Clickoutside.handleClickOnChild(e),CheckList.populateOnbardingCheckListUI(),MainUI.getMefront("home",!0);else if("openfeedbackcomposer"===i){var r=ProfileMenuUI.htmls.feedbackuicomposerhtml,o=$("#accountmenu").find('[purpose="feedbackUI"]');o.find("#feedbackcomposer").html(r).fadeIn(300,function(){$("#feedbackcomment").focus(),UI.FeedBack.bindEvents(o)})}e.stopImmediatePropagation()}),e.find("#profilephotochange").on("change",function(){var t=e.find("[type='imgpreview']"),i=this.files[0],a=10;if("undefined"!=typeof i){if(!$Util.isValidImage(this,this.files,a))return;$Util.imgPrview(t,i,'previewelem documentclick="viewattachment" class="cur"');var s=[[i]],n={};n.dname=$zcg._USERNICKNAME;var r=$ZCAjx.formData(n,"photo",s,!0);$(this).removeClass("zcloadling"),$ZCAjx.ajax({url:"updateuserprofile.do",type:"POST",processData:!1,contentType:!1,data:r,success:function(){$(this).removeClass("zcloadling");var e=$zcg._PHOTOSERVER+"/file?fs=thumb&nocache="+Date.now();$("#ztb-profile-image").attr("src",e),$("#accountmenu").find("#userprofileimgview").attr("src",e),$('[module="set_user_profile"]').find('[type="imgpreview"] img').attr("src",e)}})}})},darkmodeToggle:function(e){e.addClass("hide"),UI.Theme.updateTheme()},closeDarkmodeTour:function(){Settings.update({darkmodetourversion:"v1"}),$('[module="darkmode"]').remove()},triggerDarkmodeTour:function(){if(!Tour.isNewTourAvailable("one2onechat")&&!Tour.isNewTourAvailable("adhocchat")&&!Tour.isNewTourAvailable("channels")){var e='<div class="touranim" data-purpose="tour_animated" module="darkmode"></div>';$('[purpose="userimage"]').prepend($(e))}},isDarkmodeTourAvail:function(){return SecurityManager.hasPermission(Modules.DarkMode)&&!Settings.getFromObj("darkmode")&&"v0"===Settings.getFromObj("darkmodetourversion",!0)},getDarkmodeTourHtml:function(){return $WC.template.replace(ProfileMenuUI.htmls.darkmode_tourhtml,{$darkmode_intro:"profileview.darkmodetour.intro",$darkmode_new:"common.new",$darkmode_desc:"profileview.darkmodetour.desc"})}};var MessageContextParser={},DateTimeParser={};DateTimeParser=function(){function e(e,t){var i=/\s(on|at|of)|(st|nd|rd|th)\b/gi,e=e.replace(i," ").trim(),a="10",s="00",n=e.match(A);n&&n[0].trim()==e&&(e=e+" "+(new Date).getFullYear());var r=Date.parse(e);if(isNaN(r)){var o,l=/(1[012]|0?[1-9])([.:])?([0-5][0-9])?\s?(pm|am)/i,c=e.match(l),d=e.match(new RegExp(u,"i")),p=e.match(new RegExp(m,"i")),h=e.match(S);(!h&&e.match($)||h&&h[0].substring(0,h[0].replace(/[./-]/,"$").indexOf("$")).length<2)&&(o=e.match($));var g,f=a,v=s,C=new Date(t);if(d){var y=d[0].toLowerCase();switch(y){case"tomorrow":case"day after today":C.addDays(1),g=C.getTime();break;case"day after tomorrow":case"overmorrow":C.addDays(2),g=C.getTime();break;case"next week":case"coming week":case"upcoming week":case"following week":C.addDays(7),g=C.getTime();break;default:var b=EventsUI.getTimeToPopulate();$Date.isSameDay(t,b)&&(g=b,C=new Date(g),f=C.getHours(),v=C.getMinutes())}}if(p){var E=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],I=p[0].toLowerCase();I.includes("next")?(I=I.replace("next ",""),C.setDate(C.getDate()+(7-C.getDay())%7+E.indexOf(I))):C.setDate(C.getDate()+((7-C.getDay())%7+E.indexOf(I))%7),$Date.isSameDay(C.getTime(),Date.now())&&(C=new Date(EventsUI.getTimeToPopulate()),f=C.getHours(),v=C.getMinutes()),g=C.getTime()}if(c){var T=c[0].toLowerCase().trim(),R=/(1[012]|0?[1-9])/,M=/[:.][0-5][0-9]/;f=T.match(R)?T.match(R)[0]:a,v=T.match(M)?T.match(M)[0]:s,v=v.replace(/[.:]/,""),e.length==T.length&&(g=$Util.getSyncedCurrentTime()),T.includes("pm")&&"12"!=f&&(f=parseInt(f)+12),e=e.replace(l,f+":"+v)}if(o){var U=o[0];U=U.replace(/[/.-]/g,"$");var w=U.indexOf("$"),_=U.substring(0,w),O=U.substring(w+1,U.lastIndexOf("$"));e=e.replace(/([12][0-9]|3[01]|0?[1-9])[/.-](1[012]|0?[1-9])/,O+" "+_)}$WC.$CUtil.isEmpty(g)?r=Date.parse(e):(C=new Date(g),r=new Date(C.getFullYear(),C.getMonth(),C.getDate(),f,v).getTime())}if(0==new Date(r).getHours()){var D=new Date(r);D.setHours(a),r=D.getTime()}return r?r:-1}var t=/(([12][0-9]|3[01]|0?[1-9])((st|nd|rd|th)\s?)?)/.source,i=/(\sof)?/.source,a=/(\s|^)/.source,s=/\s?/.source,n=/(?:Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|Jun(?:e)?|Jul(?:y)?|Aug(?:ust)?|Sep(?:tember)?|Oct(?:ober)?|(Nov|Dec)(?:ember)?)/.source,r=/([,.-/])?\s/.source,o=/(\s?(19[7-9]\d|20\d{2})|\d{2})?/.source,l=/(\s(at\s)?)?/.source,c=/(\s(on\s)?)?/.source,d=/(((0?[1-9]|1[012])([.:][0-5]\d){0,2}(\s?[ap]m))|(0?\d|1\d|2[0-3])(:[0-5]\d){1,2})/.source,u=/(today|tomorrow|day after tomorrow|day after today|overmorrow|(up)?coming week|next week|following week)/.source,m=/(next\s)?(mon|tues|wednes|thurs|fri|satur|sun)day/.source,p=/((19|20)([2468][048]|[13579][26]|0[48])|2000)/.source,h=/[/.-]/.source,g=/(19|20)[0-9]{2}/.source,f=/(11|0?[469])/.source,v=/(1[02]|0?[13578])/.source,C=/([12][0-9]|3[01]|0?[1-9]|)/.source,y=/([12][0-9]|30|0?[1-9])/.source,b=/(1[0-9]|2[0-8]|0?[1-9])/.source,E=/29[/.-]0?2/.source,I=/0?2[/.-]29/.source,T=/0?2[/.-]/.source,$=new RegExp("("+E+h+p+"|("+y+h+f+h+g+"|"+C+h+v+h+g+"|"+b+h+T+g+"))","g"),S=new RegExp("("+I+h+p+"|("+f+h+y+h+g+"|"+v+h+C+h+g+"|"+T+b+h+g+"))","g"),R=new RegExp("("+p+h+I+"|("+g+h+f+h+y+"|"+g+h+v+h+C+"|"+g+h+T+b+"))","g"),A=new RegExp("("+t+"\\s\\s?"+n+")|("+n+"\\s"+t+")","ig"),M=new RegExp("("+S.source+"|"+$.source+"|"+R.source+")","g"),U=new RegExp(t+""+i+r+"?","ig"),w=new RegExp("("+U.source+n+r+"?"+o+")","ig"),_=new RegExp("("+n+"("+r+"?"+t+")"+r+o+")","ig"),O=new RegExp("("+a+"("+d+c+")?((("+w.source+"|"+_.source+"|"+M.source+"|("+u+"("+s+m+")?)|"+m+"))"+l+d+"?)\\b)","ig");return{markTimeInstances:function(t,i){var a=[],s=[],n=t.match(O);if(n&&(n.forEach(function(t){t=t.trim(),parsedTime=e(t,parseInt(i)),EventsUI.isInvalidEventTime(parsedTime,$Util.getSyncedCurrentTime())||(a.push(t),s.push(parsedTime))}),a=$Util.removeDuplicateEntries(a)),a.length){for(var r=0;r<a.length;r++){var o=a[r],l=new RegExp(o,"g"),c=$WC.template.replace(MessageContextParser.dateTimeUnderlineHtml,{TIME:i+r,PARSEDTIME:s[r],WORD:o});t=t.replace(l,c)}t=$WC.template.replace(MessageContextParser.msgCntHtml,{MSG:t},"InSecureHTML")}return t}}}(),MessageContextParser={contextMenuHtml:'<div id="timecontextmenu" mcpId="{{mcpId}}" class="cht-remndevnt"><div popupmenu class="font13 rmnd-popup"><em arrw class="pointer-elem"></em><div contextAction="openEventWin" class="cht-evnts"><em class="zcf-eventcreate mrgR10 dib-mid"></em>{{event}}</div><div contextAction="openRemWin" class="cht-evnts"><em class="zcf-remquickadd mrgR10 dib-mid"></em>{{reminder}}</div></div></div>',dateTimeUnderlineHtml:'<span class="eventnotifier"  id="MCP_{{TIME}}" type="date-time" parsedtime = "{{PARSEDTIME}}">{{WORD}}</span>',msgCntHtml:"<span eventpredictor>{{MSG}}</span>",init:function(){var e=$("#chatwindowsviewport"),t=this;e.on("click","[type='date-time']",function(e){var t=$(e.target),i=t.parents("pre[msgtype=msg]");if(MessageContextParser.closeContextMenu(),MessageContextParser.closeAllInlinePopups(),"date-time"==t.attr("type")){e.stopPropagation();var a=t.attr("id");if(SecurityManager.hasPermission(Modules.Events)&&SecurityManager.hasPermission(Modules.Reminders)){var s=$WC.template.replace(MessageContextParser.contextMenuHtml,{mcpId:a,$event:"event.add",$reminder:"common.set.reminder"});t.append(s),MessageContextParser.positionContextMenu(t,i),Clickoutside.bind({srcid:a,destid:"timecontextmenu",customHide:function(){MessageContextParser.closeContextMenu()}})}else SecurityManager.hasPermission(Modules.Events)?MessageContextParser.handle.openEventWin(t):MessageContextParser.handle.openRemWin(t)}}),e.on("click","[contextAction]",function(e){var i=$(this),a=i.attr("contextAction"),s=i.parents("[type=date-time]");MessageContextParser.closeContextMenu(),"function"==typeof t.handle[a]&&(e.stopPropagation(),t.handle[a](s))})},handle:{openEventWin:function(e){EventWidgetsManager.getContextWidget(),EventsContextCUWidget.openView(e)},openRemWin:function(e){var t=RemindersWidgetManager.getWidget(e);t.openView(e)}},closeAllInlinePopups:function(){EventsContextCUWidget&&EventsContextCUWidget.closeInlineEventPopup(),RemindersWidgetManager.getWidget()&&RemindersWidgetManager.getWidget().closeView()},isEnabled:function(){var e,t=["Events","Reminders"];return t.forEach(function(t){e=e||SecurityManager.hasPermission(Modules[t])}),SecurityManager.hasPermission(Modules.MessageContextParser)&&e},positionContextMenu:function(e,t){var i=t.find("#timecontextmenu").find("[popupmenu]"),a=t.parents("[purpose=chatview]").offset().left,s=10,n=i.outerWidth(),r=e[0].getBoundingClientRect().width,o=e.offset().left,l=e.position().left,c=l-n/2+r/2,d=o-n/2+r/2>a+s?c:s;if(d==s){var u=i.find("[arrw]");u.css({left:c-s})}i.parent().css({left:d})},positionPopup:function(e,t){var i=t.is("[inlinereminders]")?t.find("#remwincnt"):t.is("[inlineevent]")?t.find("#eventcnt"):t,a=$("#chatsection")[0].getBoundingClientRect(),s=e[0].getBoundingClientRect(),n=$("#chatbody").offset().top,r=Math.min(s.right+10,window.outerWidth-t[0].clientWidth),o=Math.min(Math.max($("#header").outerHeight(),s.top+s.height/2-t[0].clientHeight/2),window.outerHeight-t[0].clientHeight)+255;t.css({top:o,left:r});var l,c=i[0].getBoundingClientRect();a.bottom<c.bottom?l=parseInt(i.css("bottom"))+(c.top+c.height-a.height):c.top<a.top&&(l=parseInt(i.css("bottom"))-(n-c.top)),l&&i.css("bottom",l);var d=25;a.width<c.left+c.width?(t.css("left",r-c.width-s.width-d),t.addClass("cht-tltipright")):t.removeClass("cht-tltipright")},closeContextMenu:function(){var e=$("#timecontextmenu");e.length&&(e.remove(),Clickoutside.clear("timecontextmenu"))},parseTimeFromMessage:function(e,t,i){$ZCAjx.ajax({url:"/v1/chats/"+e+"/parsetime",type:"GET",data:{time:t},success:function(e){"function"==typeof i&&i(e)}})}};var EventWidgetsManager={},EventsContextCUWidget={},EventsCUWidget=function(e){var e=e,t=null;this.getParentContainer=function(){return $("#"+e)},this.getEventId=function(){return t},this.setEventId=function(e){t=e},this.init()};EventsCUWidget.prototype={init:function(){this.bindEvents()},fillCreateWin:function(e){var t=this.getParentContainer();if($WC.$CUtil.isEmpty(e.SUM)||t.find("[event_title]").val(e.SUM),$WC.$CUtil.isEmpty(e.LOC)||t.find("[event_location]").val(e.LOC),t.find("[event_starttime]").html(e.SDT),t.find("[event_endtime]").html(e.EDT),!$WC.$CUtil.isEmpty(e.REMINDERS)){var i=-parseInt(e.REMINDERS[0].minutes),a=this.getReminderString(i);t.find("[event_reminder]").html(a).attr("val",i)}$WC.$CUtil.isEmpty(e.DESC)||t.find("[event_desc]").val(e.DESC)},isValidLength:function(e,t){return t>=e[0]&&t<=e[1]},getAndValidateInputs:function(){var e=[1,255],t=[0,255],i=[0,1e4],a=this.getParentContainer(),s=a.find("[event_title]").val();if(!this.isValidLength(e,s.length))return void a.find("[event_title]").addClass("error");var n=a.find("[event_location]").val(),r=a.find("#calendarssel").attr("val"),o=a.find("[event_starttime]").parents("[time]").attr("time"),l=a.find("[event_endtime]").parents("[time]").attr("time"),c=SearchField.getSelectedList("addparticipants"),d=a.find("[event_desc]").val(),u=a.find("#eventmanagementradio").is(":checked");if(eventObj={title:s,starttime:o,endtime:l,calendaruid:r,timezone:Events.getGMTTimeOffset()},!this.isValidLength(t,n.length))return void a.find("[event_location]").addClass("error");eventObj.location=n,this.isValidLength(i,d.length)&&(eventObj.description=d);var m=[];if(c.forEach(function(e){m.push(Users.getEmailId(e))}),u){if(c.length<1)return void UI.updateBanner(Resource.getRealValue("event.management.error"),2e3,!0)}else{var p=a.find("[event_reminder]").attr("val");if(!Events.isProperReminder(p,o))return UI.updateBanner(Resource.getRealValue("event.reminder.error"),2e3,!0),void a.find("#remindershead").addClass("error");eventObj.reminder=p}return a.find(".error").length?void 0:(eventObj.participants=m,eventObj.eventmanagement=u,eventObj)},getReminderListHtml:function(){for(var e="",t=Events.reminderval,i='<li val="{{REMVAL}}">{{REMSTR}}</li>',a=0,s=t.length;s>a;a++)e+=$WC.template.replace(i,{REMVAL:t[a],REMSTR:EventsUI.getReminderString(t[a])});return e},getCalendarListContent:function(){var e,t,i="",a=0,s=Events.getAllCalendars();for(var n in s){var r=s[n];("own"===r.category||"group"===r.category&&"ogroup"===r.entity_type)&&(t=r.isdefault===!0,t&&(e=r),i+=$WC.template.replace(this.htmls.calendarlist,{UID:n,COLOR:r.color,NAME:r.name,ISDEFAULT:t?"clndr-sel":""}),a++)}var o=2>a?!1:!0;return calendarlistContent=$WC.template.replace(this.htmls.calendar,{ID:"calendars",DEFAULTVALUE:e.CKEY,DEFAULTCALENDAR:e.name,DEFAULTBGCOLOR:e.color,$calendartitle:o?"event.calendar.choose":"emoji.calendar",button:o?"inlineeventbuttons":"",pointer:o?"cp":""}),calendarlistContent=$WC.template.replace(calendarlistContent,{CALENDARLIST:i,EM:o?'<em class="msi-uparrw"></em>':""},"InSecureHTML")},setAlertOptions:function(e){var t=Events.getCalendar(e);if("group"===t.category){"undefined"==typeof Groups.get(t.entity_id).members&&Groups.getMembers(t.entity_id);var i='<a class="calenlink" href="{{CALSERVER}}" target="_blank">{{calendar}}</a>';i=$WC.template.replace(i,{CALSERVER:$zcg._CALENDARSERVER,$calendar:"common.small.calendar"}),$("#evgroupreminddesc").html(Resource.getRealValue("event.group.reminder",i)),$("#eventalert").slideUp(function(){$("#evgroupremind").removeClass("dN")})}else $("#evgroupremind").addClass("dN"),$("#eventalert").slideDown()},userSuggest:{search:function(e){var t=($("#events-addparticipants-results"),!1),i=SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,a=SearchField.getSelectedList("events-addparticipants-select-field"),s={},n=Events.getCalendar($("#calendarssel").attr("val"));"group"===n.category&&(searchIn=SearchAgent.CUSTOMSEARCH,s=Groups.getMembersFromObj(n.entity_id));var r=$("#events-addparticipants-list");return r.empty(),t=SearchAgent.search({searchin:i,val:e,ignorelist:a,listid:"events-addparticipants-list",contactshtml:EventsContextCUWidget.htmls.participantsSearch,orgcontactshtml:EventsContextCUWidget.htmls.participantsSearch,allstatuscontacts:!1,clearcallback:function(){SearchField.displayNoResultFound("events-addparticipants",e)},customobject:s}),t&&$("#events-addparticipants-list").removeClass("dflxjustcent").find("[purpose=search]").first().addClass("sel"),t},handleAction:function(e,t){if(t.length){var i=$("#events-addparticipants-select-field"),a=t.attr("uid"),s={uid:a,name:Users.getName(a),type:t.attr("elemtype"),image:Users.getImgUrlById(a)},n=$WC.template.replace(EventsContextCUWidget.htmls.imgNode,s);n=$WC.template.replace(n,{remove_html:EventsContextCUWidget.htmls.removeImgNode},"InSecureHTML"),i.append(n),t.parents("#events-addparticipants-results").addClass("rempptsel"),SearchField.clearSearchField("events-addparticipants"),$("#selevntparticipants").is(":visible")||($("#selevntparticipants").show(),$("#saveAddedParticipants").css("visibility","visible"))}},handleKeyUp:function(e){if(e.which===$zcg.ESCAPE_KEYCODE){var t=$("#events-addparticipants-search-field");t.is(":empty")?EventsContextCUWidget.handle.closeView(e):(SearchField.clearSearchField("events-addparticipants"),SearchField.populateDefaultResult("events-addparticipants"))}},populateDefaultResult:function(){this.search("*")||this.displayNoResultFound(void 0,Resource.getRealValue("reminders.nomorecontacts.error"))},displayNoResultFound:function(e,t){var i=$("#events-addparticipants-list");i.addClass("dflxjustcent"),i.html("undefined"!=typeof e?Resource.getRealValue("reminders.noresults.error",[e]):t)}},bindEvents:function(){var e=this.getParentContainer();e.on("click","[inlineeventbuttons]",function(e){var t=$(this),i=t.attr("purpose");e.stopPropagation(),"function"==typeof EventsContextCUWidget.handle[i]&&EventsContextCUWidget.handle[i](e,t)}),e.on("focus","[event_title]",function(){$(this).removeClass("error")}),e.on("change","[eventalrtradio]",function(e){var t,i,a=$(e.target);i=$("#"+$(a.parents('[purpose="chatview"]')).attr("id")),"eventreminderradio"===this.id?(t=Resource.getRealValue("event.reminder.hint"),i.find("#reminderscnt").slideDown()):(t=Resource.getRealValue("event.management.hint"),i.find("#reminderscnt").slideUp()),i.find("#eventalertdesc").text(t)})}},EventWidgetsManager=function(){return EventsContextCUWidget=null,{getContextWidget:function(){EventsContextCUWidget||(EventsContextCUWidget=new EventsCUWidget("chatwindowsviewport"),EventsContextCUWidget.htmls={inlineEvents:'<div class="cht-tltipcont" inlineevent id="eventpopupwindow"><div class="rmnd-popup cht-evntcret" id = "eventcnt"><em class="msi-close cp" purpose="closeView" inlineeventbuttons></em><header><div class="font14"><em class="msi-eventcreate mrgR10 dib-mid"></em>{{createevent}}</div></header><div class="cht-evntcont"><div class="evnt-edtfld mrgT20"><label class="lH25 font12 fontb">{{title}}</label><input type="text"   placeholder="{{titlehint}}"  event_title/></div><div class="evnt-edtfld mrgT20"><label class="lH25 font12 fontb">{{venue}}</label><input type="text"  placeholder="{{venuehint}}"  event_location/></div>{{CALENDARCONTENT}}{{DATETIMECONTENT}}{{PARTICIPANTCONTENT}}<button id="evsubmit" class="dbtn adbtn mrgR20" purpose = "createEvent" inlineeventbuttons >{{createbutton}}</button></div><div class="cht-evntovervw" moreoptions><div class="cht-moroptn" id="moreoptions"><header><span  purpose="showMore" class="cp" inlineeventbuttons id="showmore"><span>{{moreevent}}</span><em class="msi-dwnarrw dib-mid"></em></span></header>{{MOREOPTIONSCONTENT}}</div></div></div></div>',reminders:'<div class="mrgT15"><div id="{{ID}}cnt" class="clr0"><div class="zcrmdrpdwn w100"><div class="selectmlmn"><div class="dIB zcevrem"><div id="{{ID}}head" class="zcrmtm" inlineeventbuttons purpose="showOptions"><div id="{{ID}}sel" class="mailids ellips" val="{{DEFAULTVALUE}}" event_reminder>{{DEFAULTNAME}}</div><span class="msi-darrw floatr"></span></div><ul id=inline{{ID}} inlineeventbuttons purpose="selectOption" class="dN dropdwncnt">{{DROPDOWN}}</ul></div></div></div></div><div id="eventalertdesc" class="evt-alrtdesc font13 lin20">{{reminderhint}}</div></div>',calendar:'<div class="evnt-drpdwn mrgT15" ><span class="lH25 font12 fontb" id="calendartitle">{{calendartitle}}</span><div><div class="font13 lH25 dinflxC {{pointer}}" purpose="openCalendar" {{button}} id="{{ID}}head"><span class="cal-categ" calcolor style = "background-color : {{DEFAULTBGCOLOR}}"></span><p val ={{DEFAULTVALUE}} id = "{{ID}}sel" class="ellips">{{DEFAULTCALENDAR}}</p>{{EM}}</div><div class="evnt-drpitems" id=inline{{ID}} purpose = "chooseCalendar" inlineeventbuttons>{{CALENDARLIST}}</div></div></div>',calendarlist:'<div class="dflxcent padd5 cp {{ISDEFAULT}}" val="{{UID}}" name = "{{NAME}}" color="{{COLOR}}"><span class="cal-categ" style = "background-color:{{COLOR}}"></span><span class="flx1 ellips mrgR10" id="calendarssel">{{NAME}}</span><em class="msi-ticktwo dN"></em></div>',dateTime:'<div class="dN" id="calendarscnt"></div><div class="mrgT15"><span class="lH25 font12 fontb">{{datetimeheader}}</span><div class="dflxcent" id = "caltime"><div class="dflxcent cht-calndrset" time="" id = "calstarttime" purpose = "openDateTimeCalendar" inlineeventbuttons><span class="flx1 font14 cp" event_starttime ></span><em class="cal-view msi-eventcreate cp"></em></div><span class="mLR10">{{to}}</span><div class="dflxcent cht-calndrset" time="" id = "calendtime" purpose = "openDateTimeCalendar" inlineeventbuttons><span class="flx1 font14 cp" event_endtime ></span><em class="cal-view msi-eventcreate cp"></em></div></div></div>',participants:'<div class="mrgT15"><span class="lH25 font12 fontb">{{attendees}}</span><div class="paddB10 mrgT10 add-atnde" id="addparticipants"><div class="add-adndr msi-plus cp dib-mid" id="addAttendees" purpose="addAttendees" inlineeventbuttons></div></div></div>',moreOptions:'<div class="cht-evntcont"><span class="lH25 font12 fontb">{{eventalert}}</span><div id="evgroupremind" class="dN font13"><div id="evgroupreminddesc" ></div></div><div id="eventalert" class="posrel clr0 mrgT10"><div class="font13"><div class="posl dIB"><input id="eventreminderradio" class="evt-alrtinput cur" name="eventalerttype" eventalrtradio type="radio" checked="true"><span class="evt-alrttype cur"></span><label class="cur dib-mid" for="eventreminderradio">{{eventrem}}</label></div>{{EVENTMGMT}}</div>{{REMINDERCONTENT}}</div><div class="cht-descrp mrgT10"><span class="lH25 font12 fontb">{{desc}}</span><textarea placeholder="{{deschint}}" class="w100" event_desc></textarea></div></div>',eventManagement:'<div class="posl dIB mrgL30"><input id="eventmanagementradio" class="evt-alrtinput cur" name="eventalerttype" eventalrtradio type="radio"><span class="evt-alrttype cur"></span><label class="cur dib-mid" for="eventmanagementradio">{{evmgmt}}</label></div>',addParticipants:'<div id="events-addparticipants" class="addparticipants zcrchmcnt evntaddattndeecnt"><div class="zccrin reminputbox"><div id="events-addparticipants-search-field" class="remsrchfield" contenteditable="true" type="text" data-text="{{searchpholder}}"></div></div><div id="events-addparticipants-results" class="rem-drpdwn-cnt padd5"><div id="events-addparticipants-list" class="posl zcht100"></div></div><div class="crchndcnt crchndcnt-edit dN" id="selevntparticipants"><div id="usernodecnt" class="zcrchicnt"><div id="events-addparticipants-select-field" class="floatl"></div></div><div id="saveAddedParticipants" inlineeventbuttons purpose="saveSelectedParticipants" class="windwbtn dIB cur">{{create}}</div></div></div>',participantsSearch:'<div uid="{USERID}" elemtype="contact" purpose="search" data-val="{DNAME}" class="zcrtchtcontct remcontact flexC font13"><div class="list-img posl"><img src="{IMGURL}"><div class="{STATUSCLASS}"></div></div><div class="ellips list-cnt mrgL10 zclin18"><div class="ellips dflx">{DNAMEVAL}</div><div class="ellips clr6">{EMAILID}</div></div></div>',imgNode:'<div uid="{{uid}}" elemtype="{{type}}"  title="{{name}}" username="{{name}}" nodetype="@" class="dIB zcricnt posl"><img src="{{image}}"/>{{remove_html}}</div>',removeImgNode:'<div class="msi-close user-remove posa dN cur" inlineeventbuttons purpose="removeSelectedUser"></div>'},EventsContextCUWidget.handle={closeView:function(e){Clickoutside.handleClickOnChild(e)},openCalendar:function(){Clickoutside.bind({srcid:"calendarshead",destid:"inlinecalendars",customShow:function(){$("#inlinecalendars").slideDown(100)},customHide:function(){$("#inlinecalendars").slideUp(100)}})},chooseCalendar:function(e){var t=$(e.target),i=t.closest("[name]"),a=i.attr("val");$("#calendarshead").find("#calendarssel").text(i.attr("name")),$("#calendarshead").find("[calcolor]").css("background-color",i.attr("color")),i.addClass("clndr-sel"),i.siblings(".clndr-sel").removeClass("clndr-sel"),this.closeView(e),EventsContextCUWidget.setAlertOptions(a)},showMore:function(e){var t=$(e.target),i=t.parents("[moreoptions]");Clickoutside.bind({srcid:"showmore",destid:"moreoptions",customShow:function(){i.addClass("expnd-mroptn")},customHide:function(){i.removeClass("expnd-mroptn")}})},addAttendees:function(e,t){if(!$("#events-addparticipants").length){var i=$WC.template.replace(EventsContextCUWidget.htmls.addParticipants,{$searchpholder:"quickchat.node.placeholder",$create:"common.add"});$("#addparticipants").parent().append(i),SearchField.init("events-addparticipants"),ZCScroll.customScroll($("#events-addparticipants-list"),!0)}Clickoutside.bind({srcid:t.attr("id"),destid:"events-addparticipants",customShow:function(){SearchField.clearSearchField("events-addparticipants");var e=$("#events-addparticipants");$("#events-addparticipants-select-field").empty(),EventsContextCUWidget.getSelectedParticipantsAndInit(e),$("#addparticipants").children().length>1?(e.find("#selevntparticipants").show(),e.find("#saveAddedParticipants").text(Resource.getRealValue("common.save"))):(e.find("#selevntparticipants").hide(),e.find("#saveAddedParticipants").text(Resource.getRealValue("common.add"))),e.show(),e.find("#events-addparticipants-search-field").focus()},customHide:function(){$("#events-addparticipants").hide()}})},selectOption:function(e){var t=$(e.target).attr("val");$("#reminderscnt").find("#reminderssel").text($(e.target).text()).attr("val",t),Events.isProperReminder(t,$("#calstarttime").attr("time"))?$("#remindershead").removeClass("error"):$("#remindershead").addClass("error"),this.closeView(e)},showOptions:function(e,t){list=t.siblings('[purpose="selectOption"]'),$(e.target).addClass("sel"),Clickoutside.bind({event:e,srcid:e.currentTarget.id,destid:list[0].id,callback:function(e){var t=$("#"+e);t.removeClass("sel")}})},removeSelectedUser:function(e,t){t.parent().remove(),SearchField.populateDefaultResult("events-addparticipants")},openDateTimeCalendar:function(e,t){var i=t.attr("time"),a=t.attr("id"),s="calstarttime"==a,n='<div id="datetimecnt" class="date-picker-wrp"></div>',r=$("#calendarscnt");r.removeClass(s?"evntendcalcnt":"evntstartcalcnt").addClass(s?"evntstartcalcnt":"evntendcalcnt"),r.append(n).removeClass("dN"),Clickoutside.bind({srcid:a,destid:"datetimecnt",customShow:function(){var e=s?$Util.getSyncedCurrentTime():$("#calstarttime").attr("time"),t=new DateTimeWidget("datetimecnt",{setButtonNeeded:!0,range:{from:e}});t.handleModify=function(e){EventsContextCUWidget.saveEditTime(e,this.getSelection())},t.handleCancel=function(e){EventsContextCUWidget.handle.closeView(e),EventsContextCUWidget.hideDateTimeCalendar()};var n=$("#datetimecnt");t.initialize(new Date(parseInt(i))),n.attr("caltype",a)},customHide:function(){EventsContextCUWidget.hideDateTimeCalendar()}})},saveSelectedParticipants:function(e){var t=$("#addparticipants");t.children().not("#addAttendees").remove();var i=SearchField.getSelectedList("events-addparticipants-select-field");i.forEach(function(e){var i=$WC.template.replace(EventsContextCUWidget.htmls.imgNode,{uid:e,image:Users.getImgUrlById(e),name:Users.getName(e),type:""});i=$WC.template.replace(i,{remove_html:EventsContextCUWidget.htmls.removeImgNode},"InSecureHTML"),t.prepend(i)}),this.closeView(e),$("#events-addparticipants").hide()},createEvent:function(e){var t=($(e.target),EventsContextCUWidget.getAndValidateInputs());$WC.$CUtil.isEmpty(t)||(Events.create(t),ZCTrack.track("EVENT_CREATE_FROM_MCP"),this.closeView(e))}},EventsContextCUWidget.saveEditTime=function(e,t){var i=$("#datetimecnt"),a=i.attr("caltype"),s=new Date(t).getTime(),n=$("#"+a);n.attr("time",s);var r=this.getFormattedDateString(s);if("calstarttime"===a){var o=$("#calendtime");n.find("[event_starttime]").html(r),o.attr("time")<=s&&(o.attr("time",s+Events.TIMESTAMPDIFF),r=this.getFormattedDateString(s+Events.TIMESTAMPDIFF),o.find("[event_endtime]").html(r))}else n.find("[event_endtime]").html(r);EventsContextCUWidget.handle.closeView(e),this.hideDateTimeCalendar()},EventsContextCUWidget.hideDateTimeCalendar=function(){$("#datetimecnt").remove()},EventsContextCUWidget.openView=function(e){var t=e.attr("id"),i=e.parents("#chatbody"),a=$("#eventpopupwindow");a.length&&(a.remove(),Clickoutside.clear("eventpopupwindow")),Clickoutside.bind({srcid:t,destid:"eventpopupwindow",customShow:function(){EventsContextCUWidget.populateEventUI(e);var a=$("#"+t).closest("[eventpredictor]").text(),s=e.attr("parsedtime");EventsContextCUWidget.createEventFromMessage(s,a),ZCScroll.removeScroll(i),i.css("overflow","hidden")},customHide:function(){EventsContextCUWidget.closeInlineEventPopup()}})},EventsContextCUWidget.getSelectedParticipantsAndInit=function(e){var t=e.find("#events-addparticipants-select-field"),i=SearchField.getSelectedList("addparticipants"),a=this;i.forEach(function(e){var i=$WC.template.replace(a.htmls.imgNode,{uid:e,name:Users.getName(e),image:Users.getImgUrlById(e),type:""});i=$WC.template.replace(i,{remove_html:a.htmls.removeImgNode},"InSecureHTML"),t.append(i)}),SearchField.populateDefaultResult("events-addparticipants")},EventsContextCUWidget.getFormattedDateString=function(e){var t=$Date.date(e,{shortmonth:!0,shortday:!0,shorten:!0}),i=$Date.time(e);return"Today"!==t&&"Tomorrow"!==t&&"Yesterday"!==t&&(t=t.split("&nbsp;"),t=t[1]+"&nbsp;"+t[0]),t+","+i},EventsContextCUWidget.createEventFromMessage=function(e,t){var i,a,s=$("[event_starttime]").parents("[time]"),n=$("[event_endtime]").parents("[time]");t=$WC.$CUtil.isEmpty(t)?"":t.substring(0,255),t=$Util.getTitleString(t),e=parseInt(EventsUI.getTimeToPopulate(e)),i=this.getFormattedDateString(e),a=this.getFormattedDateString(e+Events.TIMESTAMPDIFF),s.attr("time",e),n.attr("time",e+Events.TIMESTAMPDIFF),this.fillCreateWin({SUM:t,SDT:i,EDT:a})},EventsContextCUWidget.getDateTimeHTML=function(){return $WC.template.replace(this.htmls.dateTime,{$datetimeheader:"event.date.header",$to:"common.to.small"})},EventsContextCUWidget.getParticipantsHTML=function(){return $WC.template.replace(this.htmls.participants,{$attendees:"event.attendees"})},EventsContextCUWidget.populateEventUI=function(e){var t,i,a,s,n,r=(this.getParentContainer(),Settings.getFromObj("oreminder",!0).substring(2)),o=r>-1?r:"0",l=_isEventManagementEnabled()?$WC.template.replace(this.htmls.eventManagement,{$evmgmt:"event.management"}):"";i=this.getReminderListHtml(),s=this.getCalendarListContent(),a=$WC.template.replace(this.htmls.reminders,{$reminderhint:"event.reminder.hint",ID:"reminders",DEFAULTVALUE:o,DEFAULTNAME:EventsUI.getReminderString(parseInt(o))}),a=$WC.template.replace(a,{DROPDOWN:i},"InSecureHTML"),t=$WC.template.replace(this.htmls.moreOptions,{$eventalert:"event.alert",$eventrem:"event.reminder",$desc:"common.desc",$deschint:"event.description.hint"}),t=$WC.template.replace(t,{REMINDERCONTENT:a,EVENTMGMT:l},"InSecureHTML"),n=$WC.template.replace(this.htmls.inlineEvents,{$title:"common.name",$createevent:"event.add",$titlehint:"event.enter.title",$venue:"common.location",$venuehint:"event.location.pl",$createbutton:"common.create",$moreevent:"event.more"}),n=$WC.template.replace(n,{CALENDARCONTENT:s,DATETIMECONTENT:this.getDateTimeHTML(),PARTICIPANTCONTENT:this.getParticipantsHTML(),MOREOPTIONSCONTENT:t},"InSecureHTML");var c=$(n);e.parents("[msgtype]").after(c),MessageContextParser.positionPopup(e,c),ZCScroll.customScroll($("#inlinereminders"),!0),ZCScroll.customScroll($("#inlinecalendars"),!0)},EventsContextCUWidget.closeInlineEventPopup=function(){$("#eventpopupwindow").remove(),Clickoutside.clear("eventpopupwindow"),ZCScroll.customScroll(chatbody)})}}}();var DateTimeWidget=function(e,t){var i,a,s=e,n=$.extend(!0,{},this.defaultConfig,t);this._getParentContainer=function(){return $("#"+s)},this._isTimeInputsNeeded=function(){return n.time},this._isSetButtonNeeded=function(){return n.setButtonNeeded},this._isDefaultHtmlUsed=function(){return n.useDefaultHtml},this._getTimeRange=function(){return n.range},this._updateTemporary=function(e){i=e,this._isSetButtonNeeded()||this._setUserSelection()},this._setUserSelection=function(){a=i},this._getTemporary=function(){return i},this.getSelection=function(){return a},this._isDefaultHtmlUsed()&&this._initializeHTML()};DateTimeWidget.prototype={defaultConfig:{time:!0,setButtonNeeded:!1,range:{from:-22090086e5,to:410242494e4},useDefaultHtml:!0},_htmls:{dateCnt:'<div element="preview" class="date-picker-item"></div><div element="calendar" class="date-picker"></div>',timeCnt:'<div element="time" class="date-picker-item"></div>',btnCnt:'<div element="button" class="dp-btn-wrp"><div date_picker_button="cancel" class="dp-btn cancel">{{cancel}}</div><div date_picker_button="set" class="dp-btn">{{save}}</div></div>'},_initializeHTML:function(){var e=this._getParentContainer(),t=this._htmls.dateCnt;if(this._isTimeInputsNeeded()&&(t+=this._htmls.timeCnt),this._isSetButtonNeeded()){var i=$WC.template.replace(this._htmls.btnCnt,{$save:"common.save",$cancel:"common.cancel"});t+=i}e.html(t)},initialize:function(e){var t=this,i=t._getParentContainer();"undefined"==typeof e&&(e=new Date,e.setHours(9,0,0));var a=this._date._getString(e),s=i.find('[element="preview"]').html(this._date.html),n=s.find("[ddmmyy]");n.html(a).attr("ddmmyy",a);var r=t._getTimeRange(),o=i.find('[element="calendar"]');if(o.is(":empty")?o.DatePicker({flat:!0,format:"d/m/Y",date:a,current:a,starts:0,onRender:function(e){var t=e.valueOf()<r.from-86e6||e.valueOf()>r.to;return{disabled:t,className:t?"datepickerNotInMonth datepickerDisabled":!1}},onChange:function(e){n.html(e).attr("ddmmyy",e),t._handleDateChange(e)}}):o.DatePickerSetDate(a),this._isTimeInputsNeeded()){var l=i.find('[element="time"]'),c=e.getHours(),d=c>=12;c=c>12?c-12:c;var u=this._time._formatInput(c),m=this._time._formatInput(e.getMinutes()),p=$WC.template.replace(this._time.html,{$time:"common.time",$am:"scheduler.period.AM",$pm:"scheduler.period.PM",hours:u,mins:m,sel_am:d?"":this._time.ampmSelectionClass,sel_pm:d?this._time.ampmSelectionClass:"",ampm:d?"pm":"am"});l.html(p)}this._updateTemporary(e),this._bindEvents()},_date:{html:'<div class="mrgR20 fontb">'+Resource.getRealValue("common.date")+'</div><div ddmmyy class="date-picker-label"></div>',_getString:function(e){return e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()}},_time:{minutesRange:[0,59],hoursRange:[1,12],html:'<div class="mrgR20 fontb">{{time}}</div><div class="dflx"><div class="tp-item dflxcent"><input class="tp-input" time_input="hours" value="{{hours}}" maxlength="2"><span class="timeseparate">:</span><input class="tp-input" time_input="mins" value="{{mins}}" maxlength="2"></div><div time_input="ampm" class="tp-item  dflxcent mrgL15" ampm={{ampm}}><span date_picker_button="am" class="tp-ampm {{sel_am}}">{{am}}</span><span date_picker_button="pm" class="tp-ampm {{sel_pm}}">{{pm}}</span></div></div>',ampmSelectionClass:"tp-sel",_verifyRangeAndGetValue:function(e,t,i){t=i?++t:--t;var a=this._getRange(e),s=t>a[1]?a[0]:t<a[0]?a[1]:t;return this._formatInput(s)},_getRange:function(e){return"hours"===e?this.hoursRange:this.minutesRange},_formatInput:function(e){return 10>e?"0"+e:e}},_isInvalidTime:function(e){var t=this._getTimeRange();return e>t.to||e<=t.from},_modifyDateTimeErrorStatus:function(e){var t=$("[ddmmyy]");this._isInvalidTime(e)?t.addClass("error"):t.closest(".error").removeClass("error")},_hasError:function(){return this._getParentContainer().find(".error").length?!0:!1},_bindEvents:function(){var e=this._getParentContainer(),t=this;e.off().on("click","[date_picker_button]",function(e){var i=$(this),a=i.attr("date_picker_button");if("set"===a)t._setUserSelection(),t._modifyDateTimeErrorStatus(t.getSelection().getTime()),t._hasError()||t.handleModify(e);else if("cancel"===a&&"function"==typeof t.handleCancel)t.handleCancel(e);else if("am"===a||"pm"===a){var s=i.parents('[time_input="ampm"]');s.attr("ampm",a),s.find("."+t._time.ampmSelectionClass).removeClass(t._time.ampmSelectionClass),i.addClass(t._time.ampmSelectionClass),t._handleTimeChange()}}),this._isTimeInputsNeeded()&&(e.on("keydown keyup","[time_input]",function(e){var i=e.which,a=i>=48&&57>=i,s=i===$zcg.UP_KEYCODE||i===$zcg.DOWN_KEYCODE,n=s||i===$zcg.LEFT_KEYCODE||i===$zcg.RIGHT_KEYCODE,r=i===$zcg.BACKSPACE_KEYCODE||46===i,o=(e.metaKey||e.ctrlKey)&&65==e.keyCode,l=i==$zcg.TAB_KEYCODE||e.shiftKey&&i==$zcg.TAB_KEYCODE,c=a||n||r||o||l;if(c){var d=$(this),u=d.attr("time_input");if("keydown"===e.type)value=parseInt(d.val()),s&&!isNaN(value)&&(value=t._time._verifyRangeAndGetValue(u,value,i===$zcg.UP_KEYCODE),d.val(value),d.closest(".error").removeClass("error"));else if("keyup"===e.type&&(value=d.val(),a||r)){var m=t._time._getRange(u);value<m[0]||value>m[1]?d.addClass("error"):d.closest(".error").removeClass("error")}t._handleTimeChange()}(!c||s)&&e.preventDefault()}),e.on("focusout","[time_input]",function(){var e=$(this),i=parseInt(e.val());isNaN(i)?e.addClass("error"):e.val(t._time._formatInput(i))}))},_handleDateChange:function(e){var t=this._getTemporary(),i=e.split("/");t.setYear(parseInt(i[2])),t.setMonth(parseInt(i[1])-1),t.setDate(parseInt(i[0])),this._updateTemporary(t),this._modifyDateTimeErrorStatus(t.getTime()),this._isSetButtonNeeded()||this._hasError()||"function"!=typeof this.handleModify||this.handleModify()},_handleTimeChange:function(){if(this._isTimeInputsNeeded()){var e=this._getParentContainer(),t=parseInt(e.find('[time_input="hours"]')[0].value),i=e.find('[time_input="ampm"]').attr("ampm");"pm"==i&&12!=t&&(t+=12),"am"==i&&12==t&&(t-=12);var a=parseInt(e.find('[time_input="mins"]')[0].value);if(!isNaN(t)&&!isNaN(a)){var s=this._getTemporary();s.setHours(t,a),this._updateTemporary(s),this._modifyDateTimeErrorStatus(s.getTime())}this._isSetButtonNeeded()||this._hasError()||"function"!=typeof this.handleModify||this.handleModify()}}};var ScreenShare={};ScreenShare.Extension=function(){var e=!1,t=[],i={chrome:"https://chrome.google.com/webstore/detail/amdlbhchbncikhefhcbmcdcgadlggdlb"},a=null;return{getLink:function(){return $Util.Browser.isChrome()?i.chrome:void 0},isInstalled:function(){return e||!$Util.Browser.isChrome()||_isDesktopApp()},setStatusAsInstalled:function(){e=!0},checkInstalledStatus:function(){if(window.postMessage({requestId:"zoho_cliq_extn_check",message:"ZOHOCLIQ-EXTN-CHECK"},"*"),t.length)for(var e in t)t[e].closed&&t.splice(e,1)},openStore:function(){t.push(window.open(this.getLink()))},isStoreOpened:function(){return t.length>0},getSourceId:function(e){a=e,window.postMessage({requestId:"zoho_cliq_get_screen_sourceId",message:"ZOHOCLIQ-GET-SCREEN-SOURCEID"},"*")},handleMessageEvent:function(t){var i=t.originalEvent.data;"ZOHOCLIQ-EXTENSION"===i.source&&("zoho_cliq_extn_check"===i.requestId?e=!0:"zoho_cliq_get_screen_sourceId"===i.requestId&&("function"==typeof a&&a(i.message.data),a=null))}}}();var Conference={};Conference=function(){function e(){return WebRTCUserMedia&&WebRTCUserMedia.isSupported()&&($Util.Browser.isChrome()||$Util.Browser.isFirefox())}function t(){return SecurityManager.hasPermission(Modules.AudioConference)}function i(){return SecurityManager.hasPermission(Modules.VideoConference)}var a,s=!1,n=!1;return{types:{AUDIO:"audio",VIDEO:"video"},scopeTypes:{CHAT:"chat"},isInitialized:function(){return s},isAudioConferenceAllowed:function(){return t()&&e()&&this.isInitialized()},isVideoConferenceAllowed:function(){return i()&&e()&&this.isInitialized()},initialize:function(a,r){return this.isInitialized()?void("function"==typeof a&&a()):t()||i()?void MediaManager.initialize(function(){if(e()){if(n)return;n=!0,$Util.loadMultipleFiles("script",$zcg._VIDEOCHATPROPS.CONFERENCE_JS_LIST,function(){s=!0,n=!1,ConferenceImpl.init(),"function"==typeof a&&a()})}}):void("function"==typeof r&&r())},handleWmsMessage:function(e){this.isInitialized()&&ConferenceHandler.wmsEvents[e.opr](e)},handleWmsConnectionStatus:function(e){e&&"function"==typeof a&&(a(),a=void 0)},handlePermaLink:function(e,t){function i(){$("#loadingniceurl").remove(),$("body").removeClass("chnlpermalink")}if(t)Conference.join(e);else{var s=function(){a=function(){Conference.join(e,i)}},n=function(){window.history.pushState({},null,window.location.origin+"/index.do"),i()};this.initialize(s,n)}},trigger:function(e,t,i){if(!MediaManager.isAnySessionRunning()&&this.isInitialized()){var a=function(a){ConferenceUI.showStartWin(e,t,i,a)};this.types.VIDEO===e?WebRTCUserMedia.requestAudioVideoStream(a):WebRTCUserMedia.requestAudioStream(a)}},join:function(e,t){this.isInitialized()&&!MediaManager.isAnySessionRunning()&&ConferenceImpl.checkAndJoin(e,t)},isCurrentChat:function(e){return this.isInitialized()?ConferenceUI.isCurrentChat(e):!1},setUnreadMessageCount:function(e,t){this.isInitialized()&&ConferenceUI.setUnreadMessageCount(e,t)},handleChatWindowCreated:function(e){this.isInitialized()&&ConferenceUI.handleChatWindowCreated(e)},handleChatWindowClosed:function(e){this.isInitialized()&&ConferenceUI.handleChatWindowClosed(e)},handleGetMeFront:function(e){this.isInitialized()&&ConferenceUI.handleGetMeFront(e)},handleResize:function(){this.isInitialized()&&ConferenceUI.handleResize()},handleUnload:function(){this.isInitialized()&&ConferenceImpl.handleEnd(!0)}}}();var Participants=function(){var e=function(e){var i=$DB.get("participants");return t(e)?i[e]:(i[e]=new $Participants(e),i[e])},t=function(e){return $DB.get("participants").hasOwnProperty(e)},i=function(t){return e(t).participantspopulated},a=function(t,i){var a=e(t);a.recipants&&a.recipants.length?i(a.recipants):Chat.getParticipants(t,!1,function(){i(e(t).recipants)})},s=function(t,i){var a=e(t);a.participantspopulated&&a.hasAllParticipants()?i(a.recipants):Chat.getParticipants(t,!1,function(){i(e(t).recipants)})},n=function(t,i,a){var s=e(t);"13"===a?s.updateParticipants(i):"14"===a?(s.handleAddParticipant(i),ChatsList.updateParticipants(t,i,"add")):"15"===a&&(s.handleDeleteParticipant(i),ChatsList.updateParticipants(t,i,"delete"))},r=function(t,i,a,s,n){var r=e(t);"string"==typeof i&&(i=i.split(",")),s&&r.setPopulated(s),n&&(r.role=n),i&&(r.recipants=i),a&&r.updateParticipantCount(a),$DB.get("participants")[t]=r},o=function(e,t){for(var i=[],a=[],s=[],n=[],r=[],o=e.length,l=(t.recipants,0);o>l;l++){var c=e[l][1],d=t.role[c];$WC.$CUtil.isEmpty(d)||0!=parseInt(d)?1==d?n.push(e[l]):3==d||2==d?s.push(e[l]):r.push(e[l]):a.push(e[l])}return i.concat(a).concat(n).concat(s).concat(r)},l=function(e,t,i,a,s,n){var r=Contacts.getStatus(e);return n&&!Users.isSameOrg(e)?!1:$zcg.NO_CHAT===r||$zcg.CON_REMOVE===r?!1:i.length>0&&-1!==i.indexOf(e)?!1:"-"!=t||$WC.$CUtil.isEmpty(a)||!Chat.isChannelChid(a)||$.isEmptyObject(s)?!0:Channels.isUserAllowedtoChangeRole(Channels.getByChid(a),Channels.ROLES.ALLOWED_USER,s.role,s.sameorguser,!1)},c=function(e){if(e.participant){var t=$WC.$CUtil.processXSS(e.val),i=e.zuid,a=e.channelcurrentuserrole,s=$WC.$CUtil.processXSS(e.participant.dname),n=$WC.$CUtil.processXSS($WC.$CUtil.isEmpty(e.participant.emailid)?e.participant.email:e.participant.emailid),r=s,o=n,l=Contacts.isMutual(i)?Contacts.getStatusStyle(i):"";if(e.highlight&&"*"!==t){var c=s.toLowerCase().indexOf(t),d=$WC.$CUtil.isEmpty(n)?-1:n.toLowerCase().indexOf(t),u=new RegExp($WC.Matcher.replace("escaperegexp",t),"i");-1!==c?r=s.replace(u,"<b>$&</b>"):-1!==d&&(o=n.replace(u,"<b>$&</b>"))}{var m=Contacts.isMutual(i),p=Contacts.get(i),h=p?parseInt(p.status):0,g=WmsImpl.isLocalUser(i);!(m||h===$zcg.CON_UNAPRD||WmsImpl.isAnnonUser(i))}if(addcontactorrolehtml="",deletememberhtml=e.deletemember&&!g?'<span uid="'+i+'" title="'+Resource.getRealValue("chat.remove.participant")+'" purpose="delmem" class="msi-cmddel cur"></span> ':"",!g&&!m)if(p)switch(h){case $zcg.CON_UNAPRD:addcontactorrolehtml='<span class="zcddivted">'+Resource.getRealValue("contact.invited")+"</span>";break;case $zcg.CON_REJECT:case $zcg.CON_DELETE:addcontactorrolehtml='<span class="zcaddct zcaddctxt bold cur" uid="'+i+'" purpose="addcontact" title="'+Resource.getRealValue("contact.invite.user")+'">'+Resource.getRealValue("contact.invite")+"</span>";break;case $zcg.CON_REQACC:case $zcg.CON_REMIND_ME_LATER:addcontactorrolehtml='<span class="zcaddct zcaddctxt bold cur" uid="'+i+'" purpose="accept" title="'+Resource.getRealValue("contact.accept.invite")+'">'+Resource.getRealValue("common.accept")+"</span>"}else addcontactorrolehtml='<span class="zcaddct zcaddctxt bold cur" uid="'+i+'" purpose="addcontact" title="'+Resource.getRealValue("contact.invite.user")+'">'+Resource.getRealValue("contact.invite")+"</span>";if(!$WC.$CUtil.isEmpty(a)&&$WC.$Win.isExist("participants")){deletememberhtml="",addcontactorrolehtml="";var f={zuid:i,currentrole:a};ParticipantsWin.handleChannelRoleOption(!1,f,e.sameorguser)&&!g&&(addcontactorrolehtml='<span id="rolechange'+i+'" uid="'+i+'" class="zcaddct cur msi-menu dN" purpose="changerole" currentrole="'+a+'" sameorguser="'+e.sameorguser+'"></span>')}var v=Users.getUserDetailsForHtml({contact:Users.getInfo(i)||e.participant,val:t,searchemailid:!0,ispeopledata:e.ispeopledata,highlight:e.highlight}),o=v.departmentinfo||o;return e.html.replace(/{USERID}/g,i).replace(/{IMGURL}/g,Users.getImgUrlById(i)).replace(/{DEFAULTURL}/g,Users.getDefaultImgUrl()).replace(/{STATUSCLASS}/g,l).replace(/{SCODE}/g,h).replace(/{DNAMEVAL}/g,$WC.Matcher.replace("escapeReplacementString",v.dname)).replace(/{DNAME}/g,$WC.Matcher.replace("escapeReplacementString",s)).replace(/{ADDCONTACTORROLEHTML}/g,addcontactorrolehtml).replace(/{EMAILID}/g,$WC.$CUtil.isEmpty(o)?Resource.getRealValue("chat.participant.nonorg"):o).replace(/{DELETEMEMBER}/g,deletememberhtml)}},d=function(e,t){for(var i=t.chid,a=t.protocol,s=(t.ignorelist,t.html),n=t.highlight,r=(t.limit,""),d=[],u=(ChatUI.exist[i],[]),m=[],p=t.deletemember,h=t.restricttosameorg,g=t.categorize,f=t.val.toLowerCase(),v=e.length,C=0;v>C;C++){var y=-1,b=-1,E=e[C],I=Users.getInfo(E);I&&l(E,a,t.ignorelist,i,I,h)&&(I.dname=$WC.$CUtil.decodeHTMLEntities(Users.getName(E)),I.emailid=Users.getEmailId(E),"*"===f?m.push([I.dname,E]):(y=I.dname.toLowerCase().indexOf(f),b=I.emailid.toLowerCase().indexOf(f),0===y?u.push([I.dname,E]):-1!==y?m.push([I.dname,E]):-1!==b&&m.push([I.emailid,E])))}var T=$Util.sort(u,0);if(T=T.concat($Util.sort(m,0)),T.length){var $=T.find(function(e){return e[1]===$zcg._ZUID});$&&(T.splice(T.indexOf($),1),T.splice(0,0,$))}var S=Participants.get(i);if(g){var R=o(T,S);if(!$WC.$CUtil.isEmpty(Channels.AllowedUsers[i])&&Channels.isExternalChannel(Channels.getByChid(i))){var A=Channels.AllowedUsers[i];R=R.concat(A)}for(var M=$Scroll.getElementRange(R.length,t),U="",w="",_="",O="",D="",C=M.minlimit,v=M.maxlimit;v>C;C++){if($WC.$CUtil.isArray(R[C]))var E=R[C][1],N=parseInt(S.role[E]),L=Users.isSameOrg(E),W=Users.getInfo(E);else var E=R[C].zuid,N=-1,L=Users.isSameOrg(E),W=R[C];var x=c({val:f,zuid:E,participant:W,highlight:n,html:s,deletemember:p,channelcurrentuserrole:N,sameorguser:L});$WC.$CUtil.isEmpty(N)||0!=parseInt(N)?1==N?w+=x:3==N||2==N?_+=x:4==N?O+=x:-1===N&&(D+=x):U+=x,d.push(E)}M.minlimit<t.limit&&(U=$WC.$CUtil.isEmpty(U)?"":'<div class="zcchrlhd">'+Resource.getRealValue("channel.role.0")+"</div>"+U,w=$WC.$CUtil.isEmpty(w)?"":'<div class="zcchrlhd">'+Resource.getRealValue("channel.role.1")+"</div>"+w,_=$WC.$CUtil.isEmpty(_)?"":'<div class="zcchrlhd">'+Resource.getRealValue("channel.role.3")+"</div>"+_,O=$WC.$CUtil.isEmpty(O)?"":'<div class="zcchrlhd">'+Resource.getRealValue("channel.role.4")+"</div>"+O,D=$WC.$CUtil.isEmpty(D)?"":'<div class="zcchrlhd">'+Resource.getRealValue("channel.invited.users")+"</div>"+D),r=U+w+_+O+D}else for(var M=$Scroll.getElementRange(T.length,t),C=M.minlimit,v=M.maxlimit;v>C;C++){var E=T[C][1];r+=c({val:f,zuid:E,participant:Users.getInfo(E),highlight:n,html:s,deletemember:p,channelcurrentuserrole:S.role?S.role[E]:void 0,ispeopledata:t.peopledata}),d.push(T[C][1])}return{content:r,listid:t.listid,populateid:"participants",destid:t.destid,searchedlist:d,furtherreq:!1,appendindom:t.pageno>1}},u=function(e){var t={html:Chat.participantssearchhtml,protocol:[],ignorelist:[],highlight:!0,limit:25};return e=$.extend({},t,e),s(e.chid,function(t){var i=d(t,e);e.successcallback(e.val,i)}),{content:"",searchedlist:[],furtherreq:!0}},m=function(){$DB.clear("participants")};return{searchParticipants:u,get:e,updateParticipantsObj:r,getIDs:a,getIDsAfterPopulated:s,destroy:m,isAlreadyPopulated:i,update:n}}(),$Participants=function(e){this.chid=e,this.recipants=[],this.pcount=0,this.participantspopulated=!1};$Participants.prototype={addParticipants:function(e,t){"string"==typeof e&&(e=JSON.parse(e));for(var i=ChatUI.exist[this.chid],a=($DB.get("participants")||{},Participants.get(this.chid),{}),s=this.recipants||[],n=this.role||{},r=0,o=e.length;o>r;r++){var l=e[r];if(!$WC.$CUtil.isEmpty(l.uname)){if(!Users.isUserExist(l.uname)){var c=[];c.push(l.dname),c.push(l.email),c.push(l.zoid),a[l.uname]=c}-1===s.indexOf(l.uname)&&(s.push(l.uname),this.pcount++),this.isChannel()&&(n[l.uname]="undefined"!=typeof l.role?parseInt(l.role):"")}}$WC.$CUtil.isEmptyObject(n)||(this.role=n),t=t||this.pcount,Participants.updateParticipantsObj(this.chid,s,t,!0,n),Users.update(a),i&&i.addToUserChatMap()},destroyObj:function(){this.recipants=[],this.updateParticipantCount(0),delete $DB.get("participants")[this.chid]},updateParticipantCount:function(e){this.pcount=parseInt(e)},updateParticipants:function(e){for(var t=0,i=e.length;i>t;t++){var a=e[t];-1===this.recipants.indexOf(a.uname)&&(this.recipants.push(a.uname),this.updateParticipantsInUI(a.uname),this.pcount++)}},updateParticipantsInUI:function(e){e===this.getRecipientFor121Chat()&&ChatUI.isExist(this.chid)&&ChatUI.exist[this.chid].isOnetoOneChat()&&this.updateRecipantStatus()},isChannel:function(){var e=ChatUI.exist[this.chid];return e?e.isChannel():new $CliqChatId(this.chid).isChannel()},handleAddParticipant:function(e){var t=this.pcount,i=this.recipants;if(this.recipants.length)this.addParticipants(e);else{var a=e.length;this.updateParticipantCount(t+a)}if($WC.$Win.isExist("participants")&&ParticipantsWin.populateDefaultResult("participants"),this.updateForceFetch(!0),ChatUI.isExist(this.chid)){var s=ChatUI.exist[this.chid];s.updateWinHeader(),s.clearSuggestToadd(e),this.isChannel()||2!==t||(s.updateAdditionalOptionsUI(),ContactsList.addNew(i))}},handleDeleteParticipant:function(e){if(this.deleteParticipants(e),ChatUI.isExist(this.chid)){var t=ChatUI.exist[this.chid];2===this.pcount?(t.hideInfoDiv(),ParticipantsWin.participantsWinExitsAndisChannel()||t.updateAdditionalOptionsUI()):t.win().find("#usrsmsg"+this.chid).html('<a href="javascript:;">'+Resource.getRealValue(this.pcount>1?"chat.participants.count":"channel.tip.joinedparticip",[this.pcount])+"</a>").attr("title",""),$WC.$Win.isExist("participants")&&ParticipantsWin.populateDefaultResult("participants"),t.updateWinHeader()}},deleteParticipants:function(e){var t=this.recipants;if(t.length){for(var i=this.isChannel(),a=0,s=e.length;s>a;a++){var n=e[a],r=n.s?n.s.split(":",2)[0]:n.uname;this.recipants.splice(t.indexOf(r),1),ChatUI.removeFromUserChatmap(r,this.chid),this.pcount--,i&&this.participantspopulated&&delete $DB.get("participants")[this.chid].role[r]}Participants.updateParticipantsObj(this.chid,this.recipants,this.pcount,this.participantspopulated,this.role)}},updateForceFetch:function(e){this.forcefetch=e?!0:!1},hasAllParticipants:function(){return!this.forcefetch&&this.recipants.length&&this.recipants.length>=parseInt(this.pcount)-1},isParticipantExist:function(e){return-1!==this.recipants.indexOf(e)},setPopulated:function(e){this.participantspopulated=e},getRecipientFor121Chat:function(){var e=$Util.cloneArray(this.recipants);if(ParticipantsWin.participantsWinExitsAndisChannel())return e[0];-1!==e.indexOf($zcg._ZUID)&&e.splice(e.indexOf($zcg._ZUID),1);var t=e[0];return $WC.$CUtil.isEmpty(t)?"":t},getPcount:function(){return this.pcount?this.pcount:this.recipants.length},getParticipantsDetail:function(e,t){var i=[];if(t||i.push({zuid:WmsImpl.getZuid(),dname:WmsImpl.getNickName()}),e)for(var a=e.length,s=0;a>s;s++){var n=e[s];Users.isExist(n)&&!WmsImpl.isLocalUser(n)&&i.push({zuid:n,dname:Users.getName(n)})}else for(var a=this.recipants.length,s=0;a>s;s++){var r=this.recipants[s];(t||r!=WmsImpl.getZuid())&&i.push({zuid:r,dname:Users.getName(r)})}return i},updateRecipantStatus:function(){var e=ChatUI.exist[this.chid],t=this.getRecipientFor121Chat(),i=this.chid,a=e.win(),s=Contacts.statuscodes.ADD_TO_CONTACTS,n='<span class="'+Contacts.getStatusStyle(t,s,!1,!0)+' hdrsts"></span>',r=a.find("#usrsmsg"+i),o="";if(Contacts.isExist(t)){var l=Contacts.get(t);o=l.smsg,s=l.status,n='<span class="'+Contacts.getStatusStyle(t,s,!1,!0)+' hdrsts"></span>'}o=Contacts.getStatusMsg(o,s),n=s==$zcg.CON_REQACC||s==$zcg.CON_REMIND_ME_LATER?n+'<div class=\'vtm dIB ellips\'><a href="javascript:;" operation="accept">'+o+"</a></div>":s==Contacts.statuscodes.ADD_TO_CONTACTS||s==$zcg.CON_DELETE?n+'<div class=\'vtm dIB ellips\'><a href="javascript:;" operation="inviteuser">+ '+o+"</a></div>":n+"<div title='"+o+"' class='vtm dIB ellips'>"+o+"</div>",r.html(n),r.find("a").off("click").on("click",function(e){e.stopImmediatePropagation(),ContactsList.doOperation($(this).attr("operation"),t)}),e.updateStatusMsg()}};var TeamSuggestions=function(e,t){_defineReadOnlyProperties(this,{id:e,limit:t}),SearchField.init(e),SearchEntities[e]=this};TeamSuggestions.prototype={getSearchFieldID:function(){return this.id+"-search-field"},getResultsContainerID:function(){return this.id+"-results"},getResultsListID:function(){return this.id+"-list"},getResultsContainer:function(){return $("#"+this.getResultsContainerID())},getResultsListContainer:function(){return $("#"+this.getResultsListID())},getSelectedList:function(){return SearchField.getSelectedList(this.id+"-search-field")},search:function(e){var t=this.getResultsContainer();t.html('<div id="'+this.getResultsListID()+'" class="drpdwn srchglt"></div>');var i=this.getSelectedList();if(i.length>=this.limit)return void UI.updateBanner(Resource.getRealValue("channel.sel.group.limit"),2e3,!0);var a=SearchAgent.search({searchin:SearchAgent.ORGGROUPS,val:e,ignorelist:i,listid:this.getResultsListID()});return a&&this.displayResultDOM(t),a},handleAction:function(e,t,i){if(i){var a=t.attr("uid"),s=SearchField.getNodeforSelection({uid:a,type:"group",name:Groups.getDisplayName(a)},!0);SearchField.insertNodeinField(this.id,void 0,s),Clickoutside.handleClickOnChild(e),this.handleChange(!0)}},handleChange:function(e){"function"==typeof this.onChange&&this.onChange(this.getSelectedList(),e)},clear:function(){this.getResultsContainer().hide(),this.getResultsListContainer().empty(),Clickoutside.clear(this.getResultsContainerID()),this.handleChange()},displayResultDOM:function(){var e=this.getResultsContainer();e.find("[purpose='search']").first().addClass("srchbn sel"),e.is(":visible")||Clickoutside.bind({srcid:this.getSearchFieldID(),destid:this.getResultsContainerID()}),ZCScroll.scrollTop(e,0)},displayNoResultFound:function(){this.clear();var e='<div id="orggroupshtml" searchcatagory="orggroups"><div class=\'zcuserstatus chatinvt\'>{{empty_text}}</div><div>';e=$WC.template.replace(e,{$empty_text:"channel.groupsuggest.empty"}),this.getResultsListContainer().html(e),this.displayResultDOM()}};